{
  "posts": [
    {
      "content": "\n## ä»€ä¹ˆæ˜¯ chassis?\n\n\n   Chassisï¼Œæ˜¯ä¸€ç§å¾®æœåŠ¡æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œç”¨æˆ·å¹¶ä¸éœ€è¦è‡ªå·±å»å¤„ç†æ„å»ºå¾®æœåŠ¡è¿‡ç¨‹ä¸­å¤–éƒ¨é…ç½®ã€æ—¥å¿—ã€å¥åº·æ£€æŸ¥ã€åˆ†å¸ƒå¼è¿½è¸ªç­‰ï¼Œè€Œæ˜¯å°†ä»–ä»¬äº¤ç»™ä¸“é—¨çš„æ¡†æ¶æ¥å¤„ç†ã€‚ç”¨æˆ·å¯ä»¥æ›´èšç„¦ä¸šåŠ¡é€»è¾‘æœ¬èº«ï¼Œç®€å•ã€å¿«é€Ÿçš„å¼€å‘å¾®æœåŠ¡ã€‚\n\n**é˜…è¯»æ­¤æ–‡ï¼Œä½ å¯ä»¥å¾—åˆ°ä»€ä¹ˆï¼Ÿ**\n\n> 1. chassis è¿è¡Œæ—¶åšäº†ä»€ä¹ˆ\n> 2. chassis è¿è¡Œæ—¶çš„éšè—æ“ä½œã€‚\n> 3. chassis è®¾è®¡æ€è·¯çš„ä¸€äº›ç†è§£\n\n\n### Go-Chassis æ˜¯ä»€ä¹ˆï¼Ÿ\n\n   \n\n Go-Chassis æ˜¯ä¸€ä¸ªgoè¯­è¨€çš„å¾®æœåŠ¡å¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨æ’ä»¶åŒ–è®¾è®¡ï¼ŒåŸç”Ÿæä¾›äº†å¯æ’æ‹”çš„æ³¨å†Œå‘ç°ï¼ŒåŠ å¯†è§£å¯†ï¼Œè°ƒç”¨é“¾è¿½è¸ªç­‰ç»„ä»¶ã€‚åè®®ä¹Ÿæ˜¯æ’ä»¶åŒ–çš„ï¼Œæ”¯æŒhttpå’Œgrpcï¼Œä¹Ÿæ”¯æŒå¼€å‘è€…å®šåˆ¶ç§æœ‰åè®®ï¼Œ å¼€å‘è€…åªéœ€è¦ä¸“æ³¨äºå®ç°äº‘åŸç”Ÿåº”ç”¨å³å¯ã€‚\n\n   \n\n > äº‘åŸç”Ÿåº”ç”¨ï¼ŒåŸºäºäº‘æœåŠ¡å¼€å‘æˆ–è€…é’ˆå¯¹äº‘æœåŠ¡å¼€å‘éƒ¨ç½²çš„åº”ç”¨ã€‚\n\n   \n\n ![chassis æ¶æ„å›¾.png](http://media.gusibi.mobi/nOId8YPFqTTV2Ha8kEB9gVaSG9zAEIBgJe7rp2GK7ZsgyHd4vsX8OMrewCuUb3hs)\n\n   \n\n ä¸Šå›¾æ˜¯go-chassis çš„æ¶æ„å›¾ï¼Œå¯ä»¥çœ‹å‡ºé…ç½®ç®¡ç†ï¼ˆArchaiusï¼‰ã€æœåŠ¡æ³¨å†Œï¼ˆRegistryï¼‰ã€Metricsã€æ—¥å¿—ï¼ˆLoggerï¼‰éƒ½æ˜¯ç‹¬ç«‹çš„ç»„ä»¶ï¼Œåˆ†å¸ƒå¼è¿½è¸ªã€è´Ÿè½½å‡è¡¡ã€é™æµç­‰éƒ½æ˜¯ä»¥ä¸­é—´ä»¶ï¼ˆHandler Chainï¼‰çš„æ–¹å¼å®ç°çš„ã€‚ä¸€ä¸ªè¯·æ±‚è¿›æ¥åä¼šå…ˆé€šè¿‡server è½¬æ¢æˆchassis invokerï¼Œç„¶åç»è¿‡Handler Chainï¼Œæœ€åç”±Transport è½¬æ¢æˆå¯¹åº”åè®®çš„responseè¿”å›ã€‚\n\n   \n\næ­¤ç¯‡æ–‡ç« ä¸»è¦å…³æ³¨go-chassis å¯åŠ¨è¿‡ç¨‹æ—¶åšäº†ä»€ä¹ˆï¼Œä»¥åŠåšè¿™äº›äº‹æƒ…çš„ç”¨é€”ã€‚\n\n\n### ä¸€ä¸ªä¾‹å­\n\n   \n\n é¦–å…ˆä» hello world å¼€å§‹ï¼Œ ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n\n   \n\n```\n   .\n   â”œâ”€â”€ conf                       # é…ç½®ç›®å½•ï¼Œå¿…é¡»\n   â”‚   â”œâ”€â”€ chassis.yaml           #\n   â”‚   â”œâ”€â”€ microservice.yaml      # å¾®æœåŠ¡ç›¸å…³é…ç½®ï¼Œæ¯”å¦‚server nameï¼Œæ³¨å†Œä¸­å¿ƒåœ°å€\n   â””â”€â”€ rest\n       â””â”€â”€ main.go                \n```\n\n   \n\nchassis.yaml å†…å®¹ä¸ºï¼š\n\n   \n\n```\n   ---\n   cse:\n     protocols:\n       rest:\n         listenAddress: \"127.0.0.1:5001\"\n     transport:\n       timeout:\n         rest: 1\n     handler:\n       chain:\n         Provider:\n           default: tracing-provider\n```\n\n   \n\nmicroservice.yaml å†…å®¹ä¸ºï¼š\n\n   \n\n```\n   cse:\n     service:\n       registry:\n           address: http://127.0.0.1:30100\n   \n   service_description:\n     name: test-rest-server\n```\n\n   \n\nmain.go\n\n\n```\npackage main\n   \nimport (\n       rf \"github.com/go-chassis/go-chassis/v2/server/restful\"\n       \"log\"\n       \"net/http\"\n   \n       \"github.com/go-chassis/go-chassis/v2\"\n   )\n   \n//RestFulHello is a struct used for implementation of restfull hello program\ntype RestFulHello struct {\n}\n   \n//Sayhi is a method used to reply user with hello world text\nfunc (r *RestFulHello) Sayhi(b *rf.Context) {\n       b.Write([]byte( \"hello world\"))\n       return\n}\n   \n//URLPatterns helps to respond for corresponding API calls\nfunc (r *RestFulHello) URLPatterns() []rf.Route {\n       return []rf.Route{\n           {Method: http.MethodGet, Path: \"/sayhi\", ResourceFunc: r.Sayhi,\n               Returns: []*rf.Returns{{Code: 200}}},\n       }\n}\n   \nfunc main() {\n   chassis.RegisterSchema(\"rest\", &RestFulHello{})\n   if err := chassis.Init(); err != nil {\n       log.Fatal(\"Init failed.\" + err.Error())\n       return\n   }\n    chassis.Run()\n}\n```\n\n\nå…ˆæ¥çœ‹ä¸€ä¸‹è¿™æ®µä»£ç å…·ä½“åšäº†ä»€ä¹ˆã€‚\n\n   \n\n   - 11~27  å£°æ˜äº† ä¸€ä¸ª RestFulHello structï¼Œè¿™ä¸ªstruct æœ‰ä¸¤ä¸ªæ–¹æ³• Sayhi å’Œ URLPatternsï¼Œå…¶ä¸­URLPatterns è¿”å›ä¸€ä¸ª Route åˆ—è¡¨ã€‚ è¿™æ®µä»£ç å£°æ˜äº†ä¸€ä¸ªhttp handler å’Œ å¯¹åº”çš„è·¯ç”±ï¼Œé‚£å…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ç­‰ä¸‹å†åšè¯´æ˜ã€‚\n\n\n```\ntype Schema struct {\n    serverName string\n    schema     interface{}\n    opts       []server.RegisterOption\n}\n```\n\n   \n\n- 30è¡Œ `chassis.RegisterSchema(\"rest\", &RestFulHello{})` å°†å‰é¢å£°æ˜çš„ RestFulHello æ³¨å†Œåˆ° \"rest\" æœåŠ¡ã€‚\n\n   è¿™é‡Œå†…éƒ¨åªæ˜¯ç®€å•çš„ä½¿ç”¨ä¼ å…¥çš„å‚æ•°åˆ›å»ºä¸€ä¸ª `chassis.Schema` ç„¶åappendåˆ° `chassis.schemas` ä¸­ã€‚\n\n- 31è¡Œ chassisè¿è¡Œå‰çš„åˆå§‹åŒ–å·¥ä½œã€‚\n- 35è¡Œ è¿è¡Œchassis æœåŠ¡ã€‚\n\n   \n\n\n![chassis_start.png](http://media.gusibi.mobi/ti_WF2mI4lC_8F_aeZF7-FxgsBcSkcRMZBrjrKv_vAZ87MV0q3P0Uo7Ukk4d9PW_)\n\n   \n\næ‰§è¡Œ `go run rest/main.go` è¿è¡Œä»£ç ï¼Œä¼šå‘ç°å¯åŠ¨å¤±è´¥ï¼Œæ—¥å¿—è¾“å‡ºå†…å®¹ä¸ºï¼š\n\n   \n\n```\n   INFO: Install client plugin, protocol: rest\n   INFO: Install Provider Plugin, name: default\n   INFO: Installed Server Plugin, protocol:rest\n   \n   ERROR: add file source error [[/var/folders/rr/rzqnl9h10y577rch1nsx_jww0000gp/T/go-build725280265/b001/exe/conf/chassis.yaml] file not exist].\n   file:go-chassis@v1.8.3/chassis_init.go:106,msg:failed to initialize conf: [/var/folders/rr/rzqnl9h10y577rch1nsx_jww0000gp/T/go-build725280265/b001/exe/conf/chassis.yaml] file not exist\n   init chassis fail: [/var/folders/rr/rzqnl9h10y577rch1nsx_jww0000gp/T/go-build725280265/b001/exe/conf/chassis.yaml] file not exist\n   Init failed.[/var/folders/rr/rzqnl9h10y577rch1nsx_jww0000gp/T/go-build725280265/b001/exe/conf/chassis.yaml] file not exist\n```\n\n   \n\né€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªé—®é¢˜ï¼š\n\n\n1. ä¸ºä»€ä¹ˆæ·»åŠ äº†é…ç½®è¿˜ä¼šæç¤ºé…ç½®æ‰¾ä¸åˆ°ï¼Ÿ\n2. ä¸ºä»€ä¹ˆé…ç½®æ²¡æœ‰åŠ è½½æˆåŠŸæ’ä»¶å´å¯ä»¥å®‰è£…æˆåŠŸï¼Ÿ\n\n\n## chassis init\n\n\nä¸‹å›¾æ˜¯chassis init çš„æ‰§è¡Œæµç¨‹ï¼š\n\n![chassis_init.png](http://media.gusibi.mobi/RWJvZfc7AZGccP6ML_wP80QLr1_OQVUCccAoGHpdY3RcD2xqeFTmso34HzIL1_iP)\n\n   \n\n### é…ç½®åˆå§‹åŒ–\n\n\né¦–å…ˆçœ‹ä¸€ä¸‹chassis åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­é…ç½®æ˜¯å¦‚ä½•åŠ è½½çš„ã€‚\n\n\n\n\n![config_init.png](http://media.gusibi.mobi/BruF3mWEA0c2KEh5wqP92EU_c9d44RVFHfYEIkzb5f0IwJ05xYpM_dd6PKb7y-TG)\n\n   \n\n   æŸ¥çœ‹ config.Init() ä»£ç å¯ä»¥çœ‹åˆ° é…ç½®ç›®å½•æ˜¯é€šè¿‡ `fileutil.RouterConfigPath()` æ¥è·å–çš„ï¼Œç›®å½•åˆå§‹åŒ–æ–¹æ³•ä¸ºï¼š\n\n   \n\n```\n   func initDir() {\n       if h := os.Getenv(ChassisHome); h != \"\" {\n           homeDir = h\n       } else {\n           wd, err := GetWorkDir()\n           if err != nil {\n               panic(err)\n           }\n           homeDir = wd\n       }\n   \n       // set conf dir, CHASSIS_CONF_DIR has highest priority\n       if confDir := os.Getenv(ChassisConfDir); confDir != \"\" {\n           configDir = confDir\n       } else {\n           // CHASSIS_HOME has second most high priority\n           configDir = filepath.Join(homeDir, \"conf\")\n       }\n   }\n```\n\n   \n\n> å¦‚æœä½¿ç”¨  `ChassisHome`  ç¯å¢ƒå˜é‡æŒ‡å®šåº”ç”¨ç›®å½•ï¼Œchassis è¿è¡Œæ—¶ï¼Œä¼šä»è¯¥ç›®å½•ä¸‹çš„ `ChassisHome/conf/`  ç›®å½•ä¸­è¯»å–é…ç½®\n>\n> ä¹Ÿå¯ä»¥ä½¿ç”¨ `ChassisConfDir` ç›´æ¥æŒ‡å®šé…ç½®ç›®å½•ï¼ŒChassisConfDir ä¼˜å…ˆçº§é«˜äº `ChassisHome/conf`\n\n   \n\n\nchassis ä½¿ç”¨ archaius æ¥ç®¡ç†é…ç½®ï¼Œ*archaius* åˆå§‹åŒ–æ—¶ï¼Œä¼šä»æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œã€å†…å­˜ä¸­åˆå§‹åŒ–é…ç½®ã€‚\n\n   \n\n```\n   // InitArchaius initialize the archaius\n   func InitArchaius() error {\n       var err error\n   \n       requiredFiles := []string{\n           fileutil.GlobalConfigPath(),\n           fileutil.MicroServiceConfigPath(),\n       }\n       optionalFiles := []string{\n           fileutil.CircuitBreakerConfigPath(),\n           fileutil.LoadBalancingConfigPath(),\n           fileutil.RateLimitingFile(),\n           fileutil.TLSConfigPath(),\n           fileutil.MonitoringConfigPath(),\n           fileutil.AuthConfigPath(),\n           fileutil.TracingPath(),\n           fileutil.LogConfigPath(),\n           fileutil.RouterConfigPath(),\n       }\n   \n       err = archaius.Init( // åˆå§‹åŒ–é…ç½®\n           archaius.WithCommandLineSource(),\n           archaius.WithMemorySource(),\n           archaius.WithENVSource(),\n           archaius.WithRequiredFiles(requiredFiles),\n           archaius.WithOptionalFiles(optionalFiles))\n   \n       return err\n```\n\n\n\nä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œglobal config å’Œ microservice config æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œ\n\n   \n\n> global config å¯¹åº”  conf_path/chassis.yaml\n>\n> microservice config å¯¹åº” conf_path/microservice.yaml\n\n   \n\næ¥ä¸‹æ¥è¯»å‡ºé…ç½®åï¼Œç»™åˆå§‹åŒ–runtime çš„å€¼ï¼š\n\n> runtime ä¸­çš„æ•°æ®å¯ä»¥è®¤ä¸ºæ˜¯è¿è¡Œæ—¶çš„å…¨å±€å˜é‡\n\n\n```\n...\n       // runtime ä¸­çš„æ•°æ®å¯ä»¥è®¤ä¸ºæ˜¯è¿è¡Œæ—¶çš„å…¨å±€å˜é‡\n       runtime.ServiceName = MicroserviceDefinition.ServiceDescription.Name\n       runtime.Version = MicroserviceDefinition.ServiceDescription.Version\n       runtime.Environment = MicroserviceDefinition.ServiceDescription.Environment\n       runtime.MD = MicroserviceDefinition.ServiceDescription.Properties\n       if MicroserviceDefinition.AppID != \"\" { //microservice.yaml has first priority\n           runtime.App = MicroserviceDefinition.AppID\n       } else if GlobalDefinition.AppID != \"\" { //chassis.yaml has second priority\n           runtime.App = GlobalDefinition.AppID\n       }\n       if runtime.App == \"\" {\n           runtime.App = common.DefaultApp\n       }\n   \n       runtime.HostName = MicroserviceDefinition.ServiceDescription.Hostname\n   ...\n```\n\n   \n\narchaius ä¹Ÿæ”¯æŒä»é…ç½®ä¸­å¿ƒè¯»å–é…ç½®ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œchassis ä¹Ÿæä¾›äº†è¿è¡Œæ—¶é…ç½®çƒ­åŠ è½½çš„åŠŸèƒ½ã€‚\n\n   \n\n**å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ’ä»¶ä¼šå…ˆäºé…ç½®å®‰è£…ï¼Ÿ**\n\n### æ’ä»¶åˆå§‹åŒ–\n\n![init_plugin.png](http://media.gusibi.mobi/Tx6hEjesBGf6eV5S9Yb-T5RCCqkTqNEllvVIUdOeVG73j6FLz_OFXCsFWHWpYGYA)\n\n\n\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºinit åšäº†é¢„å…ˆåˆå§‹åŒ–äº†å¾ˆå¤šçš„æ’ä»¶ï¼Œæ¯”å¦‚ clientã€providerã€serverã€logã€router ruleã€registerã€load balanceã€service discoverã€treporterç­‰ï¼Œå¹¶ä¸”chassis init æ–¹æ³•ä¸­å¹¶æ²¡æœ‰åšæ˜¾å¼çš„åˆå§‹åŒ–è°ƒç”¨ã€‚é€šè¿‡æŸ¥çœ‹ä»£ç ä¼šå‘ç°ï¼Œè¿™ä¸ªæ­¥éª¤æ˜¯ä½¿ç”¨å„è‡ªçš„init æ–¹æ³•è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œç±»ä¼¼è¿™æ ·ï¼š\n\n```\n// restful server\nfunc init() {\n    server.InstallPlugin(Name, newRestfulServer)\n}\n\n// route rule plugin\nfunc init() { \n    router.InstallRouterService(\"cse\", newRouter)\n}\n\n// init initialize the plugin of service center registry\nfunc init() {\n    registry.InstallRegistrator(ServiceCenter, NewRegistrator)\n    registry.InstallServiceDiscovery(ServiceCenter, NewServiceDiscovery)\n    registry.InstallContractDiscovery(ServiceCenter, newContractDiscovery)\n\n}\n\n// init install plugin of new file registry\nfunc init() {\n    registry.InstallRegistrator(Name, newFileRegistry)\n    registry.InstallServiceDiscovery(Name, newDiscovery)\n}\n```\n\n\n\nä¹‹æ‰€ä»¥éšå¼åŠ è½½æ˜¯å› ä¸º chassis æ˜¯æ’ä»¶å¼è®¾è®¡ï¼Œä½¿ç”¨ init æ–¹å¼åŠ è½½æ’ä»¶ï¼Œå¯ä»¥åšåˆ°å¯¹æ’ä»¶çš„å³æ’å³ç”¨ï¼Œéœ€è¦ä½¿ç”¨çš„æ’ä»¶åªéœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ åŒ…çš„import å³å¯ï¼Œæ¯”å¦‚åŠ è½½grpc æ’ä»¶ï¼Œåªéœ€è¦åœ¨main.go ä¸­æ·»åŠ  \n\n```\nimport _ \"github.com/go-chassis/go-chassis-extension/protocol/grpc/server\"\n```\n\n\n> ä»è¿™ä¸€ç³»åˆ—æ’ä»¶å®‰è£…æ–¹å¼ä¹Ÿèƒ½çœ‹å‡ºï¼Œå¯¹äºchassis æ¥è¯´ï¼Œæ³¨å†Œä¸­å¿ƒï¼Œåè®®ï¼Œè´Ÿè½½å‡è¡¡ç­‰éƒ½æ˜¯æ’ä»¶ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™äº›æ’ä»¶éƒ½æ˜¯å¯æ›¿æ¢çš„ï¼Œæ–¹ä¾¿äºŒæ¬¡å¼€å‘ã€‚\n\n\n\nä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ç°åœ¨éƒ½è§£å†³äº†ï¼Œç°åœ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿è¡ŒæœåŠ¡ï¼š\n\n\n\n```\nCHASSIS_CONF_DIR=`pwd`/conf go run rest/main.go\n```\n\n\n\n### åˆå§‹åŒ–handler chain\n\n\n\nHandleræ˜¯å¾®æœåŠ¡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åœ¨æ¡†æ¶å±‚é¢é‡Œçš„ä¸€ä¸ªæœ€å°å¤„ç†å•å…ƒã€‚go chassisé€šè¿‡handlerå’Œhandlerçš„ç»„è£…å®ç°ç»„ä»¶åŒ–çš„è¿è¡Œæ¨¡å‹æ¶æ„ã€‚å…¶åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯å®ç°æ¥å£ã€æ³¨å†Œé€»è¾‘ï¼š\n\n\n\nHandler å®šä¹‰éå¸¸ç®€å•ï¼Œå®ç°äº†Handler æ¥å£å°±å¯ä»¥è®¤ä¸ºåˆ›å»ºäº†ä¸€ä¸ªHandlerã€‚\n\n\n```\n// Handler interface for handlers\ntype Handler interface {\n    // handle invocation transportation,and tr response\n    Handle(*Chain, *invocation.Invocation, invocation.ResponseCallBack)\n    Name() string\n}\n```\n\nä½¿ç”¨RegisterHandler å‡½æ•°å°†æ·»åŠ åˆ°HandlerFuncMap ä¸­å³å¯åœ¨CreateHandler è°ƒç”¨æ—¶ä½¿ç”¨ã€‚\n\n```\n// RegisterHandler Let developer custom handler\nfunc RegisterHandler(name string, f func() Handler) error {\n    if stringutil.StringInSlice(name, buildIn) {\n        return errViolateBuildIn\n    }\n    _, ok := HandlerFuncMap[name]\n    if ok {\n        return ErrDuplicatedHandler\n    }\n    HandlerFuncMap[name] = f\n    return nil\n}\n```\n\nå¯¹äºchassis æ¥è¯´ï¼Œåè®®è½¬æ¢ï¼Œæƒé™éªŒè¯ï¼Œå…¨é“¾è·¯è¿½è¸ªç­‰éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªhandlerï¼ˆä¸­é—´ä»¶ï¼‰ï¼Œè¿™é‡Œä¼šä»é…ç½®ä¸­è¯»å–å£°æ˜çš„handlerï¼Œå¹¶ä¸”åˆå§‹åŒ–ã€‚è¯·æ±‚è°ƒç”¨æ—¶ï¼Œä¼šæŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰çš„é¡ºåºè¿›å…¥handlerè¿›è¡Œå¤„ç†ã€‚\n\n\n\n![handler_chain_init.png](http://media.gusibi.mobi/wxzssdKUklFg3Z1mY7QH_9cfBPIfBT3JwGb99ZwfBYcMQ_Rw_TILJWCD0rUPDh99)\n\n\n\nåœ¨æœåŠ¡åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œgo-chassis ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŠ è½½éœ€è¦çš„handlerï¼Œhandler åˆ†ä¸ºproviderã€consumerå’Œ default ä¸‰ç§ï¼Œé…ç½®å†…å®¹ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```\nhandler:\n    chain:\n      Provider:\n        default: tracing-provider\n        rest: jwt\n```\n\n\n\n> **å¦‚æœé…ç½®äº†édefault çš„typeï¼ŒæœåŠ¡å¯åŠ¨çš„æ—¶å€™åªä¼šæ‰§è¡Œæ­¤ç‰¹å®šçš„handlerï¼Œæ¯”å¦‚ä¸Šè¿°é…ç½®ï¼Œhandler åªä¼šæ‰§è¡Œ jwtï¼Œè€Œå¿½ç•¥tracing-provider**\n\n\n\n\n\nè¿™æ˜¯å› ä¸ºchassis ä½¿ç”¨mapå­˜å‚¨ handler chainï¼Œmap çš„key ä¸º chainType+chainNameï¼Œ `default` ä¹Ÿæ˜¯ä¸€ç§chainTypeï¼Œå¦‚æœname(å³chain type)æœ‰å€¼åˆ™ä½¿ç”¨å¯¹åº”çš„ chainï¼Œå¦åˆ™ä½¿ç”¨defaultã€‚\n\n\n```\ntype Chain struct {\n    ServiceType string\n    Name string\n    Handlers []Handler\n}\n\n// GetChain is to get chain\nfunc GetChain(serviceType string, name string) (*Chain, error) {\n    if name == \"\" {\n        name = common.DefaultChainName\n    }\n    origin, ok := ChainMap[serviceType+name]\n    if !ok {\n        return nil, fmt.Errorf(\"get chain [%s] failed\", serviceType+name)\n    }\n    return origin, nil\n}\n\n// \nchainMap := chaninMap[strint]*Chain{\n    \"Provider+rest\":  &Chain{\n          ServiceType: \"Provider\",\n          Name: \"rest\",\n          Handlers: []Handler{jwt},},\n    \"Provider+default\": &Chain{\n          ServiceType: \"Provider\",\n          Name: \"default\",\n          Handlers: []Handler{tracing-provider}},,\n}\n```\n\n\n\n\n\n### åˆå§‹åŒ– server\n\n\n\n![init_server.png](http://media.gusibi.mobi/ilHWFRDKFGZBxP7BCpvqHoDGaiYco4M6Rbzi5kDvyNQBtx5X7nRK1Hz9rv9fMulU)\n\n\nåˆå§‹åŒ–çš„å‰ææ˜¯æœåŠ¡å·²ç»åŠ è½½ï¼ŒåŠ è½½çš„æ­¥éª¤åœ¨init ä¹‹å‰å°±å·²ç»é€šè¿‡ init æ–¹æ³•è½½å…¥äº†ã€‚\n\n\n\n```\n//Init initializes\nfunc Init() error {\n    var err error\n    for k, v := range config.GlobalDefinition.Cse.Protocols {\n        if err = initialServer(config.GlobalDefinition.Cse.Handler.Chain.Provider, v, k); err != nil {\n            log.Println(err)\n            return err\n        }\n    }\n    return nil\n}\n```\n\n\n\nè¿™é‡Œåˆå§‹åŒ–çš„æ˜¯é…ç½®æ–‡ä»¶ä¸­ `protocols` æŒ‡å®šçš„æœåŠ¡ã€‚\n\n\n```\n//è·å–æœåŠ¡çš„æ–¹æ³•\nfunc GetServerFunc(protocol string) (NewFunc, error) {\n    f, ok := serverPlugins[protocol]\n    if !ok {\n        return nil, fmt.Errorf(\"unknown protocol server [%s]\", protocol)\n    }\n    return f, nil\n}\n```\n\n> è¿™é‡Œä¼šä» `*var* serverPlugins = make(*map*[string]NewFunc)`  è¯»å–serverï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶éœ€è¦å…ˆå®‰è£…server å¯¹åº”çš„æ’ä»¶\n>\n> chassis ä¼š é»˜è®¤å®‰è£…rest æ’ä»¶ï¼Œå¯¹äºgrpc éœ€è¦é¦–å…ˆæŒ‡å®š\n\n\n\n```\n// p å¯¹åº” protocal ä¸­çš„é…ç½®\nif p.Listen == \"\" {\n        if p.Advertise != \"\" {\n            p.Listen = p.Advertise\n        } else {\n            p.Listen = iputil.DefaultEndpoint4Protocol(name)\n        }\n    }\n```\n\n\n\n> æœåŠ¡çš„Listen Advertise ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¦‚æœ Advertise å’Œ Listen éƒ½æ²¡æœ‰é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®ã€‚\n\nåˆå§‹åŒ– server optionsï¼Œå…¶ä¸­chainName å¦‚æœProvider é…ç½®äº†å¯¹åº” protocol  name çš„å€¼ï¼Œåˆ™ä½¿ç”¨protocol nameã€‚\n\n```\nchainName := common.DefaultChainName\n    if _, ok := providerMap[name]; ok {\n        chainName = name\n    }\n\no := Options{\n        Address:            p.Listen,  // é…ç½®ä¸­ç›‘å¬çš„ç«¯å£\n        ProtocolServerName: name,      // protocal provider ä¸­çš„åå­—ï¼Œæ¯”å¦‚ rest grpc\n        ChainName:          chainName, // protocal provider ä¸­çš„åå­—ï¼Œæ¯”å¦‚ rest grpc\n        TLSConfig:          tlsConfig,\n        BodyLimit:          config.GlobalDefinition.Cse.Transport.MaxBodyBytes[\"rest\"],\n    }\n```\n\n\n\n### å…¶å®ƒ\n\n\n\nå‡ ä¸ªåˆå§‹åŒ–å¤–ï¼Œinit è¿˜åŒ…æ‹¬ registerã€configcenterã€routerã€contorlã€tracingã€metricã€reporterã€ç†”æ–­å™¨ã€äº‹ä»¶ç›‘å¬ç­‰å°±ä¸å†ç»†è¯´äº†ã€‚\n\n\n\nä¸ºæ­¢ï¼Œchassis æ‰€éœ€è¦çš„åˆå§‹åŒ–æ­¥éª¤å·²ç»ç»“æŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯ æœåŠ¡è¿è¡Œçš„æ­¥éª¤ã€‚\n\n\n\n## chassis run\n\n\n\né¦–å…ˆçœ‹ä¸€ä¸‹ chassis.Run() å¯åŠ¨çš„æ•´ä½“æµç¨‹\n\n\n\n![chassis_run.png](http://media.gusibi.mobi/DSd1K4nvCFlb-5U-hTfqby7OxsN_wf7uhOP6Xm1qb3zNAYa_Owp1C7YTotwlDW4q)\n\n\n\n\n\n**chassis è¿è¡Œ**ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªåŠ¨ä½œï¼š\n\n1. æ ¹æ®schema æ‰¾åˆ°æœåŠ¡ï¼Œå°†å¯¹åº”çš„handle func ä½¿ç”¨ handler chain å°è£…\n2. å¯åŠ¨æœåŠ¡ï¼Œå°†æœåŠ¡æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒ\n3. ç›‘å¬é€€å‡ºä¿¡å·\n\n\n\n**è¿™é‡Œä½¿ç”¨rest æœåŠ¡ä½œä¸ºä¾‹å­çœ‹ä¸€ä¸‹ chassis å¯åŠ¨æœåŠ¡çš„æ—¶å€™åšäº†å“ªäº›æ“ä½œã€‚**\n\n\n### æœåŠ¡æ³¨å†Œ\n\n\n\né¦–å…ˆå›é¡¾ä¸€ä¸‹hello world ä»£ç ï¼š\n\n```\n//RestFulHello is a struct used for implementation of restfull hello program\ntype RestFulHello struct {\n}\n\n//Sayhi is a method used to reply user with hello world text\nfunc (r *RestFulHello) Sayhi(b *rf.Context) {\n    b.Write([]byte( \"hello world\"))\n    return\n}\n\n//URLPatterns helps to respond for corresponding API calls\nfunc (r *RestFulHello) URLPatterns() []rf.Route {\n    return []rf.Route{\n        {Method: http.MethodGet, Path: \"/sayhi\", ResourceFunc: r.Sayhi,\n            Returns: []*rf.Returns{{Code: 200}}},\n    }\n}\n\nchassis.RegisterSchema(\"rest\", &RestFulHello{}) // ç¬¬ä¸€ä¸ªå‚æ•°å³æ˜¯æœåŠ¡åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ Router\n```\n\n\n\n`RestFulHello` ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª `URLPatterns() []Route` æ–¹æ³•ï¼Œå®ç°äº† `Router ` æ¥å£ã€‚ \n\n\n\n**Router å®šä¹‰**\n\n\n\n```\n//Router is to define how route the request\ntype Router interface {\n    //URLPatterns returns route\n    URLPatterns() []Route\n}\n```\n\n\n\n![chassis_restful_register.png](http://media.gusibi.mobi/diDeLEpGlaS-hEyv60YQc2s6jb5AmxfMBLIqiAsAU7W72KQ94umSLJpr7U_sMH1n)\n\n\n```\n// HTTPRequest2Invocation convert http request to uniform invocation data format\nfunc HTTPRequest2Invocation(req *restful.Request, schema, operation string, resp *restful.Response) (*invocation.Invocation, error) {\n    inv := &invocation.Invocation{\n        MicroServiceName:   runtime.ServiceName,\n        SourceMicroService: common.GetXCSEContext(common.HeaderSourceName, req.Request),\n        Args:               req,\n        Reply:              resp,\n        Protocol:           common.ProtocolRest,\n        SchemaID:           schema,\n        OperationID:        operation,\n        URLPathFormat:      req.Request.URL.Path,\n        Metadata: map[string]interface{}{\n            common.RestMethod: req.Request.Method,\n        },\n    }\n    //set headers to Ctx, then user do not  need to consider about protocol in handlers\n    m := make(map[string]string)\n    inv.Ctx = context.WithValue(context.Background(), common.ContextHeaderKey{}, m)\n    for k := range req.Request.Header {\n        m[k] = req.Request.Header.Get(k)\n    }\n    return inv, nil\n}\n```\n\n\nå¯åŠ¨çš„æœåŠ¡æ³¨å†Œæµç¨‹ä¸­åŒ…å«äº†å°†schemas ä¸­æ‰€æœ‰Router å–å‡ºéå†ï¼Œè°ƒç”¨ `WrapHandlerChain()` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦åšäº†ä»¥ä¸‹å·¥ä½œï¼š\n\n1. å–å‡º Route ä¸­ ResourceFunc ï¼ˆå³real handler funcï¼‰\n2. å°† HttpRequest è½¬æ¢æˆ chassis Invocationï¼Œ\n3. å°†Invocation å†æ·»åŠ å› request ä¸­æ·»åŠ åˆ° handler chain ä¸­\n4. è¿”å›ä¸€ä¸ªé—­åŒ…å‡½æ•°ã€‚\n\n\næœ€åä¼šæŠŠä½¿ç”¨ `WrapHandlerChain` å°è£…åçš„handler æ³¨å†Œåˆ°go-restful æ¡†æ¶ä¸­ã€‚\n\nå“åº”è¯·æ±‚æ—¶ï¼Œè°ƒç”¨å…³ç³»ç±»ä¼¼ä»¥ä¸‹æ“ä½œ:\n\n```\nfunc handle(){\n    func handle1(){\n        func handle2(){\n            func handle3(){\n                real_handle_func()\n            }()\n        }()\n    }()\n}\n```\n\n\n**ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢æˆç»Ÿä¸€çš„invocationï¼Ÿ**\n\n\n\nä¸åŒåè®®è¯·æ±‚è¿›å…¥åˆ°å¯¹åº”çš„Serverï¼ŒServerå°†å…·ä½“çš„åè®®è¯·æ±‚è½¬æ¢ä¸ºInvocationç»Ÿä¸€æŠ½è±¡æ¨¡å‹ï¼Œå¹¶ä¼ å…¥Handler chainï¼Œç”±äºhandleræ ¹æ®ç»Ÿä¸€æ¨¡å‹Invocationè¿›è¡Œå¤„ç†ï¼Œä¸å¿…æ¯ä¸ªåè®®å¼€å‘å‡ºæ¥éƒ½è‡ªå·±å¼€å‘ä¸€å¥—æ²»ç†ã€‚å¤„ç†é“¾å¯é€šè¿‡é…ç½®æ›´æ–°ï¼Œå†è¿›å…¥Transport handlerï¼Œä½¿ç”¨ç›®æ ‡å¾®æœåŠ¡çš„åè®®å®¢æˆ·ç«¯ä¼ è¾“åˆ°ç›®æ ‡ã€‚\n\nè¿™ç§æ–¹å¼å®é™…ä¸ŠçœŸæ­£æä¾›ä¸šåŠ¡å¤„ç†çš„è¿˜æ˜¯å„ä¸ªserver æ’ä»¶ï¼Œchassis åªæ˜¯ä¸­é—´å•†ï¼Œå¯ä»¥å¯¹request å’Œ response åšå®ƒæƒ³è¦çš„å¤„ç†ï¼Œæ¯”å¦‚é™æµï¼Œç†”æ–­ï¼Œè·¯ç”±æ›´æ–°ç­‰ã€‚\n\n![server.png](http://media.gusibi.mobi/5RO9xrwmzFuRH1wVtncbC4R3Z9FNr283opNevd5yCeAar0tFDIw_fsTeFUkud1xV)\n\n\n\n1. æ¥æ”¶åˆ°åè®®è¯·æ±‚åï¼Œç”±å„åè®®Serverè½¬ä¸ºç»Ÿä¸€çš„Invocationæ¨¡å‹\n2. Invocationè¿›å…¥å¤„ç†é“¾å¤„ç†\n3. å¤„ç†ç»“æŸåï¼Œè¿›å…¥å…·ä½“çš„ä¸šåŠ¡å¤„ç†é€»è¾‘\n\n\n\n### ä¿¡å·ç›‘å¬\n\n\n\nå½“æœåŠ¡éœ€è¦å…³é—­æˆ–é‡å¯æ—¶ï¼Œåº”å½“å¤„ç†å®Œå½“å‰çš„è¯·æ±‚æˆ–è€…è®¾ç½®ä¸ºè¶…æ—¶ï¼Œè€Œä¸æ˜¯ç²—æš´çš„æ–­å¼€é“¾æ¥ï¼Œchassis è¿™é‡Œä½¿ç”¨äº†ä¿¡å·ç›‘å¬çš„æ–¹å¼æ¥å¤„ç†å…³é—­ä¿¡å·ã€‚\n\n![gracefully_shutdown.png](http://media.gusibi.mobi/qipE63KL-Tjhy6DubK_iyF7W_Rjqae2HrsB3bUFy-FlNVnaAme5qjgyIBEZK1BlB)\n\n```\nfunc waitingSignal() {\n    //Graceful shutdown\n    c := make(chan os.Signal) // åˆ›å»ºä¸€ä¸ªos.Signal channel\n    // æ³¨å†Œè¦æ¥æ”¶çš„ä¿¡å·\n    signal.Notify(c, syscall.SIGINT, syscall.SIGHUP, syscall.SIGTERM, syscall.SIGQUIT, syscall.SIGILL, syscall.SIGTRAP, syscall.SIGABRT)\n    select {\n    case s := <-c:\n        openlogging.Info(\"got os signal \" + s.String())\n    case err := <-server.ErrRuntime:\n        openlogging.Info(\"got server error \" + err.Error())\n    }\n\n    // åˆ¤æ–­æœåŠ¡æ˜¯å¦æœ‰æ³¨å†Œ\n    if !config.GetRegistratorDisable() {\n        registry.HBService.Stop()// åœæ‰å¿ƒè·³æœåŠ¡\n        openlogging.Info(\"unregister servers ...\")\n        // ä»server center ä¸­é€€å‡º\n        if err := server.UnRegistrySelfInstances(); err != nil {\n            openlogging.GetLogger().Warnf(\"servers failed to unregister: %s\", err)\n        }\n    }\n\n    for name, s := range server.GetServers() {\n        // éå†æœåŠ¡ï¼Œè°ƒç”¨æœåŠ¡çš„ stop æ–¹æ³•\n        openlogging.Info(\"stopping server \" + name + \"...\")\n        err := s.Stop()\n        if err != nil {\n            openlogging.GetLogger().Warnf(\"servers failed to stop: %s\", err)\n        }\n        openlogging.Info(name + \" server stop success\")\n    }\n\n    openlogging.Info(\"go chassis server gracefully shutdown\")\n}\n```\n\n\n\nè¿™é‡Œä½¿ç”¨goä¿¡å·é€šçŸ¥æœºåˆ¶é€šè¿‡å¾€ä¸€ä¸ªchannelä¸­å‘é€`os.Signal`å®ç°çš„ã€‚åˆ›å»ºä¸€ä¸ªos.Signal channelï¼Œç„¶åä½¿ç”¨`signal.Notify`æ³¨å†Œè¦æ¥æ”¶çš„ä¿¡å·ï¼Œchassis å…³æ³¨ä»¥ä¸‹ä¿¡å·ï¼š\n\n\n\n| ä¿¡å·    | å€¼   | åŠ¨ä½œ | è¯´æ˜                                         |\n| ------- | ---- | ---- | -------------------------------------------- |\n| SIGHUP  | 1    | Term | ç»ˆç«¯æ§åˆ¶è¿›ç¨‹ç»“æŸ(ç»ˆç«¯è¿æ¥æ–­å¼€)               |\n| SIGINT  | 2    | Term | ç”¨æˆ·å‘é€INTRå­—ç¬¦(Ctrl+C)è§¦å‘                 |\n| SIGQUIT | 3    | Core | ç”¨æˆ·å‘é€QUITå­—ç¬¦(Ctrl+/)è§¦å‘                 |\n| SIGILL  | 4    | Core | éæ³•æŒ‡ä»¤(ç¨‹åºé”™è¯¯ã€è¯•å›¾æ‰§è¡Œæ•°æ®æ®µã€æ ˆæº¢å‡ºç­‰) |\n| SIGTRAP | 5    | Core | TrapæŒ‡ä»¤è§¦å‘(å¦‚æ–­ç‚¹ï¼Œåœ¨è°ƒè¯•å™¨ä¸­ä½¿ç”¨)         |\n| SIGABRT | 6    | Core | è°ƒç”¨abortå‡½æ•°è§¦å‘                            |\n| SIGTERM | 15   | Term | ç»“æŸç¨‹åº(å¯ä»¥è¢«æ•è·ã€é˜»å¡æˆ–å¿½ç•¥)             |\n\n\næ¥æ”¶åˆ°ä¿¡å·åï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒï¼Œå¦‚æœæ³¨å†Œï¼Œåœæ‰å¿ƒè·³å‘é€ï¼Œé€€å‡ºæ³¨å†Œï¼Œç„¶åè°ƒç”¨ server.Shutdown() æ¥ä¼˜é›…é€€å‡ºã€‚\n\n\n\n\n> go http Server ä»1.8 ä¹‹åæ”¯æŒä¼˜é›…é€€å‡ºã€‚\n\n   \n\nå…·ä½“å®ç°å¯ä»¥å‚è€ƒæ­¤æ–‡ç« ï¼šhttp://xiaorui.cc/archives/5803\n\n   \n\n## æ€»ç»“\n\n\nè¿™ç¯‡æ–‡ç« ä»‹ç»äº† chassis æœåŠ¡å¯åŠ¨çš„è¿‡ç¨‹ï¼Œä¸»è¦ä»‹ç»äº†init ä¸­ é…ç½® ã€æ’ä»¶ã€handler chain ã€server çš„åˆå§‹åŒ–æµç¨‹ï¼Œç„¶ååˆ†æäº†æœåŠ¡å¯åŠ¨æ—¶åšäº†å“ªäº›æ“ä½œä»¥åŠå¯¹æœåŠ¡é€€å‡ºçš„å¤„ç†ã€‚\n\n   \n\n## å‚è€ƒé“¾æ¥\n\n1. [ä½¿ç”¨ServiceComb Go-chassisæ„å»ºå¾®æœåŠ¡](https://www.infoq.cn/article/ServiceComb-Go-chassis-micro-service)\n2. [Pattern: Microservice chassis](http://microservices.io/patterns/microservice-chassis.html)\n3. [Linux SignalåŠGolangä¸­çš„ä¿¡å·å¤„ç†](https://colobu.com/2015/10/09/Linux-Signals/)\n4. [æºç åˆ†ægolang http shutdownä¼˜é›…é€€å‡ºçš„åŸç†](http://xiaorui.cc/archives/5803)\n5. [Goè¯­è¨€å¾®æœåŠ¡å¼€å‘æ¡†æ¶å®è·µ-go chassis](https://juejin.im/post/6844903682362834952)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/WDz3v4cU4LQq1oyKX-fYK1LxIThzZ1hK931ZaPRC8CdcB0t2oTYJciMDuAws70FY)",
      "data": {
        "title": "chassis è¿è¡Œæ—¶åšäº†ä»€ä¹ˆï¼Ÿ",
        "date": "2020-11-29 14:01:24",
        "tags": [
          "go",
          "golang",
          "development",
          "åç«¯",
          "å¾®æœåŠ¡"
        ],
        "published": true,
        "hideInList": false,
        "feature": "http://media.gusibi.mobi/wfCxiW0ZpOJ81qw83qINP9jrRtAiFGlJ9jw3lko7L0w5eY79ojwhOw0rGhd3BXpk",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "go-chassis-init"
    },
    {
      "content": "> ä½¿ç”¨å¸¸ç”¨æ¨¡å¼å­¦ä¹ å…³äºgoè¯­è¨€å¯å˜å‚æ•°å‡½æ•°çš„ä¸€åˆ‡\n\n[Ultimate Guide to Go Variadic Functions åŸæ–‡åœ°å€](https://blog.learngoprogramming.com/golang-variadic-funcs-how-to-patterns-369408f19085)\n\n# ä»€ä¹ˆæ˜¯å¯å˜å‚æ•°å‡½æ•°ï¼Ÿ\n\nå¯å˜å‚æ•°å‡½æ•°æ˜¯æŒ‡ä¼ å…¥å‚æ•°æ˜¯å¯å˜æ•°é‡ï¼ˆ0åˆ°æ›´å¤šï¼‰çš„å‡½æ•°ã€‚åœ¨è¾“å…¥çš„å˜é‡ç±»å‹å‰é¢çš„çœç•¥å·(ä¸‰ç‚¹)å‰ç¼€å³æ„æˆä¸€ä¸ªæœ‰æ•ˆçš„å˜é‡ã€‚\n\n![2](http://media.gusibi.mobi/-kn_OQyfZYXrKDs4rz2CYh3wtwEQUaEa5gjqqcZd1Db8S-Bm1UtlS3R5Pg_7wT-j)\n\n> å£°æ˜ä¸€ä¸ªå¯å˜å‚æ•°åä¸ºâ€œ namesâ€ï¼Œç±»å‹ä¸ºstring çš„å¯å˜å‚æ•°å‡½æ•°\n\n## ä¸€ä¸ªç®€å•çš„å¯å˜å‚æ•°å‡½æ•°\n\nè¿™ä¸ª func ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ä¼ é€’çš„å‚æ•°ï¼Œå­—ç¬¦ä¸²ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚\n\n```golang\nfunc toFullname(names ...string) string {\n  return strings.Join(names, \" \")\n}\n```\n\n![Image for post](https://miro.medium.com/max/10000/1*_rdOI_SbL9m07QBcKMqz5Q.png)You can pass zero or more params\n\n## ä½ å¯ä»¥ä¼ å…¥é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°\n\n```go\ntoFullname(\"carl\", \"sagan\")// output: \"carl sagan\"\ntoFullname(\"carl\")// output: \"carl\"\ntoFullname()// output: \"\"\n```\n\n## ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¯å˜å‚æ•°å‡½æ•°ï¼Ÿ\n\n- *çœç•¥åˆ›å»ºä»…ä½œä¸ºå‡½æ•°å‚æ•°åˆ›å»ºä¸´æ—¶ slice å˜é‡*\n- *å½“è¾“å…¥å‚æ•°çš„é•¿åº¦æœªçŸ¥æ—¶*\n- *è¡¨è¾¾ä½ å¢åŠ å¯è¯»æ€§çš„æ„å›¾*\n\n## ä¾‹å­:\n\nçœ‹çœ‹ `Go Stdlib` çš„ `fmt. Println` å‡½æ•°ï¼Œå°±ä¼šæ˜ç™½å®ƒæ˜¯å¦‚ä½•ä½¿è‡ªå·±å˜å¾—æ˜“äºä½¿ç”¨çš„ã€‚\n\nå®ƒä½¿ç”¨å¯å˜å‚æ•°å‡½æ•°æ¥å—å¯é€‰çš„è¾“å…¥å‚æ•°æ•°ç›®ã€‚\n\n```go\nfunc Println(a ...interface{})\n```\n\nå¦‚æœå®ƒä¸æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ï¼Œå®ƒçœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„:\n\n```go\nfunc Println(params []interface{})\n```\n\nä½ éœ€è¦ä¼ é€’ä¸€ä¸ª slice æ‰èƒ½ä½¿ç”¨å®ƒãƒ¼ãƒ¼ verboseï¼Œæ˜¯çš„! :\n\n```go\nfmt.Println([]interface{}{\"hello\", \"world\"})\n```\n\nç›¸æ¯”è€Œè¨€ï¼Œåœ¨å¯å˜å‚æ•°å‡½æ•°å½¢å¼ä¸­ï¼Œå®ƒçš„ä½¿ç”¨æ˜¯ç®€å•çš„:\n\n```go\nfmt.Println(\"hello\", \"world\")\nfmt.Println(\"hello\")\nfmt.Println()\n```\n\n> åœ¨è¿™ä¹‹åçš„éƒ¨åˆ†ï¼Œå°†ä¼šä»‹ç»ä¸€äº›å…³äº å¯å˜å‚æ•°å‡½æ•° çš„ç»†èŠ‚å’Œå¸¸ç”¨æ¨¡å¼çš„ä¾‹å­ã€‚\n\n# åˆ‡ç‰‡ä¸å¯å˜å‚æ•°å‡½æ•°\n\nå¯å˜å‚æ•°åœ¨å‡½æ•°ä¸­ä¼šè¢«è½¬æ¢ä¸ºâ€œæ–°çš„â€åˆ‡ç‰‡ã€‚å¯å˜å‚æ•°å®é™…ä¸Šæ˜¯ slice ç±»å‹çš„å‚æ•°çš„è¯­æ³•ç³–ã€‚\n\n![3](http://media.gusibi.mobi/ELkTXYrLqO41gRC0fl7rz971NPHdCcS0yExDtNqgFCNMjNigJGgDik0XI-tXw3wi)\n\n## ä¸ä¼ å…¥å‚æ•°\n\nå¦‚æœä¸å‘å…¶ä¼ é€’ä»»ä½•å€¼ï¼Œå°±ç›¸å½“äºå‘å¯å˜å‚æ•°å‡½æ•°ä¼ é€’äº† nil åˆ‡ç‰‡ã€‚\n\n![4](http://media.gusibi.mobi/9RBDcXhqLuLBy4oZOANH_3w6Bez2l5vTYpZounxZna8HaWhiaPXtg9o2g_3dYpgC)\n\næ‰€æœ‰éç©ºåˆ‡ç‰‡éƒ½æœ‰å†…å»ºæ•°ç»„ï¼Œè€Œ nil ç‰‡åˆ™æ²¡æœ‰ã€‚\n\n```go\nfunc toFullname(names ...string) []string {\n  return names\n}\n\n// names å†…å»ºæ•°ç»„ä¸º: nil\n```\n\nä½†æ˜¯ï¼Œå½“ä½ å‘å¯å˜å‚æ•°å‡½æ•°æ·»åŠ å‚æ•°æ—¶ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªä¸ä½ ä¼ å…¥å‚æ•°ç›¸å…³è”çš„æ•°ç»„ï¼Œè€Œä¸å†æ˜¯ä¸€ä¸ªç©ºåˆ‡ç‰‡ã€‚\n\ngoè¯­è¨€å†…ç½®å‡½æ•°`append` å°†å‚æ•°è¿½åŠ åˆ°ç°æœ‰çš„sliceï¼Œå¹¶è¿”å›ã€‚`append` ä¹Ÿæ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ã€‚\n\n```go\nfunc toFullname(names ...string) []string {\n  return append(names, \"hey\", \"what's up?\")\n}\n\ntoFullname()\n\n// output: [hey what's up?]\n```\n\n## å¦‚ä½•ä¼ é€’ä¸€ä¸ªåˆ‡ç‰‡ï¼Ÿ\n\né€šè¿‡å°†å¯å˜å‚æ•°è¿ç®—ç¬¦`...` åŠ åœ¨ç°æœ‰åˆ‡ç‰‡åï¼Œå¯ä»¥å°†å…¶ä¼ é€’ç»™å¯å˜å‚æ•°è¿ç®—ç¬¦ã€‚\n\n```go\nnames := []string{\"carl\", \"sagan\")}\n\ntoFullname(names...)// output: \"carl sagan\"\n```\n\nè¿™ç­‰åŒäºä»¥ä¸‹è°ƒç”¨:\n\n```go\ntoFullname(\"carl\", \"sagan\")\n```\n\n**ä½†æ˜¯ï¼Œæœ‰ä¸€ç‚¹ä¸åŒï¼š** ï¼Œåœ¨å‡½æ•°ä¸­å°†ç›´æ¥ä½¿ç”¨ä¼ å…¥çš„åˆ‡ç‰‡è€Œä¸æ˜¯åˆ›å»ºæ–°çš„åˆ‡ç‰‡ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œè¯·å‚é˜…ä»¥ä¸‹å†…å®¹ã€‚\n\n![5](http://media.gusibi.mobi/I78AMp2oauglKBaN-v2vInPqqOddUZSAnsOLwqI-nOQUu1tUZq5E6H2kb_ksQems)\n\nåƒä¸‹é¢è¿™æ ·ï¼Œä½ ä¹Ÿå¯ä»¥å°†æ•°ç»„ä½œä¸ºå¯å˜å‚æ•°å‡½æ•°çš„å‚æ•°:\n\n```go\nnames := [2]string{\"carl\", \"sagan\"}\ntoFullname(names[:]...)\n```\n\n## Passed sliceâ€™s spooky action at a distance\n\n> æ ‡é¢˜ä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘...\n\nå‡è®¾ä½ å°†ä¸€ä¸ª slice ä½œä¸ºå‚æ•°ä¼ ç»™ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°:\n\n```go\ndennis := []string{\"dennis\", \"ritchie\"}\ntoFullname(dennis...)\n```\n\nå†å‡è®¾ä½ ä¿®æ”¹äº†å‡½æ•°ä¸­å˜é‡å‚æ•°çš„ç¬¬ä¸€é¡¹:\n\n```go\nfunc toFullname(names ...string) string {\n  names[0] = \"guy\"\n  return strings.Join(names, \" \")\n}\n```\n\nä¿®æ”¹å®ƒä¹Ÿä¼šå½±å“åŸå§‹çš„åˆ‡ç‰‡ã€‚â€œ dennisâ€åˆ‡ç‰‡ç°åœ¨å˜æˆäº†:\n\n```go\n[]string{\"guy\", \"ritchie\"}\n```\n\nè€Œä¸æ˜¯åŸå§‹å€¼:\n\n```go\n[]string{\"dennis\", \"ritchie\"}\n```\n\nå› ä¸ºä¼ å…¥çš„ slice ä¸ func å†…éƒ¨çš„ slice å…±äº«ç›¸åŒçš„åº•å±‚æ•°ç»„ï¼Œæ‰€ä»¥åœ¨ func å†…éƒ¨æ”¹å˜ slice çš„å€¼ä¹Ÿä¼šå½±å“ä¼ å…¥çš„ slice:\n\n![6](http://media.gusibi.mobi/AbFuGA5LzxztjxBQ_D7oWHdkh-AZifMm4m1_E-iGRbezqRmO3ZeT-siWIfoYBnWc)\n\nå¦‚æœä½ ç›´æ¥ä¼ é€’å‚æ•°(ä¸ä½¿ç”¨åˆ‡ç‰‡) ï¼Œå°±ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚\n\n## åŠ¨æ€ä¼ é€’å¤šä¸ªåˆ‡ç‰‡\n\nå‡è®¾ä½ æƒ³åœ¨ slice ä¼ é€’ç»™ func ä¹‹å‰ï¼Œåœ¨ slice å‰é¢æ·»åŠ â€œ mr. â€ã€‚\n\n```go\nnames := []string{\"carl\", \"sagan\"}\n```\n\né¦–å…ˆ`append` å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ‡ç‰‡ï¼Œç„¶åå°†nameså±•å¼€ï¼Œ ç„¶åå°†å€¼ä¾æ¬¡æ·»åŠ åˆ°æ–°åˆ›å»ºçš„åˆ‡ç‰‡ä¸Šï¼Œç„¶åå†å°†å±•å¼€çš„ç»“æœä¼ ç»™ `toFullname` å‡½æ•°:\n\n```go\ntoFullname(append([]string{\"mr.\"}, names...)...)\n\n// output: \"mr. carl sagan\"\n```\n\nè¿™å’Œä¸‹é¢çš„ä»£ç ä¸€æ ·:\n\n```go\nnames = append([]string{\"mr.\"}, \"carl\", \"sagan\")\ntoFullname(names...)\n\n// or with this:\ntoFullname([]string{\"mr.\", \"carl\", \"sagan\"}...)\n\n// or with thisâ€”except passing an existing slice:\ntoFullname(\"mr.\", \"carl\", \"sagan\")\n```\n\n## è¿”å›ä¼ å…¥çš„åˆ‡ç‰‡\n\nä¸èƒ½ä½¿ç”¨å¯å˜å‚æ•°ä½œä¸ºè¿”å›ç»“æœç±»å‹ï¼Œä½†æ˜¯å¯ä»¥å°†å…¶ä½œä¸ºç‰‡è¿”å›ã€‚\n\n```go\nfunc f(nums ...int) []int {\n  nums[1] = 10\n  return nums\n}\n```\n\nå½“ä½ å°†ä¸€ä¸ª slice ä½œä¸ºå‚æ•°ä¼ å…¥ f æ—¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç›¸åŒçš„æ–° sliceã€‚ä¼ å…¥å’Œè¿”å›çš„åˆ‡ç‰‡æ˜¯ç›¸å…³è”çš„ã€‚ä¸¤ä¸ªä¸­ä»»æ„ä¸€ä¸ªæ”¹å˜éƒ½ä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚\n\n```go\nnums  := []int{23, 45, 67}\nnums2 := f(nums...)\n```\n\nè¿™é‡Œï¼Œnums å’Œ nums2æœ‰ç›¸åŒçš„å…ƒç´ ï¼Œå› ä¸ºå®ƒä»¬éƒ½æŒ‡å‘ç›¸åŒçš„åº•å±‚æ•°ç»„ã€‚\n\n```go\nnums  = []int{10, 45, 67}\nnums2 = []int{10, 45, 67}\n```\n\nğŸ‘‰ [è¿™æ®µä»£ç ](https://play.golang.org/p/Jun14DYWvq) åŒ…å«å…³äº slice åŸºç¡€æ•°ç»„çš„è¯¦ç»†è¯´æ˜\n\n## æ‰©å±•æ“ä½œç¬¦åæ¨¡å¼\n\nå¦‚æœä½ æœ‰ä¸€ä¸ª funcsï¼Œå®ƒä»¬å”¯ä¸€çš„ç”¨é€”å°±æ˜¯æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œé‚£ä¹ˆæœ€å¥½ä½¿ç”¨å¯å˜å‚æ•°å‡½æ•°ä»£æ›¿ä½¿ç”¨ sliceã€‚\n\n```go\n// Don't do this\ntoFullname([]string{\"rob\", \"pike\"}...)\n\n// Do this\ntoFullname(\"rob\", \"pike\")\n```\n\n[è¿è¡Œä»£ç ](https://play.golang.org/p/oKQjwotLC_)\n\n## ä½¿ç”¨å¯å˜å‚æ•°çš„é•¿åº¦\n\nä½ å¯ä»¥ä½¿ç”¨å¯å˜å‚æ•°çš„é•¿åº¦æ¥æ”¹å˜å‡½æ•°çš„è¡Œä¸ºã€‚\n\n```go\nfunc ToIP(parts ...byte) string {\n  parts = append(parts, make([]byte, 4-len(parts))...)  \n  \n  return fmt.Sprintf(\"%d.%d.%d.%d\", \n    parts[0], parts[1], parts[2], parts[3])\n}\n```\n\nToIP func å°†â€œ partsâ€ä½œä¸ºå¯å˜å‚æ•°ï¼Œå¹¶ä½¿ç”¨ parts param çš„é•¿åº¦è¿”å›é»˜è®¤å€¼ä¸º0çš„å­—ç¬¦ä¸²å½¢å¼çš„ IP åœ°å€ã€‚\n\n```go\nToIP(255)   // 255.0.0.0\nToIP(10, 1) // 10.1.0.0\nToIP(127, 0, 0, 1) // 127.0.0.1\n```\n\n[è¿è¡Œä»£ç ](https://play.golang.org/p/j9RcLvbs3K)\n\n# âœª å˜é‡å‡½æ•°çš„ç­¾å\n\nå°½ç®¡å¯å˜å‚æ•°å‡½æ•°æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œä½†å®ƒçš„ç­¾å[ç±»å‹æ ‡è¯†](https://golang.org/ref/spec#Type_identity)ä¸æ¥å—åˆ‡ç‰‡çš„å‡½æ•°æ˜¯ä¸åŒçš„ã€‚\n\nä¸¾ä¸ªä¾‹å­çœ‹ä¸€ä¸‹å­—ç¬¦ä¸²åˆ‡ç‰‡å’Œ ...å­—ç¬¦ä¸²çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\n\n***ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°çš„ç­¾å:***\n\n```go\nfunc PrintVariadic(msgs ...string)// signature: func(msgs ...string)\n```\n\n***éå¯å˜å‚æ•°å‡½æ•°çš„ç­¾å:***\n\n```go\nfunc PrintSlice(msgs []string)// signature: func([]string)\n```\n\n*å®ƒä»¬çš„ç±»å‹æ ‡è¯†ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬èµ‹å€¼ç»™å˜é‡:*\n\n```go\nvariadic := PrintVariadic   // variadic is a func(...string)\nslicey := PrintSlice       // slice is a func([]string)\n```\n\nå› æ­¤ï¼Œå…¶ä¸­ä¸€ä¸ªä¸èƒ½æ›¿ä»£å¦ä¸€ä¸ª:\n\n```go\nslicey = variadic// error: type mismatch\n```\n\n[è¿è¡Œä»£ç ](https://play.golang.org/p/fsZYGgTyvF)\n\n# æ··åˆå˜é‡å’Œéå¯å˜å‚æ•°\n\nä½ å¯ä»¥é€šè¿‡æŠŠéå¯å˜å‚æ•°æ”¾åœ¨å¯å˜å‚æ•°ä¹‹å‰ï¼Œå°†éå¯å˜å‚æ•°ä¸å¯å˜å‚æ•°æ··åˆã€‚\n\n```go\nfunc toFullname(id int, names ...string) string {\n  return fmt.Sprintf(\"#%02d: %s\", id, strings.Join(names, \" \"))\n}\n\ntoFullname(1, \"carl\", \"sagan\")// output: \"#01: carl sagan\"\n```\n\nä½†æ˜¯ï¼Œä½ ä¸èƒ½å°†éå¯å˜å‚æ•°æ”¾åˆ°å¯å˜å‚æ•°ä¹‹å:\n\n```go\nfunc toFullname(id int, names ...string, age int) string {}// error\n```\n\n[è¿è¡Œä»£ç ](https://play.golang.org/p/TlbDYapOCD)\n\n## æ¥å—å˜é‡ç±»å‹çš„å‚æ•°\n\nä¾‹å¦‚ï¼Œ[*Go Stdlib çš„ Printf*](https://golang.org/src/fmt/print.go#L189) å‡½æ•°ï¼Œä½¿ç”¨ç©ºæ¥å£ç±»å‹æ¥å—ä»»ä½•ç±»å‹çš„è¾“å…¥å‚æ•°ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ç©ºæ¥å£æ¥å—ä»»æ„ç±»å‹å’Œä»»æ„æ•°é‡çš„å‚æ•°ã€‚\n\n```go\nfunc Printf(format string, a ...interface{}) (n int, err error) {\n    /* this is a pass-through with a... */  \n    return Fprintf(os.Stdout, format, a...)\n}\n\nfmt.Printf(\"%d %s %f\", 1, \"string\", 3.14)    // output: \"1 string 3.14\"\n```\n\n## ä¸ºä»€ä¹ˆ Printf åªæ¥å—ä¸€ä¸ªå˜é‡å‚æ•°ï¼Ÿ\n\næŸ¥çœ‹ Printf çš„ç­¾åæ—¶ï¼Œä¼šå‘ç°å®ƒæ¥å—ä¸€ä¸ªåä¸º format çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªå¯å˜å‚æ•°ã€‚\n\n```go\nfunc Printf(format string, a ...interface{})\n```\n\nè¿™æ˜¯å› ä¸ºformatæ˜¯å¿…éœ€çš„å‚æ•°ã€‚Printf å¼ºåˆ¶æ‚¨æä¾›å®ƒï¼Œå¦åˆ™ä»£ç å°†æ— æ³•ç¼–è¯‘ã€‚\n\nå¦‚æœå®ƒé€šè¿‡ä¸€ä¸ªå¯å˜å‚æ•°æ¥æ”¶æ‰€æœ‰å‚æ•°ï¼Œé‚£ä¹ˆè°ƒç”¨æ–¹å¯èƒ½æ²¡æœ‰æä¾›å¿…è¦çš„æ ¼å¼åŒ–ç¨‹åºå‚æ•°ï¼Œæˆ–è€…ä»å¯è¯»æ€§è§’åº¦æ¥çœ‹ï¼Œå®ƒä¸ä¼šåƒè¿™ä¸ªå‚æ•°é‚£ä¹ˆæ˜ç¡®ã€‚*å®ƒæ¸…æ¥šåœ°æ ‡æ˜äº† Printf éœ€è¦ä»€ä¹ˆ*ã€‚\n\næ­¤å¤–ï¼Œè°ƒç”¨æ—¶ä¸ä¼ äººå˜é‡å‚æ•°â€œaâ€ï¼Œå®ƒå°†é˜²æ­¢ *Printf* åœ¨ å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªä¸å¿…è¦çš„åˆ‡ç‰‡ï¼Œä¸€ä¸ªå€¼ä¸º nil åˆ‡ç‰‡ã€‚*This may not be a clear win for Printf but it can be for you in your own code*ã€‚\n\nä½ ä¹Ÿå¯ä»¥åœ¨è‡ªå·±çš„ä»£ç ä¸­ä½¿ç”¨ç›¸åŒçš„æ¨¡å¼ã€‚\n\n## æ³¨æ„ç©ºæ¥å£ç±»å‹\n\n`interface{}`ç±»å‹ä¹Ÿç§°ä¸ºç©ºæ¥å£ç±»å‹ï¼Œè¿™æ„å‘³ç€å®ƒç»•è¿‡äº†è‡ªèº«çš„ Go é™æ€ç±»å‹è¯­ä¹‰æ£€æŸ¥ã€‚ä¸å¿…è¦åœ°ä½¿ç”¨å®ƒä¼šç»™ä½ å¸¦æ¥å¼Šå¤§äºåˆ©çš„åæœã€‚\n\nä¾‹å¦‚ï¼Œå®ƒå¯èƒ½å¼ºåˆ¶ä½ ä½¿ç”¨[*reflection*](https://blog.golang.org/laws-of-reflection)ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç‰¹æ€§(*instead of fast and safe â€” compile-time)*ã€‚ä½ å¯èƒ½éœ€è¦è‡ªå·±æŸ¥æ‰¾ç±»å‹é”™è¯¯ï¼Œè€Œä¸æ˜¯ä¾èµ–äºç¼–è¯‘å™¨å¸®ä½ æ‰¾åˆ°å®ƒä»¬ã€‚\n\n> åœ¨ä½¿ç”¨ç©ºæ¥å£ä¹‹å‰è¦ä»”ç»†è€ƒè™‘ï¼Œä¾é æ˜¾å¼ç±»å‹å’Œæ¥å£æ¥å®ç°æ‰€éœ€çš„è¡Œä¸ºã€‚\n\n## å°†åˆ‡ç‰‡ä¼ é€’ç»™å…·æœ‰ç©ºæ¥å£çš„å¯å˜å‚æ•°\n\nä½ ä¸èƒ½å°†ä¸€ä¸ªæ™®é€šçš„åˆ‡ç‰‡ä¼ é€’ç»™ä¸€ä¸ªå…·æœ‰ç©ºæ¥å£ç±»å‹çš„å¯å˜å‚æ•°ã€‚å…·ä½“åŸå› [è¯·é˜…è¯»è¿™é‡Œ](https://golang.org/doc/faq#convert_slice_of_interface)ã€‚\n\n```go\nhellos := []string{\"hi\", \"hello\", \"merhaba\"}\n```\n\n*You expect this to work, but it doesnâ€™t:*\n\nä½ å¯èƒ½æœŸæœ›è¿™èƒ½ç”Ÿæ•ˆï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤:\n\n```go\nfmt.Println(hellos...)\n```\n\nå› ä¸ºï¼Œhello æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç©ºæ¥å£åˆ‡ç‰‡ã€‚å¯å˜å‚æ•°æˆ–åˆ‡ç‰‡åªèƒ½å±äºä¸€ç§ç±»å‹ã€‚\n\né¦–å…ˆéœ€è¦å°† *hellos* slice è½¬æ¢ä¸ºä¸€ä¸ªç©ºæ¥å£ slice:\n\n```go\nvar ihellos []interface{} = make([]interface{}, len(hello))for i, hello := range hellos {\n  ihellos[i] = hello\n}\n```\n\n*Now, the expansion operator will work:*\n\nç°åœ¨ï¼Œæ‰©å±•è¿ç®—ç¬¦å°†å¼€å§‹ç”Ÿæ•ˆ:\n\n```go\nfmt.Println(ihellos...)\n// output: [hi hello merhaba]\n```\n\n[è¿è¡Œä»£ç ](https://play.golang.org/p/8uRHsHFKSx)\n\n# å‡½æ•°å¼ç¼–ç¨‹æ–¹é¢\n\nä½ è¿˜å¯ä»¥ä½¿ç”¨å¯å˜å‚æ•°å‡½æ•°æ¥å—å¯å˜æ•°ç›®çš„å‡½æ•°ã€‚è®©æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ–°çš„ formatter func ç±»å‹ã€‚æ ¼å¼åŒ–ç¨‹åº func è·å–å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²:\n\n```go\ntype formatter func(s string) string\n```\n\nè®©æˆ‘ä»¬å£°æ˜ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å’Œæ•°é‡å¯é€‰çš„å¯æ ¼å¼åŒ–çš„ç±»å‹ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸€äº›pipelineæ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚\n\n```go\nfunc format(s string, fmtrs ...formatter) string {\n  for _, fmtr := range fmtrs {\n    s = fmtr(s)\n  }  return s\n}\n\nformat(\" alan turing \", trim, last, strings.ToUpper)// output: TURING\n```\n\n[è¿è¡Œä»£ç ](https://play.golang.org/p/kCOP6_5h-t)\n\næ‚¨è¿˜å¯ä»¥ä½¿ç”¨channelsã€structsç­‰æ¥ä»£æ›¿è¿™ç§é“¾å¼æ¨¡å¼çš„å‡½æ•°ã€‚çœ‹* [*è¿™é‡Œ*](https://golang.org/pkg/io/#MultiReader) *æˆ–è€…* [*è¿™é‡Œ*](https://golang.org/src/text/template/parse/parse.go?s=1642:1753#L41) *æŸ¥çœ‹ç¤ºä¾‹.*\n\n## ä½¿ç”¨ç»“æœä¸ºsliceçš„å‡½æ•°ä½œä¸ºå¯å˜å‚æ•°\n\nè®©æˆ‘ä»¬é‡å¤ä½¿ç”¨ä¸Šé¢çš„â€œformat funcâ€æ¥åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„æ ¼å¼åŒ–ç®¡é“æ„å»ºå™¨:\n\n```go\nfunc build(f string) []formatter {\n  switch f {\n    case \"lastUpper\":\n      return []formatter{trim, last, strings.ToUpper}\n    case \"trimUpper\":\n      return []formatter{trim, strings.ToUpper}\n    // ...etc\n    default:\n      return identityFormatter\n  }\n}\n```\n\nç„¶åä½¿ç”¨ expand è¿ç®—ç¬¦è¿è¡Œå®ƒï¼Œæœ€åå°†ç»“æœæä¾›ç»™æ ¼å¼ func:\n\n```go\nformat(\" alan turing \", build(\"lastUpper\")...)// output: TURING\n```\n\n## å¯å˜å‚æ•°é€‰é¡¹æ¨¡å¼\n\n*You may have already been familiar with this pattern from other OOP langs and this has been re-popularized again in Go by Rob Pike* [*here*](https://commandcenter.blogspot.com.tr/2014/01/self-referential-functions-and-design.html) *back in 2014. Itâ€™s like the* [*visitor pattern*](https://en.wikipedia.org/wiki/Visitor_pattern)*.*\n\nä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰è¿™ç§æ¥è‡ªå…¶ä»– OOP è¯­è¨€çš„æ¨¡å¼ï¼Œè¿™ç§[æ¨¡å¼](https://commandcenter.blogspot.com.tr/2014/01/self-referential-functions-and-design.html)åœ¨2014å¹´ Rob Pike çš„ Go ä¸­å†æ¬¡æµè¡Œèµ·æ¥ã€‚è¿™å°±åƒæ˜¯[è®¿å®¢æ¨¡å¼](https://en.wikipedia.org/wiki/Visitor_pattern)ã€‚\n\nè¿™ä¸ªä¾‹å­å¯¹ä½ æ¥è¯´å¯èƒ½æœ‰ç‚¹éš¾ã€‚å¦‚æœæœ‰ä¸ç†è§£çš„è¯·åŠæ—¶æé—®<ä½œè€…ä¸åœ¨ï¼ŒæŸ¥çœ‹åŸæ–‡é“¾æ¥æé—®å§ğŸ˜‚>ã€‚\n\nè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Loggerï¼Œå¯ä»¥ä½¿ç”¨å¯é€‰æ¨¡å¼åœ¨è¿è¡Œæ—¶æ›´æ”¹è¯¦ç»†ç¨‹åº¦å’Œå‰ç¼€:\n\n```go\ntype Logger struct {\n  verbosity\n  prefix string\n}\n```\n\nä½¿ç”¨ä¸€ä¸ªå¯å˜çš„é€‰é¡¹å‚æ•°æ¥æ”¹å˜loggerçš„è¡Œä¸º:\n\n```go\nfunc (lo *Logger) SetOptions(opts ...option) {\n  for _, applyOptTo := range opts {\n    applyOptTo(lo)\n  }\n}\n```\n\næˆ‘ä»¬åˆ›å»ºä¸€äº›è¿”å›é…ç½®æ–¹æ³•çš„å‡½æ•°ï¼Œå®ƒä»¬åœ¨ä¸€ä¸ªé—­åŒ…ä¸­æ”¹å˜ Logger çš„æ“ä½œè¡Œä¸ºï¼š\n\n```go\nfunc HighVerbosity() option {\n  return func(lo *Logger) {\n    lo.verbosity = High\n  }\n}\n\nfunc Prefix(s string) option {\n  return func(lo *Logger) {\n    lo.prefix = s\n  }\n}\n```\n\nç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨é»˜è®¤é€‰é¡¹åˆ›å»ºä¸€ä¸ªæ–°çš„ Logger:\n\n```go\nlogger := &Logger{}\n```\n\nç„¶åé€šè¿‡å˜é‡å‚æ•°å‘è®°å½•å™¨æä¾›é€‰é¡¹:\n\n```go\nlogger.SetOptions(\n  HighVerbosity(), \n  Prefix(\"ZOMBIE CONTROL\"),\n)\n```\n\nç°åœ¨è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è¾“å‡º:\n\n```go\nlogger.Critical(\"zombie outbreak!\")\n// [ZOMBIE CONTROL] CRITICAL: zombie outbreak!\n\nlogger.Info(\"1 second passed\")\n// [ZOMBIE CONTROL] INFO: 1 second passed\n```\n\n[è¿è¡Œä»£ç ](https://play.golang.org/p/X2XHSdYgdq)\n\n# âœª æ— ç©·æ— å°½çš„ç²¾ç¥é£Ÿç²®ï¼\n\n- åœ¨ Go 2ä¸­ï¼Œæœ‰ä¸€äº›å¯å˜å‡½æ•°çš„è¡Œä¸ºçš„è®¡åˆ’*[*è¿™é‡Œ*](https://github.com/golang/go/issues/15209)*,* [*here è¿™é‡Œ*](https://github.com/golang/go/issues/18605)*,åŠ*[*è¿™é‡Œ*](https://github.com/golang/go/issues/19218)*.*\n- *ä½ å¯ä»¥åœ¨ Go è¯­è¨€æ ‡å‡†æ–‡æ¡£é‡Œæ‰¾åˆ°æ›´æ­£å¼çš„å¯å˜å‚æ•°å‡½æ•°æŒ‡å—,*[*è¿™é‡Œ*](https://golang.org/ref/spec#Passing_arguments_to_..._parameters)*,* [*è¿™é‡Œ*](https://golang.org/ref/spec#Appending_and_copying_slices)*,* [*è¿™é‡Œ*](https://golang.org/ref/spec#Appending_and_copying_slices) *åŠ*[*è¿™é‡Œ*](https://golang.org/ref/spec#Type_identity)*.*\n- [*ä½¿ç”¨æ¥è‡ª c çš„å¯å˜å‡½æ•°*](https://sunzenshen.github.io/tutorials/2015/05/09/cgotchas-intro.html)*.*\n- *ä½ å¯ä»¥æ‰¾åˆ°å¾ˆå¤šè¯­è¨€çš„å¯å˜å‚æ•°å‡½æ•°å£°æ˜*[*è¿™é‡Œ*](https://rosettacode.org/wiki/Variadic_function)*.è‡ªç”±æ¢ç´¢å§*\n\nå¥½äº†ï¼Œå°±åˆ°è¿™äº†ã€‚è°¢è°¢ä½ ä»¬çš„é˜…è¯»ã€‚",
      "data": {
        "title": "ã€è¯‘ã€‘golang å¯å˜å‚æ•°å‡½æ•°ç»ˆææŒ‡å—",
        "date": "2020-08-16 22:29:38",
        "tags": [
          "golang"
        ],
        "published": true,
        "hideInList": false,
        "feature": "http://media.gusibi.mobi/fOAjbsODtw2AeVd8OagAvADNACJHu1XFE1MKQ_EBauaKHh7K05KruNKG0SHWU82A",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Ultimate-Guide-to-Go-Variadic-Functions"
    },
    {
      "content": "\n<!-- more -->\n\n\n### é˜…è¯»çš„ç›®çš„\n\n\nå¾®æœåŠ¡æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼Œæœ€è¿‘å‡ å¹´å·¥ä½œä¸­ä½¿ç”¨çš„æ˜¯å¾®æœåŠ¡æ¶æ„æ¥éƒ¨ç½²æœåŠ¡ï¼Œä½†è‡ªå·±æ¥è§¦åˆ°çš„ä¸»è¦æ˜¯ä¸šåŠ¡å¼€å‘ç›¸å…³çš„å·¥ä½œï¼Œå¯¹å¾®æœåŠ¡çš„äº†è§£ä¸»è¦åå®æˆ˜æ–¹é¢ï¼Œè€Œå¯¹äºæ„å»ºã€é›†æˆã€åˆ†è§£ã€æµ‹è¯•ã€éƒ¨ç½²ã€ç›‘æ§ã€æ¶æ„æ¼”è¿›ç­‰ç›¸å…³å†…å®¹æ²¡æœ‰ç³»ç»Ÿæ€§çš„äº†è§£è¿‡ï¼Œæ­¤ä¹¦å†…å®¹æ¯”è¾ƒå…¨é¢ï¼ŒåŒ…å«äº†å¾®æœåŠ¡è®¾è®¡çš„å„ç§ä¸»é¢˜ï¼Œè¯»è¿™æœ¬ä¹¦ä¸»è¦å¸Œæœ›å¯ä»¥ç³»ç»Ÿæ€§çš„äº†è§£ä¸€ä¸‹å¾®æœåŠ¡çš„æ–¹æ–¹é¢é¢ã€‚\n\n\n\n### æœ¬ä¹¦çš„æ•´ä½“æ¡†æ¶\n\n\n\nè¿™æœ¬ä¹¦ä¸»è¦åŸºäºä¸»é¢˜æ¥ç»„ç»‡å†…å®¹ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ä¸»é¢˜ï¼š\n\n\n\n1. å¾®æœåŠ¡åŸºæœ¬æ¦‚å¿µçš„ä»‹ç»ï¼Œ\n2. å¦‚ä½•æ„å»ºå¾®æœåŠ¡ï¼Œ\n3. ä»€ä¹ˆæ ·çš„æœåŠ¡é›†æˆæŠ€æœ¯å¯¹å¾®æœåŠ¡æœ€æœ‰å¸®åŠ©ï¼Œ\n4. å¦‚ä½•æŠŠä¸€ä¸ªå¤§çš„å•å—ç³»ç»Ÿåˆ†è§£æˆå¾®æœåŠ¡ï¼Œ\n5. å¦‚ä½•éƒ¨ç½²å¾®æœåŠ¡ï¼Œ\n6. å¦‚ä½•æµ‹è¯•å¾®æœåŠ¡ä»¥ç¡®ä¿è½¯ä»¶è´¨é‡ï¼Œ\n7. å¯¹äºå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¦‚ä½•ç›‘æ§ï¼Œ\n8. å¦‚ä½•å®‰å…¨çš„ä½¿ç”¨å¾®æœåŠ¡ï¼Œ\n9. ä½¿ç”¨åº·å¨å®šå¾‹è§£é‡Šå¼€å‘äººå‘˜ç»„ç»‡ç»“æ„å’Œç³»ç»Ÿè®¾è®¡çš„ç›¸äº’ç§Ÿç”¨ï¼Œ\n10. ä»‹ç»è§„æ¨¡åŒ–åå¾®æœåŠ¡é¢ä¸´çš„é—®é¢˜ä»¥åŠç¬¦åˆåº”å¯¹é—®é¢˜ã€‚\n\n\n\nè¿™ç¯‡æ–‡ç« åªæ˜¯é€‰å–ä¹¦ä¸­éƒ¨åˆ†è§‚ç‚¹æ‹¿æ¥è®¨è®ºï¼Œä¸æ˜¯æ€»ç»“å’Œæ¦‚æ‹¬ã€‚\n\n### æœ¬ä¹¦çš„ç›®å½•\n\n![å¾®æœåŠ¡è®¾è®¡.png](http://media.gusibi.mobi/B2JeYMCE2L_M5LZb_lJIODgQWBBKZluLNgop3BeRuQ0wD5xs07hdDYAdtYxcCfI3)\n\n\n\n### å¾®æœåŠ¡å®šä¹‰\n\n\nå¯¹äºå¾®æœåŠ¡ï¼Œä½œè€…å®šä¹‰ä¸ºä¸€äº›ååŒå·¥ä½œçš„å°è€Œè‡ªæ²»çš„æœåŠ¡ï¼Œâ€œå°è€Œè‡ªæ²»â€å¯ä»¥ä½¿ç”¨å•ä¸€èŒè´£åŸåˆ™æ¥è§£é‡Šï¼šæŠŠå› ç›¸åŒåŸå› è€Œå˜åŒ–çš„ä¸œè¥¿èšåˆåœ¨ä¸€èµ·ï¼Œè€ŒæŠŠå› ä¸åŒåŸå› è€Œå˜åŒ–çš„ä¸œè¥¿åˆ†ç¦»å¼€ã€‚è¿™ä¸ªåŸåˆ™ä¹Ÿå¯ä»¥ç”¨æ¥æŒ‡å¯¼å•ä¸ªæœåŠ¡çš„å¾®æœåŠ¡æ‹†åˆ†ã€‚\n\n**å¤šå°ç®—å°**ï¼š\n\næ¾³å¤§åˆ©äºšRealEstate.com.auçš„Jon Eavesè®¤ä¸ºï¼Œä¸€ä¸ªå¾®æœåŠ¡åº”è¯¥å¯ä»¥åœ¨ä¸¤å‘¨å†…å®Œå…¨é‡å†™ã€‚æœåŠ¡æ˜¯å¦å¤Ÿå°ï¼Œä½œè€…è®¤ä¸ºéœ€è¦è€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š\n\n1. æœåŠ¡è¶Šå°ï¼Œå¾®æœåŠ¡æ¶æ„çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¹Ÿå°±è¶Šæ˜æ˜¾\n2. å¾®æœåŠ¡è¶Šå°ï¼Œç‹¬ç«‹æ€§å¸¦æ¥çš„å¥½å¤„å°±è¶Šå¤šï¼Œä½†ä¹Ÿå°±è¶Šå¤æ‚\n3. å¦‚æœå¼€å‘è€…ä¸å†è§‰å¾—ä»£ç åº“è¿‡å¤§ï¼Œé‚£å°±å¯ä»¥è®¤ä¸ºè¶³å¤Ÿå°äº†ã€‚\n\n**è‡ªæ²»ï¼š**\n\nä¸€ä¸ªå¾®æœåŠ¡æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡ç½‘ç»œè°ƒç”¨è¿›è¡Œé€šä¿¡ï¼Œä»è€ŒåŠ å¼ºæœåŠ¡ä¹‹é—´çš„éš”ç¦»æ€§ï¼Œé¿å…è€¦åˆã€‚\n\n\n**å¾®æœåŠ¡çš„ä¼˜ç‚¹ï¼š**\n\n1. æŠ€æœ¯å¼‚æ„æ€§ï¼šå› ä¸ºå•ä¸ªå¾®æœåŠ¡åŠ›åº¦è¶³å¤Ÿå°ï¼Œåœ¨ç”±å¤šä¸ªå¾®æœåŠ¡ç»„æˆçš„ç³»ç»Ÿä¸­ï¼Œå¯ä»¥åœ¨ä¸åŒçš„å¾®æœåŠ¡ä¸­ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸åŒçš„è¯­è¨€ã€æ¡†æ¶ã€ä¸åŒçš„æ•°æ®åº“ç­‰ã€‚\n2. å¼¹æ€§ï¼šå¾®æœåŠ¡å¯ä»¥éƒ¨ç½²åœ¨å¤šä¸ªæœºå™¨ä¸Šæ¥é™ä½åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨çš„æ¦‚ç‡ï¼Œè¿™æ ·å½“ä¸€ä¸ªæœåŠ¡ä¸å¯ç”¨æ—¶ä¹Ÿå¯ä»¥é¿å…çº§è”æ•…éšœçš„äº§ç”Ÿã€‚\n3. æ‰©å±•ï¼šå¯ä»¥å¯¹ç‰¹å®šçš„æ¨¡å—è¿›è¡Œæ‰©å±•æˆ–ç¼©å®¹ï¼Œæ¯”å¦‚æ€§èƒ½è¦æ±‚é«˜çš„éƒ¨ç½²åœ¨æ€§èƒ½å¥½çš„æœºå™¨ä¸Šï¼Œæ€§èƒ½è¦æ±‚ä½çš„éƒ¨ç½²åœ¨æ€§èƒ½ç¨å·®çš„æœºå™¨ä¸Š\n4. ç®€åŒ–éƒ¨ç½²ï¼šéƒ¨ç½²æ—¶åªéœ€è¦éƒ¨ç½²ä¿®æ”¹çš„éƒ¨åˆ†è€Œä¸æ˜¯æŠŠæ•´ä¸ªå¤§çš„æœåŠ¡ã€‚\n5. ä¸ç»„ç»‡æ¶æ„ç›¸åŒ¹é…ï¼šä¸åŒæ¨¡å—ç”±ä¸åŒçš„äººå‘˜ç»´æŠ¤å¼€å‘\n6. å¯æ›¿ä»£æ€§ï¼šå¯¹äºå¤§çš„æœåŠ¡ï¼Œé‡æ„æ›¿ä»£æ¯”è¾ƒéš¾ï¼Œä½†æ˜¯å¾®æœåŠ¡å°±ç›¸å¯¹ç®€å•ï¼Œå¯èƒ½åªéœ€è¦å‡ å¤©å°±èƒ½å®Œæˆã€‚\n\n\nå¾®æœåŠ¡è™½ç„¶å¥½å¤„å¾ˆå¤šï¼Œä½†æ˜¯å¾®æœåŠ¡å¹¶ä¸æ˜¯æ²¡æœ‰ç¼ºç‚¹ï¼Œæ›´ä¸æ˜¯é“¶å¼¹ï¼Œä½¿ç”¨å¾®æœåŠ¡ä¹‹å‰éœ€è¦è€ƒè™‘æ¸…é™¤ã€‚\n\n### æ¶æ„å¸ˆ\n\næ¶æ„å¸ˆçš„ä¸€ä¸ªé‡è¦èŒè´£æ˜¯ç¡®ä¿å›¢é˜Ÿæœ‰å…±åŒçš„æŠ€æœ¯æ„¿æ™¯ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬å‘å®¢æˆ·äº¤ä»˜ä»–ä»¬æƒ³è¦çš„ç³»ç»Ÿã€‚\n\nä½œè€…æœ‰ä¸€ä¸ªè§‚ç‚¹ç‰¹åˆ«æœ‰æ„æ€ï¼Œä»–è®¤ä¸ºæ¶æ„å¸ˆæ˜¯å‚è€ƒå…¶å®ƒè¡Œä¸šæ¯”å¦‚å»ºç­‘å¸ˆæ¥å‘½åçš„ï¼Œä½†æ˜¯â€œæ¶æ„å¸ˆâ€å¹¶ä¸éœ€è¦åƒâ€œå»ºç­‘å¸ˆâ€é‚£æ ·éœ€è¦å¯¹è®¾è®¡ä¿è¯è¶³å¤Ÿçš„ç²¾ç¡®ï¼Œä¸”å¯¹äº§ç‰©è´Ÿæœ‰ä¸å¯æ¨å¸çš„è´£ä»»ï¼Œä½†æ˜¯è½¯ä»¶â€œæ¶æ„å¸ˆâ€å´éœ€è¦ä¿è¯è½¯ä»¶æœ‰è¶³å¤Ÿçš„çµæ´»æ€§å’Œé€‚åº”æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚è¿›è¡Œæ¼”åŒ–ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œè½¯ä»¶è®¾è®¡å¸ˆæ›´åƒæ˜¯åŸå¸‚è§„åˆ’å¸ˆï¼Œåªéœ€è¦ä¿è¯å¤§æ–¹å‘ä¸Šçš„æ­£ç¡®ï¼Œå¯¹äºæ¨¡å—å†…çš„å…·ä½“è®¾è®¡å¯ä»¥éšæœºåº”å˜ã€‚\n\n\n### æŒ‡å¯¼åŸåˆ™\n\nè½¯ä»¶è®¾è®¡çš„å…³é”®æ˜¯å–èˆï¼Œè€Œå“ªäº›å–å“ªäº›èˆå°±éœ€è¦æ»¡è¶³ä¸€äº›åŸåˆ™ï¼Œè€ŒåŸåˆ™æœ¬èº«ä¹Ÿéœ€è¦å–èˆï¼Œæœ€å¥½ä¸è¦è¶…è¿‡10æ¡ï¼Œå¦åˆ™å½“åŸåˆ™å¤ªå¤šå¯èƒ½ä¼šäº§ç”Ÿå†²çªä¹Ÿä¸ä¾¿è®°å¿†ï¼Œå¯ä»¥å‚è€ƒã€1ã€‘ https://www.12factor.net/zh_cn/ çš„12é¡¹åŸåˆ™:\n\n#### [I. åŸºå‡†ä»£ç ](https://www.12factor.net/zh_cn/codebase)\n\nä¸€ä»½åŸºå‡†ä»£ç ï¼Œå¤šä»½éƒ¨ç½²\n\n#### [II. ä¾èµ–](https://www.12factor.net/zh_cn/dependencies)\n\næ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»\n\n#### [III. é…ç½®](https://www.12factor.net/zh_cn/config)\n\nåœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®\n\n#### [IV. åç«¯æœåŠ¡](https://www.12factor.net/zh_cn/backing-services)\n\næŠŠåç«¯æœåŠ¡å½“ä½œé™„åŠ èµ„æº\n\n#### [V. æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œ](https://www.12factor.net/zh_cn/build-release-run)\n\nä¸¥æ ¼åˆ†ç¦»æ„å»ºå’Œè¿è¡Œ\n\n#### [VI. è¿›ç¨‹](https://www.12factor.net/zh_cn/processes)\n\nä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨\n\n#### [VII. ç«¯å£ç»‘å®š](https://www.12factor.net/zh_cn/port-binding)\n\né€šè¿‡ç«¯å£ç»‘å®šæä¾›æœåŠ¡\n\n#### [VIII. å¹¶å‘](https://www.12factor.net/zh_cn/concurrency)\n\né€šè¿‡è¿›ç¨‹æ¨¡å‹è¿›è¡Œæ‰©å±•\n\n#### [IX. æ˜“å¤„ç†](https://www.12factor.net/zh_cn/disposability)\n\nå¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…ç»ˆæ­¢å¯æœ€å¤§åŒ–å¥å£®æ€§\n\n#### [X. å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·](https://www.12factor.net/zh_cn/dev-prod-parity)\n\nå°½å¯èƒ½çš„ä¿æŒå¼€å‘ï¼Œé¢„å‘å¸ƒï¼Œçº¿ä¸Šç¯å¢ƒç›¸åŒ\n\n#### [XI. æ—¥å¿—](https://www.12factor.net/zh_cn/logs)\n\næŠŠæ—¥å¿—å½“ä½œäº‹ä»¶æµ\n\n#### [XII. ç®¡ç†è¿›ç¨‹](https://www.12factor.net/zh_cn/admin-processes)\n\nåå°ç®¡ç†ä»»åŠ¡å½“ä½œä¸€æ¬¡æ€§è¿›ç¨‹è¿è¡Œ\n\n\nåˆ—åŸåˆ™ç®€å•ï¼Œä½†è¦å’Œå®è·µç›¸ç»“åˆæ‰å¥½ã€‚\n\n\n### ä»€ä¹ˆæ ·çš„æœåŠ¡æ˜¯å¥½æœåŠ¡\n\n\nä½œè€…ç»™å‡ºçš„ä¸¤ä¸ªæ¦‚å¿µæ˜¯ï¼š1ã€æ¾è€¦åˆï¼›2ã€é«˜å†…èšã€‚è¿™ä¸¤ä¸ªæ¦‚å¿µä¹Ÿä¸ä»…ä»…æ˜¯å¾®æœåŠ¡çš„è®¾è®¡ç†å¿µï¼Œè€Œæ˜¯æ‰€æœ‰ç³»ç»Ÿè®¾è®¡çš„åŸºæœ¬è¦æ±‚ã€‚\n\nåšåˆ°æ¾è€¦åˆï¼Œåœ¨ä¿®æ”¹ä¸€ä¸ªæœåŠ¡çš„æ—¶å€™å°±ä¸éœ€è¦ä¿®æ”¹å¦ä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·å°±èƒ½å¤Ÿåšåˆ°ç‹¬ç«‹éƒ¨ç½²ä¸€ä¸ªæœåŠ¡è€Œä¸éœ€è¦ä¿®æ”¹ç³»ç»Ÿçš„å…¶å®ƒéƒ¨åˆ†ã€‚\n\nåšåˆ°é«˜å†…èšï¼Œä¹Ÿå°±èƒ½åœ¨éœ€è¦ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½æ—¶åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªæœåŠ¡å°±èƒ½å®ç°éœ€æ±‚ã€‚\n\n\nå¯è§ï¼Œæ¾è€¦åˆå’Œé«˜å†…èšæœ¬è´¨ä¸Šå¯ä»¥è¾¾åˆ°ç›¸åŒçš„ç›®æ ‡ã€‚\n\n\n### ä¸è¦è¿‡æ—©åˆ’åˆ†æœåŠ¡\n\n\nåœ¨æœåŠ¡æœ‰æ˜ç¡®çš„è¾¹ç•Œä¹‹å‰ï¼Œæœ€å¥½ä¸è¦åˆ’åˆ†æœåŠ¡ã€‚æ¯•ç«Ÿæ‹†åˆ†æœåŠ¡æ¯”æŠŠæœåŠ¡åˆå¹¶èµ·æ¥æ›´å®¹æ˜“ä¸€äº›ã€‚å½“ä¸€ä¸ªæœåŠ¡ä¸šåŠ¡è¾¹ç•Œé€æ¸æ˜ç¡®æ—¶ï¼Œå†æ ¹æ®ä¸šåŠ¡è¾¹ç•Œé€æ­¥æ‹†åˆ†æœåŠ¡ã€‚\n\nå¯¹äºå•ä¸ªå¤§æœåŠ¡çš„åˆ†è§£ï¼Œä¹Ÿå»ºè®®ä»åˆ†è§£æ•°æ®åº“å¼€å§‹ï¼Œå°†æ‚ä¹±çš„ä¾èµ–ç†æ¸…ã€‚\n\n\n### æœåŠ¡çš„é›†æˆ\n\n\nå¤šä¸ªæœåŠ¡çš„é›†æˆæœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚å…±äº«æ•°æ®åº“ã€RESTè°ƒç”¨ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚åŒæ—¶æœåŠ¡é—´è°ƒç”¨ä¹Ÿæœ‰åŒæ­¥è°ƒç”¨å’Œå¼‚æ­¥è°ƒç”¨ä¸¤ç§æ–¹å¼ã€‚è¿™ä¸¤ç§æ–¹å¼å„æœ‰å„çš„å¥½å¤„ï¼Œä¸åŒåœºæ™¯å¯èƒ½éœ€è¦é€‰æ‹©ä¸åŒçš„è°ƒç”¨æ–¹å¼ã€‚\n\nå¦‚æœä½¿ç”¨åŒæ­¥æœåŠ¡ï¼Œå‘èµ·ä¸€ä¸ªè°ƒç”¨åè°ƒç”¨æ–¹ä¼šé˜»å¡è‡ªå·±å¹¶ç­‰å¾…æ•´ä¸ªæ“ä½œçš„å®Œæˆï¼›å¦‚æœä½¿ç”¨å¼‚æ­¥é€šä¿¡ï¼Œè°ƒç”¨æ–¹ä¸éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆåå°±å¯ä»¥è¿”å›ï¼Œç”šè‡³å¯èƒ½ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªæ“ä½œæ˜¯å¦å®Œæˆã€‚é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼å°±éœ€è¦ä¿è¯å¼‚æ­¥è°ƒç”¨çš„å¯é æ€§ï¼ˆæ¯”å¦‚å¤±è´¥äº†æ€ä¹ˆå¤„ç†ï¼Œå¼‚æ­¥ä»»åŠ¡éœ€è¦ä¿è¯å¹‚ç­‰ï¼‰ã€‚\n\n\n### æœåŠ¡éƒ¨ç½²\n\n\næœåŠ¡æ‹†åˆ†åï¼ŒæœåŠ¡çš„æ•°é‡å¯èƒ½ä¼šæ˜¯åŸæ¥çš„å‡ å€ã€å‡ åå€ï¼Œå¯èƒ½ä¸€ä¸ªéœ€æ±‚çš„æ”¹åŠ¨ä¼šè®¾è®¡å‡ ä¸ªæˆ–è€…æ›´å¤šçš„æœåŠ¡éƒ¨ç½²ï¼Œè¿™æ—¶æœåŠ¡çš„éƒ¨ç½²å°±ä¼šå˜æˆä¸€ä¸ªæ— æ³•é¿å…çš„é—®é¢˜ã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯å°†æŒç»­é›†æˆæ˜ å°„åˆ°æœåŠ¡ï¼Œåœ¨ä»£ç ä¿®æ”¹åé€šè¿‡é…ç½®è‡ªåŠ¨éƒ¨ç½²ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯å¯èƒ½éœ€è¦å¯¹ä¸åŒçš„æœåŠ¡å®šåˆ¶åŒ–ä¸åŒçš„é•œåƒï¼Œdockeræ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚\n\n\n### æµ‹è¯•\n\n\nã€Šæ•æ·è½¯ä»¶æµ‹è¯•ã€‹ä¸€ä¹¦æ›¾æŠŠæµ‹è¯•åˆ†ä¸ºä»¥ä¸‹å››ä¸ªè±¡é™ã€‚\n\n![æµ‹è¯•çš„è±¡é™.jpeg](http://media.gusibi.mobi/F3T-K3q0Y0Ncv10AZyODaMFBHaGj1F4DHL84CMGX4stcm_2p0VB-Y2y4iE-X5zNe)\n\nå¤„äºè±¡é™åº•éƒ¨çš„æ˜¯é¢å‘æŠ€æœ¯çš„æµ‹è¯•ï¼Œå³é‚£äº›é¦–å…ˆèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜æ„å»ºç³»ç»Ÿçš„æµ‹è¯•ã€‚è¿™ä¸ªè±¡é™ä¸­çš„æµ‹è¯•é€šå¸¸æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–çš„ï¼Œæ¯”å¦‚æ€§èƒ½æµ‹è¯•å’Œå•å…ƒæµ‹è¯•ï¼ˆå…³äºå•å…ƒæµ‹è¯•å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€Šå­¦ä¹ å•å…ƒæµ‹è¯•ï¼Œå‘Šåˆ«ç¥ˆç¥·å¼ç¼–ç¨‹ã€‹ã€2ã€‘https://mp.weixin.qq.com/s/oD96OEv92oX0ypAYLbYFyAï¼‰ã€‚\n\nå¤„äºè±¡é™ä¸Šæ–¹çš„æµ‹è¯•åˆ™æ˜¯å¸®åŠ©éæŠ€æœ¯èƒŒæ™¯çš„ç›¸å…³äººç¾¤ï¼Œäº†è§£ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è¿™ç§æµ‹è¯•åŒ…æ‹¬è±¡é™å·¦ä¸Šè§’çš„å¤§èŒƒå›´ã€ç«¯åˆ°ç«¯çš„éªŒæ”¶æµ‹è¯•ï¼Œè¿˜æœ‰è±¡é™å³ä¸Šè§’çš„ç”±ç”¨æˆ·æ¥è¿›è¡Œçš„åœ¨UATç³»ç»Ÿä¸Šè¿›è¡Œæ‰‹å·¥éªŒè¯çš„æ¢ç´¢æ€§æµ‹è¯•ã€‚\n\næµ‹è¯•æ˜¯å¾®æœåŠ¡ç³»ç»Ÿçš„ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œå¦‚æœåœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­è¿˜æœ‰å¤§é‡çš„æ‰‹å·¥æµ‹è¯•ï¼Œå¯èƒ½è®©ç³»ç»Ÿç¨³å®šè¿è¡Œä¼šå˜æˆä¸€ä¸ªæŒ‘æˆ˜ã€‚\n\n\nã€ŠScrumæ•æ·è½¯ä»¶å¼€å‘ã€‹ä¸­æåˆ°äº†æµ‹è¯•é‡‘å­—å¡”çš„æ¦‚å¿µï¼Œæµ‹è¯•é‡‘å­—å¡”å¦‚ä¸‹æ‰€ç¤º\n\n\n![æµ‹è¯•çš„èŒƒå›´.jpeg](http://media.gusibi.mobi/48bhFMXZNQ3CGiz3p6lK7SUKBMj-WBgSx1owQG7ccJ7oCyR53hz1yxy7g6Hwkt9_)\n\nä¸»è¦ç”±å•å…ƒæµ‹è¯•ã€æœåŠ¡æµ‹è¯•å’Œç”¨æˆ·ç•Œé¢æµ‹è¯•ä¸‰å±‚ã€‚è¿™å¼ å›¾å’Œä¸Šä¸€å¼ è±¡é™å›¾æœ‰å¼‚æ›²åŒå·¥çš„ä½œç”¨ï¼Œéƒ½æ˜¯å°†æµ‹è¯•åˆ†ä¸ºå¤šä¸ªå±‚ã€‚\n\n\n### ç›‘æ§\n\n\n\næœ‰è¿‡bugä¿®å¤ç»éªŒçš„äººéƒ½çŸ¥é“ï¼Œåœ¨åªæœ‰ä¸€ä¸ªæœåŠ¡çš„æ—¶å€™ï¼Œç›‘æ§æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œé‡åˆ°é—®é¢˜åªéœ€è¦åˆ°æœåŠ¡æ‰€åœ¨å®¹å™¨æˆ–è€…æœºå™¨æŸ¥çœ‹é”™è¯¯å³å¯ã€‚ä½†å¦‚æœç³»ç»Ÿæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Œç‰¹åˆ«æ˜¯è°ƒç”¨é“¾æœ‰å¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œå®šä½é”™è¯¯å°±å˜æˆäº†ä¸€ä¸ªä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚æ­¤æ—¶ï¼Œç›‘æ§å·¥å…·å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚\n\n\n\næ—¥å¿—ã€å…¨é“¾è·¯è¿½è¸ªå·¥å…·æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚\n\n\n\n### å®‰å…¨\n\n\n\nå¯¹äºå¾®æœåŠ¡çš„å®‰å…¨ï¼Œå®Œå…¨åŒæ„ä½œè€…çš„è§‚ç‚¹\n\n1. **ä¸è¦å®ç°è‡ªå·±çš„åŠ å¯†ç®—æ³•ã€‚ä¸è¦å‘æ˜è‡ªå·±çš„å®‰å…¨åè®®ã€‚**\n2. **ä¸è¦å®ç°è‡ªå·±çš„åŠ å¯†ç®—æ³•ã€‚ä¸è¦å‘æ˜è‡ªå·±çš„å®‰å…¨åè®®ã€‚**\n3. **ä¸è¦å®ç°è‡ªå·±çš„åŠ å¯†ç®—æ³•ã€‚ä¸è¦å‘æ˜è‡ªå·±çš„å®‰å…¨åè®®ã€‚**\n\né‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚\n\n\n\n### åº·å¨å®šå¾‹\n\n\n\næ¢…å°” Â·åº·å¨äº1968å¹´4æœˆåœ¨Datamationæ‚å¿—ä¸Šå‘è¡¨äº†ä¸€ç¯‡åä¸ºâ€œHow Do Committees Inventâ€çš„è®ºæ–‡ï¼Œæ–‡ä¸­æŒ‡å‡ºï¼š\n\n**ä»»ä½•ç»„ç»‡åœ¨è®¾è®¡ä¸€å¥—ç³»ç»Ÿï¼ˆå¹¿ä¹‰æ¦‚å¿µä¸Šçš„ç³»ç»Ÿï¼‰æ—¶ï¼Œæ‰€äº¤ä»˜çš„è®¾è®¡æ–¹æ¡ˆåœ¨ç»“æ„ä¸Šéƒ½ä¸è¯¥ç»„ç»‡çš„æ²Ÿé€šç»“æ„ä¿æŒä¸€è‡´ã€‚**\n\nè¿™å¥è¯è¢«ç§°ä¸ºåº·å¨å®šå¾‹ã€‚å¯ä»¥ç”¨åŸƒé‡Œå…‹ Â· Sï¼é›·è’™å¾·åœ¨ã€Šæ–°é»‘å®¢å­—å…¸ã€‹ä¸­å®šä¹‰æ€»ç»“ï¼šâ€œå¦‚æœä½ æœ‰å››ä¸ªå°ç»„å¼€å‘ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œé‚£ä½ ä¼šå¾—åˆ°ä¸€ä¸ªå››æ­¥ç¼–è¯‘å™¨ã€‚â€\n\n\n\næ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªç»„ç»‡çš„è€¦åˆåº¦éå¸¸ä½ï¼Œå…¶åˆ›å»ºçš„ç³»ç»Ÿçš„æ¨¡å—åŒ–å°±è¶Šå¥½ï¼Œè€¦åˆä¹Ÿè¶Šä½ï¼›ç»„ç»‡çš„è€¦åˆåº¦è¶Šé«˜ï¼Œå…¶åˆ›å»ºçš„ç³»ç»Ÿçš„æ¨¡å—åŒ–ä¹Ÿè¶Šå·®ã€‚\n\n\n\nåº·å¨å®šå¾‹ä¸»è¦å¼ºè°ƒç³»ç»Ÿè®¾è®¡å’Œç»„ç»‡ç»“æ„ä¸åŒ¹é…å¯èƒ½ä¼šå¯¼è‡´å±é™©ï¼Œè¿™å¼•å¯¼ç»„ç»‡å°†æœåŠ¡æ‰€æœ‰æƒä¸å›¢é˜Ÿç›¸åŒ¹é…ã€‚\n\n\n\n### è§„æ¨¡åŒ–\n\n\n\nä¸€æ—¦è§„æ¨¡åŒ–ä¹‹åï¼ŒæœåŠ¡å°±ä¼šä¸å¯é¿å…çš„å‡ºç°é—®é¢˜ï¼Œç°åœ¨æ²¡æœ‰ä»»ä½•ä¸€ä¸ªæœåŠ¡æ•¢ä¿è¯è‡ªå·±çš„æœåŠ¡100%å¯ç”¨ï¼Œ 99.999%å¯ç”¨æ€§ å·²ç»æ˜¯ä¸€ä¸ªäº†ä¸èµ·çš„æ•°æ®ï¼ˆä½†å³ä½¿è¿™æ ·å½“æœåŠ¡è¶…è¿‡10wæ—¶ï¼Œä¹Ÿæ€»æœ‰ä¸€å°æœºå™¨æ˜¯ä¸å¯ç”¨çš„ï¼‰ã€‚æ‰€ä»¥ï¼Œè§„æ¨¡åŒ–åï¼Œå³ä½¿ä½ ä¹°æœ€å¥½çš„å·¥å…·ï¼Œæœ€æ˜‚è´µçš„ç¡¬ä»¶ï¼Œä¹Ÿæ— æ³•é¿å…å®ƒä»¬ä¼šå‘ç”Ÿæ•…éšœçš„äº‹å®ã€‚\n\nä¸å…¶æŠŠæ—¶é—´æ”¾åˆ°å¦‚ä½•é¿å…æœåŠ¡å‡ºé”™è¿˜ä¸å¦‚æŠŠæ—¶é—´æ”¾åˆ°å¦‚ä½•å¿«é€Ÿä¿®å¤ç³»ç»Ÿä¸Šã€‚\n\n\n\n### CAPå®šç†\n\n\n\nåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ä¸‰æ–¹é¢éœ€è¦å½¼æ­¤æƒè¡¡ï¼šä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆavailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆpartition toleranceï¼‰ã€‚å…·ä½“åœ°è¯´ï¼Œè¿™ä¸ªå®šç†å‘Šè¯‰æˆ‘ä»¬æœ€å¤šåªèƒ½ä¿è¯ä¸‰ä¸ªä¸­çš„ä¸¤ä¸ªã€‚\n\n\n\nå…·ä½“å‚è€ƒï¼šé˜®ä¸€å³°ã€ŠCAP å®šç†çš„å«ä¹‰ã€‹ã€3ã€‘https://ruanyifeng.com/blog/2018/07/cap.html\n\n\n\n### å…¶å®ƒæœ‰æ„æ€çš„äº‹æƒ…\n\n\n\nâ€œä¸¤ä¸ªæŠ«è¨å›¢é˜Ÿâ€ï¼ˆæ²¡æœ‰ä¸€ä¸ªå›¢é˜Ÿåº”è¯¥å¤§åˆ°ä¸¤ä¸ªæ¯”è¨ä¸å¤Ÿåƒï¼‰ã€‚\n\nå¦‚æœä¸çŸ¥é“æ€ä¹ˆæ‹†åˆ†å¾®æœåŠ¡ï¼Œå°±å…ˆæ„å»ºå•ä¸ªæœåŠ¡å§ã€‚\n\n\n\n\n\n### æ€»ç»“\n\n![å¾®æœåŠ¡çš„åŸåˆ™.jpeg](http://media.gusibi.mobi/ClNFWVAh-uvMAYNfA-KHgoqvQW0ati71dUxJTcT8uocm4Sm9vglmSPYxXgPGv5cT)\n\n\n\nä¸è¦å®ç°è‡ªå·±çš„åŠ å¯†ç®—æ³•åº“ã€‚ä¹Ÿä¸åº”è¯¥å®ç°è‡ªå·±çš„åˆ†å¸ƒå¼åè°ƒç³»ç»Ÿã€‚ä½¿ç”¨å·²æœ‰çš„å¯å·¥ä½œçš„é€‰æ‹©æ˜¯éå¸¸æ˜æ™ºçš„ã€‚\n\n\n\n### å‚è€ƒé“¾æ¥\n\n\n\n- ã€1ã€‘https://www.12factor.net/zh_cn/\n- ã€2ã€‘ã€Šå­¦ä¹ å•å…ƒæµ‹è¯•ï¼Œå‘Šåˆ«ç¥ˆç¥·å¼ç¼–ç¨‹ã€‹ã€https://mp.weixin.qq.com/s/oD96OEv92oX0ypAYLbYFyA\n- ã€3ã€‘ã€ŠCAP å®šç†çš„å«ä¹‰ã€‹https://ruanyifeng.com/blog/2018/07/cap.html\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/WDz3v4cU4LQq1oyKX-fYK1LxIThzZ1hK931ZaPRC8CdcB0t2oTYJciMDuAws70FY)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "ã€Šå¾®æœåŠ¡è®¾è®¡ã€‹è¯»ä¹¦ç¬”è®°",
        "date": "2020-06-26 09:23:49",
        "tags": [
          "å¾®æœåŠ¡",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "microservices_design"
    },
    {
      "content": "\n\n> ä¸Šä¸€ç¯‡ä»‹ç»äº†Flutter å®‰è£…é…ç½® ç›¸å…³å†…å®¹ï¼Œæ¥ä¸‹æ¥è¿™ä¸€ç¯‡å…ˆæ–°æ¥ä¸€ä¸ªç¤ºä¾‹ä»‹ç»ä¸€ä¸‹Flutteré¡¹ç›®çš„åŸºæœ¬ç»“æ„ã€‚\n\n\n### æ–°å»ºé¡¹ç›®\n\n\n\n1. æ‰“å¼€ç¼–è¾‘å™¨ï¼ˆè¿™é‡Œä»¥IntelliJ IDEAä¸ºä¾‹ï¼ŒAndroid StudioåŸºæœ¬ä¸€è‡´ï¼‰\n2. File>New>Projectï¼Œé€‰æ‹©Flutter é¡¹ç›®\n\n\n\n![æˆªå±2020-06-21 ä¸Šåˆ9.27.06.png](http://media.gusibi.mobi/dGPyk4Ns6SXdcofOPiVnCFFQVB_5KDhmH2Sve9aJVqSKMM4L4wKYNMrA9WEqryKr)\n\nNext å¡«å†™é¡¹ç›®ç›¸å…³å†…å®¹ï¼ŒOrganization è¿™é‡Œé€šå¸¸å»ºè®®æ˜¯åŸŸå€’å†™.\n\n![æˆªå±2020-06-21 ä¸Šåˆ9.29.01.png](http://media.gusibi.mobi/i_IjC0yQntSYtqBN_T3IZrIVHJvdrE270FBIQv4efgVrKydlwabV-mVYhlDBorzg)\n\nå¡«å†™å®Œæ¯•ç‚¹å‡»FINISHï¼Œå°†ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç¤ºä¾‹é¡¹ç›®ã€‚\n\n![æˆªå±2020-06-21 ä¸Šåˆ9.29.24.png](http://media.gusibi.mobi/A5sMHWavEsRD58OpTp1Wm4St-nhW4Llfq3f0wny9HjRu6sep9NHIj0iyWs50hOYY)\n\n1. æ‰“å¼€æ¨¡æ‹Ÿå™¨ï¼šç‚¹å‡»ä¸Šæ–¹èœå•æ ï¼Œé€‰æ‹©æ¨¡æ‹Ÿå™¨ï¼ˆè¿™é‡Œé€‰æ‹©iOS æ¨¡æ‹Ÿå™¨ï¼‰\n\n![æˆªå±2020-06-21 ä¸Šåˆ9.30.00.png](http://media.gusibi.mobi/jxTB2M2NfYI4Xv7RjUYbDcbFa-CSb_1RV7b-0Aw-6_ZwIlWqIei1uA54ZLIg9zPE)\n\nç‚¹å‡»åï¼ŒiOSæ¨¡æ‹Ÿå™¨ä¼šå¯åŠ¨ï¼Œä½†æ˜¯è¿˜éœ€è¦å†é€‰æ‹©è®¾å¤‡\n\n![æˆªå±2020-06-21 ä¸Šåˆ9.33.37.png](http://media.gusibi.mobi/IBuKm-DNtEapZpYbnGRu2JKD0kuXm3jHqyMOB1OGom5H_c84U9wmQdadz0ZC47MS)\n\n\nå¯åŠ¨åç•Œé¢å¦‚ä¸‹ï¼š\n\n\n![æˆªå±2020-06-21 ä¸Šåˆ9.33.50.png](http://media.gusibi.mobi/pkkAFSa4UBv7xqRPgs2Yp4-o0whml1MKlbl53C0msalQGPoRQb2ublKnVH8tM0xZ)\n\n\n\n\n\nç°åœ¨å¯ä»¥ç‚¹å‡»èœå•æ ä¸Šæ–¹è¿è¡Œé¡¹ç›®ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹\n\n\n\n```shell\nLaunching lib/main.dart on iPhone 11 in debug mode...\nRunning Xcode build...\nXcode build done.                                           46.6s\nDebug service listening on ws://127.0.0.1:61858/TQG1yn-Cjq0=/ws\nSyncing files to device iPhone 11...\n```\n\nç°åœ¨ä¸€ä¸ªç®€å•çš„é¡¹ç›®å°±å¯åŠ¨å®Œæ¯•ã€‚\n\n![Simulator Screen Shot - iPhone 11 - 2020-06-21 at 09.35.48.png](http://media.gusibi.mobi/UXwr5FZ8T9BH1ZyT4rqcGb6F3uJrSf0_5MVjL4Pm_OpxhB9N4BxvIfxuVmm0a-Yh)\n\n\n\nç¬¬ä¸€æ¬¡çœŸæœºè¿è¡Œçš„æ—¶å€™å¯èƒ½ä¼šéœ€è¦æ›´å¤šçš„ç­‰å¾…æ—¶é—´ï¼Œä½†æ˜¯æ¥ä¸‹æ¥ä½ å°±å¯ä»¥ä½¿ç”¨çƒ­é‡è½½ï¼ˆhot reloadï¼‰åŠŸèƒ½ï¼Œçƒ­é‡è½½å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ–°é¢„è§ˆã€‚\n\n\n\n### é¡¹ç›®ç›®å½•\n\n\n\n```shell\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ android\nâ”œâ”€â”€ build\nâ”œâ”€â”€ hello_world.iml\nâ”œâ”€â”€ ios\nâ”œâ”€â”€ lib\nâ”œâ”€â”€ pubspec.lock\nâ”œâ”€â”€ pubspec.yaml\nâ””â”€â”€ test\n```\n\nä¸»è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶/ç›®å½•ï¼š\n\n| **æ–‡ä»¶/ç›®å½•** | **æè¿°**                                                  |\n| ------------- | --------------------------------------------------------- |\n| android       | android å¹³å°ç›¸å…³ä»£ç                                       |\n| ios           | iOSå¹³å°ç›¸å…³ä»£ç                                            |\n| lib           | flutter åº”ç”¨ä»£ç ï¼Œç¼–å†™çš„ä»£ç åœ¨æ­¤ç›®å½•                      |\n| test          | æµ‹è¯•ç›¸å…³ä»£ç                                               |\n| pubspec.yaml  | ç®¡ç† Flutter åº”ç”¨ç¨‹åºçš„ assetsï¼ˆèµ„æºï¼Œå¦‚å›¾ç‰‡ã€packageç­‰ï¼‰ |\n\n\n\n### ä»£ç ä»‹ç»\n\n\n\n```javascript\nimport 'package:flutter/material.dart';\n\nvoid main() => runApp(MyApp());\n\n// MyApp ä¸éœ€è¦åšçŠ¶æ€ç®¡å¤„ç†ï¼Œæ­¤ç»„ä»¶ç»§æ‰¿StatelessWidget å³å¯\nclass MyApp extends StatelessWidget {\n  // This widget is the root of your application.\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      title: 'Flutter Demo',\n      theme: ThemeData(\n        primarySwatch: Colors.blue,\n        visualDensity: VisualDensity.adaptivePlatformDensity,\n      ),\n      home: MyHomePage(title: 'Flutter Demo Home Page'),\n    );\n  }\n}\n\nclass MyHomePage extends StatefulWidget {\n  MyHomePage({Key key, this.title}) : super(key: key);\n\n  final String title;\n\n  @override\n  _MyHomePageState createState() => _MyHomePageState(); // é‡å†™\n}\n\n// çŠ¶æ€ç±»å¿…é¡»ç»§æ‰¿è‡ª Stateç±»\nclass _MyHomePageState extends State<MyHomePage> {\n  int _counter = 0; // å®šä¹‰ä¸€ä¸ªå˜é‡ _counter ä½œä¸ºè®¡æ•°å™¨å˜é‡ï¼Œè°ƒç”¨ setState æ–¹æ³•æ¥æ§åˆ¶è¿™ä¸ªå˜é‡çš„å€¼å˜åŒ–\n\n  void _incrementCounter() {\n    setState(() {\n      _counter++;\n    });\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        // Here we take the value from the MyHomePage object that was created by\n        // the App.build method, and use it to set our appbar title.\n        title: Text(widget.title),\n      ),\n      body: Center(\n        // Center is a layout widget. It takes a single child and positions it\n        // in the middle of the parent.\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: <Widget>[\n            Text(\n              'You have clicked the button this many times:',\n            ),\n            Text(\n              '$_counter',\n              style: Theme.of(context).textTheme.headline4,\n            ),\n          ],\n        ),\n      ),\n      floatingActionButton: FloatingActionButton(\n        onPressed: _incrementCounter,\n        tooltip: 'Increment',\n        child: Icon(Icons.add),\n      ), // This trailing comma makes auto-formatting nicer for build methods.\n    );\n  }\n}\n```\n\n\n\n- ä»£ç ç¬¬ä¸€è¡Œå¼•å…¥äº† material.dart åŒ…ï¼Œä½¿ç”¨æ­¤åŒ…ï¼Œæ¨¡æ¿ä»£ç åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ Material Design é£æ ¼çš„åº”ç”¨ï¼ˆ [Material](https://material-io.cn/guidelines) æ˜¯ä¸€ç§ç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯é€šç”¨çš„è§†è§‰è®¾è®¡è¯­è¨€ï¼Œ Flutter æä¾›äº†ä¸°å¯Œçš„ Material é£æ ¼çš„ widgetsã€‚\n- `void main() => runApp(MyApp());` ä¸»å‡½æ•°ï¼ˆmainï¼‰ä½¿ç”¨äº† (`=>`) ç¬¦å·ï¼Œè¿™æ˜¯ Dart ä¸­å•è¡Œå‡½æ•°æˆ–æ–¹æ³•çš„ç®€å†™ï¼Œç­‰åŒäºä¸‹å±ä»£ç \n\n```dart\nvoid main() {\n  runApp(MyApp());\n}\n```\n\nflutter é¡¹ç›®éƒ½éœ€è¦åœ¨å¼€å§‹çš„æ—¶å€™æ‰§è¡Œmain å‡½æ•°ï¼Œä½¿ç”¨runApp() å‡½æ•°å¯ä»¥è®²ç»™å®šçš„æ ¹ç»„ä»¶å¡«æ»¡æ•´ä¸ªå±å¹•ã€‚ï¼ˆå¦‚æœä¸è°ƒç”¨runApp() å‡½æ•°ï¼Œé¡¹ç›®ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯å±å¹•ä¸Šä»€ä¹ˆéƒ½ä¸ä¼šæ˜¾ç¤ºã€‚\n\n\n\n#### çŠ¶æ€ç®¡ç†\n\n\n\n\n\n- è¯¥åº”ç”¨ç¨‹åºç»§æ‰¿äº† `StatelessWidget`ï¼Œè¿™å°†ä¼šä½¿åº”ç”¨æœ¬èº«ä¹Ÿæˆä¸ºä¸€ä¸ª widgetã€‚åœ¨ Flutter ä¸­ï¼Œå‡ ä¹æ‰€æœ‰éƒ½æ˜¯ widgetï¼ŒåŒ…æ‹¬å¯¹é½ (alignment)ã€å¡«å…… (padding) å’Œå¸ƒå±€ (layout)ã€‚\n- **State*****less\\*** **widgets æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„å±æ€§ä¸èƒ½æ”¹å˜ â€”â€” æ‰€æœ‰çš„å€¼éƒ½æ˜¯ finalã€‚**\n- **State*****ful\\*** **widgets æŒæœ‰çš„çŠ¶æ€å¯èƒ½åœ¨ widget ç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿå˜åŒ–ï¼Œå®ç°ä¸€ä¸ª stateful widget è‡³å°‘éœ€è¦ä¸¤ä¸ªç±»ï¼š**\n\n- -  1ï¼‰ä¸€ä¸ª StatefulWidget ç±»ï¼Œæœ¬èº«æ˜¯ä¸å¯å˜çš„\n  - 2ï¼‰ä¸€ä¸ª State ç±»ï¼Œä½†æ˜¯ State ç±»åœ¨ widget ç”Ÿå‘½å‘¨æœŸä¸­å§‹ç»ˆå­˜åœ¨ã€‚\n\n\n\n- MyHomePage ç±»æ˜¯ä¸€ä¸ªStateful widgetsï¼ˆæœ‰çŠ¶æ€çš„ widgetï¼‰\n\n- - å¿…é¡»ç»§æ‰¿è‡ª**StatefulWidget**\n  - å®ƒåˆ›å»ºè‡ªå·±çš„çŠ¶æ€ç±» â€”â€” _MyHomePageStateï¼Œå¹¶å°† MyHomePage å†…åµŒåˆ°å·²æœ‰çš„æ— çŠ¶æ€çš„ `MyApp` widgetã€‚\n  - éœ€è¦é‡å†™createState æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```dart\n@override\n_MyHomePageState createState() => _MyHomePageState();\n```\n\n\n\n\n\n- `Scaffold` æ˜¯ Material åº“ä¸­æä¾›çš„ä¸€ä¸ª widgetï¼Œå®ƒæä¾›äº†é»˜è®¤çš„å¯¼èˆªæ ã€æ ‡é¢˜å’ŒåŒ…å«ä¸»å±å¹• widget æ ‘çš„ body å±æ€§ã€‚\n\n- - ç°åœ¨åœ¨Scaffold ä¸­æ·»åŠ  backgroundColor: Colors.amber\n\n```dart\nWidget build(BuildContext context) {\n    return Scaffold(\n      ...\n      backgroundColor: Colors.amber,\n      ...\n    );\n  }\n```\n\nä¿å­˜ä»£ç åï¼Œé¡µé¢åº”è¯¥ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œç»“æœå¦‚ä¸‹ï¼š\n\n\n![Simulator Screen Shot - iPhone 11 - 2020-06-21 at 17.41.29.png](http://media.gusibi.mobi/a5RewdDN10105G5S_vJ0Kc1W9UdEp2MIBit_ALAK6ldckaBix7SlOj3wpR6n1FZz)\n\nå¦‚æœè‡ªåŠ¨ä¿å­˜åé¡µé¢æ²¡æœ‰è‡ªåŠ¨é‡è½½ï¼Œå¯ä»¥ç‚¹å‡»ä¸‹å›¾çº¢åœˆä¸­æŒ‰é’®æŸ¥çœ‹æ›´æ–°åç»“æœã€‚\n\n![æˆªå±2020-06-21 ä¸Šåˆ9.36.57.png](http://media.gusibi.mobi/NdtaTSTSLDhz4bjlRtATlliCBSKOeBgmFH_1bDKu2lSKYqBQ9FDTMSSpgZhcTdSO)\n\n\n\n- ä¸€ä¸ª widget çš„ä¸»è¦å·¥ä½œæ˜¯æä¾›ä¸€ä¸ª `build()` æ–¹æ³•æ¥æè¿°å¦‚ä½•æ ¹æ®å…¶ä»–è¾ƒä½çº§åˆ«çš„ widgets æ¥æ˜¾ç¤ºè‡ªå·±ã€‚\n- æœ¬ç¤ºä¾‹ä¸­çš„ body çš„ widget æ ‘ä¸­åŒ…å«äº†ä¸€ä¸ª `Center` widgetï¼Œ Center widget åˆåŒ…å«ä¸€ä¸ª `Text` å­ widgetï¼Œ Center widget å¯ä»¥å°†å…¶å­ widget æ ‘å¯¹é½åˆ°å±å¹•ä¸­å¿ƒã€‚\n\n\n\n### ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…\n\n\n\nç°åœ¨è¿™ä¸ªæ¨¡æ¿ä»£ç æ¯”è¾ƒç®€å•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ‰©å±•ä¸€ä¸‹ï¼Œåœ¨pubspec.yaml ä¸­ï¼Œå°† english_wordsï¼ˆ3.1.5 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰æ·»åŠ åˆ°ä¾èµ–é¡¹åˆ—è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\nåœ¨ ç¼–è¾‘å™¨è§†å›¾ä¸­æŸ¥çœ‹ `pubspec.yaml` æ–‡ä»¶æ—¶ï¼Œç‚¹å‡» **Pub get** ä¼šå°†ä¾èµ–åŒ…å®‰è£…åˆ°ä½ çš„é¡¹ç›®ã€‚ä½ åº”è¯¥ä¼šåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š\n\n\n\n```shell\nRunning \"flutter pub get\" in hello_world...                         0.6s\nProcess finished with exit code 0\n```\n\nåœ¨æ‰§è¡Œ `Pub get` å‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸º `pubspec.lock` æ–‡ä»¶ï¼Œè¿™é‡ŒåŒ…å«äº†ä½ ä¾èµ– packages çš„åç§°å’Œç‰ˆæœ¬ã€‚\n\n\n\nç„¶ååœ¨lib/main.dart ä»£ç ç¬¬äºŒè¡ŒåŠ å…¥ import 'package:english_words/english_words.dart';\n\n\n\nå¦‚æœä½ å°è¯•çƒ­é‡è½½ï¼Œåˆ™å¯èƒ½ä¼šçœ‹åˆ°ä¸€æ¡è­¦å‘Šï¼Œè€ƒè™‘é‡æ–°å¯åŠ¨å½“å‰åº”ç”¨ï¼š\n\n\n\n```shell\nReloadingâ€¦\nSome program elements were changed during reload but did not run when the view was reassembled; \nyou might need to restart the app (by pressing â€œRâ€) for the changes to have an effect.\n```\n\n\n\n\n\n\n\nå› ä¸ºé‡å¯åº”ç”¨ä¹‹åå°±å¯ä»¥ç”Ÿæ•ˆï¼Œæ•…è¿™å¯èƒ½æ˜¯è¯¯æŠ¥ã€‚ç°åœ¨åªéœ€ç‚¹å‡»build æŒ‰é’®é‡æ–°buildã€‚\n\n\n\nä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n```dart\nclass _MyHomePageState extends State<MyHomePage> {\n  int _counter = 0;\n\n  void _incrementCounter() {\n    setState(() {\n      _counter++;\n    });\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    final wordPair = WordPair.random();\n    return Scaffold(\n      ...\n      body: Center(\n        // Center is a layout widget. It takes a single child and positions it\n        // in the middle of the parent.\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: <Widget>[\n            Text(\n              'You have clicked the button this many times:',\n            ),\n            Text(\n              '$_counter',\n              style: Theme.of(context).textTheme.headline4,\n            ),\n            Text(\n              'Words Pair:' + wordPair.asPascalCase,\n            ),\n          ],\n        ),\n      ),\n      ...\n  }\n}\n```\n\n\n\n### ![Simulator Screen Shot - iPhone 11 - 2020-06-21 at 18.23.27.png](http://media.gusibi.mobi/NvWnrQJRvVTBmWz1S76ZyzyJ9Ey0ANcubkNjw6S9Pmh9bUeQbEb4HvZiL36dnMaU)\n\n\næ­¤æ—¶ç‚¹å‡»å³ä¸‹è§’çš„æŒ‰é’®ï¼Œæ•°å­—ä¼šå¢åŠ ï¼Œå•è¯å¯¹ä¹Ÿä¼šæ›´æ–°ã€‚\n\n\n### å‚è€ƒé“¾æ¥\n\n1. https://flutter.cn/docs/cookbook/design/themes\n2. https://flutter.cn/docs/get-started/codelab\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/WDz3v4cU4LQq1oyKX-fYK1LxIThzZ1hK931ZaPRC8CdcB0t2oTYJciMDuAws70FY)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "Flutter ç®€æ˜æ•™ç¨‹ï¼šä»é›¶åˆ›å»ºä¸€ä¸ªflutter é¡¹ç›®",
        "date": "2020-06-21 09:07:20",
        "tags": [
          "Flutter",
          "å‰ç«¯",
          "æ•™ç¨‹"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "flutter-01-first-demo"
    },
    {
      "content": "\n## å®‰è£…\n\n1. ä¸‹è½½SDKï¼š\n\n1. 1. Windows SDKï¼š[Stable 1.17.3](https://storage.flutter-io.cn/flutter_infra/releases/stable/windows/flutter_windows_1.17.3-stable.zip)\n   2. macOS SDKï¼š[Stable 1.17.3](https://storage.flutter-io.cn/flutter_infra/releases/stable/macos/flutter_macos_1.17.3-stable.zip)\n   3. Linux SDKï¼š[Stable 1.17.3](https://storage.flutter-io.cn/flutter_infra/releases/stable/linux/flutter_linux_1.17.3-stable.tar.xz)\n   4. å…¶å®ƒç‰ˆæœ¬åˆ—è¡¨ï¼š[SDK ç‰ˆæœ¬åˆ—è¡¨](https://flutter.cn/docs/development/tools/sdk/archive)[2]\n\n\n\n1. å°†æ–‡ä»¶è§£å‹åˆ°ç›®æ ‡è·¯å¾„, æ¯”å¦‚:\n\n```shell\ncd ~/flutter\nunzip ~/Downloads/flutter_macos_1.17.3-stable.zip\n```\n\n\n\nä¹Ÿå¯ä»¥ä»Githubä¸Šè·å–æºä»£ç ï¼š\n\n```shell\ngit clone https://github.com/flutter/flutter.git\n```\n\n\n\n1. é…ç½® `flutter` çš„ PATH ç¯å¢ƒå˜é‡ï¼š\n\n```shell\nexport PATH=\"$PATH:~/flutter/flutter/bin\"\n```\n\n\n\n**`~/flutter/flutter/bin éœ€è¦æ›¿æ¢æˆä½ è®¾ç½®çš„ç›®å½•ã€‚`**\n\n\n\nå¦‚æœbash ä½¿ç”¨çš„æ˜¯ zshï¼Œéœ€è¦æŠŠè¿™è¡Œä»£ç å†™å…¥åˆ° `~/.zsh_rc` æ–‡ä»¶ï¼Œå¦‚æœæ˜¯bashï¼Œåˆ™éœ€è¦å†™å…¥ `~/.bash_profile` ï¼Œæ–‡ä»¶æ›´æ–°åéœ€è¦æ‰§è¡Œ \n\n```\nsource ~/.zsh_rc\n```\n\n\n\n\n\n1. `flutter` å‘½ä»¤è¡Œå·¥å…·ä¼šä¸‹è½½ä¸åŒå¹³å°çš„å¼€å‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªå°é—­å¼çš„æ„å»ºç¯å¢ƒï¼Œæˆ–åœ¨ç½‘ç»œå¯ç”¨æ€§ä¸ç¨³å®šçš„æƒ…å†µä¸‹ä½¿ç”¨ç­‰æƒ…å†µï¼Œä½ å¯èƒ½éœ€è¦é€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤é¢„å…ˆä¸‹è½½ iOS å’Œ Android çš„å¼€å‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼š\n\n\n\n```shell\nflutter precache\n```\n\n\n\n1. flutter doctor å‘½ä»¤\n\n\n\nè¿è¡Œflutter doctorå‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ç¯å¢ƒæ˜¯å¦éœ€è¦å®‰è£…å…¶ä»–çš„ä¾èµ–ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\n\n\n\n```shell\nâœ  ~ flutter doctor\n\nDoctor summary (to see all details, run flutter doctor -v):\n[âœ“] Flutter (Channel stable, v1.17.1, on Mac OS X 10.15.5 19F96, locale zh-Hans-CN)\n\n[âœ“] Android toolchain - develop for Android devices (Android SDK version 29.0.3)\n[âœ“] Xcode - develop for iOS and macOS (Xcode 11.4.1)\n[âœ“] Android Studio (version 4.0)\n[!] IntelliJ IDEA Ultimate Edition (version 2020.1.1)\n    âœ— Flutter plugin not installed; this adds Flutter specific functionality.\n    âœ— Dart plugin not installed; this adds Dart specific functionality.\n[âœ“] VS Code (version 1.45.1)\n[âœ“] Connected device (1 available)\n\n! Doctor found issues in 1 category.\n```\n\n\n\nä»ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼ŒIntelliJ IDEA Ultimate Edition æ²¡æœ‰å®‰è£…flutter plugin å’Œ dart plugin æ²¡æœ‰å®‰è£…ã€‚\n\n\n\n1. é…ç½®ç¼–è¾‘å™¨\n\n\n\n### è®¾ç½® iOS å¼€å‘ç¯å¢ƒ\n\n\n\n1. å®‰è£…Xocde\n2. é…ç½® Xcode command-line tools:\n\n```\nsudo xcode-select --switch /Applications/Xcode.app/Contents/Developer\nsudo xcodebuild -runFirstLaunch\n```\n\n1. è¿è¡Œä¸€æ¬¡ Xcode æˆ–è€…é€šè¿‡è¾“å…¥å‘½ä»¤ `sudo xcodebuild -license` æ¥ç¡®ä¿å·²ç»åŒæ„ Xcode çš„è®¸å¯åè®®\n\n\n\nå®‰è£…äº† Xcode ä¹‹åï¼Œä½ å°±å¯ä»¥åœ¨ iOS çœŸæœºæˆ–è€…æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ Flutter åº”ç”¨äº†ã€‚\n\n\n\n#### é…ç½®iOS æ¨¡æ‹Ÿå™¨\n\n\n\nè¾“å…¥å‘½ä»¤è¿è¡Œæ¨¡æ‹Ÿå™¨\n\n```\nopen -a Simulator\n```\n\n\n\nå¦‚æœä½ æƒ³æŠŠ Flutter åº”ç”¨éƒ¨ç½²åˆ° iOS çš„çœŸæœºä¸Šï¼Œä½ è¿˜éœ€è¦ä¸€ä¸ª Apple å¼€å‘è€…è´¦å·ã€‚å¦å¤–ï¼Œä½ è¿˜éœ€è¦åœ¨ Xcode ä¸Šé’ˆå¯¹ä½ çš„æœºå™¨åšä¸€äº›è®¾ç½®ã€‚\n\n\n\n1. å®‰è£…å’Œè®¾ç½® CocoaPods\n\n```shell\nsudo gem install cocoapods\npod setup\n```\n\n\n\n1. æŒ‰ç…§ä¸‹é¢ Xcode ç­¾åæµç¨‹æ¥é…ç½®ä½ çš„é¡¹ç›®ï¼š\n\n1. 1. é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­äºä½ å½“å‰ Flutter é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ `open ios/Runner.xcworkspace` å‘½ä»¤æ¥æ‰“å¼€é»˜è®¤çš„ Xcode å·¥ç¨‹ã€‚\n   2. åœ¨è¿è¡ŒæŒ‰é’®çš„ä¸‹æ‹‰åˆ—è¡¨é‡Œé€‰æ‹©ä½ æƒ³è¦éƒ¨ç½²åˆ°çš„è®¾å¤‡ï¼›\n   3. åœ¨å·¦ä¾§çš„å¯¼èˆªé¢æ¿ä¸­é€‰æ‹© `Runner` é¡¹ç›®ï¼›\n   4. åœ¨ `Runner` é¡¹ç›®çš„è®¾ç½®é¡µé¢ï¼Œè¯·ç¡®ä¿å‹¾é€‰ä½ çš„å¼€å‘å›¢é˜Ÿã€‚åœ¨ä¸åŒçš„ Xcode ç‰ˆæœ¬é‡Œï¼Œè¿™ä¸€éƒ¨åˆ†çš„æ“ä½œç•Œé¢ä¸åŒï¼š\n\n1. 1. 1. åœ¨ Xcode 10 ç‰ˆæœ¬ä¸­ï¼Œè¯·åœ¨è¿™é‡Œè®¾ç½®ï¼šGeneral > Signing > Team\n      2. åœ¨ Xcode 11 ç‰ˆæœ¬ä»¥åï¼Œè¯·åœ¨è¿™é‡Œè®¾ç½® Signing & Capabilities > Team\n\n1. 1. åœ¨ Runner é¡¹ç›®çš„è®¾ç½®é¡µé¢ä¸­ï¼Œç¡®ä¿ General > Signing > Team é€‰é¡¹ä¸‹çš„ Development Team é€‰ä¸­çŠ¶æ€ã€‚\n\n1. 1. 1. åœ¨å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ª iOS é¡¹ç›®å¼€å‘ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆåœ¨ Xcode ä¸­ç™»é™†ä½ çš„ Apple å¼€å‘è€…è´¦å·\n      2. ä»»ä½• Apple ID éƒ½å¯ä»¥è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚å¦‚æœæƒ³å°†åº”ç”¨ä¸Šæ¶ App Storeï¼Œä½ éœ€è¦åŠ å…¥ Apple Developer Programï¼Œä½ å¯ä»¥åœ¨ [Choosing a Membership](https://developer.apple.com/support/compare-memberships) é¡µé¢ä¸­æŸ¥çœ‹è¯¦ç»†çš„è¯´æ˜ã€‚\n\n1. 1. å½“ä½ ç¬¬ä¸€æ¬¡å°†è®¾å¤‡è¿æ¥åˆ°å¼€å‘æœºç”¨äºå¼€å‘æ—¶ï¼Œä½ éœ€è¦åˆ†åˆ«åœ¨ Mac å’Œå¼€å‘æœºä¸Šè¿›è¡Œä¿¡ä»»è®¾å¤‡çš„æ“ä½œã€‚å½“ä½ ç¬¬ä¸€æ¬¡è¿æ¥æ—¶ï¼Œä¼šæœ‰ä¸ªå¼¹çª—ï¼Œç‚¹å‡» `Trust` å³å¯ã€‚\n\n1. 1. 1. ç„¶ååœ¨ iOS å¼€å‘æœºä¸Šè¿›å…¥ Settings åº”ç”¨ï¼Œé€‰æ‹© **General > Device Management** ç„¶åä¿¡ä»»ç›¸åº”çš„è¯ä¹¦\n\n1. 1. å¦‚æœ Xcode çš„è‡ªåŠ¨ç­¾åå¤±è´¥äº†ï¼Œä½ å¯ä»¥æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ä¸­ **General > Identity > Bundle Identifier** é‡Œçš„å€¼æ˜¯å¦æ˜¯å”¯ä¸€çš„ã€‚\n\n\n\n1. æ‰§è¡Œ `flutter run` å‘½ä»¤æ¥è¿è¡Œä½ çš„åº”ç”¨ã€‚\n\n\n\n### è®¾ç½®Android å¼€å‘ç¯å¢ƒ\n\n\n\nandroid å¼€å‘å»ºè®®ä½¿ç”¨ Android Studioï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒç¼–è¾‘å™¨ã€‚\n\n\n\n1. ä¸‹è½½ Android Studio\n2. è¿è¡ŒAndroid Studioï¼Œå®‰è£…android SDKï¼Œ Android SDK Platform-Tools ä»¥åŠ Android SDK Build-Toolsã€‚\n\n\n\n#### é…ç½® Android è®¾å¤‡\n\nåœ¨ Android è®¾å¤‡ä¸Šè¿è¡Œæˆ–æµ‹è¯• Flutter åº”ç”¨ä¹‹å‰ï¼Œä½ éœ€è¦ä¸€ä¸ªè¿è¡Œ Android 4.1ï¼ˆAPI ç‰ˆæœ¬ 16ï¼‰æˆ–è€…æ›´é«˜çš„è®¾å¤‡ã€‚\n\n1. åœ¨è®¾å¤‡ä¸Šæ‰“å¼€ **Developer options** å’Œ **USB debugging** é€‰é¡¹ï¼Œä½ å¯ä»¥åœ¨ [Android documentation](https://developer.android.google.cn/studio/debug/dev-options) ä¸ŠæŸ¥çœ‹æ›´è¯¦ç»†çš„æ–¹æ³•ä»‹ç»ã€‚\n2. å¦‚æœæ˜¯åœ¨ Windows å¹³å°ä¸Šä½¿ç”¨ï¼Œéœ€è¦å®‰è£… [Google USB Driver](https://developer.android.google.cn/studio/run/win-usb)\n3. é€šè¿‡ USB æ¥å£è¿æ¥æ‰‹æœºå’Œç”µè„‘ï¼Œå¦‚æœåœ¨è®¾å¤‡ä¸Šå¼¹å‡ºéœ€è¦æˆæƒå¼¹çª—ï¼Œå…è®¸æˆæƒä»¥ä¾¿è®©ç”µè„‘èƒ½å¤Ÿè®¿é—®ä½ çš„å¼€å‘è®¾å¤‡ã€‚\n4. åœ¨å‘½ä»¤è¡Œä¸­ï¼Œä½¿ç”¨ `flutter devices` å‘½ä»¤æ¥ç¡®ä¿ Flutter èƒ½å¤Ÿè¯†åˆ«å‡ºä½ æ‰€è¿æ¥çš„ Android è®¾å¤‡ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒFlutter ä¼šä½¿ç”¨å½“å‰ç‰ˆæœ¬ `adb` å·¥å…·æ‰€ä¾èµ–çš„ Android SDK ç‰ˆæœ¬ï¼Œå¦‚æœä½ æƒ³è®© Flutter ä½¿ç”¨åˆ«çš„ Android SDKï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® `ANDROID_HOME` ç¯å¢ƒå˜é‡æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚\n\n####  \n\n#### é…ç½® Android æ¨¡æ‹Ÿå™¨\n\n\n\næ ¹æ®ä»¥ä¸‹æ­¥éª¤æ¥å°† Flutter åº”ç”¨è¿è¡Œæˆ–æµ‹è¯•äºä½ çš„ Android æ¨¡æ‹Ÿå™¨ä¸Šï¼š\n\n1. æ¿€æ´»æœºå™¨ä¸Šçš„ [VM acceleration](https://developer.android.google.cn/studio/run/emulator-acceleration) é€‰é¡¹ã€‚\n2. å¯åŠ¨ **Android Studio > Tools > Android > AVD Manager**ï¼Œç„¶åé€‰æ‹© **Create Virtual Device** é€‰é¡¹ã€‚ï¼ˆåªæœ‰åœ¨ Android é¡¹ç›®ä¸­æ‰ä¼šæ˜¾ç¤º **Android** å­é€‰é¡¹ã€‚ï¼‰\n3. é€‰æ‹©ç›¸åº”çš„è®¾å¤‡å¹¶é€‰æ‹© **Next** é€‰é¡¹ã€‚\n4. é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªä½ æƒ³è¦æ¨¡æ‹Ÿçš„ Android ç‰ˆæœ¬çš„ç³»ç»Ÿé•œåƒï¼Œç„¶åé€‰æ‹© **Next** é€‰é¡¹ã€‚æ¨èé€‰æ‹© **x86** æˆ–è€… **x86_64** é•œåƒã€‚\n5. åœ¨ Emulated Performance ä¸‹é€‰æ‹© **Hardware - GLES 2.0** é€‰é¡¹æ¥å¼€å¯ [ç¡¬ä»¶åŠ é€Ÿ](https://developer.android.google.cn/studio/run/emulator-acceleration)ã€‚\n6. ç¡®ä¿ AVD é€‰é¡¹é…ç½®æ­£ç¡®ï¼Œå¹¶é€‰æ‹© **Finish** é€‰é¡¹ã€‚\n   æƒ³è¦æŸ¥çœ‹ä¸Šè¿°æ­¥éª¤çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ [Managing AVDs](https://developer.android.google.cn/studio/run/managing-avds) é¡µé¢ã€‚\n7. åœ¨ Android Virtual Device Manager ä¸­ï¼Œç‚¹å‡»å·¥å…·æ ä¸­çš„ **Run** é€‰é¡¹ï¼Œæ¨¡æ‹Ÿå™¨ä¼šå¯åŠ¨å¹¶ä¸ºä½ æ‰€é€‰æ‹©çš„ç³»ç»Ÿç‰ˆæœ¬å’Œè®¾å¤‡æ˜¾ç¤ºå‡ºç›¸åº”çš„ç•Œé¢ã€‚\n\n\n\n## å¸¸è§é—®é¢˜\n\n\n\n#### Waiting for another flutter command to release the startup lock\n\n\n\næ‰“å¼€AndroidStudioçš„æ—¶å€™é¡¶éƒ¨çš„æ¨¡æ‹Ÿå™¨ä¸€ç›´æ˜¯loadingçŠ¶æ€ï¼Œè¿è¡Œflutter doctor æç¤ºï¼š\n\n```\nWaiting for another flutter command to release the startup lock\n```\n\nè§£å†³æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š \n\n\n\n1. æ‰“å¼€flutterçš„å®‰è£…ç›®å½•/bin/cache/ \n2. åˆ é™¤lockfileæ–‡ä»¶ \n3. é‡å¯AndroidStudio\n\n\n\n#### **Flutter å¡åœ¨ package get çš„è§£å†³åŠæ³•**\n\nè¿è¡Œ flutter run æˆ–è€…æ–°å»ºflutter é¡¹ç›®æ—¶å¡åœ¨ï¼š\n\n\n\n```\nRunning \"flutter packages get\" in project_name...\n```\n\nå¤§æ¦‚ç‡æ˜¯é‡åˆ°äº†é˜²ç«å¢™ï¼Œè§£å†³æ–¹æ¡ˆæ¯•ç«Ÿç®€å•ï¼Œæ·»åŠ ä¸¤ä¸ªç¯å¢ƒå˜é‡å³å¯ï¼Œç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š\n\n```\n# linux mac æ·»åŠ ä»£ç†åˆ° ã€€.zsh_rc æˆ– .bash_profile\nexport PUB_HOSTED_URL=https://pub.flutter-io.cn\nexport FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn\n```\n\n\n\nå®˜æ–¹è§£å†³æ–¹æ¡ˆæ–‡æ¡£ï¼š[Using Flutter in China](https://links.jianshu.com/go?to=https://github.com/flutter/flutter/wiki/Using-Flutter-in-China) https://flutter.dev/community/china[3]\n\n\n\n### å‚è€ƒé“¾æ¥\n\n1. [å®‰è£…å’Œç¯å¢ƒé…ç½® https://flutter.cn/docs/get-started/install](https://flutter.cn/docs/get-started/install)\n2. [SDK ç‰ˆæœ¬åˆ—è¡¨ https://flutter.cn/docs/development/tools/sdk/archive](https://flutter.cn/docs/development/tools/sdk/archive)\n3. [Using Flutter in China](https://links.jianshu.com/go?to=https://github.com/flutter/flutter/wiki/Using-Flutter-in-China) https://flutter.dev/community/china\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/WDz3v4cU4LQq1oyKX-fYK1LxIThzZ1hK931ZaPRC8CdcB0t2oTYJciMDuAws70FY)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "Flutter å®‰è£…é…ç½®",
        "date": "2020-06-06 09:07:20",
        "tags": [
          "Flutter",
          "å‰ç«¯",
          "æ•™ç¨‹"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "flutter-00-install-and-setting"
    },
    {
      "content": "\n> Google æŠ€æœ¯å†™ä½œè¯¾ç¨‹æ¬è¿ï¼ŒåŸæ–‡åœ°å€ï¼š[https://developers.google.com/tech-writing/overview?hl=zh-cn](https://developers.google.com/tech-writing/overview?hl=zh-cn)\n\n## Facilitating Technical Writing Courses\n\n  This section provides resources for anyone facilitating or considering facilitating technical writing courses. The following table contains links to all relevant material for facilitators:\n\n|                       | for facilitators       | for students  |        |              |              |\n| --------------------- | ---------------------- | ------------- | ------ | ------------ | ------------ |\n| Course                | Facilitator's Guide    | slide deck    | log    | pre-class    | in-class     |\n| Technical Writing One | Facilitator's Guide[1] | slide deck[2] | log[3] | pre-class[4] | in-class[5]  |\n| Technical Writing Two | Facilitator's Guide[6] | slide deck[7] | log[8] | pre-class[9] | in-class[10] |\n\n  If you'd like to facilitate a particular course, please start by reading the course's Facilitator's Guide.\n\n  To access slide decks, please read Gaining access to the slide deck[11].\n\n  ## Technical Writing One: facilitator's guide\n\n  This facilitator's guide helps prepare you to lead Technical Writing One.\n\n  ### Who can facilitate this course?\n\n  Any good facilitator can lead this course; you don't need to be an expert in technical writing to lead this course. We designed this course to have students teach each other. Granted, facilitators with experience in technical writing can provide additional insights during the class.\n\n### Gaining access to the slide deck\n\n  To gain access to the slide deck, you must first become a member of the `technical-writing-instructors@googlegroups.com` group. Joining this group enrolls you in a world-wide **community** of technical writing facilitators. To build that community, use the list to do the following:\n\n  â€¢Share training insights with your peers.â€¢Answer questions respectfully, supportively, and generously.â€¢Advertise any upcoming public technical writing courses.\n\n  Never do the following:\n\n  â€¢Harm, bully, stalk, slander, or belittle anyone on this list.â€¢Send messages not pertaining to technical writing training. Do not spam the list.\n\n  In short, treat others as you wish to be treated. If you treat others poorly, we will remove you from this list.\n\n  Finally, only humans may join this list. Machine learning is remarkable, but it doesn't belong on this list.\n\n  **Note:** We reserve the right to change these guidelines.\n\n  Take the following steps to become a member:\n\n  1.Visit the technical-writing-instructors@googlegroups.com group page[12].2.Click **Apply for membership.**\n\n### Course contents\n\n  The course consists of the sections shown in Table 1.\n\n  **Table 1. Course Sections**\n\n| Section                                            | Length (in hours) | What students do                                             | What facilitators do                               |\n| -------------------------------------------------- | ----------------- | ------------------------------------------------------------ | -------------------------------------------------- |\n| pre-class exercises[13]                            | 2 - 3             | Read short lessons and work through quick exercises.         | Assign pre-class material to your students.        |\n| In-class slide deck[14] and in-class exercises[15] | 2.0 - 2.5         | Work through six writing exercises. Participate in peer reviews and class discussions. | Facilitate the peer reviews and class discussions. |\n\n### Preparing to facilitate\n\n  To prepare to facilitate this class, please do the following:\n\n  â€¢Review the student pre-class work[16].â€¢Review the slide deck[17].â€¢Review the in-class exercises[18].\n\n  As with any class, we recommend the following:\n\n  â€¢Practice the material prior to leading a live class.â€¢If you have teaching assistants, decide what each of you will do during class.\n\n### Why split pre-class work from in-class work?\n\n  The pre-class exercises build **foundational skills**. The in-class exercises help students **integrate** those foundational skills.\n\n  The pre-class exercises provide explicit instructions on discrete foundational topics. For example, one pre-class exercise teaches students to convert passive voice sentences to active voice. Another exercise teaches students to reduce the number of words in a sentence or to convert lengthy sentences into a list.\n\n  The instructions for in-class exercises are less specific than the pre-class exercises. For example, two of the in-class exercises simply tell students to \"improve these sentences.\" Students must integrate lessons learned in pre-class exercises to determine what to do.\n\n  Much of the pre-class and in-class material attempts to unite engineering process and theory with technical writing process and theory. We encourage facilitators to draw parallels between the two worlds whenever possible. (The speaker notes can help you draw those parallels.)\n\n  We've heard people refer to the pre-class content as \"design patterns for technical writing,\" which is a reasonable description. We've aimed to keep these patterns relatively simple to remember and easy to implement. As you facilitate this class, some students will object to a few of these patterns, noting that real-world writing is more nuanced and complex. You can reply that these design patterns are guidelines rather than hard-and-fast rules. You can additionally note that professional technical writers often rely on these patterns.\n\n  If a facilitator is not available (and students can't experience the in-class material), the pre-class material is still valuable.\n\n### Partner discussions\n\n  Consider the following proverb:\n\n  > To learn, read a book. To learn better, take a course. To learn best, teach the course.\n\n  How do you get 20 students to each teach the material simultaneously? If students are accustomed to reviewing their peers' work, then the class will quickly fill with animated conversation as students teach each other the material. However, those students unaccustomed to peer review may feel shy or awkward about defending their answers or offering useful suggestions. Be prepared to assure your students that their feedback helps their partner. For a very shy class, consider role-playing how to give appropriate feedback.\n\n  Encourage students to change their solutions based on feedback.\n\n### Class discussions\n\n  Each unit ends with a slide that asks some conversation-provoking questions. Your job is to incite discussion and then to extinguish that discussion when you are ready to move on. Generally, students will provide ideas, but be prepared with conversation starters should your class get a little shy. We've added a few conversation starter suggestions in the speaker notes.\n\n  The following list contains a few general tips about leading discussions:\n\n  â€¢Be positive. Encourage students whenever possible. \"That's an excellent answer. Can anyone build on that answer?\"â€¢Build a class where students feel comfortable giving answers. To break the ice in a shy class, ask questions that have no right or wrong answers.â€¢Seek opinions. When there are several possible answers to exercises or questions, ask students which answer they prefer and why.\n\n### Pace\n\n  We usually schedule the class for 2.0 or 2.5 hours. If a large percentage of students speak English as a second or third language, then schedule the class for 2.5 hours. Regardless of the overall class length, try to keep a fairly brisk pace.\n\n  Each class has a different personality and pace, so don't expect your class to match Table 2 exactly.\n\n  **Table 2. High-level timing for a 2.0 hour course**\n\n| Time from start | What you'll cover                  |\n| --------------- | ---------------------------------- |\n| 0 - 30          | Exercise 1 and Exercise 2          |\n| 30 - 55         | Exercise 3 and Intermezzo          |\n| 55 - 95         | Exercise 4 and Exercise 5          |\n| 95 - 120        | Exercise 6 and end-of-class slides |\n\n  For a 2.5 hour class, try to follow the schedule in Table 2, but don't be too concerned if some units take longer than shown.\n\n  Each exercise ends with one or more discussion slides, so make sure you factor those slides into your pacing.\n\n### Ideal course size\n\n  An ideal class has somewhere between 12 and 20 students. With too few students, it can sometimes be difficult to get good class discussions going. With too many students, class discussions can become awkward.\n\n  For large classes, we recommend having one teaching assistant for every 20 students (beyond the first 20 students). For example, for a class of 60 students, we recommend one facilitator and two teaching assistants.\n\n### Classroom setup\n\n  You need a way to project the slides in a Google Slides deck. Therefore, you need the following equipment:\n\n  â€¢A laptop that has a network connection and can display Google Slides. Verify that you can project the slides before the class begins.â€¢A projector or screen that can display the images on your laptop clearly to the entire class.â€¢Access to power sockets so that students can charge their laptops. (If power sockets aren't available, email students before class and tell them to charge their laptops before attending.)\n\n  Arrange the tables or desks in the classroom so that students can see the projected slides. Ensure that chairs are arranged so that students can easily talk to and trade laptops with their partners.\n\n  For large classrooms and to help those with hearing issues, we also recommend the following audio equipment:\n\n  â€¢a microphone, preferably wireless so that the facilitator can walk aroundâ€¢speakers, especially for large classesâ€¢a hearing loop[19] (also called an audio induction loop)\n\n  When students don't have access to their own laptops, consider also bringing the following to class:\n\n  â€¢paperâ€¢pens or pencils\n\n  Though not a requirement, some facilitators bring toothpaste tubes and toothbrushes so that students can act out Exercise 3.\n\n### Course stability\n\n  We will fix bugs in the course and we might make a few additional small changes, but we don't anticipate making any big changes. We'll chronicle all significant changes to the course in the log[20].\n\n### Facilitation tips\n\n  Here are a few tips:\n\n  â€¢When you assign an exercise, be absolutely clear on what students should do. Give students time to ask questions.â€¢Read the room, trying to find the right balance between hurrying students along and giving them just enough time to complete (or nearly complete) the exercises.â€¢Unstick any stuck students.\n\n## Technical Writing Two: facilitator's guide\n\n  This facilitator's guide helps prepare you to lead Technical Writing Two.\n\n### Who can facilitate this course?\n\n  Any good facilitator can lead this course; you don't need to be an expert in technical writing to lead this course. We designed this course to have students teach each other. Granted, facilitators with experience in technical writing can provide additional insights during the class.\n\n### Gaining access to the slide deck\n\n  To gain access to the slide deck, you must first become a member of the `technical-writing-instructors@googlegroups.com` group. Joining this group enrolls you in a world-wide **community** of technical writing facilitators. To build that community, use the list to do the following:\n\n  â€¢Share training insights with your peers.â€¢Answer questions respectfully, supportively, and generously.â€¢Advertise any upcoming public technical writing courses.\n\n  Never do the following:\n\n  â€¢Harm, bully, stalk, slander, or belittle anyone on this list.â€¢Send messages not pertaining to technical writing training. Do not spam the list.\n\n  In short, treat others as you wish to be treated. If you treat others poorly, we will remove you from this list.\n\n  Finally, only humans may join this list. Machine learning is remarkable, but it doesn't belong on this list.\n\n  **Note:** We reserve the right to change these guidelines.\n\n  Take the following steps to become a member:\n\n  1.Visit the technical-writing-instructors@googlegroups.com group page[21].2.Click **Apply for membership.**\n\n### Course contents\n\n  The course consists of the sections shown in Table 1.\n\n  **Table 1. Course Sections**\n\n| Section                                   | Length (in hours) | What students do                                             | What facilitators do                                         |\n| ----------------------------------------- | ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| Pre-class exercises[22]                   | 1.0               | Work through short exercises.                                | Assign pre-class work to your students.                      |\n| In-class slide deck[23] and exercises[24] | 2.0 - 2.5         | Do four writing exercises. Participate in partner discussions. Participate in class discussions. | Facilitate the partner discussions and the class discussions. |\n\n### Preparing to facilitate\n\n  To prepare to facilitate this class, please do the following:\n\n  â€¢Review the pre-class exercises[25].â€¢Review the slide deck[26].â€¢Review the in-class exercises[27].\n\n  As with any class, we recommend the following:\n\n  â€¢Practice the material prior to leading a live class.â€¢If you have teaching assistants, decide what each of you will do during class.\n\n### Why split pre-class work from in-class work?\n\n  The material in this class falls into two categories:\n\n  â€¢Complex material that requires a fair amount of time, so the lesson is split across pre-class and in-class.â€¢More straightforward material that we cover either in pre-class or in-class, but not both.\n\n  The in-class lessons lend themselves to student interaction; the pre-class lessons are good \"solo\" tasks. The pre-class lessons also serve as effective post-class refreshers.\n\n  If a facilitator is not available (and students can't experience the in-class material), the pre-class material is still valuable.\n\n### Partner discussions\n\n  Consider the following proverb:\n\n  > To learn, read a book. To learn better, take a course. To learn best, teach the course.\n\n  How do you get 20 students to each teach the material simultaneously? If students are accustomed to reviewing their peers' work, then the class will quickly fill with animated conversation as students teach each other the material. However, those students unaccustomed to peer review may feel shy or awkward about defending their answers or offering useful suggestions. Be prepared to assure your students that their feedback helps their partner. For a very shy class, consider role-playing how to give appropriate feedback.\n\n  Encourage students to change their solutions based on feedback.\n\n### Class discussions\n\n  Each unit ends with a slide that asks some conversation-provoking questions. Your job is to incite discussion and then to extinguish that discussion when you are ready to move on. Generally, students will provide ideas, but be prepared with conversation starters should your class get a little shy. We've added a few conversation starter suggestions in the speaker notes.\n\n  The following list contains a few general tips about leading discussions:\n\n  â€¢Be positive. Encourage students whenever possible. \"That's an excellent answer. Can anyone build on that answer?\"â€¢Build a class where students feel comfortable giving answers. To break the ice in a shy class, ask questions that have no right or wrong answers.â€¢Seek opinions. When there are several possible answers to exercises or questions, ask students which answer they prefer and why.\n\n### Pace\n\n  We usually schedule the class for 2.0 or 2.5 hours. If a large percentage of students speak English as a second or third language, then schedule the class for 2.5 hours. Regardless of the overall class length, try to keep a fairly brisk pace.\n\n  **Table 2. High-level timing for a 2.0 hour course**\n\n| Time from start | What you'll cover                             |\n| --------------- | --------------------------------------------- |\n| 0 - 30          | Writing is rewriting                          |\n| 30 - 55         | Illustrations                                 |\n| 55 - 60         | Intermezzo: Doc types                         |\n| 60 - 85         | Descriptions                                  |\n| 85 - 90         | Intermezzo 2: How do you write a first draft? |\n| 90 - 117        | Tutorials                                     |\n| 117 - 120       | Last few slides                               |\n\n  For a 2.5 hour class, try to follow the schedule in Table 2, but don't be too concerned if some units take longer than shown.\n\n  Each exercise ends with one or more discussion slides, so make sure you factor those slides into your pacing.\n\n### Ideal course size\n\n  An ideal class has somewhere between 12 and 20 students. With too few students, it can sometimes be difficult to get good class discussions going. With too many students, class discussions can become awkward.\n\n  For large classes, we recommend having one teaching assistant for every 20 students (beyond the first 20 students). For example, for a class of 60 students, we recommend one facilitator and two teaching assistants.\n\n### Classroom setup\n\n  You need a way to project the slides in a Google Slides deck. Therefore, you need the following equipment:\n\n  â€¢A laptop that has a network connection and can display Google Slides. Verify that you can project the slides before the class begins.â€¢A projector or screen that can display the images on your laptop clearly to the entire class.â€¢Access to power sockets so that students can charge their laptops. (If power sockets aren't available, email students before class and tell them to charge their laptops before attending.)\n\n  Arrange the tables or desks in the classroom so that students can see the projected slides. Ensure that chairs are arranged so that students can easily talk to and trade laptops with their partners.\n\n  For large classrooms and to help those with hearing issues, we also recommend the following audio equipment:\n\n  â€¢a microphone, preferably wireless so that the facilitator can walk aroundâ€¢speakers, especially for large classesâ€¢a hearing loop[28] (also called an audio induction loop)\n\n  When students don't have access to their own laptops, consider also bringing the following to class:\n\n  â€¢paperâ€¢pens or pencils\n\n  Although this is a laptop course, some students prefer to do the Illustrations exercise on paper.\n\n  ### Course stability\n\n  We will fix bugs in the course and we might make a few additional small changes, but we don't anticipate making any big changes. We'll chronicle all significant changes to the course in the log[29].\n\n### Facilitation tips\n\n  Here are a few tips:\n\n  â€¢When you assign an exercise, be absolutely clear on what students should do. Give students time to ask questions.â€¢Read the room, trying to find the right balance between hurrying students along and giving them just enough time to complete (or nearly complete) the exercises.â€¢Unstick any stuck students.\n\n### References\n\n  `[1]` Facilitator's Guide: *https://developers.google.com/tech-writing/for-instructors/one/instructors-guide?hl=zh-cn*\n  `[2]` slide deck: *https://docs.google.com/presentation/d/1Q7mpI2KNuh1kALXYbG-PqA9sRV9M-1IoKxy_PFB2J0E?hl=zh-cn*\n  `[3]` log: *https://developers.google.com/tech-writing/for-instructors/release-notes?hl=zh-cn#One*\n  `[4]` pre-class: *https://developers.google.com/tech-writing/one?hl=zh-cn*\n  `[5]` in-class: *https://developers.google.com/tech-writing/onel?hl=zh-cn*\n  `[6]` Facilitator's Guide: *https://developers.google.com/tech-writing/for-instructors/two/instructors-guide?hl=zh-cn*\n  `[7]` slide deck: *https://docs.google.com/presentation/d/1hsusV5rt34HP4IXOFfdyJGryFJfeuPkee3XoFKp5qgA?hl=zh-cn*\n  `[8]` log: *https://developers.google.com/tech-writing/for-instructors/release-notes?hl=zh-cn#Two*\n  `[9]` pre-class: *https://developers.google.com/tech-writing/two?hl=zh-cn*\n  `[10]` in-class: *https://developers.google.com/tech-writing/twol?hl=zh-cn*\n  `[11]` Gaining access to the slide deck: *https://developers.google.com/tech-writing/for-instructors/one/instructors-guide?hl=zh-cn#gaining-access-to-the-slide-deck*\n  `[12]` technical-writing-instructors@googlegroups.com group page: *https://groups.google.com/d/forum/technical-writing-instructors?hl=zh-cn*\n  `[13]` pre-class exercises: *https://developers.google.com/tech-writing/one?hl=zh-cn*\n  `[14]` In-class slide deck: *https://docs.google.com/presentation/d/1Q7mpI2KNuh1kALXYbG-PqA9sRV9M-1IoKxy_PFB2J0E?hl=zh-cn*\n  `[15]` in-class exercises: *https://developers.google.com/tech-writing/onel?hl=zh-cn*\n  `[16]` pre-class work: *https://developers.google.com/tech-writing/one?hl=zh-cn*\n  `[17]` slide deck: *https://docs.google.com/presentation/d/1Q7mpI2KNuh1kALXYbG-PqA9sRV9M-1IoKxy_PFB2J0E?hl=zh-cn*\n  `[18]` in-class exercises: *https://developers.google.com/tech-writing/onel?hl=zh-cn*\n  `[19]` hearing loop: *https://www.hearinglink.org/living/loops-equipment/hearing-loops/what-is-a-hearing-loop/*\n  `[20]` log: *https://developers.google.com/tech-writing/for-instructors/release-notes?hl=zh-cn*\n  `[21]` technical-writing-instructors@googlegroups.com group page: *https://groups.google.com/d/forum/technical-writing-instructors?hl=zh-cn*\n  `[22]` exercises: *https://developers.google.com/tech-writing/two?hl=zh-cn*\n  `[23]` slide deck: *https://docs.google.com/presentation/d/1hsusV5rt34HP4IXOFfdyJGryFJfeuPkee3XoFKp5qgA?hl=zh-cn*\n  `[24]` exercises: *https://developers.google.com/tech-writing/twol?hl=zh-cn*\n  `[25]` pre-class exercises: *https://developers.google.com/tech-writing/two?hl=zh-cn*\n  `[26]` slide deck: *https://docs.google.com/presentation/d/1hsusV5rt34HP4IXOFfdyJGryFJfeuPkee3XoFKp5qgA?hl=zh-cn*\n  `[27]` in-class exercises: *https://developers.google.com/tech-writing/twol?hl=zh-cn*\n  `[28]` hearing loop: *https://www.hearinglink.org/living/loops-equipment/hearing-loops/what-is-a-hearing-loop/*\n  `[29]` log: *https://developers.google.com/tech-writing/for-instructors/release-notes?hl=zh-cn*\n\n------\n\n\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "Facilitating Technical Writing Courses",
        "date": "2020-03-01 12:47:11",
        "tags": [
          "æ•™ç¨‹",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "google-TFacilitating-Technical-Writing-Courses"
    },
    {
      "content": "\n> Google æŠ€æœ¯å†™ä½œè¯¾ç¨‹æ¬è¿ï¼ŒåŸæ–‡åœ°å€ï¼š[https://developers.google.com/tech-writing/overview?hl=zh-cn](https://developers.google.com/tech-writing/overview?hl=zh-cn)\n\n# Technical Writing Courses\n\n\nEvery engineer is also a writer.\n\nThis collection of courses and learning resources aims to improve your technical documentation. Learn how to plan and author technical documents. You can also learn about the role of technical writers at Google.\n\n\n\n# Overview of technical writing courses\n\n\n\nThe following table summarizes the technical writing courses:\n\n| Take this course... | Title                                                        | Focus                                    | Pre-Class | In-Class       |\n| :------------------ | :----------------------------------------------------------- | :--------------------------------------- | :-------- | :------------- |\n| first               | [Technical Writing One](http://blog.gusibi.site/post/google-technical-writing-courses/#technical-writing-one) | the critical basics of technical writing | 2 hours   | 2 to 2.5 hours |\n| second              | [Technical Writing Two](http://blog.gusibi.site/post/google-technical-writing-courses/#technical-writing-two) | intermediate topics in technical writing | 1 hour    | 2 to 2.5 hours |\n\nThe pre-class components introduce topics; the in-class components help students integrate those topics. That said, the pre-class lessons on their own still provide a valuable educational experience.\n\nWe've aimed *Technical Writing One* and *Technical Writing Two* at the following audiences:\n\n- software engineers\n- software engineering students\n\nAdditionally, many people in engineering-adjacent roles (such as product managers) have also benefited from these courses.\n\n# Technical Writing One\n\n## Technical Writing One introduction\n\n\n\nTechnical Writing One teaches you how to write clearer technical documentation.\n\n#### Target audience\n\nYou need at least a little writing proficiency in English, but you don't need to be a strong writer to take this course.\n\nIf you've never taken any technical writing training, this course is perfect for you. If you've taken technical writing training, this class provides an efficient refresher.\n\n#### Learning objectives\n\nThis course teaches you the fundamentals of technical writing. After completing this class, you will know how to do the following:\n\n- Use terminologyâ€”including abbreviations and acronymsâ€”consistently.\n- Recognize and disambiguate pesky pronouns.\n- Distinguish active voice from passive voice.\n- Convert passive voice sentences to active voice.\n- Identify three ways in which active voice is superior to passive voice.\n- Develop at least three strategies to make sentences clearer and more engaging.\n- Develop at least four strategies to shorten sentences.\n- Understand the difference between bulleted lists and numbered lists.\n- Create helpful lists.\n- Create effective lead sentences for paragraphs.\n- Focus each paragraph on a single topic.\n- State key points at the start of each document.\n- Identify your target audience.\n- Determine what your target audience already knows and what your target audience needs to learn.\n- Understand the curse of knowledge.\n- Identify and revise idioms.\n- State your document's scope (goals) and audience.\n- Break long topics into appropriate sections.\n- Use commas, parentheses, colons, em-dashes, and semicolons properly.\n- Develop beginner competency in Markdown.\n\nIt takes years of focused practice to become a great engineer or a great technical writer. This course will improve your technical writing but will not instantly transform you into a great technical writer.\n\n#### Pre-class and in-class components\n\nThe course consists of the following two components:\n\n- pre-class\n- in-class\n\nYou are currently viewing the start of the pre-class component.\n\nThe in-class component enhances the lessons taught in the pre-class components. That said, the pre-class lessons on their own still provide a valuable educational experience.\n\n#### Hardware and network requirements\n\nAlthough this course is optimized for a laptop or desktop, you may take the course on a tablet or phone. If you are taking the in-class component, please note that you'll type a lot.\n\nYou need an internet connection to take the course. You cannot download the course. The course is not available on tangible media.\n\nThe course contains a few short videos, all of which are optional viewing. If you want to skip the videos, then you can take the course on a low-bandwidth internet connection.\n\n#### Optional units\n\nWe've marked a few units as **optional**. This material isn't essential, though you'll probably find the material useful.\n\n## Just enough grammar (optional)\n\n\n\nThis unit provides just enough grammar to understand the remainder of the course. If you already know some grammar, move on to [Words](https://developers.google.com/tech-writing/one/words?hl=zh-cn). Otherwise, read on.\n\nFor simplicity's sake, this unit takes a few shortcuts; grammatical topics are actually wildly more complicated than this unit suggests.\n\nGrammarians don't all agree on the number or types of parts of speech. The following table focuses on the parts of speech relevant to this course:\n\n| Part of Speech | Definition                                                   | Example                                                      |\n| :------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |\n| Noun           | a person, place, concept, or thing                           | **Sam** runs **races**.                                      |\n| Pronoun        | a noun that substitutes for another noun                     | Sam runs races. **He** likes to compete.                     |\n| Adjective      | a word or phrase that modifies a noun                        | Sam wears **blue** shoes.                                    |\n| Verb           | an action word or phrase                                     | Sam **runs** races.                                          |\n| Adverb         | a word or phrase that modifies a verb, an adjective, or another adverb | Sam runs **slowly**.                                         |\n| Preposition    | a word or phrase specifying the positional relationship of two nouns | Sam's sneakers are seldom **on** his shelf.                  |\n| Conjunction    | a word that connects two nouns or phrases                    | Sam's trophies **and** ribbons live only in his imagination. |\n| Transition     | a word or phrase that connects two sentences                 | Sam runs races weekly. **However**, he finishes races weakly. |\n\n### Nouns\n\nNouns represent people, places, or things. **Judy**, **Antarctica**, and **hammers** are all nouns, but so are intangible concepts like **robustness** and **perfection**. For example, we've highlighted the nouns in the following passage:\n\n> In the **framework**, an **object** must copy any underlying **values** that the **object** wants to change. The **protos** in the **codebase** are huge, so copying the **protos** is unacceptably expensive.\n\nIn programming, you might think of classes and variables as your program's nouns.\n\n#### Exercise\n\nIdentify the six nouns in the following passage:\n\n> C enables programmers to control pointers and memory. Great power brings great responsibility.\n\n\n\n##### Answer\n\nYou can find the nouns in boldface:\n\n> **C** enables **programmers** to control **pointers** and **memory**. Great **power** brings great **responsibility**.\n\nNow suppose the second sentence was the following:\n\n> Great control brings great responsibility.\n\nIs \"control\" a verb or is it a noun?\n\nIn this context, \"control\" is a noun, even though \"to control\" in the first sentence is a verb. Many words in English serve as a noun in some contexts and a verb in others.\n\n### Pronouns\n\nPronouns are an indirection layerâ€”pointers to or substitutions for other nouns or sentences. For example, consider the following two sentences:\n\n> Janet writes great code. **She** is a senior staff engineer.\n\nIn the preceding example, the first sentence establishes **Janet** as a noun. The second sentence substitutes the pronoun **She** for the noun **Janet**.\n\nIn the following example, the pronoun **This** substitutes for the entire sentence that preceded it:\n\n> Most applications aren't sufficiently tested. **This** is poor engineering.\n\n#### Exercise\n\nIdentify the three pronouns in the following passage:\n\n> The cafeteria featured peashew butter and pluot jam on pumperye toast. Employees found it awesome and wished they could eat this every day.\n\n\n\n##### Answer\n\n> The cafeteria featured peashew butter and pluot jam on pumperye toast. Employees found **it** awesome and wished **they** could eat **this** every day.\n\n### Verbs\n\nA verb is an action word or phrase. When you want to represent the relationship between two nouns (an actor and a target), the verb does the work. A verb identifies what the actor does to the target.\n\nEach sentence must contain at least one verb. For example, each of the following sentences contain a single verb:\n\n- Sakai **prefers** pasta.\n- Rick **likes** the ocean.\n- Smurfs **are** blue.\n- Jess **suffers** from allergies.\n\nSome sentences, such as the following, contain multiple verbs:\n\n- Nala **suffers** from allergies and **sneezes** constantly.\n- Chung **likes** snacks **to eat** while **riding** the train.\n\nDepending on the tense and the conjugation, a verb could consist of one word or multiple words. For example:\n\n- Tina **was eating** breakfast a few hours ago.\n- Tina **is eating** lunch right now.\n- Tina **will eat** dinner tonight at 7:00.\n\n#### Exercise\n\nIdentify the verbs in the following passage:\n\n> Samantha is coding Operation Bullwinkle in C++. This project currently consumes over 80,000 lines of code. She previously used Python, but recently gravitated to C++. Samantha leads a team of four software engineers, which will grow to six software engineers next quarter.\n\n\n\n##### Answer\n\n> Samantha **is coding** Operation Bullwinkle in C++. This project currently **consumes** over 80,000 lines of code. She previously **used** Python, but recently **gravitated** to C++. Samantha **leads** a team of four software engineers, which **will grow** to six software engineers next quarter.\n\n### Adjectives and adverbs\n\nAdjectives modify nouns. For example, in the following passage, notice how the adjectives modify the subsequent noun:\n\n- Tom likes **red** balloons. He prepares **delicious** food. He fixed **eight** bugs at work.\n\nMost adverbs modify verbs. For example, notice how the adverb (**efficiently**) in the following sentence modifies the verb (**fixes**):\n\n- Jane **efficiently** fixes bugs.\n\nAdverbs are not necessarily right next to their verb. For example, in the following sentence, the adverb (**efficiently**) is two words away from the verb (**fixes**):\n\n- Jane fixes bugs **efficiently**.\n\nAdverbs can also modify adjectives or other adverbs.\n\n#### Exercise\n\nIdentify the four adjectives in the following passage:\n\n> Engineering is a great career for brilliant minds. I know five engineers who could excel at any intellectual task.\n\n\n\n##### Answer\n\n> Engineering is a **great** career for **brilliant** minds. I know **five** engineers who could excel at any **intellectual** task.\n\n### Conjunctions and transitions\n\nConjunctions connect phrases or nouns *within* a sentence; transitions connect sentences themselves.\n\nThe most important conjunctions are as follows:\n\n- and\n- but\n- or\n\nFor example, in the following sentence, **and** connects \"code\" with \"documentation,\" while **but** connects the first half of the sentence with the second.\n\n> Natasha writes great internal code **and** documentation **but** seldom works on open-source projects.\n\nThe most important transitions in technical writing are as follows:\n\n- however\n- therefore\n- for example\n\nFor example, in the following passage, notice how the transitions connect and contextualize the sentences:\n\n> Juan is a wonderful coder. **However**, he rarely writes sufficient tests. **For example**, Juan coded a 5,000 line FFT package that contained only a single 10-line unit test.\n\n#### Exercise\n\nFill in the most appropriate transition:\n\n> Barbara typically studies problems for a long time before writing the first line of code. _____________, she spontaneously coded a method the other day when she was suddenly inspired.\n\n\n\n##### Answer\n\nThe best transition for this situation is as follows:\n\n> However\n\n\n\n## Words\n\nWe researched documentation extensively, and it turns out that the best sentences in the world consist primarily of words.\n\n### Define new or unfamiliar terms\n\nWhen writing or editing, learn to recognize terms that might be unfamiliar to some or all of your target audience. When you spot such a term, take one of the following two tactics:\n\n- If the term already exists, link to a good existing explanation. (Don't reinvent the wheel.)\n- If your document is introducing the term, define the term. If your document is introducing many terms, collect the definitions into a glossary.\n\nUse terms consistently\n\nIf you change the name of a variable midway through a method, your code wonâ€™t compile. Similarly, if you rename a term in the middle of a document, your ideas wonâ€™t compile (in your usersâ€™ heads).\n\nThe moral: apply the same unambiguous word or term consistently throughout your document. Once you've named a component **thingy**, don't rename it **thingamabob**. For example, the following paragraph mistakenly renames **Protocol Buffers** to **protobufs**:\n\n> Protocol Buffers provide their own definition language. Blah, blah, blah. And that's why protobufs have won so many county fairs.\n\nYes, technical writing is cruel and restrictive, but at least technical writing provides an excellent workaround. Namely, when introducing a long-winded concept name or product name, you may also specify a shortened version of that name. Then, you may use that shortened name throughout the document. For example, the following paragraph is fine:\n\n> **Protocol Buffers** (or **protobufs** for short) provide their own definition language. Blah, blah, blah. And that's why protobufs have won so many county fairs.\n\n### Use acronyms properly\n\nOn the initial use of an unfamiliar acronym within a document or a section, spell out the full term, and then put the acronym in parentheses. Put both the spelled-out version and the acronym in boldface. For example:\n\n> This document is for engineers who are new to the **Telekinetic Tactile Network** (**TTN**) or need to understand how to order TTN replacement parts through finger motions.\n\nYou may then use the acronym going forward, as in the following example:\n\n> If no cache entry exists, the Mixer calls the **OttoGroup Server** (**OGS**) to fetch Ottos for the request. The OGS is a repository that holds all servable Ottos. The OGS is organized in a logical tree structure, with a root node and two levels of leaf nodes. The OGS root forwards the request to the leaves and collects the responses.\n\nDo not cycle back-and-forth between the acronym and the expanded version in the same document.\n\n#### Use the acronym or the full term?\n\nSure, you can introduce and use acronyms properly, but *should* you use acronyms? Well, acronyms do reduce sentence size. For example, *TTN* is two words shorter than *Telekinetic Tactile Network*. However, acronyms are really just a layer of abstraction; readers must mentally expand recently learned acronyms to the full term. For example, readers convert *TTN* to *Telekinetic Tactile Network* in their heads, so the \"shorter\" acronym actually takes a little longer to process than the full term.\n\nHeavily used acronyms develop their own identity. After a number of occurrences, readers generally stop expanding acronyms into the full term. Many Web developers, for example, have forgotten what *HTML* expands to.\n\nHere are the guidelines for acronyms:\n\n- Don't define acronyms that would only be used a few times.\n- Do define acronyms that meet both of the following criteria:\n  - The acronym is significantly shorter than the full term.\n  - The acronym appears many times in the document.\n\n#### Exercise\n\nFix the following passage. Assume that this passage is the initial instance of the term **MapReduce** in the document and that **MR** is the best abbreviation:\n\n> Jeff Dean invented MapReduce in 1693, implementing the algorithm on a silicon-based computer fabricated from beach sand, wax-paper, a quill pen, and a toaster oven. His version of MR held several world performance records until 2014.\n\n##### Answer\n\nYou could take a few different approaches here. One approach is to associate the acronym *MR* with the full term and then use that acronym:\n\n> Jeff Dean invented **MapReduce** (**MR**) in... This version of MR held several...\n\nAlternatively, you could decide that defining an acronym for such a short passage puts too much burden on readers, so you'll simply use the full term *MapReduce* every time:\n\n> Jeff Dean invented **MapReduce** in... This version of MapReduce held several...\n\nIncidentally, a more thorough technical writer would also convert \"beach sand, wax-paper, a quill pen, and a toaster oven\" into a bulleted list. However, that's another story for another lesson.\n\n------\n\n### Disambiguate pronouns\n\nMany pronouns point to a previously introduced noun. Such pronouns are analogous to pointers in programming. Like pointers in programming, pronouns tend to introduce errors. Improperly using pronouns causes the cognitive equivalent of a `nullptr` error in your readersâ€™ heads. In many cases, you should simply avoid the pronoun and just reuse the noun. However, the utility of a pronoun sometimes outweighs its risk (as in this sentence).\n\nConsider the following pronoun guidelines:\n\n- Only use a pronoun *after* you've introduced the noun; never use the pronoun before you've introduced the noun.\n- Place the pronoun as close as possible to the referring noun. As a rule of thumb, if more than five words separate your noun from your pronoun, consider repeating the noun instead of using the pronoun.\n- If you introduce a second noun between your noun and your pronoun, reuse your noun instead of using a pronoun.\n\n#### It and they\n\nThe following pronouns cause the most confusion in technical documentation:\n\n- it\n- they, them, and their\n\nFor example, in the following sentence, does **It** refer to Python or to C++?\n\n> Python is interpreted, while C++ is compiled. **It** has an almost cult-like following.\n\nAs another example, what does **their** refer to in the following sentence?\n\n> Be careful when using Frambus or Carambola with HoobyScooby or BoiseFram because a bug in **their** core may cause accidental mass unfriending.\n\n#### This and that \n\nConsider two additional problem pronouns:\n\n- this\n- that\n\nFor example, in this following ambiguous sentence, **This** could refer to Frambus, to Foo, or to both:\n\n> You may use either Frambus or Foo to calculate derivatives. **This** is not optimal.\n\nUse either of the following tactics to disambiguate **this** and **that**:\n\n- Replace **this** or **that** with the appropriate noun.\n- Place a noun immediately after **this** or **that**.\n\nFor example, either of the following sentences disambiguate the previous example:\n\n> **Overlapping functionality** is not optimal.\n>\n> **This overlapping functionality** is not optimal.\n\n#### Exercise\n\nIdentify all possible meanings for the ambiguous pronouns in each of the following passages:\n\n1. Aparna and Phil share responsibilities with Maysam and Karan and they are the next ones on call.\n2. You may import Carambola data via your configuration file or dynamically at run time. This may be a security risk.\n\n\n\n##### Answer\n\n1. The pronoun **they** could refer to any of the following:\n   - Aparna and Phil\n   - Maysam and Karan\n   - Aparna, Phil, Maysam, and Karan\n2. The pronoun **this** could refer to any of the following: \n   - importing via the configuration file\n   - importing dynamically at run time\n   - both\n\n------\n\n\n\n## Active voice vs. passive voice\n\n\n\nThe vast majority of sentences in technical writing should be in active voice. This unit teaches you how to do the following:\n\n- Distinguish passive voice from active voice.\n- Convert passive voice to active voice because active voice is usually clearer.\n\nFirst, watch this video, just to get the ball rolling[1](https://developers.google.com/tech-writing/one/active-voice?hl=zh-cn#Footnote1):\n\nhttps://youtu.be/nG6DhoFt938\n\n### Distinguish active voice from passive voice in simple sentences\n\nIn an active voice sentence, an actor acts on a target. That is, an active voice sentence follows this formula:\n\n> Active Voice Sentence = actor + verb + target\n\nA passive voice sentence reverses the formula. That is, a passive voice sentence typically follows the following formula:\n\n> Passive Voice Sentence = target + verb + actor\n\n#### Active voice example\n\nFor example, hereâ€™s a short, active voice sentence:\n\n> The cat sat on the mat.\n\n- actor: The cat\n- verb: sat\n- target: the mat\n\n#### Passive voice examples\n\nBy contrast, here's that same sentence in passive voice:\n\n> The mat was sat on by the cat.\n\n- target: The mat\n- passive verb: was sat\n- actor: the cat\n\nSome passive voice sentences omit an actor. For example:\n\n> The mat was sat on.\n\n- actor: *unknown*\n- passive verb: was sat\n- target: the mat\n\nWho or what sat on the mat? A cat? A dog? A T-Rex? Readers can only guess. Good sentences in technical documentation identify who is doing what to whom.\n\n### Recognize passive verbs\n\nPassive verbs typically have the following formula:\n\n```\npassive verb = form of be + past participle verb\n```\n\nAlthough the preceding formula looks daunting, it is actually pretty simple:\n\n- A **form of \\*be\\*** in a passive verb is typically one of the following words:\n  - is/are\n  - was/were\n- A **past participle verb** is typically a plain verb plus the suffix *ed*. For example, the following are past participle verbs:\n  - interpreted\n  - generated\n  - formed\n\nUnfortunately, some past participle verbs are irregular; that is, the past participle form does not end with the suffix *ed*. For example:\n\n- sat\n- known\n- frozen\n\nPutting the form of *be* and the past participle together yields passive verbs, such as the following:\n\n- was interpreted\n- is generated\n- was formed\n- is frozen\n\nIf the phrase contains an actor, a preposition ordinarily follows the passive verb. (That preposition is often a key clue to help you spot passive voice.) The following examples combine the passive verb and the preposition:\n\n- was interpreted as\n- is generated by\n- was formed by\n- is frozen by\n\n#### Imperative verbs are typically active\n\nIt is easy to mistakenly classify sentences starting with an imperative verb as passive. An **imperative verb** is a command. Many items in numbered lists start with imperative verbs. For example, *Open* and *Set* in the following list are both imperative verbs:\n\n1. Open the configuration file.\n2. Set the `Frombus` variable to `False`.\n\nSentences that start with an imperative verb are typically in active voice, even though they do not explicitly mention an actor. Instead, sentences that start with an imperative verb *imply* an actor. The implied actor is **you**.\n\n#### Exercise\n\nMark each of the following sentences as either **Passive** or **Active**:\n\n1. `MutableInput` provides read-only access.\n2. Read-only access is provided by `MutableInput`.\n3. Performance was measured.\n4. Python was invented by Guido van Rossum in the twentieth century.\n5. David Korn discovered the KornShell quite by accident.\n6. This information is used by the policy enforcement team.\n7. Click the Submit button.\n8. The orbit was calculated by Katherine Johnson.\n\n\n\n##### Answer\n\n1. **Active**. MutableInput provides read-only access.\n2. **Passive**. Read-only access is provided by MutableInput.\n3. **Passive**. Performance was measured.\n4. **Passive**. Python was invented by Guido van Rossum in the twentieth century.\n5. **Active**. David Korn discovered the KornShell quite by accident.\n6. **Passive**. This information is used by the policy enforcement team.\n7. **Active**. Click the Submit button. (*Click* is an imperative verb.) \n8. **Passive**. The orbit was calculated by Katherine Johnson.\n\n------\n\n### Distinguish active voice from passive voice in more complex sentences\n\nMany sentences contain multiple verbs, some of which are active and some of which are passive. For example, the following sentence contains two verbs, both of which are in passive voice:\n\n![A diagram of the following sentence: Code is interpreted by           Python, but code is compiled by C++.  The first half of the sentence           (Code is interpreted by Python) is in active voice, where a target           (Code) is acted on (is interpreted) by the actor (Python).           The second half of the sentence (code is compiled by C++) is also in           passive voice, where the target (code) is acted on (is compiled)           by the actor (C++).](https://developers.google.com/tech-writing/one/images/passive-passive.svg?hl=zh-cn)\n\n \n\n\n\nHere is that same sentence, partially converted to active voice:\n\n![A diagram of the following sentence: Python interprets code,           but code is compiled by C++.  The first half of the sentence           (Python interprets code) is in active voice, where an actor           (Python) acts on (interprets) a target (code). The second half           of the sentence (code is compiled by C++) is in passive voice,           where the target (code) is acted on (is compiled) by the           actor (C++).](https://developers.google.com/tech-writing/one/images/active-passive.svg?hl=zh-cn)\n\n \n\n\n\nAnd here is that same sentence, now fully converted to active voice:\n\n![A diagram of the following sentence: Python interprets code,           but C++ compiles code.  The first half of the sentence           (Python interprets code) is in active voice, where an actor           (Python) acts on (interprets) a target (code). The second half           of the sentence (C++ compiles code) is also in active voice,           where the actor (C++) acts on (compiles) the target (code).](https://developers.google.com/tech-writing/one/images/all-active.svg?hl=zh-cn)\n\n \n\n\n\n#### Exercise\n\nEach of the following sentences contains two verbs. Categorize each of the verbs in the following sentences as either active or passive. For example, if the first verb is active and the second is passive, write **Active, Passive**.\n\n1. The QA team loves ice cream, but their managers prefer sorbet.\n2. Performance metrics are required by the team, though I prefer wild guesses.\n3. When software engineers attempt something new and innovative, a reward should be given.\n\n\n\n##### Answer.\n\n1. **Active, Active.** The QA team loves ice cream, but their managers prefer sorbet.\n2. **Passive, Active.** Performance metrics are required by the team, though I prefer wild guesses.\n3. **Active, Passive.** When software engineers attempt something new and innovative, a reward should be given.\n\n### Prefer active voice to passive voice\n\nUse the active voice most of the time. Use the passive voice sparingly. Active voice provides the following advantages:\n\n- Most readers mentally convert passive voice to active voice. Why subject your readers to extra processing time? By sticking to active voice, readers can skip the preprocessor stage and go straight to compilation.\n- Passive voice obfuscates your ideas, turning sentences on their head. Passive voice reports action indirectly.\n- Some passive voice sentences omit an actor altogether, which forces the reader to guess the actor's identity.\n- Active voice is generally shorter than passive voice.\n\nBe boldâ€”be active.\n\n#### Scientific research reports (optional material)\n\nThe writing in research reports tends to be understated. Here, for example, is one of the most famous passages in twentieth century science writing, from Crick and Watson's 1953 paper in *Nature* entitled, *Molecular Structure of Nucleic Acids: A Structure for Deoxyribose Nucleic Acid*:\n\n> It has not escaped our notice that the specific pairing we have postulated immediately suggests a possible copying mechanism for the genetic material.\n\nThe authors are so excited about their discovery that they're whispering it from the rooftops.\n\nPassive voice thrives in a tentative landscape. In research reports, experimenters and their equipment often disappear, leading to passive sentences that start off as follows:\n\n- It has been suggested that...\n- Data was taken...\n- Statistics were calculated...\n- Results were evaluated.\n\nDo we know who is doing what to whom? No. Does the passive voice somehow make the information more objective? No.\n\nMany scientific journals have embraced active voice. We encourage the remainder to join the quest for clarity.\n\n#### Exercise\n\nRewrite the following passive voice sentences as active voice. Only part of certain sentences are in passive voice; ensure that all parts end up as active voice:\n\n1. The flags were not parsed by the Mungifier.\n2. A wrapper is generated by the Op registration process.\n3. Only one experiment per layer is selected by the Frombus system.\n4. Quality metrics are identified by asterisks; ampersands identify bad metrics.\n\n\n\n##### Answer.\n\n1. The Mungifier did not parse the flags.\n2. The Op registration process generates a wrapper.\n3. The Frombus system selects only one experiment per layer.\n4. Asterisks identify quality metrics; ampersands identify bad metrics.\n\n\n\n## Clear sentences\n\n>  **Estimated Time:** 10 minutes\n\n\n\nComedy writers seek the funniest results, horror writers strive for the scariest, and technical writers aim for the clearest. In technical writing, clarity takes precedence over all other rules. This unit suggests a few ways to make your sentences beautifully clear.\n\n### Choose strong verbs\n\nMany technical writers believe that the verb is the most important part of a sentence. Pick the right verb and the rest of the sentence will take care of itself. Unfortunately, some writers reuse only a small set of mild verbs, which is like serving your guests stale crackers and soggy lettuce every day. Picking the right verb takes a little more time but produces more satisfying results.\n\nTo engage and educate readers, choose precise, strong, specific verbs. Reduce imprecise, weak, or generic verbs, such as the following:\n\n- forms of *be*: is, are, am, was, were, etc.\n- occur\n- happen\n\nFor example, consider how strengthening the weak verb in the following sentences ignites a more engaging sentence:\n\n| Weak Verb                                             | Strong Verb                                         |\n| :---------------------------------------------------- | :-------------------------------------------------- |\n| The error **occurs** when clicking the Submit button. | Clicking the Submit button **triggers** the error.  |\n| This error message **happens** when...                | The system **generates** this error message when... |\n| We **are** very careful to ensure...                  | We carefully **ensure**...                          |\n\nMany writers rely on forms of *be* as if they were the only spices on the rack. Sprinkle in different verbs and watch your prose become more appetizing. That said, a form of *be* is sometimes the best choice of verb, so don't feel that you have to eliminate every form of *be* from your writing.\n\nNote that generic verbs often signal other ailments, such as:\n\n- an imprecise or missing actor in a sentence\n- a passive voice sentence\n\n#### Exercise\n\nClarify the following sentences by picking more specific verbs. Along the way, feel free to rearrange the sentences and to add, modify, or delete words:\n\n1. When a variable declaration doesn't have a datatype, a compiler error happens.\n2. Compiler errors occur when you leave off a semicolon at the end of a statement.\n\n\n\n##### Answer.\n\n1. A few possible answers:\n   - When a variable declaration doesn't **specify** a datatype, the compiler **generates** an error message.\n   - If you **declare** a variable but don't **specify** a datatype, the compiler **generates** an error message.\n2. A few possible answers:\n   - Compilers **issue** errors when you **omit** a semicolon at the end of a statement.\n   - A missing semicolon at the end of a statement **triggers** compiler errors.\n\n------\n\n### Reduce there is/there are\n\nSentences that start with **There is** or **There are** marry a generic noun to a generic verb. Generic weddings bore readers. Show true love for your readers by providing a real subject and a real verb.\n\nIn the best case scenario, you may simply delete **There is** or **There are** (and possibly another word or two later in the sentence). For example, consider the following sentence:\n\n> There is a variable called `met_trick` that stores the current accuracy.\n\nRemoving **There is** replaces the generic subject with a better subject. For example, either of the following sentences is clearer than the original:\n\n> A variable named `met_trick` stores the current accuracy. The `met_trick` variable stores the current accuracy.\n\nYou can sometimes repair a **There is** or **There are** sentence by moving the true subject and true verb from the end of the sentence to the beginning. For example, notice that the pronoun **you** appears towards the end of the following sentence:\n\n> There are two disturbing facts about Perl you should know.\n\nReplacing **There are** with **You** strengthens the sentence:\n\n> You should know two disturbing facts about Perl.\n\nIn still other situations, writers start sentences with **There is** or **There are** to avoid the hassle of creating true subjects or verbs. If no subject exists, consider creating one. For example, the following **There is** sentence does not identify the receiving entity:\n\n> There is no guarantee that the updates will be received in sequential order.\n\nReplacing \"There is\" with a meaningful subject (such as **clients**) creates a clearer experience for the reader:\n\n> Clients might not receive the updates in sequential order.\n\n#### Exercise\n\nClarify the following sentences by removing **There is**, and possibly rearranging, adding, modifying, or deleting other words:\n\n1. There is a lot of overlap between X and Y.\n2. There is no creator stack for the main thread.\n3. There is a low-level, TensorFlow, Python interface to load a saved model.\n4. There is a sharding function named `distribute` that assigns keys.\n\n\n\n##### Answer.\n\n1. X and Y overlap a lot.\n2. The main thread does not provide a creator stack.\n3. TensorFlow provides a low-level Python interface to load a saved model.\n4. The `distribute` sharding function assigns keys.\n\n------\n\n### Minimize certain adjectives and adverbs (optional)\n\nAdjectives and adverbs perform amazingly well in fiction and poetry. Thanks to adjectives, plain old grass becomes **prodigal** and **verdant**, while lifeless hair transforms into something **silky** and **flowing**. Adverbs push horses to run **madly** and **freely** and dogs to bark **loudly** and **ferociously**. Unfortunately, adjectives and adverbs sometimes make technical readers bark loudly and ferociously. That's because adjectives and adverbs tend to be too loosely defined and subjective for technical readers. Worse, adjectives and adverbs can make technical documentation sound dangerously like marketing material. For example, consider the following passage from a technical document:\n\n> Setting this flag makes the application run screamingly fast.\n\nGranted, **screamingly fast** gets readers attention but not necessarily in a good way. Feed your technical readers factual data instead of marketing speak. Refactor amorphous adverbs and adjectives into objective numerical information. For example:\n\n> Setting this flag makes the application run 225-250% faster.\n\nDoes the preceding change strip the sentence of some of its charm? Yes, a little, but the revamped sentence gains accuracy and believability.\n\n**Note:** Don't confuse educating your readers (technical writing) with publicizing or selling a product (marketing writing). When your readers expect education, provide education; don't intersperse publicity or sales material inside educational material.\n\n\n\n## Short sentences\n\n>  **Estimated Time:** 20 minutes\n\n\n\nSoftware engineers generally try to minimize the number of lines of code in an implementation for the following reasons:\n\n- Shorter code is typically easier for others to read.\n- Shorter code is typically easier to maintain than longer code.\n- Extra lines of code introduce additional points of failure.\n\nIn fact, the same rules apply to technical writing:\n\n- Shorter documentation reads faster than longer documentation.\n- Shorter documentation is typically easier to maintain than longer documentation.\n- Extra lines of documentation introduce additional points of failure.\n\nFinding the shortest documentation implementation takes time but is ultimately worthwhile. Short sentences communicate more powerfully than long sentences, and short sentences are usually easier to understand than long sentences.\n\n### Focus each sentence on a single idea\n\nFocus each sentence on a single idea, thought, or concept. Just as statements in a program execute a single task, sentences should execute a single idea. For example, the following very long sentence contains multiple thoughts:\n\n> The late 1950s was a key era for programming languages because IBM introduced FORTRAN in 1957 and John McCarthy introduced Lisp the following year, which gave programmers both an iterative way of solving problems and a recursive way.\n\nBreaking the long sentence into a succession of single-idea sentences yields the following result:\n\n> The late 1950s was a key era for programming languages. IBM introduced FORTRAN in 1957. John McCarthy invented Lisp the following year. Consequently, by the late 1950s, programmers could solve problems iteratively or recursively.\n\n#### Exercise\n\nConvert the following overly long sentence to a series of shorter sentences. Don't revise too much; just end up with a few sentences instead of only one.\n\n> In bash, use the if, then, and fi statements to implement a simple conditional branching block in which the if statement evaluates an expression, the then statement introduces a block of statements to run when the if expression is true, and the fi statement marks the end of the conditional branching block.\n\n\n\n##### Answer.\n\nIn bash, use an `if`, `then`, and `fi` statement to implement a simple conditional branching block. The `if` statement evaluates an expression. The `then` statement introduces a block of statements to run when the `if` expression is true. The `fi` statement marks the end of the conditional branching block. (The resulting paragraph remains unclear but is still much easier to read than the original sentence.)\n\n------\n\n### Convert some long sentences to lists\n\nInside many long technical sentences is a list yearning to break free. For example, consider the following sentence:\n\n> To alter the usual flow of a loop, you may use either a **break** statement (which hops you out of the current loop) or a **continue** statement (which skips past the remainder of the current iteration of the current loop).\n\nWhen you see the conjunction **or** in a long sentence, consider refactoring that sentence into a bulleted list. When you see an embedded list of items or tasks within a long sentence, consider refactoring that sentence into a bulleted or numbered list. For example, the preceding example contains the conjunction **or**, so let's convert that long sentence to the following bulleted list:\n\n------\n\nTo alter the usual flow of a loop, call one of the following statements:\n\n- `break`, which hops you out of the current loop.\n\n- `continue`, which skips past the remainder of the current iteration of the current loop.\n\n------\n\n#### Exercise\n\nRefactor the following sentences into something shorter and clearer. Make sure that your answer contains a list:\n\n1. To get started with the Frambus app, you must first find the app at a suitable store, pay for it using a valid credit or debit card, download it, configure it by assigning a value for the `Foo` variable in the `/etc/Frambus` file, and then run it by saying the magic word twice.\n2. KornShell was invented by David Korn in 1983, then a computer scientist at Bell Labs, as a superset of features, enhancements, and improvements over the Bourne Shell (which it was backwards compatible with), which was invented by Stephen Bourne in 1977 who was also a computer scientist at Bell Labs.\n\n\n\n##### Answer.\n\nTake the following steps to get started with the Frambus app:\n\n1. Find the app at a suitable store.\n2. Pay for the app using a valid credit or debit card.\n3. Download the app.\n4. Configure the app by assigning a value for the Foo variable in the `/etc/Frambus` file.\n5. Run the app by saying the magic word twice.\n\nThe following two Bell Labs computer scientists invented popular shells:\n\n- Stephen Bourne invented the Bourne Shell in 1977.\n- David Korn invented the KornShell in 1983.\n\nThe KornShell's features are a backwards-compatible superset of the Bourne Shell's.\n\n------\n\n### Eliminate or reduce extraneous words\n\nMany sentences contain fillerâ€”textual junk food that consumes space without nourishing the reader. For example, see if you can spot the unnecessary words in the following sentence:\n\n> An input value greater than 100 causes the triggering of logging.\n\nReplacing **causes the triggering of** with the much shorter verb **triggers** yields a shorter sentence:\n\n> An input value greater than 100 triggers logging.\n\nWith practice, you'll spot the extraneous words and take inordinate glee in removing or reducing them. For example, consider the following sentence:\n\n> This design document provides a detailed description of Project Frambus.\n\nThe phrase **provides a detailed description of** reduces to the verb **details**, so the resulting sentence becomes:\n\n> This design document details Project Frambus.\n\nThe following table suggests replacements for a few common bloated phrases:\n\n| Wordy                     | Concise |\n| :------------------------ | :------ |\n| at this point in time     | now     |\n| determine the location of | find    |\n| is able to                | can     |\n\n#### Exercise\n\nShorten the following sentences without changing their meaning:\n\n1. In spite of the fact that Arnold writes buggy code, he writes error-free documentation.\n2. Changing the sentence from passive voice to active voice enhances the clarification of the key points.\n3. Determine whether Rikona is able to write code in COBOL.\n4. Frambus causes the production of bugs, which will be chronicled in logs by the LogGenerator method.\n\n\n\n##### Answer.\n\nHere are some possible solutions:\n\n1. Although Arnold writes buggy code, he writes error-free documentation. \n   **Alternative answer:** Arnold writes buggy code. However, he writes error-free documentation.\n2. Changing the sentence from passive voice to active voice clarifies the key points.\n3. Determine whether Rikona can code in COBOL.\n4. Frambus produces bugs, which the LogGenerator method logs.\n\n------\n\n### Reduce subordinate clauses (optional)\n\nA **clause** is an independent logical fragment of a sentence, which contains an actor and an action. Every sentence contains the following:\n\n- a main clause\n- zero or more subordinate clauses\n\nSubordinate clauses modify the idea in the main clause. As the name implies, subordinate clauses are less important than the main clause. For example, consider the following sentence:\n\n> Python is an interpreted programming language, which was invented in 1991.\n>\n> - main clause: Python is an interpreted programming language\n> - subordinate clause: which was invented in 1991\n\nYou can usually identify subordinate clauses by the words that introduce them. The following list (by no means complete) shows common words that introduce subordinate clauses:\n\n- which\n- that\n- because\n- whose\n- until\n- unless\n- since\n\nSome subordinate clauses begin with a comma and some don't. The highlighted subordinate clause in the following sentence, for example, begins with the word **because** and does not contain a comma:\n\n> I prefer to code in C++ because I like strong data typing.\n\nWhen editing, scrutinize subordinate clauses. Keep the `one sentence = one idea` formula in mind. Do the subordinate clauses in a sentence *extend* the single idea or do they *branch off* into a separate idea? If the latter, consider dividing the offending subordinate clause(s) into separate sentences.\n\n#### Exercise\n\nDetermine which of the sentences contain subordinate clauses that should be branched off into separate sentences. (Don't rewrite the sentences, just identify the sentences that should be rewritten.)\n\n1. Python is an interpreted language, which means that the language can execute source code directly.\n2. Bash is a modern shell scripting language that takes many of its features from KornShell 88, which was developed at Bell Labs.\n3. Lisp is a programming language that relies on Polish prefix notation, which is one of the systems invented by the Polish logician Jan Åukasiewicz.\n4. I don't want to say that FORTRAN is old, but only radiocarbon dating can determine its true age.\n\n\n\n##### Answer.\n\nWe've shaded the subordinate clauses.\n\n1. Python is an interpreted language, which means that the language can execute source code directly. **The subordinate clause in this sentence extends the main idea, so this sentence is fine as is.**\n2. Bash is a modern shell scripting language that takes many of its features from KornShell 88, which was developed at Bell Labs. **The first subordinate clause extends the main idea, but the second subordinate clause goes in another direction. Divide this sentence in two.**\n3. Lisp is a programming language that relies on Polish prefix notation, which is one of the systems invented by the Polish logician Jan Åukasiewicz. **The first subordinate clause is clearly critical to the sentence, but the second subordinate clause takes the reader too far away from the main clause. Divide this sentence in two.**\n4. I don't want to say that Fortran is old, but only radiocarbon dating can determine its true age. **The subordinate clause is critical to the sentence, so this sentence is fine as is.**\n\n------\n\n### Distinguish that from which\n\n**That** and **which** both introduce subordinate clauses. What's the difference between them? Well, in some countries, the two words are pretty much interchangeable. Inevitably though, alert American readers will angrily announce that you confused the two words again.\n\nIn America, reserve **which** for subordinate clauses that are nonessential parts of the sentence, and use **that** for an essential phrase that the sentence can't live without. For example:\n\n> Python is an interpreted language, **which** means the processor runs the program directly.\n>\n> FORTRAN is perfect for mathematical calculations **that** don't involve linear algebra.\n\nWas that explanation useful? Probably not. Try this instead: if you read a sentence aloud and hear a pause just before the subordinate clause, then use **which**. If you don't hear a pause, use **that**. Go back and read the two example sentences. Did you hear the pause in the first sentence?\n\nPlace a comma before **which**; do not place a comma before **that**.\n\n\n\n## Lists and tables\n\n> **Estimated Time:** 15 minutes\n\n\n\nGood lists can transform technical chaos into something orderly. Technical readers generally love lists. Therefore, when writing, seek opportunities to convert prose into lists.\n\n### Choose the correct type of list\n\nThe following types of lists dominate technical writing:\n\n- bulleted lists\n- numbered lists\n- embedded lists\n\nUse a **bulleted list** for *unordered* items; use a **numbered list** for *ordered* items. In other words:\n\n- If you rearrange the items in a *bulleted* list, the list's meaning does not change.\n- If you rearrange the items in a *numbered* list, the list's meaning *changes*.\n\nFor example, we've made the following a bulleted list because rearranging its items does not change the list's meaning:\n\n> Bash provides the following string manipulation mechanisms:\n>\n> - deleting a substring from the start of a string\n> - reading an entire file into one string variable\n\nThe following list, by contrast, must be a numbered list because rearranging its items would change the list's meaning:\n\n> Take the following steps to reconfigure the server:\n>\n> 1. Stop the server.\n> 2. Edit the configuration file.\n> 3. Restart the server.\n\nAn **embedded list** (sometimes called a **run-in** list) contains items stuffed within a sentence. For example, the following sentence contains an embedded list with four items.\n\n> The llamacatcher API enables callers to create and query llamas, analyze alpacas, delete vicugnas, and track dromedaries.\n\nGenerally speaking, embedded lists are a poor way to present technical information. Try to transform embedded lists into either bulleted lists or numbered lists. For example, you should convert the sentence containing the embedded list into the following passage:\n\n> The llamacatcher API enables callers to do the following:\n>\n> - Create and query llamas.\n> - Analyze alpacas.\n> - Delete vicugnas.\n> - Track dromedaries.\n\n#### Exercise\n\nConvert the following paragraph into one or more lists:\n\n> Today at work, I have to code three unit tests, write a design document, and review Janet's latest document. After work, I have to wash my car without using any water and then dry it without using any towels.\n\nDon't forget to introduce your list(s).\n\n\n\n##### Answer.\n\nHere's one possible answer:\n\n> I must do the following at work today:\n>\n> - Code three unit tests.\n> - Write a design document.\n> - Review Janet's latest document.\n>\n> After work, I must do the following:\n>\n> 1. Wash my car without using any water.\n> 2. Dry my car without using any towels.\n\nThe following is an alternative answer:\n\n> I must do the following tasks today:\n>\n> - At work:\n>   - Code three unit tests.\n>   - Write a design document.\n>   - Review Janet's latest document.\n> - After work:\n>   1. Wash my car without using any water.\n>   2. Dry my car without using any towels.\n\n------\n\n### Keep list items parallel\n\nWhat separates effective lists from defective lists? Effective lists are parallel; defective lists tend to be nonparallel. All items in a **parallel** list look like they \"belong\" together. That is, all items in a parallel list match along the following parameters:\n\n- grammar\n- logical category\n- capitalization\n- punctuation\n\nConversely, at least one item in a **nonparallel** list fails at least one of the preceding consistency checks.\n\nFor example, the following list is parallel because all the items are plural nouns (grammar), edible (logical category), lower case (capitalization), and without periods or commas (punctuation).\n\n- carrots\n- potatoes\n- cabbages\n\nBy contrast, the following list is painfully nonparallel along all four parameters:\n\n- carrots\n- potatoes\n- The summer light obscures all memories of winter.\n\nThe following list is parallel because all the items are complete sentences with complete sentence capitalization and punctuation:\n\n- Carrots contain lots of Vitamin A.\n- Potatoes taste delicious.\n- Cabbages provide oodles of Vitamin K.\n\nThe first item in a list establishes a pattern that readers expect to see repeated in subsequent items.\n\n#### Exercise\n\nIs the following list parallel or nonparallel?\n\n- Broccoli inspires feelings of love or hate.\n- Potatoes taste delicious.\n- Cabbages.\n\n\n\n##### Answer.\n\nThe list is nonparallel. The first two items are complete sentences, but the third item is not a sentence. (Don't be fooled by the capitalization and punctuation of the third item.)\n\n------\n\n#### Exercise\n\nIs the following list parallel or nonparallel?\n\n- The red dots represent sick trees.\n- Immature trees are represented by the blue dots.\n- The green dots represent healthy trees.\n\n\n\n##### Answer.\n\nThis is a nonparallel list. The first and third items are in active voice, but the second item is in passive voice.\n\n------\n\n### Start numbered list items with imperative verbs\n\nConsider starting all items in a numbered list with an imperative verb. An **imperative verb** is a command, such as **open** or **start**. For example, notice how all of the items in the following parallel numbered list begin with an imperative verb:\n\n1. Download the Frambus app from Google Play or iTunes.\n2. Configure the Frambus app's settings.\n3. Start the Frambus app.\n\nThe following numbered list is nonparallel because two of the sentences start with an imperative verb, but the third item does not:\n\n1. Instantiate the Froobus class.\n2. Invoke the Froobus.Salmonella() method.\n3. The process stalls.\n\n#### Exercise\n\nMake the following list parallel. Ensure that each element in the result list begins with an imperative verb:\n\n1. Stop FrÃ¼vous\n2. The key configuration file is `/moxy/fruvous`. Open this file with an ASCII text editor.\n3. In this file, you will see a parameter named Carambola, which is currently set to the default value (32). Change this value to 64.\n4. When you are finished setting this parameter, save and close the configuration file\n5. now, start FrÃ¼vous again.\n\n\n\n##### Answer.\n\nThe following is one possible answer:\n\n1. Stop FrÃ¼vous.\n2. Open the key configuration file, `/moxy/fruvous`, with an ASCII text editor.\n3. Change the Carambola parameter from its default value (32) to 64.\n4. Save and close the configuration file.\n5. Restart FrÃ¼vous.\n\n------\n\nPunctuate items appropriately\n\nIf the list item is a sentence, use sentence capitalization and punctuation. Otherwise, do not use sentence capitalization and punctuation. For example, the following list item is a sentence, so we capitalized the **M** in **Most**and put a period at the end of the sentence:\n\n- Most carambolas have five ridges.\n\nHowever, the following list item is not a sentence, so we left the **t** in **the** in lowercase and omitted a period:\n\n- the color of lemons\n\n###Create useful tables\n\nAnalytic minds tend to love tables. Given a page containing multiple paragraphs and a single table, engineers' eyes zoom towards the table.\n\nConsider the following guidelines when creating tables:\n\n- Label each column with a meaningful header. Don't make readers guess what each column holds.\n- Avoid putting too much text into a table cell. If a table cell holds more than two sentences, ask yourself whether that information belongs in some other format.\n- Although different columns can hold different types of data, strive for parallelism *within* individual columns. For instance, the cells within a particular table column should not be a mixture of numerical data and famous circus elephants.\n\n**Note:** Some tables don't render well across all form factors. For example, a table that looks great on your laptop may look awful on your phone.\n\n### Introduce each list and table\n\nWe recommend introducing each list and table with a sentence that tells readers what the list or table represents. In other words, give the list or table context. Terminate the introductory sentence with a colon rather than a period.\n\nAlthough not a requirement, we recommend putting the word **following** into the introductory sentence. For example, consider the following introductory sentences:\n\n> The following list identifies key performance parameters:\n>\n> Take the following steps to install the Frambus package:\n>\n> The following table summarizes our product's features against our key competitors' features:\n\n#### Exercise\n\nWrite an introductory sentence for the following table:\n\n| Languages | Inventor          | Year Introduced | Key Feature |\n| :-------- | :---------------- | :-------------- | :---------- |\n| Lisp      | John McCarthy     | 1958            | recursion   |\n| C++       | Bjarne Stroustrup | 1979            | OOP         |\n| Python    | Guido van Rossum  | 1994            | simplicity  |\n\n\n\n##### Answer.\n\nHere are a couple of possible introductory sentences for the table:\n\n> The following table contains a few key facts about some popular programming languages:\n\n> The following table identifies the inventor, year of invention, and key feature of three popular programming languages:\n\n------\n\n\n\n## Paragraphs\n\n> **Estimated Time:** 10 minutes\n\n\n\nThis unit provides some guidelines on building cohesive paragraphs. But first, here is an inspirational message:\n\n> The work of writing is *simply* this: untangling the dependencies among the parts of a topic, and presenting those parts in a logical stream that enables the reader to understand you.\n\n### Write a great opening sentence\n\nThe opening sentence is the most important sentence of any paragraph. Busy readers focus on opening sentences and sometimes skip over subsequent sentences. Therefore, focus your writing energy on opening sentences.\n\nGood opening sentences establish the paragraph's central point. For example, the following paragraph features an effective opening sentence:\n\n> A loop runs the same block of code multiple times. For example, suppose you wrote a block of code that detected whether an input line ended with a period. To evaluate a million input lines, create a loop that runs a million times.\n\nThe preceding opening sentence establishes the theme of the paragraph as an introduction to loops. By contrast, the following opening sentence sends readers in the wrong direction:\n\n> A block of code is any set of contiguous code within the same function. For example, suppose you wrote a block of code that detected whether an input line ended with a period. To evaluate a million input lines, create a loop that runs a million times.\n\n#### Exercise\n\nIs the opening sentence of the following paragraph effective or defective?\n\n> The Pythagorean Theorem states that the sum of the squares of both legs of a right triangle is equal to the square of the hypotenuse. The k-means clustering algorithm relies on the Pythagorean Theorem to measure distances. By contrast, the k-median clustering algorithm relies on the Manhattan Distance.\n\n\n\n##### Answer.\n\nThis opening sentence is **defective** because it implies that the paragraph will focus on the Pythagorean Theorem. In fact, the paragraph's focus is actually clustering algorithms. The following would be a more effective opening sentence:\n\n> Different clustering algorithms measure distances differently.\n\n------\n\n \n\n**Note:** Effective opening sentences can take many forms. That is, not all great paragraphs start with a sentence that states the theme. Starting a paragraph with a rhetorical question, for example, can engage readers.\n\n### Focus each paragraph on a single topic\n\nA paragraph should represent an independent unit of logic. Restrict each paragraph to the current topic. Don't describe what will happen in a future topic or what happened in a past topic. When revising, ruthlessly delete (or move to another paragraph) any sentence that doesn't directly relate to the current topic.\n\nFor example, assume that the opening sentence of the following paragraph does focus on the correct topic. Can you spot the sentences that should be removed from the following paragraph?\n\n> The Pythagorean Theorem states that the sum of the squares of both legs of a right triangle is equal to the square of the hypotenuse. The perimeter of a triangle is equal to the sum of the three sides. You can use the Pythagorean Theorem to measure diagonal distances. For example, if you know the length and width of a ping-pong table, you can use the Pythagorean Theorem to determine the diagonal distance. To calculate the perimeter of the ping-pong table, sum the length and the width, and then multiply that sum by 2.\n\nWe've crossed out the second and fifth sentences to yield a paragraph focused exclusively on the Pythagorean Theorem:\n\n> The Pythagorean Theorem states that the sum of the squares of both legs of a right triangle is equal to the square of the hypotenuse. ~~The perimeter of a triangle is equal to the sum of the three sides.~~ You can use the Pythagorean Theorem to measure diagonal distances. For example, if you know the length and width of a ping-pong table, you can use the Pythagorean Theorem to determine the diagonal distance. ~~To calculate the perimeter of the ping-pong table, sum the length and the width, and then multiply that sum by 2.~~\n\n#### Exercise\n\nRemove the extraneous sentence(s) from the following paragraph. Assume that the opening sentence does establish the desired theme for the paragraph:\n\n> **Spreadsheets** provide a great way to organize data. Think of a spreadsheet as a table with rows and columns. Spreadsheets also provide mathematical functions, such as means and standard deviations. Each row holds details about one entity. Each column holds details about a particular parameter. For example, you can create a spreadsheet to organize data about different trees. Each row would represent a different type of tree. Each column would represent a different characteristic, such as the tree's height or the tree's spread.\n\n\n\n##### Answer.\n\nThe paragraph focuses on spreadsheets as a way of organizing data. The third sentence distracts from that theme. Move the third sentence to another paragraph about mathematical operations in spreadsheets.\n\n> **Spreadsheets** provide a great way to organize data. Think of a spreadsheet as a table with rows and columns. ~~Spreadsheets also provide mathematical functions, such as means and standard deviations.~~ Each row holds details about one entity. Each column holds details about a particular parameter. For example, you can create a spreadsheet to organize data about different trees. Each row would represent a different type of tree. Each column would represent a different characteristic, such as the tree's height or the tree's spread.\n\n------\n\n### Don't make paragraphs too long or too short\n\nLong paragraphs are visually intimidating. *Very* long paragraphs form a dreaded \"wall of text\" that readers ignore. Readers generally welcome paragraphs containing three to five sentences, but will avoid paragraphs containing more than about seven sentences. When revising, consider dividing very long paragraphs into two separate paragraphs.\n\nConversely, don't make paragraphs too short. If your document contains plenty of one-sentence paragraphs, your organization is faulty. Seek ways to combine those one-sentence paragraphs into cohesive multi-sentence paragraphs or possibly into lists.\n\n### Answer what, why, and how\n\nGood paragraphs answer the following three questions:\n\n1. **What** are you trying to tell your reader?\n2. **Why** is it important for the reader to know this?\n3. **How** should the reader use this knowledge. Alternatively, how should the reader know your point to be true?\n\nFor example, the following paragraph answers what, why, and how:\n\n\n> `<Start of What>` The `garp()` function returns the delta between a dataset's mean and median.`<End of What>` \n> `<Start of Why>`Many people believe unquestioningly that a mean always holds the truth. However, a mean is easily influenced by a few very large or very small data points. `<End of Why>`\n> `<Start of How>`Call `garp()` to help determine whether a few very large or very small data points are influencing the mean too much. A relatively small `garp()` value suggests that the mean is more meaningful than when the `garp()` value is relatively high.`<End of How>`\n\n\n\n## Audience\n\n> **Estimated Time:** 10 minutes\n\nThe course designers believe that you are probably comfortable with mathematics. Therefore, this unit begins with an equation:\n\n> good documentation = knowledge and skills your audience needs to do a task âˆ’ your audience's current knowledge and skills\n\nIn other words, make sure your document provides the information your audience needs that your audience doesn't already have. Therefore, this unit explains how to do the following:\n\n- Define your audience.\n- Determine what your audience needs to learn.\n- Fit documentation to your audience.\n\nAs the following video suggests, targeting the *wrong* audience can be messy: https://youtu.be/eFtXIrmsMwI\n\n\n\n### Define your audience\n\nSerious documentation efforts spend considerable time and energy on defining their audience. These efforts might involve surveys, user experience studies, focus groups, and documentation testing. You probably don't have that much time, so this unit takes a simpler approach.\n\nBegin by identifying your audience's **role**(s). Sample roles include:\n\n- software engineers\n- technical, non-engineer roles (such as technical program managers)\n- scientists\n- professionals in scientific fields (for example, physicians)\n- undergraduate engineering students\n- graduate engineering students\n- non-technical positions\n\nWe happily appreciate that many people in non-technical roles have great technical and mathematical skills. However, roles remain an essential first-order approximation in defining your audience. People within the same role*generally* share certain base skills and knowledge. For example:\n\n- Most software engineers know popular sorting algorithms, big O notation, and at least one programming language. Therefore, you can depend on software engineers knowing what O(n) means, but you can't depend on non-technical roles knowing O(n).\n- A research report targeted at physicians should look very different from a newspaper article about the same research aimed at a lay audience.\n- A professor's explanation of a new machine learning approach to graduate students should differ from the explanation to first-year undergraduate students.\n\nWriting would be so much easier if everyone in the same role shared exactly the same knowledge. Unfortunately, knowledge within the same role quickly diverges. Amal is an expert in Python, Sharon's expertise is C++, and Micah's is in Java. Kara loves Linux, but David only knows iOS.\n\nRoles, by themselves, are insufficient for defining an audience. That is, you must also consider your audience's *proximity* to the knowledge. The software engineers in Project Frombus know something about related Project Dingus but nothing about unrelated Project Carambola. The average heart specialist knows more about ear problems than the average software engineer but far less than an audiologist.\n\nTime also affects proximity. Almost all software engineers, for example, studied calculus. However, most software engineers don't use calculus in their jobs, so their knowledge of calculus gradually fades. Conversely, experienced engineers typically know vastly more about their current project than new engineers on the same project.\n\n#### Sample audience analysis\n\nThe following is a sample audience analysis for fictitious Project Zylmon:\n\n> The target audience for Project Zylmon falls into the following roles:\n>\n> - software engineers\n> - technical product managers\n>\n> The target audience has the following proximity to the knowledge:\n>\n> - My target audience already knows the Zyljeune APIs, which are somewhat similar to the Zylmon APIs.\n> - My target audience knows C++, but has not typically built C++ programs in the new Winged Victory development environment.\n> - My target audience took linear algebra in university, but many members of the team need a refresher on matrix multiplication.\n\n### Determine what your audience needs to learn\n\nWrite down a list of everything your target audience needs to learn to accomplish goals. In some cases, the list should hold tasks that the target audience needs to *perform*. For example:\n\n> After reading the documentation, the audience will know how to do the following tasks:\n\n> - Use the Zylmon API to list hotels by price.\n> - Use the Zylmon API to list hotels by location.\n> - Use the Zylmon API to list hotels by user ratings.\n\nNote that your audience must sometimes master tasks in a certain order. For example, your audience might need to learn how to build and execute programs in a new development environment *before* learning how to write particular kinds of programs.\n\nIf you are writing a design spec, then your list should focus on information your target audience should learn rather than on mastering specific tasks: For example:\n\n> After reading the design spec, the audience will learn the following:\n\n> - Three reasons why Zylmon outperforms Zyljeune.\n> - Five reasons why Zylmon consumed 5.25 engineering years to develop.\n\n### Fit documentation to your audience\n\nWriting to meet your audience's needs requires unselfish empathy. You must create explanations that satisfy your audience's curiosity rather than your own. How do you step out of yourself in order to fit documentation to the audience? Unfortunately, we can offer no easy answers. We can, however, offer a few parameters to focus on.\n\n#### Vocabulary and concepts\n\nMatch your vocabulary to your audience. See [Words](https://developers.google.com/tech-writing/one/words?hl=zh-cn) for help.\n\nBe mindful of proximity. The people on your team probably understand your team's abbreviations, but do people on other teams understand those same abbreviations? As your target audience widens, assume that you must explain more.\n\nSimilarly, experienced people on your software team probably understand the implementation details and data structures of your team's project, but nearly everyone else (including new members of your team) does not. Unless you are writing specifically for other experienced members of your team, you typically must explain more than you expect.\n\n####Curse of knowledge\n\nExperts often suffer from **the curse of knowledge**, which means that their expert understanding of a topic ruins their explanations to newcomers. As experts, it is easy to forget that novices donâ€™t know what you already know. Novices might not understand explanations that make passing reference to subtle interactions and deep systems that the expert doesnâ€™t stop to explain.\n\nFrom the novice's point of view, the curse of knowledge is a \"File not found\" linker error due to a module not yet compiled.\n\n#### Exercise\n\n1. Assume that the following paragraph is the start of a paper aimed at physicians who have never programmed before. Identify the aspects of the paragraph that suffer from the curse of knowledge:\n\n   > C is a mid-level language, higher than assembly language but lower than Python and Java. The C language provides programmers fine-grained control over all aspects of a program. For example, using the C Standard Library, it is easy to allocate and free blocks of memory. In C, manipulating pointers directly is mundane.\n\n2. Suppose the preceding paragraph was aimed at undergraduate computer science students new to C but comfortable with Python. Does the paragraph still suffer from the curse of knowledge?\n\n\n\n##### Answer.\n\n1. This paragraph suffers immensely from the curse of knowledge. The target audience has never programmed before, so the following terms are inappropriate or unfamiliar:\n   - language\n   - mid-level language\n   - assembly language\n   - Python\n   - Java\n   - program\n   - C Standard Library\n   - allocate and free blocks of memory\n   - pointers\n2. This paragraph also suffers from the curse of knowledge for the alternative audience. The average Python programmer is unaware of manipulating memory or pointers. A better introductory paragraph would compare and contrast C with Python.\n\n------\n\n#### Simple words\n\nEnglish has become the dominant language for technical communication worldwide. However, English is not the native language of a significant percentage of technical readers. Therefore, prefer simple words over complex words. Avoid using arcane, obsolete, or overly-complex English words; [sesquipedalian](https://www.google.com/search?q=sesquipedalian&hl=zh-cn) and rare words repel most readers.\n\nCultural neutrality and idioms\n\nKeep your writing culturally neutral. Do not require readers to understand the intricacies of NASCAR, cricket, or sumo in order to understand how a piece of software works. For example, the following sentenceâ€”packed with baseball metaphors as American as apple pieâ€”might puzzle some Parisian readers:\n\n> If Frambus 5.0 was a solid single, Frambus 6.0 is a stand-up double.\n\n**Idioms** are phrases whose overall meaning differs from the literal meaning of the individual words in that phrase. For example, the following phrases are idioms:\n\n- a piece of cake\n- Bob's your uncle\n\nCake? Bob? Most American readers recognize the first idiom; most British readers recognize the second idiom. If you are writing strictly for a British audience, then *Bob's your uncle* can be fine. However, if you are writing for an international audience, then replace that idiom with *this task is easy*.\n\nIdioms are so deeply ingrained in our speech that the special nonliteral meaning of idioms becomes invisible to us. That is, idioms are another form of the curse of knowledge.\n\nNote that some people in your audience use translation software to read your documentation. Translation software tends to struggle more with cultural references and idioms than with plain, simple English.\n\n#### Exercise\n\nIdentify the problems with the following sentences:\n\n1. As of Version 3.0, it was still kosher to call the Frambus method.\n2. Deciding which BorgResourceSpec constraints/preferences are combinable is a sticky wicket.\n3. Be that as it may, you still have to write unit tests.\n\n\n\n##### Answer.\n\n1. In some places in the world, **kosher** has become slang for \"acceptable usage.\" Many readers, however, will wonder how religious dietary laws pertain to software.\n2. A **sticky wicket** is British slang, which does not travel well. Substituting the phrase **challenging problem** will fix this issue.\n3. **Be that as it may** is an idiom. Substituting the transition **However** will fix this problem.\n\n------\n\n\n\n## Documents\n\n> **Estimated Time:** 10 minutes\n\nYou can write sentences. You can write paragraphs. However, can you organize all those paragraphs into a coherent document?\n\n### State your document's scope\n\nA good document begins by defining its scope. For example:\n\n> This document describes the overall design of Project Frambus.\n\nA better document additionally defines its non-scope, that is, the topics not covered that the target audience might expect your document to cover. For example:\n\n> This document does not describe the design for the related technology, Project Froobus.\n\nThese scope and non-scope statements benefit not only the reader but also the writer (you). While writing, if the contents of your document veer away from the scope statement, then you must either refocus your document or modify your scope statement. When reviewing your first draft, delete (or branch off to another document) any sections that don't help satisfy the scope statement.\n\n### State your audience\n\nA good document explicitly specifies its audience. For example:\n\n> I wrote this document for the test engineers supporting Project Frambus.\n\nBeyond the audience's role, a good audience declaration might also specify any prerequisite knowledge or experience. For example:\n\n> This document assumes that you understand matrix multiplication and how to brew a really good cup of tea.\n\nIn some cases, the audience declaration must also specify prerequisite documents. For example:\n\n> You must read \"Project Froobus: A New Hope\" prior to reading this document.\n\n### Establish your key points up front\n\nEngineers and scientists are busy people who won't necessarily read all 76 pages of your design document. Imagine that your peers might only read the first paragraph of page one. When reviewing your documentation, ensure that the start of your document answers your readers' essential questions.\n\nProfessional writers focus considerable energy on page one to increase the odds of readers making it to page two. However, page one of any long document is the hardest page to write. Therefore, be prepared to revise page one many times.\n\nAlways write an executive summary (a TL;DR) for long engineering documents. Although the executive summary must be very short, expect to spend a lot of time writing it. A boring or confusing executive summary is a red flag warning potential readers to stay away.\n\n### Write for your audience\n\nThis course repeatedly emphasizes the importance of defining your audience. In this section, we focus on audience definition as a means of organizing your document.\n\n#### Define audience\n\nAnswering the following questions helps you determine what your document should contain:\n\n- Who is your target audience?\n- What do your readers already know before theyâ€™ve read the document?\n- What should your readers know or be able to do after theyâ€™ve read your document?\n\nFor example, suppose you have invented a new sorting algorithm. The following list contains some potential answers to the preceding questions:\n\n- My target audience consists of all the software engineers in my organization.\n- Most of my target audience studied sorting algorithms during school. However, about 25% of my target audience hasn't implemented or evaluated a sorting algorithm in many years.\n- After reading this document:\n  1. Readers know how the algorithm works.\n  2. Readers can implement the algorithm in their desired language.\n  3. Readers know the circumstances in which the algorithm outperforms the popular quicksort algorithm.\n  4. Readers understand performance degradation in certain edge cases.\n\n#### Organize\n\nAfter defining the audience, organize the document to supply what readers should know or be able to do after reading the document. For example, the outline for the document could look as follows:\n\n1. Overview of the algorithm\n   1. Big O\n   2. Implementation in pseudocode\n2. Sample implementation in C\n   1. Tips in implementing in other languages\n3. Deeper analysis of algorithm\n   1. Optimal datasets\n   2. Edge case problems\n\nFurthermore, use the audience definition to help you choose the right approach to writing your document. For example, the target audience studied sorting algorithms but about a quarter of your audience might not remember the details of different algorithms. Therefore, your document should probably insert links to existing tutorials on quicksort rather than trying to explain quicksort.\n\n### Break your topic into sections\n\nYou modularize code into files, classes, and methods. Modular code is easier to read, understand, maintain, and reuse. Making your doc modular gives you the same benefits. You probably have strong intuition about functional modularity in code, but how do you apply those principles to your writing?\n\nImagine that you have an empty jar, which you need to pack with a collection of large rocks, coarse gravel, and sand. How would you pack the jar to ensure that you can get all of your material in the jar? Of course youâ€™d place the large rocks first, then pour in the gravel, and fill in the remaining air space with the sand. If you tried to do this in the opposite order, you would fail.\n\nYour readerâ€™s head is much like an empty jar, and your information generally comes in three sizes: rocks, gravel, and sand. Sections are the rocks. You need to structure the space inside your readerâ€™s jar-head with the rocks to accept the rest of the information.\n\nBut how do you decide what is a big rock versus what is gravel? One strategy is to record yourself talking, or free-write, about your topic for a short amount of timeâ€”maybe just 2 to 5 minutes. Yes, this takes discipline. Examine what you produced. Did you do the following?\n\n- Describe concepts in vague, under-specified ways?\n- List the steps that your audience needs to complete to reach a goal?\n- Describe the permutations of properties that a system can express?\n\nThe under-specified things that you referred to are probably the large concepts that structure your topic. If your talk didnâ€™t do this, go back and try this structure.\n\n#### Exercise\n\nThe following passage is the introductory paragraph for a document. List the titles of the sections that you would break this topic into.\n\n> AlienWarez is a large-scale machine learning system. AlienWarez is best at building models for high-dimensional, sparse feature spaces. AlienWarez automatically explores and learns feature crosses that explain your data. AlienWarez refers specifically to the model training system. You train a model by extracting features from your source (log) data, and writing a data source for the training system. The Seti infrastructure team also provides a complete serving system. You are responsible for starting your own serving cluster, and moving your model to serving. The Seti serving system can serve AlienWarez, Seti, and Sibyl models. This guide explains how to train a AlienWarez model, and how to serve the model in production.\n\n\n\n##### Answer.\n\nHere is a possible outline:\n\n1. Training a model\n   1. Developing features\n   2. Creating a data source\n   3. ...\n2. Serving a model\n   1. Starting a serving cluster\n   2. Moving your model into serving\n   3. Retrieving a prediction from serving\n   4. ...\n\n------\n\n## Punctuation (optional)\n\n> **Estimated Time:** 5 minutes\n\nThis optional unit provides a quick refresher on punctuation marks.\n\n### Commas\n\nProgramming languages enforce clear rules about punctuation. In English, by contrast, the rules regarding commas are somewhat hazier. As a guideline, insert a comma wherever a reader would naturally pause somewhere within a sentence. For the musically inclined, if a period is a whole note rest, then a comma is perhaps a half-note or quarter-note rest. In other words, the pause for a comma is shorter than that for a period. For example, if you read the following sentence aloud, you probably rest briefly before the word *just*:\n\n> C behaves as a mid-level language, just a couple of steps up in abstraction from assembly language.\n\nSome situations *require* a comma. For example, use commas to separate items in an embedded list like the following:\n\n> Our company uses C++, Python, Java, and JavaScript.\n\nYou might be wondering about a list's final comma, the one inserted between items N-1 and N. This commaâ€”known as the **serial comma** or **Oxford comma**â€”is controversial. We recommend supplying that final comma simply because technical writing requires picking the least ambiguous solution. That said, we actually prefer circumventing the controversy by converting embedded lists into bulleted lists.\n\nIn sentences that express a condition, place a comma between the condition and the consequence. For example, both of the following sentences supply the comma in the correct place:\n\n> If the program runs slowly, try the `--perf` flag.\n>\n> If the program runs slowly, then try the `--perf` flag.\n\nYou can also wedge a quick definition or digression between a pair of commas as in the following example:\n\n> Python, an easy-to-use language, has gained significant momentum in recent years.\n\nFinally, avoid using a comma to paste together two independent thoughts. For example, the comma in the following sentence is guilty of a punctuation felony called a **comma splice**:\n\n> Samantha is a wonderful coder, she writes abundant tests.\n\nUse a period rather than a comma to separate two independent thoughts. For example:\n\n> Samantha is a wonderful coder. She writes abundant tests.\n\n#### Exercise\n\nAdd commas where appropriate to the following passage:\n\n> Protocol Buffers sometimes known as protobufs are our team's main structured data format. Use Protocol Buffers to represent store and transfer structured data. Unlike XML Protocol Buffers are compiled. Consequently clients transmit Protocol Buffers efficiently which has led to rapid adoption.\n\nHint: Read the passage aloud and put a comma everywhere you hear a short pause.\n\n##### Answer.\n\n\n\nHere is one possible solution:\n\n> Protocol Buffers**,** sometimes known as protobufs**,** are our team's main structured data format. Use Protocol Buffers to represent**,** store**,** and transfer structured data. Unlike XML**,** Protocol Buffers are compiled. Consequently**,**clients transmit Protocol Buffers efficiently**,** which has led to rapid adoption.\n\n------\n\n### Semicolons\n\nA period separates distinct thoughts; a semicolon unites highly related thoughts. For example, notice how the semicolon in the following sentence unites the first and second thoughts:\n\n> Rerun Frambus after updating your configuration file; don't rerun Frambus after updating existing source code.\n\nThe thoughts preceding and following the semicolon must each be grammatically complete sentences. For example, the following semicolon is *incorrect* because the passage following the semicolon is not a complete sentence:\n\n> Rerun Frambus after updating your configuration file; not after updating existing source code.\n\nBefore using a semicolon, ask yourself whether the sentence would still make sense if you flipped the thoughts to opposite sides of the semicolon. For example, reversing the earlier example still yields a *valid* sentence:\n\n> Don't rerun Frambus after updating existing source code; rerun Frambus after updating your configuration file.\n\nYou should almost always use commas, not semicolons, to separate items in an embedded list. For example, the following use of semicolons is *incorrect*:\n\n> Style guides are bigger than the moon; more essential than oxygen; and completely inscrutable.\n\nMany sentences place a transition word or phrase immediately after the semicolon. In this situation, place a comma after the transition. Note the comma after the transition in the following two examples:\n\n> Frambus provides no official open source package for string manipulation; however**,** subsets of string manipulation packages are available from other open source projects.\n\n> Even seemingly trivial code changes can cause bugs; therefore**,** write abundant unit tests.\n\n#### Exercise\n\nWhich of the following periods or commas could you replace with a semicolon?\n\n1. Python is a popular programming language. The C language was developed long before Python.\n2. Model learning for a low value of X appears in the top illustration. Model learning for a high value of X appears in the bottom illustration.\n3. I'm thankful for my large monitor, powerful CPU, and blazing bandwidth.\n\n##### Answer.\n\n1. You may not convert the period in #1 to a semicolon because the two sentences are only vaguely related.\n2. You may replace the period in #2 with a semicolon because the two sentences are so highly related.\n3. You may not convert the commas in #3 to semicolons. Use commas to separate items in an embedded list.\n\n### Em-Dashes\n\nEm-dashes are compelling punctuation marks, rich with punctuation possibilities. An em-dash represents a longer pauseâ€”a bigger breakâ€”than a comma. If a comma is a quarter note rest, then an em-dash is a half-note rest. For example:\n\n> C++ is a rich languageâ€”one requiring extensive experience to master.\n\nWriters sometimes use a pair of em-dashes to block off a digression, as in the following example:\n\n> **Protocol Buffers**â€”often nicknamed **protobufs**â€”encode structured data in an efficient yet extensible format.\n\nCould we have used commas instead of em-dashes in the preceding examples? Sure. Why did we choose an em-dash instead of a comma? Feel. Art. Experience. Rememberâ€”punctuation in English is squishy and malleable.\n\n### Parentheses\n\nUse parentheses to hold minor points and digressions. Parentheses inform readers that the enclosed text isn't critical.\n\nThe rules regarding periods and parentheses have tripped up many a writer. Here are the standards:\n\n- If a pair of parentheses holds an entire sentence, the period goes inside the closing parenthesis.\n- If a pair of parentheses ends a sentence but does not hold the entire sentence, the period goes just outside the closing parenthesis.\n\nFor example:\n\n> (Incidentally, Protocol Buffers make great birthday gifts.)\n>\n> Binary mode relies on the more compact native form (described later in this document).\n\n\n\n------\n\n## Markdown (optional)\n\n\n\n> **Estimated Time:** 10 minutes\n\n\n\n**Markdown** is a lightweight markup language that many technical professionals use to create and edit technical documents. With Markdown, you write text in a plain text editor (such as vi or Emacs), inserting special characters to create headers, boldface, bullets, and so on. For example, the following example shows a simple technical document formatted with Markdown:\n\n```\n## bash and ksh\n\n**bash** closely resembles an older shell named **ksh**.  The key\n*practical* difference between the two shells is as follows:\n\n*  More people know bash than ksh, so it is easier to get help for bash\n   problems than ksh problems.\n```\n\nThe rendered version of the preceding technical document looks as follows:\n\n> bash and ksh\n>\n> **bash** closely resembles an older shell named **ksh**. The key *practical* difference between the two shells is as follows:\n>\n> - More people know bash than ksh, so it is easier to get help for bash problems than ksh problems.\n\nA Markdown parser converts Markdown files into HTML. Browsers can then display the resulting HTML to readers.\n\nWe recommend becoming comfortable with Markdown by taking one of the following tutorials:\n\n- [www.markdowntutorial.com](https://www.markdowntutorial.com/)\n- [Mastering Markdown](https://guides.github.com/features/mastering-markdown/)\n\nWhat's next?\n\nCongratulations: you've completed the pre-class work for Technical Writing One.\n\nIf the in-class portion of Technical Writing One is available, please take it.\n\nA quick compilation of the topics covered in Technical Writing One is available on the [Summary](https://developers.google.com/tech-writing/one/summary?hl=zh-cn) page.\n\n-----\n\n## Summary of Technical Writing One\n\n\nTechnical Writing One covered the following basic lessons of technical writing:\n\n- Use terms consistently.\n- Avoid ambiguous pronouns.\n- Prefer active voice to passive voice.\n- Choose strong verbs.\n- Pick specific nouns over vague ones.\n- Focus each sentence on a single idea.\n- Convert some long sentences to lists.\n- Eliminate unneeded words.\n- Use a numbered list when ordering is important and a bulleted list when ordering is irrelevant.\n- Keep list items parallel.\n- Start numbered list items with imperative words.\n- Introduce lists and tables appropriately.\n- Create great opening sentences that establish a paragraph's central point.\n- Focus each paragraph on a single topic.\n- Determine what your audience needs to learn.\n- Fit documentation to your audience.\n- Establish your document's key points at the start of the document.\n\nAs time permits, consider reviewing these additional [technical writing resources](https://developers.google.com/tech-writing/resources?hl=zh-cn).\n\n-----------\n\n# Technical Writing Two\n\n## Technical Writing Two introduction\n\n\n\n*Technical Writing Two* helps technical people improve their technical communication skills.\n\n### Target audience\n\nWe've aimed this course at people who have completed [Technical Writing One](https://developers.google.com/tech-writing/one?hl=zh-cn) and are still hungry for more technical writing training. If you've never taken any technical writing training, we recommend completing *Technical Writing One*before taking this class.\n\n### Learning objectives\n\nThis course focuses on several intermediate topics in technical writing. After completing this class, you will know how to do the following:\n\n- Choose among several different tactics to write first drafts and additional tactics for writing second and third drafts.\n- Leverage several techniques to detect mistakes in your own writing.\n- Organize large documents.\n- Introduce a document's scope and any prerequisites.\n- Write clear figure captions.\n- Pick the proper information density in technical illustrations.\n- Focus the reader's attention in illustrations.\n- Establish context through a \"big picture\" illustration.\n- Revise technical illustrations effectively.\n- Create useful, accurate, concise, clear, reusable, and well-commented sample code that demonstrates a range of complexity.\n- Identify different documentation types.\n- Describe just about anything.\n- Empathize with a beginner audience and write a tutorial for them.\n\nIt takes years of focused practice to become a great engineer or a great technical writer. This course will improve your technical writing but will not instantly transform you into a great technical writer.\n\n### Pre-class and in-class components\n\nThe course consists of the following two components:\n\n- pre-class\n- in-class\n\nYou are currently viewing the start of the pre-class component.\n\nThe in-class component enhances the lessons taught in the pre-class components. That said, the pre-class lessons on their own still provide a valuable educational experience.\n\n### Hardware and network requirements\n\nAlthough this course is optimized for a laptop or desktop, you may take the course on a tablet or phone. If you are taking the in-class component, please note that you'll type a lot.\n\nYou need an internet connection to take the course. You cannot download the course. The course is not available on tangible media.\n\nThe course contains a few short videos, all of which are optional viewing. If you want to skip the videos, then you can take the course on a low-bandwidth internet connection.\n\n\n\n------\n\n\n\n## Self-editing\n\n\n\n>  **Estimated Time:** 10 minutes\n\nImagine that you just wrote the first draft of a document. How do you make it better? In most cases, working towards a final published document is an iterative process. Transforming a blank page into a first draft is often the hardest step. After you write a first draft, make sure you set aside plenty of time to refine your document.\n\nThe editing tips in this unit can help turn your first draft into a document that more clearly communicates the information your audience needs. Use one tip or use them all; the important thing is to find a strategy that works for you, and then make that strategy part of your writing routine.\n\n**Note:** The tips in this unit build on the basic writing and editing skills from Technical Writing One. This unit includes a summary of useful editing techniques from that course. For a more detailed refresher, visit the [self-study units](https://developers.google.com/tech-writing/one?hl=zh-cn) from Technical Writing One.\n\n### Adopt a style guide\n\nCompanies, organizations, and large open source projects frequently either adopt an existing style guide for their documentation or write their own. Many of the documentation projects on the [Google Developers](https://developers.google.com/?hl=zh-cn) site follow the[Google Developer Documentation Style Guide](https://developers.google.com/style?hl=zh-cn). If you've never relied on a style guide before, at first glance the Google Developer Documentation Style Guide might seem a little intimidating, offering detailed guidance on topics such as grammar, punctuation, formatting, and documenting computer interfaces. You might prefer to start by adopting the[style-guide highlights](https://developers.google.com/style/highlights?hl=zh-cn).\n\n**Note:** For smaller projects, such as team documentation or a small open source project, you might find the highlights are all you need.\n\nSome of the guidelines listed in the highlights are covered in Technical Writing One. You might recall some of the following techniques:\n\n- Use [active voice](https://developers.google.com/tech-writing/one/active-voice?hl=zh-cn) to make clear who's performing the action.\n- Format sequential steps as [numbered lists](https://developers.google.com/tech-writing/one/lists-and-tables?hl=zh-cn).\n- Format most other lists as bulleted lists.\n\nThe highlights introduce many other techniques that can be useful when writing technical documentation, such as:\n\n- [Write in the second person](https://developers.google.com/style/person?hl=zh-cn). Refer to your audience as \"you\" rather than \"we\".\n- [Place conditional clauses before an instruction](https://developers.google.com/style/clause-order?hl=zh-cn), rather than after.\n- Format [code-related text as code font](https://developers.google.com/style/code-in-text?hl=zh-cn).\n\n### Think like your audience\n\nWho is your audience? Step back and try to read your draft from their point of view. Make sure the purpose of your document is clear, and provide definitions for any terms or concepts that might be unfamiliar to your readers.\n\nIt can be helpful to outline a persona for your audience. A persona can consist of any of the following attributes:\n\n- A role, such as *Systems Engineer* or *QA Tester*.\n- An end goal, such as *Restore the database*.\n- A set of assumptions about the persona and their knowledge and experience. For example, you might assume that your persona is:\n  - Familiar with Python.\n  - Running a Linux operating system.\n  - Comfortable following instructions for the command line.\n\nYou can then review your draft with your persona in mind. It can be especially useful to tell your audience about any assumptions you've made. You can also provide links to resources where they can learn more if they need to brush up on a specific topic.\n\nNote that relying too heavily on a persona (or two) can result in a document that is too narrowly focused to be useful to the majority of your readers.\n\nFor a refresher and more information on this topic from Technical Writing One, see the [Audience](https://developers.google.com/tech-writing/one/audience?hl=zh-cn) self-study unit.\n\n### Read it out loud\n\nDepending on the context, the style of your writing can alienate, engage, or even bore your audience. The desired style of a given document depends to an extent on the audience. For example, the contributor guide for a new open source project aimed at recruiting volunteers might adopt a more informal and conversational style, while the developer guide for a commercial enterprise application might adopt a more formal style.\n\nTo check your writing is conversational, read it out loud. Listen for awkward phrasing, too-long sentences, or anything else that doesn't feel natural. Alternatively, you can also try asking someone else to read your draft out loud for you.\n\nFor more information on adjusting the style of your writing to suit your audience, see [Style and authorial tone](https://developers.google.com/style/tone?hl=zh-cn).\n\n### Come back to it later\n\nAfter you write your first draft (or second or third), set it aside. Come back to it after an hour (or two or three) and try to read it with fresh eyes. You'll almost always notice something that you could improve.\n\n### Change the context\n\nSome writers like to print their documentation and review a paper copy, red pencil in hand. A change of context when reviewing your own work can help you find things to improve. For a modern take on this classic tip, copy your draft into a different document and change the font, size, and color.\n\n### Find a peer editor\n\nJust as engineers need peers to review their code, writers need editors to give them feedback on docs. Ask someone to review your document and give you specific, constructive comments. Your peer editor doesn't need to be a subject matter expert on the technical topic of your document, but they do need to be familiar with the style guide you follow.\n\n### Exercise\n\nIf you have a document that you're working on, use one or more of the tips on this page to make it better. If you don't have a document in progress, edit the paragraph below.\n\n> Determine whether or not you can simplify your document through the use of terminology that is equivalent but relatively shorter in length and therefore more easily comprehensible by your audience. It's important to make sure your document is edited before it is seen by your audience, which might include people that are less or more familiar with the matter covered by your document. The first thing you need is a rough draft. Some things that can help make your document easier to read are making sure you have links to background information, and also checking for active voice instead of passive voice. If you have long sentences you can consider shortening them or implementing the use of a list to make the information easier to scan.\n\n##### Answer.\n\n\n\nTo help your audience understand your document, apply these basic editing principles:\n\n- Use active voice instead of passive voice.\n- Consider using simpler words that mean the same thing.\n- Include links to background information.\n- Break long sentences into shorter sentences or lists.\n\n\n\n## Organizing large documents\n\n\n\n>  **Estimated Time:** 20 minutes\n\nHow do you organize a large collection of information into a cohesive document or website? Alternatively, how do you reorganize an existing messy document or website into something approachable and useful? The following tactics can help:\n\n- Organizing a document\n- Adding navigation\n- Disclosing information progressively\n\n### When to write large documents\n\nYou can organize a collection of information into longer standalone documents or a set of shorter interconnected documents. A set of shorter interconnected documents is often published as a website, wiki, or similar structured format.\n\nSome readers respond more positively than others to longer documents. Consider the following perspectives from two hypothetical readers you're writing documentation for:\n\n- Hong finds reading long documents difficult and disorientating. He prefers to use site search to find answers to his questions.\n- Rose is comfortable navigating large documents. She often uses the built-in page search feature in her web browser to find useful information on the current page.\n\nSo, should you organize your material into a single document or into a set of documents in a website? Consider the following guidelines:\n\n- How-to guides, introductory overviews, and conceptual guides often work better as shorter documents when aimed at readers who are new to the subject matter. For example, a reader who is completely new to your subject matter might struggle to remember lots of new terms, concepts, and facts. Remember that your audience might be reading your documentation to gain a quick and general overview of the topic.\n- In-depth tutorials, best practice guides, and command-line reference pages can work well as lengthier documents, especially when aimed at readers who already have some experience with the tools and subject matter.\n- A great tutorial can rely on a narrative to lead the reader through a series of related tasks in a longer document. However, even large tutorials can sometimes benefit from being broken up into smaller parts.\n- Many longer documents aren't designed to be read in one sitting. For example, users typically scan through a reference page to search for an explanation of a command or flag.\n\nThe remainder of this unit covers techniques that can be useful for writing longer documents, such as tutorials and some conceptual guides.\n\n### Organize a document\n\nThis section suggests some techniques for planning a longer document, including creating an outline and drafting an introduction. After you've completed the first draft of a document, you can review it against your outline and introduction to make sure you haven't missed anything you originally intended to cover.\n\n#### Outline a document\n\nStarting with a structured, high-level outline can help you group topics and determine where more detail is needed. The outline helps you move topics around before you get down to writing.\n\nYou might find it useful to think of an outline as the narrative for your document. There is no standard approach to writing an outline, but the following guidelines provide practical tips you might find useful:\n\n- Before you ask your reader to perform a task, explain to them why they are doing it. For example, the following bullet points illustrate a section of an outline from a tutorial about auditing and improving the accessibility of web pages:\n  - Introduce the browser plugin; explain that we'll use the results of the audit report to fix several bugs.\n  - List the steps to run the plugin and audit the accessibility of a web page.\n- Limit each step of your outline to describing a concept or completing a specific task.\n- Structure your outline so that your document introduces information when it's most relevant to your reader. For example, your reader probably doesn't need to know (or want to know) about the history of the project in the introductory sections of your document when they're just getting started with the basics. If you feel the history of the project is useful, then include a link to this type of information at the end of your document.\n- Documents that alternate between conceptual information and practical steps can be a particularly engaging way to learn. Consider explaining a concept and then demonstrating how the reader can apply it in either a sample project or in their own work.\n- Outlines are especially useful if you're working with a team of contributors who are going to review and test your document. Before you start drafting, share your outline with your contributors to check if they have any suggestions.\n\n#### Outline exercise\n\nFor this exercise, review and update the following high-level outline of an introduction to a long tutorial. You can rearrange, add, and remove topics.\n\n```markdown\n## The history of the project\n\nDescribes the history of the development of the project.\n\n## Prerequisites\n\nLists concepts the reader should be familiar with prior to starting, as well as\nany software or hardware requirements.\n\n## The design of the system\n\nDescribes how the system works.\n\n## Audience\n\nDescribes who the tutorial is aimed at.\n\n## Setting up the tutorial\n\nExplains how to configure your environment to follow the tutorial.\n\n## Troubleshooting\n\nExplains how to diagnose and solve potential problems that might occur when\nworking through the tutorial.\n\n## Useful terminology\n\nLists definitions of terms that the reader needs to know to follow the\ntutorial.\n```\n\n\n\n##### Answer.\n\nThe following is one possible solution:\n\n```markdown\n## Audience\n\nDescribes who the tutorial is aimed at.\n\n## Prerequisites\n\nLists concepts the reader should be familiar with prior to starting, as well as\nany software or hardware requirements.\n\n## Setting up the tutorial\n\nExplains how to configure your environment to follow the tutorial.\n\n## Useful terminology\n\nLists definitions of terms that the reader needs to know to follow the\ntutorial.\n```\n\n------\n\n#### Introduce a document\n\nIf readers of your documentation can't find relevance in the subject, they are likely to ignore it. To set the ground rules for your users, we recommend providing an introduction that includes the following information:\n\n- What the document covers.\n- What prior knowledge you expect readers to have.\n- What the document doesn't cover.\n\nRemember that you want to keep your documentation easy to maintain, so don't try to cover everything in the introduction.\n\nThe following paragraph demonstrates the ideas from the preceding list as an overview for a hypothetical document publishing platform called Froobus:\n\n```markdown\nThis document explains how to publish Markdown files using the Froobus system.\nFroobus is a publishing system that runs on a Linux server and converts\nMarkdown files into HTML pages. This document is intended for people who are\nfamiliar with Markdown syntax. To learn about the syntax, see the Markdown\nreference. You also need to be comfortable running simple commands in a\nLinux terminal. This document doesn't include information about installing or\nconfiguring a Froobus publishing system. For information on installing Froobus,\nsee Getting started.\n```\n\nAfter you've completed the first draft, check your entire document against the expectations you set in your overview. Does your introduction provide an accurate overview of the topics you cover? You might find it useful to think of this review as a form of documentation quality assurance (QA).\n\n#### Introduction exercise\n\nFor this exercise, review and revise the following introduction for a best practices guide for a hypothetical programming language called F@. Remove any information you feel is irrelevant in this context and add any information you feel is missing.\n\n```markdown\nThis guide lists best practices for working with the F@ programming language.\nF@ was developed in 2011 as an open source community project. This guide\nsupplements the F@ style guide. In addition to the best practices in this guide,\nmake sure you also install and run the F@ command-line linter on your code.  The\nprogramming language is widely adopted in the health industry. If you have\nsuggestions for additions to the list of best practices, file an issue in the\nF@ documentation repository.\n```\n\n\n\n##### Answer.\n\nThe following is one possible solution:\n\n```markdown\nThis guide lists best practices for working with the F@ programming language.\nBefore you review this guide, complete the introductory tutorial for new F@\ndevelopers. This guide supplements the F@ style guide. In addition to the best\npractices in this guide, make sure you also install and run the F@ command-line\nlinter on your code. If you have suggestions for additions to the list of best\npractices, file an issue in the F@ documentation repository.\n```\n\n------\n\n### Add navigation\n\nProviding navigation and signposting for your readers ensures they can find what they are looking for and the information they need to get unstuck.\n\nClear navigation includes:\n\n- introduction and summary sections\n- a clear, logical development of the subject\n- headings and subheadings that help users understand the subject\n- overviews that introduce the tool\n- a table of contents menu that shows users where they are in the document\n- links to related resources or more in-depth information\n- links to what to learn next\n\nThe tips in the following sections can help you plan the headings in your documentation.\n\n#### Prefer task-based headings\n\nChoose a heading that describes the task your reader is working on. Avoid headings that rely on unfamiliar terminology or tools. For example, suppose you are documenting the process for creating a new website. To create the site, the reader must initialize the Froobus framework. To initialize the Froobus framework, the reader must run the `carambola` command-line tool. At first glance, it might seem logical to add either of the following headings to the instructions:\n\n- Running the carambola command\n- Initializing the Froobus framework\n\nUnless your readers are already very experienced with the terminology and concepts for this topic, a more familiar heading might be preferable, such as *Creating the site*.\n\n#### Provide text under each heading\n\nMost readers appreciate at least a brief introduction under each heading to provide some context. Avoid placing a level three heading immediately after a level two heading, as in the following example:\n\n```markdown\n## Creating the site\n### Running the carambola command\n```\n\nIn this example, a brief introduction can help orient the reader:\n\n```markdown\n## Creating the site\n\nTo create the site, you run the `carambola` command-line tool. The command\ndisplays a series of prompts to help you configure the site.\n\n### Running the carambola command\n```\n\n#### Heading exercise\n\nHelping readers navigate through your documentation helps them find the information they need to successfully use your tool. Often, a clear and well-organized table of contents or outline acts like a map that helps your users navigate the functionality of your tool.\n\nFor this exercise, improve the following outline. You can rearrange, add, and delete topics and create secondary entries too.\n\n```markdown\nAbout this tutorial\nAdvanced topics\nBuild the asset navigation tree\nDefine resource paths\nDefining and building projects\nLaunch the development environment\nDefining and building resources\nWhat's next\nDefine image resources\nAudience\nSee also\nBuild an image resource\nDefine an image project\nBuild an image project\nSetting up the tutorial\nSelect the tutorial asset root\nAbout this guide\n```\n\n\n\n##### Answer.\n\nThe following is one possible solution:\n\n```markdown\n## About this tutorial\n\n### Audience\n\n### About this guide\n\n### Advanced topics\n\n## Setting up the tutorial\n\n### Select the tutorial asset root\n\n### Launch the development environment\n\n### Build the asset navigation tree\n\n### Define resource paths\n\n## Defining and building resources\n\n### Define image resources\n\n### Build an image resource\n\n## Defining and building projects\n\n### Define an image project\n\n### Build an image project\n\n## Defining and building databases\n\n### Define a database\n\n### Build a database\n\n## Pushing, publishing, and viewing a database\n\n### Push a database\n\n### Publish a database\n\n### View a database\n\n## Configuring display rules for point data\n\n### Define, configure, and build vector data\n\n## See also\n\n### Sample data files\n\n## What's next\n```\n\n------\n\n### Disclose information progressively\n\nLearning new concepts, ideas, and techniques can be a rewarding experience for many readers who are comfortable reading through documentation at their own pace. However, being confronted with too many new concepts and instructions too quickly can be overwhelming. Readers are more likely to be receptive to longer documents that progressively disclose new information to them when they need it. The following techniques can help you incorporate progressive disclosure in your documents:\n\n- Where possible, try introducing new terminology and concepts near to the instructions that rely on them.\n- Break up large walls of text. To avoid multiple large paragraphs on a single page, aim to introduce tables, diagrams, lists, and headings where appropriate.\n- Break up large series of steps. If you have a particularly long list of complicated steps, try to re-arrange them into shorter lists that explain how to complete sub-tasks.\n- Start with simple examples and instructions, and add progressively more interesting and complicated techniques. For example, in a tutorial for creating forms, start by explaining how to handle text responses, and then introduce other techniques to handle multiple choice, images, and other response types.\n\n\n\n------\n\n## Illustrating\n\n> **Estimated Time:** 10 minutes\n\n\n\nRemember when your teacher assigned you a hefty chapter to read? You flipped through the assigned section of the textbook, desperately hoping for...yes, pictures! Viewing illustrations was so much more fun than reading text. In fact, when it comes to reading technical material, the vast majority of adults are still little kidsâ€”still yearning for pictures rather than text.\n\n![Three children read a book while pointing at the pictures.](https://developers.google.com/tech-writing/two/images/book_readers.jpg?hl=zh-cn)\n\n**Figure 1. Good graphics engage readers in ways that text cannot.**\n\n[Nirmal Dulal [CC BY-SA 4.0 (https://creativecommons.org/licenses/by-sa/4.0)\\]](https://commons.wikimedia.org/wiki/File:Nepalese_Children.JPG)\n\n \n\n\n\nAccording to research by [Sung and Mayer (2012)](https://www.sciencedirect.com/science/article/pii/S0747563212000921), providing any graphicsâ€”good or badâ€”makes readers like the document more; however, only *instructive* graphics help readers learn. This unit suggests a few ways to help you create figures truly worth a thousand words.\n\n### Write the caption first\n\nOften times, it is helpful to write the caption *before* creating the illustration. Then, create the illustration that best represents the caption. This process helps you to check that the illustration matches the goal.\n\nGood captions have the following characteristics:\n\n- They are **brief**. Typically, a caption is just a few words.\n- They explain the **takeaway**. *After viewing this graphic, what should the reader remember?*\n- They **focus** the reader's attention. Focus is particularly important when a photograph or diagram contains a lot of detail.\n\n#### Exercise\n\nTarget Audience: CS undergraduate students taking an \"Introduction to Data Structures\" class.\n\nConsider the following three figures, each of which uses the same caption.\n\n![Multicolored chain](https://developers.google.com/tech-writing/two/images/caption_exercise_chain_a.svg?hl=zh-cn)\n\n**Caption A. A single-linked list holds content and a pointer to the next node.**\n\n \n\n![Four boxes connected by three arrows](https://developers.google.com/tech-writing/two/images/caption_exercise_drawing_b.png?hl=zh-cn)\n\n**Caption B. A single-linked list holds content and a pointer to the next node.**\n\n \n\n![Four boxes (each with content and a pointer) connected by three      arrows.](https://developers.google.com/tech-writing/two/images/caption_exercise_drawing_c.svg?hl=zh-cn)\n\n**Caption C. A single-linked list holds content and a pointer to the next node.**\n\n \n\nWhich of the three preceding figures best illustrates its caption?\n\n\n\nClick the icon to see the answer.\n\n- Figure A is bad. The chain is pretty, but information-free. The chain also erroneously implies that a single-linked list points both backwards and forwards.\n- Figure B is okay. The illustration helps students realize that the first item points to the second item, the second points to the third, and so on. However, although the caption refers to both *content* and a *pointer*, the illustration shows pointers but does not show content.\n- Figure C is the best and most instructive choice. The illustration clearly delineates the content part of each node from the pointer part.\n\n------\n\n### Constrain the amount of information in a single drawing\n\nFew intellectual tasks can be quite as rewarding as studying a fine painting, gradually uncovering layers of insight and meaning. People pay good money to do exactly that in the world's art museums.\n\n![Portrait of Pere Tanguy By Vincent van Gogh - MusÃ©e Rodin, Public Domain, https://commons.wikimedia.org/w/index.php?curid=119599](https://developers.google.com/tech-writing/two/images/van_gogh.png?hl=zh-cn)\n\n**Figure 2. You'd happily study this Van Gogh painting.**\n\n[Portrait of Pere Tanguy By Vincent van Gogh - MusÃ©e Rodin [Public domain\\]](https://commons.wikimedia.org/wiki/File:Van_Gogh_-_Portrait_of_Pere_Tanguy_1887-8.JPG)\n\n \n\n\n\nBy contrast, highly complex technical illustrations like the following tend to discourage most readers:\n\n![A schematic, filled with lines and small print](https://developers.google.com/tech-writing/two/images/overly_complex_diagram.svg?hl=zh-cn)\n\n**Figure 3. Complex block diagrams overwhelm readers.**\n\n\n\nJust as you avoid overly-long sentences, strive to avoid visual run-ons. As a rule of thumb, don't put more than one paragraph's worth of information in a single diagram. (An alternative rule of thumb is to avoid illustrations that require more than five bulleted items to explain.) I can hear you saying, \"But real-life technical systems can be vastly more complex than the one shown in Figure 3.\" You are correct, but you probably don't feel compelled to explain real-life complex systems in a single paragraph.\n\nThe trick to whittling visual clutter into something coherent and helpful is to organize complex systems into subsystems, like those shown in the following figure:\n\n![Three blocks, each with a simple label](https://developers.google.com/tech-writing/two/images/subsystems.svg?hl=zh-cn)\n\n**Figure 4. A complex system organized into three subsystems.**\n\n \n\nAfter showing the \"big picture,\" provide separate illustrations of each subsystem.\n\n![A zoomed in segment of figure 4 with slightly more detail](https://developers.google.com/tech-writing/two/images/subsystems_zoomed.svg?hl=zh-cn)\n\n**Figure 5. Expanded detail for one subsystem of a complex system.**\n\n \n\nAlternatively, start with a simple \"big picture\" and then gradually expand detail in each subsequent illustration.\n\n### Focus the reader's attention\n\nWhen confronted with a complex screenshot like the following, readers struggle to determine what's relevant:\n\n![Three blocks, each with a simple label](https://developers.google.com/tech-writing/two/images/unfocused_screenshot.png?hl=zh-cn)\n\n**Figure 6. Readers don't know what to focus on.**\n\n \n\nAdding a visual cue, for example, the red ellipse in the following figure, helps readers focus on the relevant section of the screenshot:\n\n![Same screenshot, but with one menu item circled in red](https://developers.google.com/tech-writing/two/images/focused_screenshot.png?hl=zh-cn)\n\n**Figure 7. Readers focus on a shape that breaks the pattern.**\n\n**Callouts** provide another way to focus the reader's attention. For pictures and line art, a callout helps our eyes find just the right spot to land on. Callouts in pictures are often better than paragraph long explanations of the pictures because callouts focus the reader's attention on the most important aspects of the picture. Then, in your explanation, you can focus directly on the relevant part of the diagram, rather than spending time describing what part of the image you are talking about.\n\nIn the example image, the callout and arrow quickly direct the reader to the purpose.\n\n![Three blocks, each with a simple label](https://developers.google.com/tech-writing/two/images/moon_with_callout.svg?hl=zh-cn)\n\n**Figure 8. A callout directs readers' eyes.**\n\n[NASA / JPL-Caltech / University of Arizona [Public domain\\]](https://commons.wikimedia.org/wiki/File:Phobos_colour_2008.jpg)\n\n \n\n\n\n### Illustrating is re-illustrating\n\nAs with writing, the first draft of an illustration is seldom good enough. Revise your illustrations to clarify the content. As you revise, ask yourself the following questions:\n\n- How can I simplify the illustration?\n- Should I split this illustration into two or more simpler illustrations?\n- Is the text in the illustration easy to read? Does text contrast sufficiently with its background?\n- What's the takeaway?\n\nFor instance, consider the [evolution of the London Tube map](https://wikipedia.org/wiki/Tube_map#History). Prior to 1931, the Tube map was drawn to scale, complete with above ground roads and tube lines that curved as the tracks did.\n\n![Complex map of the 1908 London Tube that includes above ground roads](https://developers.google.com/tech-writing/two/images/tube_1908.jpg?hl=zh-cn)\n\n**Figure 9. 1908 to scale map of the London Tube with above ground roads.**\n\n[[Public domain\\]](https://commons.wikimedia.org/wiki/File:Tube_map_1908.jpg)\n\nIn 1931, Harry Beck revolutionized a new type of public transit map that simplified the older map by removing above ground markers and removing scale. His design instead focused on what people using the maps really cared about: getting from station A to station B. Even with the success of his 1931 map, Beck still iterated on the diagram for many years to simplify and clarify the map. Consider now the [modern tube map](https://www.google.com/search?tbm=isch&q=london+tube+map&hl=zh-cn), although new lines and stations have appeared, they still remain close to Beck's design.\n\n#### Exercise\n\nConsider the following original illustration:\n\n![A complex visual of recursion that uses inaccessible colors and           confusing arrows](https://developers.google.com/tech-writing/two/images/recursion1.svg?hl=zh-cn)\n\n**Figure 10. A complex diagram.**\n\n \n\nThe takeaway of the preceding diagram is supposed to be:\n\n> For a recursive solution, call the function itself in the return statement until you reach a base case solution.\n\nIn what ways does the complexity of the diagram hide the takeaway? How might you address these problems?\n\n\n\n##### Answer.\n\nSome possible issues with the diagram include:\n\n- **Issue**: The bright colors pull the reader's attention away from other parts of the diagram.\n  **Solution**: Choose colors carefully so that they do not overpower the diagram.\n- **Issue**: The diagram does not have sufficient color contrast. This makes the diagram inaccessible for some people with low-vision or certain types of color blindness.\n  **Solution**: Remove unnecessary use of color and ensure that colors pass [standard color contrast recommendations](https://material.io/design/color/text-legibility.html#legibility-standards).\n- **Issue**: The arrows currently point in both directions which makes it unclear which way the diagram flows.\n  **Solution**: Separate the arrows into two parts with one set illustrating invoking a function and the other set illustrating returning from the function.\n\nThere are also additional issues in the diagram that are not identified here.\n\n------\n\nHere is an improved illustration:\n\n![Visual of recursion that simplifies colors and adds labels to arrows](https://developers.google.com/tech-writing/two/images/recursion2.svg?hl=zh-cn)\n\n**Figure 11. A simplified version of the preceding diagram.**\n\nWhat flaws do you see in the improved illustration?\n\n\n\n##### Answer.\n\nHere are two of the flaws that still exist:\n\n- This diagram is still too complex. It would take far more than a paragraph to explain this illustration. Consider how removing extra information or adding clarifying labels might simplify the interpretation.\n- While separating the arrows helped display when the functions invoke or return data to each other, the return arrows might benefit from labels that tell the reader what the return values are.\n\n------\n\n### Illustration tools\n\nThere are many options available for creating diagrams. Three options that are free or have free options include:\n\n- [Google Drawings](https://drawings.google.com/?hl=zh-cn)\n- [Draw.IO](https://draw.io/)\n- [LucidChart](https://www.lucidchart.com/pages/)\n\nWhen exporting diagrams from these tools to use in documentation, it is usually best to export the files as SVG or [Scalable Vector Graphics](https://wikipedia.org/wiki/Scalable_Vector_Graphics). Scalable Vector Graphics easily scale diagrams based on space constraints so that no matter the size, you end up with a high quality image.\n\n\n\n------\n\n\n\n## Creating sample code\n\n\n\n> **Estimated Time:** 10 minutes\n\n\nGood sample code is often the best documentation. Even if your paragraphs and lists are as clear as blue water, programmers still prefer good sample code. After all, text is a different language than code, and it is code that the reader ultimately cares about. Trying to describe code with text is like trying to explain an Italian poem in English.\n\nGood samples are **correct** and **concise** code that your readers can **quickly understand** and **easily reuse** with **minimal side effects**.\n\n### Correct\n\nSample code should meet the following criteria:\n\n- Build without errors.\n- Perform the task it claims to perform.\n- Be as production-ready as possible. For example, the code shouldn't contain any security vulnerabilities.\n- Follow language-specific conventions.\n\nSample code is an opportunity to directly influence how your users write code. Therefore, sample code should set the best way to use your product. If there is more than one way to code the task, code it in the manner that your team has decided is best. If your team hasn't considered the pros and cons of each approach, take time to do so.\n\nAlways test your sample code. Over time, systems change and your sample code may break. Be prepared to test and maintain sample code as you would any other code.\n\nMany teams reuse their unit tests as sample programs, which is sometimes a bad idea. The primary goal of a unit test is to test; the only goal of a sample program is to educate.\n\nA **snippet** is a piece of a sample program, possibly only one or a few lines long. Snippet-heavy documentation often degrades over time because teams tend not to test snippets as rigorously as full sample programs.\n\n### Running sample code\n\nGood documents explain how to run sample code. For example, your document might need to tell users to perform activities such as the following prior to running the samples:\n\n- Install a certain library.\n- Adjust the values assigned to certain environment variables.\n- Adjust something in the integrated development environment (IDE).\n\nUsers don't always perform the preceding activities properly. In some situations, users prefer to run or (experiment with) sample code directly in the documentation. (\"Click here to run this code.\")\n\nWriters should consider describing the expected output or result of sample code, especially for sample code that is difficult to run.\n\n### Concise\n\nSample code should be short, including only essential components. When a novice C programmer wants to learn how to call the `malloc` function, give that programmer a brief snippet, not the entire Linux source tree. Irrelevant code can distract and confuse your audience. That said, never use bad practices to shorten your code; always prefer correctness over conciseness.\n\nUnderstandable\n\nFollow these recommendations to create clear sample code:\n\n- Pick descriptive class, method, and variable names.\n- Avoid confusing your readers with hard-to-decipher programming tricks.\n- Avoid deeply nested code.\n- Optional: Use bold or colored font to draw the reader's attention to a specific section of your sample code. However, use highlighting judiciouslyâ€”too much highlighting means the reader won't focus on anything in particular.\n\n#### Exercise\n\nWhich of the following would be a more helpful line of code in a sample program? Assume that the target audience consists of software engineers new to the `go.so` API.\n\n1. `MyLevel = go.so.Level(5, 28, 48)`\n2. `MyLevel = go.so.Level(rank=5, 28, 48)`\n3. `MyLevel = go.so.Level(rank=5, dimension=28, opacity=48)`\n\n\n\n##### Answer.\n\nAnswer **3** is the best choice here. Although it is tempting to keep sample code as short as possible, omitting parameter names makes it harder for novices to learn.\n\n------\n\n### Commented\n\nConsider the following recommendations about comments in sample code:\n\n- Keep comments short, but always prefer clarity over brevity.\n- Avoid writing comments about *obvious* code, but remember that what is obvious to you (the expert) might not be obvious to newcomers.\n- Focus your commenting energy on anything non-intuitive in the code.\n- When your readers are very experienced with a technology, don't explain *what* the code is doing, explain *why* the code is doing it.\n\nShould you place descriptions of code inside code comments or in text (paragraphs or lists) outside of the sample code? Note that readers who copy-and-paste a snippet gather not only the code but also any embedded comments. So, put any descriptions that belong in the pasted code into the code comments. By contrast, when you must explain a lengthy or tricky concept, you should typically place the text before the sample program.\n\n**Note:** If you must sacrifice production readiness in order to make the code shorter and easier to understand, explain your decisions in the comments.\n\n#### Exercise\n\nWhat problems do you see in the comments within the following snippet? Assume that the code is aimed at programmers who are new to the `br` API but who have some experience with the concept of streams:\n\n```\n/* Create a stream from the text file at pathname /tmp/myfile. */\nmystream = br.openstream(pathname=\"/tmp/myfile\", mode=\"z\")\n```\n\n\n\n##### Answer.\n\nThe comments contain the following flaws:\n\n- The comment elaborates on a fairly obvious part of the code.\n- The snippet doesn't explain the non-obvious portion of the code. Namely, what is the `mode` parameter and what does a value of `z` mean?\n\n------\n\n### Reusable\n\nFor your reader to easily reuse your sample code, provide the following:\n\n- All information necessary to run the sample code, including any dependencies and setup.\n- Code that can be extended or customized in useful ways.\n\nHaving easy-to-understand sample code that's concise and compiles is a great start. If it blows up your reader's app, though, they won't be happy. Therefore, when writing sample code, consider any potential side effects caused by your code being integrated into another program. Nobody wants insecure or grossly inefficient code.\n\n### The example and the anti-example\n\nIn addition to showing readers *what to do*, it is sometimes wise to show readers *what not to do*. For example, many programming languages permit programmers to place white space on either side of the equals sign. Now suppose that you were writing a tutorial on a language (such as bash) that does not permit white space on either side of the equals sign. In this case, showing both a good example and an anti-example will benefit the reader. For example:\n\n\n\nGood\n\n```\n# A valid string assignment.\ns=\"The rain in Maine.\"\n```\n\nBad\n\n```\n# An invalid string assignment because of the white space on either side of the\n# equals sign.\ns = \"The rain in Maine.\"\n```\n\n### Sequenced\n\nA good sample code set demonstrates **a range of complexity**.\n\nReaders completely unfamiliar with a certain technology typically crave simple examples to get started. The first and most basic example in a sample code set is usually termed a [Hello World program](https://wikipedia.org/wiki/\"Hello,_World!\"_program). After mastering the basics, engineers want more complex programs. A good set of sample code provides a healthy range of simple, moderate, and complex sample programs.\n\n#### Exercise\n\nWhich of the following would be a good set of sample functions to support a tutorial introducing newcomers to the concept of functions?\n\n1. The following set of samples:\n   1. A function that takes no parameters and doesn't return anything.\n   2. A function that takes one parameter but doesn't return anything.\n   3. A function that takes one parameter and returns one value.\n   4. A function that takes three parameters and returns one value.\n2. The following set of functions:\n   1. A function that takes three parameters and returns one value.\n3. The following set of functions:\n   1. A function that takes one parameter and returns one value.\n   2. A function that takes three parameters and returns one value.\n\n\n\n##### Answer.\n\nThe best answer is **1**. Providing samples that cover a range of complexity is usually the wisest choiceâ€”particularly for newcomers. Resist the temptation to *rush* towards very complex sample programs, bypassing the beginner and intermediate sample programs that newcomers crave.\n\n------\n\n### What's next?\n\nCongratulations: you've completed the pre-class work for Technical Writing Two.\n\nIf the in-class portion of Technical Writing Two is available, please take it.\n\nA quick compilation of the topics covered in Technical Writing Two is available on the [Summary](https://developers.google.com/tech-writing/two/summary?hl=zh-cn) page.\n\n\n\n------\n\n## Summary of Technical Writing Two\n\n\nTechnical Writing Two covered the following intermediate lessons of technical writing:\n\n- Adopt a style guide.\n- Think like your audience.\n- Read documents out loud (to yourself).\n- Return to documents well after you've written the draft.\n- Find a good peer editor.\n- Outline a document. Alternatively, write free form and then organize.\n- Introduce a document's scope and any prerequisites.\n- Prefer task-based headings.\n- Disclose information progressively (in some situations).\n- Consider writing the caption *before* creating the illustration.\n- Constrain the amount of information in a single drawing.\n- Focus the reader's attention through discontinuities.\n- Create concise sample code that is easy to understand.\n- Keep code comments short, but prefer clarity over brevity.\n- Avoid writing comments about *obvious* code.\n- Focus your commenting energy on anything non-intuitive in the code.\n- Provide not only examples but also anti-examples.\n- Provide code samples that demonstrate a range of complexity.\n- Make a practice of continuous revision.\n- Provide different documentation types for different categories of users.\n- Compare and contrast with something that readers are already familiar with.\n- In tutorials, reinforce concepts with examples.\n- In tutorials, point out dragons.\n\nAs time permits, consider reviewing these additional [technical writing resources](https://developers.google.com/tech-writing/resources?hl=zh-cn).\n\n### References\n\n`[1]` Technical Writing One: *https://developers.google.com/tech-writing/one?hl=zh-cn*\n`[2]` Technical Writing Two: *https://developers.google.com/tech-writing/two?hl=zh-cn*\n`[3]` Words: *https://developers.google.com/tech-writing/one/words?hl=zh-cn*\n`[4]` 1: *https://developers.google.com/tech-writing/one/active-voice?hl=zh-cn#Footnote1*\n`[5]` Words: *https://developers.google.com/tech-writing/one/words?hl=zh-cn*\n`[6]` sesquipedalian: *https://www.google.com/search?q=sesquipedalian&hl=zh-cn*\n`[7]` www.markdowntutorial.com: *https://www.markdowntutorial.com/*\n`[8]` Mastering Markdown: *https://guides.github.com/features/mastering-markdown/*\n`[9]` Summary: *https://developers.google.com/tech-writing/one/summary?hl=zh-cn*\n`[10]` technical writing resources: *https://developers.google.com/tech-writing/resources?hl=zh-cn*\n`[11]` Technical Writing One: *https://developers.google.com/tech-writing/one?hl=zh-cn*\n`[12]` self-study units: *https://developers.google.com/tech-writing/one?hl=zh-cn*\n`[13]` Google Developers: *https://developers.google.com/?hl=zh-cn*\n`[14]` Google Developer Documentation Style Guide: *https://developers.google.com/style?hl=zh-cn*\n`[15]` style-guide highlights: *https://developers.google.com/style/highlights?hl=zh-cn*\n`[16]` active voice: *https://developers.google.com/tech-writing/one/active-voice?hl=zh-cn*\n`[17]` numbered lists: *https://developers.google.com/tech-writing/one/lists-and-tables?hl=zh-cn*\n`[18]` Write in the second person: *https://developers.google.com/style/person?hl=zh-cn*\n`[19]` Place conditional clauses before an instruction: *https://developers.google.com/style/clause-order?hl=zh-cn*\n`[20]` code-related text as code font: *https://developers.google.com/style/code-in-text?hl=zh-cn*\n`[21]` Audience: *https://developers.google.com/tech-writing/one/audience?hl=zh-cn*\n`[22]` Style and authorial tone: *https://developers.google.com/style/tone?hl=zh-cn*\n`[23]` Nirmal Dulal [CC BY-SA 4.0 (https://creativecommons.org/licenses/by-sa/4.0)]: *https://commons.wikimedia.org/wiki/File:Nepalese_Children.JPG*\n`[24]` Sung and Mayer (2012): *https://www.sciencedirect.com/science/article/pii/S0747563212000921*\n`[25]` Portrait of Pere Tanguy By Vincent van Gogh - MusÃ©e Rodin [Public domain]: *https://commons.wikimedia.org/wiki/File:Van_Gogh_-_Portrait_of_Pere_Tanguy_1887-8.JPG*\n`[26]` NASA / JPL-Caltech / University of Arizona [Public domain]: *https://commons.wikimedia.org/wiki/File:Phobos_colour_2008.jpg*\n`[27]` evolution of the London Tube map: *https://wikipedia.org/wiki/Tube_map#History*\n`[28]` [Public domain]: *https://commons.wikimedia.org/wiki/File:Tube_map_1908.jpg*\n`[29]` modern tube map: *https://www.google.com/search?tbm=isch&q=london+tube+map&hl=zh-cn*\n`[30]` standard color contrast recommendations: *https://material.io/design/color/text-legibility.html#legibility-standards*\n`[31]` Google Drawings: *https://drawings.google.com/?hl=zh-cn*\n`[32]` Draw.IO: *https://draw.io/*\n`[33]` LucidChart: *https://www.lucidchart.com/pages/*\n`[34]` Scalable Vector Graphics: *https://wikipedia.org/wiki/Scalable_Vector_Graphics*\n`[35]` Hello World program: *https://wikipedia.org/wiki/\"Hello,_World!\"_program*\n`[36]` Summary: *https://developers.google.com/tech-writing/two/summary?hl=zh-cn*\n`[37]` technical writing resources: *https://developers.google.com/tech-writing/resources?hl=zh-cn*\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "Technical Writing Courses",
        "date": "2020-03-01 12:46:40",
        "tags": [
          "æ•™ç¨‹",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "google-Technical-Writing-Courses"
    },
    {
      "content": "\n##  ã€Œå·¥å…·æ¨èã€[go-callvis](https://github.com/TrueFurby/go-callvis)\n\ngo-callvisæ˜¯ç›¸å¯¹ ä»¥å›¾ç‰‡çš„å½¢å¼å±•ç¤ºäº†goç¨‹åºçš„è°ƒç”¨å…³ç³»ï¼Œè¿™ä¸ªå·¥å…·åœ¨çœ‹å¤æ‚é¡¹ç›®æ—¶å°¤å…¶æœ‰ç”¨ã€‚\n\n>  äº²æµ‹ï¼Œå€ŸåŠ©å®ƒçœ‹ç¥–ä¼ golangä»£ç ï¼Œå¤´ç—›å¥½å¤šäº†ã€‚\n\n\n\n### å®‰è£…\n\n```sh\ngo get -u github.com/TrueFurby/go-callvis\n# or\ngit clone https://github.com/TrueFurby/go-callvis.git\ncd go-callvis && make install\n```\n\n\n\nè¿è¡Œä¾èµ–\n\n- [Go](https://golang.org/dl/) 1.12+\n- [Graphvizï¼šhttp://www.graphviz.org/download/](http://www.graphviz.org/download/) Mac å¯ä»¥ç›´æ¥ brew install graphviz\n\n\n\n[é¡¹ç›®åœ°å€ï¼šhttps://github.com/TrueFurby/go-callvis](https://github.com/TrueFurby/go-callvis)\n\n\n\n### ä½¿ç”¨å‘½ä»¤\n\nå‘½ä»¤ç‰¹åˆ«ç®€å•ï¼Œåªéœ€è¦ç®€å•çš„è¾“å…¥ï¼š\n\n\n```sh\ngo-callvis [OPTIONS] <main package>\n```\n\n\n\nè¿™é‡Œ main package æ˜¯åŒ…å«ä»£ç çš„mainå‡½æ•°æ‰€åœ¨çš„åŒ…ï¼Œæ¯”å¦‚é¡¹ç›® https://github.com/gusibi/oneplus/tree/master/idgenerator\n\nç›®å½•ç»“æ„ä¸ºï¼š\n\n```sh\n.\nâ”œâ”€â”€ README.md\nâ””â”€â”€ src\n    â”œâ”€â”€ dbs\n    â”œâ”€â”€ go.mod\n    â”œâ”€â”€ go.sum\n    â”œâ”€â”€ idg\n    â”‚   â”œâ”€â”€ area_code.go\n    â”‚   â”œâ”€â”€ idg.go\n    â”‚   â”œâ”€â”€ idg_test.go\n    â”‚   â”œâ”€â”€ index.go\n    â”‚   â”œâ”€â”€ index_test.go\n    â”‚   â”œâ”€â”€ sort.go\n    â”‚   â”œâ”€â”€ sort_test.go\n    â”‚   â”œâ”€â”€ wr.go\n    â”‚   â””â”€â”€ wr_test.go\n    â”œâ”€â”€ main.go\n    â””â”€â”€ sorteDB\n```\n\nå…¶ä¸­srcç›®å½•æ˜¯ä¸€ä¸ªgo packageï¼Œè¿è¡Œgo-callvis æ—¶å°±éœ€è¦å…ˆ**cd src/**ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤ï¼š\n\n\n\n```sh\ngo-callvis  -group pkg,type md52id\n```\n\n> md52id æ˜¯package nameï¼Œå·²åœ¨go.modä¸­å£°æ˜ï¼Œpakage nameæ˜¯ä¸€ä¸ªå¿…é¡»è¦å¸¦çš„å‚æ•°ã€‚\n\n \n\nè¿è¡Œå‘½ä»¤ï¼Œé»˜è®¤ä¼šæ‰“å¼€æµè§ˆå™¨åŠ è½½åœ°å€**http://localhost:7878**\n\n> å›¾ç‰‡æ ¼å¼ä¸º svgï¼Œä¹Ÿå¯ä»¥æ·»åŠ  -format=pngï¼ŒæŒ‡å®šä»¥pngå½¢å¼å±•ç¤º\n>\n> æ¨èä½¿ç”¨svgï¼Œsvgæ ¼å¼çš„å†…å®¹æ˜¯å¯äº¤äº’çš„ï¼Œæ¯”å¦‚è¿™é‡Œæƒ³æŸ¥çœ‹ginåŒ…çš„å†…å®¹å°±å¯ä»¥ç‚¹å‡» å¯¹åº”çš„æ¨¡å—æ¥çœ‹è¯¦æƒ…ã€‚\n\n![](http://media.gusibi.mobi/clJZosivjY3n-3G5Bm-kQu6BbuAAV5z_L8iMjR8CoJSknZWRTiF51g9X8hHVq0jk)\n\nç»“æœå¦‚æœæ‰€ç¤ºï¼Œå›¾åƒå±•ç¤ºçš„ç»“æœå°±æ˜¯è¿™ä¸ªåŒ…æ‰€æœ‰çš„è°ƒç”¨å…³ç³»ï¼ŒæŒ‰åŒ…çš„è°ƒç”¨å±‚çº§ç”±å·¦å‘å³æ’åˆ—ã€‚ç¬¬äºŒåˆ—ä¸Šè¾¹æ˜¯ gin æ¡†æ¶çš„ä»£ç ï¼Œå¦‚æœçœ‹ä»£ç æ—¶ä¸æƒ³çœ‹è¿™éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨ ignore å‚æ•°æ’é™¤æ‰ã€‚\n\nå‘½ä»¤ä¸ºï¼š\n\n```sh\ngo-callvis -group pkg,type -ignore github.com/gin-gonic/gin md52id\n```\n\n> è¿™é‡Œ gin åŒ…çš„åå­—æ˜¯ *github.com/gin-gonic/gin*è€Œä¸æ˜¯ *gin*\n>\n> å¦‚æœè¦å†æ’å‡ºidg åŒ…ï¼Œå¯ä»¥ç›´æ¥åŠ åœ¨gin åŒ…åè¾¹ï¼Œç”¨,ï¼ˆè‹±æ–‡é€—å·ï¼‰éš”å¼€ã€‚\n>\n> ä½¿ç”¨limit å‘½ä»¤å¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœ\n>\n> go-callvis  -group pkg,type -limit md52id md52id\n\nå¾—åˆ°çš„ç»“æœä¸ºï¼š\n\n![](http://media.gusibi.mobi/I8l10FfoYRXYj0VtxMqbTwsz-mpQ7jsgaiq4Exd_8WNglM_mYDbWF6sye9x2uO-c)\n\nå¦‚æœæƒ³çœ‹idgåŒ…å†…éƒ¨çš„è°ƒç”¨å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ focus å‘½ä»¤ï¼ŒæŒ‡å®šidg åŒ…ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n\n```sh\ngo-callvis -focus=md52id/idg -group pkg,type -limit md52id md52id\n```\n\n\n\nç»“æœå¦‚å›¾ï¼š\t![](http://media.gusibi.mobi/7WYETqHNJ2ShtiLf-rHKyWqLOnGVdLnBzTGiA_JBdzL26WwnwwaTkZ4xFBTh4-D4)\n\n\n\nè¯¦ç»†å‘½ä»¤å¯ä»¥å‚è€ƒï¼šhttps://github.com/TrueFurby/go-callvis/tree/master/examples\n\n\n\nä½¿ç”¨go-callvis ï¼Œç›´è§‚çš„å±•ç¤ºä»£ç çš„è°ƒç”¨å…³ç³»ï¼Œå¯¹äºå¤§é¡¹ç›®çš„æºç å°¤å…¶æœ‰ç”¨ï¼Œæ¯”å¦‚ä¸‹å›¾æ˜¯gin stagic åŒ…çš„è°ƒç”¨å…³ç³»ï¼š\n\n\n\n![](http://media.gusibi.mobi/VjziH07V8r_X33RlnVo2WeEWa0od4OvAnw9eJoCiAd1eLAAC-I3XuniOeWK0OVCW)\n\n\n\né€šè¿‡å›¾å¯ä»¥ç›´è§‚çš„çœ‹åˆ°ï¼Œ\n\n1. static è°ƒç”¨äº† staticFSï¼Œè€ŒstaticFS åªä½¿ç”¨äº† HEADå’ŒGET æ–¹æ³•ã€‚\n2. æ‰€æœ‰çš„http method æœ€ç»ˆéƒ½æ˜¯é€šè¿‡è°ƒç”¨handleræ¥å¤„ç†å“åº”çš„ã€‚\n\n### ### go-callvis çš„å¦ç±»ç”¨æ³•\n\n\n\ngo-callvis ä¹Ÿå¯ä»¥ç”¨æ¥è¯„ä¼°ç³»ç»Ÿè®¾è®¡æ˜¯å¦åˆç†ï¼Œä»£ç æ˜¯å¦æ¸…æ™°ï¼Œä¸‹å›¾æ˜¯docker çš„è°ƒç”¨å›¾ï¼š\n\n\n\n![](http://media.gusibi.mobi/8vZ7dwD6bLOVUBecbWsC5ZMTDOSUeeLzRw2kfxL44TVO8BM0AFGHGzVO1iHJCFqd)\n\n\n\n> åŸå›¾åœ°å€ï¼šhttp://media.gusibi.mobi/8vZ7dwD6bLOVUBecbWsC5ZMTDOSUeeLzRw2kfxL44TVO8BM0AFGHGzVO1iHJCFqd\n\n\n\nå¯ä»¥çœ‹åˆ°ï¼Œä»£ç ç»“æ„éå¸¸æ¸…æ™°ï¼Œè°ƒç”¨é“¾ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé¡¹ç›®æˆåŠŸæœç„¶æ¯ä¸€ç¯éƒ½åšçš„éå¸¸å®Œç¾ã€‚\n\n### References\n\n`[1]` go-callvis: *https://github.com/TrueFurby/go-callvis*\n`[2]` Go: *https://golang.org/dl/*\n`[3]` Graphvizï¼šhttp://www.graphviz.org/download/: *http://www.graphviz.org/download/*\n`[4]` é¡¹ç›®åœ°å€ï¼šhttps://github.com/TrueFurby/go-callvis: *https://github.com/TrueFurby/go-callvis*\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨\n\nä»¥ä¸‹æ˜¯shopeeå†…æ¨å¹¿å‘Šï¼Œã€Œæ·±åœ³ã€æ–°åŠ å¡ã€ä¸Šæµ·ã€çš„èŒä½éƒ½æœ‰ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç•™è¨€æˆ–è€…è¯†åˆ«äºŒç»´ç ç›´æ¥æŠ•é€’ã€‚\n\n![](http://media.gusibi.mobi/3Z6eP3JKdGQkAdfFm3X9cgV1x46YLwIX8iP8Rvg7_QSwYKYTRjAyt0jVEHKdql3P)\n\n",
      "data": {
        "title": "ã€Œå·¥å…·æ¨èã€golang ä»£ç å¯è§†åŒ–å·¥å…· go-callvis",
        "date": "2020-01-19 15:14:13",
        "tags": [
          "å·¥å…·",
          "golang"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "go-callvis"
    },
    {
      "content": "\n> **é¢˜ç›®**ï¼šè®¾è®¡ä¸€ä¸ªèº«ä»½è¯æŸ¥è¯¢ç³»ç»Ÿï¼Œå°†èº«ä»½è¯å·md5 ä¹‹åå­˜å‚¨ï¼Œè¾“å…¥md5å€¼æŸ¥è¯¢å¯¹åº”çš„èº«ä»½è¯å·ã€‚ \n> **è¦æ±‚ï¼šæˆæœ¬ä½ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«** \n\n\n### è®¾è®¡æ€è·¯ï¼š \n\n1. å°†æ‰€æœ‰å¯èƒ½çš„èº«ä»½è¯å·åšä¸€ä¸ªç®€å•çš„ç»Ÿè®¡è®¡ç®—æ•°æ®é‡ \n2. æ ¹æ®æ•°æ®é‡é€‰æ‹©å­˜å‚¨æ–¹å¼ \n3. æŸ¥è¯¢ \n\n\n### èº«ä»½è¯ç”Ÿæˆè§„åˆ™ï¼š \n\n\nèº«ä»½å·ç æ˜¯ç‰¹å¾ç»„åˆç ï¼Œç”±å‰åä¸ƒä½æ•°å­—æœ¬ä½“ç å’Œæœ€åä¸€ä½æ•°å­—æ ¡éªŒç ç»„æˆã€‚æ’åˆ—é¡ºåºä»å·¦è‡³å³ä¾æ¬¡ä¸ºå…­ä½æ•°å­—åœ°å€ç ï¼Œå…«ä½æ•°å­—å‡ºç”Ÿæ—¥æœŸç ï¼Œä¸‰ä½æ•°å­—é¡ºåºç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ã€‚ \n\n**åœ°å€ç **ï¼š è¡¨ç¤ºç¼–ç å¯¹è±¡å¸¸ä½æˆ·å£æ‰€åœ¨å¿(å¸‚ã€æ——ã€åŒº)çš„è¡Œæ”¿åŒºåˆ’ä»£ç ã€‚å¯¹äºæ–°ç”Ÿå„¿ï¼Œè¯¥åœ°å€ç ä¸ºæˆ·å£ç™»è®°åœ°è¡Œæ”¿åŒºåˆ’ä»£ç ã€‚éœ€è¦æ²¡è¯´æ˜çš„æ˜¯ï¼Œéšç€è¡Œæ”¿åŒºåˆ’çš„è°ƒæ•´ï¼ŒåŒä¸€ä¸ªåœ°æ–¹è¿›è¡Œæˆ·å£ç™»è®°çš„å¯èƒ½å­˜åœ¨åœ°å€ç ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¡Œæ”¿åŒºåˆ’ä»£ç æŒ‰GB/T2260çš„è§„å®šæ‰§è¡Œã€‚ \n\n**å‡ºç”Ÿæ—¥æœŸç **ï¼šè¡¨ç¤ºç¼–ç å¯¹è±¡å‡ºç”Ÿçš„å¹´ã€æœˆã€æ—¥ï¼Œå¹´ã€æœˆã€æ—¥ä»£ç ä¹‹é—´ä¸ç”¨åˆ†éš”ç¬¦ï¼Œæ ¼å¼ä¸ºYYYYMMDDï¼Œå¦‚19880328ã€‚æŒ‰GB/T 7408çš„è§„å®šæ‰§è¡Œã€‚åŸ15ä½èº«ä»½è¯å·ç ä¸­å‡ºç”Ÿæ—¥æœŸç è¿˜æœ‰å¯¹ç™¾å²è€äººç‰¹å®šçš„æ ‡è¯†ï¼Œå…¶ä¸­999ã€998ã€997ã€996åˆ†é…ç»™ç™¾å²è€äººã€‚ \n\n**é¡ºåºç **ï¼š è¡¨ç¤ºåœ¨åŒä¸€åœ°å€ç æ‰€æ ‡è¯†çš„åŒºåŸŸèŒƒå›´å†…ï¼Œå¯¹åŒå¹´ã€åŒæœˆã€åŒæ—¥å‡ºç”Ÿçš„äººç¼–å®šçš„é¡ºåºå·ï¼Œé¡ºåºç çš„å¥‡æ•°åˆ†é…ç»™ç”·æ€§ï¼Œå¶æ•°åˆ†é…ç»™å¥³æ€§ã€‚ \n\n**æ ¡éªŒç **ï¼š æ ¹æ®æœ¬ä½“ç ï¼Œé€šè¿‡é‡‡ç”¨ISO 7064:1983,MOD 11-2æ ¡éªŒç ç³»ç»Ÿè®¡ç®—å‡ºæ ¡éªŒç ã€‚ç®—æ³•å¯å‚è€ƒä¸‹æ–‡ã€‚å‰é¢æœ‰æåˆ°æ•°å­—æ ¡éªŒç ï¼Œæˆ‘ä»¬çŸ¥é“æ ¡éªŒç ä¹Ÿæœ‰Xçš„ï¼Œå®è´¨ä¸Šä¸ºç½—é©¬å­—ç¬¦Xï¼Œç›¸å½“äº10. \n\n\n#### æ ¡éªŒç ç®—æ³• \n\nå°†æœ¬ä½“ç å„ä½æ•°å­—ä¹˜ä»¥å¯¹åº”åŠ æƒå› å­å¹¶æ±‚å’Œï¼Œé™¤ä»¥11å¾—åˆ°ä½™æ•°ï¼Œæ ¹æ®ä½™æ•°é€šè¿‡æ ¡éªŒç å¯¹ç…§è¡¨æŸ¥å¾—æ ¡éªŒç ã€‚ \n\n\n**åŠ æƒå› å­è¡¨**ï¼š \n\n```sh\n+-----------------------------------------------------------+ \n|ä½ç½®åºå·|1 |2 |3 |4 |5 |6 |7 |8 |9 |10|11|12|13|14|15|16|17| \n+-----------------------------------------------------------+ \n|åŠ æƒå› å­|7 |9 |10|5 |8 |4 |2 |1 |6 |3 |7 |9 |10|5 |8 |4 |2 | \n+-----------------------------------------------------------+ \n```\n\n**æ ¡éªŒç è¡¨**: \n\n```sh\n+----------------------------------------------------+ \n| ä½™æ•°  | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | \n+----------------------------------------------------+ \n| æ ¡éªŒç | 1 | 0 | X | 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2  | \n+----------------------------------------------------+ \n```\n\n\n#### ç®—æ³•ä¸¾ä¾‹ï¼š \n\n\næœ¬ä½“ç ä¸º11010519491231002 \n\n* ç¬¬ä¸€æ­¥ï¼šå„ä½æ•°ä¸å¯¹åº”åŠ æƒå› å­ä¹˜ç§¯æ±‚å’Œ1* 7+1 * 9+0 * 10+1 * 5+ *** =167 \n* ç¬¬äºŒæ­¥ï¼šå¯¹æ±‚å’Œè¿›è¡Œé™¤11å¾—ä½™æ•°167%11=2 \n* ç¬¬ä¸‰æ­¥ï¼šæ ¹æ®ä½™æ•°2å¯¹ç…§æ ¡éªŒç å¾—X \n\n**å› æ­¤å®Œæ•´èº«ä»½è¯å·ä¸ºï¼š11010519491231002X **\n\n\n### é¢„ä¼°æ•°æ®é‡ï¼š \n\n\n1. èº«ä»½è¯å·18ä½ï¼Œå‰å…­ä½ä¸ºåœ°åŒºç ï¼Œä¸­é—´å…«ä½ä¸ºæ—¥æœŸï¼Œæ—¥æœŸåä¸‰ä½ä¸ºé¡ºåºç ï¼Œæœ€åä¸€ä½ä¸ºæ ¡éªŒä½ï¼Œå 32ä¸ªå­—èŠ‚ \n2. md5å€¼ä¸º32ä½ï¼Œå 32ä¸ªå­—èŠ‚ \n3. è®¡ç®—æœ€è¿‘100å¹´æ•°æ®ï¼Œå¤§çº¦æ•°æ®é‡ä¸ºï¼š`3465x100x365x999=126346027500 `\n4. æ•°æ®ä»¥å­—ç¬¦ä¸²å­˜å‚¨ï¼Œæ¯æ¡æ•°æ®`32+18=50B` \n5. åˆ™æ•°æ®é‡ä¸º `126346027500 x 50=6317301375000B=6169239624k=6024648M=5883G=5.74T ``\n\n\n> å­˜å‚¨æ–¹å¼æœ‰æ–‡ä»¶å­˜å‚¨ã€å…³ç³»å‹æ•°æ®åº“å­˜å‚¨å’Œeså­˜å‚¨ç­‰ã€‚ä»ç»“æœå¯ä»¥çœ‹åˆ°æœ‰æ¥è¿‘6Tçš„æ•°æ®ï¼Œå¦‚æœå­˜å…¥æ•°æ®åº“æˆ–es**æˆæœ¬è¾ƒé«˜**ï¼Œè¿™é‡Œé€‰æ‹©ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚ \n\n\n**é‚£æœ‰æ²¡æœ‰æ–¹å¼å‹ç¼©å­˜å‚¨ç©ºé—´å‘¢ï¼Ÿ**\n\n\n1. èº«ä»½è¯å·æœ€åä¸€ä½ä¸ºæ ¡éªŒä½ï¼Œå¯ä»¥ä¸å­˜å‚¨ï¼Œçœç•¥æ‰è¿™ä¸€ä½ä¼šèŠ‚çº¦1/50ç‚¹ç©ºé—´ \n2. ä¸ä»¥å­—ç¬¦ä¸²çš„æ–¹å¼å­˜å‚¨ï¼Œå°†èº«ä»½è¯å·ä»¥uint64å­˜å‚¨ï¼Œmd5å€¼ä¹Ÿè½¬åŒ–æˆä¸¤ä¸ªuint64å­˜å‚¨ã€‚uint64å 8é˜å­—èŠ‚ç©ºé—´ï¼Œè¿™æ ·ä¸€æ¡æ•°æ®çš„ç©ºé—´ç”±50é™ä¸ºäº† 24ã€‚æœ€ç»ˆæ•°æ®é‡ä¸º2.74Tï¼ŒèŠ‚çº¦ä¸€åŠå¤šçš„ç©ºé—´ã€‚ \n\n\n**é‚£ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªæ–‡ä»¶å¤šå¤§åˆé€‚å‘¢ï¼Ÿ**\n\nå¦‚æœæ–‡ä»¶å¤ªå¤§ï¼Œæ¯æ¬¡å°†æ–‡ä»¶è¯»å–åˆ°å†…å­˜ä¸­è€—æ—¶è¾ƒé•¿ï¼Œå¦‚æœæ–‡ä»¶å¤ªå°ï¼Œåˆ™ä¼šç”Ÿæˆå¤ªå¤šçš„æ–‡ä»¶å¯èƒ½è¶…å‡ºç³»ç»Ÿçš„æ–‡ä»¶æ•°é™åˆ¶ã€‚ \n\nè¿™é‡Œå¯ä»¥å‚è€ƒæ•°æ®åº“ç´¢å¼•çš„å­˜å‚¨æ–¹å¼ï¼Œè®¾å®šæ¯ä¸ªæ•°æ®æ–‡ä»¶çš„å¤§å°ï¼ˆ2.8Tæ•°æ®å¯ä»¥è®¾ç½®æ¯ä¸ªæ•°æ®æ–‡ä»¶1Gå·¦å³ã€‚\n\n### æ•°æ®ç”Ÿæˆåå¦‚ä½•æŸ¥è¯¢ï¼Ÿ \n\n1. éå†ï¼Œä¾æ¬¡è¯»å–æ–‡ä»¶ï¼ŒæŸ¥æ‰¾æ•°æ®ï¼Œæ•ˆç‡å¤ªä½\n2. è¿™é‡Œå‚è€ƒæ•°æ®åº“ç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼ï¼Œé¦–å…ˆå°†æ•°æ®æŒ‰md5å€¼æ’åºåå­˜å‚¨å¤šä¸ªæ–‡ä»¶ï¼Œè®°å½•æ¯ä¸ªæ–‡ä»¶ä¸­md5å€¼çš„èŒƒå›´ï¼Œè¾“å…¥md5å€¼ç¡®å®šæ–‡ä»¶ï¼Œå†è¯»å–æ–‡ä»¶ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚ \n3. è¿™æ—¶æŸ¥æ‰¾æ•°æ®åªéœ€è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å‡ ç™¾å…†çš„æ•°æ®ï¼ŒæŸ¥è¯¢æ•ˆç‡è¿˜æ˜¯å¤ªä½ï¼Œå†å‚è€ƒä¸€ä¸‹æ•°æ®åº“ç´¢å¼•ï¼Œè¿™é‡Œå°†æ–‡ä»¶å†…éƒ¨å†åˆ†é¡µï¼Œè®°å½•æ¯é¡µçš„èŒƒå›´ï¼Œå’Œæ–‡ä»¶æ‰€è‡ªèº«è®°å½•çš„èµ·å§‹å€¼ä¸€èµ·ç”Ÿæˆç´¢å¼•ï¼Œç´¢å¼•ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š \n\n![89b91ea63b15a762099ccc0a6fdaf412.png](http://media.gusibi.mobi/id2md5index.png)\n\n\nç´¢å¼•æ•°æ®ç»“æ„ä¸ºï¼š \n\n\n```python\n# ä¸ºäº†ç®€åŒ–å­˜å‚¨ï¼Œè¿™é‡Œfile1ã€file2ã€file3ã€file4 ä¸ºè¯¥æ–‡ä»¶ç¬¬ä¸€æ¡æ•°æ®çš„md5å€¼ï¼Œä¹Ÿæ˜¯å¯¹åº”çš„æ–‡ä»¶å\n# é¡µçš„å¤§å°å›ºå®šï¼Œæ‰€ä»¥äºŒçº§ç´¢å¼•åªéœ€è¦æŒ‰é¡ºåºè®°å½•æ¯é¡µçš„ç¬¬ä¸€ä¸ªmd5å€¼å³å¯\n\nindexes = { \n    \"file1\": [\"md51\", \"md52\", \"md53\", \"...\"],\n    \"file2\": [\"md51\", \"md52\", \"md53\", \"...\"], \n    \"file3\": [\"md51\", \"md52\", \"md53\", \"...\"], \n    \"file4\": [\"md51\", \"md52\", \"md53\", \"...\"],  \n} \n```\n\n\nç¬¬ä¸€å±‚ç´¢å¼•ä¸ºæ–‡ä»¶ç´¢å¼•ï¼Œé¦–å…ˆé€šè¿‡md5å€¼åˆ¤æ–­md5å€¼æ‰€åœ¨æ–‡ä»¶ï¼Œæ¯”å¦‚è¾“å…¥çš„ start1 > md5 > start1ï¼Œå¯ä»¥åˆ¤æ–­ç»“æœå¯èƒ½åœ¨file1 ä¸­ï¼› \n\nç¬¬äºŒå±‚ä¸ºæ–‡ä»¶å†…ç´¢å¼•ï¼Œé€šè¿‡md5å€¼åˆ¤æ–­æ‰€åœ¨çš„é¡µï¼Œè¯»å–æ ¹æ®offsetè¯»å–è¯¥é¡µçš„å…¨éƒ¨æ•°æ®ï¼Œå†é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°å¯¹åº”çš„èº«ä»½è¯å·ã€‚ \n\n\nä»£ç å®ç°æºç åœ°å€ï¼šhttps://github.com/gusibi/oneplus/tree/master/idgenerator\n\nä½¿ç”¨æ–¹å¼ï¼š\n```sh\n1. go run main.go\n2. curl http://127.0.0.1:8080/search?md5={id md5}\n```\n\n## å‚è€ƒé“¾æ¥ï¼š \n\n* [æºç åœ°å€](https://github.com/gusibi/oneplus/tree/master/idgenerator)\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å¦‚ä½•é€šè¿‡MD5åæŸ¥èº«ä»½è¯å·ï¼Ÿ",
        "date": "2019-08-18 06:22:26",
        "tags": [
          "æ•™ç¨‹",
          "å·¥å…·",
          "golang"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "id-md5-search"
    },
    {
      "content": "\nå‰å‡ å¤©å†™äº†ã€Šmarkdown ç”Ÿæˆå¤´æ¡æ–‡ç« çš„ä¸€ä¸ªæ€è·¯ã€‹ï¼Œå‘¨æœ«å°±è¯•äº†è¯•ã€‚\n\nå…ˆå›é¡¾ä¸€ä¸‹æ€è·¯ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š\n\n![](http://media.gusibi.mobi/AeaSby9Zk5mB9lMW2hiZDbSzaQa9VlpRaHomeb_mVndzFIn6oMEKbIKJqk3P59_U)\n\nè¿™é‡Œçš„ä¸‰ä¸ªå…³é”®ç‚¹æ˜¯ï¼š\n1. æå–code\n2. æŠŠcode è½¬æ¢ä¸ºhtml\n3. æŠŠhtml ç”Ÿæˆå›¾ç‰‡\n4. code æ›¿æ¢æˆå›¾ç‰‡\n\nç¬¬ä¸€ä¸ªå¾ˆç®€å•ï¼Œåªæœ‰ç”¨æ­£åˆ™è¡¨è¾¾å¼å°±å¯ä»¥è§£å†³ï¼š\n\n```python\n_fenced_code_block_re = re.compile(r'''\n    (?:\\n+|\\A\\n?)\n    ^```\\s*?([\\w+-]+)?\\s*?\\n # opening fence, $1 = optional lang\n    (.*?)                  # $2 = code block content\n    ^```[ \\t]*\\n           # closing fence\n    ''', re.M | re.X | re.S)\n```\n\n> è¿™ä¸ªæ­£åˆ™æ¥è‡ª python-markdown2: https://github.com/trentm/python-markdown2\n\nè¿™ä¸ªæ­£åˆ™åªåŒ¹é…äº† **```** æ ·å¼çš„ä»£ç ï¼Œå¯¹äºå‰è¾¹æœ‰å››ä¸ªç©ºæ ¼çš„å¹¶æ²¡æœ‰åšå¤„ç†ï¼ˆä¹Ÿä¸æƒ³åšå¤„ç†ï¼Œè¿˜æ˜¯ä¸¥æ ¼ä¸€ç‚¹å¥½ï¼‰ã€‚\n\nç¬¬äºŒä¸ªä¹Ÿä¸éº»çƒ¦ï¼Œåªéœ€è¦æŠŠæå–å‡ºçš„code æ”¾åˆ°html ä¸­ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªhtmlæ¨¡æ¿ï¼š\n\n```html\n<html>\n<head>\n   <link rel=\"stylesheet\" href=\"http://media.gusibi.mobi/highlight/static/styles/atom-one-dark.css\">\n   <script src=\"http://media.gusibi.mobi/highlight/static/highlight.site.pack.js\"></script>\n   <script>hljs.initHighlightingOnLoad();</script>\n</head>\n<body style=\"width: 640px;\">\n<pre>\n<code class=\"{{.Language}}\">{{.Code}}</code>\n</pre>\n</body>\n</html>`\n```\n\nè¿™é‡Œæœ‰ä¸€ä¸ªç‚¹æ˜¯æ¸²æŸ“html é¡µé¢çš„æ—¶å€™ï¼Œ ç”±äºåŠ è½½html é¡µé¢çš„å·¥å…·éƒ½æ˜¯getè¯·æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠcode æ•°æ®ä¿å­˜èµ·æ¥ã€‚æ‰€ä»¥è¯·æ±‚code çš„html é¡µé¢åˆ†æˆäº†ä¸¤æ­¥ã€‚\n\n1. å­˜å‚¨code\n2. è¯·æ±‚code å¯¹åº”çš„html\n\nåœ¨ html-server æœåŠ¡ä¸­ï¼Œå®ç°äº†code çš„å­˜å‚¨å’Œè¯·æ±‚ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```python\ndef code2html(code, language=\"plaintext\"):\n    data = {\n        \"code\": code,\n        \"language\": language\n    }\n    # å…ˆå­˜å‚¨ä»£ç \n    resp = requests.post(Code2HtmlCreateUrl, json=data)\n    if resp.status_code == 200:\n        content = resp.json()\n    else:\n        content = resp.content\n    return content[\"ID\"]\n\n```\n\nç¬¬ä¸‰ä¸ªé—®é¢˜æ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ã€‚\n\nå¼€å§‹çš„æ—¶å€™æ˜¯å‡†å¤‡ä½¿ç”¨pyqt5 ç”Ÿæˆå›¾ç‰‡ï¼Œä½†æ˜¯å®ƒæ¸²æŸ“html çš„å¤§å°å’Œç›´è§‰ä¸å¤ªä¸€è‡´ï¼ŒAPIä¹Ÿæ¯”è¾ƒå¤æ‚ã€‚æœ€å‘çš„æ˜¯ï¼Œä¸€æ¬¡ç”Ÿæˆå¤šå¼ å›¾ç‰‡æœ‰é—®é¢˜ï¼Œæœ€åæ”¹æˆäº†ä½¿ç”¨ çš„æ–¹å¼ã€‚\n\nå›¾ç‰‡ç”Ÿæˆçš„ä»£ç æ¯”è¾ƒç®€å•ï¼Œ\n\n```python\n# -*- coding: utf-8 -*-\n\nfrom selenium import webdriver\nimport time\nimport os.path\nimport multiprocessing as mp\n\ndef webshot(url, height, outfile):\n    driver = webdriver.PhantomJS()\n    driver.set_window_size(660, height)# è¿™é‡Œçš„å®½é«˜æ˜¯å…ˆè®¡ç®—å¥½æŒ‡å®šçš„\n    # driver.maximize_window()\n    # è¿”å›ç½‘é¡µçš„é«˜åº¦çš„jsä»£ç \n    js_height = \"return document.body.clientHeight\"\n    try:\n        driver.get(url)\n        k = 1\n        height = driver.execute_script(js_height)\n        while True:\n            if k*500 < height:\n                js_move = \"window.scrollTo(0,{})\".format(k * 500)\n                driver.execute_script(js_move)\n                time.sleep(0.2)\n                height = driver.execute_script(js_height)\n                k += 1\n            else:\n                break\n        driver.save_screenshot(outfile)\n        print(\"save screenshot to {} success\".format(outfile))\n        time.sleep(0.1)\n    except Exception as e:\n        print(outfile,e)\n```\n\nç¬¬å››ä¸ªé—®é¢˜å’Œç¬¬ä¸€ä¸ªé—®é¢˜ç°åœ¨æ˜¯å…³è”çš„ï¼Œæ“ä½œæ–¹å¼æ˜¯ï¼Œæ‰¾å‡ºcodeï¼Œå¤„ç†ç„¶åç›´æ¥æ›¿æ¢ï¼š\n\n```python\n     def _fenced_code_block_sub(self, match):\n        language = match.group(1)\n        codeblock = match.group(2)\n        image_path = code2img(codeblock, language)\n        image_url, _ = upload27niu(image_path)\n        return \"\\n\\n![](%s)\\n\\n\" % image_url\n\n    def _do_fenced_code_blocks(self, text):\n        \"\"\"Process ```-fenced unindented code blocks \n        ('fenced-code-blocks' extra).\"\"\"\n        return self._fenced_code_block_re.sub(\n            self._fenced_code_block_sub, text)\n```\n\nè¿™ä¹ˆåšè™½ç„¶ç®€å•ä½†æ˜¯å¼Šç«¯ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æ²¡æœ‰ä½¿ç”¨å¹¶å‘ï¼Œè„šæœ¬æ‰§è¡Œçš„æ…¢ã€‚å¦‚æœæƒ³æé«˜é€Ÿåº¦ï¼Œå¯ä»¥å…ˆæŠŠcode å…¨æ‰¾å‡ºæ¥ï¼Œç„¶åä½¿ç”¨å¤šè¿›ç¨‹æ¥å¤„ç†ã€‚\n\nä»£ç æˆ‘ä¸Šä¼ åˆ°äº†githubï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹\n\nä½¿ç”¨æ–¹æ³•\n\n```bash\ngit clone git@github.com:gusibi/oneplus.git\n\ncd oneplus\n\npython plus.py -m [markdown_path] -n [outfile_path]\n```\n\n## è½¬æ¢å‰åçš„æ•ˆæœ\n\nè¿™æ˜¯è½¬æ¢å‰ï¼š\n\nhttps://github.com/gusibi/oneplus/blob/master/325.md\n\nè¿™æ˜¯è½¬æ¢åï¼š\n\nhttps://github.com/gusibi/oneplus/blob/master/new_325.md\n\n\nè¿™ä¸ªåªæ˜¯ä¸€ä¸ªç²—ç³™çš„ä¼˜åŒ–æ–¹å¼ï¼Œä¹Ÿåªè¯†åˆ«äº†ä»£ç ï¼Œå¯¹äºæµç¨‹å›¾ï¼Œtable å¹¶æ²¡æœ‰é€‚é…ï¼Œä½œä¸ºä¸€ä¸ªä¼˜åŒ–é¡¹ä¹‹åå†åšå§ã€‚\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "markdownä¸­codeç”Ÿæˆå›¾ç‰‡çš„å®ç°",
        "date": "2019-06-15 15:34:53",
        "tags": [
          "python",
          "tutorial",
          "golang",
          "å…¬ä¼—å·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "mardown-code-to-image-2"
    },
    {
      "content": "\næœ€è¿‘åœ¨å¤´æ¡ä¸Šå†™ä¸œè¥¿ï¼Œé‡åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒçƒ¦çš„äº‹æƒ…---**ç¼–è¾‘å™¨ä¸æ”¯æŒä»£ç **ã€‚è¿™å¯¹äºä¸€ä¸ªåƒæˆ‘è¿™æ ·ä½¿ç”¨ä»£ç å‡‘å­—æ•°çš„äººæ¥è¯´å®åœ¨ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ¶ˆæ¯ã€‚ä½†æ˜¯ç­‰å¤´æ¡æ”¹è¿›ç¼–è¾‘å™¨å¤ªé¥è¿œäº†ï¼Œåªèƒ½è‡ªå·±è‡ªè¶³å®ç°ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆäº†--æŠŠä»£ç æ›¿æ¢æˆå›¾ç‰‡ã€‚\n\nä¸€æ®µä»£ç çš„æ—¶å€™ï¼Œæˆ‘éšæ‰‹æˆªå›¾ï¼Œç®€å•å®Œæˆäº†ï¼›\nä¸¤æ®µä»£ç çš„æ—¶å€™ï¼Œæˆ‘éšæ‰‹éšæ‰‹æˆªå›¾ï¼Œä¹Ÿå®Œæˆäº†ï¼›\nä¸‰æ®µä»£ç çš„æ—¶å€™ï¼Œæˆ‘éšæ‰‹éšæ‰‹éšæ‰‹æˆªå›¾ï¼Œå¼ºå¿ç€å®Œæˆäº†ï¼›\nç­‰æˆ‘å‘ç°ä»£ç è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œä¸èƒ½å¿äº†ã€‚\næ‡’æƒ°æ˜¯ç¨‹åºå‘˜çš„ç¾å¾·ï¼Œä¸èƒ½å†èŠ±è´¹æ—¶é—´å¹²è¿™äº›äº‹æƒ…äº†ã€‚æˆ‘è§‰å¾—è¦å†™ä¸ªç¨‹åºï¼ŒæŠŠmarkdown ä¸­çš„ä»£ç è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡ã€‚\n\n**è€ƒè™‘äº†ä¸€ä¸‹ï¼Œå¤§æ¦‚éœ€è¦åšçš„å·¥ä½œæ˜¯ï¼š**\n\n1. æŠŠmarkdown ä¸­ \"``` ```\" åŒ…æ¢çš„ä»£ç æå–å‡ºæ¥ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å…·å…ˆæŠŠmarkdown è½¬æ¢æˆhtml å†è§£æhtml å–å‡ºcode\n2. æŠŠæ¯ä¸€æ®µcode åˆ†åˆ«ç”Ÿæˆå›¾ç‰‡\n3. æŠŠå›¾ç‰‡å¯¹åº”çš„ä»£ç æ›¿æ¢æ‰\n\n\næƒ³æƒ³è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚é‚£å°±å¼€å§‹å§ã€‚\n\nä½†æ˜¯åˆ°ç¬¬äºŒæ­¥çš„æ—¶å€™é‡åˆ°äº†é—®é¢˜ï¼Œ**code å¦‚ä½•ç”Ÿæˆå›¾ç‰‡ï¼Œç”Ÿæˆä»€ä¹ˆæ ·çš„å›¾ç‰‡ï¼Ÿ**\n\n1. é¦–å…ˆcode éœ€è¦ä¿æŒåŸæœ‰çš„æ ·å¼ï¼Œå¦‚æœèƒ½é«˜äº®é‚£å°±æ›´å¥½äº†ï¼ˆå—¯ï¼Œé«˜äº®\n2. ç”Ÿæˆå›¾ç‰‡çš„æ—¶å€™æ˜¯æŠŠcode ä½œä¸ºæ–‡å­—ä½¿ç”¨PILï¼ˆæˆ‘ä½¿ç”¨pythonï¼‰å†™åœ¨èƒŒæ™¯ä¸Šä¹ˆï¼Œå›¾ç‰‡å¤§å°æ˜¯å¤šå°‘ï¼Œé«˜äº®æ€ä¹ˆå®ç°\n3. ç®—äº†ï¼Œè¿˜æ˜¯å…ˆæŠŠcode ç”Ÿæˆhtmlï¼Œç„¶åæˆªå–htmlé¡µé¢å§ã€‚ï¼ˆè¿™æ ·html è¿˜èƒ½ä½¿ç”¨ highlight.js æ¥å®ç°é«˜äº®ï¼‰\n4. å¦‚ä½•åŠ¨æ€ç”ŸæˆåŒ…å«code çš„html é¡µé¢å‘¢ï¼Ÿ\n5. å¦‚ä½•æŠŠæˆªå–html é¡µé¢å‘¢ï¼Ÿ\n\n\n**åŠ¨æ€ç”ŸæˆåŒ…å«code çš„html é¡µé¢æœ‰ä¸¤ä¸ªæ€è·¯ï¼š**\n\n1. ä½¿ç”¨post è¯·æ±‚ï¼ŒæŠŠcode å†™å…¥æ•°æ®åº“ï¼ˆæˆ–è€…æ–‡ä»¶ï¼‰ï¼Œç„¶åè¿”å›idï¼Œå†ä½¿ç”¨id GET è¯·æ±‚è·å–é¡µé¢ï¼ˆéœ€è¦å­˜å‚¨ï¼Œä¸¤æ¬¡è¯·æ±‚ï¼‰\n2. å‹ç¼©codeï¼ŒæŠŠcode ä½œä¸ºurlå‚æ•°ï¼Œä½¿ç”¨GETè¯·æ±‚è·å–é¡µé¢ï¼ˆå¯èƒ½ä¼šé€ æˆurlå¤ªé•¿çš„é”™è¯¯ï¼‰\n\n\n**é‚£å¦‚ä½•æˆªå–htmlå‘¢ï¼Ÿ**\n\nå¦‚æœæ˜¯pythonï¼Œå¯ä»¥ä½¿ç”¨pyqtï¼Œæ¸²æŸ“htmlé¡µé¢ï¼Œæˆªå–webviewã€‚\nå¦‚æœä½¿ç”¨nodeï¼Œå¯ä»¥ä½¿ç”¨ html2canvasã€‚\n\nå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š\n\n![](http://media.gusibi.mobi/AeaSby9Zk5mB9lMW2hiZDbSzaQa9VlpRaHomeb_mVndzFIn6oMEKbIKJqk3P59_U)\n\n\n**å“ï¼Œè¿™ä¸€ç¯‡æ²¡æœ‰ä»£ç ï¼Œå°±å‡‘ä¸äº†å¤šå°‘å­—ã€‚**\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "markdownä¸­codeç”Ÿæˆå›¾ç‰‡çš„æ€è·¯",
        "date": "2019-06-13 15:34:53",
        "tags": [
          "python",
          "tutorial",
          "golang",
          "å…¬ä¼—å·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "mardown-code-to-image-1"
    },
    {
      "content": "\n## é¢å‘DynamoDBçš„NoSQLè®¾è®¡\n\n### å…³ç³»æ•°æ®åº“è®¾è®¡å’ŒNoSQLä¹‹é—´çš„å·®å¼‚\n\n- å…³ç³»å‹æ•°æ®åº“å¯ä»¥çµæ´»çš„æŸ¥è¯¢æ•°æ®ï¼Œä½†æ˜¯æˆæœ¬è¾ƒé«˜ï¼Œé«˜æµé‡æ— æ³•æ‰©å±•\n  - RDBMS è®¾è®¡çµæ´»ï¼Œå¯ä»¥éšæ—¶ä¿®æ”¹\n- NoSQLæŸ¥è¯¢æ–¹å¼æœ‰é™\n  - éœ€è¦å¯¹æ¶æ„è¿›è¡Œä¸“é—¨è®¾è®¡ï¼Œä»¥å°½å¯èƒ½çš„åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚æ•°æ®ç»“æ„å’Œéœ€æ±‚é«˜åº¦ç›¸å…³ï¼Œéœ€è¦ç‰¹åˆ¶ã€‚\n\n### NoSQLè®¾è®¡çš„ä¸¤ä¸ªå…³é”®æ¦‚å¿µ\n\n- éœ€è¦å…ˆäº†è§£ä¸šåŠ¡é—®é¢˜å’Œåº”ç”¨ç¨‹åºçš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œç„¶åå†å¼€å§‹è®¾è®¡\n- åº”ä¿ç•™å°½å¯èƒ½å°‘çš„è¡¨ã€‚\n\n### äº†è§£NoSQLè®¾è®¡\n\n- ä¸‰ä¸ªåŸºæœ¬å±æ€§\n\n  - æ•°æ®å¤§å°\n\n    äº†è§£ä¸€æ¬¡å­˜å‚¨å’Œè¯·æ±‚çš„æ•°æ®é‡å°†æœ‰åŠ©äºç¡®å®šå¯¹æ•°æ®è¿›è¡Œåˆ†åŒºçš„æœ€æœ‰æ•ˆæ–¹æ³•ã€‚\n\n  - æ•°æ®å½¢çŠ¶\n\n    NoSQL æ•°æ®åº“ä¸ä¼šåœ¨å¤„ç†æŸ¥è¯¢æ—¶é‡å¡‘æ•°æ®ï¼ˆå¦‚ RDBMS ç³»ç»Ÿæ‰€åšçš„ä¸€æ ·ï¼‰ï¼Œè€Œæ˜¯æ•´ç†æ•°æ®ä»¥ä¾¿æ•°æ®åœ¨æ•°æ®åº“ä¸­çš„å½¢çŠ¶ä¸æŸ¥è¯¢å†…å®¹å¯¹åº”ã€‚è¿™æ˜¯åŠ å¿«é€Ÿåº¦å¹¶å¢å¼ºå¯æ‰©å±•æ€§çš„ä¸€ä¸ªå…³é”®å› ç´ \n\n  - æ•°æ®é€Ÿåº¦\n\n    DynamoDB é€šè¿‡å¢åŠ å¯ç”¨äºå¤„ç†æŸ¥è¯¢çš„ç‰©ç†åˆ†åŒºçš„æ•°é‡å¹¶é€šè¿‡è·¨è¿™äº›åˆ†åŒºæœ‰æ•ˆåˆ†å‘æ•°æ®æ¥è¿›è¡Œæ‰©å±•ã€‚é¢„å…ˆäº†è§£å³°å€¼æŸ¥è¯¢è´Ÿè½½å¯èƒ½æœ‰åŠ©äºç¡®å®šæ•°æ®åˆ†åŒºæ–¹å¼ï¼Œä»è€Œæœ€é«˜æ•ˆåœ°ä½¿ç”¨ I/O å®¹é‡ã€‚\n\n- æ€§èƒ½çš„ä¸€èˆ¬å‡†åˆ™\n\n  - å°†ç›¸å…³æ•°æ®æ”¾åœ¨ä¸€èµ·\n\n    å°†ç›¸å…³æ•°æ®é›†ä¸­æ”¾ç½®åˆ°ä¸€ä¸ªä½ç½®ã€‚å°†ç›¸å…³æ•°æ®ä¿ç•™åœ¨æœ€è¿‘ä½ç½®ä¼šå¯¹æˆæœ¬å’Œæ€§èƒ½äº§ç”Ÿé‡å¤§å½±å“ã€‚\n    ä¸æ˜¯è·¨å¤šä¸ªè¡¨åˆ†å‘ç›¸å…³æ•°æ®é¡¹ç›®ï¼Œè€Œæ˜¯åœ¨ NoSQL ç³»ç»Ÿä¸­å°½å¯èƒ½ç´§å¯†åœ°ä¿ç•™ç›¸å…³é¡¹ç›®ã€‚\n    ä½œä¸ºä¸€èˆ¬è§„åˆ™ï¼Œåº”åœ¨ DynamoDB åº”ç”¨ç¨‹åºä¸­ä¿ç•™å°½å¯èƒ½å°‘çš„è¡¨ã€‚\n\n    åªéœ€è¦ä¸€ä¸ªè¡¨ï¼Œ\n    ä¾‹å¤–æ˜¯æ¶‰åŠå¤§é‡æ—¶é—´åºåˆ—æ•°æ®çš„æƒ…å†µæˆ–å…·æœ‰æ˜æ˜¾ä¸åŒçš„è®¿é—®æ¨¡å¼çš„æ•°æ®é›† â€” ä½†è¿™äº›éƒ½æ˜¯ä¾‹å¤–ã€‚å…·æœ‰åå‘ç´¢å¼•çš„å•ä¸ªè¡¨é€šå¸¸å¯å¯ç”¨ç®€å•æŸ¥è¯¢æ¥åˆ›å»ºå’Œæ£€ç´¢åº”ç”¨ç¨‹åºæ‰€éœ€çš„å¤æ‚å±‚æ¬¡æ•°æ®ç»“æ„ã€‚\n\n  - ä½¿ç”¨æ’åºé¡ºåº\n\n    å¯å°†ç›¸å…³é¡¹ç›®ç»„ç»‡èµ·æ¥å¹¶è¿›è¡Œæœ‰æ•ˆæŸ¥è¯¢ï¼Œå‰ææ˜¯å®ƒä»¬çš„é”®è®¾è®¡å¯ä¿ƒä½¿å®ƒä»¬ä¸€èµ·æ’åº\n\n  - åˆ†å‘æŸ¥è¯¢\n\n    æ‚¨åº”è¯¥è®¾è®¡æ•°æ®é”®ä»¥è·¨å°½å¯èƒ½å¤šçš„åˆ†åŒºå‡åŒ€åˆ†å‘æµé‡ï¼Œä»è€Œé¿å…â€œçƒ­ç‚¹â€ã€‚\n\n  - ä½¿ç”¨å…¨å±€äºŒçº§ç´¢å¼•\n\n    é€šè¿‡åˆ›å»ºç‰¹å®šçš„å…¨å±€äºŒçº§ç´¢å¼•ï¼Œå¯å¯ç”¨ä¸»è¡¨æ”¯æŒçš„æŸ¥è¯¢ä»¥å¤–çš„æŸ¥è¯¢\n\n## è®¾è®¡å¹¶é«˜æ•ˆä½¿ç”¨åˆ†åŒºé”®çš„æœ€ä½³å®è·µ\n\né¡¹ç›®ä¸»é”®å¯ä»¥æ˜¯ä»…åˆ†åŒºé”®\nä¹Ÿå¯ä»¥æ˜¯åˆ†åŒºé”®+æ’åºé”®\n\n### é«˜æ•ˆä½¿ç”¨çªå¢å®¹é‡\n\nDynamoDB å½“å‰å¯å°†æœªä½¿ç”¨çš„è¯»å–å’Œå†™å…¥å®¹é‡ä¿ç•™æœ€å¤šäº”åˆ†é’Ÿ (300 ç§’)\nå½“è¯»å–æˆ–å†™å…¥çªå¢å¯¼è‡´å®¹é‡ä¸è¶³æ—¶ä½¿ç”¨ã€‚\n\n### DynamoDBé€‚åº”æ€§å®¹é‡\n\nDynamoDB é€‚åº”æ€§å®¹é‡ å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºç»§ç»­ä¸å—é™åœ°å¯¹çƒ­åˆ†åŒºè¿›è¡Œè¯»å†™æ“ä½œï¼Œå‰ææ˜¯æµé‡æœªè¶…å‡ºè¡¨çš„é…ç½®çš„æ€»å®¹é‡æˆ–åˆ†åŒºæœ€å¤§å®¹é‡ã€‚è‡ªé€‚åº”å®¹é‡çš„å·¥ä½œåŸç†æ˜¯ï¼Œè‡ªåŠ¨å¢åŠ åˆ†åŒºçš„ååé‡å®¹é‡æ¥æ¥æ”¶æ›´å¤šæµé‡\n\nç¤ºä¾‹è¡¨é…ç½®äº† 400 ä¸ªå†™å…¥å®¹é‡å•ä½ (WCU)ï¼Œè¿™äº›å®¹é‡å•ä½å‡åŒ€åˆ†å¸ƒåœ¨ 4 ä¸ªåˆ†åŒºä¸­ï¼Œæ¯ä¸ªåˆ†åŒºæ¯ç§’å¯ä»¥æ¥æ”¶æœ€å¤š 100 ä¸ª WCUã€‚åˆ†åŒº 1ã€2 å’Œ 3 æ¯ç§’æ¥æ”¶çš„å†™å…¥æµé‡ä¸º 50 ä¸ª WCUã€‚åˆ†åŒº 4 æ¯ç§’æ¥æ”¶ 150 ä¸ª WCUã€‚æ­¤çƒ­åˆ†åŒºå¯ä»¥åœ¨æ¥å—å†™å…¥æµé‡çš„åŒæ—¶ä»å…·æœ‰æœªåˆ©ç”¨çš„çªå¢å®¹é‡ï¼Œä½†æ˜¯ï¼Œå®ƒæœ€ç»ˆä¼šé™åˆ¶æ¯ç§’è¶…è¿‡ 100 ä¸ª WCU çš„æµé‡ã€‚\n\nDynamoDB é€‚åº”æ€§å®¹é‡é€šè¿‡å¢åŠ åˆ†åŒº 4 çš„å®¹é‡æ¥åšå‡ºå“åº”ï¼Œå› æ­¤åˆ†åŒº 4 å¯ä»¥æ¥æ”¶ 150 WCU/ç§’çš„æ›´é«˜å·¥ä½œè´Ÿè½½ï¼Œè€Œä¸ä¼šå—åˆ°é™åˆ¶ã€‚\n\n### è®¾è®¡åˆ†åŒºé”®ä»¥å‡åŒ€åˆ†å‘å·¥ä½œè´Ÿè½½\n\nè¡¨çš„ä¸»é”®çš„åˆ†åŒºé”®ç”¨æ¥ç¡®å®šæ•°æ®å­˜å‚¨åœ¨å“ªä¸ªç‰©ç†åˆ†åŒº\n\næ¯ä¸ªç‰©ç†åˆ†åŒºå‡åˆ†è¯»å–å’Œå†™å…¥å®¹é‡\n\nåˆç†è®¾è®¡åˆ†åŒºé”®ï¼Œé¿å…å‡ºç°â€œçƒ­ç‚¹â€ (è¯·æ±‚é¢‘ç‡éå¸¸é«˜çš„) åˆ†åŒºé”®å€¼è€Œå¯¼è‡´æ•´ä½“æ€§èƒ½é™ä½ã€‚\n\nå¥½çš„\nç”¨æˆ· ID\n\nå·®çš„\nçŠ¶æ€ä»£ç  é¡¹ç›®åˆ›å»ºæ—¥æœŸï¼ˆæ—¶é—´æ®µï¼‰\n\n### ä½¿ç”¨å†™å…¥åˆ†ç‰‡å‡åŒ€åˆ†å‘å·¥ä½œè´Ÿè½½\n\nè·¨åˆ†åŒºé”®ç©ºé—´å†™å…¥æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹å¼\n\næ¯”å¦‚ï¼šåˆ†åŒºé”®æ˜¯æ—¥æœŸï¼Œç°åœ¨æœ‰1wæ¡æ•°æ®ï¼Œæ—¥æœŸå‡åˆ†åœ¨100å¤©ï¼Œä¸å¥½çš„æ–¹å¼æ˜¯æŒ‰æ—¶é—´æ’å…¥ï¼Œè¿™æ ·ä¼šåœ¨çŸ­æ—¶é—´å†…äº§ç”Ÿ çƒ­é”®\n\n- ä½¿ç”¨éšæœºåç¼€åˆ†åŒº\n\n  å°†éšæœºæ•°å­—æ·»åŠ åˆ°åˆ†åŒºé”®å€¼çš„æœ«å°¾ã€‚ç„¶åè·¨æ›´å¤§å‹çš„ç©ºé—´éšæœºåŒ–å†™å…¥ã€‚\n\n  ä¾‹å¦‚ï¼Œå¯¹äºè¡¨ç¤ºå½“å¤©æ—¥æœŸçš„åˆ†åŒºé”®ï¼Œå¯èƒ½ä¼šé€‰æ‹©ä»‹äº 1 å’Œ 200 ä¹‹é—´çš„éšæœºæ•°å¹¶å°†å®ƒä½œä¸ºåç¼€è¿æ¥åˆ°è¯¥æ—¥æœŸã€‚è¿™å°†ç”Ÿæˆåˆ†åŒºé”®å€¼ (å¦‚ 2014-07-09.1ã€2014-07-09.2ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ° 2014-07-09.200)ã€‚ç”±äºéšæœºåŒ–åˆ†åŒºé”®ï¼Œå› æ­¤å°†è·¨å¤šä¸ªåˆ†åŒºå‡åŒ€åˆ†å¸ƒæ¯å¤©å¯¹è¡¨çš„å†™å…¥ã€‚è¿™å°†æé«˜å¹¶è¡Œåº¦å’Œæ€»ä½“ååé‡ã€‚\n\n  é—®é¢˜ï¼šè¯»å–å›°éš¾\n\n- ä½¿ç”¨è®¡ç®—å¾—å‡ºçš„åç¼€åˆ†åŒº\n\n  ä¸ä½¿ç”¨éšæœºæ•°åœ¨åˆ†åŒºé—´åˆ†å‘é¡¹ç›®ï¼Œè€Œæ˜¯ä½¿ç”¨å¯æ ¹æ®æŸ¥è¯¢å†…å®¹è®¡ç®—å‡ºçš„æ•°å­—ã€‚\n\n  ä¾‹å¦‚ï¼šè¡¨åœ¨åˆ†åŒºé”®ä¸­ä½¿ç”¨å½“å¤©æ—¥æœŸã€‚ç°åœ¨å‡è®¾æ¯ä¸ªé¡¹ç›®éƒ½æœ‰å¯è®¿é—®çš„ OrderId å±æ€§ï¼Œå¹¶ä¸”é™¤äº†æ—¥æœŸï¼Œè¿˜æœ€å¸¸éœ€è¦æŒ‰è®¢å• ID æŸ¥æ‰¾é¡¹ç›®ã€‚åœ¨åº”ç”¨ç¨‹åºå°†é¡¹ç›®å†™å…¥è¡¨ä¹‹å‰ï¼Œå®ƒå¯æ ¹æ®è®¢å• ID è®¡ç®—å¾—å‡ºä¸€ä¸ªå“ˆå¸Œåç¼€å¹¶å°†æ­¤åç¼€è¿½åŠ åˆ°åˆ†åŒºé”®æ—¥æœŸã€‚æ­¤è®¡ç®—å¯èƒ½ç”Ÿæˆä¸€ä¸ªä»‹äº 1 å’Œ 200 ä¹‹é—´ã€åˆ†å‘ç”šæ˜¯å‡åŒ€çš„æ•°å­— (ç±»ä¼¼äºéšæœºç­–ç•¥æ‰€ç”Ÿæˆçš„æ•°å­—)ã€‚\n\n### åœ¨æ•°æ®ä¸Šä¼ æœŸé—´æœ‰æ•ˆåˆ†å‘å†™å…¥æ´»åŠ¨\n\nä¾‹å¦‚ï¼Œå‡è®¾è¦å°†ç”¨æˆ·æ¶ˆæ¯ä¸Šä¼ è‡³ä½¿ç”¨å¤åˆä¸»é”®ï¼ˆå…¶ä¸­ UserID ä½œä¸ºä¸»é”®ï¼ŒMessageID ä½œä¸ºæ’åºé”®ï¼‰çš„ DynamoDB è¡¨ã€‚\n\nåœ¨åå°ï¼ŒDynamoDB å°†è·¨å¤šå°æœåŠ¡å™¨ä¸ºè¡¨æ•°æ®åˆ†åŒºã€‚è¦å……åˆ†åˆ©ç”¨ä¸ºè¡¨é…ç½®çš„æ‰€æœ‰ååå®¹é‡ï¼Œå¿…é¡»è·¨åˆ†åŒºé”®å€¼åˆ†å‘å·¥ä½œè´Ÿè½½ã€‚\n\nå¯åˆ†å‘ä¸Šä¼ å·¥ä½œï¼Œæ–¹å¼ä¸ºä½¿ç”¨æ’åºé”®é€šè¿‡æ¯ä¸ªåˆ†åŒºé”®å€¼åŠ è½½ä¸€ä¸ªé¡¹ç›®ï¼Œç„¶åé€šè¿‡æ¯ä¸ªåˆ†åŒºé”®å€¼åŠ è½½å¦ä¸€ä¸ªé¡¹ç›®ï¼Œä»¥æ­¤ç±»æ¨\n\næ­¤åºåˆ—ä¸­çš„æ¯æ¬¡ä¸Šä¼ éƒ½ä½¿ç”¨ä¸åŒçš„åˆ†åŒºé”®å€¼ï¼Œä»¥ä¾¿èƒ½å¤ŸåŒæ—¶ä½¿ç”¨æ›´å¤š DynamoDB æœåŠ¡å™¨ï¼Œä»è€Œæé«˜ååé‡æ€§èƒ½\n\n## ä½¿ç”¨æ’åºé”®æ•´ç†æ•°æ®çš„æœ€ä½³å®è·µ\n\nç²¾å¿ƒè®¾è®¡çš„æ’åºé”®å…·æœ‰ä¸¤ä¸ªä¸»è¦å¥½å¤„ï¼š\n\nå®ƒä»¬å°†ç›¸å…³ä¿¡æ¯èšé›†åœ¨ä¸€ä¸ªä½ç½®ï¼Œä»¥ä¾¿è¿›è¡Œé«˜æ•ˆæŸ¥è¯¢ã€‚åˆ©ç”¨ç²¾å¿ƒè®¾è®¡çš„æ’åºé”®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¸¦è¿ç®—ç¬¦ (å¦‚ starts-withã€betweenã€>ã€< ç­‰) çš„èŒƒå›´æŸ¥è¯¢æ£€ç´¢é€šå¸¸éœ€è¦çš„ç›¸å…³é¡¹ç›®ç»„ã€‚\nåˆ©ç”¨ç»„åˆæ’åºé”®ï¼Œå¯ä»¥åœ¨æ•°æ®ä¸­å®šä¹‰å¯åœ¨ä»»ä½•å±‚æ¬¡ç»“æ„çº§åˆ«æŸ¥è¯¢çš„å±‚æ¬¡ (ä¸€å¯¹å¤š) å…³ç³»ã€‚\nä¾‹å¦‚ï¼Œåœ¨åˆ—å‡ºåœ°ç†ä½ç½®çš„è¡¨ä¸­ï¼Œå¯æŒ‰å¦‚ä¸‹æ‰€ç¤ºæ„å»ºæ’åºé”®ï¼š\n[country]#[region]#[state]#[county]#[city]#[neighborhood]\n\n### ä½¿ç”¨æ’åºé”®è¿›è¡Œç‰ˆæœ¬æ§åˆ¶\n\nhttp://docs.amazonaws.cn/amazondynamodb/latest/developerguide/bp-sort-keys.html\n\nè¯·ä¸ºæ¯ä¸ªæ–°é¡¹ç›®åˆ›å»ºä¸¤ä¸ªå‰¯æœ¬ï¼šä¸€ä¸ªå‰¯æœ¬åœ¨æ’åºé”®çš„å¼€å¤´åº”å…·æœ‰ç‰ˆæœ¬å·å‰ç¼€é›¶ (å¦‚ v0_)ï¼Œä¸€ä¸ªåº”å…·æœ‰ç‰ˆæœ¬å·å‰ç¼€ 1 (å¦‚ v001_)ã€‚\næ¯æ¬¡æ›´æ–°é¡¹ç›®æ—¶ï¼Œè¯·åœ¨å·²æ›´æ–°ç‰ˆæœ¬çš„æ’åºé”®ä¸­ä½¿ç”¨ä¸‹ä¸€ä¸ªæ›´é«˜çš„ç‰ˆæœ¬å‰ç¼€ï¼Œå¹¶å°†æ›´æ–°åçš„å†…å®¹å¤åˆ¶åˆ°ç‰ˆæœ¬å‰ç¼€ä¸ºé›¶çš„é¡¹ç›®ä¸­ã€‚è¿™æ„å‘³ç€ï¼Œå¯ä½¿ç”¨å‰ç¼€é›¶è½»æ¾æ‰¾åˆ°æ‰€æœ‰é¡¹ç›®çš„æœ€æ–°ç‰ˆæœ¬ã€‚\n\n## åœ¨DynamoDBä¸­ä½¿ç”¨äºŒçº§ç´¢å¼•çš„æœ€ä½³å®è·µ\n\næœ¬åœ°äºŒçº§ç´¢å¼•å’Œè¡¨ä¸€èµ·åˆ›å»ºï¼Œä¸èƒ½ä¿®æ”¹ï¼Œ\nå…¨å±€äºŒçº§ç´¢å¼•å¯ä»¥åœ¨åæœŸæ›´æ–°åˆ›å»ºä¿®æ”¹ï¼Œ\nä¸Šé™éƒ½æ˜¯5ä¸ª\n\n### ç´¢å¼•ç±»å‹\n\n- å…¨å±€äºŒçº§ç´¢å¼•\n\n  - åˆ†åŒºé”®å’Œæ’åºé”®å¯ä¸åŸºè¡¨ä¸­çš„è¿™äº›é”®ä¸åŒçš„ç´¢å¼•ã€‚\n\n    å…¨å±€äºŒçº§ç´¢å¼•ä¹‹æ‰€ä»¥ç§°ä¸ºâ€œå…¨å±€â€ï¼Œè¿™æ˜¯å› ä¸ºè¯¥ç´¢å¼•ä¸Šçš„æŸ¥è¯¢å¯è·¨è¿‡æ‰€æœ‰åˆ†åŒºï¼Œæ¶µç›–åŸºè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚å…¨å±€äºŒçº§ç´¢å¼•æ²¡æœ‰å¤§å°é™åˆ¶ä¸”å…·æœ‰å…¶è‡ªå·±çš„è¯»å–å’Œå†™å…¥æ´»åŠ¨çš„é¢„é…ç½®ååé‡è®¾ç½®ï¼Œè¿™äº›è®¾ç½®ç‹¬ç«‹äºè¡¨çš„ç›¸åº”è®¾ç½®ã€‚\n\n- æœ¬åœ°äºŒçº§ç´¢å¼•\n\n  - åˆ†åŒºé”®ä¸åŸºè¡¨ç›¸åŒä½†æ’åºé”®ä¸åŒçš„ç´¢å¼•ã€‚\n\n    æœ¬åœ°äºŒçº§ç´¢å¼•ä¹‹æ‰€ä»¥ç§°ä¸ºâ€œæœ¬åœ°â€ï¼Œæ˜¯å› ä¸ºè¯¥ç´¢å¼•çš„æ¯ä¸ªåˆ†åŒºçš„èŒƒå›´éƒ½é™å®šä¸ºå…·æœ‰ç›¸åŒåˆ†åŒºé”®å€¼çš„åŸºè¡¨åˆ†åŒºã€‚å› æ­¤ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªåˆ†åŒºé”®å€¼ï¼Œç´¢å¼•é¡¹ç›®çš„å¤§å°æ€»å’Œä¸å¾—è¶…è¿‡ 10GBã€‚æ­¤å¤–ï¼Œæœ¬åœ°äºŒçº§ç´¢å¼•ä¸å…¶ç´¢å¼•çš„è¡¨å…±äº«ç”¨äºè¯»å–å’Œå†™å…¥æ´»åŠ¨çš„é¢„é…ç½®ååé‡è®¾ç½®ã€‚\n\n### DynamoDBä¸­äºŒçº§ç´¢å¼•çš„ä¸€èˆ¬å‡†åˆ™\n\n- é«˜æ•ˆä½¿ç”¨ç´¢å¼•\n\n  - æœ€å¤§ç¨‹åº¦çš„å‡å°‘ç´¢å¼•æ•°é‡\n\n    å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•ä¼šå¢åŠ å­˜å‚¨å’Œ I/O æˆæœ¬ï¼Œè€Œä¸”æ— æ³•æé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚\n\n  - å¯¹äºå†™å…¥æ´»åŠ¨å·¥ä½œé‡å¤§çš„è¡¨ï¼Œé¿å…ä½¿ç”¨ç´¢å¼•\n\n    åœ¨æ•°æ®æ•è·åº”ç”¨ç¨‹åºä¸­ï¼Œè¦åœ¨å…·æœ‰æé«˜å†™å…¥è´Ÿè½½çš„è¡¨ä¸Šç»´æŠ¤ç´¢å¼•æ‰€éœ€çš„ I/O æ“ä½œï¼Œæˆæœ¬éå¸¸é«˜ã€‚å¦‚æœæ‚¨éœ€è¦ä¸ºæ­¤ç±»è¡¨ä¸­çš„æ•°æ®ç¼–åˆ¶ç´¢å¼•ï¼Œå¯èƒ½æ›´æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å°†æ•°æ®å¤åˆ¶åˆ°å…·æœ‰å¿…è¦ç´¢å¼•çš„å¦å¤–ä¸€ä¸ªè¡¨ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒæŸ¥è¯¢ã€‚\n\n- æ…é‡é€‰æ‹©æŠ•å½±\n\n  ç›¸è¾ƒäºæŸ¥è¯¢æ•´ä¸ªè¡¨ï¼Œç´¢å¼•è¶Šå°ï¼Œæ€§èƒ½ä¼˜åŠ¿è¶Šæ˜æ˜¾ã€‚å¦‚æœæ‚¨çš„æŸ¥è¯¢é€šå¸¸åªè¿”å›å¾ˆå°‘ä¸€éƒ¨åˆ†å±æ€§ï¼Œå¹¶ä¸”è¿™äº›å±æ€§çš„æ€»å’Œè¿œè¿œå°‘äºæ•´ä¸ªé¡¹ç›®çš„å¤§å°ï¼Œé‚£ä¹ˆæ‚¨åº”å½“åªæŠ•å½±ç»å¸¸è¯·æ±‚çš„å±æ€§ã€‚\n\n  - è¯·å°½é‡å‡å°‘æŠ•å½±å±æ€§çš„æ•°é‡ï¼Œä»¥æœ€å¤§ç¨‹åº¦å‡å°‘å†™å…¥ç´¢å¼•çš„é¡¹ç›®å¤§å°\n\n    ä½†æ˜¯ï¼Œè¿™ä»…åœ¨æŠ•å½±å±æ€§çš„å¤§å°å¤§äºå•ä¸ªå†™å…¥å®¹é‡å•ä½ (1 KB) æ—¶é€‚ç”¨ã€‚\n\n    ä¾‹å¦‚ï¼Œå¦‚æœç´¢å¼•æ¡ç›®çš„å¤§å°ä»…ä¸º 200 å­—èŠ‚ï¼Œåˆ™ DynamoDB ä¼šå°†å…¶å‘ä¸Šå–æ•´ä¸º 1 KBã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç´¢å¼•é¡¹ç›®å¾ˆå°çš„è¯ï¼Œæ‚¨å¯ä»¥æŠ•å½±æ›´å¤šå±æ€§ï¼Œè€Œä¸ä¼šé¢å¤–å¢åŠ æˆæœ¬ã€‚\n\n  - é¿å…æŠ•å½±æ‚¨çŸ¥é“åœ¨æŸ¥è¯¢ä¸­æå°‘éœ€è¦çš„å±æ€§ã€‚\n\n    æ¯æ¬¡æ›´æ–°åœ¨ç´¢å¼•ä¸­æŠ•å½±çš„å±æ€§æ—¶ï¼Œä¹Ÿä¼šå› æ›´æ–°ç´¢å¼•è€Œé¢å¤–äº§ç”Ÿæˆæœ¬\n\n  - åªæœ‰å½“æ‚¨éœ€è¦è®©æŸ¥è¯¢è¿”å›æŒ‰ä¸åŒçš„æ’åºé”®æ’åºçš„æ•´ä¸ªè¡¨é¡¹ç›®æ—¶ï¼Œæ‰åº”æŒ‡å®š ALLã€‚\n\n- ä¼˜åŒ–é¢‘ç¹æŸ¥è¯¢ä»¥é¿å…æŠ“å–\n\n  - é¢‘ç¹ä½¿ç”¨çš„å±æ€§éœ€è¦æŠ•å½±ï¼Œå·²é¿å…é‡å¤æŠ“å–\n\n    ä¾‹å¦‚ï¼Œå¦‚æœç´¢å¼•åªæŠ•å½±äº† å±æ€§A Bï¼Œ\n    ä½†æ˜¯æŸ¥è¯¢ç»“æœä¼šç»å¸¸ä½¿ç”¨å±æ€§C\n\n    åªèƒ½å†æ¬¡æŸ¥è¯¢è¡¨æ¥æŠ“å–å±æ€§C\n\n- åˆ›å»ºæœ¬åœ°äºŒçº§ç´¢å¼•æ—¶æ³¨æ„é¡¹ç›®é›†åˆå¤§å°é™åˆ¶\n\n  å¯¹äºä»»ä½•ä¸€ä¸ªåˆ†åŒºé”®å€¼ï¼Œç´¢å¼•é¡¹ç›®çš„å¤§å°æ€»å’Œä¸å¾—è¶…è¿‡ 10GB\n\n  ä¾‹å¦‚è¡¨æœ‰ä¸€ä¸ªç‰¹å®šçš„åˆ†åŒºé”® Aï¼Œè¯¥è¡¨æœ‰3ä¸ªæœ¬åœ°ç´¢å¼•ã€‚å¢åŠ ä¸€ä¸ªæ–°é¡¹ç›®æ—¶ï¼ŒäºŒçº§ç´¢å¼•ä¹Ÿä¼šåŒæ­¥åˆ›å»ºï¼Œä¸‰ä¸ªäºŒçº§ç´¢å¼•å¯èƒ½ä¼šåˆ›å»º3ä¸ªæ•°æ®å¤‡ä»½ã€‚\n\n  æœ€ä¸¥é‡çš„æƒ…å†µæ˜¯ï¼ŒåŒä¸€ä¸ªæ•°æ®å¯èƒ½ä¼šå ç”¨4å€æ•°æ®çš„ç©ºé—´ã€‚\n\n  å¯èƒ½ï¼Œåœ¨åˆ†åŒºæ•°æ®åœ¨2.5Gå¤§å°çš„æ—¶å€™ï¼Œç´¢å¼•å°±å·²ç»åˆ°è¾¾äº†10Gã€‚\n\n### åˆ©ç”¨ç¨€ç–ç´¢å¼•\n\n- å¯¹äºè¡¨ä¸­çš„ä»»ä½•é¡¹ç›®ï¼ŒDynamoDB ä»…å½“é¡¹ç›®ä¸­å­˜åœ¨ç´¢å¼•æ’åºé”®å€¼æ—¶æ‰ä¼šå†™å…¥ç›¸åº”çš„ç´¢å¼•æ¡ç›®ã€‚å¦‚æœæ’åºé”®å¹¶æœªå‡ºç°åœ¨æ¯ä¸ªè¡¨é¡¹ç›®ä¸­ï¼Œåˆ™è¿™ç§ç´¢å¼•ç§°ä¸ºç¨€ç– ç´¢å¼•ã€‚\n\n  ç¨€ç–ç´¢å¼•å¯¹äºæŸ¥è¯¢è¡¨çš„å°å‹å­éƒ¨åˆ†éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªå­˜å‚¨æ‚¨çš„æ‰€æœ‰å®¢æˆ·è®¢å•çš„è¡¨ï¼Œè¯¥è¡¨å…·æœ‰ä»¥ä¸‹é”®å±æ€§ï¼š\n\n  åˆ†åŒºé”®ï¼šCustomerId\n  æ’åºé”®: OrderId\n\n  è¦è·Ÿè¸ªæœªç»“è®¢å•ï¼Œå¯ä»¥åœ¨å°šæœªå‘è¿çš„è®¢å•é¡¹ç›®ä¸­æ’å…¥ä¸€ä¸ªåä¸º isOpen çš„å¸ƒå°”å€¼ã€‚ç„¶åï¼Œåœ¨è¯¥è®¢å•å‘è¿åï¼Œæ‚¨å¯ä»¥åˆ é™¤è¯¥å±æ€§ã€‚ç„¶åï¼Œå¦‚æœå¯¹ CustomerId (åˆ†åŒºé”®) å’Œ isOpen (æ’åºé”®) åˆ›å»ºç´¢å¼•ï¼Œåˆ™åªæœ‰å®šä¹‰ä¸º isOpen çš„è®¢å•æ‰æ˜¾ç¤ºåœ¨å…¶ä¸­ã€‚å¦‚æœæœ‰æ•°ä»¥åƒè®¡çš„è®¢å•ï¼Œå…¶ä¸­åªæœ‰å°‘é‡è®¢å•å¤„äºæœªç»“çŠ¶æ€ï¼Œåˆ™æŸ¥è¯¢æœªç»“è®¢å•çš„ç´¢å¼•è¦æ¯”æ‰«ææ•´ä¸ªè¡¨æ›´å¿«é€Ÿä¸”æ›´ä¾¿å®œã€‚\n\n  å¸ƒå°”å€¼ä¸èƒ½åšç´¢å¼•\n\n  å¯ä»¥ä½¿ç”¨å…·æœ‰åœ¨ç´¢å¼•ä¸­ç”Ÿæˆæœ‰ç”¨çš„æ’åºé¡ºåºçš„å€¼çš„å±æ€§ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¸ƒå°”ç±»å‹çš„å±æ€§ï¼Œå¦‚ isOpenã€‚\n  ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ OrderOpenDate å±æ€§è®¾ç½®ä¸ºä¸‹æ¯ä¸ªè®¢å•çš„æ—¥æœŸï¼Œç„¶ååœ¨è®¢å•å®Œæˆåå°†å…¶åˆ é™¤ã€‚è¿™æ ·ï¼Œåœ¨æŸ¥è¯¢ç¨€ç–ç´¢å¼•æ—¶ï¼Œä¼šè¿”å›æŒ‰ä¸‹æ¯ä¸ªè®¢å•çš„æ—¥æœŸæ’åºçš„é¡¹ç›®ã€‚\n\n- å…¨å±€äºŒçº§ç´¢å¼•åº”ç”¨ç¨€ç–ç´¢å¼•åï¼Œå¯ä»¥ä½¿ç”¨æ¯”åŸºè¡¨ä½çš„ååé…ç½®å®ç°é«˜æ€§èƒ½æŸ¥è¯¢\n\n### ä½¿ç”¨å…¨å±€äºŒçº§ç´¢å¼•è¿›è¡Œå…·ä½“åŒ–èšåˆæŸ¥è¯¢\n\nhttps://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/bp-gsi-aggregation.html\n\n### é‡è½½å…¨å±€äºŒçº§ç´¢å¼•\n\nhttps://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/bp-gsi-overloading.html\n\n### å¯¹é€‰æ‹©æ€§è¡¨æŸ¥è¯¢ä½¿ç”¨å…¨å±€äºŒçº§ç´¢å¼•å†™å…¥åˆ†ç‰‡\n\nä¾‹å¦‚ï¼š æœ‰éå†è¡¨çš„éœ€æ±‚\n\næ­¤æ—¶å¦‚æœåˆ†åŒºé”®å¹³å‡åˆ†å¸ƒï¼Œåªèƒ½ä½¿ç”¨scan æ“ä½œï¼Œæ“ä½œæ˜‚è´µ\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„åˆ†åŒºé”®ï¼Œä½†æ˜¯å®¹æ˜“äº§ç”Ÿçƒ­é”®\n\nå¯ä»¥åˆ©ç”¨å…¨å±€ç´¢å¼•ï¼Œè¦åœ¨æ•´ä¸ªé”®ç©ºé—´ä¸­å¯ç”¨é€‰æ‹©æ€§æŸ¥è¯¢ï¼Œå¯ä½¿ç”¨å†™å…¥åˆ†ç‰‡ï¼Œæ–¹å¼æ˜¯å‘ç”¨äºå…¨å±€äºŒçº§ç´¢å¼•åˆ†åŒºé”®çš„æ¯ä¸ªé¡¹ç›®æ·»åŠ ä¸€ä¸ªåŒ…å« (0-N) å€¼çš„å±æ€§ã€‚\n\né€šè¿‡ä½¿ç”¨æ­¤æ¶æ„è®¾è®¡ï¼Œäº‹ä»¶é¡¹ç›®å°†åˆ†å¸ƒåœ¨ GSI ä¸Šçš„ 0-N åˆ†åŒºä¸­ï¼Œä»è€Œå…è®¸åœ¨å¤åˆé”®ä¸Šä½¿ç”¨æ’åºæ¡ä»¶æ¥æ‰§è¡Œåˆ†æ•£è¯»å–ï¼Œä»¥ä¾¿æ£€ç´¢æŒ‡å®šæ—¶é—´æ®µå†…å…·æœ‰ç»™å®šçŠ¶æ€çš„æ‰€æœ‰é¡¹ç›®ã€‚\n\næ­¤æ¶æ„æ¨¡å¼ä»¥æœ€ä½çš„æˆæœ¬äº¤ä»˜ä¸€ä¸ªé«˜åº¦é€‰æ‹©æ€§çš„ç»“æœé›†ï¼Œè€Œæ— éœ€è¡¨æ‰«æã€‚\n\n### ä½¿ç”¨å…¨å±€äºŒçº§ç´¢å¼•åˆ›å»ºä¸€è‡´æ€§å‰¯æœ¬\n\næœ€ç»ˆä¸€è‡´\n\n- å…¨å±€äºŒçº§ç´¢å¼•å‰¯æœ¬æ”¯æŒåŠŸèƒ½\n  - ä¸ºä¸åŒçš„è¯»å–å™¨è®¾ç½®ä¸åŒçš„é¢„ç½®è¯»å–å®¹é‡\n  - å®Œå…¨æ¶ˆé™¤å¯¹è¡¨çš„è¯»å–\n\n## å­˜å‚¨å¤§å‹é¡¹ç›®å’Œå±æ€§çš„æœ€ä½³å®è·µ\n\nDynamoDB å½“å‰é™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç›®çš„å¤§å°\n\nDynamoDB ä¸­çš„é¡¹ç›®å¤§å°ä¸Šé™ä¸º 400 KBï¼ŒåŒ…æ‹¬å±æ€§åç§°äºŒè¿›åˆ¶é•¿åº¦ï¼ˆUTF-8 é•¿åº¦ï¼‰å’Œå±æ€§å€¼é•¿åº¦ï¼ˆåŒä¸ºäºŒè¿›åˆ¶é•¿åº¦ï¼‰ã€‚å±æ€§åç§°ä¹ŸåŒ…å«åœ¨æ­¤å¤§å°é™åˆ¶ä¹‹å†…ã€‚\n\nå…·æœ‰æœ¬åœ°äºŒçº§ç´¢å¼•çš„è¡¨çš„é¡¹ç›®å¤§å°\n\nå¯¹äºè¡¨ä¸Šçš„æ¯ä¸ªlocal secondary indexï¼Œä»¥ä¸‹å¯¹è±¡çš„æ€»å¤§å°æœ‰ 400 KB çš„é™åˆ¶ï¼š\n\nè¡¨ä¸­é¡¹ç›®æ•°æ®çš„å¤§å°ã€‚\nä¸è¯¥é¡¹ç›®å¯¹åº”çš„local secondary indexæ¡ç›®çš„å¤§å°ï¼ŒåŒ…æ‹¬å…¶é”®å€¼å’ŒæŠ•å½±å±æ€§ã€‚\n\n### å‹ç¼©å¤§å‹å±æ€§å€¼\n\nå‹ç¼©å¤§å‹å±æ€§å€¼å¯ä»¥è®©å±æ€§å€¼ç¬¦åˆ DynamoDB ä¸­çš„é¡¹ç›®é™åˆ¶å¹¶é™ä½å­˜å‚¨æˆæœ¬ã€‚å‹ç¼©ç®—æ³• (å¦‚ GZIP æˆ– LZO) å°†ç”Ÿæˆä¹‹åå¯å­˜å‚¨åœ¨ Binary å±æ€§ç±»å‹ä¸­çš„äºŒè¿›åˆ¶è¾“å‡ºã€‚\n\næ¯”å¦‚è¡¨ä¸­ä¸€ä¸ªå±æ€§åŒ…å«é•¿æ–‡æœ¬ï¼Œè¿™äº›å†…å®¹å°±é€‚åˆå‹ç¼©å¤„ç†\n\n### åœ¨S3ä¸­å­˜å‚¨å¤§å‹å±æ€§å€¼\n\nå¯ä»¥å°†å®ƒä»¬ä½œä¸ºå¯¹è±¡å­˜å‚¨åœ¨ Amazon S3 ä¸­ï¼Œç„¶åå°†å¯¹è±¡æ ‡è¯†ç¬¦å­˜å‚¨åœ¨ DynamoDB é¡¹ç›®ä¸­ã€‚\n\nå®æ–½æ­¤ç­–ç•¥æ—¶ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š\n\nDynamoDB ä¸æ”¯æŒè·¨ Amazon S3 å’Œ DynamoDB çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»å¤„ç†ä»»ä½•æ•…éšœï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬æ¸…ç†å­¤ç«‹çš„ Amazon S3 å¯¹è±¡ã€‚\nAmazon S3 é™åˆ¶å¯¹è±¡æ ‡è¯†ç¬¦çš„é•¿åº¦ã€‚å› æ­¤å¿…é¡»é€šè¿‡ä¸ä¼šç”Ÿæˆè¿‡é•¿å¯¹è±¡æ ‡è¯†ç¬¦æˆ–è¿åå…¶ä»– Amazon S3 çº¦æŸçš„æ–¹å¼ç»„ç»‡æ•°æ®ã€‚\n\n## åœ¨DynamoDBä¸­å¤„ç†æ—¶é—´åºåˆ—æ•°æ®çš„æœ€ä½³å®è·µ\n\n### æ—¶é—´åºåˆ—æ•°æ®çš„è®¾è®¡æ¨¡å¼\n\nè€ƒè™‘æ‚¨æƒ³è·Ÿè¸ªå¤§é‡æ´»åŠ¨çš„å…¸å‹æ—¶é—´åºåˆ—åœºæ™¯ã€‚å†™å…¥è®¿é—®æ¨¡å¼å³è¦è®°å½•çš„æ‰€æœ‰äº‹ä»¶éƒ½å…·æœ‰ä»Šæ—¥æ—¥æœŸã€‚è¯»å–è®¿é—®æ¨¡å¼è¯»å–ä»Šæ—¥äº‹ä»¶çš„é¢‘ç‡æœ€é«˜ï¼Œè¯»å–æ˜¨æ—¥äº‹ä»¶çš„é¢‘ç‡å°å¾ˆå¤šï¼Œè€Œè¯»å–æ›´æ—©äº‹ä»¶çš„é¢‘ç‡æ˜¯æœ€ä½çš„ã€‚\n\nä¸€ç§å¤„ç†æ–¹å¼æ˜¯å°†å½“å‰æ—¥æœŸå’Œæ—¶é—´æ„å»ºæˆä¸»é”®ã€‚\n\n- ä»¥æ—¥æœŸä¸ºä¸»é”®\n\n- ä»¥æ—¥æœŸæˆ–æ—¶é—´é—´éš”åˆ›å»ºä¸åŒçš„è¡¨\n\n  æ¯ä¸ªæ—¶é—´æ®µåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œå¹¶ä¸ºè¡¨é¢„ç½®æ‰€éœ€çš„è¯»å–å’Œå†™å…¥å®¹é‡ä»¥åŠæ‰€éœ€çš„ç´¢å¼•ã€‚\n  åœ¨æ¯ä¸ªæ—¶é—´æ®µç»“æŸä¹‹å‰ï¼Œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ®µé¢„æ„å»ºè¡¨ã€‚åœ¨å½“å‰æ—¶é—´æ®µç»“æŸæ—¶ï¼Œäº‹ä»¶æµé‡å°†å®šå‘è‡³æ–°è¡¨ã€‚å¯ä»¥ä¸ºè¿™äº›è¡¨åˆ†é…åç§°ä»¥æŒ‡æ˜è¿™äº›è¡¨æ‰€è®°å½•çš„æ—¶é—´æ®µã€‚\n\n  åªè¦è¡¨ä¸å†è¢«å†™å…¥ï¼Œå°±å°†å…¶é¢„ç½®çš„å†™å…¥å®¹é‡é™è‡³è¾ƒä½çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œ1 WCUï¼‰å¹¶é¢„ç½®é€‚å½“çš„è¯»å–å®¹é‡ã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œé™ä½æ—©æœŸè¡¨çš„é¢„ç½®è¯»å–å®¹é‡ã€‚å¯ä»¥é€‰æ‹©å­˜æ¡£æˆ–åˆ é™¤æå°‘æˆ–æ ¹æœ¬ä¸éœ€è¦å…¶å†…å®¹çš„è¡¨ã€‚\n\n  è¿™ç§åšæ³•çš„ç›®çš„æ˜¯å°†æ‰€éœ€çš„èµ„æºåˆ†é…ç»™æ‰¿å—æœ€é«˜æµé‡çš„å½“å‰æ—¶é—´æ®µï¼ŒåŒæ—¶é™ä½ä½¿ç”¨ä¸æ´»è·ƒçš„æ—§è¡¨çš„é¢„ç½®èµ„æºï¼Œä»è€ŒèŠ‚çœæˆæœ¬ã€‚æ ¹æ®æ‚¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ‚¨å¯èƒ½éœ€è¦è€ƒè™‘å†™å…¥åˆ†ç‰‡ï¼Œä»¥å°†æµé‡å‡åŒ€åœ°åˆ†é…åˆ°é€»è¾‘åˆ†åŒºé”®ã€‚\n\n## ç®¡ç†å¤šå¯¹å¤šå…³ç³»çš„æœ€ä½³å®è·µ\n\n### ç›¸é‚»åˆ—è¡¨è®¾è®¡æ¨¡å¼\n\nç›¸é‚»åˆ—è¡¨æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæœ‰åŠ©äºåœ¨ Amazon DynamoDB ä¸­ä¸ºå¤šå¯¹å¤šå…³ç³»å»ºæ¨¡ã€‚ä¸€èˆ¬åœ°è¯´ï¼Œå®ƒä»¬æä¾›åœ¨ DynamoDB ä¸­è¡¨ç¤ºå›¾è¡¨æ•°æ® (èŠ‚ç‚¹å’Œè¾¹ç¼˜) çš„æ–¹å¼ã€‚\n\nå½“åº”ç”¨ç¨‹åºçš„ä¸åŒå®ä½“ä¹‹é—´å…·æœ‰å¤šå¯¹å¤šå…³ç³»æ—¶ï¼Œæ­¤å…³ç³»å¯å»ºæ¨¡ä¸ºç›¸é‚»åˆ—è¡¨ã€‚\nåœ¨æ­¤æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰é¡¶çº§å®ä½“ (ä¸å›¾è¡¨æ¨¡å‹ä¸­çš„èŠ‚ç‚¹åŒä¹‰) éƒ½æ˜¯ä½¿ç”¨åˆ†åŒºé”®è¡¨ç¤ºçš„ã€‚é€šè¿‡å°†æ’åºé”®çš„å€¼è®¾ç½®ä¸ºç›®æ ‡å®ä½“ ID (ç›®æ ‡èŠ‚ç‚¹)ï¼Œä¸å…¶ä»–å®ä½“ (å›¾è¡¨ä¸­çš„è¾¹ç¼˜) çš„ä»»ä½•å…³ç³»éƒ½å°†è¡¨ç¤ºä¸ºåˆ†åŒºå†…çš„é¡¹ç›®ã€‚\n\nä¾‹å¦‚å­˜å‚¨å…³æ³¨ä¿¡æ¯ï¼š\n\nç”¨æˆ·A ID_A ä¸ºåˆ†åŒºé”®ï¼Œç”¨æˆ· A çš„å…³æ³¨è€…ID ä¸ºæ’åºé”®\næŸ¥è¯¢ç”¨æˆ·A çš„æ‰€å…³æ³¨çš„æ‰€æœ‰äººå¯æŒ‰ID_A ç­›é€‰\næŸ¥è¯¢ç”¨æˆ·A è¢«è°å…³æ³¨å¯ä»¥åŠ ä¸€ä¸ªå…¨å±€äºŒçº§ç´¢å¼• ç´¢å¼•åˆ†åŒºé”®ä¸ºè¡¨æ’åºé”®ï¼Œæ’åºé”®ä¸ºè¡¨åˆ†åŒºé”®\n\næ­¤æ¨¡å¼çš„ä¼˜åŠ¿åŒ…æ‹¬æ•°æ®é‡å¤ç‡æœ€ä½å’Œç²¾ç®€çš„æŸ¥è¯¢æ¨¡å¼ ï¼Œä»¥ä¾¿æŸ¥æ‰¾ä¸ç›®æ ‡å®ä½“ (è®©è¾¹ç¼˜ä½œä¸ºç›®æ ‡èŠ‚ç‚¹) ç›¸å…³çš„æ‰€æœ‰å®ä½“ (èŠ‚ç‚¹)ã€‚\n\n- å…³æ³¨å…³ç³»\n- å¥½å‹å…³ç³»\n\n### å…·ä½“åŒ–å›¾æ ‡æ¨¡å¼\n\n## å®ç°æ··åˆæ•°æ®åº“ç³»ç»Ÿçš„æœ€ä½³å®è·µ\n\n### ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½è¿ç§»åˆ°DynamoDB\n\n### å¦‚ä½•å®ç°æ··åˆç³»ç»Ÿ\n\nå¯åˆ©ç”¨ DynamoDB æµå’Œ AWS Lambda ä¸ä¸€ä¸ªæˆ–å¤šä¸ªç°æœ‰å…³ç³»æ•°æ®åº“ç³»ç»Ÿæ— ç¼é›†æˆ\n\né›†æˆ DynamoDB æµå’Œ AWS Lambda çš„ç³»ç»Ÿå¯æä¾›è‹¥å¹²å¥½å¤„ï¼š\n\nå®ƒå¯ä½œä¸ºå…·ä½“åŒ–è§†å›¾çš„æŒä¹…åŒ–ç¼“å­˜è¿è¡Œã€‚\nå®ƒå¯è®¾ç½®ä¸ºåœ¨æŸ¥è¯¢æ•°æ®æ—¶ä»¥åŠåœ¨ SQL ç³»ç»Ÿä¸­ä¿®æ”¹æ•°æ®æ—¶é€æ¸å¡«å……æ‰€æŸ¥è¯¢å’Œæ‰€ä¿®æ”¹æ•°æ®ã€‚è¿™æ„å‘³ç€æ•´ä¸ªè§†å›¾æ— éœ€é¢„å…ˆå¡«å……ï¼Œè¿™åè¿‡æ¥æ„å‘³ç€é«˜æ•ˆåˆ©ç”¨é¢„ç½®çš„ååå®¹é‡çš„å¯èƒ½æ€§æ›´é«˜ã€‚\nå®ƒçš„ç®¡ç†æˆæœ¬ä½å¹¶ä¸”é«˜åº¦å¯ç”¨å’Œå¯é ã€‚\n\n- å¢é‡å¡«å…… DynamoDB ç¼“å­˜\n\n  éœ€è¦æŸä¸ªé¡¹ç›®æ—¶ï¼Œé¦–å…ˆåœ¨ DynamoDB ä¸­æŸ¥æ‰¾å®ƒã€‚å¦‚æœå®ƒä¸åœ¨æ­¤å¤„ï¼Œåˆ™åœ¨ SQL ç³»ç»Ÿä¸­æŸ¥æ‰¾å®ƒï¼Œç„¶åå°†å®ƒåŠ è½½åˆ° DynamoDB ä¸­\n\n- é€šè¿‡ DynamoDB ç¼“å­˜å†™å…¥\n\n  å½“å®¢æˆ·æ›´æ”¹ DynamoDB ä¸­çš„å€¼æ—¶ï¼Œå°†è§¦å‘ Lambda å‡½æ•°ä»¥å°†æ–°æ•°æ®å†™å› SQL ç³»ç»Ÿ\n\n- é€šè¿‡ SQL ç³»ç»Ÿæ›´æ–° DynamoDB\n\n  å½“å†…éƒ¨æµç¨‹ï¼ˆå¦‚åº“å­˜ç®¡ç†æˆ–å®šä»·ï¼‰æ›´æ”¹ SQL ç³»ç»Ÿä¸­çš„å€¼æ—¶ï¼Œå°†è§¦å‘å­˜å‚¨è¿‡ç¨‹ä»¥å°†æ›´æ”¹ä¼ æ’­è‡³ DynamoDB å…·ä½“åŒ–è§†å›¾ã€‚\n\n## åœ¨DynamoDBä¸ºå…³ç³»æ•°æ®å»ºæ¨¡çš„æœ€ä½³å®è·µ\n\n### ä¸ºå…³ç³»å‹æ•°æ®å»ºæ¨¡çš„åˆå§‹æ­¥éª¤\n\n- å¯¹äºæ–°åº”ç”¨ç¨‹åºï¼ŒæŸ¥çœ‹æœ‰å…³æ´»åŠ¨å’Œç›®æ ‡çš„ç”¨æˆ·æ¡ˆä¾‹ã€‚è®°å½•ç¡®å®šçš„å„ç§ä½¿ç”¨æ¡ˆä¾‹ï¼Œç„¶ååˆ†æè¿™äº›æ¡ˆä¾‹éœ€è¦çš„è®¿é—®æ¨¡å¼ã€‚\n- å¯¹äºç°æœ‰åº”ç”¨ç¨‹åºï¼Œåˆ†ææŸ¥è¯¢æ—¥å¿—ä»¥äº†è§£äººä»¬ç›®å‰ä½¿ç”¨è¯¥ç³»ç»Ÿçš„æ–¹å¼ä»¥åŠå¯†é’¥è®¿é—®æ¨¡å¼æœ‰å“ªäº›ã€‚\n- DynamoDB æ¶æ„è®¾è®¡çš„å¸¸è§æ–¹æ³•æ˜¯ç¡®å®šåº”ç”¨ç¨‹åºå±‚å®ä½“å¹¶ä½¿ç”¨åè§„èŒƒåŒ–å’Œå¤åˆé”®èšåˆæ¥é™ä½æŸ¥è¯¢å¤æ‚æ€§ã€‚\n\n### ä¸ºå…³ç³»æ•°æ®å»ºæ¨¡çš„ç¤ºä¾‹\n\n- https://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/bp-relational-modeling.html\n\n### å…³ç³»å‹æ•°æ®åº“ç¼ºé™·\n\n- å®ƒè§„èŒƒåŒ–æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨éœ€è¦å¤šä¸ªæŸ¥è¯¢ä»¥å†™å…¥ç£ç›˜çš„å¤šä¸ªè¡¨ä¸­\n- å®ƒé€šå¸¸ä¼šäº§ç”Ÿä¸ ACID å…¼å®¹çš„äº‹åŠ¡ç³»ç»Ÿçš„æ€§èƒ½æˆæœ¬\n- å®ƒä½¿ç”¨æˆæœ¬é«˜æ˜‚çš„è”æ¥æ¥é‡ç»„æŸ¥è¯¢ç»“æœçš„æ‰€éœ€è§†å›¾\n\n### DynamoDBçš„ä¼˜ç‚¹\n\n- æ¶æ„çµæ´»æ€§è®© DynamoDB å­˜å‚¨å•ä¸ªé¡¹ç›®å†…çš„å¤æ‚å±‚æ¬¡æ•°æ®\n- å¤åˆé”®è®¾è®¡è®©å…¶å°†ç›¸å…³é¡¹ç›®é è¿‘å­˜å‚¨åœ¨ç›¸åŒè¡¨ä¸­\n\n## é’ˆå¯¹æŸ¥è¯¢å’Œæ‰«ææ•°æ®çš„æœ€ä½³å®è·µ\n\n### æ‰«æçš„æ€§èƒ½æ³¨æ„äº‹é¡¹\n\n- Scan æ“ä½œçš„æ•ˆç‡ä½äºå…¶ä»–æ“ä½œã€‚Scan æ“ä½œå§‹ç»ˆæ‰«ææ•´ä¸ªè¡¨æˆ–äºŒçº§ç´¢å¼•\n- åº”é¿å…å¯¹å¤§å‹è¡¨æˆ–ç´¢å¼•ä½¿ç”¨å¸¦æœ‰ä¼šåˆ é™¤å¾ˆå¤šç»“æœçš„ç­›é€‰æ¡ä»¶çš„ Scan æ“ä½œ\n\n### åˆ©ç”¨å¹¶è¡Œæ‰«é¢\n\n- å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œå°±å¯ä»¥é€‰æ‹©å¹¶è¡Œæ‰«æ\n  - è¡¨çš„å¤§å°ä¸º 20 GB æˆ–æ›´å¤§ã€‚\n  - è¡¨çš„é¢„ç½®è¯»å–ååé‡å°šæœªå®Œå…¨åˆ©ç”¨ã€‚\n  - æŒ‰é¡ºåºæ‰§è¡Œçš„ Scan æ“ä½œé€Ÿåº¦è¿‡æ…¢ã€‚\n\n### é¿å…è¯»å–æ´»åŠ¨é™¡å¢\n\n- è®¾ç½®è¯»å–å’Œå†™å…¥å®¹é‡å•ä½è¦æ±‚\n\n  è¯»å–å®¹é‡å•ä½é€šè¿‡æ¯ç§’å¼ºä¸€è‡´æ€§ 4 KB æ•°æ®è¯»å–è¯·æ±‚çš„æ•°é‡è¡¨ç¤ºã€‚ä¸€ä¸ªæœ€ç»ˆä¸€è‡´æ€§è¯»å–å®¹é‡å•ä½æ˜¯æ¯ç§’ 2 ä¸ª 4 KB è¯»å–è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Scan` æ“ä½œæ‰§è¡Œæœ€ç»ˆä¸€è‡´æ€§è¯»å–ï¼Œå¯è¿”å›æœ€å¤š 1 MBï¼ˆä¸€é¡µï¼‰æ•°æ®ã€‚å› æ­¤ï¼Œå•ä¸ª `Scan` è¯·æ±‚å¯å ç”¨ï¼ˆ1 MB é¡µé¢å¤§å°/4 KB é¡¹ç›®å¤§å°ï¼‰/2ï¼ˆæœ€ç»ˆä¸€è‡´æ€§è¯»å–ï¼‰= 128 ä¸ªè¯»å–æ“ä½œã€‚å¦‚æœæ”¹ä¸ºè¯·æ±‚å¼ºä¸€è‡´æ€§è¯»å–ï¼Œåˆ™ `Scan` æ“ä½œå ç”¨çš„ååé‡æ˜¯é¢„ç½®ååé‡çš„ä¸¤å€ â€” å¦‚ 256 æ¬¡è¯»å–æ“ä½œã€‚\n\n  é—®é¢˜ä¸ä»…ä»…åœ¨äº `Scan` ä½¿ç”¨çš„å®¹é‡å•ä½é™¡å¢ã€‚ç”±äºæ‰«æè¯·æ±‚çš„è¯»å–é¡¹ç›®åœ¨åˆ†åŒºä¸­å½¼æ­¤ç›¸é‚»ï¼Œå› æ­¤æ‰«æè¿˜å¯èƒ½ä¼šå ç”¨åŒä¸€åˆ†åŒºä¸­çš„æ‰€æœ‰å®¹é‡å•ä½ã€‚è¿™æ„å‘³ç€ï¼Œè¯·æ±‚ä¸€ç›´è°ƒç”¨ç›¸åŒçš„åˆ†åŒºï¼Œå¯¼è‡´è¯¥åˆ†åŒºçš„æ‰€æœ‰å®¹é‡å•ä½ç”¨å°½ï¼Œè¿›è€Œé™åˆ¶è¯¥åˆ†åŒºä¸­çš„å…¶ä»–è¯·æ±‚ã€‚å¦‚æœè¯»å–æ•°æ®è¯·æ±‚åˆ†å¸ƒåœ¨å¤šä¸ªåˆ†åŒºä¹‹ä¸­ï¼Œåˆ™æ­¤æ“ä½œä¸ä¼šç»™ç‰¹å®šåˆ†åŒºå¸¦æ¥é™åˆ¶ã€‚\n\n- æŸ¥è¯¢æŠ€å·§\n\n  - å‡å°é¡µé¢å¤§å°\n\n    ç”±äºæ‰«ææ“ä½œä¼šè¯»å–æ•´ä¸ªé¡µé¢ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸º 1 MBï¼‰ï¼Œå› æ­¤ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½®è¾ƒå°çš„é¡µé¢å¤§å°æ¥é™ä½æ‰«ææ“ä½œçš„å½±å“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `Scan` æ“ä½œæä¾›çš„ *Limit* å‚æ•°è®¾ç½®è¯·æ±‚çš„é¡µé¢å¤§å°ã€‚è®¾ç½®äº†è¾ƒå°çš„é¡µé¢å¤§å°åï¼Œæ¯ä¸ª `Query` æˆ– `Scan`è¯·æ±‚éƒ½ä¼šä½¿ç”¨æ›´å°‘çš„è¯»å–æ“ä½œï¼Œå¹¶ä¼šåœ¨æ¯ä¸ªè¯·æ±‚ä¹‹é—´â€œåœé¡¿â€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ¯ä¸ªé¡¹ç›®ä¸º 4 KBï¼Œå¹¶ä¸”æ‚¨å°†é¡µé¢å¤§å°è®¾ç½®ä¸º 40 ä¸ªé¡¹ç›®ã€‚ä¹‹åï¼Œ`Query` è¯·æ±‚ä»…ä½¿ç”¨ 20 æ¬¡æœ€ç»ˆä¸€è‡´æ€§è¯»å–æ“ä½œæˆ– 40 æ¬¡å¼ºä¸€è‡´æ€§è¯»å–æ“ä½œã€‚å¦‚æœå ç”¨è¾ƒå°å®¹é‡å•ä½çš„ `Query` æˆ– `Scan` æ“ä½œæ•°é‡è¾ƒå¤šï¼Œæ‚¨å°±å¯ä»¥æˆåŠŸå®Œæˆå…¶ä»–é‡è¦è¯·æ±‚è€Œä¸ä¼šå—åˆ°é™åˆ¶ã€‚\n\n  - éš”ç¦»æ‰«ææ“ä½œ\n\n    åº”ç”¨ç¨‹åºå¯ä»¥åˆ›å»ºå¤šä¸ªè¡¨ä»¥å½¼æ­¤åŒºåˆ†ï¼Œç”šè‡³å¤šä¸ªè¡¨å¯èƒ½ä¼šå¤åˆ¶å½¼æ­¤çš„å†…å®¹ã€‚æ‚¨å¯èƒ½ä¼šåœ¨æ²¡æœ‰â€œå…³é”®ä»»åŠ¡å‹â€æµé‡çš„è¡¨ä¸­æ‰§è¡Œæ‰«æã€‚æŸäº›åº”ç”¨ç¨‹åºä¼šæ¯å°æ—¶åœ¨ä¸¤ä¸ªè¡¨ä¹‹é—´è½®æ¢æµé‡æ¥å¤„ç†æ­¤è´Ÿè½½ â€” ä¸€ä¸ªç”¨äºå…³é”®æµé‡ï¼Œå¦ä¸€ä¸ªç”¨äºè®¡è´¦ã€‚å…¶ä»–åº”ç”¨ç¨‹åºå¯é€šè¿‡è®©æ¯æ¬¡å†™å…¥éƒ½åœ¨ä¸¤ä¸ªè¡¨ï¼ˆâ€œå…³é”®ä»»åŠ¡å‹â€è¡¨å’Œâ€œå½±å­â€è¡¨ï¼‰ä¸­æ‰§è¡Œæ¥å®ç°è¿™ä¸€ç›®çš„ã€‚\n\n## ä½¿ç”¨å…¨å±€è¡¨çš„æœ€ä½³å®è·µ\n\n*XMind: ZEN - Trial Version*\n\n## æ€ç»´å¯¼å›¾\n\n![best practice](http://media.gusibi.mobi/5HvoP9-Hbod2k-btCPDBBj5aiegMfO6awp3w9-DqxTpNUnJhQr4ZyEX7maG-HtRv)\n\n*XMind: ZEN - Trial Version*\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "DynamoDB æœ€ä½³å®è·µ",
        "date": "2019-06-10 14:36:53",
        "tags": [
          "DynamoDB",
          "nosql"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "dynamodb-best-practice"
    },
    {
      "content": "## json ç±»å‹\n\n### è¯´æ˜\n\næ ¹æ®[RFC 7159](https://tools.ietf.org/html/rfc7159)ä¸­çš„è¯´æ˜ï¼ŒJSON æ•°æ®ç±»å‹æ˜¯ç”¨æ¥å­˜å‚¨ JSONï¼ˆJavaScript Object Notationï¼‰æ•°æ®çš„ã€‚è¿™ç§æ•°æ®ä¹Ÿå¯ä»¥è¢«å­˜å‚¨ä¸º`text`ï¼Œä½†æ˜¯ JSON æ•°æ®ç±»å‹çš„ä¼˜åŠ¿åœ¨äºèƒ½å¼ºåˆ¶è¦æ±‚æ¯ä¸ªè¢«å­˜å‚¨çš„å€¼ç¬¦åˆ JSON è§„åˆ™ã€‚ä¹Ÿæœ‰å¾ˆå¤š JSON ç›¸å…³çš„å‡½æ•°å’Œæ“ä½œç¬¦å¯ä»¥ç”¨äºå­˜å‚¨åœ¨è¿™äº›æ•°æ®ç±»å‹ä¸­çš„æ•°æ®\n\nPostgreSQLæ”¯æŒä¸¤ç§ JSON æ•°æ®ç±»å‹ï¼šjson å’Œ jsonbã€‚å®ƒä»¬å‡ ä¹æ¥å—å®Œå…¨ç›¸åŒçš„å€¼é›†åˆä½œä¸ºè¾“å…¥ã€‚ä¸¤è€…æœ€å¤§çš„åŒºåˆ«æ˜¯æ•ˆç‡ã€‚jsonæ•°æ®ç±»å‹å­˜å‚¨è¾“å…¥æ–‡æœ¬çš„ç²¾å‡†æ‹·è´ï¼Œå¤„ç†å‡½æ•°å¿…é¡»åœ¨æ¯ æ¬¡æ‰§è¡Œæ—¶å¿…é¡»é‡æ–°è§£æè¯¥æ•°æ®ã€‚è€Œjsonbæ•°æ®è¢«å­˜å‚¨åœ¨ä¸€ç§åˆ†è§£å¥½çš„äºŒè¿›åˆ¶æ ¼å¼ä¸­ï¼Œå› ä¸ºéœ€è¦åšé™„åŠ çš„è½¬æ¢ï¼Œå®ƒåœ¨è¾“å…¥æ—¶è¦ç¨æ…¢ä¸€äº›ã€‚ä½†æ˜¯ jsonbåœ¨å¤„ç†æ—¶è¦å¿«å¾ˆå¤šï¼Œå› ä¸ºä¸éœ€è¦é‡æ–°è§£æã€‚\n\n> é‡ç‚¹ï¼šjsonbæ”¯æŒç´¢å¼•\n\n\nç”±äºjsonç±»å‹å­˜å‚¨çš„æ˜¯è¾“å…¥æ–‡æœ¬çš„å‡†ç¡®æ‹·è´ï¼Œå­˜å‚¨æ—¶ä¼šç©ºæ ¼å’ŒJSON å¯¹è±¡å†…éƒ¨çš„é”®çš„é¡ºåºã€‚å¦‚æœä¸€ä¸ªå€¼ä¸­çš„ JSON å¯¹è±¡åŒ…å«åŒä¸€ä¸ªé”®è¶…è¿‡ä¸€æ¬¡ï¼Œæ‰€æœ‰çš„é”®/å€¼å¯¹éƒ½ä¼šè¢«ä¿ç•™ï¼ˆ** å¤„ç†å‡½æ•°ä¼šæŠŠæœ€åçš„å€¼å½“ä½œæœ‰æ•ˆå€¼**ï¼‰ã€‚\n\njsonbä¸ä¿ç•™ç©ºæ ¼ã€ä¸ä¿ç•™å¯¹è±¡é”®çš„é¡ºåºå¹¶ä¸”ä¸ä¿ç•™é‡å¤çš„å¯¹è±¡é”®ã€‚å¦‚æœåœ¨è¾“å…¥ä¸­æŒ‡å®šäº†é‡å¤çš„é”®ï¼Œåªæœ‰æœ€åä¸€ä¸ªå€¼ä¼šè¢«ä¿ç•™ã€‚ \n\n> æ¨èæŠŠJSON æ•°æ®å­˜å‚¨ä¸ºjsonb \n\n\nåœ¨æŠŠæ–‡æœ¬ JSON è¾“å…¥è½¬æ¢æˆjsonbæ—¶ï¼ŒJSONçš„åŸºæœ¬ç±»å‹ï¼ˆ[RFC 7159 ](https://tools.ietf.org/html/rfc7159)ï¼‰ä¼šè¢«æ˜ å°„åˆ°åŸç”Ÿçš„ PostgreSQLç±»å‹ã€‚å› æ­¤ï¼Œjsonbæ•°æ®æœ‰ä¸€äº›æ¬¡è¦é¢å¤–çº¦æŸã€‚\n`æ¯”å¦‚ï¼š`jsonbå°†æ‹’ç»é™¤ PostgreSQL numericæ•°æ®ç±»å‹èŒƒå›´ä¹‹å¤–çš„æ•°å­—ï¼Œè€Œjsonåˆ™ä¸ä¼šã€‚\n\n\n\n**JSON åŸºæœ¬ç±»å‹å’Œç›¸åº”çš„PostgreSQLç±»å‹**\n\n\n| JSON åŸºæœ¬ç±»å‹ | PostgreSQLç±»å‹ | æ³¨é‡Š                                  |\n| ------------- | -------------- | ----------------------------------- |\n| `string`      | `text`         | ä¸å…è®¸`\\u0000`ï¼Œå¦‚æœæ•°æ®åº“ç¼–ç ä¸æ˜¯ UTF8ï¼Œé ASCII Unicode è½¬ä¹‰ä¹Ÿæ˜¯è¿™æ · |\n| `number`      | `numeric`      | ä¸å…è®¸`NaN` å’Œ `infinity`å€¼               |\n| `boolean`     | `boolean`      | åªæ¥å—å°å†™`true`å’Œ`false`æ‹¼å†™                 |\n| `null`        | (æ— )           | SQL `NULL`æ˜¯ä¸€ä¸ªä¸åŒçš„æ¦‚å¿µ             |\n\n\n###  json è¾“å…¥è¾“å‡ºè¯­æ³•\n\n\n```sql\n-- ç®€å•æ ‡é‡/åŸºæœ¬å€¼\n-- åŸºæœ¬å€¼å¯ä»¥æ˜¯æ•°å­—ã€å¸¦å¼•å·çš„å­—ç¬¦ä¸²ã€trueã€falseæˆ–è€…null\nSELECT '5'::json;\n\n-- æœ‰é›¶ä¸ªæˆ–è€…æ›´å¤šå…ƒç´ çš„æ•°ç»„ï¼ˆå…ƒç´ ä¸éœ€è¦ä¸ºåŒä¸€ç±»å‹ï¼‰\nSELECT '[1, 2, \"foo\", null]'::json;\n\n-- åŒ…å«é”®å€¼å¯¹çš„å¯¹è±¡\n-- æ³¨æ„å¯¹è±¡é”®å¿…é¡»æ€»æ˜¯å¸¦å¼•å·çš„å­—ç¬¦ä¸²\nSELECT '{\"bar\": \"baz\", \"balance\": 7.77, \"active\": false}'::json;\n\n-- æ•°ç»„å’Œå¯¹è±¡å¯ä»¥è¢«ä»»æ„åµŒå¥—\nSELECT '{\"foo\": [true, \"bar\"], \"tags\": {\"a\": 1, \"b\": null}}'::json;\n\n-- \"->\" é€šè¿‡é”®è·å¾— JSON å¯¹è±¡åŸŸ ç»“æœä¸ºjsonå¯¹è±¡\nselect '{\"nickname\": \"goodspeed\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json->'nickname' as nickname;\n nickname\n-------------\n \"goodspeed\"\n\n-- \"->>\" é€šè¿‡é”®è·å¾— JSON å¯¹è±¡åŸŸ ç»“æœä¸ºtext \nselect '{\"nickname\": \"goodspeed\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json->>'nickname' as nickname;\n nickname\n-----------\n goodspeed\n \n-- \"->\" é€šè¿‡é”®è·å¾— JSON å¯¹è±¡åŸŸ ç»“æœä¸ºjsonå¯¹è±¡\nselect '{\"nickname\": \"goodspeed\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->'nickname' as nickname;\n nickname\n-------------\n \"goodspeed\"\n\n-- \"->>\" é€šè¿‡é”®è·å¾— JSON å¯¹è±¡åŸŸ ç»“æœä¸ºtext \nselect '{\"nickname\": \"goodspeed\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->>'nickname' as nickname;\n nickname\n-----------\n goodspeed\n```\n\nå½“ä¸€ä¸ª JSON å€¼è¢«è¾“å…¥å¹¶ä¸”æ¥ç€ä¸åšä»»ä½•é™„åŠ å¤„ç†å°±è¾“å‡ºæ—¶ï¼Œ jsonä¼šè¾“å‡ºå’Œè¾“å…¥å®Œå…¨ç›¸åŒçš„æ–‡æœ¬ï¼Œè€Œjsonb åˆ™ä¸ä¼šä¿ç•™è¯­ä¹‰ä¸Šæ²¡æœ‰æ„ä¹‰çš„ç»†èŠ‚\n\n```sql\nSELECT '{\"bar\": \"baz\", \"balance\": 7.77, \"active\":false}'::json;\n                      json                       \n-------------------------------------------------\n {\"bar\": \"baz\", \"balance\": 7.77, \"active\":false}\n\n-- jsonb ä¸ä¼šä¿ç•™è¯­ä¹‰ä¸Šçš„ç»†èŠ‚ï¼Œkey çš„é¡ºåºä¹Ÿå’ŒåŸå§‹æ•°æ®ä¸ä¸€è‡´\nSELECT '{\"bar\": \"baz\", \"balance\": 7.77, \"active\":false}'::jsonb;\n                      jsonb                       \n--------------------------------------------------\n {\"bar\": \"baz\", \"active\": false, \"balance\": 7.77}\n```\n\n\n### json æŸ¥è¯¢è¯­æ³•\n\n\n> åœ¨ä½¿ç”¨JSONæ–‡æ¡£æ—¶ï¼Œæ¨è å°†JSON æ–‡æ¡£å­˜å‚¨ä¸ºå›ºå®šçš„ç»“æ„ã€‚ï¼ˆè¯¥ç»“æ„æ˜¯éå¼ºåˆ¶çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¯é¢„æµ‹çš„ç»“æ„ä¼šä½¿é›†åˆçš„æŸ¥è¯¢æ›´å®¹æ˜“ã€‚ ï¼‰\n> `è®¾è®¡JSONæ–‡æ¡£å»ºè®®ï¼š`ä»»ä½•æ›´æ–°éƒ½åœ¨æ•´è¡Œä¸Šè¦æ±‚ä¸€ä¸ªè¡Œçº§é”ã€‚ä¸ºäº†å‡å°‘é”äº‰å¤ºï¼ŒJSON æ–‡æ¡£åº”è¯¥æ¯ä¸ªè¡¨ç¤º ä¸€ä¸ªåŸå­æ•°æ®ï¼ˆä¸šåŠ¡è§„åˆ™ä¸Šçš„ä¸å¯æ‹†åˆ†ï¼Œå¯ç‹¬ç«‹ä¿®æ”¹çš„æ•°æ®ï¼‰ã€‚ \n\n> **è¿™äº›å¸¸ç”¨çš„æ¯”è¾ƒæ“ä½œç¬¦åªå¯¹jsonb æœ‰æ•ˆï¼Œè€Œä¸é€‚ç”¨äºjson**\n\n**å¸¸ç”¨çš„æ¯”è¾ƒæ“ä½œç¬¦**\n\n| æ“ä½œç¬¦       | æè¿°     |\n| ------------ | -------- |\n| `<`          | å°äº     |\n| `>`          | å¤§äº     |\n| `<=`         | å°äºç­‰äº |\n| `>=`         | å¤§äºç­‰äº |\n| `=`          | ç­‰äº     |\n| `<>` or `!=` | ä¸ç­‰äº   |\n\n\n\n#### åŒ…å«å’Œå­˜åœ¨\n\n##### json æ•°æ®æŸ¥è¯¢ï¼ˆé€‚ç”¨äºjsonbï¼‰\n\n**jsonå’Œjsonb æ“ä½œç¬¦**\n\n![](http://media.gusibi.mobi/PKR8RaA4jTwGLXslUgbb0BF9dM4fnKENY91UUx_BVSLZJ4wzg0s3eHuHbT6r2wgM)\n\n###### `-> å’Œ ->>` æ“ä½œç¬¦\n\n> ä½¿ç”¨ ->> æŸ¥å‡ºçš„æ•°æ®ä¸ºtext\n> ä½¿ç”¨ -> æŸ¥å‡ºçš„æ•°æ®ä¸ºjson å¯¹è±¡\n\n```sql\n-- nickname ä¸º gs çš„ç”¨æˆ· è¿™é‡Œä½¿ç”¨ ->> æŸ¥å‡ºçš„æ•°æ®ä¸ºtextï¼Œæ‰€ä»¥åŒ¹é…é¡¹ä¹Ÿåº”è¯¥æ˜¯text\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json->>'nickname' = 'gs';\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->>'nickname' = 'gs';\n\n-- ä½¿ç”¨ -> æŸ¥è¯¢ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼Œè¿™é‡Œæ— è®ºåŒ¹é…é¡¹æ˜¯textç±»å‹çš„ 'gs'  è¿˜æ˜¯ json ç±»å‹çš„ '\"gs\"'::jsonéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œjson ç±»å‹ä¸æ”¯æŒ ç­‰å·ï¼ˆ=ï¼‰æ“ä½œç¬¦\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json->'nickname' = '\"gs\"';\nERROR:  operator does not exist: json = unknown\n-- json ç±»å‹ä¸æ”¯æŒ \"=\" æ“ä½œç¬¦\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json->'nickname' = '\"gs\"'::json;\nERROR:  operator does not exist: json = json\n\n-- jsonb æ ¼å¼æ˜¯å¯ä»¥æŸ¥è¯¢æˆåŠŸçš„ï¼Œè¿™é‡Œä½¿ç”¨ -> æŸ¥å‡ºçš„æ•°æ®ä¸ºjson å¯¹è±¡ï¼Œæ‰€ä»¥åŒ¹é…é¡¹ä¹Ÿåº”è¯¥æ˜¯json å¯¹è±¡\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->'nickname' = '\"gs\"';\n```\n\n###### `#> å’Œ #>>` æ“ä½œç¬¦\n\n> ä½¿ç”¨ #>> æŸ¥å‡ºçš„æ•°æ®ä¸ºtext\n> ä½¿ç”¨ #> æŸ¥å‡ºçš„æ•°æ®ä¸ºjson å¯¹è±¡\n\n```sql\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json#>'{tags,0}' as tag;\n   tag\n----------\n \"python\"\n\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json#>>'{tags,0}' as tag;\n  tag\n--------\n python\n \nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb#>'{tags,0}' = '\"python\"';\n ?column?\n----------\n t\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb#>>'{tags,0}' = 'python';\n ?column?\n----------\n t\n\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json#>>'{tags,0}' = 'python';\n ?column?\n----------\n t\n-- ä¼šæŠ›å‡ºé”™è¯¯ï¼Œè¿™é‡Œæ— è®ºåŒ¹é…é¡¹æ˜¯textç±»å‹çš„ 'python'  è¿˜æ˜¯ json ç±»å‹çš„ '\"python\"'::jsonéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œjson ç±»å‹ä¸æ”¯æŒ ç­‰å·ï¼ˆ=ï¼‰æ“ä½œç¬¦\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::json#>'{tags,0}' = '\"python\"';\nERROR:  operator does not exist: json = unknown\n```\n\n##### jsonb æ•°æ®æŸ¥è¯¢ï¼ˆä¸é€‚ç”¨äºjsonï¼‰\n\n** é¢å¤–çš„jsonbæ“ä½œç¬¦**\n\n![](http://media.gusibi.mobi/-xkIrM_CZ63Hsh7QQdcQsDe35gDFNOrmSKpmZ9_UoYPawclXzGGg0cD-Ar6wQvR1)\n\n\n###### `@>`æ“ä½œç¬¦\n\n```sql\n-- nickname ä¸º nickname çš„ç”¨æˆ·\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb @> '{\"nickname\": \"gs\"}'::jsonb;\n\n-- ç­‰åŒäºä»¥ä¸‹æŸ¥è¯¢\n-- è¿™é‡Œä½¿ç”¨ -> æŸ¥å‡ºçš„æ•°æ®ä¸ºjson å¯¹è±¡ï¼Œæ‰€ä»¥åŒ¹é…é¡¹ä¹Ÿåº”è¯¥æ˜¯json å¯¹è±¡\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->'nickname' = '\"gs\"';\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->>'nickname' = 'gs';\n\n-- æŸ¥è¯¢æœ‰ python å’Œ golang æ ‡ç­¾çš„æ•°æ®\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb @> '{\"tags\": [\"python\", \"golang\"]}';\n ?column?\n----------\n t\n```\n\n###### `?`æ“ä½œç¬¦ã€`?|`æ“ä½œç¬¦å’Œ`?&`æ“ä½œç¬¦\n\n```sql\n-- æŸ¥è¯¢æœ‰ avatar å±æ€§çš„ç”¨æˆ·\nselect '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb ? 'avatar';\n-- æŸ¥è¯¢æœ‰ avatar å±æ€§ å¹¶ä¸”avatar æ•°æ®ä¸ä¸ºç©ºçš„æ•°æ®\nselect '{\"nickname\": \"gs\", \"avatar\": null, \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->>'avatar' is not null;\n\n-- æŸ¥è¯¢ æœ‰ avatar æˆ– tags çš„æ•°æ®\nselect '{\"nickname\": \"gs\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb ?| array['avatar', 'tags'];\n ?column?\n----------\n t\n\n-- æŸ¥è¯¢ æ—¢æœ‰ avatar åˆæœ‰ tags çš„ç”¨æˆ·\nselect '{\"nickname\": \"gs\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb ?& array['avatar', 'tags'];\n ?column?\n----------\n f\n \n -- æŸ¥è¯¢ tags ä¸­åŒ…å« python æ ‡ç­¾çš„æ•°æ®\n select '{\"nickname\": \"gs\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"db\"]}'::jsonb->'tags' ? 'python';\n ?column?\n----------\n t\n```\n\n\n### json æ›´æ–°\n\n```sql\n-- æ›´æ–° account content å­—æ®µï¼ˆè¦†ç›–å¼æ›´æ–°ï¼‰\nupdate account set content = jsonb_set(content, '{}', '{\"nickname\": \"gs\", \"tags\": [\"python\", \"golang\", \"db\"]}', false);\n\n-- ä¿®æ”¹nickanmeä¸ºnickanme çš„ç”¨æˆ·æ ‡ç­¾\nupdate account set content = jsonb_set(content, '{tags}', '[\"test\", \"å¿ƒç†\"]', true) where content @> '{\"nickname\": \"nickname\"}'::jsonb;\n\nupdate account set content = jsonb_set(content, '{tags}', '[\"test\", \"å¿ƒç†\", \"åŒ»ç–—\"]', true) where content @> '{\"nickname\": \"nickname\"}'::jsonb;\n\n-- æ›´æ–°account contentå­—æ®µä¸­ weixin_mp çš„å€¼ï¼ˆå¦‚æœæ²¡æœ‰ä¼šåˆ›å»ºï¼‰\n\nupdate account set content = jsonb_set(content, '{weixin_mp}', '\"weixin_mp5522bd28-ed4d-11e8-949c-7200014964f0\"', true) where id='5522bd28-ed4d-11e8-949c-7200014964f0';\n\n-- æ›´æ–°account å»é™¤content ä¸­weixin å­—æ®µï¼ˆå¦‚æœæ²¡æœ‰weixin å­—æ®µä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰\nupdate account set content= content - 'weixin' where id='5522bd28-ed4d-11e8-949c-7200014964f0';\n```\n\n### json å‡½æ•°\n\n#### jsonb_pretty\n\n> ä½œä¸ºç¼©è¿›JSONæ–‡æœ¬è¿”å›from_jsonã€‚ \n\n```sql\nselect jsonb_pretty('[{\"f1\":1,\"f2\":null},2,null,3]');\n    jsonb_pretty\n--------------------\n [                 +\n     {             +\n         \"f1\": 1,  +\n         \"f2\": null+\n     },            +\n     2,            +\n     null,         +\n     3             +\n ]\n(1 row)\n```\n\n\n\n\n####  jsonb_set \n\njsonb_set() å‡½æ•°å‚æ•°å¦‚ä¸‹ï¼š\n```c\njsonb_set(target         jsonb,  // éœ€è¦ä¿®æ”¹çš„æ•°æ®\n          path           text[], // æ•°æ®è·¯å¾„\n          new_value      jsonb,  // æ–°æ•°æ®\n          create_missing boolean default true)\n```\n> å¦‚æœcreate_missing æ˜¯true ï¼ˆç¼ºçœæ˜¯trueï¼‰ï¼Œå¹¶ä¸”pathæŒ‡å®šçš„è·¯å¾„åœ¨target ä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆtargetå°†åŒ…å«pathæŒ‡å®šéƒ¨åˆ†ï¼Œ new_valueæ›¿æ¢éƒ¨åˆ†ï¼Œ æˆ–è€…new_valueæ·»åŠ éƒ¨åˆ†ã€‚ \n\n```sql\n-- target ç»“æ„\nselect jsonb_pretty('[{\"f1\":1,\"f2\":null},2]');\n    jsonb_pretty\n--------------------\n [                 +\n     {             +\n         \"f1\": 1,  +\n         \"f2\": null+\n     },            +\n     2             +\n ]\n\n-- æ›´æ–° target ç¬¬0 ä¸ªå…ƒç´  key ä¸º f1 çš„å€¼ï¼Œå¦‚æœf1 ä¸å­˜åœ¨ å¿½ç•¥\nselect jsonb_set('[{\"f1\":1,\"f2\":null},2,null,3]', '{0,f1}','[2,3,4]', false);\n                  jsonb_set\n---------------------------------------------\n [{\"f1\": [2, 3, 4], \"f2\": null}, 2, null, 3]\n\n-- æ›´æ–° target ç¬¬0 ä¸ªå…ƒç´  key ä¸º f3 çš„å€¼ï¼Œå¦‚æœf3 ä¸å­˜åœ¨ åˆ›å»º \nselect jsonb_set('[{\"f1\":1,\"f2\":null},2]', '{0,f3}','[2,3,4]');\n                  jsonb_set\n---------------------------------------------\n [{\"f1\": 1, \"f2\": null, \"f3\": [2, 3, 4]}, 2]\n \n -- æ›´æ–° target ç¬¬0 ä¸ªå…ƒç´  key ä¸º f3 çš„å€¼ï¼Œå¦‚æœf3 ä¸å­˜åœ¨ å¿½ç•¥\nselect jsonb_set('[{\"f1\":1,\"f2\":null},2]', '{0,f3}','[2,3,4]', false);\n                  jsonb_set\n---------------------------------------------\n [{\"f1\": 1, \"f2\": null}, 2]\n```\n\nè¯¦ç»†çš„json å‡½æ•°å’Œæ“ä½œç¬¦å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š[JSON å‡½æ•°å’Œæ“ä½œç¬¦](http://www.postgres.cn/docs/9.5/functions-json.html)\n\n\n## jsonb æ€§èƒ½åˆ†æ\n\næˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹json çš„æŸ¥è¯¢æ€§èƒ½\n\n### è¡¨ç»“æ„\n\n```sql\n-- account è¡¨ id ä½¿ç”¨uuid ç±»å‹ï¼Œéœ€è¦å…ˆæ·»åŠ uuid-osspæ¨¡å—ã€‚\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\n-- create table\ncreate table account (id UUID NOT NULL PRIMARY KEY default uuid_generate_v1(), content jsonb, created_at timestamptz DEFAULT CURRENT_TIMESTAMP, updated_at timestamptz DEFAULT CURRENT_TIMESTAMP);\njson=> \\d account\n                               Table \"public.account\"\n    Column    |           Type           | Collation | Nullable |      Default\n--------------+--------------------------+-----------+----------+--------------------\n id           | uuid                     |           | not null |uuid_generate_v1()\n content      | jsonb                    |           |          |\n created_at   | timestamp with time zone |           |          | CURRENT_TIMESTAMP\n updated_at   | timestamp with time zone |           |          | CURRENT_TIMESTAMP\nIndexes:\n    \"account_pkey\" PRIMARY KEY, btree (id)\n```\n\n\n> ä¸€ä¸ªå¥½çš„å®è·µæ˜¯æŠŠ created_atå’Œ updated_at ä¹Ÿæ”¾å…¥jsonb å­—æ®µï¼Œè¿™é‡Œåªæ˜¯ç¤ºä¾‹\n\ncontent æ•°æ®ç»“æ„ä¸ºï¼š\n\n```json\ncontent = {\n    \"nickname\": {\"type\": \"string\"},\n    \"avatar\": {\"type\": \"string\"},\n    \"weixin\": {\"type\": \"string\"},\n    \"tags\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}},\n}\n```\n\n### å‡†å¤‡æ•°æ®\n\n**æ‰¹é‡æ’å…¥æ•°æ®**\n\n```sql\n-- æ’å…¥100wæ¡æœ‰ nickname avatar tags ä¸º[\"python\", \"golang\", \"c\"]çš„æ•°æ®\ninsert into account select uuid_generate_v1(), ('{\"nickname\": \"nn-' || round(random()*20000000) || '\", \"avatar\": \"avatar_url\", \"tags\": [\"python\", \"golang\", \"c\"]}')::jsonb from (select * from generate_series(1,100000)) as tmp;\n\n-- æ’å…¥100wæ¡æœ‰ nickname tags ä¸º[\"python\", \"golang\"]çš„æ•°æ®\ninsert into account select uuid_generate_v1(), ('{\"nickname\": \"nn-' || round(random()*2000000) || '\", \"tags\": [\"python\", \"golang\"]}')::jsonb from (select * from generate_series(1,1000000)) as tmp;\n\n-- æ’å…¥100wæ¡æœ‰ nickname tags ä¸º[\"python\"]çš„æ•°æ®\ninsert into account select uuid_generate_v1(), ('{\"nickname\": \"nn-' || round(random()*2000000) || '\", \"tags\": [\"python\"]}')::jsonb from (select * from generate_series(1,1000000)) as tmp;\n```\n\n### æµ‹è¯•æŸ¥è¯¢\n\n* EXPLAINï¼šæ˜¾ç¤ºPostgreSQLè®¡åˆ’ç¨‹åºä¸ºæä¾›çš„è¯­å¥ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ã€‚\n* ANALYZEï¼šæ”¶é›†æœ‰å…³æ•°æ®åº“ä¸­è¡¨çš„å†…å®¹çš„ç»Ÿè®¡ä¿¡æ¯ã€‚\n\n```sql\n\n--content ä¸­æœ‰avatar key çš„æ•°æ®æ¡æ•° count(*) æŸ¥è¯¢ä¸æ˜¯ä¸€ä¸ªå¥½çš„æµ‹è¯•è¯­å¥ï¼Œå°±ç®—æ˜¯æœ‰ç´¢å¼•ï¼Œä¹Ÿåªèƒ½èµ·åˆ°è¿‡æ»¤çš„ä½œç”¨ï¼Œå¦‚æœç»“æœé›†æ¯”è¾ƒå¤§ï¼ŒæŸ¥è¯¢é€Ÿåº¦è¿˜æ˜¯ä¼šå¾ˆæ…¢\nexplain analyze select count(*) from account where content::jsonb ? 'avatar';\n                   QUERY PLAN\n----------------------------------------------------------------------------------------\n Finalize Aggregate  (cost=29280.40..29280.41 rows=1 width=8) (actual time=170.366..170.366 rows=1 loops=1)\n   ->  Gather  (cost=29280.19..29280.40 rows=2 width=8) (actual time=170.119..174.451 rows=3 loops=1)\n         Workers Planned: 2\n         Workers Launched: 2\n         ->  Partial Aggregate  (cost=28280.19..28280.20 rows=1 width=8) (actual time=166.034..166.034 rows=1 loops=3)\n               ->  Parallel Seq Scan on account  (cost=0.00..28278.83 rows=542 width=0) (actual time=0.022..161.937 rows=33333 loops=3)\n                     Filter: (content ? 'avatar'::text)\n                     Rows Removed by Filter: 400000\n Planning Time: 0.048 ms\n Execution Time: 174.486 ms\n\n\n-- content ä¸­æ²¡æœ‰avatar key çš„æ•°æ®æ¡æ•°\nexplain analyze select count(*) from account where content::jsonb ? 'avatar' = false;\n                QUERY PLAN\n----------------------------------------------------------------------------------------\n Finalize Aggregate  (cost=30631.86..30631.87 rows=1 width=8) (actual time=207.770..207.770 rows=1 loops=1)\n   ->  Gather  (cost=30631.65..30631.86 rows=2 width=8) (actual time=207.681..212.357 rows=3 loops=1)\n         Workers Planned: 2\n         Workers Launched: 2\n         ->  Partial Aggregate  (cost=29631.65..29631.66 rows=1 width=8) (actual time=203.565..203.565 rows=1 loops=3)\n               ->  Parallel Seq Scan on account  (cost=0.00..28278.83 rows=541125 width=0) (actual time=0.050..163.629 rows=400000 loops=3)\n                     Filter: (NOT (content ? 'avatar'::text))\n                     Rows Removed by Filter: 33333\n Planning Time: 0.050 ms\n Execution Time: 212.393 ms\n```\n\n\n```sql\n--æŸ¥è¯¢content ä¸­nickname ä¸ºnn-194318çš„æ•°æ®\nexplain analyze select * from account where content@>'{\"nickname\": \"nn-194318\"}';\n                                                         QUERY PLAN\n----------------------------------------------------------------------------------------\n Gather  (cost=1000.00..29408.83 rows=1300 width=100) (actual time=0.159..206.990 rows=1 loops=1)\n   Workers Planned: 2\n   Workers Launched: 2\n   ->  Parallel Seq Scan on account  (cost=0.00..28278.83 rows=542 width=100) (actual time=130.867..198.081 rows=0 loops=3)\n         Filter: (content @> '{\"nickname\": \"nn-194318\"}'::jsonb)\n         Rows Removed by Filter: 433333\n Planning Time: 0.047 ms\n Execution Time: 207.007 ms\n \n-- å¯¹åº”çš„æŸ¥è¯¢id ä¸º 'b5b3ed06-7d35-11e9-b3ea-00909e9dab1d' çš„æ•°æ®\nexplain analyze select * from account where id='b5b3ed06-7d35-11e9-b3ea-00909e9dab1d';\n                                                       QUERY PLAN\n----------------------------------------------------------------------------------------\n Index Scan using account_pkey on account  (cost=0.43..8.45 rows=1 width=100) (actual time=0.912..0.914 rows=1 loops=1)\n   Index Cond: (id = 'b5b3ed06-7d35-11e9-b3ea-00909e9dab1d'::uuid)\n Planning Time: 0.348 ms\n Execution Time: 0.931 ms\n```\n\né€šè¿‡ç»“æœå¯ä»¥çœ‹åˆ° ä½¿ç”¨ jsonb æŸ¥è¯¢å’Œä½¿ç”¨ä¸»é”®æŸ¥è¯¢é€Ÿåº¦å·®å¼‚å·¨å¤§ï¼Œé€šè¿‡çœ‹æŸ¥è¯¢åˆ†æè®°å½•å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªè¯­å¥æœ€å¤§çš„å·®åˆ«åœ¨äºä½¿ç”¨ä¸»é”®çš„æŸ¥è¯¢ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œcontent nickname çš„æŸ¥è¯¢æ²¡æœ‰ç´¢å¼•å¯ä»¥ä½¿ç”¨ã€‚\næ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹ä½¿ç”¨ç´¢å¼•æ—¶çš„æŸ¥è¯¢é€Ÿåº¦ã€‚\n\n\n### ç´¢å¼•\n\n#### GIN ç´¢å¼•ä»‹ç»\n\nJSONB æœ€å¸¸ç”¨çš„æ˜¯`GIN` ç´¢å¼•ï¼ŒGIN ç´¢å¼•å¯ä»¥è¢«ç”¨æ¥æœ‰æ•ˆåœ°æœç´¢åœ¨å¤§é‡jsonbæ–‡æ¡£ï¼ˆæ•°æ®ï¼‰ä¸­å‡ºç° çš„é”®æˆ–è€…é”®å€¼å¯¹ã€‚\n\n> GIN(Generalized Inverted Index, é€šç”¨å€’æ’ç´¢å¼•) æ˜¯ä¸€ä¸ªå­˜å‚¨å¯¹(key, posting list)é›†åˆçš„ç´¢å¼•ç»“æ„ï¼Œå…¶ä¸­keyæ˜¯ä¸€ä¸ªé”®å€¼ï¼Œè€Œposting list æ˜¯ä¸€ç»„å‡ºç°è¿‡keyçš„ä½ç½®ã€‚å¦‚(â€˜hello', '14:2 23:4')ä¸­ï¼Œè¡¨ç¤ºhelloåœ¨14:2å’Œ23:4è¿™ä¸¤ä¸ªä½ç½®å‡ºç°è¿‡ï¼Œåœ¨PGä¸­è¿™äº›ä½ç½®å®é™…ä¸Šå°±æ˜¯å…ƒç»„çš„tid(è¡Œå·ï¼ŒåŒ…æ‹¬æ•°æ®å—IDï¼ˆ32bitï¼‰,ä»¥åŠitem point(16 bit) )ã€‚\n> \n> åœ¨è¡¨ä¸­çš„æ¯ä¸€ä¸ªå±æ€§ï¼Œåœ¨å»ºç«‹ç´¢å¼•æ—¶ï¼Œéƒ½å¯èƒ½ä¼šè¢«è§£æä¸ºå¤šä¸ªé”®å€¼ï¼Œæ‰€ä»¥åŒä¸€ä¸ªå…ƒç»„çš„tidå¯èƒ½ä¼šå‡ºç°åœ¨å¤šä¸ªkeyçš„posting listä¸­ã€‚\n> \n> é€šè¿‡è¿™ç§ç´¢å¼•ç»“æ„å¯ä»¥å¿«é€Ÿçš„æŸ¥æ‰¾åˆ°åŒ…å«æŒ‡å®šå…³é”®å­—çš„å…ƒç»„ï¼Œå› æ­¤GINç´¢å¼•ç‰¹åˆ«é€‚ç”¨äºå¤šå€¼ç±»å‹çš„å…ƒç´ æœç´¢ï¼Œæ¯”å¦‚æ”¯æŒå…¨æ–‡æœç´¢ï¼Œæ•°ç»„ä¸­å…ƒç´ çš„æœç´¢ï¼Œè€ŒPGçš„GINç´¢å¼•æ¨¡å—æœ€åˆä¹Ÿæ˜¯ä¸ºäº†æ”¯æŒå…¨æ–‡æœç´¢è€Œå¼€å‘çš„ã€‚\n\n![gin ç´¢å¼•æ•°æ®ç»“æ„](http://media.gusibi.mobi/olurF8ptRiSWx6WsIThgzKL-QkLlIJB_qF0QTYy5fvhce4-e-ATPQ4O8byaE75IE)\n\n`jsonb`çš„é»˜è®¤ GIN æ“ä½œç¬¦ç±»æ”¯æŒä½¿ç”¨é¡¶å±‚é”®å­˜åœ¨è¿ç®—ç¬¦`?`ã€`?&`ä»¥åŠ`?|` æ“ä½œç¬¦å’Œè·¯å¾„/å€¼å­˜åœ¨è¿ç®—ç¬¦`@>`çš„æŸ¥è¯¢ã€‚\n\n```sql\n-- åˆ›å»ºé»˜è®¤ç´¢å¼•\nCREATE INDEX idxgin ON api USING GIN (jdoc);\n```\n\néé»˜è®¤çš„ GIN æ“ä½œç¬¦ç±»`jsonb_path_ops`åªæ”¯æŒç´¢å¼•`@>`æ“ä½œç¬¦ã€‚\n\n```sql\n-- åˆ›å»ºæŒ‡å®šè·¯å¾„çš„ç´¢å¼•\nCREATE INDEX idxginp ON api USING GIN (jdoc jsonb_path_ops);\n-- create index  ix_account_content_nickname_gin on account using gin (content, (content->'nickname'));\n-- create index  ix_account_content_tags_gin on account using gin (content, (content->'nickname'));\n-- create index  ix_account_content_tags_gin on account using gin ((content->'tags'));\n```\n\n#### å¤šç´¢å¼•æ”¯æŒ\n\n> PostgreSQL æ‹¥æœ‰å¼€æ”¾çš„ç´¢å¼•æ¥å£ï¼Œä½¿å¾—PGæ”¯æŒéå¸¸ä¸°å¯Œçš„ç´¢å¼•æ–¹æ³•ï¼Œä¾‹å¦‚btree , hash , gin , gist , sp-gist , brin , bloom , rum , zombodb , bitmap (greenplum extend)ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä»¥åŠæŸ¥è¯¢çš„åœºæ™¯ï¼Œé€‰æ‹©ä¸åŒçš„ç´¢å¼•ã€‚\n\n\n#### æŸ¥è¯¢ä¼˜åŒ–\n\n**åˆ›å»ºé»˜è®¤ç´¢å¼•**\n\n```sql\n-- åˆ›å»ºç®€å•ç´¢å¼•\ncreate index ix_account_content on account USING GIN (content);\n```\n\nç°åœ¨ä¸‹é¢è¿™æ ·çš„æŸ¥è¯¢å°±èƒ½ä½¿ç”¨è¯¥ç´¢å¼•ï¼š\n\n```sql\n-- content ä¸­æœ‰avatar key çš„æ•°æ®æ¡æ•°\nexplain analyze select count(*) from account where content::jsonb ? 'avatar';\n                                                                QUERY PLAN\n------------------------------------------------------------------------------------------------------------------------------------------\n Aggregate  (cost=4180.49..4180.50 rows=1 width=8) (actual time=43.462..43.462 rows=1 loops=1)\n   ->  Bitmap Heap Scan on account  (cost=30.07..4177.24 rows=1300 width=0) (actual time=8.362..36.048 rows=100000 loops=1)\n         Recheck Cond: (content ? 'avatar'::text)\n         Heap Blocks: exact=2032\n         ->  Bitmap Index Scan on ix_account_content  (cost=0.00..29.75 rows=1300 width=0) (actual time=8.125..8.125 rows=100000 loops=1)\n               Index Cond: (content ? 'avatar'::text)\n Planning Time: 0.078 ms\n Execution Time: 43.503 ms\n```\n\nå’Œä¹‹å‰æ²¡æœ‰æ·»åŠ ç´¢å¼•æ—¶é€Ÿåº¦æå‡äº†3å€ã€‚\n\n```sql\n-- æŸ¥è¯¢content ä¸­nickname ä¸ºnn-194318çš„æ•°æ®\nexplain analyze select * from account where content@>'{\"nickname\": \"nn-194318\"}';\n                                                          QUERY PLAN\n----------------------------------------------------------------------------------------\n Bitmap Heap Scan on account  (cost=46.08..4193.24 rows=1300 width=100) (actual time=0.097..0.097 rows=1 loops=1)\n   Recheck Cond: (content @> '{\"nickname\": \"nn-194318\"}'::jsonb)\n   Heap Blocks: exact=1\n   ->  Bitmap Index Scan on ix_account_content  (cost=0.00..45.75 rows=1300 width=0) (actual time=0.091..0.091 rows=1 loops=1)\n         Index Cond: (content @> '{\"nickname\": \"nn-194318\"}'::jsonb)\n Planning Time: 0.075 ms\n Execution Time: 0.132 ms\n```\nè¿™ä¸ªæŸ¥è¯¢æ•ˆç‡æå‡æ›´æ˜æ˜¾ï¼Œç«Ÿç„¶æ¯”ä½¿ç”¨ä¸»é”®è¿˜è¦é«˜æ•ˆã€‚\n\n**ä½†æ˜¯ä¸‹é¢è¿™ç§æŸ¥è¯¢å¹¶ä¸èƒ½ä½¿ç”¨ç´¢å¼•**ï¼š\n\n```sql\n-- æŸ¥è¯¢content ä¸­ä¸å­˜åœ¨ avatar key çš„æ•°æ®æ¡æ•°\nexplain analyze select count(*) from account where content::jsonb ? 'avatar' = false;\n                                                                 QUERY PLAN\n----------------------------------------------------------------------------------------\n Finalize Aggregate  (cost=30631.86..30631.87 rows=1 width=8) (actual time=207.641..207.641 rows=1 loops=1)\n   ->  Gather  (cost=30631.65..30631.86 rows=2 width=8) (actual time=207.510..211.062 rows=3 loops=1)\n         Workers Planned: 2\n         Workers Launched: 2\n         ->  Partial Aggregate  (cost=29631.65..29631.66 rows=1 width=8) (actual time=203.739..203.739 rows=1 loops=3)\n               ->  Parallel Seq Scan on account  (cost=0.00..28278.83 rows=541125 width=0) (actual time=0.024..163.444 rows=400000 loops=3)\n                     Filter: (NOT (content ? 'avatar'::text))\n                     Rows Removed by Filter: 33333\n Planning Time: 0.068 ms\n Execution Time: 211.097 ms\n```\n\nè¯¥ç´¢å¼•ä¹Ÿä¸èƒ½è¢«ç”¨äºä¸‹é¢è¿™æ ·çš„æŸ¥è¯¢ï¼Œå› ä¸ºå°½ç®¡æ“ä½œç¬¦`?` æ˜¯å¯ç´¢å¼•çš„ï¼Œä½†å®ƒä¸èƒ½ç›´æ¥è¢«åº”ç”¨äºè¢«ç´¢å¼•åˆ—contentï¼š \n\n```sql\nexplain analyze select count(1) from account where content -> 'tags' ? 'c';\n                                                               QUERY PLAN\n----------------------------------------------------------------------------------------\n Finalize Aggregate  (cost=30634.57..30634.58 rows=1 width=8) (actual time=184.864..184.864 rows=1 loops=1)\n   ->  Gather  (cost=30634.35..30634.56 rows=2 width=8) (actual time=184.754..189.652 rows=3 loops=1)\n         Workers Planned: 2\n         Workers Launched: 2\n         ->  Partial Aggregate  (cost=29634.35..29634.36 rows=1 width=8) (actual time=180.755..180.755 rows=1 loops=3)\n               ->  Parallel Seq Scan on account  (cost=0.00..29633.00 rows=542 width=0) (actual time=0.022..177.051 rows=33333 loops=3)\n                     Filter: ((content -> 'tags'::text) ? 'c'::text)\n                     Rows Removed by Filter: 400000\n Planning Time: 0.074 ms\n Execution Time: 189.716 ms\n```\n\n**ä½¿ç”¨è¡¨è¾¾å¼ç´¢å¼•**\n\n```sql\n-- åˆ›å»ºè·¯å¾„ç´¢å¼•\ncreate index ix_account_content_tags on account USING GIN ((content->'tags'));\n```\n\n```sql\n-- æµ‹è¯•æŸ¥è¯¢æ€§èƒ½\nexplain analyze select count(1) from account where content -> 'tags' ? 'c';\n                                                                   QUERY PLAN\n----------------------------------------------------------------------------------------\n Aggregate  (cost=4631.74..4631.75 rows=1 width=8) (actual time=49.274..49.275 rows=1 loops=1)\n   ->  Bitmap Heap Scan on account  (cost=478.07..4628.49 rows=1300 width=0) (actual time=8.655..42.074 rows=100000 loops=1)\n         Recheck Cond: ((content -> 'tags'::text) ? 'c'::text)\n         Heap Blocks: exact=2032\n         ->  Bitmap Index Scan on ix_account_content_tags  (cost=0.00..477.75 rows=1300 width=0) (actual time=8.417..8.417 rows=100000 loops=1)\n               Index Cond: ((content -> 'tags'::text) ? 'c'::text)\n Planning Time: 0.216 ms\n Execution Time: 49.309 ms\n```\n\nç°åœ¨ï¼ŒWHERE å­å¥`content -> 'tags' ? 'c'` å°†è¢«è¯†åˆ«ä¸ºå¯ç´¢å¼•æ“ä½œç¬¦?åœ¨ç´¢å¼•è¡¨è¾¾å¼`content -> 'tags'` ä¸Šçš„åº”ç”¨ã€‚\n\nä¹Ÿå¯ä»¥åˆ©ç”¨åŒ…å«æŸ¥è¯¢çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š\n\n```sql\n-- æŸ¥å¯» \"tags\" åŒ…å«æ•°ç»„å…ƒç´  \"c\" çš„æ•°æ®çš„ä¸ªæ•°\nselect count(1) from account where content @> '{\"tags\": [\"c\"]}';\n```\n\ncontent åˆ—ä¸Šçš„ç®€å• GIN ç´¢å¼•ï¼ˆé»˜è®¤ç´¢å¼•ï¼‰å°±èƒ½æ”¯æŒç´¢å¼•æŸ¥è¯¢ã€‚ ä½†æ˜¯ç´¢å¼•å°†ä¼š**å­˜å‚¨contentåˆ—ä¸­æ¯ä¸€ä¸ªé”® å’Œå€¼çš„æ‹·è´**ï¼Œ\n**è¡¨è¾¾å¼ç´¢å¼•**åªå­˜å‚¨tags é”®ä¸‹æ‰¾åˆ°çš„æ•°æ®ã€‚\n\n> è™½ç„¶ç®€å•ç´¢å¼•çš„æ–¹æ³•æ›´åŠ çµæ´»ï¼ˆå› ä¸ºå®ƒæ”¯æŒæœ‰å…³ä»»æ„é”®çš„æŸ¥è¯¢ï¼‰ï¼Œä½†å®šå‘çš„è¡¨è¾¾å¼ç´¢å¼•æ›´å°å¹¶ä¸”æœç´¢é€Ÿåº¦æ¯”ç®€å•ç´¢å¼•æ›´å¿«ã€‚\n> å°½ç®¡jsonb_path_opsæ“ä½œç¬¦ç±»åªæ”¯æŒç”¨ @>æ“ä½œç¬¦çš„æŸ¥è¯¢ï¼Œä½†å®ƒæ¯”èµ·é»˜è®¤çš„æ“ä½œç¬¦ç±» jsonb_opsæœ‰æ›´å®¢è§‚çš„æ€§èƒ½ä¼˜åŠ¿ã€‚ä¸€ä¸ª jsonb_path_opsç´¢å¼•é€šå¸¸ä¹Ÿæ¯”ä¸€ä¸ªç›¸åŒæ•°æ®ä¸Šçš„ jsonb_opsè¦å°å¾—å¤šï¼Œå¹¶ä¸”æœç´¢çš„ä¸“ä¸€æ€§æ›´å¥½ï¼Œç‰¹ åˆ«æ˜¯å½“æŸ¥è¯¢åŒ…å«é¢‘ç¹å‡ºç°åœ¨è¯¥æ•°æ®ä¸­çš„é”®æ—¶ã€‚å› æ­¤ï¼Œå…¶ä¸Šçš„æœç´¢æ“ä½œ é€šå¸¸æ¯”ä½¿ç”¨é»˜è®¤æ“ä½œç¬¦ç±»çš„æœç´¢è¡¨ç°æ›´å¥½ã€‚ \n\n## æ€»ç»“\n\n* PG æœ‰ä¸¤ç§ JSON æ•°æ®ç±»å‹ï¼š`json` å’Œ `jsonb`ï¼Œjsonb æ€§èƒ½ä¼˜äºjsonï¼Œä¸”jsonb æ”¯æŒç´¢å¼•ã€‚\n* jsonb å†™å…¥æ—¶ä¼šå¤„ç†å†™å…¥æ•°æ®ï¼Œå†™å…¥ç›¸å¯¹è¾ƒæ…¢ï¼Œjsonä¼šä¿ç•™åŸå§‹æ•°æ®ï¼ˆåŒ…æ‹¬æ— ç”¨çš„ç©ºæ ¼ï¼‰\n* jsonb æŸ¥è¯¢ä¼˜åŒ–æ—¶ä¸€ä¸ªå¥½çš„æ–¹å¼æ˜¯æ·»åŠ GIN ç´¢å¼•\n    - ç®€å•ç´¢å¼•å’Œè·¯å¾„ç´¢å¼•ç›¸æ¯”æ›´çµæ´»ï¼Œä½†æ˜¯å ç”¨ç©ºé—´å¤š\n    - è·¯å¾„ç´¢å¼•æ¯”ç®€å•ç´¢å¼•æ›´é«˜æ•ˆï¼Œå ç”¨ç©ºé—´æ›´å°\n\n\n## å‚è€ƒé“¾æ¥\n\n* [RFC 7159 The JavaScript Object Notation (JSON) Data Interchange Format](https://tools.ietf.org/html/rfc7159)\n* [PostgreSQL æ–‡æ¡£ï¼š JSON ç±»å‹](http://www.postgres.cn/docs/10/datatype-json.html)\n* [JSON å‡½æ•°å’Œæ“ä½œç¬¦](http://www.postgres.cn/docs/9.5/functions-json.html)\n* [How do I modify fields inside the new PostgreSQL JSON datatype?](https://stackoverflow.com/questions/18209625/how-do-i-modify-fields-inside-the-new-postgresql-json-datatype)\n* [PostgreSQL 9ç§ç´¢å¼•çš„åŸç†å’Œåº”ç”¨åœºæ™¯](https://yq.aliyun.com/articles/111793)\n* [PostgreSQL GINç´¢å¼•å®ç°åŸç†](https://github.com/digoal/blog/blob/master/201702/20170204_01.md)\n* [PostgreSQL internals: JSONB type and its indexes](https://bitnine.net/blog-postgresql/postgresql-internals-jsonb-type-and-its-indexes/)\n* [å€’æ’ç´¢å¼•](https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "PostgreSQL jsonb ä½¿ç”¨å…¥é—¨",
        "date": "2019-05-30 13:05:57",
        "tags": [
          "tutorial",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "postgresql-json"
    },
    {
      "content": "\n> ã€Šä»£ç å¤§å…¨ã€‹è¯»ä¹¦ç¬”è®°\n\n> å¤ªé•¿ä¸çœ‹ç‰ˆ\n![](http://media.gusibi.mobi/2nqKmJp5tMClypa0WqnJXl8sI9Tv4hwo3Zs6oEp4U4nwV9dV1XWqmFjvQNxRrggg)\n\n## è½¯ä»¶æ„å»ºä¸­çš„è®¾è®¡\n\n> è½¯ä»¶è®¾è®¡æ˜¯ä¸€é¡¹æ˜ç¡®çš„æ´»åŠ¨\n\n### è®¾è®¡ä¸­çš„æŒ‘æˆ˜\n\n> `è½¯ä»¶è®¾è®¡`ä¸€è¯æ„å‘³ç€å»æ„æ€ã€åˆ›é€ æˆ–å‘æ˜ä¸€å¥—æ–¹æ¡ˆï¼ŒæŠŠä¸€ä»½è®¡ç®—æœºè½¯ä»¶çš„è§„æ ¼è¯´æ˜ä¹¦è¦æ±‚è½¬å˜ä¸ºå¯å®é™…è¿è¡Œçš„è½¯ä»¶ã€‚\n> è®¾è®¡å°±æ˜¯æŠŠéœ€æ±‚åˆ†æå’Œç¼–ç è°ƒè¯•è¿æ¥åœ¨ä¸€èµ·çš„æ´»åŠ¨ã€‚\n> å¥½çš„é«˜å±‚è¯è®¾è®¡èƒ½å¤Ÿæä¾›ä¸€ä¸ªå¯ä»¥ç¨³å¦¥å®¹çº³å¤šä¸ªè¾ƒä½å±‚æ¬¡è®¾è®¡çš„ç»“æ„ã€‚\n\n#### è®¾è®¡æ˜¯ä¸€ä¸ªé™©æ¶çš„é—®é¢˜\n\n> é™©æ¶ï¼ˆwickedï¼‰çš„é—®é¢˜å°±æ˜¯é‚£ç§åªæœ‰é€šè¿‡è§£å†³æˆ–éƒ¨åˆ†è§£å†³æ‰èƒ½è¢«æ˜ç¡®çš„é—®é¢˜ã€‚\n\nTacoma Narrows å¤§æ¡¥æ˜¯ä¸€ä¸ªé™©æ¶é—®é¢˜çš„å¥½ä¾‹å­ï¼Œå› ä¸ºç›´åˆ°è¿™åº§æ¡¥åå¡Œï¼Œå·¥ç¨‹å¸ˆæ‰çŸ¥é“ä¸åº”è¯¥åªè€ƒè™‘æ¡¥çš„è´Ÿè·ï¼Œè¿˜éœ€è¦å……åˆ†çš„è€ƒè™‘ç©ºæ°”åŠ¨åŠ›å­¦å› ç´ ï¼ˆåªæœ‰å»ºé€ å¤§æ¡¥ï¼Œæ‰èƒ½ä»ä¸­å­¦åˆ°éœ€è¦è€ƒè™‘é¢å¤–çš„ç¯èŠ‚ï¼‰ã€‚\n\n#### è®¾è®¡æ˜¯ä¸€ä¸ªäº†æ— ç« æ³•çš„è¿‡ç¨‹ï¼ˆå³ä½¿å®ƒèƒ½å¾—å¤„æ¸…çˆ½çš„æˆæœï¼‰\n\n* æ˜¯å› ä¸ºåœ¨è®¾è®¡çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡‡ç”¨å¾ˆå¤šé”™è¯¯çš„æ­¥éª¤ï¼Œå¤šæ¬¡å‡ºé”™\n* å› ä¸ºè®¾è®¡çš„ä¼˜åŠ£å·®å¼‚å¾€å¾€éå¸¸å¾®å¦™\n* å› ä¸ºä¸èƒ½åˆ¤æ–­è®¾è®¡æ˜¯å¦è¶³å¤Ÿå¥½\n\n\n#### è®¾è®¡å°±æ˜¯ç¡®å®šå–èˆå’Œè°ƒæ•´é¡ºåºçš„è¿‡ç¨‹\n\nç°å®ä¸–ç•Œä¸­ï¼Œè®¾è®¡è€…å·¥ä½œçš„ä¸€ä¸ªå…³é”®å†…å®¹å°±æ˜¯è¡¡é‡å½¼æ­¤å†²çªçš„å„é¡¹è®¾è®¡ç‰¹æ€§ï¼Œå¹¶å°½åŠ›åœ¨å…¶ä¸­å¯»æ±‚å¹³è¡¡ã€‚å“åº”é€Ÿåº¦ä¼˜å…ˆå’Œå¼€å‘æ—¶é—´çŸ­ä¼˜å…ˆå¾—å‡ºçš„è®¾è®¡ç»“æœå¯èƒ½æ˜¯ä¸åŒçš„ã€‚\n\n#### è®¾è®¡å—åˆ°è¯¸å¤šé™åˆ¶\n\nè®¾è®¡çš„è¦ç‚¹ä¸€éƒ¨åˆ†æ˜¯åœ¨åˆ›é€ å¯èƒ½å‘ç”Ÿçš„äº‹æƒ…ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯åœ¨é™åˆ¶å¯èƒ½å‘ç”Ÿçš„äº‹æƒ…ã€‚\n\n> å¦‚æœä¸€ä¸ªäººæœ‰æ— é™ç©ºé—´å’Œèµ„æºæ¥å»ºé€ æˆ¿å­ï¼Œå¯èƒ½ä¼šå»ºé€ å‡ºæ— æ³•æ§åˆ¶çš„å»ºç­‘ã€‚æ­£æ˜¯å› ä¸ºæœ‰äº†é™åˆ¶ï¼Œæ‰å¾—å‡ºäº†ç®€å•çš„ç»“æœã€‚è½¯ä»¶è®¾è®¡ä¹Ÿæ˜¯ä¸€æ ·ã€‚\n\n#### è®¾è®¡æ˜¯ä¸ç¡®å®šçš„\n\næ¯ä¸ªäººè®¾è®¡çš„ç»“æœå¯èƒ½æ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”å¯èƒ½ç”¨èµ·æ¥éƒ½ä¸é”™ã€‚è®¾è®¡æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆã€‚\n\n#### è®¾è®¡æ˜¯ä¸€ä¸ªå¯å‘å¼çš„è¿‡ç¨‹\n\n\nè®¾è®¡è¿‡ç¨‹ä¸­å……æ»¡äº†ä¸ç¡®å®šæ€§ï¼Œå› æ­¤è®¾è®¡æŠ€æœ¯ä¹Ÿè¶‹äºå…·æœ‰æ¢ç´¢æ€§--â€œç»éªŒæ³•åˆ™â€æˆ–è€…â€œè¯•è¯•æ²¡å‡†èƒ½è¡Œâ€--è€Œä¸æ˜¯ä¿è¯èƒ½äº§ç”Ÿé¢„æœŸç»“æœçš„å¯é‡å¤çš„è¿‡ç¨‹ã€‚\n\n#### è®¾è®¡æ˜¯è‡ªç„¶è€Œç„¶å½¢æˆçš„\n\nè®¾è®¡ä¸æ˜¯åœ¨è°çš„å¤´è„‘ä¸­ç›´æ¥è·³å‡ºæ¥çš„ï¼Œå®ƒæ˜¯åœ¨ä¸æ–­çš„è®¾è®¡è¯„ä¼°ã€éæ­£å¼è®¨è®ºã€å†™è¯•ç»éªŒä»¥åŠä¿®æ”¹è¯•éªŒä»£ç ä¸­æ¼”åŒ–å’Œå®Œå–„çš„ã€‚\n\n### å…³é”®çš„è®¾è®¡æ¦‚å¿µ\n\n#### è½¯ä»¶çš„é¦–è¦æŠ€æœ¯ä½¿å‘½ï¼šç®¡ç†å¤æ‚åº¦\n\n##### æœ¬è´¨çš„éš¾é¢˜å’Œå¶ç„¶çš„éš¾é¢˜\n\nå¶ç„¶çš„éš¾é¢˜å¯ä»¥ç†è§£ä¸ºbugï¼Œç¼–ç¨‹è¯­è¨€ç¬¨æ‹™çš„è¯­æ³•ï¼Œç­‰æ˜“äºå‘ç°å®¹æ˜“è§£å†³çš„é—®é¢˜ã€‚\næœ¬è´¨çš„éš¾é¢˜åˆ™æ¯”è¾ƒå¤æ‚ï¼Œæœ¬è´¨ä¸Šè¯´ï¼Œè½¯ä»¶å¼€å‘å°±æ˜¯ä¸æ–­å»å‘æ˜é”™ç»¼å¤æ‚ï¼Œç›¸äº’å…³è¿çš„æ•´å¥—æ¦‚å¿µçš„æ‰€æœ‰ç»†èŠ‚ã€‚æœ¬è´¨å›°éš¾å°±æ˜¯ï¼š\n\n1. è¦é¢å¯¹å¤æ‚ã€æ— åºçš„ç°å®ä¸–ç•Œï¼›\n2. ç²¾ç¡®è€Œå®Œæˆçš„è¯†åˆ«å‡ºå„ç§ä¾èµ–å…³ç³»å’Œå¤–éƒ¨æƒ…å†µ\n3. è®¾è®¡å‡ºå®Œå…¨æ­£ç¡®è€Œä¸æ˜¯å¤§è‡´æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ\nã€‚ã€‚ã€‚\n\n##### ç®¡ç†å¤æ‚åº¦çš„é‡è¦æ€§\n\nä¸€ä¸ªå¤±è´¥çš„é¡¹ç›®å¦‚æœæ˜¯ç”±äºæŠ€æœ¯åŸå› è€Œå¤±è´¥ï¼Œé€šå¸¸éƒ½æ˜¯å› ä¸ºè½¯ä»¶å¤æ‚åº¦å¤±æ§äº†ã€‚å¦‚æœå¤æ‚åº¦å¤±æ§ï¼Œé‚£ä¹ˆè½¯ä»¶å°±ä¼šå˜å¾—æç«¯å¤æ‚ï¼Œæ²¡æœ‰äººçŸ¥é“å®ƒèƒ½åšä»€ä¹ˆï¼Œå®ƒå‡ºäº†é—®é¢˜å¦‚ä½•è§£å†³ã€‚\n\n**ç®¡ç†å¤æ‚åº¦æ˜¯è½¯ä»¶å¼€å‘ä¸­æœ€ä¸ºé‡è¦çš„æŠ€æœ¯è¯é¢˜ã€‚**\n\nåœ¨è½¯ä»¶æ¶æ„å±‚æ¬¡ä¸Šï¼Œå¯ä»¥é€šè¿‡æŠŠå¤§çš„ç³»ç»Ÿåˆ†è§£ä¸ºå¤šä¸ªå­ç³»ç»Ÿæ¥é™ä½é—®é¢˜çš„å¤æ‚åº¦ï¼Œå¤šä¸ªç®€å•çš„é—®é¢˜æ¯”ä¸€ä¸ªå¤æ‚çš„å¤§é—®é¢˜æ›´å®¹æ˜“ç†è§£ã€‚\n\nå­ç³»ç»Ÿç›¸äº’é—´åº”è¯¥å‡å°‘ä¾èµ–ï¼›\nå­ç³»ç»Ÿçš„å…³æ³¨ç‚¹åº”è¯¥æ˜¯ç›¸äº’åˆ†ç¦»çš„ã€‚\n\n##### å¦‚ä½•åº”å¯¹å¤æ‚åº¦\n\n**é«˜ä»£ä»·ã€ä½æ•ˆç‡çš„è®¾è®¡æºäºä¸‹é¢ä¸‰ç§æ ¹æºï¼š**\n\n1. ç”¨å¤æ‚çš„æ–¹æ³•è§£å†³ç®€å•çš„é—®é¢˜\n2. ç”¨ç®€å•ä½†é”™è¯¯çš„æ–¹æ³•è§£å†³å¤æ‚çš„é—®é¢˜\n3. ç”¨ä¸æ°å½“çš„å¤æ‚çš„æ–¹æ³•è§£å†³å¤æ‚çš„é—®é¢˜\n\n**ç”¨ä¸‹é¢çš„æ–¹æ³•ç®¡ç†å¤æ‚åº¦**\n\n* æŠŠä»»ä½•äººåœ¨åŒä¸€æ—¶é—´éœ€è¦å¤„ç†çš„æœ¬è´¨å¤æ‚åº¦é™åˆ°æœ€ä½\n* ä¸è¦è®©å¶ç„¶æ€§çš„å¤æ‚åº¦æ— è°“çš„å¢é•¿\n\n#### ç†æƒ³çš„è®¾è®¡ç‰¹å¾\n\n* æœ€å°çš„å¤æ‚åº¦\n* æ˜“äºç»´æŠ¤\n* æ¾æ•£è€¦åˆ\n* å¯æ‰©å±•æ€§\n* å¯é‡ç”¨æ€§\n* é«˜æ‰‡å…¥ï¼šè®©å¤§é‡çš„ç±»ä½¿ç”¨æŸä¸ªç»™å®šçš„ç±»ã€‚ï¼ˆæ„å‘³ç€è®¾è®¡å‡ºçš„ç³»ç»Ÿå¾ˆå¥½çš„åˆ©ç”¨äº†åœ¨è¾ƒä½å±‚æ¬¡ä¸Šçš„å·¥å…·ç±»\n* ä½æ‰‡å‡ºï¼šè®©ä¸€ä¸ªç±»å°‘é‡æˆ–å§‹ç»ˆçš„ä½¿ç”¨å…¶ä»–ç±»ã€‚ï¼ˆé«˜æ‰‡å‡ºï¼ˆ7ä¸ªï¼‰æ„å‘³ç€ä¸€ä¸ªç±»è¿‡å¤šçš„ä½¿ç”¨äº†å…¶ä»–ç±»ï¼Œå¯èƒ½ä¼šå˜å¾—è¿‡äºå¤æ‚\n* å¯ç§»æ¤æ€§\n* ç²¾ç®€æ€§ï¼šæ²¡æœ‰å¤šä½™çš„éƒ¨åˆ†\n* å±‚æ¬¡æ€§ï¼šæ¯”å¦‚ä¸€ä¸ªæ–°ç³»ç»Ÿä¼šç”¨åˆ°å¾ˆå¤šè®¾è®¡ä¸ä½³çš„æ—§ç³»ç»Ÿï¼Œè¿™æ—¶å°±åº”è¯¥ä¸ºæ–°ç³»ç»Ÿç¼–å†™ä¸€ä¸ªè´Ÿè´£åŒå°±ä»£ç äº¤äº’çš„å±‚ï¼ˆä»£ç†æ¨¡å¼ï¼‰\n    * å±‚æ¬¡æ€§èƒ½æŠŠä½åŠ£çš„ä»£ç ç´§é—­èµ·æ¥\n    * å¦‚æœèƒ½æœ€ç»ˆæŠ›å¼ƒæˆ–é‡æ„æ—§ä»£ç ï¼Œæ—§ä¸å¿…ä¿®æ”¹å¤„äº¤äº’å±‚ä¹‹å¤–çš„ä»»ä½•æ–°ä»£ç ã€‚\n\n* æ ‡å‡†æŠ€æœ¯ï¼šç”¨åˆ°çš„å¤–æ¥çš„ã€å¤æ€ªçš„ä¸œè¥¿è¶Šå¤šï¼Œä¹Ÿè¶Šéš¾ç†è§£ã€‚\n\n#### è®¾è®¡çš„å±‚æ¬¡\n\n\n![è®¾è®¡çš„å±‚æ¬¡](http://media.gusibi.mobi/f_5cYtiP6KGYRSvnhNwgU0Oij5su1slnjVMk40DsRdmSvUJBJRdIhccBmgyWa5yW)\n\n\n##### 1. è½¯ä»¶ç³»ç»Ÿï¼ˆSoftware Systemï¼‰\n\n##### 2. åˆ†è§£ä¸ºå­ç³»ç»Ÿæˆ–åŒ…ï¼ˆDivision into Subsystems or Packagesï¼‰\n\nè¿™ä¸€å±‚çš„ä¸»è¦ç›®çš„æ˜¯ç¡®å®šå¦‚ä½•æŠŠç¨‹åºåˆ†ä¸ºä¸»è¦çš„å­ç³»ç»Ÿï¼Œå¹¶å®šä¹‰æ¸…æ¥šå…è®¸å„å­ç³»ç»Ÿå¦‚ä½•ä½¿ç”¨å…¶ä»–å­ç³»ç»Ÿã€‚\n\n> å¯¹äºä»»ä½•éœ€è¦å‡ å‘¨æ—¶é—´æ‰èƒ½å®Œæˆçš„é¡¹ç›®ï¼Œåœ¨è¿™ä¸€å±‚ä¸Šè¿›è¡Œåˆ’åˆ†éƒ½æ˜¯å¿…é¡»çš„ã€‚\n\nè¿™é‡Œæœ‰ä¸ªç‰¹åˆ«é‡è¦çš„ç‚¹ï¼Œå³ä¸åŒå­ç³»ç»Ÿä¹‹é—´ç›¸äº’é€šä¿¡çš„åŸåˆ™ã€‚å¦‚æœä¸åŒå­ç³»ç»Ÿé—´éƒ½å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œå°±å¤±å»äº†æ‹†åˆ†å­ç³»ç»Ÿçš„æ„ä¹‰ã€‚\n\n* å¦‚æœæ‹¿ä¸å‡†æ”¹å¦‚ä½•è®¾è®¡ï¼Œå°±åº”è¯¥å…ˆå¯¹å­ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡åŠ ä»¥é™åˆ¶ï¼Œç­‰ä»¥åéœ€è¦æ—¶å†æ”¾å¼€ã€‚\n* æœ‰ä¸€ä¸ªå¾ˆå¥½çš„åŸºæœ¬åŸåˆ™æ˜¯ï¼Œç¨‹åºä¹‹é—´ä¸åº”è¯¥æœ‰ç¯å½¢å…³ç³»ï¼Œæ¯”å¦‚Aç±»è°ƒç”¨Bç±»ï¼ŒBç±»è°ƒç”¨Cç±»ï¼ŒCç±»åˆè°ƒç”¨Aç±»è¿™ç§æƒ…å†µï¼Œç³»ç»Ÿè®¾è®¡ä¹Ÿåº”éµå®ˆè¿™ä¸ªåŸåˆ™\n\n###### ä¸€äº›å¸¸ç”¨çš„å­ç³»ç»Ÿ\n\n* ä¸šåŠ¡è§„åˆ™ï¼šè¿™ä¸ªæ˜¯æŒ‡å“ªäº›å†è®¡ç®—æœºç³»ç»Ÿä¸­ç¼–å…¥çš„è§„åˆ™ã€ç­–ç•¥ä»¥åŠè¿‡ç¨‹ã€‚æ¯”å¦‚å¼€å‘ä¸€ä¸ªè–ªèµ„ç³»ç»Ÿï¼Œå¯èƒ½å°±éœ€è¦æŠŠç¨åŠ¡å±€å…³äºå…è®¸ææ‰£çš„é‡‘é¢ä»¥åŠä¼°ç®—çš„ç¨ç‡ç¼–å†™åˆ°ç³»ç»Ÿä¸­ã€‚\n* ç”¨æˆ·ç•Œé¢ï¼šè¿™åº”è¯¥æ˜¯ä¸€ä¸ªå­ç³»ç»Ÿï¼ŒæŠŠç”¨æˆ·ç•Œé¢ç»„ä»¶åŒå…¶å®ƒç»„ä»¶éš”ç¦»å¼€ã€‚\n* æ•°æ®åº“è®¿é—®ï¼šéœ€è¦æŠŠæ•°æ®åº“çš„è®¿é—®ç»†èŠ‚éšè—èµ·æ¥ï¼Œè®©ç¨‹åºçš„ç»å¤§éƒ¨ä»½ä¸éœ€è¦å…³å¿ƒåº•å±‚å®ç°ç»†èŠ‚ã€‚\n* å¯¹ç³»ç»Ÿçš„ä¾èµ–æ€§ï¼šæŠŠå¯¹æ“ä½œç³»ç»Ÿçš„ä¾èµ–å› ç´ å½’ç±»åˆ°ä¸€ä¸ªå­ç³»ç»Ÿï¼Œå°±å¦‚åŒæŠŠå¯¹ç¡¬ä»¶çš„ä¾èµ–å› ç´ å°è£…èµ·æ¥ä¸€æ ·ã€‚\n    * è¿™é‡Œçš„æ“ä½œç³»ç»Ÿä¹Ÿå¯ä»¥æ˜¯å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚å¾®ä¿¡å°ç¨‹åºå¼€å‘ä¸­å¯¹å¾®ä¿¡çš„ä¾èµ–ã€‚\n\n##### 3. åˆ†è§£ä¸ºç±»ï¼ˆDivision into Classesï¼‰\n\nè¿™ä¸€å±‚æ¬¡ä¸Šçš„è®¾è®¡åŒ…æ‹¬è¯†åˆ«å‡ºç³»ç»Ÿä¸­æ‰€æœ‰çš„ç±»ã€‚ä¾‹å¦‚ï¼šæ•°æ®åº“æ¥å£å­ç³»ç»Ÿå¯èƒ½ä¼šåˆ†ä¸ºæ•°æ®åº“è®¿é—®ç±»ã€æŒä¹…åŒ–æ¡†æ¶ç±»ä»¥åŠæ•°æ®åº“å…ƒæ•°æ®ç±»ã€‚\n\n**ç±»ä¸å¯¹è±¡çš„æ¯”è¾ƒ**\n\n1. å¯¹è±¡æ˜¯æŒ‡è¿è¡ŒæœŸé—´åœ¨ç¨‹åºä¸­å®é™…å­˜åœ¨çš„å…·ä½“å®ä½“\n2. ç±»æ˜¯æŒ‡åœ¨ç¨‹åºæºç ä¸­å­˜åœ¨çš„é™æ€äº‹ç‰©\n\n##### 4. åˆ†è§£ä¸ºå­ç¨‹åºï¼ˆDivision into Routinesï¼‰\n\nå®Œæ•´çš„å®šä¹‰å‡ºç±»å†…éƒ¨çš„å­ç¨‹åºï¼Œå¸¸å¸¸ä¼šæœ‰åŠ©äºæ›´å¥½çš„ç†è§£ç±»çš„æ¥å£ï¼Œåè¿‡æ¥ä¹Ÿæœ‰åŠ©äºå¯¹ç±»çš„æ¥å£è¿›è¡Œè¿›ä¸€æ­¥çš„ä¿®æ”¹ã€‚\n\n> è¿™ä¸€å±‚çš„åˆ†è§£å’Œè®¾è®¡é€šå¸¸ç”±ç¨‹åºå‘˜ä¸ªäººæ¥å®Œæˆï¼Œå¯¹äºç”¨æ—¶è¶…è¿‡å‡ ä¸ªå°æ—¶çš„é¡¹ç›®å°±æœ‰åšçš„å¿…è¦äº†ã€‚\n\n##### 5. å­ç¨‹åºå†…éƒ¨çš„è®¾è®¡ï¼ˆInternal Routine Designï¼‰\n\n### è®¾è®¡æ„é€ å—ï¼šå¯å‘å¼æ–¹æ³•\n\n> ç”±äºè½¯ä»¶è®¾è®¡æ˜¯éç¡®å®šæ€§çš„ï¼Œå› æ­¤çµæ´»ç†Ÿç»ƒçš„è¿ç”¨ä¸€ç»„æœ‰æ•ˆçš„å¯å‘å¼æ–¹æ³•ï¼Œå°±æˆäº†ä¸€ä»¶ç‰¹åˆ«é‡è¦çš„å·¥ä½œ\n\n#### æ‰¾å‡ºç°å®ä¸–ç•Œä¸­çš„å¯¹è±¡\n\nåœ¨ç¡®å®šè®¾è®¡æ–¹æ¡ˆæ—¶ï¼Œé¦–é€‰ä¸”æœ€æµè¡Œçš„ä¸€ç§åšæ³•ä¾¿æ˜¯â€œå¸¸è§„çš„â€é¢å‘å¯¹è±¡è®¾è®¡æ–¹æ³•ï¼Œæ­¤æ–¹æ³•çš„è¦ç‚¹æ˜¯è¦é­å°¸ç°å®ä¸–ç•Œä¸­çš„å¯¹è±¡ä»¥åŠäººé€ çš„å¯¹è±¡ã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š\n\n1. ä¾¿æ˜¯å¯¹è±¡åŠå…¶å±æ€§\n2. ç¡®å®šå¯ä»¥å¯¹å„ä¸ªå¯¹è±¡è¿›è¡Œçš„æ“ä½œ\n3. ç¡®å®šå„ä¸ªå¯¹è±¡èƒ½å¯¹å…¶ä»–å¯¹è±¡è¿›è¡Œçš„æ“ä½œ\n4. ç¡®å®šå¯¹è±¡çš„å“ªäº›éƒ¨åˆ†å¯¹å…¶ä»–å¯¹è±¡å¯è§--å“ªäº›éƒ¨åˆ†å¯ä»¥æ˜¯å…¬ç”¨çš„ï¼Œå“ªäº›éƒ¨åˆ†åº”è¯¥æ˜¯ç§ç”¨çš„ã€‚\n5. å®šä¹‰æ¯ä¸ªå¯¹è±¡çš„å…¬å¼€æ¥å£\n\n\nç»è¿‡ä¸Šè¿°æ­¥éª¤å¾—åˆ°ä¸€ä¸ªé«˜å±‚æ¬¡çš„ã€é¢å‘å¯¹è±¡çš„ç³»ç»Ÿç»„ç»‡ç»“æ„ä¹‹åï¼Œä½ å¯ä»¥ç”¨è¿™ä¸¤ç§æ–¹å¼æ¥è¿­ä»£ï¼›åœ¨é«˜å±‚æ¬¡çš„ç³»ç»Ÿç»„ç»‡ç»“æ„ä¸Šè¿›è¡Œè¿­ä»£ï¼Œä»¥ä¾¿æ›´å¥½çš„ç»„ç»‡ç±»çš„ç»“æ„ï¼›æˆ–è€…åœ¨æ¯ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„ç±»ä¸Šè¿›è¡Œè¿­ä»£ï¼ŒæŠŠæ¯ä¸ªç±»çš„è®¾è®¡ç»†åŒ–ã€‚\n\n#### å½¢æˆä¸€è‡´çš„æŠ½è±¡\n\næŠ½è±¡æ˜¯ä¸€ä¸ªèƒ½è®©ä½ åœ¨å…³æ³¨æŸä¸€æ¦‚å¿µçš„åŒæ—¶å¯ä»¥æ”¾å¿ƒçš„å¿½ç•¥å…¶ä¸­ä¸€äº›ç»†èŠ‚çš„èƒ½åŠ›---åœ¨ä¸åŒçš„å±‚æ¬¡ä¸Šå¤„ç†ä¸åŒçš„ç»†èŠ‚ã€‚\n\n> ä»¥å¤æ‚åº¦çš„è§‚ç‚¹çœ‹ï¼ŒæŠ½è±¡çš„ä¸»è¦å¥½å¤„å°±åœ¨äºå®ƒä½¿ä½ èƒ½å¿½ç•¥ç›¸å…³çš„ç»†èŠ‚ã€‚\n\nå¥½çš„è®¾è®¡ä¼šåœ¨å­ç¨‹åºæ¥å£çš„å±‚æ¬¡ä¸Šã€åœ¨ç±»æ¥å£çš„å±‚æ¬¡ä¸Šä»¥åŠåŒ…æ¥å£çš„å±‚æ¬¡ä¸Šï¼ˆåœ¨é—¨æŠŠæ‰‹ä¸Šã€é—¨çš„å±‚æ¬¡ä¸Šä»¥åŠæˆ¿å±‹çš„å±‚æ¬¡ä¸Šï¼‰è¿›è¡ŒæŠ½è±¡ã€‚\n\n#### å°è£…å®ç°ç»†èŠ‚\n\næŠ½è±¡æ˜¯è¯´â€œè®©ä½ ä»é«˜å±‚çš„ç»†èŠ‚æ¥çœ‹å¾…ä¸€ä¸ªå¯¹è±¡â€ï¼Œè€Œå°è£…åˆ™è¯´ï¼šâ€œåˆæ¬¡ä¹‹å¤–ï¼Œä½ ä¸èƒ½çœ‹åˆ°å¯¹è±¡çš„ä»»ä½•å…¶ä»–ç»†èŠ‚å±‚æ¬¡â€ã€‚\n\n> å°è£…ç®¡ç†å¤æ‚åº¦çš„æ–¹å¼æ˜¯ä¸è®©ä½ çœ‹åˆ°é‚£äº›å¤æ‚åº¦ã€‚\n\n#### å½“ç»§æ‰¿èƒ½ç®€åŒ–è®¾è®¡æ—¶å°±ç»§æ‰¿\n\nç»§æ‰¿èƒ½ç®€åŒ–ç¼–ç¨‹å·¥ä½œ\n\n#### éšè—ç§˜å¯†ï¼ˆä¿¡æ¯éšè—ï¼‰\n\nä¿¡æ¯éšè—æ˜¯ç»“æ„åŒ–ç¨‹åºè®¾è®¡ä¸é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºç¡€ä¹‹ä¸€ã€‚\n\n##### ç§˜å¯†å’Œéšç§æƒ\n\nåœ¨è®¾è®¡ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œä¸€é¡¹å…³é”®æ€§çš„å†³ç­–å°±æ˜¯ç¡®å®šç±»çš„é‚£äº›ç‰¹æ€§åº”è¯¥å¯¹å¤–å¯è§ï¼Œå“ªäº›åº”è¯¥è¢«éšè—èµ·æ¥ã€‚\nç±»çš„æ¥å£åº”è¯¥å°½å¯èƒ½å°‘çš„æš´éœ²å…¶å†…éƒ¨å·¥ä½œæœºåˆ¶ã€‚\n\n\n![å¥½çš„ç±»æ¥å£å°±åƒæ˜¯å†°å±±çš„å°–ä¸€æ ·ï¼Œè®©å¤§éƒ¨åˆ†å†…å®¹éƒ½ä¸æš´éœ²å‡ºæ¥](http://media.gusibi.mobi/EI-c5Qdo2Wr453L_jakhC222GtL7R7PUYSpzq4EceNkSBtXhzTyIQ039yQHmBY8J)\n\n##### ä¿¡æ¯éšè—çš„ä¸€ä¸ªä¾‹å­\n\næ¯”å¦‚æœ‰ä¸€ä¸ªç¨‹åºï¼Œæ²¡ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåä¸ºidçš„æˆå‘˜å˜é‡æ¥ä¿å­˜å”¯ä¸€çš„IDã€‚\n\n1. ä¸€ç§è®¾è®¡æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªæ•´æ•°æ¥è¡¨ç¤ºIDï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªåä¸º max_id çš„å…¨å±€å˜é‡æ¥ä¿å­˜å½“å‰çš„æœ€å¤§å€¼ï¼Œæ–°çš„id ä½¿ç”¨ ++max_id æ¥ç”Ÿæˆã€‚è¿™ç§è®¾è®¡æ˜¯ä¸åˆé€‚çš„è®¾è®¡\n    - ä¸æ˜¯çº¿ç¨‹å®‰å…¨\n    - ++max_id å¯èƒ½éå¸ƒä»£ç çš„å„ä¸ªä½ç½®ï¼Œä¿®æ”¹id çš„ç”Ÿæˆè§„åˆ™éœ€è¦æ”¹åŠ¨å¤ªå¤§\n2. ä¸€ä¸ªå¥½çš„è®¾è®¡æ–¹å¼æ˜¯ï¼Œä½¿ç”¨ä¸€ä¸ªNewId() æ–¹æ³•æ¥ç”Ÿæˆidï¼Œå…·ä½“çš„å®ç°é€»è¾‘åœ¨ NewId() æ–¹æ³•ä¸­ï¼Œid çš„ç±»å‹ä¹Ÿä½¿ç”¨è‡ªå®šä¹‰çš„ IdType ç±»å‹ï¼Œè€Œä¸æ˜¯æŒ‡å®š int ç±»å‹ã€‚\n\n\n##### ä¸¤ç§ç§˜å¯†\n\nä¿¡æ¯éšè—ä¸­æ‰€è¯´çš„ç§˜å¯†ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š\n\n* éšè—å¤æ‚åº¦ï¼Œè¿™æ ·ä½ å°±ä¸ç”¨å†å»åº”ä»˜å®ƒï¼Œé™¤éä½ è¦ç‰¹åˆ«å…³æ³¨çš„æ—¶å€™\n* éšè—å˜åŒ–æºï¼Œè¿™æ ·å½“å˜åŒ–å‘ç”Ÿæ—¶ï¼Œå…¶å½±å“å°±èƒ½è¢«é™åˆ¶åœ¨å±€éƒ¨èŒƒå›´å†…ã€‚\n\n##### ä¿¡æ¯éšè—çš„éšœç¢\n\nå°‘æ•°æƒ…å†µä¸‹ï¼Œä¿¡æ¯éšè—ä¼šå˜çš„ä¸å¯èƒ½ï¼Œé€šå¸¸è¿™ç§æƒ…å†µæ˜¯ç”±ä»¥ä¸‹éšœç¢é€ æˆçš„ï¼š\n\n* ä¿¡æ¯è¿‡åº¦åˆ†æ•£ æ¯”å¦‚ä¸€ä¸ªå˜é‡ æ•°å­—`42`è¢«å†™å…¥äº†ä»£ç ä¸­ï¼ˆå†™æ­»äº†ï¼‰ï¼Œè¿™æ ·å°±ä¼šé€ æˆå¯¹å®ƒçš„å¼•ç”¨è¿‡äºåˆ†æ•£ã€‚æœ€å¥½æ˜¯æŠŠè¿™ä¸ªä¿¡æ¯éšè—èµ·æ¥ï¼Œæ¯”å¦‚å†™å…¥å¸¸é‡ä¸­ï¼šTHE_ANSWER = 42ï¼Œä»£ç ä¸­ä½¿ç”¨çš„æ—¶å€™å¼•ç”¨ THE_ANSWER è¿™ä¸ªå¸¸é‡å°±å¯ä»¥äº†ã€‚\n* å¾ªç¯ä¾èµ–ï¼šæ¯”å¦‚ A ç±»çš„å­ç¨‹åºå¼•ç”¨äº†B ç±»ä¸­çš„å­ç¨‹åºï¼Œè€ŒBç±»ä¸­çš„å­ç¨‹åºåˆå¼•ç”¨äº†A ç±»ä¸­çš„å­ç¨‹åºã€‚è¿™æ ·ä¼šé€ æˆéš¾ä»¥æµ‹è¯•ï¼Œéœ€è¦ä¿è¯ä¸¤ä¸ªç±»éƒ½æ­£å¸¸æ‰å¯ä»¥ã€‚\n* ç±»å†…æ•°æ®è®¾ç½®æˆäº†å…¨å±€æ•°æ®ï¼šä½¿ç”¨å…¨å±€æ•°æ®é€šå¸¸ä¼šé‡åˆ°ä¸¤ä¸ªé—®é¢˜ï¼šä¸€ç§æ˜¯å­ç¨‹åºæ‰§è¡Œæ—¶å¯èƒ½æœ‰å¦ä¸€ä¸ªå­ç¨‹åºä¹Ÿå¯¹å®ƒè¿›è¡Œäº†æ“ä½œï¼Œå¦ä¸€ç§æ˜¯å­ç¨‹åºçŸ¥é“æœ‰å…¶ä»–å­ç¨‹åºåœ¨ä½¿ç”¨ä½†ä¸çŸ¥é“å…·ä½“æ˜¯å“ªä¸ªã€‚è¿™æ—¶åº”è¯¥ä½¿ç”¨åªæœ‰å°‘æ•°å­ç±»å¯è®¿é—®çš„ç±»å†…æ•°æ®ã€‚\n* å¯ä»¥å¯Ÿè§‰çš„æ€§èƒ½æŸè€—ï¼šæœ‰çš„å¼€å‘è€…ä¸ºäº†å‡å°‘è°ƒç”¨å…³ç³»è¯•å›¾åœ¨ç³»ç»Ÿæ¶æ„å±‚å’Œç¼–ç å±‚è¿›è¡Œä¼˜åŒ–ã€‚è®¤ä¸ºé¢å¤–çš„å±‚æ¬¡è°ƒç”¨ä¼šå½±å“æ€§èƒ½ï¼ˆäº‹å®ä¸Šè¿™ç§æ‹…å¿ƒå¯èƒ½å¤ªæ—©äº†ï¼Œç­‰ä»¥åé‡åˆ°é—®é¢˜å†ä¼˜åŒ–æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼‰ã€‚\n\n##### ä¿¡æ¯éšè—çš„ä»·å€¼\n\n> ä¿¡æ¯éšè—æ˜¯å°‘æ•°å‡ ä¸ªå¾—åˆ°å…¬è®¤çš„ã€åœ¨å®è·µä¸­è¯æ˜äº†å…¶è‡ªèº«ä»·å€¼çš„ç†è®ºæŠ€æœ¯ã€å¹¶ä¸”å·²ç»æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼ˆBoehm 1987aï¼‰ã€‚\n\n1. å¤§å‹é¡¹ç›®ä¿®æ”¹èµ·æ¥æ›´å®¹æ˜“\n2. æœ‰åŠ©äºå…¬å¼€æ¥å£çš„è®¾è®¡ï¼ˆä½¿å¼€å‘è€…æ›´å®¹æ˜“ç†è§£ä»€ä¹ˆæ ·çš„æ•°æ®åº”è¯¥éšè—ã€ä»€ä¹ˆæ ·çš„æ•°æ®åº”è¯¥å…¬å¼€\n\n#### æ‰¾å‡ºå®¹æ˜“æ”¹å˜çš„åŒºåŸŸ\n\n> å¯¹ä¼˜ç§€çš„è®¾è®¡å¸ˆçš„ä¸€ä»½ç ”ç©¶è¡¨æ˜ï¼Œä»–ä»¬æ‰€å…±æœ‰çš„ä¸€é¡¹ç‰¹è´¨å°±æ˜¯éƒ½æœ‰å¯¹å˜åŒ–çš„é¢„æœŸèƒ½åŠ›ï¼ˆGlass 1995ï¼‰\n> çœ‹èµ·æ¥éå¸¸å¯ä¿¡\n\nä»¥ä¸‹æ˜¯åº”å¯¹å˜åŠ¨çš„æªæ–½ï¼š\n\n1. æ‰¾å‡ºçœ‹èµ·æ¥å®¹æ˜“å˜åŒ–çš„é¡¹ç›®\n2. æŠŠå®¹æ˜“å˜åŒ–çš„é¡¹ç›®åˆ†ç¦»å‡ºæ¥\n3. æŠŠçœ‹èµ·æ¥å®¹æ˜“å˜åŒ–çš„é¡¹ç›®éš”ç¦»å‡ºæ¥ã€‚\n\nä»¥ä¸‹æ˜¯å®¹æ˜“å˜åŒ–çš„åŒºåŸŸï¼š\n\n1. ä¸šåŠ¡è§„åˆ™\n2. å¯¹ç¡¬ä»¶çš„ä¾èµ–æ€§ï¼šå±å¹•ï¼Œæ‰“å°æœºã€é”®ç›˜ã€é¼ æ ‡ç­‰è®¾å¤‡ä¹‹é—´çš„æ¥å£\n3. è¾“å…¥å’Œè¾“å‡º\n4. éæ ‡å‡†çš„è¯­è¨€ç‰¹æ€§\n5. å›°éš¾çš„è®¾è®¡åŒºåŸŸå’Œæ„å»ºåŒºåŸŸ\n6. çŠ¶æ€å˜é‡ï¼šå¯ä»¥åœ¨ä½¿ç”¨çŠ¶æ€å˜é‡æ˜¯å¢åŠ è‡³å°‘ä¸¤å±‚çš„çµæ´»æ€§å’Œå¯è¯»æ€§\n  - ä¸è¦ä½¿ç”¨å¸ƒå°”å˜é‡ä½œä¸ºçŠ¶æ€å˜é‡\n  - ä½¿ç”¨é˜²èšŠå™¨å­ç¨‹åºå–ä»£å¯¹çŠ¶æ€å˜é‡çš„ç›´æ¥æ£€æŸ¥\n7. æ•°æ®é‡çš„é™åˆ¶ï¼šå½“ä½ å®šä¹‰äº†ä¸€ä¸ªå…·æœ‰100ä¸ªå…ƒç´ æ•°æ®çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¹Ÿå‘å¤–ç•Œé€éœ²äº†ä¸€äº›ä¸å¿…è¦çš„ä¿¡æ¯ã€‚ç”¨å…¨å±€å˜é‡ä»£æ›¿100 æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚\n\n**é¢„æ–™ä¸åŒç¨‹åº¦çš„å˜åŒ–**\n\nå½“è€ƒè™‘ç³»ç»Ÿçš„æ½œåœ¨å˜åŒ–æ—¶ï¼Œä½ è®¤ä¸ºè¶Šæœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–çš„åŒºåŸŸï¼Œè¶Šè¦åšå¥½åº”å¯¹å˜åŒ–çš„å‡†å¤‡ã€‚\næ‰¾å‡ºå®¹æ˜“å˜åŒ–çš„åŒºåŸŸçš„ä¸€ä¸ªå¥½çš„åŠæ³•æ˜¯ï¼šå—é™æ‰¾å‡ºç¨‹åºä¸­å¯èƒ½å¯¹ç”¨æˆ·æœ‰ç”¨çš„æœ€å°å­é›†ã€‚è¿™ä¸€å­é›†æ„æˆäº†ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œä¸å®¹æ˜“å˜åŒ–ï¼Œç„¶åæ‰©å……ç³»ç»Ÿã€‚\n> `é€šè¿‡é¦–å…ˆå®šä¹‰æ¸…æ¥šæ ¸å¿ƒï¼Œæ¥è®¤æ¸…å“ªäº›ç»„ä»¶æ˜¯é™„å±åŠŸèƒ½ï¼Œè¿™æ—¶å°±å®¹æ˜“æŠŠå®ƒä»¬æå–å‡ºæ¥ï¼Œå¹¶ä¸”è¿™äº›å†…å®¹ä¹Ÿå®¹æ˜“æ”¹è¿›ä¼˜åŒ–ã€‚`\n\n#### ä¿æŒæ¾æ•£è€¦åˆ\n\næ¨¡å—ä¹‹é—´å¥½çš„è€¦åˆå…³ç³»ä¼šæ¾æ•£åˆ°æ°å¥½èƒ½ä½¿ä¸€ä¸ªæ¨¡å—èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚\n> è¯·å°½é‡ä½¿ä½ åˆ›å»ºçš„æ¨¡å—ä¸ä¾èµ–æˆ–è€…å¾ˆå°‘ä¾èµ–å…¶ä»–æ¨¡å—ã€‚\n> å¦‚æœæ¨¡å—æ˜¯å¾®æœåŠ¡ä¸­çš„ä¸€ä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆä¸€ä¸ªå¥½çš„è€¦åˆå…³ç³»æ˜¯ä¸€ä¸ªæœåŠ¡å¯ä»¥åœ¨å…¶å®ƒæœåŠ¡æŒ‚æ‰çš„æƒ…å†µä¸‹å¯ä»¥æ­£å¸¸æä¾›åŸºç¡€æœåŠ¡ã€‚\n\n##### è€¦åˆæ ‡å‡†\n\n* è§„æ¨¡ï¼šè¿™é‡Œçš„è§„æ¨¡æŒ‡çš„æ˜¯æ¨¡å—ä¹‹é—´çš„è¿æ¥æ•°ã€‚å¯¹äºè€¦åˆåº¦æ¥è¯´ï¼Œå°å°±æ˜¯ç¾ã€‚\n* å¯è§æ€§ï¼šå¯è§æ€§æŒ‡çš„æ˜¯ä¸¤ä¸ªæ¨¡å—ä¹‹é—´çš„è¿æ¥æ˜¾è‘—ç¨‹åº¦ã€‚é€šè¿‡å‚æ•°ä¼ é€’æ•°æ®æ˜¯ä¸€ç§æ˜æ˜¾çš„è¿æ¥ï¼Œå€¼å¾—æå€¡ï¼Œè€Œé€šè¿‡ä¿®æ”¹å…¨å±€æ•°æ®è€Œä½¿å¦ä¸€æ¨¡å—èƒ½å¤Ÿä½¿ç”¨è¯¥æ•°æ®åˆ™æ˜¯ä¸€ç§ é¬¼é¬¼ç¥Ÿç¥Ÿçš„åšæ³•ï¼Œä¸å€¼å¾—æå€¡ã€‚\n* çµæ´»æ€§ï¼šçµæ´»æ€§æŒ‡çš„æ˜¯æ¨¡å—ä¹‹é—´çš„è¿æ¥æ˜¯å¦å®¹æ˜“æ”¹åŠ¨ã€‚æ¨¡å—è¶Šçµæ´»ï¼Œè¶Šå®¹æ˜“è¢«å…¶å®ƒæ¨¡å—è°ƒç”¨ï¼ˆè€¦åˆè¶Šæ¾æ•£ï¼‰è¶Šå¥½ã€‚\n\n##### è€¦åˆçš„ç§ç±»\n\n* ç®€å•æ•°æ®å‚æ•°è€¦åˆï¼Œä¸¤ä¸ªæ¨¡å—ä¹‹é—´é€šè¿‡å‚æ•°ä¼ é€’æ•°æ®ï¼Œè¿™ç§è€¦åˆå…³ç³»æ­£å¸¸ï¼Œå¯ä»¥æ¥å—\n* ç®€å•å¯¹è±¡è€¦åˆï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„è€¦åˆå…³ç³»å°±æ˜¯ç®€å•å¯¹è±¡è€¦åˆã€‚è¿™ç§è€¦åˆå…³ç³»ä¹Ÿèƒ½æ¥å—\n* å¯¹è±¡è€¦åˆ å¦‚æœobject1 è¦æ±‚object2ä¼ é€’ç»™ä»–ä¸€ä¸ªobject3ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ¨¡å—å°±æ˜¯å¯¹è±¡å‚æ•°è€¦åˆã€‚è¿™ç§è€¦åˆæ›´ç´§å¯†ï¼Œå› ä¸ºå®ƒè¦æ±‚object1 äº†è§£object3ã€‚\n* è¯­ä¹‰è€¦åˆï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—ä¸ä»…ä½¿ç”¨äº†å¦ä¸€æ¨¡å—çš„è¯­æ³•å…ƒç´ ï¼Œè€Œä¸”è¿˜æ˜¯ç”¨äº†é‚£ä¸ªæ¨¡å—å†…éƒ¨å·¥ä½œç»†èŠ‚çš„è¯­ä¹‰çŸ¥è¯†ã€‚è¿™ç§è€¦åˆå°±éå¸¸å±é™©ï¼Œå› ä¸ºæ›´æ”¹è¢«è°ƒç”¨æ¨¡å—ï¼Œä¼šå½±å“è°ƒç”¨è€…ã€‚\n\n#### æŸ¥é˜…å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼\n\nè®¾è®¡æ¨¡å¼å…¶å®æ˜¯ä¸€äº›ç°æˆç²¾ç‚¼çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ç”¨äºè§£å†³å¾ˆå¤šè½¯ä»¶å¼€å‘ä¸­å¸¸è§çš„é—®é¢˜ã€‚\n\nè®¾è®¡æ¨¡å¼æä¾›äº†å¦‚ä¸‹å¥½å¤„ï¼š\n\n1. è®¾è®¡æ¨¡å¼é€šè¿‡æä¾›ç°æˆçš„æŠ½è±¡æ¥å‡å°‘å¤æ‚åº¦\n2. è®¾è®¡æ¨¡å¼é€šè¿‡æŠŠå¸¸è§è§£å†³æ–¹æ¡ˆçš„ç»†èŠ‚äºˆä»¥åˆ¶åº¦åŒ–æ¥å‡å°‘å‡ºé”™\n3. è®¾è®¡æ¨¡å¼é€šè¿‡æä¾›å¤šç§è®¾è®¡æ–¹æ¡ˆå„¿å¸¦æ¥å¯å‘æ€§çš„ä»·å€¼ã€‚\n4. è®¾è®¡æ¨¡å¼é€šè¿‡æŠŠè®¾è®¡å¯¹è¯æå‡åˆ°ä¸€ä¸ªæ›´é«˜çš„å±‚æ¬¡ä¸Šæ¥ç®€åŒ–äº¤æµã€‚æ¯”å¦‚ä½ å’Œå…¶å®ƒå¼€å‘è€…è®¨è®ºé—®é¢˜æ—¶è¯´ï¼šæˆ‘ç”¨æ¥Factory Methodã€‚å…¶å®å·²ç»ä¼ é€’äº†å¾ˆå¤šæœ‰æ•ˆä¿¡æ¯ã€‚\n\nå¸¸è§çš„è®¾è®¡æ¨¡å¼è¯·å‚è€ƒç™¾ç§‘ä»‹ç»ï¼š[è®¾è®¡æ¨¡å¼ ï¼ˆè®¾è®¡æ¨¡å¼æ¦‚å¿µï¼‰](https://baike.baidu.com/item/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/1212549)\n\n[å¸¸ç”¨è®¾è®¡æ¨¡å¼Pythonå®ç°](https://mp.weixin.qq.com/mp/homepage?__biz=MzAwNjI5MjAzNw==&hid=2&sn=c32f7371e7df2e2282e2bdba080aa9c2)\n\n\n#### å…¶å®ƒçš„å¯å‘å¼æ–¹æ³•\n\n* é«˜å†…èšæ€§\n* æ„é€ åˆ†å±‚ç»“æ„\n* ä¸¥æ ¼æè¿°ç±»å¥‘çº¦\n    - æŠŠæ²¡ä¸ªç±»çš„æ¥å£çœ‹ä½œæ˜¯ä¸ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†ä¹‹é—´çš„ä¸€é¡¹å¥‘çº¦ä¼šæ›´æœ‰åŠ©äºæ›´å¥½çš„æ´å¯Ÿç¨‹åºã€‚è¿™ç§å¥‘çº¦ç±»ä¼¼äºâ€œå¦‚æœä½ æ‰¿è¯ºæä¾›æ•°æ®xã€y å’Œ zï¼Œå¹¶ä¸”ç­”åº”è®©è¿™äº›æ•°æ®å…·æœ‰ç‰¹å¾ aã€b å’Œ cï¼Œæˆ‘å°±æ‰¿è¯ºåŸºäºçº¦æŸ8ã€9å’Œ10æ¥æ‰§è¡Œæ“ä½œ1ã€2å’Œ3\n* åˆ†é…èŒè´£\n* ä¸ºæµ‹è¯•è€Œè®¾è®¡\n    - å¦‚æœä¸ºäº†ä¾¿äºæµ‹è¯•å„¿è®¾è®¡è¿™ä¸ªç³»ç»Ÿï¼Œé‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ\n* é¿å…å¤±è¯¯\n* æœ‰æ„è¯†çš„ç»‘å®šæ—¶é—´\n    - ç»‘å®šæ—¶é—´æ˜¯æŒ‡çš„æ˜¯å§ç‰¹å®šçš„å€¼ç»‘å®šåˆ°æŸä¸€å˜é‡çš„æ—¶é—´ã€‚æ—©ç»‘å®šä¼šæ¯”è¾ƒç®€å•ä½†ä¸çµæ´»\n* åˆ›å»ºä¸­å¤®æ§åˆ¶ç‚¹\n    - å”¯ä¸€ä¸€ä¸ªæ­£ç¡®ä½ç½®çš„åŸåˆ™ï¼šä¸ºäº†æ‰¾åˆ°æŸä¸ªäº‹ç‰©ï¼Œéœ€è¦æŸ¥æ‰¾çš„åœ°æ–¹è¶Šå°‘ï¼Œè¯¥èµ·æ¥å°±è¶Šå®¹æ˜“è¶Šç®€å•\n* è€ƒè™‘ä½¿ç”¨è›®åŠ›çªç ´\n    - ä¸€ä¸ªå¯è¡Œçš„è›®åŠ›è§£å†³æ–¹æ¡ˆè¦å¥½äºä¸€ä¸ªä¼˜é›…ä½†ä¸èƒ½ç”¨çš„è§£å†³æ–¹æ¡ˆ\n* ç”»ä¸€ä¸ªå›¾\n    - ä¸€å¹…å›¾é¡¶çš„ä¸Šä¸€åƒå¥è¯--é²è¿…è¯´çš„ã€‚\n* ä¿æŒè®¾è®¡çš„æ¨¡å—åŒ–\n\n#### ä½¿ç”¨å¯å‘æ–¹å¼çš„åŸåˆ™\n\n1. ç†è§£é—®é¢˜\n2. è®¾è®¡ä¸€ä¸ªè®¡åˆ’ã€‚æ‰¾å‡ºç°æœ‰æ•°æ®å’ŒæœªçŸ¥é‡ä¹‹é—´çš„è”ç³»ã€‚\n3. æ‰§è¡Œè¿™ä¸€è®¡åˆ’\n4. å›é¡¾ã€‚æ£€è§†æ•´ä¸ªè§£å†³æ–¹æ¡ˆã€‚\n\n### è®¾è®¡å®è·µ\n\n#### è¿­ä»£ï¼ˆIterateï¼‰\n\nè®¾è®¡æ˜¯ä¸ªè¿­ä»£çš„è¿‡ç¨‹ï¼Œå¹¶éåªæ˜¯ä»Aç‚¹åˆ°Bç‚¹ï¼Œä¹Ÿå¯ä»¥ä»Aç‚¹åˆ°Bç‚¹ï¼Œå†ä»Bç‚¹åˆ°Aç‚¹ã€‚åœ¨è®¾è®¡æ–¹æ¡ˆä¸­å°è¯•ä¸åŒçš„åšæ³•æ—¶ï¼Œä¼šåŒæ—¶ä»ä¸åŒå±‚æ¬¡å–å®¡è§†é—®é¢˜ã€‚æ›´æœ‰åŠ©äºæ‰¾å‡ºç›¸å…³ç»†èŠ‚ã€‚\n\n> å½“ä½ é¦–æ¬¡å°è¯•å¾—å‡ºä¸€ä¸ªçœ‹ä¸Šå»è¶³å¤Ÿå¥½çš„è®¾è®¡æ–¹æ¡ˆåï¼Œä¸è¦åœä¸‹æ¥ï¼Œç¬¬äºŒæ¬¡å°è¯•è‚¯å®šä¼šå¥½äºç¬¬ä¸€ä¸ªã€‚\n\n#### åˆ†è€Œæ²»ä¹‹ï¼ˆDivide and Conquerï¼‰\n\næ²¡æœ‰äººçš„å¤´è„‘èƒ½å¤§åˆ°è£…ä¸‹ä¸€ä¸ªå¤æ‚ç¨‹åºçš„å…¨éƒ¨ç»†èŠ‚-- Edsger Dijkstra\n\n#### è‡ªä¸Šè€Œä¸‹å’Œè‡ªä¸‹è€Œä¸Šçš„è®¾è®¡æ–¹æ³•\n\nè‡ªä¸Šè€Œä¸‹å’Œè‡ªä¸‹è€Œä¸Šç­–ç•¥æœ€å…³é”®çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…æ˜¯ä¸€ç§åˆ†è§£ï¼ˆdecompositionï¼‰ç­–ç•¥è€Œåè€…æ˜¯ä¸€ç§åˆæˆï¼ˆcompositionï¼‰ç­–ç•¥ã€‚\n\n* è‡ªä¸Šè€Œä¸‹çš„è®¾è®¡å¾ˆç®€å•ï¼Œå› ä¸ºäººä»¬å–„äºæŠŠä¸€äº›å¤§çš„äº‹ç‰©åˆ†è§£æˆå°çš„ç»„ä»¶ã€‚\n* è‡ªä¸Šè€Œä¸‹å¦ä¸€ä¸ªå¼ºé¡¹æ˜¯å¯ä»¥æ¨è¿Ÿæ„å»ºçš„ç»†èŠ‚\n* è‡ªä¸‹è€Œä¸Šçš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯é€šå¸¸èƒ½å¤Ÿç„¦èºçš„æ‰¾å‡ºæ‰€éœ€çš„åŠŸèƒ½ï¼Œä»è€Œå¸¦æ¥ç´§å‡‘åˆç†çš„è®¾è®¡\n* è‡ªä¸‹è€Œä¸Šçš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å¾ˆéš¾å®Œå…¨ç‹¬ç«‹çš„ä½¿ç”¨å®ƒã€‚å¤§å¤šæ•°äººæ“…é•¿æŠŠå¤§çš„æ¦‚å¿µåˆ†è§£æˆå°æ¦‚å¿µï¼Œè€Œä¸æ“…é•¿ä»å°æ¦‚å¿µä¸­å¾—å‡ºå¤§çš„æ¦‚å¿µã€‚\n* è‡ªä¸‹è€Œä¸Šè®¾è®¡çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œæœ‰æ—¶å€™ä¼šå‘ç°è‡ªå·±æ— æ³•ä½¿ç”¨æ‰‹å¤´å·²æœ‰çš„é›¶ä»¶æ¥æ„å»ºæ•´ä¸ªç³»ç»Ÿã€‚\n* è‡ªä¸Šè€Œä¸‹å’Œè‡ªä¸‹è€Œä¸Šè®¾è®¡å¹¶ä¸äº’æ–¥ï¼Œä¸¤è€…å¯ä»¥åä½œã€‚\n\n> è®¾è®¡æ˜¯ä¸€ä¸ªå¯å‘å¼çš„è¿‡ç¨‹ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ¡ˆèƒ½ä¿è¯ä¸‡æ— ä¸€å¤±ï¼Œéœ€è¦åœ¨è®¾è®¡çš„è¿‡ç¨‹ä¸­éœ€è¦ä¸åœçš„è¿­ä»£ï¼Œæ”¹è¿›ã€‚éœ€è¦å¤šå°è¯•æ¥æ‰¾å‡ºæœ€ä½³æ–¹æ¡ˆã€‚\n\n#### å»ºç«‹è¯•éªŒæ€§åŸå‹\n\næœ‰äº›æ—¶å€™ï¼Œåˆ¤æ–­ä¸€ç§è®¾è®¡æ˜¯å¦åˆé€‚ï¼Œåªæœ‰ç”¨è¿‡æ‰èƒ½çŸ¥é“ã€‚åˆ›å»ºä¸€ä¸ªè¯•éªŒæ€§åŸå‹ï¼ˆå†™å‡ºç”¨äºå›ç­”ç‰¹å®šè®¾è®¡é—®é¢˜ã€é‡æœ€å°‘ä¸”èƒ½å¤Ÿéšæ—¶æ‰”æ‰çš„ä»£ç ï¼‰ï¼Œæ¥éªŒè¯è®¾è®¡çš„å¯è¡Œæ€§ï¼Œé€šå¸¸å¯ä»¥æ‰¾å‡ºè®¾è®¡ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠéœ€è¦æ”¹è¿›çš„æ–¹å‘ã€‚\n\n#### åˆä½œè®¾è®¡\n\nä¸‰ä¸ªè‡­çš®åŒ ï¼Œé¡¶ä¸ªè¯¸è‘›äº®ã€‚\n\n1. éšä¾¿æ‰¾ä¸ªåŒäº‹ï¼Œå‘ä»–å¾æ±‚æ„è§\n2. ååœ¨ä¼šè®®å®¤ï¼Œåœ¨ç™½æ¿ä¸Šç”»å‡ºå¯é€‰è®¾è®¡æ–¹æ¡ˆ\n3. ç»“å¯¹ç¼–ç¨‹\n4. å’Œå¤šååŒäº‹ä¸€èµ·è¿‡è®¾è®¡æƒ³æ³•\n\n#### è¦åšå¤šå°‘è®¾è®¡æ‰å¤Ÿ\n\nå¯¹äºæ­£å¼ç¼–ç å‰çš„è®¾è®¡å·¥ä½œé‡å’Œè®¾è®¡æ–‡æ¡£çš„æ­£è§„ç¨‹åº¦ï¼Œå¾ˆéš¾æœ‰ä¸ªå‡†ç¡®çš„å®šè®ºã€‚ä¸‹å›¾æ€»ç»“äº†è®¾è®¡æ–‡æ¡£çš„æ­£è§„åŒ–ä»¥åŠæ‰€éœ€çš„è®¾è®¡å±‚æ¬¡ï¼š\n\n![è®¾è®¡çš„å±‚æ¬¡](http://media.gusibi.mobi/hFeM_4EYd9btf0y09WRKh6M57Hqc6VNLnpUC8vVUOo28T1cqTy-pMNAvigkzT6HL)\n\n> å¦‚æœåœ¨ç¼–ç å‰åˆ¤æ–­ä¸äº†åº”è¯¥åšå¤šæ·±å…¥çš„è®¾è®¡ï¼Œé‚£ä¹ˆè¯¦ç»†çš„è®¾è®¡æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚\n\n#### è®°å½•è®¾è®¡æˆæœ\n\n* æŠŠè®¾è®¡æ–‡æ¡£åŠ å…¥åˆ°ä»£ç ä¸­\n    - åˆé€‚çš„æ³¨é‡Šéå¸¸å…³é”®ï¼Œç‰¹åˆ«æ˜¯æŸäº›ç‰¹å®šçš„è®¾è®¡å†³ç­–\n* ç”¨Wiki æ¥è®°å½•è®¾è®¡è®¨è®ºå’Œå†³ç­–\n* å†™æ€»ç»“é‚®ä»¶\n* ä¿ç•™è®¾è®¡å›¾\n\n### æ€»ç»“\n\n* è½¯ä»¶çš„é¦–è¦æŠ€æœ¯ä½¿å‘½å°±æ˜¯ç®¡ç†å¤æ‚åº¦ã€‚ä»¥ç®€å•æ€§ä¸ºåŠªåŠ›ç›®æ ‡çš„è®¾è®¡æ–¹æ¡ˆå¯¹æ­¤æœ€æœ‰å¸®åŠ©\n* ç®€å•æ€§å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥è·å–ï¼šè½¶äº‹å‡å°‘åœ¨åŒä¸€æ—¶é—´æ‰€å…³æ³¨çš„æœ¬è´¨æ€§å¤æ‚åº¦çš„é‡ï¼ŒäºŒæ˜¯é¿å…ç”Ÿæˆä¸å¿…è¦çš„å¶ç„¶çš„å¤æ‚åº¦\n* è®¾è®¡æ˜¯ä¸€ä¸ªå¯å‘å¼çš„è¿‡ç¨‹ã€‚å›ºæ‰§äºæŸä¸€ç§å•ä¸€æ–¹æ³•ä¼šæŸå®³åˆ›æ–°èƒ½åŠ›ï¼Œä»è€ŒæŸå®³ç¨‹åº\n* å¥½çš„è®¾è®¡éƒ½æ˜¯è¿­ä»£çš„ï¼Œå°è¯•çš„è¶Šå¤šï¼Œæœ€ç»ˆæ–¹æ¡ˆä¼šè¶Šå¥½\n* ä¿¡æ¯éšè—æ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„æ¦‚å¿µã€‚é€šè¿‡è¯¢é—®â€œæˆ‘åº”è¯¥éšè—ä»€ä¹ˆï¼Ÿ\"èƒ½å¤Ÿè§£å†³å¾ˆå¤šè®¾è®¡é—®é¢˜\n\n\n\n## å‚è€ƒé“¾æ¥\n\n* [å¸¸ç”¨è®¾è®¡æ¨¡å¼Pythonå®ç°](https://mp.weixin.qq.com/mp/homepage?__biz=MzAwNjI5MjAzNw==&hid=2&sn=c32f7371e7df2e2282e2bdba080aa9c2)\n\n\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "åˆ›å»ºé«˜è´¨é‡çš„ä»£ç --è½¯ä»¶æ„å»ºä¸­çš„è®¾è®¡",
        "date": "2019-05-29 13:05:57",
        "tags": [
          "åç«¯",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Design-in-software-construction"
    },
    {
      "content": "\n## å¹¶å‘&å¹¶è¡Œ\n\nå¹¶å‘ç¨‹åºå«æœ‰å¤šä¸ªé€»è¾‘ä¸Šçš„ç‹¬ç«‹æ‰§è¡Œå—ï¼Œä»–ä»¬å¯ä»¥ç‹¬ç«‹çš„å¹¶è¡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸²è¡Œæ‰§è¡Œã€‚\nå¹¶è¡Œç¨‹åºè§£å†³é—®é¢˜çš„é€Ÿåº¦æ¯”ä¸²è¡Œç¨‹åºå¿«çš„å¤šï¼Œå› ä¸ºå…¶å¯ä»¥åŒæ—¶æ‰§è¡Œæ•´ä¸ªä»»åŠ¡çš„å¤šä¸ªéƒ¨åˆ†ã€‚å¹¶è¡Œç¨‹åºå¯èƒ½æœ‰å¤šä¸ªç‹¬ç«‹æ‰§è¡Œå—ï¼Œä¹Ÿå¯èƒ½åªæœ‰ä¸€ä¸ªã€‚\n\n> å¼•ç”¨Rob Pikeçš„ç»å…¸æè¿°å°±æ˜¯ï¼š\n> å¹¶å‘æ˜¯åŒä¸€æ—¶é—´åº”å¯¹å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼›\n> å¹¶è¡Œæ˜¯åŒä¸€æ—¶é—´åŠ¨æ‰‹åšå¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ã€‚\n\nå¸¸è§çš„å¹¶å‘æ¨¡å‹æœ‰ï¼š\n\n1. çº¿ç¨‹ä¸é”\n2. å‡½æ•°å¼ç¼–ç¨‹\n3. actoræ¨¡å‹å’Œé€šä¿¡é¡ºåºæ˜¯è¿›è¡Œï¼ˆCommunicating Sequential Processes, CSPï¼‰\n4. æ•°æ®çº§å¹¶è¡Œ\n5. lambda æ¶æ„\n6. åˆ†ç¦»æ ‡è¯†ä¸çŠ¶æ€æ¨¡å‹\n\nè¿™ç¯‡ä¸»è¦ä»‹ç»çº¿ç¨‹ä¸é”æ¨¡å‹\n\n## çº¿ç¨‹ä¸é”æ¨¡å‹\n\nçº¿ç¨‹ä¸é”æ¨¡å‹æ˜¯å¯¹åº•å±‚ç¡¬ä»¶è¿è¡Œè¿‡ç¨‹çš„å½¢å¼åŒ–ï¼Œéå¸¸ç®€å•ç›´æ¥ï¼Œå‡ ä¹æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€éƒ½å¯¹å…¶æä¾›äº†æ”¯æŒï¼Œä¸”ä¸å¯¹å…¶ä½¿ç”¨æ–¹æ³•åŠ ä»¥é™åˆ¶ï¼ˆæ˜“å‡ºé”™ï¼‰ã€‚\n\n> è¿™ç¯‡æ–‡ç« ä¸»è¦ä½¿ç”¨pythonè¯­è¨€æ¥æ¼”ç¤ºçº¿ç¨‹ä¸é”æ¨¡å‹ã€‚æ–‡ç« ç»“æ„æ¥è‡ªã€Šä¸ƒå‘¨ä¸ƒå¹¶å‘æ¨¡å‹ã€‹\n\n## äº’æ–¥å’Œå†…å­˜æ¨¡å‹\n\n### åˆ›å»ºçº¿ç¨‹\n\n```python\nfrom threading import Thread\n\ndef hello_world():\n    print(\"Hello from new thread\")\n\ndef main():\n    my_thread = Thread(target=hello_world)\n    my_thread.start()\n    print(\"Hello from main thread\")\n    my_thread.join()\n\nmain()\n\n```\n\nè¿™æ®µä»£ç åˆ›å»ºå¹¶å¯åŠ¨äº†ä¸€ä¸ª`Thread`å®ä¾‹ï¼Œé¦–å…ˆä»`start()` å¼€å§‹ï¼Œ`my_thread.start() main()`å‡½æ•°çš„ä½™ä¸‹éƒ¨åˆ†ä¸€èµ·å¹¶å‘æ‰§è¡Œã€‚æœ€åè°ƒç”¨`join()` æ¥ç­‰å¾…`my_thread`çº¿ç¨‹ç»“æŸã€‚\n\nè¿è¡Œè¿™æ®µä»£ç è¾“å‡ºç»“æœæœ‰å‡ ç§ï¼š\n```\nHello from new thread\nHello from main thread\n```\næˆ–è€…\n```\nHello from main thread\nHello from new thread\n```\næˆ–è€…\n```\nHello from new threadHello from main thread\n```\n\nç©¶ç«Ÿå“ªä¸ªç»“æœå–å†³äºå“ªä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œ`print()`ã€‚å¤šçº¿ç¨‹ç¼–ç¨‹å¾ˆéš¾çš„åŸå› ä¹‹ä¸€å°±æ˜¯è¿è¡Œç»“æœå¯èƒ½ä¾èµ–äºæ—¶åºï¼Œå¤šæ¬¡è¿è¡Œç»“æœå¹¶ä¸ç¨³å®šã€‚ \n\n### ç¬¬ä¸€æŠŠé”\n\n```python\n\nfrom threading import Thread, Lock\n\n\nclass Counter(object):\n    def __init__(self, count=0):\n        self.count = count\n\n    def increment(self):\n        self.count += 1\n\n    def get_count(self):\n        print(\"Count: %s\" % self.count)\n        return self.count\n\n\ndef test_count():\n    counter = Counter()\n\n    class CounterThread(Thread):\n        def run(self):\n            for i in range(10000):\n                counter.increment()\n\n    t1 = CounterThread()\n    t2 = CounterThread()\n    t1.start()\n    t2.start()\n    t1.join()\n    t2.join()\n\n    counter.get_count()\n\ntest_count()\n```\n\nè¿™æ®µä»£ç åˆ›å»ºä¸€ä¸ªç®€å•çš„ç±»Counter å’Œä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨counter.increment() 10000æ¬¡ã€‚\n\nå¤šæ¬¡è¿è¡Œè¿™æ®µä»£ç ä¼šå¾—åˆ°ä¸åŒçš„å€¼ï¼ŒåŸå› æ˜¯ä¸¤ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨ counter.count æ—¶å‘ç”Ÿäº†`ç«æ€æ¡ä»¶`ï¼ˆä»£ç è¡Œä¸ºå–å†³äºå„æ“ä½œçš„æ—¶åºï¼‰ã€‚\n\nä¸€ä¸ªå¯èƒ½çš„æ“ä½œæ˜¯ï¼š\n1. çº¿ç¨‹t1 è·å–countçš„å€¼æ—¶ï¼Œçº¿ç¨‹t2ä¹ŸåŒæ—¶è·å–åˆ°äº†count çš„å€¼ï¼ˆå‡è®¾æ˜¯100ï¼‰ï¼Œ\n2. è¿™æ—¶t1  count + 1ï¼Œ æ­¤æ—¶count ä¸º101ï¼Œå›å†™count å€¼ï¼Œç„¶åt2 æ‰§è¡Œäº†ç›¸åŒçš„æ“ä½œ count+1ï¼Œå› ä¸ºt2 å–åˆ°çš„å€¼ä¹Ÿæ˜¯100 æ­¤æ—¶ count ä»æ˜¯101ï¼Œå›å†™åcount ä¾ç„¶æ˜¯101ï¼Œä½†æ˜¯ +1 æ“ä½œæ‰§è¡Œäº†ä¸¤æ¬¡ã€‚\n\nç«æ€æ¡ä»¶çš„è§£å†³æ–¹æ³•æ˜¯å¯¹ count è¿›è¡ŒåŒæ­¥ï¼ˆsynchronizeï¼‰è®¿é—®ã€‚ä¸€ç§æ“ä½œæ˜¯ä½¿ç”¨ `å†…ç½®é”`(ä¹Ÿç§°äº’æ–¥é”ï¼ˆmutexï¼‰ã€ç®¡ç¨‹ï¼ˆmonitorï¼‰æˆ–ä¸´ç•ŒåŒºï¼ˆcritical sectionï¼‰)æ¥åŒæ­¥å¯¹increment() çš„è°ƒç”¨ã€‚\n\n> çº¿ç¨‹åŒæ­¥èƒ½å¤Ÿä¿è¯å¤šä¸ªçº¿ç¨‹å®‰å…¨è®¿é—®ç«äº‰èµ„æºï¼Œæœ€ç®€å•çš„åŒæ­¥æœºåˆ¶æ˜¯å¼•å…¥äº’æ–¥é”ã€‚äº’æ–¥é”ä¸ºèµ„æºå¼•å…¥ä¸€ä¸ªçŠ¶æ€ï¼šé”å®š/éé”å®šã€‚æŸä¸ªçº¿ç¨‹è¦æ›´æ”¹å…±äº«æ•°æ®æ—¶ï¼Œå…ˆå°†å…¶é”å®šï¼Œæ­¤æ—¶èµ„æºçš„çŠ¶æ€ä¸ºâ€œé”å®šâ€ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½æ›´æ”¹ï¼›\n> ç›´åˆ°è¯¥çº¿ç¨‹é‡Šæ”¾èµ„æºï¼Œå°†èµ„æºçš„çŠ¶æ€å˜æˆâ€œéé”å®šâ€ï¼Œå…¶ä»–çš„çº¿ç¨‹æ‰èƒ½å†æ¬¡é”å®šè¯¥èµ„æºã€‚äº’æ–¥é”ä¿è¯äº†æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå†™å…¥æ“ä½œï¼Œä»è€Œä¿è¯äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹æ•°æ®çš„æ­£ç¡®æ€§ã€‚\n\n> å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨é”çš„acquire()æ–¹æ³•è·å¾—é”æ—¶ï¼Œé”å°±è¿›å…¥â€œlockedâ€çŠ¶æ€ã€‚æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å¾—é”ã€‚å¦‚æœæ­¤æ—¶å¦ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å¾—è¿™ä¸ªé”ï¼Œè¯¥çº¿ç¨‹å°±ä¼šå˜ä¸ºâ€œblockedâ€çŠ¶æ€ï¼Œç§°ä¸ºâ€œåŒæ­¥é˜»å¡â€ã€‚\n> ç›´åˆ°æ‹¥æœ‰é”çš„çº¿ç¨‹è°ƒç”¨é”çš„release()æ–¹æ³•é‡Šæ”¾é”ä¹‹åï¼Œé”è¿›å…¥â€œunlockedâ€çŠ¶æ€ã€‚çº¿ç¨‹è°ƒåº¦ç¨‹åºä»å¤„äºåŒæ­¥é˜»å¡çŠ¶æ€çš„çº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ¥è·å¾—é”ï¼Œå¹¶ä½¿å¾—è¯¥çº¿ç¨‹è¿›å…¥è¿è¡Œï¼ˆrunningï¼‰çŠ¶æ€ã€‚\n\n\npython é”çš„ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š\n\n```python\n#åˆ›å»ºé”\nmutex = threading.Lock()\n#é”å®š\nmutex.acquire([timeout])\n#é‡Šæ”¾\nmutex.release()\n```\n\næ¨èä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥æ“ä½œé”ï¼Œ\n\n```python\nwith lock:\n    do someting\n\n# ç›¸å½“äº\n\nlock.acquire()\n\ntry:\n    # do something...\nfinally:\n    lock.release()\n```\n\n> acquire(blocking=True, timeout=-1)\n> å¯ä»¥é˜»å¡æˆ–éé˜»å¡åœ°è·å¾—é”ã€‚\n>å½“è°ƒç”¨æ—¶å‚æ•° blocking è®¾ç½®ä¸º True ï¼ˆç¼ºçœå€¼ï¼‰ï¼Œé˜»å¡ç›´åˆ°é”è¢«é‡Šæ”¾ï¼Œç„¶åå°†é”é”å®šå¹¶è¿”å› True ã€‚\n>åœ¨å‚æ•° blocking è¢«è®¾ç½®ä¸º False çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œå°†ä¸ä¼šå‘ç”Ÿé˜»å¡ã€‚å¦‚æœè°ƒç”¨æ—¶ blocking è®¾ä¸º True ä¼šé˜»å¡ï¼Œå¹¶ç«‹å³è¿”å› False ï¼›å¦åˆ™ï¼Œå°†é”é”å®šå¹¶è¿”å› Trueã€‚\n>å½“æµ®ç‚¹å‹ timeout å‚æ•°è¢«è®¾ç½®ä¸ºæ­£å€¼è°ƒç”¨æ—¶ï¼Œåªè¦æ— æ³•è·å¾—é”ï¼Œå°†æœ€å¤šé˜»å¡ timeout è®¾å®šçš„ç§’æ•°ã€‚timeout å‚æ•°è¢«è®¾ç½®ä¸º -1 æ—¶å°†æ— é™ç­‰å¾…ã€‚å½“ blocking ä¸º false æ—¶ï¼Œtimeout æŒ‡å®šçš„å€¼å°†è¢«å¿½ç•¥ã€‚\n>å¦‚æœæˆåŠŸè·å¾—é”ï¼Œåˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False (ä¾‹å¦‚å‘ç”Ÿ è¶…æ—¶ çš„æ—¶å€™)ã€‚\n> timeout å‚æ•°éœ€è¦ `python3.2+`\n\n```python\nfrom threading import Thread, Lock\nmutex = Lock()\n\nclass SynchronizeCounter(object):\n    def __init__(self, count=0):\n        self.count = count\n\n    def increment(self):\n        # if mutex.acquire(1): # è·å–é”\n        #     self.count += 1\n        #     mutex.release()  # é‡Šæ”¾é”\n        # ç­‰åŒäºä¸Šè¿°ä»£ç \n        with mutex:\n            self.count += 1\n\n    def get_count(self):\n        print(\"Count: %s\" % self.count)\n        return self.count\n\ndef test_synchronize_count():\n    counter = SynchronizeCounter()\n\n    class CounterThread(Thread):\n        def run(self):\n            for i in range(100000):\n                counter.increment()\n\n    t1 = CounterThread()\n    t2 = CounterThread()\n    t1.start()\n    t2.start()\n    t1.join()\n    t2.join()\n\n    counter.get_count()\n\n\nif __name__ == \"__main__\":\n    for i in range(100):\n        test_synchronize_count()\n\n```\n\n> è¿™æ®µä»£ç è¿˜æœ‰ä¸€ä¸ªéšè—çš„bugï¼Œé‚£å°±æ˜¯ get_count()ï¼Œè¿™é‡Œget_count() æ˜¯åœ¨join()ä¹‹åè°ƒç”¨çš„ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨å…¶å®ƒåœ°æ–¹è°ƒç”¨äº† get_count() å‡½æ•°ã€‚\nç”±äºåœ¨ get_count() ä¸­æ²¡æœ‰è¿›è¡Œçº¿ç¨‹åŒæ­¥ï¼Œè°ƒç”¨æ—¶å¯èƒ½ä¼šè·å–åˆ°ä¸€ä¸ªå¤±æ•ˆçš„å€¼ã€‚\n\n\n#### è¯¡å¼‚çš„å†…å­˜\n\nå¯¹äºJAVAç­‰ç«æ€ç¼–è¯‘è¯­è¨€ï¼Œ\n1. ç¼–è¯‘å™¨çš„é™æ€ä¼˜åŒ–å¯èƒ½ä¼šæ‰“ä¹±ä»£ç çš„æ‰§è¡Œé¡ºåº\n2. JVM çš„åŠ¨æ€ä¼˜åŒ–ä¹Ÿä¼šæ‰“ä¹±ä»£ç çš„æ‰§è¡Œé¡ºåº\n3. ç¡¬ä»¶å¯ä»¥é€šè¿‡ä¹±åºæ‰§è¡Œæ¥ä¼˜åŒ–æ€§èƒ½\n\næ›´ç³Ÿç³•çš„æ˜¯ï¼Œæœ‰æ—¶ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿçš„ä¿®æ”¹å¯èƒ½ä¼šå¯¹å¦ä¸€ä¸ªçº¿ç¨‹ä¸å¯è§ã€‚\n> ä»ç›´è§‰ä¸Šæ¥è¯´ï¼Œç¼–è¯‘å™¨ã€JVMã€ç¡¬ä»¶éƒ½ä¸åº”æ’æ‰‹ä¿®æ”¹åŸæœ¬çš„ä»£ç é€»è¾‘ã€‚ä½†æ˜¯è¿‘å‡ å¹´çš„è¿è¡Œæ•ˆç‡æå‡ï¼Œå°¤å…¶æ˜¯å…±äº«å†…å­˜äº¤åª¾çš„è¿è¡Œæ•ˆç‡æå‡ï¼Œéƒ½ä»°ä»—äºæ­¤ç±»ä»£ç ä¼˜åŒ–ã€‚\n> å…·ä½“çš„å‰¯ä½œç”¨ï¼ŒJava å†…å­˜æ¨¡å‹æœ‰æ˜ç¡®è¯´æ˜ã€‚\n> Java å†…å­˜æ¨¡å‹å®šä¹‰äº†ä½•æ—¶ä¸€ä¸ªçº¿ç¨‹å¯¹å†…å­˜çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚`åŸºæœ¬åŸåˆ™æ˜¯ï¼šå¦‚æœè¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹ä¸è¿›è¡ŒåŒæ­¥ï¼Œå°±ä¸èƒ½ä¿è¯å¯è§æ€§ã€‚`\n\n\n### å¤šæŠŠé”\n\n**ä¸€ä¸ªé‡ç‚¹ï¼š** ä¸¤ä¸ªçº¿ç¨‹éƒ½éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚åªåœ¨å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒåŒæ­¥æ˜¯ä¸å¤Ÿçš„ã€‚\n\nå¯å¦‚æœæ‰€æœ‰çš„æ–¹æ³•éƒ½åŒæ­¥ï¼Œå¤§å¤šæ•°çº¿ç¨‹å¯èƒ½éƒ½ä¼šè¢«é˜»å¡ï¼Œå¤±å»äº†å¹¶å‘çš„æ„ä¹‰ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå‡ºç°æ­»é”ã€‚\n\n[å“²å­¦å®¶è¿›é¤é—®é¢˜](https://zh.wikipedia.org/wiki/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%B0%B1%E9%A4%90%E9%97%AE%E9%A2%98)\n\n> `å“²å­¦å®¶å°±é¤é—®é¢˜`ï¼šå‡è®¾æœ‰äº”ä½å“²å­¦å®¶å›´ååœ¨ä¸€å¼ åœ†å½¢é¤æ¡Œæ—ï¼Œåšä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…ä¹‹ä¸€ï¼šåƒé¥­ï¼Œæˆ–è€…æ€è€ƒã€‚åƒä¸œè¥¿çš„æ—¶å€™ï¼Œä»–ä»¬å°±åœæ­¢æ€è€ƒï¼Œæ€è€ƒçš„æ—¶å€™ä¹Ÿåœæ­¢åƒä¸œè¥¿ã€‚é¤æ¡Œä¸­é—´æœ‰ä¸€å¤§ç¢—æ„å¤§åˆ©é¢ï¼Œæ¯ä¸¤ä¸ªå“²å­¦å®¶ä¹‹é—´æœ‰ä¸€åªé¤å‰ã€‚å› ä¸ºç”¨ä¸€åªé¤å‰å¾ˆéš¾åƒåˆ°æ„å¤§åˆ©é¢ï¼Œæ‰€ä»¥å‡è®¾å“²å­¦å®¶å¿…é¡»ç”¨ä¸¤åªé¤å‰åƒä¸œè¥¿ã€‚ä»–ä»¬åªèƒ½ä½¿ç”¨è‡ªå·±å·¦å³æ‰‹è¾¹çš„é‚£ä¸¤åªé¤å‰ã€‚ \n\n> å“²å­¦å®¶ä»æ¥ä¸äº¤è°ˆï¼Œè¿™å°±å¾ˆå±é™©ï¼Œå¯èƒ½äº§ç”Ÿæ­»é”ï¼Œæ¯ä¸ªå“²å­¦å®¶éƒ½æ‹¿ç€å·¦æ‰‹çš„é¤å‰ï¼Œæ°¸è¿œéƒ½åœ¨ç­‰å³è¾¹çš„é¤å‰ï¼ˆæˆ–è€…ç›¸åï¼‰ã€‚\nå³ä½¿æ²¡æœ‰æ­»é”ï¼Œä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿèµ„æºè€—å°½ã€‚ä¾‹å¦‚ï¼Œå‡è®¾è§„å®šå½“å“²å­¦å®¶ç­‰å¾…å¦ä¸€åªé¤å‰è¶…è¿‡äº”åˆ†é’Ÿåå°±æ”¾ä¸‹è‡ªå·±æ‰‹é‡Œçš„é‚£ä¸€åªé¤å‰ï¼Œå¹¶ä¸”å†ç­‰äº”åˆ†é’Ÿåè¿›è¡Œä¸‹ä¸€æ¬¡å°è¯•ã€‚è¿™ä¸ªç­–ç•¥æ¶ˆé™¤äº†æ­»é”ï¼ˆç³»ç»Ÿæ€»ä¼šè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼‰ï¼Œä½†ä»ç„¶æœ‰å¯èƒ½å‘ç”Ÿâ€œæ´»é”â€ã€‚å¦‚æœäº”ä½å“²å­¦å®¶åœ¨å®Œå…¨ç›¸åŒçš„æ—¶åˆ»è¿›å…¥é¤å…ï¼Œå¹¶åŒæ—¶æ‹¿èµ·å·¦è¾¹çš„é¤å‰ï¼Œé‚£ä¹ˆè¿™äº›å“²å­¦å®¶å°±ä¼šç­‰å¾…äº”åˆ†é’Ÿï¼ŒåŒæ—¶æ”¾ä¸‹æ‰‹ä¸­çš„é¤å‰ï¼Œå†ç­‰äº”åˆ†é’Ÿï¼ŒåˆåŒæ—¶æ‹¿èµ·è¿™äº›é¤å‰ã€‚\n\nä¸‹é¢æ˜¯å“²å­¦å®¶è¿›é¤é—®é¢˜çš„ä¸€ä¸ªå®ç°ï¼š\n\n```python\nimport threading\nimport random\nimport time\n\n\nclass Philosopher(threading.Thread):\n\n    running = True\n\n    def __init__(self, xname, forkOnLeft, forkOnRight):\n        threading.Thread.__init__(self)\n        self.name = xname\n        self.forkOnLeft = forkOnLeft\n        self.forkOnRight = forkOnRight\n\n    def run(self):\n        while self.running:\n            #  Philosopher is thinking (but really is sleeping).\n            time.sleep(random.uniform(1, 3))\n            print(\"%s is hungry.\" % self.name)\n            self.dine()\n\n    def dine(self):\n        fork1, fork2 = self.forkOnLeft, self.forkOnRight\n\n        while self.running:\n            fork1.acquire(True)  # é˜»å¡å¼è·å–left é”\n            # locked = fork2.acquire(True) # é˜»å¡å¼ è·å–right é”  å®¹æ˜“äº§ç”Ÿæ­»é”\n            locked = fork2.acquire(False)  # éé˜»å¡å¼ è·å–right é”\n            if locked:\n                break  # å¦‚æœè¢«é”å®šï¼Œé‡Šæ”¾ left é€€å‡ºç­‰å¾…\n            fork1.release()\n            print(\"%s swaps forks\" % self.name)\n            fork1, fork2 = fork2, fork1\n        else:\n            return\n\n        self.dining()\n        fork2.release()\n        fork1.release()\n\n    def dining(self):\n        print(\"%s starts eating \" % self.name)\n        time.sleep(random.uniform(1, 5))\n        print(\"%s finishes eating and leaves to think.\" % self.name)\n\n\ndef DiningPhilosophers():\n    forks = [threading.Lock() for n in range(5)]\n    philosopherNames = (\"Aristotle\", \"Kant\", \"Buddha\", \"Marx\", \"Russel\")\n\n    philosophers = [\n        Philosopher(philosopherNames[i], forks[i % 5], forks[(i + 1) % 5])\n        for i in range(5)\n    ]\n\n    Philosopher.running = True\n    for p in philosophers:\n        p.start()\n    for p in philosophers:\n        p.join()\n    time.sleep(100)\n    Philosopher.running = False\n    print(\"Now we're finishing.\")\n\n\nDiningPhilosophers()\n\n```\n\n### å¤–æ˜Ÿæ–¹æ³•çš„å±å®³\n\nè§„æ¨¡è¾ƒå¤§çš„ç¨‹åºå¸¸ç”¨ç›‘å¬å™¨æ¨¡å¼æ¥è§£è€¦æ¨¡å—ï¼Œè¿™é‡Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªç±»ä»ä¸€ä¸ªURLè¿›è¡Œä¸‹è½½ï¼ŒListeners ç›‘å¬ä¸‹è½½è¿›åº¦ã€‚\n\n```python\nimport requests\nimport threading\n\n\nclass Listeners(object):\n    def __init__(self, count=0):\n        self.count = count\n        self.done_count = 0.0\n        self.listeners = []\n\n    def append(self, listener):\n        self.listeners.append(listener)\n\n    def remove(self, listener):\n        self.listeners.remove(listener)\n\n    def on_progress(self, n):\n        # ä¸€äº›æˆ‘ä»¬ä¸çŸ¥é“çš„å®ç°\n        # do someting\n        # self.done_count += 1\n        # print(\"Process: %f\" % (self.done_count / self.count))\n        pass\n\n\nlisteners = Listeners(5)\n\n\nclass Downloader(threading.Thread):\n    def __init__(\n        self, group=None, target=None, name=None, args=(), kwargs=None, daemon=None\n    ):\n        threading.Thread.__init__(\n            self, group=group, target=target, name=name, daemon=daemon\n        )\n        self.url = kwargs.get(\"url\")\n\n    def download(self):\n        resp = requests.get(self.url)\n\n    def add_listener(self, listener):\n        listeners.append(listener)\n\n    def remove_listener(self, listener):\n        listeners.delete(listener)\n\n    def update_progress(self, n):\n        for listener in listeners:\n            listner.on_progress(n)\n\n    def run(self):\n        self.download()\n        print(self.url)\n        listeners.on_progress(1)\n\n\ndef test():\n    urls = [\n        \"https://www.baidu.com\",\n        \"https://www.google.com\",\n        \"https://www.bing.com\",\n        \"https://www.zaih.com\",\n        \"https://www.github.com\",\n    ]\n    ts = [Downloader(kwargs=dict(url=url)) for url in urls]\n    print(ts)\n    [t.start() for t in ts]\n    [t.join() for t in ts]\n\n\nif __name__ == \"__main__\":\n    test()\n\n```\nè¿™æ®µä»£ç ä¸­ï¼Œadd_listenerï¼Œ remove_listener å’Œ update_progress éƒ½æ˜¯åŒæ­¥æ–¹æ³•ï¼Œä½† update_progress è°ƒç”¨äº†ä¸€ä¸ªæˆ‘ä»¬ä¸çŸ¥é“å¦‚ä½•å®ç°çš„æ–¹æ³•ã€‚å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè·å–äº†ä¸€æŠŠé”ï¼Œç¨‹åºåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°±å¯èƒ½å‘ç”Ÿæ­»é”ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯åœ¨éå†ä¹‹å‰å¯¹ listeners è¿›è¡Œä¿æŠ¤æ€§å¤åˆ¶ï¼Œå†é’ˆå¯¹è¿™ä»½å‰¯æœ¬è¿›è¡Œéå†ã€‚ï¼ˆç°åœ¨è°ƒç”¨å¤–æ˜Ÿæ–¹æ³•ä¸å†éœ€è¦åŠ é”ï¼‰\n\n## è¶…è¶Šå†…ç½®é”\n\n### å¯é‡å…¥é”\n\nLock() è™½ç„¶æ–¹ä¾¿ï¼Œä½†é™åˆ¶å¾ˆå¤šï¼š\n1. ä¸€ä¸ªçº¿ç¨‹å› ä¸ºç­‰å¾…å†…ç½®é”è€Œè¿›å…¥é˜»å¡ä¹‹åï¼Œå°±æ— æ³•ä¸­æ–­è¯¥çº¿ç¨‹\n2. Lock() ä¸çŸ¥é“å½“å‰æ‹¥æœ‰é”çš„çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è·å–äº†é”ï¼Œå†æ¬¡è·å–ä¹Ÿä¼šé˜»å¡ã€‚\n\né‡å…¥é”æ˜¯(threading.RLock)ä¸€ä¸ªå¯ä»¥è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–çš„åŒæ­¥åŸºå…ƒç»„ä»¶ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒåœ¨åŸºå…ƒé”çš„é”å®š/éé”å®šçŠ¶æ€ä¸Šé™„åŠ äº† \"æ‰€å±çº¿ç¨‹\" å’Œ \"é€’å½’ç­‰çº§\" çš„æ¦‚å¿µã€‚åœ¨é”å®šçŠ¶æ€ä¸‹ï¼ŒæŸäº›çº¿ç¨‹æ‹¥æœ‰é” ï¼› åœ¨éé”å®šçŠ¶æ€ä¸‹ï¼Œ æ²¡æœ‰çº¿ç¨‹æ‹¥æœ‰å®ƒã€‚\n\nè‹¥è¦é”å®šé”ï¼Œçº¿ç¨‹è°ƒç”¨å…¶ acquire() æ–¹æ³•ï¼›ä¸€æ—¦çº¿ç¨‹æ‹¥æœ‰äº†é”ï¼Œæ–¹æ³•å°†è¿”å›ã€‚è‹¥è¦è§£é”ï¼Œçº¿ç¨‹è°ƒç”¨ release() æ–¹æ³•ã€‚ acquire()/release() å¯¹å¯ä»¥åµŒå¥—ï¼›åªæœ‰æœ€ç»ˆ release() (æœ€å¤–é¢ä¸€å¯¹çš„ release() ) å°†é”è§£å¼€ï¼Œæ‰èƒ½è®©å…¶ä»–çº¿ç¨‹ç»§ç»­å¤„ç† acquire() é˜»å¡ã€‚\n\nthreading.RLock æä¾›äº†æ˜¾å¼çš„ acquire() å’Œ release() æ–¹æ³•\nä¸€ä¸ªå¥½çš„å®è·µæ˜¯ï¼š\n\n    lock = threading.RLock()\n    \nLock å’Œ RLock çš„ä½¿ç”¨åŒºåˆ«å¦‚ä¸‹ï¼š\n\n```python\n#rlock_tut.py\nimport threading\nnum = 0\nlock = Threading.Lock()\nlock.acquire()\nnum += 1\nlock.acquire() # è¿™é‡Œä¼šè¢«é˜»å¡\nnum += 2\nlock.release()\n\n# With RLock, that problem doesnâ€™t happen.\nlock = Threading.RLock()\nlock.acquire()\nnum += 3\nlock.acquire() # ä¸ä¼šè¢«é˜»å¡.\nnum += 4\nlock.release()\nlock.release() # ä¸¤ä¸ªé”éƒ½éœ€è¦è°ƒç”¨ release() æ¥é‡Šæ”¾.\n\n```\n\n### è¶…æ—¶\n\nä½¿ç”¨å†…ç½®é”æ—¶ï¼Œé˜»å¡çš„çº¿ç¨‹æ— æ³•è¢«ä¸­æ–­ï¼Œç¨‹åºä¸èƒ½ä»æ­»é”æ¢å¤ï¼Œå¯ä»¥ç»™é”è®¾ç½®è¶…æ—¶æ—¶é—´æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n> timeout å‚æ•°éœ€è¦ python3.2+\n\n```python\nimport time\nfrom threading import Thread, Lock\n\nlock1 = RLock()\nlock2 = RLock()\n\n# è¿™ä¸ªç¨‹åºä¼šä¸€ç›´æ­»é”ä¸‹å»ï¼Œå¦‚æœæƒ³çªç ´è¿™ä¸ªé™åˆ¶ï¼Œå¯ä»¥åœ¨è·å–é”çš„æ—¶å€™åŠ ä¸Šè¶…æ—¶æ—¶é—´\n# > python threading æ²¡æœ‰å®ç° é”€æ¯(destroy)ï¼Œåœæ­¢(stop)ï¼Œæš‚åœ(suspend)ï¼Œç»§ç»­ï¼ˆresumeï¼‰,ä¸­æ–­ï¼ˆinterruptï¼‰ç­‰\n\n\nclass T1(Thread):\n    def run(self):\n        print(\"start run T1\")\n        lock1.acquire()\n        # lock1.acquire(timeout=2) # è®¾ç½®è¶…æ—¶æ—¶é—´å¯é¿å…æ­»é”\n        time.sleep(1)\n        lock2.acquire()\n        # lock2.acquire(timeout=2) # è®¾ç½®è¶…æ—¶æ—¶é—´å¯é¿å…æ­»é”\n        lock1.release()\n        lock2.release()\n\n\nclass T2(Thread):\n    def run(self):\n        print(\"start run T2\")\n        lock2.acquire()\n        # lock2.acquire(timeout=2) # è®¾ç½®è¶…æ—¶æ—¶é—´å¯é¿å…æ­»é”\n        time.sleep(1)\n        lock1.acquire()\n        # lock1.acquire(timeout=2) # è®¾ç½®è¶…æ—¶æ—¶é—´å¯é¿å…æ­»é”\n        lock2.release()\n        lock1.release()\n\n\ndef test():\n    t1, t2 = T1(), T2()\n    t1.start()\n    t2.start()\n\n    t1.join()\n    t2.join()\n\n\nif __name__ == \"__main__\":\n    test()\n\n```\n\n### äº¤æ›¿é”\n\nå¦‚æœæˆ‘ä»¬è¦åœ¨é“¾è¡¨ä¸­æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸€ç§åšæ³•æ˜¯ç”¨é”ä¿æŠ¤æ•´ä¸ªé“¾è¡¨ï¼Œä½†é“¾è¡¨åŠ é”æ—¶å…¶å®ƒä½¿ç”¨è€…æ— æ³•è®¿é—®ã€‚äº¤æ›¿é”å¯ä»¥åªæ‰€è¿½æ€é“¾è¡¨çš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸ä¸æ¶‰åŠè¢«é”éƒ¨åˆ†çš„å…¶å®ƒçº¿ç¨‹è‡ªç”±è®¿é—®ã€‚\n\n![äº¤æ›¿é”](http://media.gusibi.mobi/TEbTwYoXnf5oLt4T3ovmxSALDg90i63Lx3t2EZIfyqVyo6bDHJGVnvu-v89vas7E)\n\n```python\n\nfrom random import randint\nfrom threading import Thread, Lock\n\nclass Node(object):\n\n    def __init__(self, value, prev=None, next=None):\n        self.value = value\n        self.prev = prev\n        self.next = next\n        self.lock = Lock()\n\n\nclass SortedList(Thread):\n\n    def __init__(self, head):\n        Thread.__init__(self)\n        self.head = head\n\n    def insert(self, value):\n        head = self.head\n        node = Node(value)\n        print(\"insert: %d\" % value)\n        while True:\n            if head.value <= value:\n                if head.next != None:\n                    head = head.next\n                else:\n                    head.lock.acquire()\n                    head.next = node\n                    node.prev = head\n                    head.lock.release()\n                    break\n            else:\n                prev = head.prev\n                prev.lock.acquire()\n                head.lock.acquire()\n                if prev != None:\n                    prev.next = node\n                else:\n                    self.head = node\n                node.prev = prev\n                prev.lock.release()\n                node.next = head\n                head.prev = node\n                head.lock.release()\n                break\n\n    def run(self):\n        for i in range(5):\n            self.insert(randint(10, 20))\n\n\ndef test():\n    head = Node(10)\n    t1 = SortedList(head)\n    t2 = SortedList(head)\n    t1.start()\n    t2.start()\n    t1.join()\n    t2.join()\n    while head:\n        print(head.value)\n        head = head.next\n\n\nif __name__ == \"__main__\":\n    test()\n```\n\nè¿™ç§æ–¹æ¡ˆä¸ä»…å¯ä»¥è®©å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„è¿›è¡Œé“¾è¡¨æ’å…¥æ“ä½œï¼Œè¿˜èƒ½è®©å…¶ä»–çš„é“¾è¡¨æ“ä½œå®‰å…¨çš„å¹¶å‘ã€‚\n\n### æ¡ä»¶å˜é‡\n\nå¹¶å‘ç¼–ç¨‹ç»å¸¸éœ€è¦ç­‰å¾…æŸä¸ªäº‹ä»¶å‘ç”Ÿã€‚æ¯”å¦‚ä»é˜Ÿåˆ—åˆ é™¤å…ƒç´ å‰éœ€è¦ç­‰å¾…é˜Ÿåˆ—éç©ºã€å‘ç¼“å­˜æ·»åŠ æ•°æ®å‰éœ€è¦ç­‰å¾…ç¼“å­˜æœ‰è¶³å¤Ÿçš„ç©ºé—´ã€‚æ¡ä»¶å˜é‡å°±æ˜¯ä¸ºè¿™ç§æƒ…å†µè®¾è®¡çš„ã€‚\n\næ¡ä»¶å˜é‡æ€»æ˜¯ä¸æŸç§ç±»å‹çš„é”å¯¹è±¡ç›¸å…³è”ï¼Œé”å¯¹è±¡å¯ä»¥é€šè¿‡ä¼ å…¥è·å¾—ï¼Œæˆ–è€…åœ¨ç¼ºçœçš„æƒ…å†µä¸‹è‡ªåŠ¨åˆ›å»ºã€‚å½“å¤šä¸ªæ¡ä»¶å˜é‡éœ€è¦å…±äº«åŒä¸€ä¸ªé”æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªé”å¾ˆæœ‰ç”¨ã€‚é”æ˜¯æ¡ä»¶å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä¸å¿…å•ç‹¬åœ°è·Ÿè¸ªå®ƒã€‚\n\næ¡ä»¶å˜é‡æœä»ä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼šä½¿ç”¨ with è¯­å¥ä¼šåœ¨å®ƒåŒ…å›´çš„ä»£ç å—å†…è·å–å…³è”çš„é”ã€‚ acquire() å’Œ release() æ–¹æ³•ä¹Ÿèƒ½è°ƒç”¨å…³è”é”çš„ç›¸å…³æ–¹æ³•ã€‚\n\nå…¶å®ƒæ–¹æ³•å¿…é¡»åœ¨æŒæœ‰å…³è”çš„é”çš„æƒ…å†µä¸‹è°ƒç”¨ã€‚ wait() æ–¹æ³•é‡Šæ”¾é”ï¼Œç„¶åé˜»å¡ç›´åˆ°å…¶å®ƒçº¿ç¨‹è°ƒç”¨ notify() æ–¹æ³•æˆ– notify_all() æ–¹æ³•å”¤é†’å®ƒã€‚ä¸€æ—¦è¢«å”¤é†’ï¼Œ wait() æ–¹æ³•é‡æ–°è·å–é”å¹¶è¿”å›ã€‚å®ƒä¹Ÿå¯ä»¥æŒ‡å®šè¶…æ—¶æ—¶é—´ã€‚\n\n```python\n#condition_tut.py\nimport random, time\nfrom threading import Condition, Thread\n\"\"\"\n'condition' variable will be used to represent the availability of a produced\nitem.\n\"\"\"\ncondition = Condition()\nbox = []\ndef producer(box, nitems):\n    for i in range(nitems):\n        time.sleep(random.randrange(2, 5))  # Sleeps for some time.\n        condition.acquire()\n        num = random.randint(1, 10)\n        box.append(num)  # Puts an item into box for consumption.\n        condition.notify()  # Notifies the consumer about the availability.\n        print(\"Produced:\", num)\n        condition.release()\ndef consumer(box, nitems):\n    for i in range(nitems):\n        condition.acquire()\n        condition.wait()  # Blocks until an item is available for consumption.\n        print(\"%s: Acquired: %s\" % (time.ctime(), box.pop()))\n        condition.release()\nthreads = []\n\"\"\"\n'nloops' is the number of times an item will be produced and\nconsumed.\n\"\"\"\nnloops = random.randrange(3, 6)\nfor func in [producer, consumer]:\n    threads.append(Thread(target=func, args=(box, nloops)))\n    threads[-1].start()  # Starts the thread.\nfor thread in threads:\n    \"\"\"Waits for the threads to complete before moving on\n       with the main script.\n    \"\"\"\n    thread.join()\nprint(\"All done.\")\n\n```\n\n### åŸå­å˜é‡\n\n> ä¸é”ç›¸æ¯”ä½¿ç”¨åŸå­å˜é‡çš„ä¼˜ç‚¹ï¼š\n> 1. ä¸ä¼šå¿˜è®°åœ¨æ­£ç¡®çš„æ—¶å€™è·å–é”\n> 2. ç”±äºæ²¡æœ‰é”çš„å‚ä¸ï¼Œå¯¹åŸå­å˜é‡çš„æ“ä½œä¸ä¼šå¼•å‘æ­»é”ã€‚\n> 3. åŸå­å˜é‡æ—¶æ— é”ï¼ˆlock-freeï¼‰éé˜»å¡ï¼ˆnon-blockingï¼‰ç®—æ³•çš„åŸºç¡€ï¼Œè¿™ç§ç®—æ³•å¯ä»¥ä¸ç”¨é”å’Œé˜»å¡æ¥è¾¾åˆ°åŒæ­¥çš„ç›®çš„ã€‚\n\n**python ä¸æ”¯æŒåŸå­å˜é‡**\n## æ€»ç»“\n\n### ä¼˜ç‚¹ \n\nçº¿ç¨‹ä¸é”æ¨¡å‹æœ€å¤§çš„ä¼˜ç‚¹æ˜¯é€‚ç”¨é¢å¹¿ï¼Œæ›´æ¥è¿‘äºâ€œæœ¬è´¨â€--è¿‘ä¼¼äºå¯¹ç¡¬ä»¶å·¥ä½œæ–¹å¼çš„å½¢å¼åŒ–--æ­£ç¡®ä½¿ç”¨æ—¶æ•ˆç‡é«˜ã€‚\næ­¤å¤–ï¼Œçº¿ç¨‹ä¸é”æ¨¡å‹ä¹Ÿå¯è½»æ¾çš„é›†æˆåˆ°å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ã€‚\n\n### ç¼ºç‚¹\n\n1. çº¿ç¨‹ä¸é”æ¨¡å‹æ²¡æœ‰ä¸ºå¹¶è¡Œæä¾›ç›´æ¥çš„æ”¯æŒ\n2. çº¿ç¨‹ä¸é”æ¨¡å‹åªæ”¯æŒå…±äº«å†…å­˜æ¨¡å‹ï¼Œå¦‚æœè¦æ”¯æŒåˆ†å¸ƒå¼å†…å­˜æ¨¡å‹ï¼Œå°±éœ€è¦å¯»æ±‚å…¶ä»–æŠ€æœ¯çš„å¸®åŠ©ã€‚\n3. ç”¨çº¿ç¨‹ä¸é”æ¨¡å‹ç¼–å†™çš„ä»£ç éš¾ä»¥æµ‹è¯•ï¼ˆæ¯”å¦‚æ­»é”é—®é¢˜å¯èƒ½å¾ˆä¹…æ‰ä¼šå‡ºç°ï¼‰ï¼Œå‡ºäº†é—®é¢˜åå¾ˆéš¾æ‰¾åˆ°é—®é¢˜åœ¨å“ªï¼Œå¹¶ä¸”bugéš¾ä»¥å¤ç°\n4. ä»£ç éš¾ä»¥ç»´æŠ¤ï¼ˆè¦ä¿è¯æ‰€æœ‰å¯¹è±¡çš„åŒæ­¥éƒ½æ˜¯æ­£ç¡®çš„ã€å¿…é¡»æŒ‰  é¡ºåºæ¥è·å–å¤šæŠŠé”ã€æŒæœ‰é”æ—¶ä¸è°ƒç”¨å¤–æ˜Ÿæ–¹æ³•ã€‚è¿˜è¦ä¿è¯ç»´æŠ¤ä»£ç çš„å¼€å‘è€…éƒ½éµå®ˆè¿™ä¸ªè§„åˆ™\n\n\n## å‚è€ƒé“¾æ¥\n\n* [Letâ€™s Synchronize Threads in Python](https://hackernoon.com/synchronization-primitives-in-python-564f89fee732?gi=ce162d119247)\n* [å“²å­¦å®¶è¿›é¤é—®é¢˜](https://zh.wikipedia.org/wiki/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%B0%B1%E9%A4%90%E9%97%AE%E9%A2%98)\n\n#### References\n\n[1] å“²å­¦å®¶è¿›é¤é—®é¢˜: https://zh.wikipedia.org/wiki/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%B0%B1%E9%A4%90%E9%97%AE%E9%A2%98\n[2] Letâ€™s Synchronize Threads in Python: https://hackernoon.com/synchronization-primitives-in-python-564f89fee732?gi=ce162d119247\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å¹¶å‘æ¨¡å‹ï¼šçº¿ç¨‹ä¸é”",
        "date": "2019-05-19 12:29:39",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "å¹¶å‘"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "concurrency-models-thread-and-lock"
    },
    {
      "content": "\n\n> Json web token (JWT), æ ¹æ®å®˜ç½‘çš„å®šä¹‰ï¼Œæ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆ(RFC 7519).è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚\n> è¯¦ç»†ä»‹ç»å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç«  [ç†è§£JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯åŠå®è·µ](https://mp.weixin.qq.com/s/gUgh_kmMu0Hmobeah7wNLQ)\n\n## JWT ç‰¹ç‚¹\n\n### ä¼˜ç‚¹\n\n* ä½“ç§¯å°ï¼Œå› è€Œä¼ è¾“é€Ÿåº¦å¿«\n* ä¼ è¾“æ–¹å¼å¤šæ ·ï¼Œå¯ä»¥é€šè¿‡URL/POSTå‚æ•°/HTTPå¤´éƒ¨ç­‰æ–¹å¼ä¼ è¾“\n* ä¸¥æ ¼çš„ç»“æ„åŒ–ã€‚å®ƒè‡ªèº«ï¼ˆåœ¨ payload ä¸­ï¼‰å°±åŒ…å«äº†æ‰€æœ‰ä¸ç”¨æˆ·ç›¸å…³çš„éªŒè¯æ¶ˆæ¯ï¼Œå¦‚ç”¨æˆ·å¯è®¿é—®è·¯ç”±ã€è®¿é—®æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ— éœ€å†å»è¿æ¥æ•°æ®åº“éªŒè¯ä¿¡æ¯çš„æœ‰æ•ˆæ€§ï¼Œå¹¶ä¸” payload æ”¯æŒä¸ºä½ çš„åº”ç”¨è€Œå®šåˆ¶åŒ–ã€‚\n* æ”¯æŒè·¨åŸŸéªŒè¯ï¼Œå¯ä»¥åº”ç”¨äºå•ç‚¹ç™»å½•ã€‚\n\n### å­˜åœ¨çš„é—®é¢˜\n\nJWT è‡ªèº«ï¼ˆåœ¨ payload ä¸­ï¼‰å°±åŒ…å«äº†æ‰€æœ‰ä¸ç”¨æˆ·ç›¸å…³çš„éªŒè¯æ¶ˆæ¯ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ä¸éœ€è¦ä¿å­˜ã€‚è¿™ç§è®¾è®¡å­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š\n\n1. Tokenä¸èƒ½æ’¤é”€--å®¢æˆ·ç«¯é‡ç½®å¯†ç åä¹‹å‰çš„JWTä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼ˆJWT å¹¶æ²¡æœ‰è¿‡æœŸæˆ–è€…å¤±æ•ˆ\n2. ä¸æ”¯æŒrefresh tokenï¼ŒJWTè¿‡æœŸåéœ€è¦æ‰§è¡Œç™»å½•æˆæƒçš„å®Œæ•´æµç¨‹\n3. æ— æ³•çŸ¥é“ç”¨æˆ·ç­¾å‘äº†å‡ ä¸ªJWT\n\né’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¯èƒ½çš„è§£å†³æ–¹æ³•æœ‰ï¼š\n\n1. ä¿å­˜JWTåˆ°æ•°æ®åº“ï¼ˆæˆ–Redisï¼‰ï¼Œè¿™æ ·å¯ä»¥é’ˆå¯¹æ¯ä¸ªJWTå•ç‹¬æ ¡éªŒ\n2. åœ¨é‡ç½®å¯†ç ç­‰éœ€è¦ä½œåºŸä¹‹å‰å…¨éƒ¨JWTæ—¶ï¼ŒæŠŠæ“ä½œæ—¶é—´ç‚¹è®°å½•åˆ°æ•°æ®åº“ï¼ˆæˆ–Redisï¼‰ï¼Œæ ¡éªŒJWTæ—¶åŒæ—¶åˆ¤æ–­æ­¤JWTåˆ›å»ºä¹‹åæœ‰æ²¡æœ‰è¿‡é‡ç½®å¯†ç ç­‰ç±»ä¼¼æ“ä½œï¼Œå¦‚æœæœ‰æ ¡éªŒä¸é€šè¿‡\n\n\nå½“ç„¶ï¼Œè¿™ç§è§£å†³æ–¹æ³•éƒ½ä¼šå¤šä¸€æ¬¡æ•°æ®åº“è¯·æ±‚ï¼ŒJWTè‡ªèº«å¯æ ¡éªŒçš„ä¼˜åŠ¿ä¼šæœ‰æ‰€å‡å°‘ï¼ŒåŒæ—¶ä¹Ÿä¼šå½±å“è®¤è¯æ•ˆç‡ã€‚\n\nè¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼ˆä¸æ”¯æŒrefresh tokenï¼‰çš„æ€è·¯ã€‚\n\n### refresh token\n\nrefresh tokenæ˜¯OAuth2 è®¤è¯ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå’ŒOAuth2 çš„access token ä¸€èµ·ç”Ÿæˆï¼Œè¡¨ç¤ºæ›´æ–°ä»¤ç‰Œï¼Œè¿‡æœŸæ‰€éœ€æ—¶é—´æ¯”access toen è¦é•¿ï¼Œå¯ä»¥ç”¨æ¥è·å–ä¸‹ä¸€æ¬¡çš„access tokenã€‚\n\nå¦‚æœJWT éœ€è¦æ·»åŠ  refresh tokenæ”¯æŒï¼Œrefresh tokenéœ€è¦æ»¡è¶³çš„æ¡ä»¶æœ‰ä¸€ä¸‹å‡ é¡¹ï¼š\n\n1. å’ŒJWTä¸€èµ·ç”Ÿæˆè¿”å›ç»™å®¢æˆ·ç«¯\n2. æœ‰å®æ•ˆæ—¶é—´ï¼Œæœ‰æ•ˆæ—¶é—´æ¯”JWTè¦é•¿\n3. åªèƒ½ç”¨æ¥æ¢å–ä¸‹ä¸€æ¬¡JWTï¼Œä¸èƒ½ç”¨äºè®¿é—®è®¤è¯\n4. ä¸èƒ½é‡å¤ä½¿ç”¨ï¼ˆå¯é€‰ï¼‰\n\n\n#### refresh token è·å–æµç¨‹\n\n![](http://media.gusibi.mobi/kY3mm6nLAlHkGDxHJF1WLctLSbp9eA-6iirdYBlC0CDwMcq_rTPsCWpAhmWUr_nJ)\n\n#### refresh token ä½¿ç”¨æµç¨‹\n\n![](http://media.gusibi.mobi/-PJDYI_rQ-EiYl6aGJ-_zPtkgKY9nRnBnShAj47rsoEY115E8IRlM4zMuOvx70zi)\n\n## ä»£ç ç¤ºä¾‹\n\n```python\nimport jwt\nimport time\n\n# ä½¿ç”¨ sanic ä½œä¸ºrestful api æ¡†æ¶ \ndef create_token(account_id, username):\n    payload = {\n        \"iss\": \"gusibi.mobi\",\n        \"iat\": int(time.time()),\n        \"exp\": int(time.time()) + 86400 * 7,\n        \"aud\": \"www.gusibi.mobi\",\n        \"sub\": account_id,\n        \"username\": username,\n        \"scopes\": ['open']\n    }\n    token = jwt.encode(payload, 'secret', algorithm='HS256')\n    payload['grant_type'] = \"refresh\"\n    refresh_token = jwt.encode(payload, 'secret', algorithm='HS256')\n    return True, {\n        'access_token': token,\n        'account_id': account_id,\n        \"refresh_token\": refresh_token\n        }\n\n# éªŒè¯refresh token å‡ºå¦æœ‰æ•ˆ\ndef verify_refresh_token(token):\n    payload = jwt.decode(token, 'secret', audience='www.gusibi.com', algorithms=['HS256'])\n    # æ ¡éªŒtoken æ˜¯å¦æœ‰æ•ˆï¼Œä»¥åŠæ˜¯å¦æ˜¯refresh tokenï¼ŒéªŒè¯é€šè¿‡åç”Ÿæˆæ–°çš„token ä»¥åŠ refresh_token\n    if payload and payload.get('grant_type') == 'refresh':\n        # å¦‚æœéœ€è¦æ ‡è®°æ­¤token å·²ç»ä½¿ç”¨ï¼Œéœ€è¦å€ŸåŠ©redis æˆ–è€…æ•°æ®åº“ï¼ˆæ¨èredisï¼‰\n        return True, payload\n    return False, None\n\n# éªŒè¯token æ˜¯å¦æœ‰æ•ˆ\ndef verify_bearer_token(token):\n    #  å¦‚æœåœ¨ç”Ÿæˆtokençš„æ—¶å€™ä½¿ç”¨äº†audå‚æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒçš„æ—¶å€™ä¹Ÿéœ€è¦æ·»åŠ æ­¤å‚æ•°\n    payload = jwt.decode(token, 'secret', audience='www.gusibi.com', algorithms=['HS256'])\n    # æ ¡éªŒtoken æ˜¯å¦æœ‰æ•ˆï¼Œä»¥åŠä¸èƒ½æ˜¯refresh token\n    if payload and not payload.get('grant_type') == 'refresh':\n        return True, payload\n    return False, None\n```\n\n\n## å‚è€ƒé“¾æ¥\n\n* [ç†è§£JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯åŠå®è·µ](https://mp.weixin.qq.com/s/gUgh_kmMu0Hmobeah7wNLQ)\n* [ç†è§£OAuth 2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)[1] \n\nReferences\n[1] ç†è§£OAuth 2.0: http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html\n\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "JWT RefreshToken å®è·µ",
        "date": "2019-04-29 13:05:57",
        "tags": [
          "restful",
          "tutorial",
          "åç«¯"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "jwt-refresh-token"
    },
    {
      "content": "\n\n`go modules` æ˜¯ golang 1.11 æ–°åŠ çš„ç‰¹æ€§ã€‚ç°åœ¨1.12 å·²ç»å‘å¸ƒäº†ï¼Œæ˜¯æ—¶å€™ç”¨èµ·æ¥äº†ã€‚Moduleså®˜æ–¹å®šä¹‰ä¸ºï¼š\n\n> æ¨¡å—æ˜¯ç›¸å…³GoåŒ…çš„é›†åˆã€‚modulesæ˜¯æºä»£ç äº¤æ¢å’Œç‰ˆæœ¬æ§åˆ¶çš„å•å…ƒã€‚ goå‘½ä»¤ç›´æ¥æ”¯æŒä½¿ç”¨modulesï¼ŒåŒ…æ‹¬è®°å½•å’Œè§£æå¯¹å…¶ä»–æ¨¡å—çš„ä¾èµ–æ€§ã€‚modulesæ›¿æ¢æ—§çš„åŸºäºGOPATHçš„æ–¹æ³•æ¥æŒ‡å®šåœ¨ç»™å®šæ„å»ºä¸­ä½¿ç”¨å“ªäº›æºæ–‡ä»¶ã€‚\n\n## å¦‚ä½•ä½¿ç”¨ Modules ï¼Ÿ\n\n1. æŠŠ golang å‡çº§åˆ° 1.11ï¼ˆç°åœ¨1.12 å·²ç»å‘å¸ƒäº†ï¼Œå»ºè®®ä½¿ç”¨1.12ï¼‰\n2. è®¾ç½® `GO111MODULE`\n\nGO111MODULE\n\n`GO111MODULE` æœ‰ä¸‰ä¸ªå€¼ï¼š`off`, `on`å’Œ`autoï¼ˆé»˜è®¤å€¼ï¼‰`ã€‚\n\n* `GO111MODULE=off`ï¼Œgoå‘½ä»¤è¡Œå°†ä¸ä¼šæ”¯æŒmoduleåŠŸèƒ½ï¼Œå¯»æ‰¾ä¾èµ–åŒ…çš„æ–¹å¼å°†ä¼šæ²¿ç”¨æ—§ç‰ˆæœ¬é‚£ç§é€šè¿‡vendorç›®å½•æˆ–è€…GOPATHæ¨¡å¼æ¥æŸ¥æ‰¾ã€‚\n* `GO111MODULE=on`ï¼Œgoå‘½ä»¤è¡Œä¼šä½¿ç”¨modulesï¼Œè€Œä¸€ç‚¹ä¹Ÿä¸ä¼šå»GOPATHç›®å½•ä¸‹æŸ¥æ‰¾ã€‚\n* `GO111MODULE=auto`ï¼Œé»˜è®¤å€¼ï¼Œgoå‘½ä»¤è¡Œå°†ä¼šæ ¹æ®å½“å‰ç›®å½•æ¥å†³å®šæ˜¯å¦å¯ç”¨moduleåŠŸèƒ½ã€‚è¿™ç§æƒ…å†µä¸‹å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å½¢ï¼š\n    - å½“å‰ç›®å½•åœ¨GOPATH/srcä¹‹å¤–ä¸”è¯¥ç›®å½•åŒ…å«go.modæ–‡ä»¶\n    - å½“å‰æ–‡ä»¶åœ¨åŒ…å«go.modæ–‡ä»¶çš„ç›®å½•ä¸‹é¢ã€‚\n\n> å½“modules åŠŸèƒ½å¯ç”¨æ—¶ï¼Œä¾èµ–åŒ…çš„å­˜æ”¾ä½ç½®å˜æ›´ä¸º`$GOPATH/pkg`ï¼Œå…è®¸åŒä¸€ä¸ªpackageå¤šä¸ªç‰ˆæœ¬å¹¶å­˜ï¼Œä¸”å¤šä¸ªé¡¹ç›®å¯ä»¥å…±äº«ç¼“å­˜çš„ moduleã€‚\n\n### go mod\n\ngolang æä¾›äº† `go mod`å‘½ä»¤æ¥ç®¡ç†åŒ…ã€‚\n\ngo mod æœ‰ä»¥ä¸‹å‘½ä»¤ï¼š\n\n| å‘½ä»¤ | è¯´æ˜ |\n| --- | --- |\n|download  | download modules to local cache(ä¸‹è½½ä¾èµ–åŒ…) |\n| edit | edit go.mod from tools or scriptsï¼ˆç¼–è¾‘go.mod |\n| graph | print module requirement graph (æ‰“å°æ¨¡å—ä¾èµ–å›¾)|\n| init | initialize new module in current directoryï¼ˆåœ¨å½“å‰ç›®å½•åˆå§‹åŒ–modï¼‰ |\n| tidy | add missing and remove unused modules(æ‹‰å–ç¼ºå°‘çš„æ¨¡å—ï¼Œç§»é™¤ä¸ç”¨çš„æ¨¡å—) |\n| vendor  | make vendored copy of dependencies(å°†ä¾èµ–å¤åˆ¶åˆ°vendorä¸‹) |\n| verify | verify dependencies have expected content (éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®ï¼‰ |\n| why | explain why packages or modules are needed(è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–) |\n\n## å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨\n\n### ç¤ºä¾‹ä¸€ï¼šåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®\n\n1. åœ¨`GOPATH ç›®å½•ä¹‹å¤–`æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶ä½¿ç”¨`go mod init` åˆå§‹åŒ–ç”Ÿæˆ`go.mod` æ–‡ä»¶\n\n```sh\nâœ  ~ mkdir hello\nâœ  ~ cd hello\nâœ  hello go mod init hello\ngo: creating new go.mod: module hello\nâœ  hello ls\ngo.mod\nâœ  hello cat go.mod\nmodule hello\n\ngo 1.12\n```\n\n> go.modæ–‡ä»¶ä¸€æ—¦åˆ›å»ºåï¼Œå®ƒçš„å†…å®¹å°†ä¼šè¢«go toolchainå…¨é¢æŒæ§ã€‚go toolchainä¼šåœ¨å„ç±»å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œæ¯”å¦‚go getã€go buildã€go modç­‰ä¿®æ”¹å’Œç»´æŠ¤go.modæ–‡ä»¶ã€‚\n\ngo.mod æä¾›äº†`module`, `require`ã€`replace`å’Œ`exclude` å››ä¸ªå‘½ä»¤\n\n* `module`  è¯­å¥æŒ‡å®šåŒ…çš„åå­—ï¼ˆè·¯å¾„ï¼‰\n* `require` è¯­å¥æŒ‡å®šçš„ä¾èµ–é¡¹æ¨¡å—\n* `replace` è¯­å¥å¯ä»¥æ›¿æ¢ä¾èµ–é¡¹æ¨¡å—\n* `exclude` è¯­å¥å¯ä»¥å¿½ç•¥ä¾èµ–é¡¹æ¨¡å—\n\n2. æ·»åŠ ä¾èµ–\n\næ–°å»ºä¸€ä¸ª server.go æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```go\npackage main\n\nimport (\n\t\"net/http\"\n\t\n\t\"github.com/labstack/echo\"\n)\n\nfunc main() {\n\te := echo.New()\n\te.GET(\"/\", func(c echo.Context) error {\n\t\treturn c.String(http.StatusOK, \"Hello, World!\")\n\t})\n\te.Logger.Fatal(e.Start(\":1323\"))\n}\n```\n\næ‰§è¡Œ `go run server.go` è¿è¡Œä»£ç ä¼šå‘ç° go mod ä¼šè‡ªåŠ¨æŸ¥æ‰¾ä¾èµ–è‡ªåŠ¨ä¸‹è½½ï¼š\n\n```sh\n$ go run server.go\ngo: finding github.com/labstack/echo v3.3.10+incompatible\ngo: downloading github.com/labstack/echo v3.3.10+incompatible\ngo: extracting github.com/labstack/echo v3.3.10+incompatible\ngo: finding github.com/labstack/gommon/color latest\ngo: finding github.com/labstack/gommon/log latest\ngo: finding github.com/labstack/gommon v0.2.8\n# æ­¤å¤„çœç•¥å¾ˆå¤šè¡Œ\n...\n\n   ____    __\n  / __/___/ /  ___\n / _// __/ _ \\/ _ \\\n/___/\\__/_//_/\\___/ v3.3.10-dev\nHigh performance, minimalist Go web framework\nhttps://echo.labstack.com\n____________________________________O/_______\n                                    O\\\nâ‡¨ http server started on [::]:1323\n```\n\nç°åœ¨æŸ¥çœ‹go.mod å†…å®¹ï¼š\n\n```go\n$ cat go.mod\n\nmodule hello\n\ngo 1.12\n\nrequire (\n\tgithub.com/labstack/echo v3.3.10+incompatible // indirect\n\tgithub.com/labstack/gommon v0.2.8 // indirect\n\tgithub.com/mattn/go-colorable v0.1.1 // indirect\n\tgithub.com/mattn/go-isatty v0.0.7 // indirect\n\tgithub.com/valyala/fasttemplate v1.0.0 // indirect\n\tgolang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a // indirect\n)\n```\n\ngo module å®‰è£… package çš„åŸå‰‡æ˜¯å…ˆæ‹‰æœ€æ–°çš„ release tagï¼Œè‹¥æ— tagåˆ™æ‹‰æœ€æ–°çš„commitï¼Œè¯¦è§ [Moduleså®˜æ–¹ä»‹ç»](https://github.com/golang/go/wiki/Modules)ã€‚ go ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª go.sum æ–‡ä»¶æ¥è®°å½• dependency treeï¼š\n\n```shell\n$ cat go.sum\ngithub.com/labstack/echo v3.3.10+incompatible h1:pGRcYk231ExFAyoAjAfD85kQzRJCRI8bbnE7CX5OEgg=\ngithub.com/labstack/echo v3.3.10+incompatible/go.mod h1:0INS7j/VjnFxD4E2wkz67b8cVwCLbBmJyDaka6Cmk1s=\ngithub.com/labstack/gommon v0.2.8 h1:JvRqmeZcfrHC5u6uVleB4NxxNbzx6gpbJiQknDbKQu0=\ngithub.com/labstack/gommon v0.2.8/go.mod h1:/tj9csK2iPSBvn+3NLM9e52usepMtrd5ilFYA+wQNJ4=\ngithub.com/mattn/go-colorable v0.1.1 h1:G1f5SKeVxmagw/IyvzvtZE4Gybcc4Tr1tf7I8z0XgOg=\ngithub.com/mattn/go-colorable v0.1.1/go.mod h1:FuOcm+DKB9mbwrcAfNl7/TZVBZ6rcnceauSikq3lYCQ=\n... çœç•¥å¾ˆå¤šè¡Œ\n```\n\n3. å†æ¬¡æ‰§è¡Œè„šæœ¬ `go run server.go` å‘ç°è·³è¿‡äº†æ£€æŸ¥å¹¶å®‰è£…ä¾èµ–çš„æ­¥éª¤ã€‚\n4. å¯ä»¥ä½¿ç”¨å‘½ä»¤ `go list -m -u all` æ¥æ£€æŸ¥å¯ä»¥å‡çº§çš„packageï¼Œä½¿ç”¨`go get -u need-upgrade-package` å‡çº§åä¼šå°†æ–°çš„ä¾èµ–ç‰ˆæœ¬æ›´æ–°åˆ°go.mod\n        * ä¹Ÿå¯ä»¥ä½¿ç”¨ `go get -u` å‡çº§æ‰€æœ‰ä¾èµ–\n\n\n#### go get å‡çº§\n\n* è¿è¡Œ go get -u å°†ä¼šå‡çº§åˆ°æœ€æ–°çš„æ¬¡è¦ç‰ˆæœ¬æˆ–è€…ä¿®è®¢ç‰ˆæœ¬(x.y.z, zæ˜¯ä¿®è®¢ç‰ˆæœ¬å·ï¼Œ yæ˜¯æ¬¡è¦ç‰ˆæœ¬å·)\n* è¿è¡Œ go get -u=patch å°†ä¼šå‡çº§åˆ°æœ€æ–°çš„ä¿®è®¢ç‰ˆæœ¬\n* è¿è¡Œ go get package@version å°†ä¼šå‡çº§åˆ°æŒ‡å®šçš„ç‰ˆæœ¬å·version\n* è¿è¡Œgo getå¦‚æœæœ‰ç‰ˆæœ¬çš„æ›´æ”¹ï¼Œé‚£ä¹ˆgo.modæ–‡ä»¶ä¹Ÿä¼šæ›´æ”¹\n\n\n### ç¤ºä¾‹äºŒï¼šæ”¹é€ ç°æœ‰é¡¹ç›®(helloword)\n\né¡¹ç›®ç›®å½•ä¸ºï¼š\n\n```shell\n$ tree\n.\nâ”œâ”€â”€ api\nâ”‚   â””â”€â”€ apis.go\nâ””â”€â”€ server.go\n\n1 directory, 2 files\n```\n\nserver.go æºç ä¸ºï¼š\n\n```go\npackage main\n\nimport (\n    api \"./api\"  // è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„\n    \"github.com/labstack/echo\"\n)\n\nfunc main() {\n    e := echo.New()\n    e.GET(\"/\", api.HelloWorld)\n    e.Logger.Fatal(e.Start(\":1323\"))\n}\n```\n\napi/apis.go æºç ä¸ºï¼š\n\n```go\npackage api\n\nimport (\n    \"net/http\"\n\n    \"github.com/labstack/echo\"\n)\n\nfunc HelloWorld(c echo.Context) error {\n    return c.JSON(http.StatusOK, \"hello world\")\n}\n```\n\n1. ä½¿ç”¨ `go mod init ***` åˆå§‹åŒ–go.mod\n\n```shell\n$ go mod init helloworld\ngo: creating new go.mod: module helloworld\n```\n\n2. è¿è¡Œ `go run server.go`\n\n```shell\ngo: finding github.com/labstack/gommon/color latest\ngo: finding github.com/labstack/gommon/log latest\ngo: finding golang.org/x/crypto/acme/autocert latest\ngo: finding golang.org/x/crypto/acme latest\ngo: finding golang.org/x/crypto latest\nbuild command-line-arguments: cannot find module for path _/home/gs/helloworld/api\n```\n\né¦–å…ˆè¿˜æ˜¯ä¼šæŸ¥æ‰¾å¹¶ä¸‹è½½å®‰è£…ä¾èµ–ï¼Œç„¶åè¿è¡Œè„šæœ¬ `server.go`ï¼Œè¿™é‡Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼š\n\n```shell\nbuild command-line-arguments: cannot find module for path _/home/gs/helloworld/api\n```\nä½†æ˜¯`go.mod` å·²ç»æ›´æ–°ï¼š\n\n```json\n$ cat go.mod\nmodule helloworld\n\ngo 1.12\n\nrequire (\n        github.com/labstack/echo v3.3.10+incompatible // indirect\n        github.com/labstack/gommon v0.2.8 // indirect\n        github.com/mattn/go-colorable v0.1.1 // indirect\n        github.com/mattn/go-isatty v0.0.7 // indirect\n        github.com/valyala/fasttemplate v1.0.0 // indirect\n        golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a // indirect\n)\n```\n\n##### é‚£ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºè¿™ä¸ªé”™è¯¯å‘¢ï¼Ÿ\n\nè¿™æ˜¯å› ä¸º server.go ä¸­ä½¿ç”¨ internal package çš„æ–¹æ³•è·Ÿä»¥å‰å·²ç»ä¸åŒäº†ï¼Œç”±äº go.modä¼šæ‰«æåŒå·¥ä½œç›®å½•ä¸‹æ‰€æœ‰ package å¹¶ä¸”`å˜æ›´å¼•å…¥æ–¹æ³•`ï¼Œå¿…é¡»å°† helloworldå½“æˆè·¯å¾„çš„å‰ç¼€ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å†™æˆ import helloworld/apiï¼Œä»¥å¾€ GOPATH/dep æ¨¡å¼å…è®¸çš„ import ./api å·²ç»å¤±æ•ˆï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹è¿™ä¸ª [issue](https://github.com/golang/go/issues/26645)ã€‚\n\n3. æ›´æ–°æ—§çš„package import æ–¹å¼\n\næ‰€ä»¥server.go éœ€è¦æ”¹å†™æˆï¼š\n\n```go\npackage main\n\nimport (\n    api \"helloworld/api\"  // è¿™æ˜¯æ›´æ–°åçš„å¼•å…¥æ–¹æ³•\n    \"github.com/labstack/echo\"\n)\n\nfunc main() {\n    e := echo.New()\n    e.GET(\"/\", api.HelloWorld)\n    e.Logger.Fatal(e.Start(\":1323\"))\n}\n```\n\n> `ä¸€ä¸ªå°å‘`ï¼šå¼€å§‹åœ¨golang1.11 ä¸‹ä½¿ç”¨go mod é‡åˆ°è¿‡ `go build github.com/valyala/fasttemplate: module requires go 1.12` [è¿™ç§é”™è¯¯](https://github.com/golang/go/issues/27565)ï¼Œé‡åˆ°ç±»ä¼¼è¿™ç§éœ€è¦å‡çº§åˆ°1.12 çš„é—®é¢˜ï¼Œç›´æ¥å‡çº§golang1.12 å°±å¥½äº†ã€‚å¹¸äºæ˜¯åœ¨1.12 å‘å¸ƒåæ‰å°è¯•çš„`go mod` ğŸ¤·â€â™‚ï¸\n\n4. åˆ°è¿™é‡Œå°±å’Œæ–°åˆ›å»ºä¸€ä¸ªé¡¹ç›®æ²¡ä»€ä¹ˆåŒºåˆ«äº†\n\n\n## ä½¿ç”¨replaceæ›¿æ¢æ— æ³•ç›´æ¥è·å–çš„package\n\nç”±äºæŸäº›å·²çŸ¥çš„åŸå› ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„packageéƒ½èƒ½æˆåŠŸä¸‹è½½ï¼Œæ¯”å¦‚ï¼š`golang.org`ä¸‹çš„åŒ…ã€‚\n\nmodules å¯ä»¥é€šè¿‡åœ¨ go.mod æ–‡ä»¶ä¸­ä½¿ç”¨ replace æŒ‡ä»¤æ›¿æ¢æˆgithubä¸Šå¯¹åº”çš„åº“ï¼Œæ¯”å¦‚ï¼š\n\n\n```json\nreplace (\n\tgolang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a => github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a\n)\n```\n\næˆ–è€…\n\n```json\nreplace golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a => github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a\n```\n\n\n## å‚è€ƒé“¾æ¥\n\n* [Moduleså®˜æ–¹ä»‹ç»](https://github.com/golang/go/wiki/Modules)\n* [Golang 1.11 æ–°åŠŸèƒ½ä»‹ç´¹ â€“ Modules](https://www.lightblue.asia/golang-1-11-new-festures-modules/?doing_wp_cron=1552464864.6369309425354003906250)\n* [What are Go modules and how do I use them?](https://talks.godoc.org/github.com/myitcv/talks/2018-08-15-glug-modules/main.slide#1)\n* [go mod doesn't work for github.com/gomarkdown/markdown/html ](https://github.com/golang/go/issues/27565)\n* [å†æ¢go modulesï¼šä½¿ç”¨ä¸ç»†èŠ‚](https://www.cnblogs.com/apocelipes/p/10295096.html)\n* [åˆçª¥Go module](https://tonybai.com/2018/07/15/hello-go-module/)\n\n\n#### References\n\n[1] Moduleså®˜æ–¹ä»‹ç»: https://github.com/golang/go/wiki/Modules\n[2] issue: https://github.com/golang/go/issues/26645\n[3] è¿™ç§é”™è¯¯: https://github.com/golang/go/issues/27565\n[4] Moduleså®˜æ–¹ä»‹ç»: https://github.com/golang/go/wiki/Modules\n[5] Golang 1.11 æ–°åŠŸèƒ½ä»‹ç´¹ â€“ Modules: https://www.lightblue.asia/golang-1-11-new-festures-modules/?doing_wp_cron=1552464864.6369309425354003906250\n[6] What are Go modules and how do I use them?: https://talks.godoc.org/github.com/myitcv/talks/2018-08-15-glug-modules/main.slide#1\n[7] go mod doesn't work for github.com/gomarkdown/markdown/html : https://github.com/golang/go/issues/27565\n[8] å†æ¢go modulesï¼šä½¿ç”¨ä¸ç»†èŠ‚: https://www.cnblogs.com/apocelipes/p/10295096.html\n[9] åˆçª¥Go module: https://tonybai.com/2018/07/15/hello-go-module/\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Golang mod å…¥é—¨",
        "date": "2019-03-16 11:49:35",
        "tags": [
          "golang"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "golang-mod"
    },
    {
      "content": "\n\n> æœ¬æ–‡æ˜¯ã€Šåƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°ã€‹è¯»ä¹¦ç¬”è®°\n>\n> ä¸Šä¸€ç¯‡ä¸º[ã€ŠGC æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‹](https://mp.weixin.qq.com/s/mJo5ADptfDxEVoqZjUIWTw) \n\n\n### å¼•ç”¨è®¡æ•°ç®—æ³•\n\n> ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨çš„å€¼å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡1ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚è¿™ä¹Ÿå°±æ˜¯éœ€è¦å›æ”¶çš„å¯¹è±¡ã€‚\n>\n> `å¼•ç”¨è®¡æ•°ç®—æ³•`æ˜¯å¯¹è±¡è®°å½•è‡ªå·±è¢«å¤šå°‘**ç¨‹åº**å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°ä¸ºé›¶çš„å¯¹è±¡å°†è¢«æ¸…é™¤ã€‚\n>\n> `è®¡æ•°å™¨`è¡¨ç¤ºçš„æ˜¯æœ‰å¤šå°‘ç¨‹åºå¼•ç”¨äº†è¿™ä¸ªå¯¹è±¡ï¼ˆè¢«å¼•ç”¨æ•°ï¼‰ã€‚è®¡æ•°å™¨æ˜¯æ— ç¬¦å·æ•´æ•°ã€‚\n\n#### è®¡æ•°å™¨çš„å¢å‡\n\nå¼•ç”¨è®¡æ•°æ³•æ²¡æœ‰æ˜ç¡®å¯åŠ¨ GC çš„è¯­å¥ï¼Œå®ƒä¸ç¨‹åºçš„æ‰§è¡Œå¯†åˆ‡ç›¸å…³ï¼Œåœ¨ç¨‹åºçš„å¤„ç†è¿‡ç¨‹ä¸­é€šè¿‡å¢å‡è®¡æ•°å™¨çš„å€¼æ¥è¿›è¡Œå†…å­˜ç®¡ç†ã€‚\n\n\n\n##### **new_obj()** å‡½æ•°\n\nä¸`GCæ ‡è®°-æ¸…é™¤`ç®—æ³•ç›¸åŒï¼Œç¨‹åºåœ¨ç”Ÿæˆæ–°å¯¹è±¡çš„æ—¶å€™ä¼šè°ƒç”¨ new_obj()å‡½æ•°ã€‚\n\n\n\n```c\nfunc new_obj(size){\n    obj = pickup_chunk(size, $free_list)\n    \n    if(obj == NULL)\n        allocation_fail()\n    else\n        obj.ref_cnt = 1  // æ–°å¯¹è±¡ç¬¬ä¸€åªè¢«åˆ†é…æ˜¯å¼•ç”¨æ•°ä¸º1\n        return obj\n}\n```\n\n\n\nè¿™é‡Œ `pickup_chunk()`å‡½æ•°çš„ç”¨æ³•ä¸`GCæ ‡è®°-æ¸…é™¤ç®—æ³•`ä¸­çš„ç”¨æ³•å¤§è‡´ç›¸åŒã€‚ä¸åŒçš„æ˜¯è¿™é‡Œè¿”å› NULL æ—¶ï¼Œåˆ†é…å°±å¤±è´¥äº†ã€‚è¿™é‡Œ `ref_cnt` åŸŸä»£è¡¨çš„æ˜¯ obj çš„è®¡æ•°å™¨ã€‚\n\n\n\n> åœ¨å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­ï¼Œé™¤äº†è¿æ¥åˆ°ç©ºé—²é“¾è¡¨çš„å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡éƒ½æ˜¯æ´»è·ƒå¯¹è±¡ã€‚æ‰€ä»¥å¦‚æœ pickup_chunk()è¿”å› NULLï¼Œå †ä¸­ä¹Ÿå°±æ²¡æœ‰å…¶å®ƒå¤§å°åˆé€‚çš„å—äº†ã€‚\n\n\n\n##### **update_ptr()** å‡½æ•°\n\nupdate_ptr() å‡½æ•°ç”¨äºæ›´æ–°æŒ‡é’ˆ `ptr`ï¼Œä½¿å…¶æŒ‡å‘å¯¹è±¡ objï¼ŒåŒæ—¶è¿›è¡Œè®¡æ•°å™¨å€¼çš„å¢å‡ã€‚\n\n\n\n```c\nfunc update_ptr(ptr, obj){\n    inc_ref_cnt(obj)     // obj å¼•ç”¨è®¡æ•°+1\n    dec_ref_cnt(*ptr)    // pträ¹‹å‰æŒ‡å‘çš„å¯¹è±¡(*ptr)çš„å¼•ç”¨è®¡æ•°-1\n    *ptr = obj\n}\n```\n\n\n\n>  è¿™é‡Œ update_ptr ä¸ºä»€ä¹ˆéœ€è¦å…ˆè°ƒç”¨ `inc_ref_cnt`ï¼Œå†è°ƒç”¨`dec_ref_cnt`å‘¢ï¼Ÿ\n>\n> æ˜¯å› ä¸ºæœ‰å¯èƒ½ *ptrå’Œ obj å¯èƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœå…ˆè°ƒç”¨`dec_ref_cnt`å¯èƒ½ä¼šè¯¯ä¼¤ã€‚\n\n\n\n**inc_ref_cnt()**å‡½æ•°\n\nè¿™é‡Œinc_ref_cntå‡½æ•°åªå¯¹å¯¹è±¡ obj å¼•ç”¨è®¡æ•°+1\n\n```go\nfunc inc_ref_cnt(obj){\n    obj.ref_cnt++\n}\n```\n\n\n\n**dec_ref_cnt()** å‡½æ•°\n\nè¿™é‡Œ dec_ref_cnt å‡½æ•°ä¼šæŠŠä¹‹å‰å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œ-1 æ“ä½œï¼Œå¦‚æœè¿™æ—¶å¯¹è±¡çš„è®¡æ•°å™¨å˜ä¸º0ï¼Œè¯´æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªåƒåœ¾å¯¹è±¡ï¼Œéœ€è¦é”€æ¯ï¼Œé‚£ä¹ˆè¢«å®ƒå¼•ç”¨çš„å¯¹è±¡çš„è®¡æ•°å™¨å€¼éƒ½éœ€è¦ç›¸åº”çš„-1ã€‚\n\n```go\nfunc dec_ref_cnt(obj){\n    obj_ref_cnt--\n    if(obj.ref_cnt == 0)\n        for(child : children(obj))\n            dec_ref_cnt(*child)  // é€’å½’å°†è¢«éœ€è¦é”€æ¯å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡è®¡æ•°-1\n    reclaim(obj)\n}\n```\n\n\n\n![update_prt() å‡½æ•°æ‰§è¡Œæ˜¯çš„æƒ…å†µ](http://media.gusibi.mobi/txUtZf4Me8iDveCpZWKaqzhnqxhuGwmSLwX8NxfJEAa3UC1D1byrEpmfLgpAXTQp)\n\n\n\nä¸Šå›¾è¿™é‡Œå¼€å§‹æ—¶ï¼ŒA æŒ‡å‘ Bï¼Œç¬¬äºŒæ­¥ A æŒ‡å‘äº† Cã€‚å¯ä»¥çœ‹åˆ°é€šè¿‡æ›´æ–°ï¼ŒB çš„è®¡æ•°å™¨å€¼å˜ä¸ºäº†0ï¼Œå› æ­¤ B è¢«å›æ”¶ï¼ˆè¿æ¥åˆ°ç©ºé—²é“¾è¡¨ï¼‰ï¼ŒC çš„è®¡æ•°å™¨å€¼ç”±1å˜æˆäº†2ã€‚\n\n\n\n> é€šè¿‡ä¸Šè¾¹çš„ä»‹ç»ï¼Œåº”è¯¥å¯ä»¥çœ‹å‡ºå¼•ç”¨è®¡æ•°åƒåœ¾å›æ”¶çš„ç‰¹ç‚¹ã€‚\n>\n> 1. åœ¨å˜æ›´æ•°ç»„å…ƒç´ çš„æ—¶å€™ä¼šè¿›è¡ŒæŒ‡é’ˆæ›´æ–°\n> 2. é€šè¿‡æ›´æ–°æ‰§è¡Œè®¡æ•°å¯èƒ½ä¼šäº§ç”Ÿæ²¡æœ‰è¢«ä»»ä½•ç¨‹åºå¼•ç”¨çš„åƒåœ¾å¯¹è±¡\n> 3. å¼•ç”¨è®¡æ•°ç®—æ³•ä¼šæ—¶åˆ»ç›‘æ§æ›´æ–°æŒ‡é’ˆæ˜¯å¦ä¼šäº§ç”Ÿåƒåœ¾å¯¹è±¡ï¼Œä¸€æ—¦ç”Ÿæˆä¼šç«‹åˆ»è¢«å›æ”¶ã€‚\n>\n> æ‰€ä»¥å¦‚æœè°ƒç”¨ `pickup_chunk`å‡½æ•°è¿”å› NULLï¼Œè¯´æ˜å †ä¸­æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯æ´»è·ƒå¯¹è±¡ã€‚\n\n\n\n#### å¼•ç”¨è®¡æ•°ç®—æ³•çš„ä¼˜ç‚¹\n\n1. å¯ç«‹å³å›æ”¶åƒåœ¾\n\n   > æ¯ä¸ªå¯¹è±¡éƒ½çŸ¥é“è‡ªå·±çš„å¼•ç”¨è®¡æ•°ï¼Œå½“å˜ä¸º0æ—¶å¯ä»¥ç«‹å³å›æ”¶ï¼Œå°†è‡ªå·±æ¥åˆ°ç©ºé—²é“¾è¡¨\n\n2. æœ€å¤§æš‚åœæ—¶é—´çŸ­\n\n   > å› ä¸ºåªè¦ç¨‹åºæ›´æ–°æŒ‡é’ˆæ—¶ç¨‹åºå°±ä¼šæ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡é€šè¿‡æ‰§è¡Œç¨‹åºç”Ÿæˆåƒåœ¾æ—¶ï¼Œè¿™äº›åƒåœ¾éƒ½ä¼šè¢«å›æ”¶ï¼Œå†…å­˜ç®¡ç†çš„å¼€é”€åˆ†å¸ƒäºæ•´ä¸ªåº”ç”¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæ— éœ€æŒ‚èµ·åº”ç”¨ç¨‹åºçš„è¿è¡Œæ¥åšï¼Œå› æ­¤æ¶ˆå‡äº†æœ€å¤§æš‚åœæ—¶é—´ï¼ˆä½†æ˜¯å¢å¤šäº†åƒåœ¾å›æ”¶çš„æ¬¡æ•°ï¼‰\n   >\n   > > `æœ€å¤§æš‚åœæ—¶é—´`ï¼Œå› æ‰§è¡Œ GC è€Œæš‚åœæ‰§è¡Œç¨‹åºçš„æœ€é•¿æ—¶é—´ã€‚\n\n3. ä¸éœ€è¦æ²¿æŒ‡é’ˆæŸ¥æ‰¾\n\n   > äº§ç”Ÿçš„åƒåœ¾ç«‹å³å°±è¿æ¥åˆ°äº†ç©ºé—²é“¾è¡¨ï¼Œæ‰€ä»¥ä¸éœ€è¦æŸ¥æ‰¾å“ªäº›å¯¹è±¡æ˜¯éœ€è¦å›æ”¶çš„\n\n#### å¼•ç”¨è®¡æ•°ç®—æ³•çš„ç¼ºç‚¹\n\n1. è®¡æ•°å™¨å€¼çš„å¢å‡å¤„ç†é¢‘ç¹\n\n   > å› ä¸ºæ¯æ¬¡å¯¹è±¡æ›´æ–°éƒ½éœ€è¦å¯¹è®¡æ•°å™¨è¿›è¡Œå¢å‡ï¼Œç‰¹åˆ«æ˜¯è¢«å¼•ç”¨æ¬¡æ•°å¤šçš„å¯¹è±¡ã€‚\n\n2. è®¡æ•°å™¨éœ€è¦å ç”¨å¾ˆå¤šä½\n\n   > è®¡æ•°å™¨çš„å€¼æœ€å¤§å¿…é¡»è¦èƒ½æ•°å®Œå †ä¸­æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨æ•°ã€‚æ¯”å¦‚æˆ‘ä»¬ç”¨çš„æœºå™¨æ˜¯32ä½ï¼Œé‚£ä¹ˆæç«¯æƒ…å†µï¼Œå¯èƒ½éœ€è¦è®©2çš„32æ¬¡æ–¹ä¸ªå¯¹è±¡åŒæ—¶å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚è¿™å°±å¿…é¡»è¦ç¡®ä¿å„å¯¹è±¡çš„è®¡æ•°å™¨æœ‰32ä½å¤§å°ã€‚ä¹Ÿå°±æ˜¯å¯¹äºæ‰€æœ‰å¯¹è±¡ï¼Œå¿…é¡»ä¿ç•™32ä½çš„ç©ºé—´ã€‚\n   >\n   > å‡å¦‚å¯¹è±¡åªæœ‰ä¸¤ä¸ªåŸŸï¼Œé‚£ä¹ˆå…¶è®¡æ•°å™¨å°±å ç”¨äº†æ•´ä½“çš„1/3ã€‚\n\n3. å¾ªç¯å¼•ç”¨æ— æ³•å›æ”¶\n\n   > è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œå¾ªç¯å¼•ç”¨ä¼šè®©è®¡æ•°å™¨æœ€å°å€¼ä¸º1ï¼Œä¸ä¼šå˜ä¸º0ã€‚\n\n\n\n#### å¾ªç¯å¼•ç”¨\n\n\n\n```python\nclass Person{  // å®šä¹‰ Person ç±»\n    string name\n    Person lover\n}\n\nlilw = new Person(\"æé›·\")    // ç”Ÿæˆ person ç±»çš„å®ä¾‹ lilw\nhjmmwmw = new Person(\"éŸ©æ¢…æ¢…\") // ç”Ÿæˆ person ç±»çš„å®ä¾‹ hjmwmw\n\nlilw.lover = hjmwmw   // lilw å¼•ç”¨ hjmwmw\nhjmwmw.lover = lilw   // hjmwmw å¼•ç”¨ lilw\n\n```\n\n\n\nåƒè¿™æ ·ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œæ‰€ä»¥å„ä¸ªå¯¹è±¡çš„è®¡æ•°å™¨éƒ½ä¸º1ï¼Œä¸”è¿™äº›å¯¹è±¡æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ã€‚æ‰€ä»¥è®¡æ•°å™¨æœ€å°å€¼ä¹Ÿä¸º1ï¼Œä¸å¯èƒ½ä¸º0ã€‚\n\n\n\n### å»¶è¿Ÿå¼•ç”¨è®¡æ•°æ³•\n\n\n\nå¼•ç”¨è®¡æ•°æ³•è™½ç„¶ç¼©å°äº†`æœ€å¤§æš‚åœæ—¶é—´`ï¼Œä½†æ˜¯`è®¡æ•°å™¨çš„å¢å‡å¤„ç†`ç‰¹åˆ«å¤šã€‚ä¸ºäº†æ”¹å–„è¿™ä¸ªç¼ºç‚¹ï¼Œ`å»¶è¿Ÿå¼•ç”¨è®¡æ•°æ³•(Deferred Reference Counting)`è¢«ç ”ç©¶äº†å‡ºæ¥ã€‚\n\n\n\né€šè¿‡ä¸Šè¾¹çš„æè¿°ï¼Œå¯ä»¥çŸ¥é“ä¹‹æ‰€ä»¥è®¡æ•°å™¨å¢å‡å¤„ç†ç‰¹åˆ«ç¹é‡ï¼Œæ˜¯å› ä¸ºæœ‰äº›å¢å‡æ˜¯æ ¹å¼•ç”¨çš„å˜åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®©æ ¹å¼•ç”¨çš„æŒ‡é’ˆå˜åŒ–ä¸åæ˜ åœ¨è®¡æ•°å™¨ä¸Šã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠ `update_ptr($ptr, obj)`æ”¹å†™æˆ`*$ptr = obj`ï¼Œè¿™æ ·é¢‘ç¹é‡å†™å¯¹é‡å¯¹è±¡ä¸­å¼•ç”¨å…³ç³»æ—¶ï¼Œè®¡æ•°å™¨ä¹Ÿä¸éœ€è¦ä¿®æ”¹ã€‚ä½†æ˜¯è¿™æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯è®¡æ•°å™¨å¹¶ä¸èƒ½æ­£ç¡®åæ˜ å‡ºå¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°ï¼Œå¯¹è±¡ä»åœ¨æ´»åŠ¨ï¼Œå´è¢«å›æ”¶ã€‚\n\n\n\nåœ¨**å»¶è¿Ÿå¼•ç”¨è®¡æ•°æ³•**ä¸­ä½¿ç”¨`ZCT(Zero Count Table)`ï¼Œæ¥ä¿®æ­£è¿™ä¸€é”™è¯¯ã€‚\n\n> ZCT æ˜¯ä¸€ä¸ªè¡¨ï¼Œå®ƒä¼šäº‹å…ˆè®°å½•ä¸‹è®¡æ•°å™¨åœ¨ `dec_ref_cnt()`å‡½æ•°ä½œç”¨ä¸‹å˜æˆ 0 çš„å¯¹è±¡ã€‚\n\n\n\n![ZCT](http://media.gusibi.mobi/R24lHD7lfMxlk4zSb5OE5gbhXy6YDtoMdjmdwMpEaX5uo_rRofrRZmqHcF5c99xD)\n\n#### dec_ref_cnt å‡½æ•°\n\nåœ¨å»¶è¿Ÿå¼•ç”¨è®¡æ•°æ³•ä¸­ï¼Œå¼•ç”¨è®¡æ•°ä¸º0 çš„å¯¹è±¡å¹¶ä¸ä¸€å®šæ˜¯åƒåœ¾ï¼Œä¼šå…ˆå­˜å…¥åˆ° zct ä¸­ä¿ç•™ã€‚\n\n```go\nfunc dec_ref_cnt(obj){\n    obj_ref_cnt--\n    if(obj.ref_cnt == 0) //å¼•ç”¨è®¡æ•°ä¸º0 å…ˆå­˜å…¥åˆ° $zct ä¸­ä¿ç•™\n        if(is_full($zct) == TRUE) // å¦‚æœ $zct è¡¨å·²ç»æ»¡äº† å…ˆæ‰«æ zct è¡¨ï¼Œæ¸…é™¤çœŸæ­£çš„åƒåœ¾\n            scan_zct()\n        push($zct, obj)\n}\n```\n\n\n\n#### scan_zct å‡½æ•°\n\n```python\nfunc scan_zct(){\n    for(r: $roots)\n        (*r).ref_cnt++\n    \n    for(obj : $zct)\n        if(obj.ref_cnt == 0)\n            remove($zct, obj)\n            delete(obj)\n    \n    for(r: $roots)\n        (*).ref_cnt--\n}\n```\n\n\n\n1. ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œï¼Œç¨‹åºå…ˆæŠŠæ‰€æœ‰æ ¹ç›´æ¥å¼•ç”¨çš„è®¡æ•°å™¨éƒ½è¿›è¡Œå¢é‡ã€‚è¿™æ ·ï¼Œæ¥ä¿®æ­£è®¡æ•°å™¨çš„å€¼ã€‚\n2. æ¥ä¸‹æ¥æ£€æŸ¥ `$zct` è¡¨ä¸­çš„å¯¹è±¡ï¼Œå¦‚æœæ­¤æ—¶è®¡æ•°å™¨è¿˜ä¸º0ï¼Œåˆ™è¯´æ˜æ²¡æœ‰ä»»ä½•å¼•ç”¨ï¼Œé‚£ä¹ˆå°†å¯¹è±¡å…ˆä» `$zct`ä¸­æ¸…é™¤ï¼Œç„¶åè°ƒç”¨ `delete()`å›æ”¶ã€‚\n\ndelete() å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\n\n\n\n```python\nfunc delete(obj){\n    for(child : children(obj)) // é€’å½’æ¸…ç†å¯¹è±¡çš„å­å¯¹è±¡\n        (*child).ref_cnt--\n        if (*child).ref_cnt == 0 \n            delete(*child)\n    \n    reclaim(obj)\n}\n```\n\n\n\n#### new_obj() å‡½æ•°\n\né™¤ dec_ref_cnt å‡½æ•°éœ€è¦è°ƒæ•´ï¼Œnew_obj å‡½æ•°ä¹Ÿè¦åšç›¸åº”çš„ä¿®æ”¹ã€‚\n\n```go\nfunc new_obj(size){\n    obj = pickup_chunk(size, $free_list)\n    \n    if(obj == NULL) // ç©ºé—´ä¸è¶³\n        scan_zct()  // æ‰«æ zct ä»¥ä¾¿è·å–ç©ºé—´\n        obj = pickup_chunk(size, $free_list) // å†æ¬¡å°è¯•åˆ†é…\n        if(obj == NULL)\n            allocation_fail()  // æç¤ºå¤±è´¥\n            \n     obj.ref_cnt = 1\n     return obj\n}\n```\n\n\n\n> å¦‚æœç¬¬ä¸€æ¬¡åˆ†é…ç©ºé—´ä¸è¶³ï¼Œéœ€è¦æ‰«æ $zctï¼Œä»¥ä¾¿å†æ¬¡åˆ†é…ï¼Œå¦‚æœè¿™æ—¶ç©ºé—´è¿˜ä¸è¶³ï¼Œå°±æç¤ºå¤±è´¥\n\n\n\nåœ¨å»¶è¿Ÿå¼•ç”¨è®¡æ•°æ³•ä¸­ï¼Œç¨‹åºå»¶è¿Ÿäº†æ ¹å¼•ç”¨çš„è®¡æ•°ï¼Œé€šè¿‡å»¶è¿Ÿï¼Œå‡è½»äº†å› æ ¹å¼•ç”¨é¢‘ç¹å˜åŒ–è€Œå¯¼è‡´çš„è®¡æ•°å™¨å¢å‡æ‰€å¸¦æ¥çš„é¢å¤–çš„è´Ÿæ‹…ã€‚\n\nä½†æ˜¯ï¼Œå»¶è¿Ÿå¼•ç”¨è®¡æ•°å´ä¸èƒ½é©¬ä¸Šå°†åƒåœ¾è¿›è¡Œå›æ”¶ï¼Œ`å¯ç«‹å³å›æ”¶åƒåœ¾`è¿™ä¸€ä¼˜ç‚¹ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚`scan_zct`å‡½æ•°ä¹Ÿä¼šå¢åŠ ç¨‹åºçš„æœ€å¤§æš‚åœæ—¶é—´ã€‚\n\n\n\n### Sticky å¼•ç”¨è®¡æ•°æ³•\n\nå¯¹äºå¼•ç”¨è®¡æ•°æ³•ï¼Œæœ‰ä¸€ä¸ªä¸èƒ½å¿½ç•¥çš„éƒ¨åˆ†æ˜¯è®¡æ•°å™¨ä½å®½çš„è®¾ç½®ã€‚å‡è®¾ä¸ºäº†åæ˜ æ‰€æœ‰å¼•ç”¨ï¼Œè®¡æ•°å™¨éœ€è¦1ä¸ªå­—ï¼ˆ32ä½æœºå™¨å°±æ˜¯32ä½ï¼‰çš„ç©ºé—´ã€‚ä½†æ˜¯è¿™ä¼šå¤§é‡çš„æ¶ˆè€—å†…å­˜ç©ºé—´ã€‚æ¯”å¦‚ï¼Œ2ä¸ªå­—çš„å¯¹è±¡å°±éœ€è¦ä¸€ä¸ªå­—çš„è®¡æ•°å™¨ã€‚ä¹Ÿå°±æ˜¯è®¡æ•°å™¨ä¼šä½¿å¯¹è±¡æ‰€å çš„ç©ºé—´å¢å¤§1.5å€ã€‚\n\n\n\n`sticky å¼•ç”¨è®¡æ•°æ³•`å°±æ˜¯ç”¨æ¥å‡å°‘ä½å®½çš„ã€‚\n\n> å¦‚æœæˆ‘ä»¬ä¸ºè®¡æ•°å™¨çš„ä½æ•°è®¾ä¸º5ï¼Œé‚£ä¹ˆè®¡æ•°å™¨æœ€å¤§çš„å¼•ç”¨æ•°ä¸º31ï¼Œå¦‚æœæœ‰è¶…è¿‡31ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œå°±ä¼šçˆ†è¡¨ã€‚å¯¹äºçˆ†è¡¨ï¼Œæˆ‘ä»¬æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ\n\n\n\n#### 1. ä»€ä¹ˆéƒ½ä¸åš\n\nè¿™ç§å¤„ç†æ–¹å¼å¯¹äºè®¡æ•°å™¨çˆ†è¡¨çš„å¯¹è±¡ï¼Œå†æœ‰æ–°çš„å¼•ç”¨ä¹Ÿä¸åœ¨å¢åŠ ï¼Œå½“ç„¶ï¼Œå½“è®¡æ•°å™¨ä¸º0 çš„æ—¶å€™ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å›æ”¶ï¼ˆå› ä¸ºå¯èƒ½è¿˜æœ‰å¯¹è±¡åœ¨å¼•ç”¨ï¼‰ã€‚è¿™æ ·å…¶å®æ˜¯ä¼šäº§ç”Ÿæ®‹ç•™çš„å¯¹è±¡å ç”¨å†…å­˜ã€‚\n\n> ä¸è¿‡ï¼Œç ”ç©¶è¡¨æ˜ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡å…¶å®åªè¢«å¼•ç”¨äº†ä¸€æ¬¡å°±è¢«å›æ”¶äº†ï¼Œå‡ºç°5ä½è®¡æ•°å™¨æº¢å‡ºçš„æƒ…å†µå°‘ä¹‹åˆå°‘ã€‚\n>\n> çˆ†è¡¨çš„å¯¹è±¡å¤§éƒ¨åˆ†ä¹Ÿéƒ½æ˜¯é‡è¦çš„å¯¹è±¡ï¼Œä¸ä¼šè½»æ˜“å›æ”¶ã€‚\n>\n> æ‰€ä»¥ï¼Œä»€ä¹ˆéƒ½ä¸åšä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„åŠæ³•ã€‚\n\n#### 2. ä½¿ç”¨GC æ ‡è®°-æ¸…é™¤ç®—æ³•è¿›è¡Œç®¡ç†\n\nè¿™ç§æ–¹æ³•æ˜¯ï¼Œå¯¹äºçˆ†è¡¨çš„å¯¹è±¡ï¼Œä½¿ç”¨ GC æ ‡è®°-æ¸…é™¤ç®—æ³•æ¥ç®¡ç†ã€‚\n\n```go\nfunc mark_sweep_for_counter_overflow(){\n    reset_all_ref_cnt()\n    mark_phase()\n    sweep_phase()\n}\n```\n\n\n\né¦–å…ˆï¼ŒæŠŠæ‰€æœ‰å¯¹è±¡çš„è®¡æ•°å™¨éƒ½è®¾ä¸º0ï¼Œç„¶åè¿›è¡Œæ ‡è®°å’Œæ¸…é™¤é˜¶æ®µã€‚\n\næ ‡è®°é˜¶æ®µä»£ç ä¸ºï¼š\n\n```go\nfunc mark_phase(){\n    for (r: $roots)  // å…ˆæŠŠæ ¹å¼•ç”¨çš„å¯¹è±¡æ¨åˆ°æ ‡è®°æ ˆä¸­\n        push(*r, $mark_stack)\n    \n    while(is_empty($mark_stack) == False) // å¦‚æœå †ä¸ä¸ºç©º\n        obj = pop($mark_stack)\n        obj.ref_cnt++  \n        if(obj.ref_cnt == 1) // è¿™é‡Œå¿…é¡»æŠŠå„ä¸ªå¯¹è±¡åŠå…¶å­å¯¹è±¡å †è¿›è¡Œæ ‡è®°ä¸€æ¬¡\n            for(child : children(obj))\n                push(*child, $mark_stack)\n}\n```\n\n\n\n>  åœ¨æ ‡è®°é˜¶æ®µï¼Œå…ˆæŠŠæ ¹å¼•ç”¨çš„å¯¹è±¡æ¨åˆ°æ ‡è®°æ ˆä¸­\n>\n> ç„¶åæŒ‰é¡ºåºä»æ ‡è®°æ ˆä¸­å–å‡ºå¯¹è±¡ï¼Œå¯¹è®¡æ•°å™¨è¿›è¡Œå¢é‡æ“ä½œã€‚\n>\n> å¯¹äºå¾ªç¯å¼•ç”¨çš„å¯¹è±¡æ¥è¯´ï¼Œobj.ref_cnt >  1ï¼Œä¸ºäº†é¿å…æ— è°“çš„ push è¿™é‡Œéœ€è¦è¿›è¡Œ if(obj.ref_cnt == 1) çš„åˆ¤æ–­\n\n\n\næ¸…é™¤é˜¶æ®µä»£ç ä¸ºï¼š\n\n```go\nfunc sweep_phase(){\n    sweeping = $heap_top\n    while(sweeping < $heap_end)  // å› ä¸ºå¾ªç¯å¼•ç”¨çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šè¢« push åˆ° head_end æ‰€ä»¥ä¹Ÿèƒ½è¢«å›æ”¶\n        if(sweeping.ref_cnt == 0)\n            reclaim(sweeping)\n        sweeping += sweeping.size\n}\n```\n\n\n\nåœ¨æ¸…é™¤é˜¶æ®µï¼Œç¨‹åºä¼šæœç´¢æ•´ä¸ªå †ï¼Œå›æ”¶è®¡æ•°å™¨ä»ä¸º0çš„å¯¹è±¡ã€‚\n\n\n\n> è¿™é‡Œçš„ GC æ ‡è®°-æ¸…é™¤ç®—æ³•å’Œä¸Šä¸€ç¯‡[GC æ ‡è®°-æ¸…é™¤ç®—æ³•](https://mp.weixin.qq.com/s/mJo5ADptfDxEVoqZjUIWTw) ä¸»è¦ä¸åŒç‚¹å¦‚ä¸‹ï¼š\n>\n> 1. å¼€å§‹æ—¶å°†æ‰€æœ‰å¯¹è±¡çš„è®¡æ•°å™¨å€¼è®¾ä¸º0\n> 2. ä¸æ ‡è®°å¯¹è±¡ï¼Œè€Œæ˜¯å¯¹è®¡æ•°å™¨è¿›è¡Œå¢é‡æ“ä½œ\n> 3. ä¸ºäº†å¯¹è®¡æ•°å™¨è¿›è¡Œå¢é‡æ“ä½œï¼Œç®—æ³•å¯¹æ´»åŠ¨å¯¹è±¡è¿›è¡Œäº†ä¸æ­¢ä¸€æ¬¡çš„æœç´¢ã€‚\n\n\n\nè¿™é‡Œå°† GC æ ‡è®°-æ¸…é™¤ç®—æ³•å’Œå¼•ç”¨è®¡æ•°æ³•ç»“åˆèµ·æ¥ï¼Œåœ¨è®¡æ•°å™¨æº¢å‡ºåï¼Œå¯¹è±¡ç§°ä¸ºåƒåœ¾ä¹Ÿä¸ä¼šæ¼æ‰æ¸…é™¤ã€‚å¹¶ä¸”ä¹Ÿèƒ½å›æ”¶å¾ªç¯å¼•ç”¨çš„åƒåœ¾ã€‚\n\nå› ä¸ºåœ¨æŸ¥æ‰¾å¯¹è±¡æ—¶ä¸æ˜¯è®¾ç½®æ ‡å¿—ä½è€Œæ˜¯æŠŠè®¡æ•°å™¨è¿›è¡Œå¢é‡ï¼Œæ‰€ä»¥éœ€è¦å¤šæ¬¡æŸ¥æ‰¾æ´»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ ‡è®°å¤„ç†æ¯”ä»¥å¾€çš„æ ‡è®°æ¸…é™¤èŠ±çš„æ—¶é—´æ›´é•¿ï¼Œååé‡ä¼šç›¸åº”çš„é™ä½ã€‚\n\n\n## å‚è€ƒé“¾æ¥\n\n* [åƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°](https://book.douban.com/subject/26821357/)\n* [ã€ŠGC æ ‡è®°-æ¸…é™¤ç®—æ³•ã€‹](https://mp.weixin.qq.com/s/mJo5ADptfDxEVoqZjUIWTw)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "åƒåœ¾å›æ”¶ç®—æ³•|å¼•ç”¨è®¡æ•°æ³•",
        "date": "2018-08-12 11:15:05",
        "tags": [
          "åƒåœ¾å›æ”¶",
          "ç®—æ³•",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "gc-reference-counting"
    },
    {
      "content": "\n##\n\n### \n\n## å‚è€ƒé“¾æ¥\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "categories": [
          "xxx",
          "xxxx"
        ],
        "date": "2018-08-12 10:21:42",
        "description": "description",
        "author": "goodspeed",
        "permalink": "/post/url-path",
        "tags": [
          "xx",
          "xxxx"
        ],
        "title": "title",
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "gc-partial-mark-sweep"
    },
    {
      "content": "\næˆ‘åœ¨ github æ‰˜ç®¡ Python ä»£ç ï¼Œç„¶åå°†åŒ…å‘å¸ƒåˆ° Pypiï¼Œé€šå¸¸çš„æ“ä½œæ­¥éª¤æ˜¯ï¼Œæ›´æ–°å®Œä»£ç å°†æäº¤åˆ° github ï¼Œç„¶åæ‰‹åŠ¨å°†åŒ…æ›´æ–°åˆ° pypiï¼Œè¿™æ ·æ¯”è¾ƒç¹çï¼Œå°±æƒ³åˆ°äº†ä½¿ç”¨github+travis-ci æ„å»ºä¸€ä¸ªè‡ªåŠ¨éƒ¨ç½²ç¯å¢ƒã€‚\n\n\n### æ³¨å†Œ pypi\n\nè®¿é—®[https://pypi.org](https://pypi.org) ç‚¹å‡»`Register`æ³¨å†Œè´¦å·ï¼Œè®°ä½è‡ªå·±çš„ç”¨æˆ·åå¯†ç ã€‚\n\n### åˆ›å»º setup.py æ–‡ä»¶\n\nsetup.py æ–‡ä»¶æ”¾ç½®äºåŒ…çš„æ ¹ç›®å½•ï¼Œç¤ºä¾‹å†…å®¹å¦‚ä¸‹ï¼š\n\n```python\n#!/usr/bin/env python\nfrom setuptools import setup, find_packages\n\nwith open(\"README.md\", \"r\") as fh:\n    long_description = fh.read()\n\nwith open('requirements.txt') as f:\n    requirements = [l for l in f.read().splitlines() if l]\n\nsetup(name=\"python-weixin\",  # é¡¹ç›®å\n      version=\"0.3.2\",       # ç‰ˆæœ¬å·\n      description=\"Python Weixin API client support wechat-app\",  #ç®€ä»‹\n      long_description=long_description,  # é•¿ç®€ä»‹ è¿™é‡Œä½¿ç”¨çš„ readme å†…å®¹\n      long_description_content_type=\"text/markdown\",\n      license=\"BSD\",   # æˆæƒ\n      install_requires=requirements, # ä¾èµ–\n      author=\"gusibi\",  # ä½œè€…\n      author_email=\"xxx@gmail.com\",  # é‚®ç®±\n      url=\"https://github.com/gusibi/python-weixin\",  # åœ°å€\n      download_url=\"https://github.com/gusibi/python-weixin/archive/master.zip\",\n      packages=find_packages(),\n      keywords=[\"python-weixin\", \"weixin\", \"wechat\", \"sdk\", \"weapp\", \"wxapp\"],\n      zip_safe=True)\n```\n\n\n\nä»¥ä¸Šç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ `packages`å‚æ•°ï¼Œç”¨æ¥ç”³æ˜ä½ çš„åŒ…é‡Œé¢è¦åŒ…å«çš„ç›®å½•ï¼Œè¿™é‡Œä½¿ç”¨setuptoolsè‡ªåŠ¨å†³å®šè¦åŒ…å«å“ªäº›åŒ…ã€‚\n\n\n\n### é…ç½® travis-ci\n\n\n\ngithub æä¾›äº†å¤šç§é›†æˆæ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹© Travis-ci\n\n![](http://media.gusibi.mobi/WFUXxGYuC2Vsf5A-5ogKxthVs6xR3UU69UvYt4rFTsTn6ngDLEj62Qe05tZfKhpl)\n\n\n\né€‰æ‹©åè®¿é—® [https://travis-ci.com/profile](https://travis-ci.com/profile)ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ travis-ci å¯ä»¥ä½¿ç”¨ github è´¦å·ç™»å½•ï¼Œç„¶åé€‰æ‹©å¯¹åº”çš„ github åº“æ¿€æ´»ã€‚\n\n\n![](http://media.gusibi.mobi/bRInfNXvDr4_nkBX5hbmRdCMpTLicG2wrXgsWeBEylhKNe1SKiK8KQYeBNP5SwyT)\n\n\n\nç„¶ååœ¨ github ä»£ç åº“çš„æ ¹ç›®å½•æ·»åŠ  `.travis.yml` æ–‡ä»¶ã€‚\n\n\n\n```yml\nlanguage: python\npython:   # æŒ‡å®šè¿è¡Œç¯å¢ƒï¼Œè¿™é‡Œä¼šåˆ†åˆ«åœ¨ 2.7 å’Œ 3.5 è¿è¡Œ\n  - '2.7'\n  - '3.5' \ninstall:\n  - pip install -r requirements.txt   # å®‰è£…ä¾èµ–\nscript: python test_example.py  # å¦‚æœæœ‰å•å…ƒæµ‹è¯•è¿™é‡Œåº”è¯¥æ‰§è¡Œå•å…ƒæµ‹è¯•\n```\n\n\n\n> script æ˜¯ä¸€ä¸ªå¿…é¡»çš„å‘½ä»¤ï¼Œé€šå¸¸å¦‚æœæœ‰å•å…ƒæµ‹è¯•çš„è¯è¿™é‡Œåº”è¯¥æ‰§è¡Œå•å…ƒæµ‹è¯•\n\n#### æ·»åŠ  Pypi éƒ¨ç½²é…ç½®\n\né€šè¿‡åœ¨ `.travis.yml` ä¸­æ·»åŠ  deploy æ¨¡å—ï¼Œ `Travis CI` å®ç°è‡ªåŠ¨éƒ¨ç½²ï¼Œ\n\n\n\n```yml\nlanguage: python\npython:\n- '2.7'\n- '3.5'\ninstall:\n- pip install -r requirements.txt\nscript: python test_example.py\ndeploy:\n  provider: pypi\n  user: goodspeed     # pypi ç”¨æˆ·å\n  password: password  # pypi å¯†ç \n  on:\n    python: 2.7\n    tags: true\n    branch: master\n```\n\n\n\nåœ¨ `deploy` éƒ¨åˆ†ï¼Œæˆ‘ä»¬æŒ‡å®š `provider` ä¸º pypiï¼Œç„¶åæ·»åŠ  `user`ã€`password`ã€‚\n\nåœ¨ `on` éƒ¨åˆ†æˆ‘ä»¬å£°æ˜ä¸€äº›ç‰¹æ®Šçš„é…ç½®ï¼Œæ¯”å¦‚ï¼š\n\n* `brance: master` æ„æ€æ˜¯åªæœ‰ master åˆ†æ”¯æ‰æ‰§è¡Œæ‰“åŒ…éƒ¨ç½²\n* `python: 2.7` æ„æ€æ˜¯åªåœ¨ python 2.7 ç‰ˆæœ¬æ‰§è¡Œæ‰“åŒ…éƒ¨ç½²\n* `tags: true` æ„æ€æ˜¯åªæœ‰åœ¨å‘å¸ƒä¸€ä¸ªæ–°çš„ç‰ˆæœ¬æ—¶æ‰æ‰§è¡Œæ‰“åŒ…éƒ¨ç½²\n\nå…·ä½“é…ç½®å‚è€ƒï¼š [Conditional-Releases-with-on](https://docs.travis-ci.com/user/deployment#Conditional-Releases-with-on)\n\n\n\n#### åŠ å¯†å¯†ç \n\nä¸Šé¢çš„é…ç½®ä½¿ç”¨çš„æ˜¯æ˜æ–‡å¯†ç ï¼Œè¿™æ ·å°±æŠŠpypi è´¦å·å…¬å¼€äº†ï¼Œå¤ªä¸å®‰å…¨ã€‚è¿™é‡Œæ¨èä½¿ç”¨ `travis-encrypt` åŠ å¯†å¯†ç ã€‚\n\n\n\n##### å®‰è£… travis-encrypt\n\n\n\n```bash\npip install travis-encrypt\n```\n\nç„¶ååœ¨ `.travis.yml` æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š\n\n\n\n```bash\ntravis-encrypt --deploy gusibi python-weixin .travis.yml\nPassword: # åœ¨è¿™é‡Œè¾“å…¥pypi å¯†ç \n```\n\n\n>è¿™é‡Œ `gusibi` `python-weixin` éœ€è¦æ›¿æ¢æˆç›¸å¯¹åº”çš„ github username å’Œ repositoryã€‚\n>\n>å‘½ä»¤å‚è€ƒï¼š[travis-encrypt](https://pypi.org/project/travis-encrypt/)\n\n\n\næ‰§è¡Œå®Œä¹‹åpassword éƒ¨åˆ†æ—§ä¼šè¢«åŠ å¯†åçš„ç§˜é’¥ä»£æ›¿ï¼Œæœ€ç»ˆ `.travis.yml` å†…å®¹å¦‚ä¸‹ï¼š\n\n\n\n```yml\nlanguage: python\npython:\n- '2.7'\n- '3.5'\ninstall:\n- pip install -r requirements.txt\nscript: python test_example.py\ndeploy:\n  provider: pypi\n  user: goodspeed\n  password:\n    secure: cjQdXGKkNpwKmGgEhONtd2YR+PF44gtZgMegv5O3CRsszocaRqxcBdfwi0qz6KupLMWl/WTq+bYtzf42lpytMe7cB/CPA2sCUDEo6qyIE+Brb5J57GUhd9HIhP5F44BHKWzBnYFbgPsQ2k1ckEDJsUp5yyFvUBkQmv3+LOo9Kf492oCQlgnzaGSRtPQaG56XdLKgCZrxdtfteTalTbjQO7w/GNm5lBn4l7iY1qWiQmzFxkUuZu317yAnohdH84fq9Ozov4S3nPNSTt800HjHkXwaBzxMuJ2SJBadZAW/abCvk34IPyvxjy7upNNLq80/yvgYKzxWBklcP9LxJX2Pwk9NtTY1zUEykkwdBVxZShhBXtWDma/yWQp2RdCVZtLS4GTg4X61PMgH0iwzwzGW8LARj2ZMowQoPipUYCJ7qUfyXrxU05ypizWKIIfrqdRh8Twj9Jhyg/fAoRygCoXNtMqwSmomjkwl6f1i+6lAQENdmVKQTesP56r/olXKb4rhrOgyhj7anJd3F/SZ+g8jQFHHGLcaSkEoVXL6BFPDMxYdMRmx5HKonP9uQO74ZdeevkHK0wFzSbjqpKdVzeuYuyPiHnDyooyjGL+2BzE/Zzo5KCNEflAE22kAuAbjXCuJji7+j47QohrlYjmj2+F7NDBE5sJRp3yLJWIEPqLND/k=\n  on:\n    python: 2.7\n    tags: true\n    branch: master\n```\n\n\n\n\n\nå°†ä»£ç æäº¤ä¹‹åï¼Œè®¿é—® travis-ci.org ä¼šçœ‹åˆ°å·²ç»è§¦å‘äº† ci ï¼Œæ­£åœ¨æ„å»ºï¼š\n\n\n\n![](http://media.gusibi.mobi/6yydw0RZ2b26fRKzQXlV-QoRLHaOxrj04pVlFhJTULsF7OPE2Z4msVKV1fGUWkXB)\n\n\n\n> è¿™é‡Œæœ‰ä¸¤ä¸ª job æ­£åœ¨åŒæ—¶æ„å»ºï¼Œåˆ†åˆ«æ˜¯ python2.7 ç¯å¢ƒå’Œ python3.5 ç¯å¢ƒã€‚\n\nä½†æ˜¯è¿™æ—¶å¹¶æ²¡æœ‰æŠŠåŒ…éƒ¨ç½²åˆ° pypiï¼Œè¿˜éœ€è¦åœ¨ `github releases é¡µé¢é‡æ–°å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬æ¥è§¦å‘éƒ¨ç½²`ã€‚\n\n\n\n## å‚è€ƒé“¾æ¥\n\n* [https://github.com/romgar/5minutes/blob/master/content/articles/howto-deploy-python-package-on-pypi-with-github-and-travis.md][https://github.com/romgar/5minutes/blob/master/content/articles/howto-deploy-python-package-on-pypi-with-github-and-travis.md]\n* [https://pypi.org](https://pypi.org) \n* [https://github.com/gusibi/python-weixinn](https://github.com/gusibi/python-weixin)\n* [https://pypi.org/project/travis-encrypt/](https://pypi.org/project/travis-encrypt/)\n* [https://docs.travis-ci.com/user/deployment#Conditional-Releases-with-on](https://docs.travis-ci.com/user/deployment#Conditional-Releases-with-on)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "ä½¿ç”¨github+traviså°†PythonåŒ…éƒ¨ç½²åˆ°Pypi",
        "date": "2018-07-23 15:45:46",
        "tags": [
          "python",
          "åç«¯",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "howto-deploy-python-package-on-pypi-with-github-and-travis"
    },
    {
      "content": "\n> æœ¬æ–‡æ˜¯ã€Šåƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°ã€‹è¯»ä¹¦ç¬”è®°\n\n\n![](http://media.gusibi.mobi/kJ8L52gJq08Mi142RTC-wAwzbMUgwGTKue3rPKNWVrYTlvOMczGlXFvmEt1C1MRM)\n\n### ä»€ä¹ˆæ˜¯GCæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark Sweep GCï¼‰\n\nGC æ ‡è®°-æ¸…é™¤ç®—æ³•ç”±`æ ‡è®°é˜¶æ®µ`å’Œ`æ¸…é™¤é˜¶æ®µ`æ„æˆã€‚åœ¨æ ‡è®°é˜¶æ®µä¼šæŠŠæ‰€æœ‰çš„æ´»åŠ¨å¯¹è±¡éƒ½åšä¸Šæ ‡è®°ï¼Œç„¶ååœ¨æ¸…é™¤é˜¶æ®µä¼šæŠŠæ²¡æœ‰æ ‡è®°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯`éæ´»åŠ¨`å¯¹è±¡å›æ”¶ã€‚\n\n\n> `åè¯è§£é‡Šï¼š`\n>\n> åœ¨ GC çš„ä¸–ç•Œé‡Œ`å¯¹è±¡`æŒ‡çš„æ˜¯é€šè¿‡åº”ç”¨ç¨‹åºåˆ©ç”¨çš„æ•°æ®çš„é›†åˆã€‚æ˜¯ GC çš„åŸºæœ¬å•ä½ã€‚ä¸€èˆ¬ç”±å¤´ï¼ˆheaderï¼‰å’ŒåŸŸï¼ˆfieldï¼‰æ„æˆã€‚\n>\n> `æ´»åŠ¨å¯¹è±¡:`èƒ½é€šè¿‡å¼•ç”¨ç¨‹åºå¼•ç”¨çš„å¯¹è±¡å°±è¢«ç§°ä¸ºæ´»åŠ¨å¯¹è±¡ã€‚ï¼ˆå¯ä»¥ç›´æ¥æˆ–é—´æ¥ä»å…¨å±€å˜é‡ç©ºé—´ä¸­å¼•å‡ºçš„å¯¹è±¡ï¼‰\n>\n> `éæ´»åŠ¨å¯¹è±¡:`ä¸èƒ½é€šè¿‡ç¨‹åºå¼•ç”¨çš„å¯¹è±¡å‘—ç§°ä¸ºéæ´»åŠ¨å¯¹è±¡ã€‚ï¼ˆè¿™å°±æ˜¯è¢«æ¸…é™¤çš„ç›®æ ‡ï¼‰\n\n\n\næ ‡è®°-æ¸…é™¤ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n\n\n```go\nfunc mark_sweep(){\n    mark_phase()   // æ ‡è®°é˜¶æ®µ\n    sweep_phase()  // æ¸…é™¤é˜¶æ®µ\n} \n```\n\n\n\n### æ ‡è®°é˜¶æ®µ\n\n\n\n> æ ‡è®°é˜¶æ®µå°±æ˜¯éå†å¯¹è±¡å¹¶æ ‡è®°çš„å¤„ç†è¿‡ç¨‹ã€‚\n\næ ‡è®°é˜¶æ®µä¼ªä»£ç å¦‚ä¸‹ï¼š\n\n```go\nfunc mark_phase(){\n    for (r : $roots)  // åœ¨æ ‡è®°é˜¶æ®µï¼Œä¼šç»™æ‰€æœ‰çš„æ´»åŠ¨å¯¹è±¡æ‰“ä¸Šæ ‡è®°\n        mark(*r)\n}\n\nfunc mark(){\n    if (obj.mark == False)\n        obj.mark = True            // å…ˆæ ‡è®°æ‰¾å‡ºçš„æ´»åŠ¨å¯¹è±¡\n        for (child: children(obj)) // ç„¶åé€’å½’çš„æ ‡è®°é€šè¿‡æŒ‡é’ˆæ•°ç»„èƒ½è®¿é—®åˆ°çš„å¯¹è±¡\n            mark(*child)\n}\n```\n\n\n\n> è¿™é‡Œ `$root `æ˜¯æŒ‡é’ˆå¯¹è±¡çš„èµ·ç‚¹ï¼Œé€šè¿‡$root å¯ä»¥éå†å…¨éƒ¨æ´»åŠ¨å¯¹è±¡ã€‚\n\nä¸‹å›¾æ˜¯æ ‡è®°å‰å’Œæ ‡è®°åå†…å­˜ä¸­å †çš„çŠ¶æ€\n\n![æ‰§è¡Œ GC å‰å †çš„çŠ¶æ€](http://media.gusibi.mobi/E66QEbTr9uxUcn-_4HAJbjhIiPrO_gZ-RQcn6Wiiu8iQnP9wlA5xZ5KACvMLvEK-)\n\n![æ‰§è¡Œ GC åå †çš„çŠ¶æ€](http://media.gusibi.mobi/7_BEou-9LxGREQm2CyB18NZLRMh43R8g6xY2UwXfHXw7eyYwpaSvSWPndirCzuHv)\n\n\n\n### æ¸…é™¤é˜¶æ®µ\n\n> åœ¨æ¸…é™¤é˜¶æ®µï¼Œcollector ä¼šéå†æ•´ä¸ªå †ï¼Œå›æ”¶æ²¡æœ‰æ‰“ä¸Šæ ‡è®°çš„å¯¹è±¡ï¼ˆåƒåœ¾ï¼‰ï¼Œä½¿å…¶èƒ½å†æ¬¡åˆ©ç”¨ã€‚\n\nsweep_phase() å‡½æ•°ä¼ªä»£ç å®ç°å¦‚ä¸‹ï¼š\n\n\n\n```go\nfunc sweep_phase(){\n    sweeping = $heap_start            // é¦–å…ˆå°†å †çš„é¦–åœ°å€èµ‹å€¼ç»™ sweeping\n    while(sweeping < $head_end){\n        if(sweeping.mark == TRUE)\n            // å¦‚æœæ˜¯æ ‡è®°çŠ¶æ€å°±è®¾ä¸º FALSEï¼Œå¦‚æœæ˜¯æ´»åŠ¨å¯¹è±¡ï¼Œè¿˜ä¼šåœ¨æ ‡è®°é˜¶æ®µè¢«æ ‡è®°ä¸º TRUE\n            sweeping.mark == FALSE    \n        else:\n            sweeping.next = $free_list   // å°†éæ´»åŠ¨å¯¹è±¡ æ‹¼æ¥åˆ° $free_list å¤´éƒ¨ä½ç½®\n            $free_list = sweeping\n        sweeping += sweeping.size\n    }     \n}\n```\n\n\n\n> `size` åŸŸæŒ‡çš„æ˜¯å­˜å‚¨å¯¹è±¡å¤§å°çš„åŸŸï¼Œåœ¨å¯¹è±¡å¤´ä¸­äº‹å…ˆå®šä¹‰ã€‚\n>\n> `next` åŸŸåªåœ¨ç”Ÿæˆç©ºé—²é“¾è¡¨ä»¥åŠä»ç©ºé—²é“¾è¡¨ä¸­å–å‡ºåˆ†å—æ—¶æ‰ä¼šç”¨åˆ°ã€‚\n>\n> `åˆ†å—(chunk)` è¿™é‡Œæ˜¯æŒ‡ä¸ºåˆ©ç”¨å¯¹è±¡è€Œäº‹å…ˆå‡†å¤‡å‡ºæ¥çš„ç©ºé—´ã€‚\n>\n> å†…å­˜ä¸­åŒºå—çš„å—ç”Ÿè·¯çº¿ä¸º `åˆ†å—-->æ´»åŠ¨å¯¹è±¡-->åƒåœ¾â€”>åˆ†å—-->... `\n\nåœ¨æ¸…é™¤é˜¶æ®µæˆ‘ä»¬ä¼šæŠŠéæ´»åŠ¨å›æ”¶å†åˆ©ç”¨ã€‚å›æ”¶å¯¹è±¡å°±æ˜¯æŠŠå¯¹è±¡ä½œä¸ºåˆ†å—ï¼Œè¿æ¥åˆ°è¢«ç§°ä¸º`ç©ºé—²é“¾è¡¨`çš„å•å‘é“¾è¡¨ã€‚ä¹‹åå†åˆ†é…ç©ºé—´æ—¶åªéœ€éå†è¿™ä¸ªç©ºé—²é“¾è¡¨å°±å¯ä»¥äº†æ‰¾åˆ°åˆ†å—äº†ã€‚\n\nä¸‹å›¾æ˜¯æ¸…é™¤é˜¶æ®µç»“æŸåå †çš„çŠ¶æ€ï¼š\n\n![æ¸…é™¤é˜¶æ®µç»“æŸåå †çš„çŠ¶æ€](http://media.gusibi.mobi/S1zEqC5TqtGnlofpDBf-8u_hBaLrtqyMT_vpEePlcVTVwVaJ_zwLFdXnIGbKfGBT)\n\n\n\n### åˆ†é…\n\n> å›æ”¶åƒåœ¾çš„ç›®çš„æ˜¯ä¸ºäº†èƒ½å†æ¬¡åˆ†é…\n\nå½“ç¨‹åºç”³è¯·åˆ†å—æ—¶ï¼Œæ€æ ·æ‰èƒ½æŠŠå¤§å°åˆé€‚çš„åˆ†å—åˆ†é…ç»™ç¨‹åºå‘¢ï¼Ÿ\n\nåˆ†é…ä¼ªä»£ç å¦‚ä¸‹ï¼š\n\n\n\n```go\nfunc new_obj(size){  // size æ˜¯éœ€è¦çš„åˆ†å—å¤§å°\n    chunk = pickup_chunk(size, $free_list)  // éå† $free_list å¯»æ‰¾å¤§äºç­‰äº size çš„åˆ†å—\n    if(chunk != NULL)  \n        return chunk\n    else\n        allocation_fail()   // å¦‚æœæ²¡æ‰¾åˆ°å¤§å°åˆé€‚çš„åˆ†å— æç¤ºåˆ†é…å¤±è´¥\n}\n```\n\n\n\n`pickup_chunk()`å‡½æ•°ä¸æ­¢è¿”å›å’Œ size å¤§å°ç›¸åŒçš„åˆ†å—ï¼Œä¹Ÿä¼šè¿”å›å¤§äº size å¤§å°çš„åˆ†å—ï¼ˆè¿™æ—¶ä¼šå°†å…¶åˆ†å‰²æˆ size å¤§å°çš„åˆ†å—å’Œå»æ‰ size åå‰©ä½™å¤§å°çš„åˆ†å—ï¼Œå¹¶æŠŠå‰©ä½™éƒ¨åˆ†è¿˜ç»™ç©ºé—²é“¾è¡¨ï¼‰ã€‚\n\n\n\n> åˆ†é…ç­–ç•¥æœ‰ä¸‰ç§ `First-fit`,`Best-fit`,`Worst-fit`\n>\n> `First-fit`ï¼šå‘ç°å¤§äºç­‰äº sizeçš„åˆ†å—ç«‹åˆ»è¿”å›\n>\n> `Best-fit`ï¼šæ‰¾åˆ°å¤§å°å’Œ size ç›¸ç­‰çš„åˆ†å—å†è¿”å›\n>\n> ``Worst-fit`ï¼šæ‰¾åˆ°æœ€å¤§çš„åˆ†å—ï¼Œç„¶ååˆ†å‰²æˆ size å¤§å°å’Œå‰©ä½™å¤§å°ï¼ˆè¿™ç§æ–¹æ³•å®¹æ˜“äº§ç”Ÿå¤§é‡å°çš„åˆ†å—\n\n\n\n#### åˆå¹¶\n\næ ¹æ®åˆ†é…ç­–ç•¥çš„ä¸åŒï¼Œåˆ†é…è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¤§é‡å°çš„åˆ†å—ï¼Œå¦‚æœåˆ†å—æ˜¯è¿ç»­çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå°åˆ†å—åˆå¹¶æˆä¸€ä¸ªå¤§çš„åˆ†å—ï¼Œ`åˆå¹¶æ˜¯åœ¨æ¸…é™¤é˜¶æ®µå®Œæˆçš„`ï¼ŒåŒ…å«äº†åˆå¹¶ç­–ç•¥çš„æ¸…é™¤ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n```go\nfunc sweep_phase(){\n    sweeping = $heap_start            // é¦–å…ˆå°†å †çš„é¦–åœ°å€èµ‹å€¼ç»™ sweeping\n    while(sweeping < $head_end){\n        if(sweeping.mark == TRUE)\n            // å¦‚æœæ˜¯æ ‡è®°çŠ¶æ€å°±è®¾ä¸º FALSEï¼Œå¦‚æœæ˜¯æ´»åŠ¨å¯¹è±¡ï¼Œè¿˜ä¼šåœ¨æ ‡è®°é˜¶æ®µè¢«æ ‡è®°ä¸º TRUE\n            sweeping.mark == FALSE    \n        else:\n            if(sweeping == $free_list + $free_list.size)  // å †çš„åœ°å€æ­£å¥½å’Œç©ºé—²é“¾è¡¨å¤§å°ç›¸åŒ\n                $free_list.size += sweeping.size\n            else\n                sweeping.next = $free_list   // å°†éæ´»åŠ¨å¯¹è±¡ æ‹¼æ¥åˆ° $free_list å¤´éƒ¨ä½ç½®\n                $free_list = sweeping\n        sweeping += sweeping.size\n    }     \n}\n```\n\n\n\n> `$heap_end = $heap_start + HEAP_SIZE`\n>\n> æ‰€ä»¥è¿™é‡Œ`sweeping == $free_list + $free_list.size`å¯ä»¥ç†è§£ä¸ºéœ€è¦æ¸…é™¤çš„å †çš„åœ°å€æ­£å¥½å’Œç©ºé—²é“¾æ¥ç›¸é‚»\n\n\n\n### ä¼˜/ç¼º ç‚¹\n\n#### ä¼˜ç‚¹\n\n* å®ç°ç®€å•\n* ä¸`ä¿å®ˆå¼ GC ç®—æ³•`å…¼å®¹\n\n\n\n#### ç¼ºç‚¹\n\n* ç¢ç‰‡åŒ–ä¸¥é‡ï¼ˆç”±ä¸Šé¢æè¿°çš„åˆ†é…ç®—æ³•å¯çŸ¥ï¼Œå®¹æ˜“äº§ç”Ÿå¤§é‡å°çš„åˆ†å—\n* åˆ†é…é€Ÿåº¦æ…¢ï¼ˆç”±äºç©ºé—²åŒºå—æ˜¯ç”¨é“¾è¡¨å®ç°ï¼Œåˆ†å—å¯èƒ½éƒ½ä¸è¿ç»­ï¼Œæ¯æ¬¡åˆ†é…éƒ½éœ€è¦éå†ç©ºé—²é“¾è¡¨ï¼Œæç«¯æƒ…å†µæ˜¯éœ€è¦éå†æ•´ä¸ªé“¾è¡¨çš„ã€‚\n* ä¸`å†™æ—¶å¤åˆ¶æŠ€æœ¯`ä¸å…¼å®¹\n\n> å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æ˜¯ä¼—å¤š UNIX æ“ä½œç³»ç»Ÿç”¨åˆ°çš„å†…å­˜ä¼˜åŒ–çš„æ–¹æ³•ã€‚æ¯”å¦‚åœ¨ Linux ç³»ç»Ÿä¸­ä½¿ç”¨ fork() å‡½æ•°å¤åˆ¶è¿›ç¨‹æ—¶ï¼Œå¤§éƒ¨åˆ†å†…å­˜ç©ºé—´éƒ½ä¸ä¼šè¢«å¤åˆ¶ï¼Œåªæ˜¯å¤åˆ¶è¿›ç¨‹ï¼Œåªæœ‰åœ¨å†…å­˜ä¸­å†…å®¹è¢«æ”¹å˜æ—¶æ‰ä¼šå¤åˆ¶å†…å­˜æ•°æ®ã€‚\n>\n> ä½†æ˜¯å¦‚æœä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œè¿™æ—¶å†…å­˜ä¼šè¢«è®¾ç½®`æ ‡å¿—ä½`ï¼Œå°±ä¼šé¢‘ç¹å‘ç”Ÿä¸åº”è¯¥å‘ç”Ÿçš„å¤åˆ¶ã€‚\n\n### å¤šä¸ªç©ºé—²é“¾è¡¨\n\nä¸Šé¢æ‰€è¯´çš„æ ‡è®°æ¸…é™¤ç®—æ³•åªç”¨åˆ°äº†ä¸€ä¸ªç©ºé—²é“¾è¡¨å¯¹å¤§å°ä¸ä¸€çš„åˆ†å—ç»Ÿä¸€å¤„ç†ã€‚ä½†è¿™æ ·åšæ¯æ¬¡éƒ½éœ€è¦éå†ä¸€éæ¥å¯»æ‰¾å¤§å°åˆé€‚çš„åˆ†å—ï¼Œéå¸¸æµªè´¹æ—¶é—´ã€‚\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¤šä¸ªç©ºé—²é“¾è¡¨çš„æ–¹æ³•æ¥å­˜å‚¨éæ´»åŠ¨å¯¹è±¡ã€‚æ¯”å¦‚ï¼šå°†ä¸¤ä¸ªå­—çš„åˆ†å—ç»„æˆä¸€ä¸ªç©ºé—²é“¾è¡¨ï¼Œä¸‰ä¸ªå­—çš„åˆ†å—ç»„æˆå¦ä¸€ä¸ªç©ºé—²é“¾è¡¨ï¼Œç­‰ç­‰ã€‚ã€‚\n\nè¿™æ—¶ï¼Œå¦‚æœéœ€è¦åˆ†é…ä¸‰ä¸ªå­—çš„åˆ†å—ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦æŸ¥è¯¢å¯¹åº”çš„ä¸‰ä¸ªå­—çš„ç©ºé—²é“¾è¡¨å°±å¯ä»¥äº†ã€‚\n\n> åˆ°åº•éœ€è¦åˆ¶é€ å¤šå°‘ä¸ªç©ºé—²é“¾è¡¨å‘¢ï¼Ÿ\n>\n> å› ä¸ºé€šå¸¸ç¨‹åºä¸ä¼š ç”³è¯·ç‰¹åˆ«å¤§çš„åˆ†å—ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ç»™åˆ†å—å¤§å°è®¾ç½®ä¸€ä¸ªä¸Šé™ï¼Œæ¯”å¦‚100ï¼Œå¤§äºè¿™ä¸ªä¸Šé™çš„ç»„æˆä¸€ä¸ªç‰¹æ®Šçš„ç©ºé—²é“¾è¡¨ã€‚è¿™æ ·101 ä¸ªç©ºé—²é“¾è¡¨å°±å¤Ÿäº†ã€‚\n\n### ä½å›¾æ ‡è®°\n\nåœ¨å•çº¯çš„ GC æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸­ï¼Œç”¨äºæ ‡è®°çš„ä½æ˜¯è¢«åˆ†é…åˆ°å¯¹è±¡å¤´ä¸­çš„ã€‚ç®—æ³•æ˜¯æŠŠå¯¹è±¡å’Œå¤´ä¸€å¹¶å¤„ç†ï¼Œä½†è¿™å’Œå†™æ—¶å¤åˆ¶ä¸å…¼å®¹ã€‚\n\n`ä½å›¾æ ‡è®°`æ³•æ˜¯åªæ”¶é›†å„ä¸ªå¯¹è±¡çš„æ ‡å¿—ä½å¹¶è¡¨æ ¼åŒ–ï¼Œä¸å–å¯¹è±¡ä¸€èµ·ç®¡ç†ã€‚åœ¨æ ‡è®°çš„æ—¶å€™ä¸åœ¨å¯¹è±¡çš„å¤´é‡Œè®¾ç½®ä½ç½®ï¼Œè€Œæ˜¯åœ¨ç‰¹å®šçš„è¡¨æ ¼ä¸­ç½®ä½ã€‚\n\n\n\n![ä½å›¾æ ‡è®°](http://media.gusibi.mobi/hEEQsacTXvFE97jV14u-Jc-ghhrDKg6TY_w20Mvizspa1cmEQFvtV5ADazkBAOy0)\n\n\n\n> åœ¨ä½å›¾æ ‡è®°ä¸­é‡è¦çš„æ˜¯ï¼Œä½å›¾è¡¨æ ¼ä¸­ä½çš„ä½ç½®è¦å’Œå †é‡Œçš„å„ä¸ªå¯¹è±¡åˆ‡å®å¯¹åº”ã€‚ä¸€èˆ¬æ¥è¯´å †ä¸­çš„ä¸€ä¸ªå­—ä¼šåˆ†é…åˆ°ä¸€ä¸ªä½ã€‚\n\n\n\nä½å›¾æ ‡è®°ä¸­ mark() å‡½æ•°çš„ä¼ªä»£ç å®ç°å¦‚ä¸‹ï¼š\n\n\n\n```go\nfunc mark(obj){\n    obj_num = (obj - $heap_start) / WORD_LENGTH  // WORD_LENGTH æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè¡¨ç¤ºæœºå™¨ä¸­ä¸€ä¸ªå­—çš„ä½å®½\n    index = obj_num / WORD_LENGTH\n    offset = obj_num % WORD_LENGTH\n    \n    if ($bitmap_tbl[index] & (1 << offset)) == 0\n        $bitmap_tbl[index] |= (1 << offset)\n        for (child: children(obj)) // ç„¶åé€’å½’çš„æ ‡è®°é€šè¿‡æŒ‡é’ˆæ•°ç»„èƒ½è®¿é—®åˆ°çš„å¯¹è±¡\n            mark(*child)\n}\n```\n\n\n\nè¿™é‡Œ obj_num æŒ‡çš„æ˜¯ä»ä½å›¾è¡¨æ ¼å‰é¢æ•°ï¼Œobj çš„æ ‡å¿—ä½åœ¨ç¬¬å‡ ä¸ªã€‚ä¾‹å¦‚ E çš„ obj_num æ˜¯8ã€‚\n\nobj_num é™¤ä»¥ WORD_LENGTH å¾—åˆ°çš„å•† index ä»¥åŠä½™æ•° offset æ¥åˆ†åˆ«è¡¨ç¤ºä½å›¾è¡¨æ ¼çš„è¡Œç¼–å·å’Œåˆ—ç¼–å·ã€‚\n\n\n\n#### ä¼˜ç‚¹\n\n* å’Œå†™æ—¶å¤åˆ¶æŠ€æœ¯å…¼å®¹\n* æ¸…é™¤æ›´é«˜æ•ˆï¼ˆåªéœ€è¦éå†ä½å›¾è¡¨æ ¼å°±å¯ä»¥ï¼Œæ¸…é™¤çš„æ—¶å€™ä¹Ÿåªéœ€è¦æ¸…é™¤è¡¨æ ¼ä¸­çš„æ ‡å¿—ä½ï¼‰ã€‚\n\n### å»¶è¿Ÿæ¸…é™¤\n\næ¸…é™¤æ“ä½œæ‰€èŠ±è´¹çš„æ—¶é—´å’Œå †çš„å¤§å°æˆæ­£æ¯”ï¼Œå †è¶Šå¤§ï¼Œæ ‡è®°-æ¸…é™¤ åŠ¨ä½œèŠ±è´¹çš„æ—¶é—´è¶Šé•¿ï¼Œä¹Ÿå°±è¶Šå½±å“ç¨‹åºçš„è¿è¡Œã€‚\n\nå»¶è¿Ÿæ¸…é™¤ï¼ˆlazy sweepï¼‰æ˜¯ç¼©çŸ­æ¸…é™¤æ“ä½œèŠ±è´¹å¯¼è‡´ç¨‹åºæœ€å¤§æš‚åœæ—¶é—´çš„æ–¹æ³•ã€‚\n\n> `æœ€å¤§æš‚åœæ—¶é—´`ï¼Œå› æ‰§è¡Œ GC è€Œæš‚åœæ‰§è¡Œç¨‹åºçš„æœ€é•¿æ—¶é—´ã€‚\n\nå»¶è¿Ÿæ¸…é™¤ä¸­ new_obj() å‡½æ•°ä¼šåœ¨åˆ†é…çš„æ—¶å€™è°ƒç”¨ `lazy_sweep()`å‡½æ•°ï¼Œè¿›è¡Œæ¸…é™¤æ“ä½œã€‚å¦‚æœå®ƒèƒ½ç”¨æ¸…é™¤æ“ä½œæ¥åˆ†é…åˆ†å—ï¼Œå°±ä¼šè¿”å›åˆ†å—ï¼Œå¦‚æœä¸èƒ½åˆ†é…åˆ†å—ï¼Œå°±ä¼šæ‰§è¡Œæ ‡è®°æ“ä½œã€‚ç„¶åé‡å¤è¿™ä¸ªæ­¥éª¤ï¼Œç›´åˆ°æ‰¾åˆ°åˆ†å—æˆ–è€…`allocation_fail`\n\n\n\né€šè¿‡å»¶è¿Ÿæ¸…é™¤æ³•å¯ä»¥ç¼©å‡ç¨‹åºçš„æš‚åœæ—¶é—´ï¼Œä¸è¿‡å»¶è¿Ÿæ•ˆæœå¹¶ä¸æ˜¯å‡è¡¡çš„ã€‚æ¯”å¦‚ä¸‹å›¾è¿™ç§åˆšæ ‡è®°å®Œå †çš„æƒ…å†µï¼š\n\n![å †é‡Œåƒåœ¾åˆ†å¸ƒä¸å‡çš„æƒ…å†µ](http://media.gusibi.mobi/yOIKeU-sQUx1m4C56IcH__oPcq3aR7zKxokJ0kiaqGfBCT9UNqUGnXUalUmcLM9S)\n\n\n\nè¿™æ—¶ï¼Œæ´»åŠ¨å¯¹è±¡å’Œéæ´»åŠ¨å¯¹è±¡éƒ½æ˜¯ç›¸é‚»åˆ†å¸ƒï¼Œå¦‚æœç¨‹åºåœ¨æ´»åŠ¨å¯¹è±¡å‘¨å›´å¼€å§‹æ¸…é™¤ï¼Œé‚£å®ƒæ‰¾åˆ°çš„å¯¹è±¡éƒ½æ˜¯æ´»åŠ¨å¯¹è±¡ä¸å¯æ¸…é™¤ï¼Œåªèƒ½ä¸åœéå†ï¼Œæš‚åœæ—¶é—´å°±ä¼šå˜é•¿ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [åƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°](https://book.douban.com/subject/26821357/)\n* [ç”»è¯´ Ruby ä¸ Python åƒåœ¾å›æ”¶](https://mp.weixin.qq.com/s/4aEUixY3cioH2OXTgYX0Mg)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "åƒåœ¾å›æ”¶ç®—æ³•|GCæ ‡è®°-æ¸…é™¤ç®—æ³•",
        "date": "2018-07-21 03:15:05",
        "tags": [
          "åƒåœ¾å›æ”¶",
          "ç®—æ³•",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "gc-mark-sweep"
    },
    {
      "content": "\n> gRPC ä¸€å¼€å§‹ç”± google å¼€å‘ï¼Œæ˜¯ä¸€æ¬¾è¯­è¨€ä¸­ç«‹ã€å¹³å°ä¸­ç«‹ã€å¼€æºçš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)ç³»ç»Ÿã€‚ æœ¬æ–‡é€šè¿‡ä¸€ä¸ªç®€å•çš„ Hello World ä¾‹å­æ¥å‘æ‚¨ä»‹ç» gRPC ã€‚\n\n\n### gRPC æ˜¯ä»€ä¹ˆï¼Ÿ\n\ngRPC ä¹Ÿæ˜¯åŸºäºä»¥ä¸‹ç†å¿µï¼šå®šä¹‰ä¸€ä¸ª*æœåŠ¡*ï¼ŒæŒ‡å®šå…¶èƒ½å¤Ÿè¢«è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ï¼ˆåŒ…å«å‚æ•°å’Œè¿”å›ç±»å‹ï¼‰ã€‚åœ¨æœåŠ¡ç«¯å®ç°è¿™ä¸ªæ¥å£ï¼Œå¹¶è¿è¡Œä¸€ä¸ª gRPC æœåŠ¡å™¨æ¥å¤„ç†å®¢æˆ·ç«¯è°ƒç”¨ã€‚åœ¨å®¢æˆ·ç«¯æ‹¥æœ‰ä¸€ä¸ª*å­˜æ ¹*èƒ½å¤ŸåƒæœåŠ¡ç«¯ä¸€æ ·çš„æ–¹æ³•ã€‚\n\nåœ¨ gRPC é‡Œ*å®¢æˆ·ç«¯*åº”ç”¨å¯ä»¥åƒè°ƒç”¨æœ¬åœ°å¯¹è±¡ä¸€æ ·ç›´æ¥è°ƒç”¨å¦ä¸€å°ä¸åŒçš„æœºå™¨ä¸Š*æœåŠ¡ç«¯*åº”ç”¨çš„æ–¹æ³•ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ›´å®¹æ˜“åœ°åˆ›å»ºåˆ†å¸ƒå¼åº”ç”¨å’ŒæœåŠ¡ã€‚\n\n![gPRC](http://media.gusibi.mobi/t21KzebjklAAMbWL7Aos4KYZLkkbjrGwZkNLUwxrT7Igz1D5Ea2xCJ0W0EOPrgXK)\n\n\ngRPC å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åœ¨å¤šç§ç¯å¢ƒä¸­è¿è¡Œå’Œäº¤äº’ï¼Œå¹¶ä¸”å¯ä»¥ç”¨ä»»ä½• gRPC æ”¯æŒçš„è¯­è¨€æ¥ç¼–å†™ã€‚\n\n\n> gRPC æ”¯æŒ C++ Java Python Go Ruby C# Node.js PHP Dart ç­‰è¯­è¨€\n\n\ngRPC é»˜è®¤ä½¿ç”¨ *protocol buffers*ï¼Œè¿™æ˜¯ Google å¼€æºçš„ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¯ä»¥ç”¨äºç»“æ„åŒ–æ•°æ®ä¸²è¡ŒåŒ–ï¼Œæˆ–è€…è¯´åºåˆ—åŒ–ã€‚å®ƒå¾ˆé€‚åˆåšæ•°æ®å­˜å‚¨æˆ– RPC æ•°æ®äº¤æ¢æ ¼å¼ã€‚\n\n### å®‰è£… Google Protocol Buffer\n\n#### æ–¹æ³•ä¸€ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰\n\n\n\nå‚è€ƒæ–‡æ¡£ï¼š[gRPC Python Quickstart](https://grpc.io/docs/quickstart/python.html)\n\n\n\n##### 1. å®‰è£… gRPC\n\n```bash\n\npython -m pip install grpcio\n# æˆ–è€…\nsudo python -m pip install grpcio\n\n# åœ¨ El Capitan OSX ç³»ç»Ÿä¸‹å¯èƒ½ä¼šçœ‹åˆ°ä»¥ä¸‹æŠ¥é”™\n\n$ OSError: [Errno 1] Operation not permitted: '/tmp/pip-qwTLbI-uninstall/System/Library/Frameworks/Python.framework/Versions/2.7/Extras/lib/python/six-1.4.1-py2.7.egg-info'\n\n# å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤\npython -m pip install grpcio --ignore-installed\n```\n\n\n\n##### 2. å®‰è£… gRPC tools\n\n\n\nPython gPRC tools åŒ…å« protocol buffer ç¼–è¯‘å™¨å’Œç”¨äºä» `.proto` æ–‡ä»¶ç”ŸæˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä»£ç çš„æ’ä»¶\n\n```bash\npython -m pip install grpcio-tools\n```\n\n\n\n#### æ–¹æ³•äºŒï¼š\n\nåœ¨ github é¡µé¢[protobuf Buffers](https://github.com/google/protobuf/releases)å¯ä»¥ä¸‹è½½äºŒè¿›åˆ¶æºç ï¼Œä¸‹è½½åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n```bash\ntar -zxvf protobuf-all-3.5.1.tar\ncd protobuf-all-3.5.1\n./configure\nmake\nmake install\n\n>> protoc --version\nlibprotoc 3.5.1  # å®‰è£…æˆåŠŸ\n```\n\nå› ä¸ºæ˜¯è¦ä½¿ç”¨ Protobuf + Python æµ‹è¯•ï¼Œæ‰€ä»¥è¿˜è¦å®‰è£… pythonè¿è¡Œç¯å¢ƒã€‚[protobuf Buffers python æ–‡æ¡£](https://github.com/google/protobuf/tree/master/python)\n\n```bash\n# æ‰“å¼€ python ç›®å½•\ncd python\npython setup.py install  # å®‰è£… python è¿è¡Œç¯å¢ƒ\n```\n\n\n\n### Protobuf åŸºæœ¬ä½¿ç”¨\n\n#### å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç±»å‹\n\nå…ˆæ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ã€‚å‡è®¾ä½ æƒ³å®šä¹‰ä¸€ä¸ªâ€œæœç´¢è¯·æ±‚â€çš„æ¶ˆæ¯æ ¼å¼ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚å«æœ‰ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ã€ä½ æ„Ÿå…´è¶£çš„æŸ¥è¯¢ç»“æœæ‰€åœ¨çš„é¡µæ•°ï¼Œä»¥åŠæ¯ä¸€é¡µå¤šå°‘æ¡æŸ¥è¯¢ç»“æœã€‚å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼æ¥å®šä¹‰æ¶ˆæ¯ç±»å‹çš„.protoæ–‡ä»¶äº†ï¼š\n\n```protobuf\nsyntax = \"proto3\";  // å£°æ˜ä½¿ç”¨ proto3 è¯­æ³•\n\nmessage SearchRequest {\n  string query = 1;  // æ¯ä¸ªå­—æ®µéƒ½è¦æŒ‡å®šæ•°æ®ç±»å‹\n  int32 page_number = 2; // è¿™é‡Œçš„æ•°å­—2 æ˜¯æ ‡è¯†ç¬¦ï¼Œæœ€å°çš„æ ‡è¯†å·å¯ä»¥ä»1å¼€å§‹ï¼Œæœ€å¤§åˆ°2^29 - 1, or 536,870,911ã€‚ä¸å¯ä»¥ä½¿ç”¨å…¶ä¸­çš„[19000ï¼19999]\n  int32 result_per_page = 3; // è¿™é‡Œæ˜¯æ³¨é‡Šï¼Œä½¿ç”¨ //\n}\n```\n\n\n\n* æ–‡ç« çš„ç¬¬ä¸€è¡ŒæŒ‡å®šäº†ä½ æ­£åœ¨ä½¿ç”¨ proto3 è¯­æ³•ï¼šå¦‚æœä¸æŒ‡å®šï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ proto2ã€‚`è¿™ä¸ªæŒ‡å®šè¯­æ³•å¿…é¡»æ˜¯æ–‡ä»¶çš„éç©ºéæ³¨é‡Šçš„ç¬¬ä¸€è¡Œ`ã€‚\n* `SearchRequest`æ¶ˆæ¯æ ¼å¼æœ‰ä¸‰ä¸ªå­—æ®µï¼Œåœ¨æ¶ˆæ¯ä¸­æ‰¿è½½çš„æ•°æ®åˆ†åˆ«å¯¹åº”äºæ¯ä¸€ä¸ªå­—æ®µã€‚å…¶ä¸­æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªåå­—å’Œä¸€ç§ç±»å‹ã€‚\n* å‘.protoæ–‡ä»¶æ·»åŠ æ³¨é‡Šï¼Œå¯ä»¥ä½¿ç”¨C/C++/javaé£æ ¼çš„`åŒæ–œæ (//)` è¯­æ³•æ ¼å¼ã€‚\n* åœ¨æ¶ˆæ¯ä½“ä¸­ï¼Œæ¯ä¸ªå­—æ®µéƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ªæ•°å­—æ ‡è¯†ç¬¦ã€‚è¿™äº›æ ‡è¯†ç¬¦ç”¨æ¥åœ¨æ¶ˆæ¯çš„äºŒè¿›åˆ¶æ ¼å¼ä¸­è¯†åˆ«å„ä¸ªå­—æ®µï¼Œä¸€æ—¦å¼€å§‹ä½¿ç”¨å°±ä¸èƒ½å†æ”¹å˜ã€‚\n\n> [1,15]ä¹‹å†…çš„æ ‡è¯†å·åœ¨ç¼–ç çš„æ—¶å€™ä¼šå ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚[16,2047]ä¹‹å†…çš„æ ‡è¯†å·åˆ™å ç”¨2ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥åº”è¯¥ä¸ºé‚£äº›é¢‘ç¹å‡ºç°çš„æ¶ˆæ¯å…ƒç´ ä¿ç•™ [1,15]ä¹‹å†…çš„æ ‡è¯†å·ã€‚åˆ‡è®°ï¼šè¦ä¸ºå°†æ¥æœ‰å¯èƒ½æ·»åŠ çš„ã€é¢‘ç¹å‡ºç°çš„æ ‡è¯†å·é¢„ç•™ä¸€äº›æ ‡è¯†å·ã€‚\n\n\n\n#### æŒ‡å®šå­—æ®µè§„åˆ™\n\næ‰€æŒ‡å®šçš„æ¶ˆæ¯å­—æ®µä¿®é¥°ç¬¦å¿…é¡»æ˜¯å¦‚ä¸‹ä¹‹ä¸€ï¼š\n\n- singularï¼šä¸€ä¸ªæ ¼å¼è‰¯å¥½çš„æ¶ˆæ¯åº”è¯¥æœ‰0ä¸ªæˆ–è€…1ä¸ªè¿™ç§å­—æ®µï¼ˆä½†æ˜¯ä¸èƒ½è¶…è¿‡1ä¸ªï¼‰ã€‚\n\n- repeatedï¼šåœ¨ä¸€ä¸ªæ ¼å¼è‰¯å¥½çš„æ¶ˆæ¯ä¸­ï¼Œè¿™ç§å­—æ®µå¯ä»¥é‡å¤ä»»æ„å¤šæ¬¡ï¼ˆåŒ…æ‹¬0æ¬¡ï¼‰ã€‚é‡å¤çš„å€¼çš„é¡ºåºä¼šè¢«ä¿ç•™ã€‚\n\n  åœ¨proto3ä¸­ï¼Œrepeatedçš„æ ‡é‡åŸŸé»˜è®¤æƒ…å†µè™¾ä½¿ç”¨packedã€‚\n\n  \n\n  ```protobuf\n  message Test4 {\n    repeated int32 d = 4 [packed=true];\n  }\n  ```\n\n  \n\n#### æ•°å€¼ç±»å‹\n\nä¸€ä¸ªæ ‡é‡æ¶ˆæ¯å­—æ®µå¯ä»¥å«æœ‰ä¸€ä¸ªå¦‚ä¸‹çš„ç±»å‹â€”â€”è¯¥è¡¨æ ¼å±•ç¤ºäº†å®šä¹‰äº.protoæ–‡ä»¶ä¸­çš„ç±»å‹ï¼Œä»¥åŠä¸ä¹‹å¯¹åº”çš„ã€åœ¨è‡ªåŠ¨ç”Ÿæˆçš„è®¿é—®ç±»ä¸­å®šä¹‰çš„ç±»å‹ï¼š\n\n| .proto Type | Notes                                                        | C++ Type | Java Type  | Python Type[2] | Go Type | Ruby Type                 |\n| ----------- | ------------------------------------------------------------ | -------- | ---------- | -------------- | ------- | ------------------------------ |\n| double      |                                                              | double   | double     | float          | float64 | Float                     |\n| float       |                                                              | float    | float      | float          | float32 | Float                     |\n| int32       | ä½¿ç”¨å˜é•¿ç¼–ç ï¼Œå¯¹äºè´Ÿå€¼çš„æ•ˆç‡å¾ˆä½ï¼Œå¦‚æœä½ çš„åŸŸæœ‰å¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·ä½¿ç”¨sint64æ›¿ä»£ | int32    | int        | int       | int32   | Fixnum æˆ–è€… Bignumï¼ˆæ ¹æ®éœ€è¦ï¼‰ |\n| uint32      | ä½¿ç”¨å˜é•¿ç¼–ç                                                  | uint32   | int        | int/long       | uint32  | Fixnum æˆ–è€… Bignumï¼ˆæ ¹æ®éœ€è¦ï¼‰ | \n| uint64      | ä½¿ç”¨å˜é•¿ç¼–ç                                                  | uint64   | long       | int/long       | uint64  | Bignum                      |\n| sint32      | ä½¿ç”¨å˜é•¿ç¼–ç ï¼Œè¿™äº›ç¼–ç åœ¨è´Ÿå€¼æ—¶æ¯”int32é«˜æ•ˆçš„å¤š                | int32    | int        | int            | int32   | Fixnum æˆ–è€… Bignumï¼ˆæ ¹æ®éœ€è¦ï¼‰ |\n| sint64      | ä½¿ç”¨å˜é•¿ç¼–ç ï¼Œæœ‰ç¬¦å·çš„æ•´å‹å€¼ã€‚ç¼–ç æ—¶æ¯”é€šå¸¸çš„int64é«˜æ•ˆã€‚      | int64    | long       | int/long       | int64   | Bignum                         |\n| fixed32     | æ€»æ˜¯4ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ•°å€¼æ€»æ˜¯æ¯”æ€»æ˜¯æ¯”228å¤§çš„è¯ï¼Œè¿™ä¸ªç±»å‹ä¼šæ¯”uint32é«˜æ•ˆã€‚ | uint32   | int        | int            | uint32  | Fixnum æˆ–è€… Bignumï¼ˆæ ¹æ®éœ€è¦ï¼‰ | \n| fixed64     | æ€»æ˜¯8ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ•°å€¼æ€»æ˜¯æ¯”æ€»æ˜¯æ¯”256å¤§çš„è¯ï¼Œè¿™ä¸ªç±»å‹ä¼šæ¯”uint64é«˜æ•ˆã€‚ | uint64   | long       | int/long       | uint64  | Bignum                      |\n| sfixed32    | æ€»æ˜¯4ä¸ªå­—èŠ‚                                                  | int32    | int        | int            | int32   | Fixnum æˆ–è€… Bignumï¼ˆæ ¹æ®éœ€è¦ï¼‰ |\n| sfixed64    | æ€»æ˜¯8ä¸ªå­—èŠ‚                                                  | int64    | long       | int/long       | int64   | Bignum                      |\n| bool        |                                                              | bool     | boolean    | bool           | bool    | TrueClass/FalseClass      |\n| string      | ä¸€ä¸ªå­—ç¬¦ä¸²å¿…é¡»æ˜¯UTF-8ç¼–ç æˆ–è€…7-bit ASCIIç¼–ç çš„æ–‡æœ¬ã€‚         | string   | String     | str/unicode    | string  | String (UTF-8)                 |\n| bytes       | å¯èƒ½åŒ…å«ä»»æ„é¡ºåºçš„å­—èŠ‚æ•°æ®ã€‚                                 | string   | ByteString | str            | []byte  | String (ASCII-8BIT)           |\n\n\n\n#### é»˜è®¤å€¼\n\nå½“ä¸€ä¸ªæ¶ˆæ¯è¢«è§£æçš„æ—¶å€™ï¼Œå¦‚æœè¢«ç¼–ç çš„ä¿¡æ¯ä¸åŒ…å«ä¸€ä¸ªç‰¹å®šçš„singularå…ƒç´ ï¼Œè¢«è§£æçš„å¯¹è±¡é”å¯¹åº”çš„åŸŸè¢«è®¾ç½®ä½ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå¯¹äºä¸åŒç±»å‹æŒ‡å®šå¦‚ä¸‹ï¼š\n\n- å¯¹äºstringsï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªç©ºstring\n\n- å¯¹äºbytesï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªç©ºçš„bytes\n\n- å¯¹äºboolsï¼Œé»˜è®¤æ˜¯false\n\n- å¯¹äºæ•°å€¼ç±»å‹ï¼Œé»˜è®¤æ˜¯0\n\n- å¯¹äºæšä¸¾ï¼Œé»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªå®šä¹‰çš„æšä¸¾å€¼ï¼Œå¿…é¡»ä¸º0;\n\n- å¯¹äºæ¶ˆæ¯ç±»å‹ï¼ˆmessageï¼‰ï¼ŒåŸŸæ²¡æœ‰è¢«è®¾ç½®ï¼Œç¡®åˆ‡çš„æ¶ˆæ¯æ˜¯æ ¹æ®è¯­è¨€ç¡®å®šçš„ï¼Œè¯¦è§[generated code guide](https://developers.google.com/protocol-buffers/docs/reference/overview?hl=zh-cn)\n\n  å¯¹äºå¯é‡å¤åŸŸçš„é»˜è®¤å€¼æ˜¯ç©ºï¼ˆé€šå¸¸æƒ…å†µä¸‹æ˜¯å¯¹åº”è¯­è¨€ä¸­ç©ºåˆ—è¡¨ï¼‰ã€‚\n\n\n\n#### åµŒå¥—ç±»å‹\n\nä½ å¯ä»¥åœ¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä¸­å®šä¹‰ã€ä½¿ç”¨æ¶ˆæ¯ç±»å‹ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒResultæ¶ˆæ¯å°±å®šä¹‰åœ¨SearchResponseæ¶ˆæ¯å†…ï¼Œå¦‚ï¼š\n\n\n\n```protobuf\nmessage SearchResponse {\n  message Result {\n    string url = 1;\n    string title = 2;\n    repeated string snippets = 3;\n  }\n  repeated Result results = 1;\n}\n```\n\n\n\nåœ¨ message SearchResponse ä¸­ï¼Œå®šä¹‰äº†åµŒå¥—æ¶ˆæ¯ `Result`ï¼Œå¹¶ç”¨æ¥å®šä¹‰`SearchResponse`æ¶ˆæ¯ä¸­çš„`results`åŸŸã€‚\n\n\n\n### Protobuf æ–‡ä»¶ç¼–è¯‘\n\n\n\n#### ä».protoæ–‡ä»¶ç”Ÿæˆäº†ä»€ä¹ˆï¼Ÿ\n\n\n\nå½“ç”¨protocol bufferç¼–è¯‘å™¨æ¥è¿è¡Œ.protoæ–‡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨å°†ç”Ÿæˆæ‰€é€‰æ‹©è¯­è¨€çš„ä»£ç ï¼Œè¿™äº›ä»£ç å¯ä»¥æ“ä½œåœ¨.protoæ–‡ä»¶ä¸­å®šä¹‰çš„æ¶ˆæ¯ç±»å‹ï¼ŒåŒ…æ‹¬è·å–ã€è®¾ç½®å­—æ®µå€¼ï¼Œå°†æ¶ˆæ¯åºåˆ—åŒ–åˆ°ä¸€ä¸ªè¾“å‡ºæµä¸­ï¼Œä»¥åŠä»ä¸€ä¸ªè¾“å…¥æµä¸­è§£ææ¶ˆæ¯ã€‚\n\n- å¯¹C++æ¥è¯´ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ª.protoæ–‡ä»¶ç”Ÿæˆä¸€ä¸ª.hæ–‡ä»¶å’Œä¸€ä¸ª.ccæ–‡ä»¶ï¼Œ.protoæ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªæ¶ˆæ¯æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»ã€‚\n- å¯¹Javaæ¥è¯´ï¼Œç¼–è¯‘å™¨ä¸ºæ¯ä¸€ä¸ªæ¶ˆæ¯ç±»å‹ç”Ÿæˆäº†ä¸€ä¸ª.javaæ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªç‰¹æ®Šçš„Builderç±»ï¼ˆè¯¥ç±»æ˜¯ç”¨æ¥åˆ›å»ºæ¶ˆæ¯ç±»æ¥å£çš„ï¼‰ã€‚\n- å¯¹Pythonæ¥è¯´ï¼Œæœ‰ç‚¹ä¸å¤ªä¸€æ ·â€”â€”Pythonç¼–è¯‘å™¨ä¸º.protoæ–‡ä»¶ä¸­çš„æ¯ä¸ªæ¶ˆæ¯ç±»å‹ç”Ÿæˆä¸€ä¸ªå«æœ‰é™æ€æè¿°ç¬¦çš„æ¨¡å—ï¼Œï¼Œè¯¥æ¨¡å—ä¸ä¸€ä¸ªå…ƒç±»ï¼ˆmetaclassï¼‰åœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰è¢«ç”¨æ¥åˆ›å»ºæ‰€éœ€çš„Pythonæ•°æ®è®¿é—®ç±»ã€‚\n- å¯¹goæ¥è¯´ï¼Œç¼–è¯‘å™¨ä¼šä½æ¯ä¸ªæ¶ˆæ¯ç±»å‹ç”Ÿæˆäº†ä¸€ä¸ª.pd.goæ–‡ä»¶ã€‚\n- å¯¹äºRubyæ¥è¯´ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯ç±»å‹ç”Ÿæˆäº†ä¸€ä¸ª.rbæ–‡ä»¶ã€‚\n- javaNanoæ¥è¯´ï¼Œç¼–è¯‘å™¨è¾“å‡ºç±»ä¼¼åŸŸjavaä½†æ˜¯æ²¡æœ‰Builderç±»\n- å¯¹äºObjective-Cæ¥è¯´ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯ç±»å‹ç”Ÿæˆäº†ä¸€ä¸ªpbobjc.hæ–‡ä»¶å’Œpbobjcmæ–‡ä»¶ï¼Œ.protoæ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªæ¶ˆæ¯æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»ã€‚\n- å¯¹äºC#æ¥è¯´ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯ç±»å‹ç”Ÿæˆäº†ä¸€ä¸ª.csæ–‡ä»¶ï¼Œ.protoæ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªæ¶ˆæ¯æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»ã€‚\n\n\n\n### Python gRPC ç¤ºä¾‹\n\n#### ç¼–è¯‘\n\nè¿™é‡Œæˆ‘ä»¬ç”¨Python ç¼–è¯‘ä¸€ä¸‹ï¼Œçœ‹å¾—åˆ°ä»€ä¹ˆï¼š\n\n```protobuf\n// æ–‡ä»¶å hello.proto\nsyntax = \"proto3\";\n\npackage hello;\n\n// The greeting service definition.\nservice Greeter {\n  // Sends a greeting\n  rpc SayHello (HelloRequest) returns (HelloReply) {}\n}\n\n// The request message containing the user's name.\nmessage HelloRequest {\n  string name = 1;\n}\n\n// The response message containing the greetings\nmessage HelloReply {\n  string message = 1;\n}\n```\n\n\n\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘:\n\n```bash\npython -m grpc_tools.protoc -I./ --python_out=. --grpc_python_out=. ./hello.proto\n```\n\nç”Ÿæˆäº†ä¸¤ä¸ªæ–‡ä»¶ï¼š\n\n* `hello_pb2.py` æ­¤æ–‡ä»¶åŒ…å«ç”Ÿæˆçš„ request(`HelloRequest`) å’Œ response(`HelloReply`) ç±»ã€‚\n* `hello_pb2_grpc.py` æ­¤æ–‡ä»¶åŒ…å«ç”Ÿæˆçš„ å®¢æˆ·ç«¯(`GreeterStub`)å’ŒæœåŠ¡ç«¯(`GreeterServicer`)çš„ç±»ã€‚\n\næºç åœ°å€ä¸º[https://github.com/grpc/grpc/blob/master/examples/protos/helloworld.proto](https://github.com/grpc/grpc/blob/master/examples/protos/helloworld.proto)\n\n\n\nè™½ç„¶ç°åœ¨å·²ç»ç”Ÿæˆäº†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æ‰‹åŠ¨å®ç°ä»¥åŠè°ƒç”¨çš„æ–¹æ³•ã€‚\n\n\n\n#### åˆ›å»ºæœåŠ¡ç«¯ä»£ç \n\nåˆ›å»ºå’Œè¿è¡Œ `Greeter` æœåŠ¡å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\n- å®ç°æˆ‘ä»¬æœåŠ¡å®šä¹‰çš„ç”Ÿæˆçš„æœåŠ¡æ¥å£ï¼šåšæˆ‘ä»¬çš„æœåŠ¡çš„å®é™…çš„â€œå·¥ä½œâ€çš„å‡½æ•°ã€‚\n\n- è¿è¡Œä¸€ä¸ª gRPC æœåŠ¡å™¨ï¼Œç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶ä¼ è¾“æœåŠ¡çš„å“åº”ã€‚\n\n  \n\nåœ¨å½“å‰ç›®å½•ï¼Œæ‰“å¼€æ–‡ä»¶ greeter_server.pyï¼Œå®ç°ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼š\n\n```python\nfrom concurrent import futures\nimport time\n\nimport grpc\n\nimport hello_pb2\nimport hello_pb2_grpc\n\n_ONE_DAY_IN_SECONDS = 60 * 60 * 24\n\n\nclass Greeter(hello_pb2_grpc.GreeterServicer):\n\t# å·¥ä½œå‡½æ•°\n    def SayHello(self, request, context):\n        return hello_pb2.HelloReply(message='Hello, %s!' % request.name)\n\n\ndef serve():\n    # gRPC æœåŠ¡å™¨\n    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))\n    hello_pb2_grpc.add_GreeterServicer_to_server(Greeter(), server)\n    server.add_insecure_port('[::]:50051')\n    server.start()  # start() ä¸ä¼šé˜»å¡ï¼Œå¦‚æœè¿è¡Œæ—¶ä½ çš„ä»£ç æ²¡æœ‰å…¶å®ƒçš„äº‹æƒ…å¯åšï¼Œä½ å¯èƒ½éœ€è¦å¾ªç¯ç­‰å¾…ã€‚\n    try:\n        while True:\n            time.sleep(_ONE_DAY_IN_SECONDS)\n    except KeyboardInterrupt:\n        server.stop(0)\n\nif __name__ == '__main__':\n    serve()\n```\n\n#### æ›´æ–°å®¢æˆ·ç«¯ä»£ç \n\nåœ¨å½“å‰ç›®å½•ï¼Œæ‰“å¼€æ–‡ä»¶ greeter_client.pyï¼Œå®ç°ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼š\n\n```python\nfrom __future__ import print_function\n\nimport grpc\n\nimport hello_pb2\nimport hello_pb2_grpc\n\n\ndef run():\n    channel = grpc.insecure_channel('localhost:50051')\n    stub = hello_pb2_grpc.GreeterStub(channel)\n    response = stub.SayHello(hello_pb2.HelloRequest(name='goodspeed'))\n    print(\"Greeter client received: \" + response.message)\n\n\nif __name__ == '__main__':\n    run()\n```\n\n\n\n> å¯¹äºè¿”å›å•ä¸ªåº”ç­”çš„ RPC æ–¹æ³•ï¼ˆ\"response-unary\" æ–¹æ³•ï¼‰ï¼ŒgRPC Python åŒæ—¶æ”¯æŒåŒæ­¥ï¼ˆé˜»å¡ï¼‰å’Œå¼‚æ­¥ï¼ˆéé˜»å¡ï¼‰çš„æ§åˆ¶æµè¯­ä¹‰ã€‚å¯¹äºåº”ç­”æµå¼ RPC æ–¹æ³•ï¼Œè°ƒç”¨ä¼šç«‹å³è¿”å›ä¸€ä¸ªåº”ç­”å€¼çš„è¿­ä»£å™¨ã€‚è°ƒç”¨è¿­ä»£å™¨çš„ `next()` æ–¹æ³•ä¼šé˜»å¡ï¼Œç›´åˆ°ä»è¿­ä»£å™¨äº§ç”Ÿçš„åº”ç­”å˜å¾—å¯ç”¨ã€‚\n\n\n\n#### è¿è¡Œä»£ç \n\n\n\n1. é¦–å…ˆè¿è¡ŒæœåŠ¡ç«¯ä»£ç \n\n```bash\npython greeter_server.py\n```\n\n2. ç„¶åè¿è¡Œå®¢æˆ·ç«¯ä»£ç \n\n```bash\npython greeter_client.py\n# output\n\nGreeter client received: Hello, goodspeed!\n```\n\n> [æºç åœ°å€: https://github.com/grpc/grpc/tree/master/examples/python](https://github.com/grpc/grpc/tree/master/examples/python)\n\n## å‚è€ƒé“¾æ¥\n\n* [gRPC å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ](https://doc.oschina.net/grpc?t=56831)\n* [Protobuf3è¯­è¨€æŒ‡å—](https://blog.csdn.net/u011518120/article/details/54604615)\n* [Google Protocol Buffer çš„ä½¿ç”¨å’ŒåŸç†](https://www.ibm.com/developerworks/cn/linux/l-cn-gpb/index.html)\n* [gRPC Python Quickstart](https://grpc.io/docs/quickstart/python.html)\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Python gRPC å…¥é—¨",
        "date": "2018-06-07 15:49:17",
        "tags": [
          "python",
          "tutorial",
          "grpc",
          "å°ç¨‹åº"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "hello_grpc"
    },
    {
      "content": "\n>Newrelic æ˜¯APMï¼ˆApplication Performance Managementï¼‰ï¼ˆåº”ç”¨æ€§èƒ½ç®¡ç†/ç›‘æ§ï¼‰è§£å†³æ–¹æ¡ˆæä¾›å•†ã€‚é¡¹ç›®ä¸­ï¼Œé€šå¸¸ç”¨å®ƒæ¥è¿½è¸ªåº”ç”¨çš„æ€§èƒ½ã€‚æœ€è¿‘çœ‹äº†ä¸€ä¸‹ newrelic-python-agent æºç ï¼Œè¿™æ˜¯æŸ¥çœ‹æºç è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•ã€‚\n \n### ç›®å½•ç»“æ„\nnewrelic ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n\n```bash\nnewrelic\nâ”œâ”€â”€ admin  # å¸¸ç”¨å‘½ä»¤\nâ”œâ”€â”€ api    # æ¢é’ˆ\nâ”œâ”€â”€ bootstrap\nâ”œâ”€â”€ common  \nâ”œâ”€â”€ core\nâ”œâ”€â”€ extras\nâ”‚   â””â”€â”€ framework_django\nâ”‚       â””â”€â”€ templatetags\nâ”œâ”€â”€ hooks   # æ•°æ®åº“ web å„ä¸ªåº“çš„ä¸€äº›æ¢é’ˆ\nâ”‚   â”œâ”€â”€ framework_tornado\nâ”‚   â”œâ”€â”€ framework_tornado_r3\nâ”‚   â””â”€â”€ framework_tornado_r4\nâ”œâ”€â”€ network\nâ”œâ”€â”€ packages\nâ”‚   â”œâ”€â”€ requests\nâ”‚   â”‚   â””â”€â”€ packages\nâ”‚   â”‚       â”œâ”€â”€ chardet\nâ”‚   â”‚       â””â”€â”€ urllib3\nâ”‚   â”‚           â”œâ”€â”€ packages\nâ”‚   â”‚           â”‚   â””â”€â”€ ssl_match_hostname\nâ”‚   â”‚           â””â”€â”€ util\nâ”‚   â””â”€â”€ wrapt\nâ””â”€â”€ samplers\n```\n\n### å‘½ä»¤\n\nä½¿ç”¨ `newrelic-admin help` å¯ä»¥åˆ—å‡ºæ‰€æœ‰å‘½ä»¤ï¼š\n\n```bash\n$ newrelic-admin help\n\nUsage: newrelic-admin command [options]\n\nType 'newrelic-admin help <command>'for help on a specific command.\n\nAvailable commands are:\n  generate-config\n  license-info\n  license-key\n  local-config\n  network-config\n  record-deploy\n  run-program\n  run-python\n  server-config\n  validate-config\n```\n\né€šè¿‡ setup.py ä»£ç å¯ä»¥çŸ¥é“ï¼š\n\n```python\nif with_setuptools:\n    kwargs['entry_points'] = {\n            'console_scripts': ['newrelic-admin = newrelic.admin:main'],\n            }\n```\n\n`newrelic-admin` å‘½ä»¤è°ƒç”¨çš„æ˜¯ `newrelic.admin:main`ï¼Œè¿™æ˜¯ä»£ç çš„å…¥å£ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ `newrelic/admin/`ç›®å½•ã€‚\n\n#### admin\n\n> admin ç›®å½•æ˜¯ newrelic-admin help åˆ—å‡ºçš„å‘½ä»¤è„šæœ¬æ‰€åœ¨ç›®å½•ã€‚ \n\nåŒ…å«æ–‡ä»¶å¦‚ä¸‹ï¼š\n\n```bash\n$ tree\nadmin\nâ”œâ”€â”€ __init__.py\nâ”œâ”€â”€ __main__.py\nâ”œâ”€â”€ debug_console.py\nâ”œâ”€â”€ generate_config.py\nâ”œâ”€â”€ license_info.py\nâ”œâ”€â”€ license_key.py\nâ”œâ”€â”€ local_config.py\nâ”œâ”€â”€ network_config.py\nâ”œâ”€â”€ record_deploy.py\nâ”œâ”€â”€ run_program.py\nâ”œâ”€â”€ run_python.py\nâ”œâ”€â”€ server_config.py\nâ””â”€â”€ validate_config.py\n```\n\n`__init__.py` çš„ main å‡½æ•° æ˜¯å‘½ä»¤æ‰§è¡Œçš„å…¥å£ã€‚\n\n`__init__.py` æ–‡ä»¶ä¸­ä»£ç \n\n```python\nload_internal_plugins()\nload_external_plugins()\n```\n\nç”¨æ¥åŠ è½½ `_builtin_plugins` ä¸­å®šä¹‰çš„å‘½ä»¤ã€‚ \n\n#### run_program\n\né¦–å…ˆçœ‹ä¸‹ run_program å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```bash\nnewrelic-admin run-program your command\n```\n\n`newrelic/admin/run_program.py` ä¸­ `run_program` å‡½æ•°æœ‰è£…é¥°å™¨ commandï¼Œç”¨æ¥å®šä¹‰å°†å‘½ä»¤ä»¥åŠç›¸å…³è¯´æ˜æ·»åŠ åˆ°å­—å…¸ `_commands`ã€‚\n\nåœ¨ `run_program` ä¸­ä»£ç ï¼š\n\n```python\nroot_directory = os.path.dirname(root_directory)\nboot_directory = os.path.join(root_directory, 'bootstrap')\n\nif 'PYTHONPATH' in os.environ:\n    path = os.environ['PYTHONPATH'].split(os.path.pathsep)\n    if not boot_directory in path:\n        python_path = \"%s%s%s\" % (boot_directory, os.path.pathsep, os.environ['PYTHONPATH'])\n\nos.environ['PYTHONPATH'] = python_path\n```\n\nå¯ä»¥å‘ç°`newrelic/bootstrap/sitecustomize.py` æ–‡ä»¶è¢«åŠ å…¥åˆ°äº† PYTHONPATHã€‚\n\n> python è§£é‡Šå™¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨ import `PYTHONPATH` ä¸‹å­˜åœ¨çš„ `sitecustomize` å’Œ `usercustomize` æ¨¡å—ã€‚\n\nä¹‹åçš„åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯è°ƒç”¨ os æ¨¡å—æ‰§è¡Œå‘½ä»¤ã€‚\n\nç°åœ¨çœ‹ä¸‹`newrelic/bootstrap/sitecustomize.py` ä»£ç ã€‚\n\nåœ¨ è¿™ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œï¼š\n\n```python\nnewrelic.config.initialize(config_file, environment)\n```\n\nè¿™é‡Œç”¨æ¥åˆå§‹åŒ–newrelicï¼Œå…·ä½“ä»£ç åœ¨ `newrelic/config.py`æ–‡ä»¶ã€‚\n\nä»¥ä¸‹æ˜¯initializeå‡½æ•°ï¼š\n\n```python\ndef initialize(config_file=None, environment=None, ignore_errors=None,\n            log_file=None, log_level=None):\n\n    if config_file is None:\n        config_file = os.environ.get('NEW_RELIC_CONFIG_FILE', None)\n\n    if environment is None:\n        environment = os.environ.get('NEW_RELIC_ENVIRONMENT', None)\n\n    if ignore_errors is None:\n        ignore_errors = newrelic.core.config._environ_as_bool(\n                'NEW_RELIC_IGNORE_STARTUP_ERRORS', True)\n\n    _load_configuration(config_file, environment, ignore_errors,\n            log_file, log_level)  # åŠ è½½é…ç½®\n\n    if _settings.monitor_mode or _settings.developer_mode:\n        _settings.enabled = True\n        _setup_instrumentation()  # è®¾ç½®æ¢é’ˆ\n        _setup_data_source()  # TODO\n        _setup_extensions()   # TODO\n        _setup_agent_console()   # TODO\n    else:\n        _settings.enabled = False\n```\n\nå…¶ä¸­ç¬¬14è¡Œ `_load_configuration` æ˜¯ç”¨æ¥åŠ è½½ newrelic çš„ç›¸å…³é…ç½®ã€‚æ¯”å¦‚ï¼šæ—¥å¿—ç›®å½•ã€å„ç§ç¯å¢ƒå˜é‡ã€ç§˜é’¥ã€newrelic host åœ°å€ç­‰ç­‰ã€‚ \n\n`_setup_instrumentation() ä¸­ _process_module_builtin() ç”¨æ¥è®¾ç½®æ¢é’ˆã€‚\n\næ•°æ®åº“ã€å¤–éƒ¨è¯·æ±‚ ç­‰ç›‘æ§æ¨¡å—éƒ½ä½äº hook ç›®å½•ä¸‹ï¼Œé€šè¿‡ `_process_module_builtin` å‡½æ•°å°†è¿›ç¨‹ä¸ç›‘æ§æ¨¡å—è¿›è¡Œç»‘å®šï¼ŒåŒ…æ‹¬ django çš„ä¸»è¦æ¨¡å—ä»¥åŠå¸¸ç”¨çš„æ•°æ®åº“ç­‰ã€‚åœ¨æ ¸å¿ƒæ¨¡å—æ‰§è¡Œçš„æ—¶å€™è§¦å‘ç›‘æ§ï¼Œå°†æ•°æ®å›ä¼ åˆ° `api.time_trace` æ¨¡å—è¿›è¡Œå¤„ç†ã€‚\n\nè€Œå¯¹äºç¡¬ä»¶ä¿¡æ¯çš„æ£€æµ‹åˆ™ç”± `commo.system_info` è¿›è¡Œã€‚\n\n### newrelic run_program åˆå§‹åŒ–è¿‡ç¨‹\n\nä»¥ä¸‹ä¸º flask åº”ç”¨åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå…¶å®ƒåº”ç”¨ç±»ä¼¼ï¼š\n\n1. `newrelic/admin/__init__.py main()`\n2. `newrelic/admin/run_program.py` ä»£ç ä¸­ä¼šæŠŠ `newrelic/bootstrap/sitecustomize.py` æ·»åŠ åˆ° `PYTHONPATH`,python è§£é‡Šå™¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨ import `PYTHONPATH` ä¸‹å­˜åœ¨çš„ `sitecustomize` å’Œ `usercustomize` æ¨¡å—\n3. `newrelic/bootstrap/sitecustomize.py` è°ƒç”¨ `newrelic.config.initialize()`ï¼Œ`_setup_instrumentation()` å‡½æ•°è¢«è°ƒç”¨ï¼Œ`_process_module_builtin`ä¼šæŠŠéœ€è¦ wrap çš„åŒ…å…ˆæ·»åŠ åˆ°_import_hooksã€‚\n4. `newrelic/config.py` ä¸­  `sys.meta_path.insert(0, newrelic.api.import_hook.ImportHookFinder())` æ‰§è¡Œ\n5. `newrelic/api/import_hook.py  ImportHookFinder().find_model()`\n6. `newrelic/api/import_hook.py  _ImportHookLoader() or _ImportHookChainedLoader()`\n7. `newrelic/api/import_hook.py  _notify_import_hooks`  `callable` ä¸º `newrelic/config _module_import_hook  _instrument`\n8. `newrelic/hooks/framework_flask.py instrument_flask_app`\n9. `newrelic/api/web_transaction.py wrap_wsgi_application`\n10. `newrelic/common/object_wrapper.py wrap_object`\n\nåœ¨ä»£ç ä¸­ï¼Œä½¿ç”¨åˆ°äº†ç¬¬ä¸‰æ–¹åŒ… `wrapt`ï¼Œä»¥ä¸‹æ˜¯ wrapt çš„å®˜æ–¹æè¿°ï¼ˆ[æ–‡æ¡£åœ°å€](https://wrapt.readthedocs.io/en/latest/index.html))ã€‚\n\n> wraptæ¨¡å—çš„ç›®çš„æ˜¯ä¸ºPythonæä¾›ä¸€ä¸ªé€æ˜çš„å¯¹è±¡ä»£ç†ï¼Œå®ƒå¯ä»¥ä½œä¸ºæ„å»ºå‡½æ•°åŒ…è£…å™¨å’Œè£…é¥°å‡½æ•°çš„åŸºç¡€ã€‚wrapt æä¾›äº†ä¸€ä¸ªç®€å•æ˜“ç”¨çš„decoratorå·¥å‚ï¼Œåˆ©ç”¨å®ƒä½ å¯ä»¥ç®€å•åœ°åˆ›å»ºdecoratorï¼Œå¹¶ä¸”åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯ä»¥æ­£ç¡®åœ°ä½¿ç”¨å®ƒä»¬ã€‚\n\n`wrapt`ç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```python\nimport wrapt\n# æ™®é€šè£…é¥°å™¨\n@wrapt.decorator\ndef pass_through(wrapped, instance, args, kwargs):\n    return wrapped(*args, **kwargs)\n\n@pass_through\ndef function():\n    pass\n\n# å¸¦å‚æ•°çš„è£…é¥°å™¨\nimport wrapt\n\ndef with_arguments(myarg1, myarg2):\n    @wrapt.decorator\n    def wrapper(wrapped, instance, args, kwargs):\n        return wrapped(*args, **kwargs)\n    return wrapper\n\n@with_arguments(1, 2)\ndef function():\n    pass\n```\n\nè¦å®ç°decoratorï¼Œéœ€è¦é¦–å…ˆå®šä¹‰ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°ã€‚è¿™å°†åœ¨æ¯æ¬¡è°ƒç”¨ä¿®é¥°å‡½æ•°æ—¶è°ƒç”¨ã€‚è£…é¥°å™¨å‡½æ•°éœ€è¦ä½¿ç”¨å››ä¸ªä½ç½®å‚æ•°:\n\n- wrapped - The wrapped function which in turns needs to be called by your wrapper function.\n- instance - The object to which the wrapped function was bound when it was called.\n- args - The list of positional arguments supplied when the decorated function was called.\n- kwargs - The dictionary of keyword arguments supplied when the decorated function was called.\n\nå…·ä½“ä½¿ç”¨å‚è€ƒæ–‡æ¡£å§ã€‚ [æ–‡æ¡£åœ°å€](https://wrapt.readthedocs.io/en/latest/index.html)\n\n------\n\nnewrelic æºç ä»”ç»†çœ‹ä¸‹å»ï¼Œå¤ª...å¤æ‚äº†ã€‚ä¸‹ä¸€ç¯‡å†åˆ†æä¸€ä¸ª flask è¯·æ±‚åˆ°ç»“æŸæ¢é’ˆå·¥ä½œçš„å®Œæ•´è¿‡ç¨‹å§ã€‚\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "newrelic python agent æºç åˆ†æ-1",
        "date": "2018-05-16 12:17:13",
        "tags": [
          "python",
          "åç«¯",
          "weixin",
          "development"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "newrelic_source_code_1"
    },
    {
      "content": "\n> ä¸Šä¸€ç¯‡æˆ‘ä»¬äº†è§£äº†golang çš„å˜é‡ã€å‡½æ•°å’ŒåŸºæœ¬ç±»å‹ï¼Œè¿™ä¸€ç¯‡å°†ä»‹ç»ä¸€ä¸‹æ§åˆ¶æµ\n\nç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­:\n\n### fibonacci(é€’å½’ç‰ˆ)\n\n``` go\npackage main\nimport \"fmt\"\n\nfunc main() {\n    result := 0\n    for i := 0; i <= 10; i++ {\n\t     result = fibonacci(i)\n\t     fmt.Printf(\"fibonacci(%d) is: %d\\n\", i, result)\n\t  }\n}\n\nfunc fibonacci(n int) (res int) {\n    if n <= 1 {\n        res = 1\n\t   } else {\n\t       res = fibonacci(n-1) + fibonacci(n-2)\n\t   }\n\treturn\n}\n\n    // outputs\n\n    fibonacci(0) is: 1\n    fibonacci(1) is: 1\n    fibonacci(2) is: 2\n    fibonacci(3) is: 3\n    fibonacci(4) is: 5\n    fibonacci(5) is: 8\n    fibonacci(6) is: 13\n    fibonacci(7) is: 21\n    fibonacci(8) is: 34\n    fibonacci(9) is: 55\n    fibonacci(10) is: 89\n```\n\n\n* for i := 0; i <= 10; i++ {} ç¬¬7è¡Œæ˜¯ä¸€ä¸ªå¾ªç¯ç»“æ„ è¿™é‡Œfor å¾ªç¯æ˜¯ä¸€ä¸ªæ§åˆ¶æµ\n\n## æ§åˆ¶æµ\n### For\n\nGo åªæœ‰ä¸€ç§å¾ªç¯æ¥å£-- `for å¾ªç¯`\n\nFor æ”¯æŒä¸‰ç§å¾ªç¯æ–¹å¼,åŒ…æ‹¬ç±» while è¯­æ³•\n\n#### 1 åŸºæœ¬forå¾ªç¯ æ”¯æŒåˆå§‹åŒ–è¯­å¥\n``` go\ns := \"abc\"\nfor i, n := 0, len(s); i < n; i++ {\n\t// i, n ä¸ºå®šä¹‰çš„å˜é‡ åªåœ¨for å¾ªç¯å†…ä½œç”¨\n    println(s[i])\n}\n```\n\n*åŸºæœ¬çš„ for å¾ªç¯åŒ…å«ä¸‰ä¸ªç”±åˆ†å·åˆ†å¼€çš„ç»„æˆéƒ¨åˆ†ï¼š*\n\n* åˆå§‹åŒ–è¯­å¥ï¼šåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯æ‰§è¡Œå‰è¢«æ‰§è¡Œ\n* å¾ªç¯æ¡ä»¶è¡¨è¾¾å¼ï¼šæ¯è½®è¿­ä»£å¼€å§‹å‰è¢«æ±‚å€¼\n* åç½®è¯­å¥ï¼šæ¯è½®è¿­ä»£åè¢«æ‰§è¡Œ\n\n#### 2 æ›¿ä»£ while (n > 0) {}\n\nC çš„ while åœ¨ Go ä¸­å«åš for\n\n``` go\nn := len(s)\n// å¾ªç¯åˆå§‹åŒ–è¯­å¥å’Œåç½®è¯­å¥éƒ½æ˜¯å¯é€‰çš„ã€‚\nfor n > 0 { // ç­‰åŒäº for (; n > 0;) {}\n    println(s[n])\n    n--\n}\n```\n\n#### 3 æ­»å¾ªç¯\n```go\n    for { // while true\n        println(s)\n    }\n```\n\n### IFâ€¦ELSE\n\n> å°±åƒ for å¾ªç¯ä¸€æ ·ï¼ŒGo çš„ if è¯­å¥ä¹Ÿä¸è¦æ±‚ç”¨ ( ) å°†æ¡ä»¶æ‹¬èµ·æ¥ï¼ŒåŒæ—¶ï¼Œ { } è¿˜æ˜¯å¿…é¡»æœ‰çš„\n\n* æ¡ä»¶è¡¨è¾¾å¼å¿…é¡»æ˜¯å¸ƒå°”ç±»å‹ï¼Œå¯çœç•¥æ¡ä»¶è¡¨è¾¾å¼æ‹¬å·\n* æ”¯æŒåˆå§‹åŒ–è¯­å¥,å¯å®šä¹‰ä»£ç å—å±€éƒ¨å˜é‡\n* ä»£ç å—å·¦å¤§æ‹¬å·å¿…é¡»åœ¨æ¡ä»¶è¡¨è¾¾å¼å°¾éƒ¨\n\n```go\nx := 0\n\n// if x > 10  // Error: missing condition in if statement(å·¦å¤§æ‹¬å·å¿…é¡»åœ¨æ¡ä»¶è¡¨è¾¾å¼å°¾éƒ¨)\n// {\n// }\n\nif x > 10{\n    ...\n}else{\n    ...\n}\n\nif n := \"abc\"; x > 0 {  // åˆå§‹åŒ–è¯­å¥(åœ¨è¿™é‡Œæ˜¯å®šä¹‰å˜é‡)\n\tprintln(n[2])\n} else if x < 0 {\n\tprintln(n[1])\n} else {\n    println(n[0])     // å±€éƒ¨å˜é‡ n æœ‰æ•ˆèŒƒå›´æ˜¯ æ•´ä¸ª if/else å—\n}\n```\n\n> if è¯­å¥å®šä¹‰çš„å˜é‡ä½œç”¨åŸŸä»…åœ¨ifèŒƒå›´ä¹‹å†…(åŒ…å«elseè¯­å¥)\n> ä¸æ”¯æŒä¸‰å…ƒæ“ä½œç¬¦ \"a > b ? a : b\"\n\nä»¥ä¸Šæ˜¯ä¸Šæ®µä»£ç å‡ºç°çš„ä¸¤ä¸ªæ§åˆ¶æµï¼Œå‰©ä¸‹çš„æ§åˆ¶æµè¿˜æœ‰\n\n* Switch\n* Range\n* Goto, Break, Continue, defer\n\n### Switch\n\nswitch è¯­å¥ç”¨äºé€‰æ‹©æ‰§è¡Œï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\n\n```go\n    switch optionalStatement; optionalExpression{\n\t\tcase expressionList1: block1\n\t\t...\n\t\tcase expressionListN: blockN\n\t\tdefault: blockD\n\t}\n```\n\nå…ˆçœ‹ä¸€ä¸ªä¾‹å­:\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"runtime\"\n)\n\nfunc main() {\n\tfmt.Print(\"Go runs on \")\n\tswitch os := runtime.GOOS; os { // å°† os ä¸ case æ¡ä»¶åŒ¹é…\n\tcase \"darwin\":\n\t\tfmt.Println(\"OS X.\")\n\tcase \"linux\":\n\t\tfmt.Println(\"Linux.\")\n\tcase \"plan9\", \"openbsd\": // å¤šä¸ªæ¡ä»¶å‘½ä¸­å…¶ä¸€å³å¯(OR)\n\t\tfmt.Println(\"plan9 | openbsd\")\n\tdefault:\n\t\t// freebsd, openbsd,\n\t\t// plan9, windows...\n\t\tfmt.Printf(\"%s.\", os)\n\t}\n}\n\n```\n\n* å¦‚æœæœ‰å¯é€‰è¯­å¥å£°æ˜, åˆ†å·æ˜¯å¿…è¦çš„, æ— è®ºåè¾¹çš„å¯é€‰è¡¨è¾¾å¼è¯­å¥æ˜¯å¦å‡ºç°(å¦‚æœå¯é€‰è¯­å¥æ²¡æœ‰å‡ºç°é»˜è®¤ä¸ºtrue)\n* æ¯ä¸€ä¸ªcase è¯­å¥å¿…é¡»è¦æœ‰ä¸€ä¸ªè¡¨è¾¾å¼åˆ—è¡¨ï¼Œå¤šä¸ªç”¨åˆ†å·éš”å¼€\n* switch è¯­å¥è‡ªä¸Šè€Œä¸‹æ‰§è¡Œï¼Œå½“åŒ¹é…æˆåŠŸåæ‰§è¡Œcaseåˆ†æ”¯çš„ä»£ç å—ï¼Œæ‰§è¡Œç»“æŸåé€€å‡ºswitch\n```go\nswitch i {\ncase 0: // ç©ºåˆ†æ”¯ï¼Œåªæœ‰å½“ i == 0 æ—¶æ‰ä¼šè¿›å…¥åˆ†æ”¯ ç›¸å½“äº \"case 0: break;\"\ncase 1:\n    f() // å½“ i == 0 æ—¶å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨\n}\n```\n\n* å¦‚æœæƒ³è¦åœ¨æ‰§è¡Œå®Œæ¯ä¸ªåˆ†æ”¯çš„ä»£ç åè¿˜ç»§ç»­æ‰§è¡Œåç»­çš„åˆ†æ”¯ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨fallthrough å…³é”®å­—è¾¾åˆ°ç›®çš„\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc switch1(n int) {\n\tswitch { // è¿™é‡Œç”¨çš„æ˜¯æ²¡æœ‰æ¡ä»¶çš„switch è¯­å¥ä¼šç›´æ¥æ‰§è¡Œ\n\tcase n == 0:\n\t\tfmt.Println(0)\n\t\tfallthrough  // fallthrough éœ€æ”¾åœ¨ case å—ç»“å°¾ï¼Œå¯ç”¨ break é˜»æ­¢\n\tcase n == 1: // å¦‚æœåŒ¹é…åˆ°0 è¿™é‡Œä¼šç»§ç»­æ‰§è¡Œ\n\t\tfmt.Println(1)\n\tcase n == 2: // fallthrough ä¸ä¼šå¯¹è¿™é‡Œæœ‰ä½œç”¨\n\t\tfmt.Println(2)\n\tdefault:\n\t\tfmt.Println(\"default\")\n\t}\n}\n\nfunc main() {\n\tswitch1(0)\n}\n# output\n0\n1\n```\n* ç”¨ default å¯ä»¥æŒ‡å®šå½“å…¶ä»–æ‰€æœ‰åˆ†æ”¯éƒ½ä¸åŒ¹é…çš„æ—¶å€™çš„è¡Œä¸º\n\n```go\n    switch i {\n    \tcase 0:\n    \tcase 1:\n    \t\tf()\n    \tdefault:\n    \t\tg()  // å½“iä¸ç­‰äº0 æˆ– 1 æ—¶è°ƒç”¨\n    }\n```\n\n### Range\n\n> Range ç±»ä¼¼è¿­ä»£å™¨çš„æ“ä½œï¼Œè¿”å›(ç´¢å¼•ï¼Œå€¼)æˆ–(å¥ï¼Œå€¼)\n\nå®ƒå¯ä»¥è¿­ä»£ä»»ä½•ä¸€ä¸ªé›†åˆï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•°ç»„ã€æ•°ç»„æŒ‡é’ˆã€åˆ‡ç‰‡ã€å­—å…¸ã€é€šé“ï¼‰\n\nåŸºæœ¬è¯­æ³•å¦‚ä¸‹:\n\n```go\ncoll := 3string[\"a\", \"b\", \"c\"]\nfor ix, val := range coll {\n   ...\n}\n\n// å…è®¸è¿”å›å•å€¼\n\nfor ix := range coll {\n    println(ix, coll[ix])\n}\n\n// ä¹Ÿå¯ä»¥ä½¿ç”¨ _ å¿½ç•¥\n\nfor _, val := range coll {\n    println(val)\n}\n\n// ä¹Ÿå¯ä»¥åªè¿­ä»£ï¼Œä¸è¿”å›ã€‚å¯ç”¨æ¥æ‰§è¡Œæ¸…ç©º channel ç­‰æ“ä½œ\n\nfor range coll {\n    ...\n}\n```\n\nval å§‹ç»ˆä¸ºé›†åˆä¸­å¯¹åº”ç´¢å¼•çš„å€¼æ‹·è´ï¼Œå› æ­¤å®ƒä¸€èˆ¬åªå…·æœ‰åªè¯»æ€§è´¨ï¼Œå¯¹å®ƒæ‰€åšçš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šå½±å“åˆ°é›†åˆä¸­åŸæœ‰çš„å€¼ï¼ˆè¯‘è€…æ³¨ï¼šå¦‚æœ val ä¸ºæŒ‡é’ˆï¼Œåˆ™ä¼šäº§ç”ŸæŒ‡é’ˆçš„æ‹·è´ï¼Œä¾æ—§å¯ä»¥ä¿®æ”¹é›†åˆä¸­çš„åŸå€¼\nä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ Unicode ç¼–ç çš„å­—ç¬¦ï¼ˆæˆ–ç§°ä¹‹ä¸º runeï¼‰é›†åˆï¼Œå› æ­¤æ‚¨ä¹Ÿå¯ä»¥ç”¨å®ƒè¿­ä»£å­—ç¬¦ä¸²\n\nä¸‹é¢æ˜¯æ¯ç§æ•°æ®ç±»å‹ä½¿ç”¨rangeæ—¶ ixå’Œval çš„å€¼\n\n| date type   | ix      | value    | å€¼ç±»å‹        |\n| ----------- | ------- | -------- | ------------- |\n| string      | index   | s[index] | unicode, rune |\n| array/slice | index   | s[index] |               |\n| map         | key     | m[index] |               |\n| channel     | element |          |               |\n\n> range ä¼šå¤åˆ¶ç›®æ ‡æ•°æ®ã€‚å­—ç¬¦ä¸²ã€åˆ‡ç‰‡åŸºæœ¬ç»“æ„æ˜¯ä¸ªå¾ˆå°çš„ç»“æ„ä½“ï¼Œè€Œå­—å…¸ã€é€šé“æœ¬èº«æ˜¯æŒ‡é’ˆå°è£…ï¼Œå¤åˆ¶æˆæœ¬å¾ˆå°ï¼Œæ— éœ€ä¸“é—¨ä¼˜åŒ–ã€‚\n>\n> å¦‚æœæ˜¯æ•°ç»„ï¼Œå¯æ”¹æˆæ•°ç»„æŒ‡é’ˆæˆ–è€…åˆ‡ç‰‡ç±»å‹ã€‚\n\n### Break continue\n\nbreak å’Œ continue éƒ½å¯åœ¨å¤šçº§åµŒå¥—å¾ªç¯ä¸­è·³å‡º\n\n> break å¯ç”¨äº forã€switchã€selectè¯­å¥ï¼Œç»ˆæ­¢æ•´ä¸ªè¯­å¥å—æ‰§è¡Œ\n>\n> continue ä»…èƒ½ äº for å¾ªç¯ï¼Œç»ˆæ­¢åç»­æ“ä½œï¼Œç«‹å³è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ã€‚\n\n### goto\n\ngoto è¯­å¥å¯ä»¥é…åˆæ ‡ç­¾ï¼ˆlabelï¼‰å½¢å¼çš„æ ‡è¯†ç¬¦ä½¿ç”¨ï¼Œå³æŸä¸€è¡Œç¬¬ä¸€ä¸ªä»¥å†’å·`:`ç»“å°¾çš„å•è¯ï¼Œæ ‡ç­¾åŒºåˆ†å¤§å°å†™ã€‚\n\n```go\npackage main\n\nfunc main() {\n    i:=0\n    HERE:\n\t    print(i)\n\t\ti++\n        if i==5 {\n\t        return\n\t    }\n        goto HERE\n}\n# output 01234\n```\n\n> ä½¿ç”¨æ ‡ç­¾å’Œ goto è¯­å¥æ˜¯ä¸è¢«é¼“åŠ±çš„ï¼šå®ƒä»¬ä¼šå¾ˆå¿«å¯¼è‡´éå¸¸ç³Ÿç³•çš„ç¨‹åºè®¾è®¡ï¼Œè€Œä¸”æ€»æœ‰æ›´åŠ å¯è¯»çš„æ›¿ä»£æ–¹æ¡ˆæ¥å®ç°ç›¸åŒçš„éœ€æ±‚ã€‚\n\nforã€switch æˆ– select è¯­å¥éƒ½å¯ä»¥é…åˆæ ‡ç­¾ï¼ˆlabelï¼‰å½¢å¼çš„æ ‡è¯†ç¬¦ä½¿ç”¨\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\nLABEL1:\n    for i := 0; i <= 5; i++ {\n\t\tfor j := 0; j <= 5; j++ {\n\t\t\tif j == 4 {\n\t\t\t\tcontinue LABEL1\n\t\t\t}\n\t\t\tfmt.Printf(\"i is: %d, and j is: %d\\n\", i, j)\n\t\t}\n\t}\n}\n\n```\n\n> continue è¯­å¥æŒ‡å‘ LABEL1ï¼Œå½“æ‰§è¡Œåˆ°è¯¥è¯­å¥çš„æ—¶å€™ï¼Œå°±ä¼šè·³è½¬åˆ° LABEL1 æ ‡ç­¾çš„ä½ç½®\n\n### defer\n\ndefer è¯­å¥ä¼šå»¶è¿Ÿå‡½æ•°çš„æ‰§è¡Œç›´åˆ°ä¸Šå±‚å‡½æ•°è¿”å›\n\nå»¶è¿Ÿè°ƒç”¨çš„å‚æ•°ä¼šç«‹åˆ»ç”Ÿæˆï¼Œä½†æ˜¯åœ¨ä¸Šå±‚å‡½æ•°è¿”å›å‰å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tdefer fmt.Println(\"world\")\n\n\tfmt.Println(\"hello\")\n}\n\n// output\nhello\nworld\n```\n\n*defer æ ˆ*\n\nå»¶è¿Ÿçš„å‡½æ•°è°ƒç”¨è¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚å½“å‡½æ•°è¿”å›æ—¶ï¼Œ ä¼šæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºè°ƒç”¨è¢«å»¶è¿Ÿçš„å‡½æ•°è°ƒç”¨ã€‚\ndefer å¸¸ç”¨æ¥å®šä¹‰ç®€å•çš„æ–¹æ³•\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"counting\")\n\n\tfor i := 0; i < 10; i++ {\n\t\t\tdefer fmt.Println(i)\n\t\t}\n\n\t\tfmt.Println(\"done\")\n}\n// å¯ä»¥æƒ³ä¸€ä¸‹ä¼šè¾“å‡ºä»€ä¹ˆ\n// ä»£ç æ‰§è¡Œ https://tour.go-zh.org/flowcontrol/13\n```\n\n*å…³é”®å­— defer å…è®¸æˆ‘ä»¬è¿›è¡Œä¸€äº›å‡½æ•°æ‰§è¡Œå®Œæˆåçš„æ”¶å°¾å·¥ä½œï¼Œä¾‹å¦‚ï¼š*\n\n* å…³é—­æ–‡ä»¶æµï¼š\n\n    // open a file defer file.Close()\n\n* è§£é”ä¸€ä¸ªåŠ é”çš„èµ„æº\n\n    mu.Lock() defer mu.Unlock()\n\n* æ‰“å°æœ€ç»ˆæŠ¥å‘Š\n\n    printHeader() defer printFooter()\n\n* å…³é—­æ•°æ®åº“é“¾æ¥\n\n\t// open a database connection defer disconnectFromDB()\n\nåˆç†ä½¿ç”¨ defer è¯­å¥èƒ½å¤Ÿä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ã€‚\n\nä¸‹é¢çš„ä»£ç å±•ç¤ºäº†åœ¨è°ƒè¯•æ—¶ä½¿ç”¨ defer è¯­å¥çš„æ‰‹æ³•\n\n```go\npackage main\n\nimport (\n\t\"io\"\n    \"log\"\n)\n\nfunc func1(s string) (n int, err error) {\n    defer func() {\n\t        log.Printf(\"func1(%q) = %d, %v\", s, n, err)\n\t    }()\n    return 7, io.EOF\n}\n\nfunc main() {\n    func1(\"Go\")\n}\n\n// è¾“å‡º\nOutput: 2016/04/25 10:46:11 func1(\"Go\") = 7, EOF\n```\n\næ›´å¤šdefer çš„ç”¨æ³•([https://blog.go-zh.org/defer-panic-and-recover](https://blog.go-zh.org/defer-panic-and-recover))\n\n### å‚è€ƒé“¾æ¥\n\n[Go æŒ‡å—](https://tour.go-zh.org/flowcontrol/1)\n[The way to go -- æ§åˆ¶ç»“æ„](https://github.com/Unknwon/the-way-to-go_ZH_CN/blob/master/eBook/05.0.md)\n[Effective Go](https://golang.org/doc/effective_go.html)\n\nåˆ°è¿™é‡Œç®€å•çš„æ§åˆ¶æµç”¨æ³•è®²è§£å°±ç»“æŸäº†\n\nä¸‹èŠ‚å°†ä¼šæ˜¯golang æ•°æ®ç»“æ„éƒ¨åˆ†, ä¼šç”¨åˆ°çš„ä»£ç ä¸º\n\n### fibonacci(å†…å­˜ç‰ˆ)\n\n```go\n package main\n\n import (\n     \"fmt\"\n     \"time\"\n )\n\n const LIM = 41\n\n var fibs [LIM]uint64\n\n func main() {\n     var result uint64 = 0\n     start := time.Now()\n     for i := 0; i < LIM; i++ {\n         result = fibonacci(i)\n         fmt.Printf(\"fibonacci(%d) is: %d\\n\", i, result)\n     }\n     end := time.Now()\n     delta := end.Sub(start)\n     fmt.Printf(\"longCalculation took this amount of time: %s\\n\", delta)\n }\n func fibonacci(n int) (res uint64) {\n     // memoization: check if fibonacci(n) is already known in array:\n     if fibs[n] != 0 {\n         res = fibs[n]\n         return\n     }\n     if n <= 1 {\n         res = 1\n     } else {\n         res = fibonacci(n-1) + fibonacci(n-2)\n     }\n     fibs[n] = res\n     return\n }\n```\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Golang å­¦ä¹ ç¬”è®°-2ï¼šæ§åˆ¶æµ",
        "date": "2018-04-17 15:49:35",
        "tags": [
          "golang",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "golang-learning-note-2"
    },
    {
      "content": "\n## å˜é‡&å‡½æ•°\n\næœ€è¿‘åœ¨å­¦ä¹ golangï¼Œå†™ä¸‹å­¦ä¹ ç¬”è®°æå‡è®°å¿†ã€‚\nä¸ºäº†çœ‹èµ·æ¥ä¸æ˜¯é‚£ä¹ˆæ¯ç‡¥ï¼Œæœ¬å­¦ä¹ ç¬”è®°é‡‡ç”¨åˆ†æä»£ç çš„å½¢å¼ã€‚\n\né¦–å…ˆæ¬å‡ºæˆ‘ä»¬æœ€ç»å…¸çš„ç¬¬ä¸€æ®µä»£ç :\n\n### hello world\n\n```go\n    package main // 0\n\n    import \"fmt\" // 1å®ç°æ ¼å¼åŒ–çš„ I/O\n\n    /* Print something */ // 2\n    func main() { // 3\n    \tfmt.Println(\"Hello, world; or ÎºÎ±Î»Î·Î¼Îµ ÌÏÎ± ÎºoÌÏƒÎ¼Îµ; orã“ã‚“ã«ã¡ã¯ ä¸–ç•Œ\") // 4\n    }\n```\n\né¦–å…ˆæˆ‘ä»¬è¦è®¤è¯†åˆ°\n\n> æ¯ä¸ªGo ç¨‹åºéƒ½æ˜¯ç”±åŒ…ç»„æˆï¼Œç¨‹åºçš„è¿è¡Œå…¥å£æ˜¯åŒ…main\n\n1. é¦–è¡Œè¿™ä¸ªæ˜¯å¿…é¡»çš„ã€‚æ‰€æœ‰çš„ Go æ–‡ä»¶ä»¥ `package something` å¼€å¤´,å¯¹äºç‹¬ç«‹è¿è¡Œçš„æ‰§è¡Œæ–‡ä»¶å¿…é¡»æ˜¯ `package main`;\n2. è¿™æ˜¯è¯´éœ€è¦å°†fmtåŠ å…¥åˆ°mainã€‚ä¸æ˜¯main çš„åŒ…è¢«ç§°ä¸ºåº“ æœ«å°¾ä»¥ `//` å¼€å¤´çš„å†…å®¹æ˜¯å•è¡Œæ³¨é‡Š Package fmtåŒ…å«æœ‰æ ¼å¼åŒ–I/Oå‡½æ•°ï¼Œç±»ä¼¼äºCè¯­è¨€çš„printfå’Œscanf\n3. è¿™ä¹Ÿæ˜¯æ³¨é‡Šï¼Œè¡¨ç¤ºå¤šè¡Œæ³¨é‡Šã€‚\n4. package main å¿…é¡»é¦–å…ˆå‡ºç°,ç´§è·Ÿç€æ˜¯ importã€‚åœ¨ Go ä¸­,package æ€»æ˜¯é¦–å…ˆå‡ºç°, ç„¶åæ˜¯ import,ç„¶åæ˜¯å…¶ä»–æ‰€æœ‰å†…å®¹ã€‚å½“ Go ç¨‹åºåœ¨æ‰§è¡Œçš„æ—¶å€™,é¦–å…ˆè°ƒç”¨çš„å‡½æ•° æ˜¯ main.main(),è¿™æ˜¯ä» C ä¸­ç»§æ‰¿è€Œæ¥ã€‚è¿™é‡Œå®šä¹‰äº†è¿™ä¸ªå‡½æ•°\n5. è°ƒç”¨äº†æ¥è‡ªäº fmt åŒ…çš„å‡½æ•°æ‰“å°å­—ç¬¦ä¸²åˆ°å±å¹•ã€‚å­—ç¬¦ä¸²ç”± \" åŒ…è£¹,å¹¶ä¸”å¯ä»¥åŒ…å«é ASCII çš„å­—ç¬¦ã€‚è¿™é‡Œä½¿ç”¨äº†å¸Œè…Šæ–‡å’Œæ—¥æ–‡ã€ä¸­æ–‡\"\n\n### ç¼–è¯‘å’Œè¿è¡Œä»£ç \n\næ„å»º Go ç¨‹åºçš„æœ€ä½³é€”å¾„æ˜¯ä½¿ç”¨ go å·¥å…·ã€‚ æ„å»º helloworld åªéœ€è¦:\n\n```\n    1. go build helloworld.go\n    # ç»“æœæ˜¯å«åš helloworld çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\n    2. ./helloworld\n    # Hello, world; or ÎºÎ±Î»Î·Î¼Îµ ÌÏÎ± ÎºoÌÏƒÎ¼Îµ; or ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ\n```\n\n\n### å˜é‡\n\nGo æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œä¸èƒ½åœ¨è¿è¡ŒæœŸæ”¹å˜å˜é‡ç±»å‹ã€‚\n\nå˜é‡å¦‚æœä¸æä¾›åˆå§‹åŒ–å€¼å°†è‡ªåŠ¨åˆå§‹åŒ–ä¸ºé›¶å€¼ã€‚å¦‚æœæä¾›åˆå§‹åŒ–å€¼ï¼Œå¯çœç•¥å˜é‡ç±»å‹ï¼Œç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ã€‚\n\n```go\n    var x int\n    // ä½¿ç”¨å…³é”®å­— var å®šä¹‰å˜é‡, è·Ÿå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€æ ·ï¼Œç±»å‹åœ¨åé¢ã€‚\n    var c, python, java bool\n    // å¤šä¸ªç›¸åŒç±»å‹çš„å˜é‡å¯ä»¥å†™åœ¨ä¸€è¡Œã€‚\n    var f float32 = 1.6\n    var i, j int = 1, 2\n    // å˜é‡å®šä¹‰å¯ä»¥åŒ…å«åˆå§‹å€¼ï¼Œæ¯ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ªã€‚\n    var s = \"abc\"\n    // å¦‚æœåˆå§‹åŒ–æ˜¯ä½¿ç”¨è¡¨è¾¾å¼ï¼Œåˆ™å¯ä»¥çœç•¥ç±»å‹ï¼›å˜é‡ä»åˆå§‹å€¼ä¸­è·å¾—ç±»å‹ã€‚\n```\n\nå˜é‡åœ¨å®šä¹‰æ—¶æ²¡æœ‰æ˜ç¡®çš„åˆå§‹åŒ–æ—¶ä¼šèµ‹å€¼ä¸º*é›¶å€¼* ã€‚\n\né›¶å€¼æ˜¯ï¼š\n\n* æ•°å€¼ç±»å‹ä¸º 0 ï¼Œ\n* å¸ƒå°”ç±»å‹ä¸º false ï¼Œ\n* å­—ç¬¦ä¸²ä¸º \"\" ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ã€‚\n\nåœ¨å‡½æ•°å†…éƒ¨,å¯ç”¨æ›´ç®€ç•¥çš„ \":=\"  å¼å®šä¹‰å˜é‡ã€‚\n\n```go\n    func main() {\n        n, s := 12, \"Hello, World!\"\n        println(s, n)\n    }\n```\n\n> å‡½æ•°å¤–çš„æ¯ä¸ªè¯­å¥éƒ½å¿…é¡»ä»¥å…³é”®å­—å¼€å§‹ï¼ˆ var ã€ func ã€ç­‰ç­‰ï¼‰ï¼Œ := ç»“æ„ä¸èƒ½ä½¿ç”¨åœ¨å‡½æ•°å¤–ã€‚\n\nå¯ä¸€æ¬¡å®šä¹‰å¤šä¸ªå˜é‡ã€‚\n\n```go\n    var x, y, z int\n    var s, n = \"abc\", 123\n    var (\n    \ta int\n    \tb float32\n    )\n\n    func main() {\n        n, s := 0x1234, \"Hello, World!\"\n        println(x, s, n)\n    }\n```\n\nä¸€ä¸ªç‰¹æ®Šçš„å˜é‡åæ˜¯ \\_(ä¸‹åˆ’çº¿)ã€‚ä»»ä½•èµ‹ç»™å®ƒçš„å€¼éƒ½è¢«ä¸¢å¼ƒã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­,å°† 35 èµ‹å€¼ç»™ b,åŒæ—¶ä¸¢å¼ƒ 34ã€‚\n\n```go\n    _, b := 34, 35\n```\n\nGo çš„ç¼–è¯‘å™¨ä¼šå¯¹å£°æ˜å´æœªä½¿ç”¨çš„å˜é‡æŠ¥é”™\n\n```go\n    var s string // å…¨å±€å˜é‡æ²¡é—®é¢˜ã€‚\n\n    func main() {\n        i := 0 // Error: i declared and not usedã€‚(å¯ä½¿  \"_ = i\" è§„é¿)\n    }\n```\n\nå®šä¹‰å®Œä¹‹åçš„å˜é‡å¯ä»¥è¢«é‡æ–°èµ‹å€¼ æ¯”å¦‚ç¬¬8è¡Œï¼Œå°†è®¡ç®—ç»“æœèµ‹å€¼ç»™resultã€‚\n\n### å¸¸é‡\n\n> å¸¸é‡å€¼å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¯ç¡®å®šçš„æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€‚\n\nå¸¸é‡çš„å®šä¹‰ä¸å˜é‡ç±»ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨ const å…³é”®å­—\n\n```go\n    const x, y int = 1, 2\n    const s = \"Hello, World!\"\n    // å¤šå¸¸é‡åˆå§‹åŒ– // ç±»å‹æ¨æ–­\n    // å¸¸é‡ç»„\n    const (\n    \ta, b = 10, 100\n    \tc bool = false\n    )\n\n    func main() _{\n    \tconst x = 'xxx'      // æœªä½¿ç”¨å±€éƒ¨å¸¸é‡ä¸ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯\n    }\n```\n\nåœ¨å¸¸é‡ä¸­ï¼Œå¦‚æœä¸æä¾›ç±»å‹å’Œåˆå§‹åŒ–å€¼ï¼Œé‚£ä¹ˆè¢«çœ‹ä½œå’Œä¸Šä¸€å¸¸é‡ç›¸åŒ\n\n```go\n    const (\n\t\ts = \"abc\"\n\t\tx           // x = \"abc\"\n\t)\n```\n\n#### å˜é‡å€¼çš„å¼•ç”¨\n\né€šå¸¸æƒ…å†µä¸‹ go è¯­è¨€çš„`å˜é‡æŒæœ‰ç›¸åº”çš„å€¼`ã€‚\nå¯¹äº`é€šé“`ã€`å‡½æ•°`ã€`æ–¹æ³•`ã€`æ˜ å°„`ä»¥åŠ`åˆ‡ç‰‡`çš„å¼•ç”¨å˜é‡ï¼Œå®ƒä»¬æŒæœ‰çš„éƒ½æ˜¯`å¼•ç”¨`ï¼Œä¹Ÿæ—¢æ˜¯`ä¿å­˜æŒ‡é’ˆçš„å˜é‡`ã€‚\n\n**å€¼åœ¨ä¼ é€’ç»™å‡½æ•°æˆ–è€…æ–¹æ³•çš„æ—¶å€™ä¼šè¢«å¤åˆ¶ä¸€æ¬¡**\n\nä¸åŒç±»å‹å‚æ•°æ‰€å ç©ºé—´å¦‚ä¸‹ï¼š\n\n|ç±»å‹        | å ç”¨ç©ºé—´   | \n|:-------   |:-----  |\n|bool       |ç±»å‹å 1~8ä¸ªå­—èŠ‚\n|ä¼ é€’å­—ç¬¦ä¸²   |å  16ä¸ªå­—èŠ‚ï¼ˆ64ä½ï¼‰æˆ–è€…8ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰\n|ä¼ é€’åˆ‡ç‰‡     |å  16ä¸ªå­—èŠ‚ï¼ˆ64ä½ï¼‰æˆ–è€…12ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰\n|ä¼ é€’æŒ‡é’ˆ     |å  8ä¸ªå­—èŠ‚ï¼ˆ64ä½ï¼‰æˆ–è€…4ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰\n\n> `æ•°ç»„`æ˜¯æŒ‰å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥ä¼ é€’å¤§æ•°ç»„ä»£ä»·è¾ƒå¤§ å¯ç”¨åˆ‡ç‰‡ä»£æ›¿\n\n`å˜é‡æ˜¯èµ‹ç»™å†…å­˜å—çš„åå­—ï¼Œè¯¥å†…å­˜å—ç”¨äºä¿å­˜ç‰¹å®šçš„æ•°æ®ç±»å‹`ã€‚\n\n`æŒ‡é’ˆæ˜¯æŒ‡ä¿å­˜äº†å¦ä¸€ä¸ªå˜é‡å†…å­˜åœ°å€çš„å˜é‡`ã€‚åˆ›å»ºçš„æŒ‡é’ˆç”¨æ¥æŒ‡å‘å¦ä¸€ä¸ªæŸç§ç±»å‹çš„å˜é‡ã€‚\nä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬çœ‹ä»¥ä¸‹ä¸¤æ®µä»£ç ã€‚\n\n```go\nx := 3    y := 22\n// å˜é‡ x, y ä¸ºintå‹ åˆ†åˆ«èµ‹å€¼ 3   22  å†…å­˜åœ°å€ 0xf840000148   0xf840000150\nx == 3  &&  y == 22\n```\n\n```go\npi := &x\n\n// å˜é‡pi ä¸º *int(æŒ‡å‘intå‹å˜é‡çš„æŒ‡é’ˆ)   åœ¨è¿™é‡Œæˆ‘ä»¬å°†å˜é‡xçš„å†…å­˜åœ°å€èµ‹å€¼ç»™piï¼Œå³pi ä¿å­˜äº†å¦ä¸€ä¸ªå˜é‡çš„å†…å­˜åœ°å€ï¼ˆè¿™ä¹Ÿæ˜¯æŒ‡é’ˆå®šä¹‰ï¼‰\n\npi == 3 && x == 3 && y == 22  \nx++\n\n// x + 1 æ­¤æ—¶ x==4 pi æŒ‡å‘xçš„å†…å­˜åœ°å€ æ‰€ä»¥\n\npi == 4 && x == 4 && y == 22\n\n*pi++\n\n// *pi ++ æ„ä¸ºç€piæŒ‡å‘çš„å€¼å¢åŠ \n*pi == 5 & x == 5 && y == 22\n\npi := &y\n\n//pi æŒ‡å‘yçš„å†…å­˜åœ°å€\n*pi == 22 && x == 5 && y == 22\n\n*pi++\n\n// *pi++ æ„ä¸ºç€piæŒ‡å‘çš„å€¼å¢åŠ \n\n*pi == 23 && x == 5 && y == 23\n```\n\n### åŸºæœ¬ç±»å‹\n\nGo æœ‰æ˜ç¡®çš„æ•°å­—ç±»å‹å‘½å, æ”¯æŒ Unicode, æ”¯æŒå¸¸ç”¨æ•°æ®ç»“æ„\n\n|ç±»å‹          | é•¿åº¦   | é»˜è®¤å€¼| è¯´æ˜|\n|:-------      |:-----  | :---- | :----   |\n|bool          | 1      | false |\n|byte          | 1      | 0     | unit8\n|rune          | 4      | 0     | int32 çš„åˆ«å ä»£è¡¨ä¸€ä¸ªUnicode ç \n|int, unit     | 4 æˆ– 8 | 0     | 32 æˆ– 64\n|int8, unit8   | 1      | 0     | -128 ~ 127, 0~255\n|int16, unit16 | 2      | 0     | -32768 ~ 32767, 0 ~ 65535\n|int32, unit32 | 4      | 0     | -21äº¿~ 21äº¿, 0 ~ 42äº¿\n|int64, unit64 | 8      | 0     |\n|float32       | 4      | 0.0   |\n|float64       | 8      | 0.0   |\n|complex64     | 8      |       |\n|complex128    | 16     |       |\n|unitptr       | 4æˆ–8   |       | è¶³ä»¥å­˜å‚¨æŒ‡é’ˆçš„unit32 æˆ–unit64 æ•´æ•°\n|array         |        |       | å€¼ç±»å‹\n|struct        |        |       | å€¼ç±»å‹\n|string        |        | \"\"    | UTF-8 å­—ç¬¦ä¸²\n|slice         |        | nil   | å¼•ç”¨ç±»å‹\n|map           |        | nil   | å¼•ç”¨ç±»å‹\n|channel       |        | nil   | å¼•ç”¨ç±»å‹\n|interface     |        | nil   | æ¥å£\n|function      |        | nil   | å‡½æ•°\n\n> `int`ï¼Œ`uint` å’Œ `uintptr` ç±»å‹åœ¨32ä½çš„ç³»ç»Ÿä¸Šä¸€èˆ¬æ˜¯32ä½ï¼Œè€Œåœ¨64ä½ç³»ç»Ÿä¸Šæ˜¯64ä½ã€‚å½“ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ•´æ•°ç±»å‹æ—¶ï¼Œä½ åº”è¯¥é¦–é€‰ `int`ï¼Œä»…å½“æœ‰ç‰¹åˆ«çš„ç†ç”±æ‰ä½¿ç”¨å®šé•¿æ•´æ•°ç±»å‹æˆ–è€…æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚\n> å¼•ç”¨ç±»å‹åŒ…æ‹¬ `slice`ã€`map` å’Œ `channel`ã€‚å®ƒä»¬æœ‰å¤æ‚çš„å†…éƒ¨ç»“æ„,é™¤äº†ç”³è¯·å†…å­˜å¤–,è¿˜éœ€è¦åˆå§‹åŒ–ç›¸å…³å±æ€§\n\n### ç±»å‹è½¬æ¢\n\n**go `ä¸æ”¯æŒ` éšå¼çš„ç±»å‹è½¬æ¢**\n\n> ä½¿ç”¨è¡¨è¾¾å¼ T(v) å°†å€¼ v è½¬æ¢ä¸ºç±»å‹ T ã€‚\n\n```go\nvar b byte = 100\n// var n int = b // Error: cannot use b (type byte) as type int in assignment\nvar n int = int(b) // æ˜¾å¼è½¬æ¢\n\n```\n\n**ä¸èƒ½å°†å…¶ä»–ç±»å‹å½“ bool å€¼ä½¿ç”¨**\n\n```go\na := 100\nif a {                  // Error: non-bool a (type int) used as if condition\n    println(\"true\")\n}\n```\n\n### å‡½æ•°\n\né¦–å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç \n\n```go\n    package main\n\n    import \"fmt\"\n\n    func add(x int, y int) int {\n    \treturn x + y\n    }\n\n    func main() {\n    \tfmt.Println(add(42, 13))\n    }\n```\n\n#### å‡½æ•°å®šä¹‰\n\n> ä½¿ç”¨å…³é”®å­— func å®šä¹‰å‡½æ•°,å·¦å¤§æ‹¬å·ä¸èƒ½å¦èµ·ä¸€è¡Œ\n\ngolangä¸­ç¬¦åˆè§„èŒƒçš„å‡½æ•°ä¸€èˆ¬å†™æˆå¦‚ä¸‹çš„å½¢å¼ï¼š\n\n```go\n    func functionName(parameter_list) (return_value_list) {\n       â€¦\n    }\n\n    // parameter_list æ˜¯å‚æ•°åˆ—è¡¨\n    // return_value_list æ˜¯è¿”å›å€¼åˆ—è¡¨ ä¸‹è¾¹æœ‰è¯¦ç»†çš„è®²è§£\n```\n\n#### å‡½æ•°çš„ç‰¹æ€§\n\n* æ— éœ€å£°æ˜åŸå‹ã€‚ (1)\n* æ”¯æŒä¸å®šé•¿å˜å‚ã€‚\n* æ”¯æŒå¤šè¿”å›å€¼ã€‚\n* æ”¯æŒå‘½åè¿”å›å‚æ•°ã€‚\n* æ”¯æŒåŒ¿åå‡½æ•°å’Œé—­åŒ…ã€‚\n* ä¸æ”¯æŒ åµŒå¥— (nested)ã€é‡è½½ (overload) å’Œ é»˜è®¤å‚æ•° (default parameter)\n\n```go\n    func test(x int, y int, s string) (r int, s string) { // ç±»å‹ç›¸åŒçš„ç›¸é‚»å‚æ•°å¯åˆå¹¶\n        n := x + y                                    // å¤šè¿”å›å€¼å¿…é¡»ç”¨æ‹¬å·ã€‚\n        return n, fmt.Sprintf(s, n)\n    }\n```\n\n> å…³é”®å­— `func` ç”¨äºå®šä¹‰ä¸€ä¸ªå‡½æ•°\n> `test` æ˜¯ä½ å‡½æ•°çš„åå­—\n> int ç±»å‹çš„å˜é‡ x, y å’Œ string ç±»å‹çš„å˜é‡ s ä½œä¸º`è¾“å…¥å‚æ•°`å‚æ•°ç”¨`pass-by-value`æ–¹å¼ä¼ é€’,æ„å‘³ç€å®ƒä»¬ä¼šè¢«å¤åˆ¶\n> å½“`ä¸¤ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„å‡½æ•°å‘½åå‚æ•°æ˜¯åŒä¸€ç±»å‹`ï¼Œåˆ™é™¤äº†æœ€åä¸€ä¸ªç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–éƒ½å¯ä»¥çœç•¥ã€‚\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š\n```go\nx int, y int\n```\nè¢«ç¼©å†™ä¸º\n```go\nx, y int\n```\n\n`å˜é‡` r å’Œ s æ˜¯è¿™ä¸ªå‡½æ•°çš„`å‘½åè¿”å›å€¼`ã€‚åœ¨ Go çš„å‡½æ•°ä¸­å¯ä»¥è¿”å›å¤šä¸ªå€¼ã€‚\nå¦‚æœä¸æƒ³å¯¹è¿”å›çš„å‚æ•°å‘½å,åªéœ€è¦æä¾›ç±»å‹:(int, string)ã€‚ å¦‚æœ`åªæœ‰ä¸€ä¸ªè¿”å›å€¼`ï¼Œå¯ä»¥çœç•¥åœ†æ‹¬å·ã€‚å¦‚æœå‡½æ•°æ˜¯ä¸€ä¸ªå­è¿‡ç¨‹,å¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿”å›å€¼,ä¹Ÿå¯ä»¥çœç•¥è¿™äº›å†…å®¹ã€‚\nå‡½æ•°ä½“ã€‚æ³¨æ„ return æ˜¯ä¸€ä¸ªè¯­å¥,æ‰€ä»¥åŒ…è£¹å‚æ•°çš„æ‹¬å·æ˜¯å¯é€‰çš„ã€‚\nä¸å®šé•¿å‚æ•°å…¶å®å°±æ˜¯sliceï¼Œåªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸”å¿…é¡»æ˜¯æœ€åä¸€ä¸ªã€‚\n\n```go\n    func test(s string, n ...int) string {\n        var x int\n    \t\tfor _, i := range n {\n    \t\t\t x += i\n    \t\t}\n    \treturn fmt.Sprintf(s, x)\n    }\n    // ä½¿ç”¨slice åšå˜å‚æ—¶ï¼Œå¿…é¡»å±•å¼€\n    func main() {\n        s := []int{1, 2, 3}\n        println(test(\"sum: %d\", s...))\n    }\n```\n\n> å‡½æ•°æ˜¯ç¬¬ä¸€ç±»å¯¹è±¡,å¯ä½œä¸ºå‚æ•°ä¼ é€’\n\nå°±åƒå…¶ä»–åœ¨ Go ä¸­çš„å…¶ä»–ä¸œè¥¿ä¸€æ ·,å‡½æ•°ä¹Ÿæ˜¯å€¼è€Œå·²ã€‚å®ƒä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·èµ‹å€¼ç»™å˜é‡:\n\n```go\n    func main() {\n        a := func() {                  // å®šä¹‰ä¸€ä¸ªåŒ¿åå‡½æ•°,å¹¶ä¸”èµ‹å€¼ç»™ a\n    \t\tprintln(\"Hello\")\n    \t}                              // è¿™é‡Œæ²¡æœ‰ ()\n        a()                            // è°ƒç”¨å‡½æ•°\n    }\n```\n\nå¦‚æœä½¿ç”¨ fmt.Printf(\"\\%T\\n\", a) æ‰“å° a çš„ç±»å‹,è¾“å‡ºç»“æœæ˜¯ func()\n\n#### è¿”å›å€¼\n\nå‡½æ•°å¯ä»¥è¿”å›ä»»æ„æ•°é‡è¿”å›å€¼\n\nGo å‡½æ•°çš„è¿”å›å€¼æˆ–è€…ç»“æœå‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªåå­—,å¹¶ä¸”åƒåŸå§‹çš„å˜é‡é‚£æ ·ä½¿ç”¨,å°±åƒ è¾“å…¥å‚æ•°é‚£æ ·ã€‚å¦‚æœå¯¹å…¶å‘½å,åœ¨å‡½æ•°å¼€å§‹æ—¶,å®ƒä»¬ä¼šç”¨å…¶ç±»å‹çš„é›¶å€¼åˆå§‹åŒ–\n\n```go\n    package main\n\n    import \"fmt\"\n\n    func swap(x, y string) (string, string) {\n    \treturn y, x\n    }\n\n    func main() {\n    \ta, b := swap(\"hello\", \"world\")\n    \tfmt.Println(a, b)\n    }\n\n    /*\n       å‡½æ•°å¯ä»¥è¿”å›ä»»æ„æ•°é‡è¿”å›å€¼\n       swap å‡½æ•°è¿”å›äº†ä¸¤ä¸ªå­—ç¬¦ä¸²\n    */\n\n```\n\nGo çš„è¿”å›å€¼å¯ä»¥è¢«å‘½åï¼Œå¹¶ä¸”å°±åƒåœ¨å‡½æ•°ä½“å¼€å¤´å£°æ˜çš„å˜é‡é‚£æ ·ä½¿ç”¨ã€‚\n\n```go\n    package main\n\n    import \"fmt\"\n\n    func split(sum int) (x, y int) { // åˆå§‹åŒ–è¿”å›å€¼ä¸º x,y\n    \tx = sum * 4 / 9              // x,y å·²ç»åˆå§‹åŒ–ï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼ä½¿ç”¨\n    \ty = sum - x\n    \treturn                       // éšå¼è¿”å›x,y(è£¸è¿”å›)\n    }\n\n    func main() {\n    \tfmt.Println(split(17))\n    }\n\n    /*\n       åœ¨é•¿çš„å‡½æ•°ä¸­è¿™æ ·çš„è£¸è¿”å›ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§ã€‚\n    */\n```\n\n> æœ‰è¿”å›å€¼çš„å‡½æ•°,å¿…é¡»æœ‰æ˜ç¡®çš„return è¯­å¥,å¦åˆ™ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯\n\n### åè¯è§£é‡Š\n\nå‡½æ•°åŸå‹\n\n> `å‡½æ•°å£°æ˜`ç”±å‡½æ•°è¿”å›ç±»å‹ã€å‡½æ•°åå’Œå½¢å‚åˆ—è¡¨ç»„æˆã€‚å½¢å‚åˆ—è¡¨å¿…é¡»åŒ…æ‹¬å½¢å‚ç±»å‹,ä½†æ˜¯ä¸å¿…å¯¹å½¢å‚å‘½åã€‚è¿™ä¸‰ä¸ªå…ƒç´ è¢«ç§°ä¸ºå‡½æ•°åŸå‹,å‡½æ•°åŸå‹æè¿°äº†å‡½æ•°çš„æ¥å£\n`å‡½æ•°åŸå‹`ç±»ä¼¼å‡½æ•°å®šä¹‰æ—¶çš„å‡½æ•°å¤´ï¼Œåˆç§°å‡½æ•°å£°æ˜ã€‚ä¸ºäº†èƒ½ä½¿å‡½æ•°åœ¨å®šä¹‰ä¹‹å‰å°±èƒ½è¢«è°ƒç”¨ï¼ŒC++è§„å®šå¯ä»¥å…ˆè¯´æ˜å‡½æ•°åŸå‹ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨å‡½æ•°ã€‚å‡½æ•°å®šä¹‰å¯æ”¾åœ¨ç¨‹åºåé¢ã€‚ ç”±äºå‡½æ•°åŸå‹æ˜¯ä¸€æ¡è¯­å¥ï¼Œå› æ­¤å‡½æ•°åŸå‹å¿…é¡»ä»¥åˆ†å·ç»“æŸã€‚å‡½æ•°åŸå‹ç”±å‡½æ•°è¿”å›ç±»å‹ã€å‡½æ•°åå’Œå‚æ•°è¡¨ç»„æˆï¼Œå®ƒä¸å‡½æ•°å®šä¹‰çš„è¿”å›ç±»å‹ã€å‡½æ•°åå’Œå‚æ•°è¡¨å¿…é¡»ä¸€è‡´ã€‚å‡½æ•°åŸå‹å¿…é¡»åŒ…å«å‚æ•°çš„æ ‡è¯†ç¬¦ï¼ˆå¯¹å‡½æ•°å£°æ˜è€Œè¨€æ˜¯å¯é€‰çš„ï¼‰\næ³¨æ„ï¼š`å‡½æ•°åŸå‹ä¸å‡½æ•°å®šä¹‰`å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™ä¼šå¼•èµ·è¿æ¥é”™è¯¯ã€‚\n\n## ä¸‹èŠ‚é¢„å‘Š\n\nå˜é‡å’Œå‡½æ•°éƒ¨åˆ†æš‚æ—¶è¿™äº›ï¼Œæœ‰æ›´æ–°è¿˜ä¼šè¡¥å……ã€‚ä¸‹ä¸€ç¯‡å°†ä¼šæ˜¯æ§åˆ¶æµã€‚\nå°†ä¼šç”¨åˆ°çš„ä»£ç ä¸º:\n\n```go\n    package main\n\n    import \"fmt\"\n\n    func main() {\n        result := 0\n        for i := 0; i <= 10; i++ {\n          result = fibonacci(i)\n          fmt.Printf(\"fibonacci(%d) is: %d\\n\", i, result)\n       }\n    }\n\n    func fibonacci(n int) (res int) {\n        if n <= 1 {\n            res = 1\n    \t   } else {\n    \t       res = fibonacci(n-1) + fibonacci(n-2)\n    \t   }\n    \treturn\n    }\n```\n\n## å‚è€ƒé“¾æ¥\n\n* [Go æŒ‡å—](https://tour.go-zh.org/basics/4)\n* [The way to go -- å˜é‡](https://github.com/Unknwon/the-way-to-go_ZH_CN/blob/master/eBook/04.4.md)\n* [Effective Go](https://golang.org/doc/effective_go.html)\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Golang å­¦ä¹ ç¬”è®°-1ï¼šå˜é‡&å‡½æ•°",
        "date": "2018-02-22 12:45:22",
        "tags": [
          "golang",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "golang-learning-note-1"
    },
    {
      "content": "\n\n> `åœºæ™¯ï¼š`ç°åœ¨éœ€è¦å¼€å‘ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„åº”ç”¨ï¼Œåç«¯é‡‡ç”¨ RESTful API æœ€ä¸ºæ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªåç«¯æœåŠ¡ä¼šåœ¨ä¸€å¤©ä¸­çš„æŸäº›æ—¶å€™æœ‰é«˜å¹¶å‘çš„æƒ…å†µï¼Œä½¿ç”¨ä»€ä¹ˆæ ·çš„æ¶æ„æœ€ä¸ºç®€å•å‘¢ï¼Ÿ\n\n\nåˆšæ€è€ƒè¿™ä¸ªé—®é¢˜çš„æ—¶å€™æˆ‘æƒ³åˆ°çš„è§£å†³æ–¹æ¡ˆå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n* ä½¿ç”¨CDNå†…å®¹åˆ†å‘ç½‘ç»œï¼Œå‡å°‘ä¸»æœåŠ¡å™¨çš„å‹åŠ›\n\n* ä½¿ç”¨LVSæœåŠ¡å™¨è´Ÿè½½å‡è¡¡\n\n* ä½¿ç”¨ç¼“å­˜\n\n* ç¡¬ä»¶å±‚ æé«˜å¸¦å®½ï¼Œä½¿ç”¨SSD ç¡¬ç›˜ï¼Œä½¿ç”¨æ›´å¥½çš„æœåŠ¡å™¨\n\n* ä»£ç å±‚ï¼Œä¼˜åŒ–ä»£ç ï¼ˆä½¿ç”¨æ€§èƒ½æ›´å¥½çš„è¯­è¨€ç­‰\n\n  â€‹\n\nä½†ä»¥ä¸Šçš„å‡ ä¸ªæ–¹æ³•éƒ½éœ€è¦å…³æ³¨æœåŠ¡å™¨çš„å­˜å‚¨å’Œè®¡ç®—èµ„æºï¼Œä»¥ä¾¿éšæ—¶è°ƒæ•´ä»¥æ»¡è¶³æ›´é«˜çš„æ€§èƒ½ï¼Œå¹¶ä¸”é«˜å¹¶å‘çš„è¯·æ±‚ä¹Ÿæ˜¯åˆ†æ—¶æ®µçš„ï¼Œé…ç½®äº†æ›´é«˜æ€§èƒ½çš„æœåŠ¡å™¨åœ¨è®¿é—®é‡å˜ä½çš„æ—¶å€™ä¹Ÿæ˜¯èµ„æºæµªè´¹ã€‚\n\n\n\nè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ FaaSï¼ˆFunctions as a Serviceï¼‰ æ¶æ„ï¼Œè·Ÿä¼ ç»Ÿæ¶æ„ä¸åŒåœ¨äºï¼Œä»–ä»¬è¿è¡Œäºæ— çŠ¶æ€çš„å®¹å™¨ä¸­ï¼Œå¯ä»¥ç”±äº‹ä»¶è§¦å‘ï¼ŒçŸ­æš‚çš„ï¼Œå®Œå…¨è¢«ç¬¬ä¸‰æ–¹ç®¡ç†ï¼ŒåŠŸèƒ½ä¸ŠFaaSå°±æ˜¯ä¸éœ€è¦å…³å¿ƒåå°æœåŠ¡å™¨æˆ–è€…åº”ç”¨æœåŠ¡ï¼Œåªéœ€å…³å¿ƒè‡ªå·±çš„ä»£ç å³å¯ã€‚å…¶ä¸­AWS Lambdaæ˜¯ç›®å‰æœ€ä½³çš„FaaSå®ç°ä¹‹ä¸€ã€‚\n\n\n\n## AWS Lambda\n\nAWS Lambda æ˜¯ä¸€é¡¹è®¡ç®—æœåŠ¡ï¼Œä½¿ç”¨æ—¶æ— éœ€é¢„é…ç½®æˆ–ç®¡ç†æœåŠ¡å™¨å³å¯è¿è¡Œä»£ç ã€‚AWS Lambda åªåœ¨éœ€è¦æ—¶æ‰§è¡Œä»£ç å¹¶è‡ªåŠ¨ç¼©æ”¾ã€‚å€ŸåŠ© AWS Lambdaï¼Œå‡ ä¹å¯ä»¥ä¸ºä»»ä½•ç±»å‹çš„åº”ç”¨ç¨‹åºæˆ–åç«¯æœåŠ¡è¿è¡Œä»£ç ï¼Œè€Œä¸”æ— éœ€æ‰§è¡Œä»»ä½•ç®¡ç†ã€‚ç°åœ¨ AWS Lambda æ”¯æŒ Node.jsã€Javaã€C# å’Œ Pythonã€‚\n\n\n\n### ä½¿ç”¨åœºæ™¯\n\n\n\nLambda å¸¸è§çš„åº”ç”¨åœºæ™¯æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n* å°†Lambda ä½œä¸ºäº‹ä»¶æºç”¨äº AWS æœåŠ¡ï¼ˆæ¯”å¦‚éŸ³é¢‘ä¸Šä¼ åˆ° s3åï¼Œè§¦å‘ Lambda éŸ³é¢‘è½¬ç æœåŠ¡ï¼Œè½¬ç éŸ³é¢‘æ–‡ä»¶ \n* é€šè¿‡ HTTPS (Amazon API Gateway) å®ç°çš„æŒ‰éœ€ Lambda å‡½æ•°è°ƒç”¨ï¼ˆé…åˆ API Gatewayåˆ›å»ºç®€å•çš„å¾®æœåŠ¡\n* æŒ‰éœ€ Lambda å‡½æ•°è°ƒç”¨ï¼ˆä½¿ç”¨è‡ªå®šä¹‰åº”ç”¨ç¨‹åºæ„å»ºæ‚¨è‡ªå·±çš„äº‹ä»¶æºï¼‰\n* è®¡åˆ’çš„äº‹ä»¶ï¼ˆæ¯”å¦‚æ¯å¤©æ™šä¸Š12ç‚¹ç”ŸæˆæŠ¥è¡¨å‘é€åˆ°æŒ‡å®šé‚®ç®±\n\n\n\nä¸‹å›¾æ˜¯å°†Lambda ä½œä¸ºäº‹ä»¶æºç”¨äº AWS æœåŠ¡æ¡ˆä¾‹çš„ä¸€ä¸ªæ‰§è¡Œæµç¨‹å›¾ï¼š\n\n\n\n![](<http://media.gusibi.mobi/oXCMUsm_ZNoPkU5g5aa0OcXvvBo9_-TAB3xqUFlB4ktJlzakD_E9IA-3gQu85_QO>)\n\n\n\n1. ç”¨æˆ·å°†å¯¹è±¡ä¸Šä¼ åˆ° S3 å­˜å‚¨æ¡¶ï¼ˆå¯¹è±¡åˆ›å»ºäº‹ä»¶ï¼‰ã€‚\n2. Amazon S3 æ£€æµ‹åˆ°å¯¹è±¡åˆ›å»ºäº‹ä»¶ã€‚ \n3. Amazon S3 è°ƒç”¨åœ¨å­˜å‚¨æ¡¶é€šçŸ¥é…ç½®ä¸­æŒ‡å®šçš„ Lambda å‡½æ•°ã€‚ \n4. AWS Lambda é€šè¿‡ä»£å…¥æ‚¨åœ¨åˆ›å»º Lambda å‡½æ•°æ—¶æŒ‡å®šçš„æ‰§è¡Œè§’è‰²æ¥æ‰§è¡Œ Lambda å‡½æ•°ã€‚\n5. Lambda å‡½æ•°æ‰§è¡Œã€‚\n\n\n\nè¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç» å°† Lambda ä½œä¸ºäº‹ä»¶æºç”¨äº AWS æœåŠ¡ å’Œ é…åˆ API Gateway åˆ›å»ºç®€å•çš„å¾®æœåŠ¡ã€‚\n\n\n\n### å¦‚ä½•ä½¿ç”¨ Lambda\n\n\næ¥ä¸‹æ¥å°†ä½¿ç”¨ä¸€ä¸ªæ¡ˆä¾‹ä»‹ç»å¦‚ä½•ä½¿ç”¨ Lambdaã€‚\n\n\n\n#### å°† AWS Lambda ä¸ Amazon API Gateway ç»“åˆä½¿ç”¨ï¼ˆæŒ‰éœ€å¹¶é€šè¿‡ HTTPSï¼‰\n\n\n\n##### æ­¥éª¤ 1ï¼šè®¾ç½® AWS è´¦æˆ·å’Œ AWS CLI\n\n* [æ³¨å†Œ AWS è´¦æˆ·å¹¶åœ¨è¯¥è´¦æˆ·ä¸­åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/setting-up.html)\n* [è®¾ç½® AWS Command Line Interface (AWS CLI)](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/setup-awscli.html)\n\n##### æ­¥éª¤ 2ï¼šåˆ›å»º HelloWorld Lambda å‡½æ•°å’Œæ¢ç´¢æ§åˆ¶å°\n\n###### åˆ›å»º Hello World Lambda å‡½æ•°\n\n1. ç™»å½• AWS ç®¡ç†æ§åˆ¶å°å¹¶æ‰“å¼€ AWS Lambda æ§åˆ¶å°ã€‚\n2. é€‰æ‹© **Get Started Now**ã€‚ï¼ˆä»…å½“æœªåˆ›å»ºä»»ä½• Lambda å‡½æ•°æ—¶ï¼Œæ§åˆ¶å°æ‰æ˜¾ç¤º **Get Started Now** é¡µé¢ã€‚å¦‚æœæ‚¨å·²åˆ›å»ºå‡½æ•°ï¼Œåˆ™ä¼šçœ‹åˆ° **Lambda > Functions** é¡µé¢ã€‚åœ¨è¯¥åˆ—è¡¨é¡µé¢ä¸Šï¼Œé€‰æ‹© **Create a Lambda function** è½¬åˆ° **Lambda > New function** é¡µé¢ã€‚ä¸‹å›¾æ˜¯è¿™ç§æƒ…å†µ\n\n![](<http://media.gusibi.mobi/jgJKvz3ArQBbZqp5-F78j_2jmUThAsViZBWtLhIUcPigMyNrfP40RfLpYTsPzKyw>)\n\n\n\n3. è¿™é‡Œé€‰æ‹©ä»å¤´å¼€å§‹åˆ›ä½œï¼Œå¡«å†™å‡½æ•°åã€é€‰æ‹©è§’è‰²ï¼Œç‚¹å‡»åˆ›å»ºå‡½æ•°\n4. é…ç½®åˆ›å»ºå¥½çš„Lambdaå‡½æ•°\n\n![](<http://media.gusibi.mobi/uxR1UPvYab9pvHs3lCMGBeih8kHopl1pkm5zvDbSBSZCczcufvzaTHmh1lI7O_rU>)\n\n\n> éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¤„ç†ç¨‹åºå¡«å†™éƒ¨åˆ†ä¸º  ä»£ç æ–‡ä»¶å+æ–‡ä»¶ä¸­å‡½æ•°åï¼Œè¿™é‡Œæˆ‘ä»¬æ–‡ä»¶ålambda_functionï¼Œ å‡½æ•°åæ˜¯ lambda_handlerï¼Œå¤„ç†ç¨‹åºéƒ¨åˆ†å¡«å†™ä¸º lambda_function.lambda_handlerã€‚\n\n5. æ·»åŠ è§¦å‘å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©API Gateway ï¼Œåœ¨é…ç½®éƒ¨åˆ†é€‰æ‹©ä¹‹å‰é…ç½®å¥½çš„ APIï¼Œç‚¹å‡»æ·»åŠ ã€‚ç„¶åä¿å­˜å‡½æ•°\n\n![](<http://media.gusibi.mobi/qJ8heUNoZuUw_Qkt3uw1q2ZYFlzGAneB6AdBnyV7TKrQFTsCI79buo2WnhwGCcjH>)\n\n##### æµ‹è¯•AWS Lambda + Amazon API Gateway\n\nç™»å½• aws æ§åˆ¶å°ï¼Œæ‰“å¼€ API Gatewayï¼Œé€‰æ‹©æˆ‘ä»¬åˆšåˆšé€‰ç”¨çš„ APIï¼Œç‚¹å‡»æµ‹è¯•ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡º\n\n![](http://media.gusibi.mobi/S3dppxZIKbOf83UOPNEiEwKEvMw7n_Mng0Wk3PTrA8REa1lv-CPnRBg6BM8HkxMw)\n\n\nè¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒ å®˜æ–¹æ–‡æ¡£ï¼ˆhttps://docs.aws.amazon.com/zh_cn/lambda/latest/dg/getting-started.htmlï¼‰\n\né€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬äº†è§£äº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ª Lambda å‡½æ•°ï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•æ„å»º Lambda å‡½æ•°ã€‚\n\n\n\n### å¦‚ä½•æ„å»ºLambda\n\n#### åˆ›å»º Lambda å‡½æ•°\n\nåœ¨åˆ›å»º Lambda å‡½æ•°æ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ª*å¤„ç†ç¨‹åº*ï¼ˆæ­¤å¤„ç†ç¨‹åºæ˜¯ä»£ç ä¸­çš„å‡½æ•°ï¼‰ï¼ŒAWS Lambda å¯åœ¨æœåŠ¡æ‰§è¡Œä»£ç æ—¶è°ƒç”¨å®ƒã€‚åœ¨ Python ä¸­åˆ›å»ºå¤„ç†ç¨‹åºå‡½æ•°æ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹ä¸€èˆ¬è¯­æ³•ç»“æ„ã€‚\n\n\n```python\ndef handler_name(event, context): \n    ...\n    return some_value\n```\n\nåœ¨è¯¥è¯­æ³•ä¸­ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹æ–¹é¢ï¼š\n\n- `event` - AWS Lambda ä½¿ç”¨æ­¤å‚æ•°å°†äº‹ä»¶æ•°æ®ä¼ é€’åˆ°å¤„ç†ç¨‹åºã€‚æ­¤å‚æ•°é€šå¸¸æ˜¯ Python `dict` ç±»å‹ã€‚å®ƒä¹Ÿå¯ä»¥æ˜¯ `list`ã€`str`ã€`int`ã€`float` æˆ– `NoneType` ç±»å‹ã€‚ \n\n- `context` - AWS Lambda ä½¿ç”¨æ­¤å‚æ•°å‘å¤„ç†ç¨‹åºæä¾›è¿è¡Œæ—¶ä¿¡æ¯ã€‚æ­¤å‚æ•°ä¸º `LambdaContext` ç±»å‹ã€‚\n\n- ï¼ˆå¯é€‰ï¼‰å¤„ç†ç¨‹åºå¯è¿”å›å€¼ã€‚è¿”å›çš„å€¼æ‰€å‘ç”Ÿçš„çŠ¶å†µå–å†³äºè°ƒç”¨ Lambda å‡½æ•°æ—¶ä½¿ç”¨çš„è°ƒç”¨ç±»å‹ï¼š\n\n  - å¦‚æœä½¿ç”¨ `RequestResponse` è°ƒç”¨ç±»å‹ï¼ˆåŒæ­¥æ‰§è¡Œï¼‰ï¼ŒAWS Lambda ä¼šå°† Python å‡½æ•°è°ƒç”¨çš„ç»“æœè¿”å›åˆ°è°ƒç”¨ Lambda å‡½æ•°çš„å®¢æˆ·ç«¯ï¼ˆåœ¨å¯¹è°ƒç”¨è¯·æ±‚çš„ HTTP å“åº”ä¸­ï¼Œåºåˆ—åŒ–ä¸º JSONï¼‰ã€‚ä¾‹å¦‚ï¼ŒAWS Lambda æ§åˆ¶å°ä½¿ç”¨ `RequestResponse` è°ƒç”¨ç±»å‹ï¼Œå› æ­¤å½“æ‚¨ä½¿ç”¨æ§åˆ¶å°è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ§åˆ¶å°å°†æ˜¾ç¤ºè¿”å›çš„å€¼ã€‚\n\n    å¦‚æœå¤„ç†ç¨‹åºè¿”å› `NONE`ï¼ŒAWS Lambda å°†è¿”å› nullã€‚\n\n  - å¦‚æœä½¿ç”¨ `Event` è°ƒç”¨ç±»å‹ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰ï¼Œåˆ™ä¸¢å¼ƒè¯¥å€¼ã€‚ \n\n\n\n#### contextå¯¹è±¡\n\n\n\nåœ¨æ‰§è¡Œ Lambda å‡½æ•°æ—¶ï¼Œå®ƒå¯ä»¥ä¸ AWS Lambda æœåŠ¡è¿›è¡Œäº¤äº’ä»¥è·å–æœ‰ç”¨çš„è¿è¡Œæ—¶ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š\n\n- AWS Lambda ç»ˆæ­¢æ‚¨çš„ Lambda å‡½æ•°ä¹‹å‰çš„å‰©ä½™æ—¶é—´é‡ï¼ˆè¶…æ—¶æ˜¯ Lambda å‡½æ•°é…ç½®å±æ€§ä¹‹ä¸€ï¼‰ã€‚\n- ä¸æ­£åœ¨æ‰§è¡Œçš„ Lambda å‡½æ•°å…³è”çš„ CloudWatch æ—¥å¿—ç»„å’Œæ—¥å¿—æµã€‚\n- è¿”å›åˆ°è°ƒç”¨äº† Lambda å‡½æ•°çš„å®¢æˆ·ç«¯çš„ AWS è¯·æ±‚ IDã€‚å¯ä»¥ä½¿ç”¨æ­¤è¯·æ±‚ ID å‘ AWS Support è¿›è¡Œä»»ä½•è·Ÿè¿›æŸ¥è¯¢ã€‚ \n- å¦‚æœé€šè¿‡ AWS ç§»åŠ¨è½¯ä»¶å¼€å‘å·¥å…·åŒ…è°ƒç”¨ Lambda å‡½æ•°ï¼Œåˆ™å¯äº†è§£æœ‰å…³è°ƒç”¨ Lambda å‡½æ•°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºçš„æ›´å¤šä¿¡æ¯ã€‚\n\n\n\n##### Context å¯¹è±¡æ–¹æ³• (Python)\n\ncontext å¯¹è±¡æä¾›äº†ä»¥ä¸‹æ–¹æ³•ï¼š\n\n###### get_remaining_time_in_millis()\n\nè¿”å›åœ¨ AWS Lambda ç»ˆæ­¢å‡½æ•°å‰å‰©ä½™çš„æ‰§è¡Œæ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ \n\n\n##### Context å¯¹è±¡å±æ€§ (Python)\n\n\ncontext å¯¹è±¡æä¾›äº†ä»¥ä¸‹å±æ€§ï¼š\n\n###### function_name\n\næ­£åœ¨æ‰§è¡Œçš„ Lambda å‡½æ•°çš„åç§°ã€‚\n\n###### function_version\n\næ­£åœ¨æ‰§è¡Œçš„ Lambda å‡½æ•°ç‰ˆæœ¬ã€‚å¦‚æœåˆ«åç”¨äºè°ƒç”¨å‡½æ•°ï¼Œ`function_version` å°†ä¸ºåˆ«åæŒ‡å‘çš„ç‰ˆæœ¬ã€‚\n\n###### invoked_function_arn\n\nARN ç”¨äºè°ƒç”¨æ­¤å‡½æ•°ã€‚å®ƒå¯ä»¥æ˜¯å‡½æ•° ARN æˆ–åˆ«å ARNã€‚éé™å®šçš„ ARN æ‰§è¡Œ `$LATEST` ç‰ˆæœ¬ï¼Œåˆ«åæ‰§è¡Œå®ƒæŒ‡å‘çš„å‡½æ•°ç‰ˆæœ¬ã€‚ \n\n###### memory_limit_in_mb\n\nä¸º Lambda å‡½æ•°é…ç½®çš„å†…å­˜é™åˆ¶ï¼ˆä»¥ MB ä¸ºå•ä½ï¼‰ã€‚æ‚¨åœ¨åˆ›å»º Lambda å‡½æ•°æ—¶è®¾ç½®å†…å­˜é™åˆ¶ï¼Œå¹¶ä¸”éšåå¯æ›´æ”¹æ­¤é™åˆ¶ã€‚\n\n###### aws_request_id\n\nä¸è¯·æ±‚å…³è”çš„ AWS è¯·æ±‚ IDã€‚è¿™æ˜¯è¿”å›åˆ°è°ƒç”¨äº† `invoke` æ–¹æ³•çš„å®¢æˆ·ç«¯çš„ IDã€‚ æ³¨æ„å¦‚æœ AWS Lambda é‡è¯•è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¤„ç† Kinesis è®°å½•çš„ Lambda å‡½æ•°å¼•å‘å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼‰æ—¶ï¼Œè¯·æ±‚ ID ä¿æŒä¸å˜ã€‚\n\n###### log_group_name\n\nCloudWatch æ—¥å¿—ç»„çš„åç§°ï¼Œå¯ä»è¯¥æ—¥å¿—ç»„ä¸­æŸ¥æ‰¾ç”± Lambda å‡½æ•°å†™å…¥çš„æ—¥å¿—ã€‚\n\n###### log_stream_name\n\nCloudWatch æ—¥å¿—æµçš„åç§°ï¼Œå¯ä»è¯¥æ—¥å¿—æµä¸­æŸ¥æ‰¾ç”± Lambda å‡½æ•°å†™å…¥çš„æ—¥å¿—ã€‚æ¯æ¬¡è°ƒç”¨ Lambda å‡½æ•°æ—¶ï¼Œæ—¥å¿—æµå¯èƒ½ä¼šæ›´æ”¹ï¼Œä¹Ÿå¯èƒ½ä¸æ›´æ”¹ã€‚å¦‚æœ Lambda å‡½æ•°æ— æ³•åˆ›å»ºæ—¥å¿—æµï¼Œåˆ™è¯¥å€¼ä¸ºç©ºã€‚å½“å‘ Lambda å‡½æ•°æˆäºˆå¿…è¦æƒé™çš„æ‰§è¡Œè§’è‰²æœªåŒ…æ‹¬é’ˆå¯¹ CloudWatch Logs æ“ä½œçš„æƒé™æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚\n\n###### identity\n\né€šè¿‡ AWS ç§»åŠ¨è½¯ä»¶å¼€å‘å·¥å…·åŒ…è¿›è¡Œè°ƒç”¨æ—¶çš„ Amazon Cognito èº«ä»½æä¾›å•†çš„ç›¸å…³ä¿¡æ¯ã€‚å®ƒå¯ä»¥ä¸ºç©ºã€‚identity.cognito_identity_ididentity.cognito_identity_pool_id\n\n###### client_context\n\né€šè¿‡ AWS ç§»åŠ¨è½¯ä»¶å¼€å‘å·¥å…·åŒ…è¿›è¡Œè°ƒç”¨æ—¶çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œè®¾å¤‡çš„ç›¸å…³ä¿¡æ¯ã€‚å®ƒå¯ä»¥ä¸ºç©ºã€‚\n\n* client.installation_id\n* client.app_title\n* client.app_version_name\n* client.app_version_code\n* client.app_package_name\n* custom â€“ ç”±ç§»åŠ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè®¾ç½®çš„è‡ªå®šä¹‰å€¼çš„ dictã€‚\n* env â€“ ç”± AWS å¼€å‘å·¥å…·åŒ…æä¾›çš„ç¯å¢ƒä¿¡æ¯çš„ dictã€‚\n\n##### ç¤ºä¾‹\n\næŸ¥çœ‹ä»¥ä¸‹ Python ç¤ºä¾‹ã€‚å®ƒæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°ä¹Ÿæ˜¯å¤„ç†ç¨‹åºã€‚å¤„ç†ç¨‹åºé€šè¿‡ä½œä¸ºå‚æ•°ä¼ é€’çš„ `context` å¯¹è±¡æ¥æ”¶è¿è¡Œæ—¶ä¿¡æ¯ã€‚ \n\n```python\nfrom __future__ import print_function\n\nimport time\ndef get_my_log_stream(event, context):       \n    print(\"Log stream name:\", context.log_stream_name)\n    print(\"Log group name:\",  context.log_group_name)\n    print(\"Request ID:\",context.aws_request_id)\n    print(\"Mem. limits(MB):\", context.memory_limit_in_mb)\n    # Code will execute quickly, so we add a 1 second intentional delay so you can see that in time remaining value.\n    time.sleep(1) \n    print(\"Time remaining (MS):\", context.get_remaining_time_in_millis())\n```\n\n\n\næ­¤ç¤ºä¾‹ä¸­çš„å¤„ç†ç¨‹åºä»£ç åªæ‰“å°éƒ¨åˆ†è¿è¡Œæ—¶ä¿¡æ¯ã€‚æ¯ä¸ªæ‰“å°è¯­å¥å‡åœ¨ CloudWatch ä¸­åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ¡ç›®ã€‚å¦‚æœæ‚¨ä½¿ç”¨ Lambda æ§åˆ¶å°è°ƒç”¨å‡½æ•°ï¼Œåˆ™æ§åˆ¶å°ä¼šæ˜¾ç¤ºæ—¥å¿—ã€‚\n\n\n\n#### æ—¥å¿—è®°å½•\n\n\n\næ‚¨çš„ Lambda å‡½æ•°å¯åŒ…å«æ—¥å¿—è®°å½•è¯­å¥ã€‚AWS Lambda å°†è¿™äº›æ—¥å¿—å†™å…¥ CloudWatchã€‚å¦‚æœæ‚¨ä½¿ç”¨ Lambda æ§åˆ¶å°è°ƒç”¨ Lambda å‡½æ•°ï¼Œæ§åˆ¶å°å°†æ˜¾ç¤ºç›¸åŒçš„æ—¥å¿—ã€‚\n\nä»¥ä¸‹ Python è¯­å¥ç”Ÿæˆæ—¥å¿—æ¡ç›®ï¼š\n\n- `print` è¯­å¥ã€‚\n- `logging` æ¨¡å—ä¸­çš„ `Logger` å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œ`logging.Logger.info` å’Œ `logging.Logger.error`ï¼‰ã€‚\n\n`print` å’Œ `logging.*` å‡½æ•°å°†æ—¥å¿—å†™å…¥ CloudWatch Logs ä¸­ï¼Œè€Œ `logging.*` å‡½æ•°å°†é¢å¤–ä¿¡æ¯å†™å…¥æ¯ä¸ªæ—¥å¿—æ¡ç›®ä¸­ï¼Œä¾‹å¦‚æ—¶é—´æˆ³å’Œæ—¥å¿—çº§åˆ«ã€‚\n\n\n\n##### æŸ¥æ‰¾æ—¥å¿—\n\nå¯æŸ¥æ‰¾ Lambda å‡½æ•°å†™å…¥çš„æ—¥å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n- åœ¨ AWS Lambda æ§åˆ¶å°ä¸­ - AWS Lambda æ§åˆ¶å°ä¸­çš„ ** Log output**  éƒ¨åˆ†æ˜¾ç¤ºè¿™äº›æ—¥å¿—ã€‚ \n\n- åœ¨å“åº”æ ‡å¤´ä¸­ï¼Œå½“æ‚¨ä»¥ç¼–ç¨‹æ–¹å¼è°ƒç”¨ Lambda å‡½æ•°æ—¶ - å¦‚æœæ‚¨ä»¥ç¼–ç¨‹æ–¹å¼è°ƒç”¨ Lambda å‡½æ•°ï¼Œåˆ™å¯æ·»åŠ  `LogType`å‚æ•°ä»¥æ£€ç´¢å·²å†™å…¥ CloudWatch æ—¥å¿—çš„æœ€å 4 KB çš„æ—¥å¿—æ•°æ®ã€‚AWS Lambda åœ¨å“åº”çš„ `x-amz-log-results` æ ‡å¤´ä¸­è¿”å›è¯¥æ—¥å¿—ä¿¡æ¯ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[Invoke](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/API_Invoke.html)ã€‚\n\n  å¦‚æœæ‚¨ä½¿ç”¨ AWS CLI è°ƒç”¨è¯¥å‡½æ•°ï¼Œåˆ™å¯æŒ‡å®šå¸¦æœ‰å€¼ `Tail` çš„ ` --log-type parameter` æ¥æ£€ç´¢ç›¸åŒä¿¡æ¯ã€‚\n\n- åœ¨ CloudWatch æ—¥å¿—ä¸­ - è¦åœ¨ CloudWatch ä¸­æŸ¥æ‰¾æ‚¨çš„æ—¥å¿—ï¼Œæ‚¨éœ€è¦çŸ¥é“æ—¥å¿—ç»„åç§°å’Œæ—¥å¿—æµåç§°ã€‚å¯ä»¥ä½¿ç”¨ä»£ç ä¸­çš„ `context.logGroupName` å’Œ `context.logStreamName` å±æ€§æ¥è·å–æ­¤ä¿¡æ¯ã€‚åœ¨è¿è¡Œ Lambda å‡½æ•°æ—¶ï¼Œæ§åˆ¶å°æˆ– CLI ä¸­ç”Ÿæˆçš„æ—¥å¿—å°†ä¼šå‘æ‚¨æ˜¾ç¤ºæ—¥å¿—ç»„åç§°å’Œæ—¥å¿—æµåç§°ã€‚\n\n\n\n#### å‡½æ•°é”™è¯¯\n\nå¦‚æœ Lambda å‡½æ•°å¼•å‘å¼‚å¸¸ï¼ŒAWS Lambda ä¼šè¯†åˆ«å¤±è´¥ï¼Œå°†å¼‚å¸¸ä¿¡æ¯åºåˆ—åŒ–ä¸º JSON å¹¶å°†å…¶è¿”å›ã€‚è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼š\n\n```python\ndef always_failed_handler(event, context):\n    raise Exception('I failed!')\n```\n\nåœ¨è°ƒç”¨æ­¤ Lambda å‡½æ•°æ—¶ï¼Œå®ƒå°†å¼•å‘å¼‚å¸¸ï¼Œå¹¶ä¸” AWS Lambda è¿”å›ä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼š\n\n```json\n{\n  \"errorMessage\": \"I failed!\",\n  \"stackTrace\": [\n    [\n      \"/var/task/lambda_function.py\",\n      3,\n      \"my_always_fails_handler\",\n      \"raise Exception('I failed!')\"\n    ]\n  ],\n  \"errorType\": \"Exception\"\n}\n```\n\n\n\nè¯¦ç»†ä¿¡æ¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.aws.amazon.com/zh_cn/lambda/latest/dg/lambda-app.html\n\n\n\n### æ³¨æ„äº‹é¡¹\n\n\n\n#### AWS Lambda é™åˆ¶\n\nAWS Lambda åœ¨ä½¿ç”¨ä¸­ä¼šå¼ºåŠ ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚ï¼Œç¨‹åºåŒ…çš„å¤§å°æˆ– Lambda å‡½æ•°åœ¨æ¯æ¬¡è°ƒç”¨ä¸­åˆ†å¾—çš„å†…å­˜é‡ã€‚\n\n**æ¯ä¸ªè°ƒç”¨çš„ AWS Lambda èµ„æºé™åˆ¶**\n\n| èµ„æº                                       | é™åˆ¶                                       |\n| ---------------------------------------- | ---------------------------------------- |\n| å†…å­˜åˆ†é…èŒƒå›´                                   | æœ€å°å€¼ = 128 MB/æœ€å¤§å€¼ = 1536 MB (å¢é‡ä¸º 64 MB). å¦‚æœè¶…è¿‡æœ€å¤§å†…å­˜ä½¿ç”¨é‡ï¼Œåˆ™å‡½æ•°è°ƒç”¨å°†ä¼šç»ˆæ­¢ã€‚ |\n| ä¸´æ—¶ç£ç›˜å®¹é‡ï¼ˆâ€œ/tmpâ€ç©ºé—´ï¼‰                         | 512MB                                    |\n| æ–‡ä»¶æè¿°ç¬¦æ•°                                   | 1024                                     |\n| è¿‡ç¨‹å’Œçº¿ç¨‹æ•°ï¼ˆåˆå¹¶æ€»æ•°é‡ï¼‰                            | 1024                                     |\n| æ¯ä¸ªè¯·æ±‚çš„æœ€å¤§æ‰§è¡Œæ—¶é•¿                              | 300 ç§’                                    |\n| [Invoke](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/API_Invoke.html) è¯·æ±‚æ­£æ–‡æœ‰æ•ˆè´Ÿè½½å¤§å° (RequestResponse/åŒæ­¥è°ƒç”¨) | 6MB                                      |\n| [Invoke](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/API_Invoke.html) è¯·æ±‚æ­£æ–‡æœ‰æ•ˆè´Ÿè½½å¤§å° (Event/å¼‚æ­¥è°ƒç”¨) | 128 K                                    |\n\n**æ¯ä¸ªåŒºåŸŸçš„ AWS Lambda è´¦æˆ·é™åˆ¶**\n\n| èµ„æº    | é»˜è®¤é™åˆ¶ |\n| ----- | ---- |\n| å¹¶å‘æ‰§è¡Œæ•° | 1000 |\n\nå¹¶å‘æ‰§è¡Œæ˜¯æŒ‡åœ¨ä»»æ„æŒ‡å®šæ—¶é—´å¯¹æ‚¨çš„å‡½æ•°ä»£ç çš„æ‰§è¡Œæ•°é‡ã€‚æ‚¨å¯ä»¥ä¼°è®¡å¹¶å‘æ‰§è¡Œè®¡æ•°ï¼Œä½†æ˜¯ï¼Œæ ¹æ® Lambda å‡½æ•°æ˜¯å¦å¤„ç†æ¥è‡ªåŸºäºæµçš„äº‹ä»¶æºçš„äº‹ä»¶ï¼Œå¹¶å‘æ‰§è¡Œè®¡æ•°ä¼šæœ‰æ‰€ä¸åŒã€‚\n\n- **åŸºäºæµçš„äº‹ä»¶æº** - å¦‚æœæ‚¨åˆ›å»º Lambda å‡½æ•°å¤„ç†æ¥è‡ªåŸºäºæµçš„æœåŠ¡ï¼ˆAmazon Kinesis Data Streams æˆ– DynamoDB æµï¼‰çš„äº‹ä»¶ï¼Œåˆ™æ¯ä¸ªæµçš„åˆ†åŒºæ•°é‡æ˜¯å¹¶å‘åº¦å•å…ƒã€‚å¦‚æœæ‚¨çš„æµæœ‰ 100 ä¸ªæ´»åŠ¨åˆ†åŒºï¼Œåˆ™æœ€å¤šä¼šæœ‰ 100 ä¸ª Lambda å‡½æ•°è°ƒç”¨å¹¶å‘è¿è¡Œã€‚ç„¶åï¼Œæ¯ä¸ª Lambda å‡½æ•°æŒ‰ç…§åˆ†åŒºåˆ°è¾¾çš„é¡ºåºå¤„ç†äº‹ä»¶ã€‚\n\n- **å¹¶éåŸºäºæµçš„äº‹ä»¶æº** - å¦‚æœæ‚¨åˆ›å»º Lambda å‡½æ•°å¤„ç†æ¥è‡ªå¹¶éåŸºäºæµçš„äº‹ä»¶æºï¼ˆä¾‹å¦‚ï¼ŒAmazon S3 æˆ– API ç½‘å…³ï¼‰çš„äº‹ä»¶ï¼Œåˆ™æ¯ä¸ªå‘å¸ƒçš„äº‹ä»¶æ˜¯ä¸€ä¸ªå·¥ä½œå•å…ƒã€‚å› æ­¤ï¼Œè¿™äº›äº‹ä»¶æºå‘å¸ƒçš„äº‹ä»¶æ•°ï¼ˆæˆ–è¯·æ±‚æ•°ï¼‰å½±å“å¹¶å‘åº¦ã€‚\n\n  æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼æ¥ä¼°ç®—å¹¶å‘ Lambda å‡½æ•°è°ƒç”¨æ•°ã€‚\n\n  ```\n  events (or requests) per second * function duration\n  ```\n\n  ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªå¤„ç† API Gateway çš„ Lambda å‡½æ•°ã€‚å‡å®š Lambda å‡½æ•°å¹³å‡ç”¨æ—¶ 0.3 ç§’ï¼ŒAPI Gateway æ¯ç§’è¯·æ±‚ 1000 æ¬¡ã€‚å› æ­¤ï¼ŒLambda å‡½æ•°æœ‰ 300 ä¸ªå¹¶å‘æ‰§è¡Œã€‚\n\n  â€‹\n\nå…·ä½“ä¿¡æ¯å‚è€ƒ[Lambda å‡½æ•°å¹¶è¡Œæ‰§è¡Œ](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/concurrent-executions.html)\n\n\n\n**AWS Lambda éƒ¨ç½²é™åˆ¶ **\n\n| é¡¹ç›®                                       | é»˜è®¤é™åˆ¶  |\n| ---------------------------------------- | ----- |\n| Lambda å‡½æ•°éƒ¨ç½²ç¨‹åºåŒ…å¤§å° (å‹ç¼©çš„ .zip/.jar æ–‡ä»¶)      | 50 MB |\n| æ¯ä¸ªåŒºåŸŸå¯ä»¥ä¸Šä¼ çš„æ‰€æœ‰éƒ¨ç½²ç¨‹åºåŒ…çš„æ€»å¤§å°                     | 75GB  |\n| å¯å‹ç¼©åˆ°éƒ¨ç½²ç¨‹åºåŒ…ä¸­çš„ä»£ç /ä¾èµ–é¡¹çš„å¤§å° (æœªå‹ç¼©çš„ .zip/.jar å¤§å°).æ³¨æ„æ¯ä¸ª Lambda å‡½æ•°éƒ½ä¼šåœ¨å…¶çš„ `/tmp` ç›®å½•ä¸­æ¥æ”¶åˆ°é¢å¤–çš„ 500 MB çš„éæŒä¹…æ€§ç£ç›˜ç©ºé—´ã€‚è¯¥ `/tmp` ç›®å½•å¯ç”¨äºåœ¨å‡½æ•°åˆå§‹åŒ–æœŸé—´åŠ è½½é¢å¤–çš„èµ„æºï¼Œå¦‚ä¾èµ–å…³ç³»åº“æˆ–æ•°æ®é›†ã€‚ | 250MB |\n| ç¯å¢ƒå˜é‡é›†çš„æ€»å¤§å°                                | 4 KB  |\n\n\n\n> æœ¬æ–‡å†…å®¹ä¸»è¦å‚è€ƒ AWS Lambda å®˜æ–¹æ–‡æ¡£ï¼Œè¯¦ç»†ä¿¡æ¯è¯·è®¿é—® https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/welcome.html\n\n\n\n## å‚è€ƒé“¾æ¥\n\n\n\n[AWS Lambda å¼€å‘å…¥é—¨](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/getting-started.html)\n\n[åˆ›å»ºéƒ¨ç½²ç¨‹åºåŒ… (Python)](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/lambda-python-how-to-create-deployment-package.html)\n\n[Lambda å‡½æ•°å¹¶è¡Œæ‰§è¡Œ](https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/concurrent-executions.html)\n\n[é«˜å¹¶å‘è§£å†³æ–¹æ¡ˆ](http://blog.csdn.net/chichengit/article/details/49078525)\n\n[å¦‚ä½•ä¼˜åŒ–ç½‘ç«™é«˜å¹¶å‘è®¿é—®?](https://www.zhihu.com/question/22002547)\n\n[é«˜å¹¶å‘çš„è§£å†³æ–¹æ¡ˆ](https://www.jianshu.com/p/e6de7020d627)\n\n[Serverlesså¼€å‘ç¼–ç¨‹æ€æƒ³](https://zhuanlan.zhihu.com/p/28079865)\n\n[ä¸€ä¸ªç®€å•çš„ Serverless æ¶æ„ä¾‹å­](https://zhuanlan.zhihu.com/p/26761180)\n\n[ä½¿ç”¨lambdaå¸¦æ¥çš„æ¶æ„ä¼˜åŠ¿](https://zhuanlan.zhihu.com/p/20297696)\n\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "AWS-Lambda ä½¿ç”¨å…¥é—¨",
        "date": "2018-01-13 09:23:49",
        "tags": [
          "AWS",
          "Lambda",
          "serverless",
          "python"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-Lambda-Start"
    },
    {
      "content": "\n\n## å®¹å™¨\n\nPython å†…ç½®äº†ä¸°å¯Œçš„å®¹å™¨ç±»å‹ï¼šlistã€tupleã€setã€dictå’Œ collections ä¸­çš„namedtuple()ã€dequeã€ChainMapã€Counterã€OrderedDictã€defaultdictã€‚\ncollections ç›¸å…³çš„æ•°æ®ç»“æ„æš‚æ—¶å…ˆä¸ä»‹ç»ï¼Œè¿™ä¸€ç¯‡å…ˆä»‹ç» listã€tupleã€set å’Œ dictã€‚\n\n> `è§£é‡Šï¼š`å®¹å™¨ç±»å‹ç›¸å¯¹åº”çš„æ˜¯æ‰å¹³çš„æ•°æ®ç±»å‹ï¼Œå®¹å™¨å­˜æ”¾çš„æ˜¯å®ƒä»¬æ‰€åŒ…å«çš„ä»»æ„ç±»å‹çš„å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œæ‰å¹³çš„æ•°æ®ç»“æ„å­˜æ”¾çš„æ˜¯å€¼è€Œä¸æ˜¯å¼•ç”¨ã€‚\n> æ¢å¥è¯è¯´ï¼Œæ‰å¹³çš„æ•°æ®ç»“æ„å…¶å®æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå®ƒé‡Œè¾¹åªèƒ½å­˜æ”¾å­—ç¬¦ã€å­—èŠ‚å’Œæ•°å€¼è¿™ç§åŸºç¡€ç±»å‹ï¼Œå¹¶ä¸”åªèƒ½æ˜¯å…¶ä¸­çš„ä¸€ç§ã€‚\n> `å¯èƒ½è¶Šè§£é‡Šè¶Šä¸æ¸…æ¥šäº†`\n\n### listï¼ˆåˆ—è¡¨ï¼‰\n\n#### åˆå§‹åŒ–åˆ—è¡¨\n\n```python\nempty_list = []  # åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨\nnums = [1]  # åˆå§‹åŒ–åªæœ‰ä¸€ä¸ªå€¼çš„åˆ—è¡¨\nnumbers = [1, 2, 3, 4]  # åˆå§‹åŒ–ä¸€ä¸ªæœ‰å››ä¸ªæ•°å­—çš„åˆ—è¡¨\nstrings = ['a', 'b', 'c', 'd']  # åˆå§‹åŒ–ä¸€ä¸ªæœ‰å››ä¸ªå­—ç¬¦çš„åˆ—è¡¨\n```\nåˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ï¼š\n\n```python\nlist1 = ['1', 2, 'c', 'hello' ['world']] \n```\n\nåˆ—è¡¨ list1 ä¸­åŒ…å«äº†æ•°å­—ã€å­—ç¬¦ä¸²ä»¥åŠä¸€ä¸ªåˆ—è¡¨ã€‚\n\n#### è®¿é—®åˆ—è¡¨\n\nå¯ä»¥ä½¿ç”¨ len() æ–¹æ³•è·å– list å…ƒç´ çš„ä¸ªæ•°ã€‚\n\nåˆ—è¡¨ç”¨ç´¢å¼•æ¥è®¿é—® list ä¸­æ¯ä¸ªä½ç½®çš„å…ƒç´ ï¼Œç´¢å¼•ä»0å¼€å§‹\n\n```python\n>>> nums = [1, 2, 3, 4, 5]\n>>> nums[0]  # ç´¢å¼•ä»0å¼€å§‹\n1\n>>> nums[3]\n4\n>>> nums[5]\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIndexError: list index out of range\n```\nå½“ç´¢å¼•è¶…å‡ºäº†èŒƒå›´æ—¶ï¼ŒPythonä¼šæŠ¥ä¸€ä¸ªIndexErroré”™è¯¯ã€‚\n\nç´¢å¼•è¿˜å¯ä»¥æ˜¯è´Ÿå€¼ï¼Œæ¯”å¦‚\n\n```python\n>>> nums[-1]  # æœ€åä¸€ä¸ªæ˜¯-1 å€’æ•°ç¬¬äºŒä¸ªæ˜¯ -2 ä¾æ¬¡ç±»æ¨ \n5\n>>> nums[-3]\n3\n>>> nums[-6]  # è´Ÿå€¼çš„ç´¢å¼•è¶…å‡ºäº†èŒƒå›´æ—¶ï¼Œä¹Ÿä¼šæŠ¥ä¸€ä¸ªIndexErroré”™è¯¯ã€‚\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIndexError: list index out of range\n```\n\nå¦‚æœåˆ—è¡¨ä¸­çš„å…ƒç´ ä¹Ÿæ˜¯åˆ—è¡¨ï¼š\n\n```python\n>>> nums = [1, 2, [3, 4, 5]]\n>>> nums\n[1, 2, [3, 4, 5]]\n# è¦è®¿é—®å†…éƒ¨åˆ—è¡¨çš„ä¸­çš„å€¼å¯ä»¥è¿™æ ·\n>>> nums[2][2]\n5\n```\n\n#### åˆ†ç‰‡\n\nåˆ—è¡¨å¯ä»¥ä½¿ç”¨ç´¢å¼•è·å–ç‰¹å®šä½ç½®çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸¤ä¸ªç´¢å¼•è·å–ç´¢å¼•ä¹‹é—´çš„å…ƒç´ ï¼Œæ¯”å¦‚ï¼š\n\n```python\n>>> nums = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n>>> nums\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n>>> nums[0:1]\n[0]\n>>> nums[0:5]\n[0, 1, 2, 3, 4]\n>>> nums[1:7]\n[1, 2, 3, 4, 5, 6]\n```\né€šè¿‡ä¸Šè¾¹çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œåˆ†ç‰‡çš„è¯­æ³•ç»“æ„ä¸º\n\n```python\nlist[start_index:end_index]\n```\næ„æ€æ˜¯ å–åˆ—è¡¨ä¸­ä» start_index ä½ç½®å¼€å§‹å–ï¼Œå–å€¼ä¸ªæ•°ä¸º end_index-start_indexï¼Œä¹Ÿå°±æ˜¯å– list[start_index] åˆ° list[end_index-1] çš„å…ƒç´ ã€‚\n#### åˆ—è¡¨å¸¸ç”¨æ–¹æ³•\n\n##### append\nåˆ—è¡¨æ˜¯å¯å˜çš„ï¼Œå¯ä»¥å¾€listä¸­è¿½åŠ å…ƒç´ åˆ°æœ«å°¾ï¼š\n\n```python\n>>> nums = []\n>>> nums\n[]\n>>> nums.append(1)  # ä½¿ç”¨ append æ–¹æ³•å¾€åˆ—è¡¨çš„æœ«å°¾è¿½åŠ å…ƒç´ \n>>> nums\n[1]\n```\n\n##### insert\n\næŠŠå…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®ï¼š\n\n```python\n>>> nums = [0, 2, 3]\n>>> nums\n[0, 2, 3]\n>>> nums.insert(1, 10)  # å‘ç´¢å¼•ä½ç½®1 å¤„æ’å…¥æ•°å­—10\n>>> nums\n[0, 10, 2, 3]\n# å¦‚æœæŒ‡å®šçš„ç´¢å¼•è¶…è¿‡äº†åˆ—è¡¨çš„é•¿åº¦ï¼Œä¼šæŠŠå…ƒç´ æ’å…¥åˆ°æœ€å\n>>> nums.insert(10, 5)\n>>> nums\n[0, 10, 2, 3, 5]\n```\n\n##### pop\n\nåˆ é™¤æœ«å°¾çš„å…ƒç´ ï¼š\n\n```python\n>>> nums = [1, 2, 3, 4]\n>>> nums.pop()\n4\n>>> nums\n[1, 2, 3]\n```\n\nåˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼š\n\n```python\n>>> nums.pop(1)\n2\n>>> nums\n[1, 3]\n>>> nums.pop(3)  # æŒ‡å®šçš„ä½ç½®è¶…å‡ºäº†åˆ—è¡¨çš„å¤§å°\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nIndexError: list index out of range\n```\n\n##### sorted\n\næ’åºåˆ—è¡¨ï¼š\n\n```python\n>>> nums = [1, 4, 2, 3]\n>>> sorted(nums)\n[1, 2, 3, 4]\n```\n\nsorted() å‡½æ•°ä¼šæŠŠä¼ å…¥çš„åˆ—è¡¨ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ’åºåçš„åˆ—è¡¨ï¼ˆ`æ³¨æ„`ï¼šsorted è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå¹¶ä¸ä¼šæ”¹å˜å½“å‰åˆ—è¡¨ï¼‰\n\n```python\n# æ¥ä¸Šä¸€æ®µä»£ç \n>>> nums\n[1, 4, 2, 3]\n```\n\nä¿®æ”¹æŒ‡å®šä½ç½®çš„å€¼ï¼š\n\n```python\n>>> nums = [1, 2, 3, 4, 5, 6]\n>>> nums[1]\n2\n>>> nums[1] = 10\n>>> nums\n[1, 10, 3, 4, 5, 6]\n```\n\n### tuple\n\nå…ƒç»„å’Œåˆ—è¡¨ç±»ä¼¼ï¼Œè¿™é‡Œä¸»è¦è¯´ä¸€ä¸‹ä¸åŒï¼š\n\n#### 1ï¼šåˆå§‹åŒ–æ–¹å¼ä¸åŒ\n\nå…ƒç»„ä½¿ç”¨åŠè§’å°æ‹¬å·`()`ï¼Œåˆ—è¡¨ä½¿ç”¨æ–¹æ‹¬å·`[]`\n\n```python\n>>> nums = ()  # å£°æ˜ä¸€ä¸ªæ²¡æœ‰å…ƒç´ çš„ç©ºå…ƒç»„\n>>> nums\n()\n>>> nums = (1, 2, 3)\n>>> nums\n(1, 2, 3)\n```\n\nå¦‚æœå…ƒç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼ï¼Œå£°æ˜çš„æ—¶å€™è¦åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ ååŠ é€—å·(,):\n\n```python\n>>> nums = (1,)\n>>> nums\n(1, )\n>>> nums = (1)  # ä¸åŠ é€—å·python è®¤ä¸ºè¿™é‡Œçš„æ‹¬å·æ˜¯æ•°å­¦è¿ç®—ç¬¦\n>>> nums\n1\n```\n\n> ä¸åŠ é€—å·python è®¤ä¸ºè¿™é‡Œçš„æ‹¬å·æ˜¯`æ•°å­¦è¿ç®—ç¬¦`ï¼Œå¯¹æ•°å­—1 è¿›è¡Œå•ç‹¬è¿ç®—ç»“æœè¿˜æ˜¯ 1ï¼Œæ‰€ä»¥è¿”å›1\n\n#### 2ï¼š å…ƒç»„ä¸å¯å˜\n\nå…ƒç»„ä¸€æ—¦å£°æ˜ï¼Œå®ƒçš„å…ƒç´ æ˜¯ä¸å¯å˜çš„ï¼Œä¸èƒ½ä½¿ç”¨ appendã€popã€insert ç­‰æ–¹æ³•ã€‚\n\n```python\n>>> nums = (1, 2, 3)\n>>> nums.append()\nTraceback (most recent call last)\n<ipython-input-23-926c4dd5b5cb> in <module>()\n----> 1 nums.append(1)\nAttributeError: 'tuple' object has no attribute 'append'\n```\n\nå…¶å®ƒè·å–å…ƒç´ çš„æ–¹æ³•å’Œåˆ—è¡¨çš„ä¸€è‡´ã€‚\n\n### ç»ƒä¹ \n\nè¯·ç”¨ç´¢å¼•å–å‡ºä¸‹é¢listçš„æŒ‡å®šå…ƒç´ ï¼š\n\n```python\n# -*- coding: utf-8 -*-\n\nL = [\n    ['Apple', 'Google', 'Microsoft'],\n    ['Java', 'Python', 'Ruby', 'PHP'],\n    ['Adam', 'Bart', 'Lisa']\n]\n \n# æ‰“å°Apple:\nprint ?\n# æ‰“å°Python:\nprint ?\n# å°† PHP ä¿®æ”¹ä¸º JavaScript\n```\n\n### dictï¼ˆå­—å…¸ï¼‰\n\ndict æ˜¯ä½¿ç”¨é”®-å€¼ï¼ˆkey-valueï¼‰å­˜å‚¨ï¼Œå…·æœ‰æå¿«æŸ¥è¯¢é€Ÿåº¦çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚\n\n#### åˆå§‹åŒ–å­—å…¸\n\næ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªdict å­˜å‚¨ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ï¼š\n\n```python\nuser = {\n    'nickname': 'goodspeed',\n    'avatar': 'http://url.jpg',\n}\n```\n\n#### è®¿é—®å­—å…¸é‡Œçš„æ•°æ®\n\nå¦‚æœæˆ‘ä»¬æƒ³æŸ¥æ‰¾å­—å…¸é‡Œçš„æŸä¸ªå€¼ï¼Œå¯ä»¥æ ¹æ® key è¯»å–ã€‚æ¯”å¦‚\n\n```python\n>>> user = {\n    'nickname': 'goodspeed',\n    'avatar': 'http://url.jpg',\n}\n>>> nickname = user['nickname']\n>>> nickname\ngoodspeed\n```\n\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„ `key`ï¼Œdict ä¼šæŠ¥é”™ï¼š\n```python\n>>> user = {}\n>>> user['nickname']\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nKeyError: 'nickname'\n```\n \nä¸Šè¾¹è¿™ä¸ªä¾‹å­æ˜¯å› ä¸º dict `user` ä¸å­˜åœ¨`key` nicknameï¼Œæ‰€ä»¥æŠ›å‡º`KeyError` å¼‚å¸¸ã€‚\n\n> å¦‚ä½•é¿å…KeyError é”™è¯¯å‘¢ï¼Ÿ\n\n1. ä½¿ç”¨ä¹‹å‰å……åˆ†äº†è§£ dict ç»“æ„ï¼ˆä¸é è°±ï¼Œç¨‹åºæ€»æ˜¯å­˜åœ¨å„ç§å„æ ·çš„å¯èƒ½ï¼Œè°çŸ¥é“åˆ°åº•æœ‰æ²¡æœ‰ï¼‰\n2. å–å€¼ä¹‹å‰å…ˆåˆ¤æ–­ `key` æ˜¯å¦å­˜åœ¨ï¼ˆä½¿ç”¨ `in` åˆ¤æ–­)\n\n```python\n>>> user = {\n    'nickname': 'goodspeed',\n    'age': 8\n}\n>>> 'nickname' in user  # user æœ‰ nickname è¿™ä¸ª key\nTrue\n>>> 'avatar' in user # user æ²¡æœ‰ nickname è¿™ä¸ª key\nFalse\n```\n\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹å¼å–å€¼ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š\n\n```python\nuser = {\n    'nickname': 'goodspeed',\n    'age': 8\n}\nif 'nickname' in user:\n    nickname = user['nickname']\nelse:\n    nickanme = 'é»˜è®¤å€¼'     \n```\n\nè¿™æ˜¾ç„¶å¤ªå•°å—¦äº†ï¼Œpython æœ‰æ›´å¥½çš„åŠæ³•ï¼š\n\n3. ä½¿ç”¨ `get()` æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š\n\n```python\n>>> user = {\n    'nickname': 'goodspeed',\n    'age': 8\n}\n\n>>> nickname = user.get('nickname', 'å¦‚æœnickname ä¸å­˜åœ¨ï¼Œæˆ‘æ˜¯é»˜è®¤å€¼')\n>>> nickname\ngoodspeed\n\n>>> avatar = user.get('avatar', 'avatar ä¸å­˜åœ¨ï¼Œå–åˆ°çš„å€¼å°±æ˜¯æˆ‘')\n>>> avatar\navatar ä¸å­˜åœ¨ï¼Œå–åˆ°çš„å€¼å°±æ˜¯æˆ‘\n```\n\n> ç®€å•å¤šäº†å§ ğŸ™„ğŸ™ƒ\n\n#### æ›´æ–° dict\n\ndict æ˜¯å¯å˜å®¹å™¨ï¼Œå®ƒçš„æ•°æ®å¯ä»¥å¢åŠ ä¿®æ”¹ï¼Œæ¯”å¦‚\n\n```python\n>>> user = { # åˆå§‹åŒ–ä¸€ä¸ªå­—å…¸ åªæœ‰ä¸€ä¸ª nickname key\n    'nickname': 'goodspeed',\n}\n>>> user['age'] = 8\n>>> user\n{\n    'nickname': 'goodspeed',\n    'age': 8\n}\n# æˆ‘è¯´æˆ‘8å²å¤§å®¶éƒ½ä¸ä¿¡ï¼Œéè®©æˆ‘å†™çœŸå®å¹´é¾„ï¼Œæ²¡åŠæ³•æˆ‘åªèƒ½æ”¹äº†ğŸ¤·â€â™€ï¸\n>>> user['age'] = 9 # è¿™ä¸‹æ»¡æ„äº†å§\n>>> user\n{\n    'nickname': 'goodspeed',\n    'age': 9\n}\n```\n\n> é‚£å¦‚æœæƒ³ä¸€æ¬¡æ›´æ–°å¤šä¸ªå€¼å‘¢? ä½¿ç”¨`update` æ–¹æ³•\n\n```python\n>>> user = {} # åˆå§‹åŒ–ä¸€ä¸ªç©ºå­—å…¸\n>>> user.update({'nickname': 'goodspeed', 'age': 8}) # ä½¿ç”¨ update æ›´æ–°å­—å…¸\n>>> user\n{\n    'nickname': 'goodspeed',\n    'age': 8\n}\n```\n\n#### å­—å…¸ key æ³¨æ„äº‹é¡¹\n\n1. key å¿…é¡»æ˜¯ä¸å¯å˜å¯¹è±¡ï¼ˆå¯ä»¥æš‚æ—¶é™åˆ¶ä¸ºï¼Œå­—ç¬¦ï¼Œæ•°å­—ç­‰å€¼ï¼‰\n2. key ä¸èƒ½é‡å¤ï¼Œå¦‚æœé‡å¤è®¾ç½®ï¼Œåè¾¹çš„å€¼ä¼šè¦†ç›–å‰ä¸€æ¬¡çš„å€¼\n\n### set\n\nset å’Œ dict ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç»„ key çš„é›†åˆï¼Œä½†æ˜¯ set åªæœ‰ key æ²¡æœ‰å¯¹åº”çš„ valueã€‚\n\n> set ä¸­ä¹Ÿæ²¡æœ‰é‡å¤çš„ key\n\n#### åˆå§‹åŒ–ä¸€ä¸ªset\n\n```python\n>>> s = set() # åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„é›†åˆ\n# ä¹Ÿå¯ä»¥æŠŠä¸€ä¸ªåºåˆ—ä½œä¸ºåˆå§‹åŒ–å‚æ•°\n>>> sl = set([1, 2, 3])  # æŠŠåˆ—è¡¨ä½œä¸ºå‚æ•°\n>>> sl\n{1, 2, 3}\n>>> st = set((1, 2, 3)) # æŠŠå…ƒç»„ä½œä¸ºå‚æ•°\n>>> st\n{1, 2, 3}\n>>> ss = set('hello') # æŠŠå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°\n>>> ss\n{'e', 'h', 'l', 'o'}\n```\n\n> set ä¸­çš„ key æ˜¯æ— åºçš„ï¼ˆé¡ºåºå¦‚ä½•ï¼Œçœ‹ set å¿ƒæƒ…ï¼‰\n\n#### set å¸¸ç”¨æ–¹æ³•\n\n##### add \n\nä½¿ç”¨ add å‘ set æ·»åŠ ä¸€ä¸ª å…ƒç´ ã€‚\n\n```python\n>>> s = set()\n>>> s.add(1)\n>>> s\n{1}\n>>> s.add(2)\n>>> s\n{2, 1}\n```\n\nset ä¸­çš„ key æ˜¯ä¸å¯é‡å¤çš„æ‰€ä»¥ï¼Œä½¿ç”¨ add æ·»åŠ ç›¸åŒçš„ keyï¼Œä¼šè‡ªåŠ¨å»é‡ï¼Œæ¯”å¦‚\n\n```python\n>>> s = set()\n>>> for i in range(10): # å‘é›†åˆæ·»åŠ 10æ¬¡å­—ç¬¦ 'a'\n        s.add('a')\n>>> s \n{'a'} #  set è‡ªåŠ¨å»é‡ï¼Œæ‰€ä»¥ä»ç„¶åªæœ‰ä¸€ä¸ªå…ƒç´ \n```\n\n##### remove\n\nset å¯æ˜¯å·²ä½¿ç”¨ `remove()` æ–¹æ³•åˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ª keyï¼Œæ¯”å¦‚ï¼š\n```python\n>>> s = set([1, 2, 3])\n>>> s.remove(1)\n>>> s\n{2, 3}\n>>> s.remove(4)  # å¦‚æœä½¿ç”¨ remove åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„ keyï¼Œä¼šæŠ›å‡º KeyError é”™è¯¯\nTraceback (most recent call last)\n<ipython-input-20-737bdeaad795> in <module>()\n----> 1 s.remove(4)\nKeyError: 4\n```\n\n## æµç¨‹æ§åˆ¶\n\n### æ¡ä»¶åˆ¤æ–­ if\n\næ¡ä»¶åˆ¤æ–­æ˜¯ç¨‹åºçš„ä¸€ä¸ªåŸºæœ¬æµç¨‹æ§åˆ¶ã€‚è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š\n\n```python\nif æ¡ä»¶:\n    æ¡ä»¶æˆç«‹æ‰§è¡Œè¯­å¥\nelif ç¬¬äºŒä¸ªæ¡ä»¶:\n    æ¡ä»¶æˆç«‹æ‰§è¡Œè¯­å¥\nelse:\n    ä¸Šè¿°æ¡ä»¶éƒ½ä¸æˆç«‹ï¼Œæ‰§è¡Œçš„è¯­å¥\n```\n\n#### if è¯­å¥æ³¨æ„äº‹é¡¹\n\n* æ¡ä»¶è¯­å¥åè¦åŠ å†’å·`:`\n* if è¯­å¥æ˜¯ä»ä¸Šå‘ä¸‹ä¾æ¬¡æ‰§è¡Œçš„ï¼Œå¦‚æœåœ¨æŸä¸ªåˆ¤æ–­ä¸Šæ˜¯ Trueï¼Œå‰©ä¸‹çš„è¯­å¥å°±ä¸ä¼šæ‰§è¡Œäº†ã€‚\n* é€šè¿‡å¸ƒå°”è¿ç®—å¾—åˆ°ç»“æœä¸º Trueï¼Œæ¡ä»¶å°±ç®—æˆç«‹\n\n> ç©ºåˆ—è¡¨ï¼Œç©ºå­—å…¸ï¼Œç©ºå…ƒç»„ï¼Œç©ºé›†åˆï¼Œç©ºå­—ç¬¦ä¸²ï¼Œ0éƒ½ä¸ä¸ºçœŸ\n\n```python\n>>> s = set()\n>>> if s:\n        print 'è¿™ä¸æ˜¯ä¸€ä¸ªç©ºé›†åˆ'\n    else:\n        print 's ä¸ºç©ºé›†åˆ'    \n```\n\n#### boolean\n\nå¸ƒå°”å€¼åªæœ‰ä¸¤ä¸ªå€¼ Trueã€Falseã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥ç›´æ¥ç”¨Trueã€Falseè¡¨ç¤ºå¸ƒå°”å€¼ï¼ˆè¯·æ³¨æ„å¤§å°å†™ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¸ƒå°”è¿ç®—è®¡ç®—å‡ºæ¥ï¼š\n\n```python\n>>> True\nTrue\n>>> False\nFalse\n>>> 3 > 2\nTrue\n>>> 3 > 5\nFalse\n```\n\nå¸ƒå°”å€¼å’Œæ¡ä»¶è¿ç®—æ˜¯æ¡ä»¶åˆ¤æ–­çš„åŸºæœ¬æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š\n\n```python\nage = 4\nif age > 3:\n    print 'æˆç†Ÿç‚¹ï¼Œä½ å·²ç»ä¸æ˜¯3å²çš„å­©å­äº†'\nelif age > 20:\n    print 'ä½ éƒ½æ˜¯ä¸­å¹´äººäº†ï¼Œå¯æ€œğŸ¤•'\nelse:\n    print 'ä½ 3å²å°å­©æ‡‚ä»€ä¹ˆ'\n```\n\n> æˆ‘ä»¬ä¸Šè¾¹è¯´è¿‡ï¼Œif è¯­å¥æ˜¯ä»ä¸Šå‘ä¸‹ä¾æ¬¡æ‰§è¡Œçš„ï¼Œå¦‚æœæŸä¸ªåˆ¤æ–­ä¸º Trueï¼Œå‰©ä¸‹çš„å°±ä¼šå¿½ç•¥ä¸åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªä»£ç ä¸­ç¬¬äºŒä¸ªåˆ¤æ–­ `age > 20` æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œå› ä¸º `> 20` è‚¯å®šä¹Ÿ å¤§äº 3ï¼Œä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªæ¡ä»¶\n\n### å¾ªç¯\n\nè¦æ‰“å°2æ¬¡ `hello world` æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™ï¼š\n\n```python\nprint 'hello world'\nprint 'hello world'\n```\n\nä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦æ‰“å°100 æ¬¡ã€1000æ¬¡å°±éœ€è¦ç”¨åˆ°å¾ªç¯è¯­å¥äº†ã€‚\nPython å¾ªç¯æœ‰ä¸¤ç§æ–¹å¼ï¼šè®¡æ•°å¾ªç¯å’Œæ¡ä»¶å¾ªç¯ã€‚\n\n#### è®¡æ•°å¾ªç¯ï¼ˆfor...inï¼‰\n\nè®¡æ•°å¾ªç¯çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```python\nfor i in [1, 2, 3, 4]:\n    print i\n```\n\n* å˜é‡ i ä»1å¼€å§‹\n* å¯¹åº”åˆ—è¡¨çš„æ¯ä¸€ä¸ªå€¼ï¼Œå¾ªç¯ä¼šæŠŠæŒ‡ä»¤å—ä¸­æ‰€æœ‰ä»£ç æ‰§è¡Œä¸€é\n* æ¯æ¬¡æ‰§è¡Œå¾ªç¯æ—¶ï¼Œå˜é‡ i ä¼šèµ‹å€¼ä¸ºåˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå€¼\n* æ¯æ¬¡å¾ªç¯ç§°ä¸ºä¸€æ¬¡è¿­ä»£\n\n> `for å¾ªç¯` ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨ list ä¸Šï¼Œè¿˜å¯ä»¥ä½œç”¨åœ¨å…¶ä»–å¯è¿­ä»£å¯¹è±¡ä¸Šï¼ˆå…ƒç»„ã€å­—å…¸ã€é›†åˆã€å­—ç¬¦ä¸²ç­‰ï¼‰\n\n#### range() å‡½æ•°\n\n* range() ä¼šåˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«æŸä¸ªèŒƒå›´å†…çš„æ•°\n* range(5) â€”> [0, 1, 2, 3, 4]\n* range(1, 6) â€”> [1, 2, 3, 4, 5, 6]\n* range(x, y) é»˜è®¤ä»0è®¡æ•°ï¼Œå¾ªç¯æ¬¡æ•°ä¸º y-x\n\nrange å‡½æ•°ä¸ä»…ä»…åªæ˜¯å¯ä»¥æ¯æ¬¡å¢åŠ ä¸€ä¸ªæ•°ï¼Œè¿˜å¯ä»¥æŒ‡å®šæ­¥é•¿ï¼Œæ¯”å¦‚ï¼š\n\n* range(1, 10, 2) â€”> [1, 3, 5, 7, 9]\nè¿™ä¸ªæ„æ€æ˜¯ï¼Œç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ï¼Œä»1å¼€å§‹ï¼Œåˆ°10ç»“æŸï¼Œæ¯ä¸ªæ•°å­—é—´éš”ä¸º2ï¼ˆåä¸€ä¸ªæ•°å­—å‡å‰ä¸€ä¸ªæ•°å­—å€¼ä¸º2ï¼‰\n\n##### range() è¿˜å¯ä»¥åå‘è®¡æ•°\n\n* range(5, 1, -1) â€”> [5, 4, 3, 2]\n\n##### ç»ƒä¹ \n\nä½¿ç”¨ for å¾ªç¯ è®¡ç®— 1åˆ°100 çš„å’Œã€‚\n\n#### æ¡ä»¶å¾ªç¯ï¼ˆwhileï¼‰\n\næ¡ä»¶å¾ªç¯åŸºæœ¬è¯­æ³•ä¸ºï¼š\n\n```python\nwhile æ¡ä»¶:\n    è¯­å¥å—\n```\n\nåªè¦æ»¡è¶³æ¡ä»¶ï¼Œå°±ä¼šä¸æ–­å¾ªç¯ï¼š\n\n```python\nwhile True:\n    print 'hello' \n```\n\nè¿™ä¸ªå¾ªç¯å› ä¸º True ä¸€ç›´ä¸ºçœŸï¼Œæ‰€ä»¥æ¡ä»¶ä¸€ç›´æ»¡è¶³ï¼Œæ‰€ä»¥å¦‚æœè¿è¡Œä»£ç ï¼Œä¼šä¸€ç›´æ‰“å° hello å­—ç¬¦ä¸²ã€‚\n\næ‰€ä»¥ä½¿ç”¨ while å¾ªç¯è¦åœ¨ä»£ç å—ä¸­è®¾å®šå¯ä»¥è·³å‡ºçš„æ¡ä»¶ï¼Œæ¯”å¦‚ï¼š\n\n```python\na = 0\nwhile a< 100:\n    print a\n    a = a + 1 # a ä¸åœè‡ªåŠ \n```\n\nå¯ä»¥æ‰§è¡Œä¸‹ä¸Šè¿°ä»£ç ï¼Œçœ‹ä¸‹æ•ˆæœã€‚\n\n##### ç»ƒä¹ \n\nä½¿ç”¨ while å¾ªç¯ï¼Œè®¡ç®—1ï¼Œ2ï¼Œ 3...100 çš„å’Œã€‚\n\n\n### è·³å‡ºå¾ªç¯\n\nè·³å‡ºå¾ªç¯æœ‰ä¸¤ç§å½¢å¼ï¼Œä½¿ç”¨ `break` æˆ–ç€ä½¿ç”¨ `continue`ã€‚\n\n#### break\n\nå¦‚æœåœ¨å¾ªç¯ä¸­ä½¿ç”¨ `break` å¾ªç¯ä¼šç›´æ¥ç»“æŸï¼Œä¹‹åçš„å¾ªç¯å°±ä¸å†æ‰§è¡Œ\n\n```python\n>>> for i in range(100):\n        if i > 2: # å½“i = 3 æ—¶ å¾ªç¯å°±ç›´æ¥é€€å‡º\n            break\n        print i\n0\n1\n2\n```\nè¿™æ®µä»£ç æ‰§è¡Œä¹‹ä¼šæ‰“å° 0 1 2 å› ä¸ºå¤§äº2åå¾ªç¯ä¼šç›´æ¥ç»ˆç»“ã€‚\n\n#### continue\n\nåœ¨å¾ªç¯ä¸­ä½¿ç”¨ `continue`ï¼Œæ­¤æ¬¡å¾ªç¯ä¼šè¢«è·³è¿‡ï¼Œç›´æ¥æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯\n\n```python\n>>> for i in range(5):\n        if i == 3:\n            continue\n        print i\n0\n1\n2\n4\n```\nä¸Šè¾¹è¿™æ®µä»£ç ï¼Œå½“ i å€¼ç­‰äº3æ—¶ï¼Œæˆ‘ä»¬è·³è¿‡å½“å‰å¾ªç¯ï¼Œç›´æ¥æ‰§è¡Œä¸‹ä¸€æ¬¡ï¼Œæ‰€ä»¥æ‰§è¡Œçš„ç»“æœä¸º\n\n0, 1, 2, 4\n\n#### ç»ƒä¹ \n\nä½¿ç”¨ continue è®¡ç®— 1 åˆ° 3245 é—´æ‰€æœ‰æ•°å­—ä¸­å¥‡æ•°çš„å’Œã€‚\n \n## å‚è€ƒé“¾æ¥\n\n* [ä½¿ç”¨listå’Œtuple](https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014316724772904521142196b74a3f8abf93d8e97c6ee6000)\n* [pythonåŸºç¡€æ•°æ®ç±»å‹åŠå†…ç½®å®¹å™¨è¯¦è§£](http://blog.csdn.net/qq_30490125/article/details/50916268)\n* [æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯](https://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/001374738281887b88350bd21544e6095d55eaf54cac23f000)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonå®¹å™¨å’Œæ§åˆ¶è¯­å¥",
        "date": "2017-09-05 09:44:27",
        "tags": [
          "python"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-container-and-control"
    },
    {
      "content": "\n> è¿™æ˜¯å°ç¨‹åºå¼€å‘ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä»‹ç»å¦‚ä½•ä¸Šä¼ å›¾ç‰‡åˆ°è…¾è®¯äº‘ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©è…¾è®¯äº‘ï¼Œæ˜¯å› ä¸ºè…¾è®¯äº‘å…è´¹ç©ºé—´å¤§ğŸ˜‚\n\n## å‡†å¤‡å·¥ä½œ\n\nä¸Šä¼ å›¾ç‰‡ä¸»è¦æ˜¯å°†å›¾ç‰‡ä¸Šä¼ åˆ°è…¾è®¯äº‘å¯¹è±¡å­˜å‚¨ï¼ˆCOSï¼‰ã€‚\n\nè¦ä½¿ç”¨å¯¹è±¡å­˜å‚¨ APIï¼Œéœ€è¦å…ˆæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. è´­ä¹°è…¾è®¯äº‘å¯¹è±¡å­˜å‚¨ï¼ˆCOSï¼‰æœåŠ¡\n2. åœ¨è…¾è®¯äº‘ [å¯¹è±¡å­˜å‚¨æ§åˆ¶å°](https://console.qcloud.com/cos4/index) é‡Œåˆ›å»ºä¸€ä¸ª Bucket\n3. åœ¨æ§åˆ¶å° [ä¸ªäºº API å¯†é’¥](https://console.qcloud.com/capi) é¡µé¢é‡Œè·å– AppIDã€SecretIDã€SecretKey å†…å®¹\n4. ç¼–å†™ä¸€ä¸ªè¯·æ±‚ç­¾åç®—æ³•ç¨‹åºï¼ˆæˆ–ä½¿ç”¨ä»»ä½•ä¸€ç§æœåŠ¡ç«¯ SDKï¼‰\n5. è®¡ç®—ç­¾åï¼Œè°ƒç”¨ API æ‰§è¡Œæ“ä½œ\n\næ‰€ä»¥æˆ‘ä»¬è¦åšçš„å‡†å¤‡å·¥ä½œæœ‰ï¼š\n\n* è¿›å…¥[è…¾è®¯äº‘å®˜ç½‘](https://www.qcloud.com)ï¼Œæ³¨å†Œå¸å·\n* ç™»å½•[äº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆCOSï¼‰æ§åˆ¶å°](https://console.qcloud.com/cos4)ï¼Œå¼€é€šCOSæœåŠ¡ï¼Œåˆ›å»ºèµ„æºéœ€è¦ä¸Šä¼ çš„Bucket\n* åœ¨å°ç¨‹åºå®˜ç½‘ä¸Šé…ç½®åŸŸåä¿¡æ¯ï¼ˆå¦åˆ™æ— æ³•åœ¨å°ç¨‹åºä¸­å‘èµ·å¯¹è¯¥åŸŸåçš„è¯·æ±‚ï¼‰\n\n![image](http://media.gusibi.mobi/dloLMnRv8lJosOZt_gv9apWHmFRKfBcUtw0bgXR-Q_uSnmuQK5uP822b6lrYqlxq)\n\nè¿™äº›é…ç½®è¿‡ç¨‹è¿™é‡Œå°±ä¸åšè¯´æ˜äº†ï¼Œæ¥ä¸‹æ¥ä¸»è¦ä»‹ç»æ­¥éª¤4ã€5ã€‚\n\nå°ç¨‹åºä¸Šä¼ å›¾ç‰‡åˆ° cos æµç¨‹å¦‚ä¸‹å›¾ï¼š\n\n![å›¾ç‰‡ä¸Šä¼ æµç¨‹å›¾](http://media.gusibi.mobi/LC4VsGph5WEJrKEGK7pbyaJGRpshIMx9H4qh804WDJNiInrIirAmNMvQPXMltb0a)\n\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦å®ç°çš„æ˜¯ï¼Œé‰´æƒæœåŠ¡å™¨è¿”å›ç­¾åçš„æ­¥éª¤ä»¥åŠå°ç¨‹åºçš„ç›¸å…³æ­¥éª¤ã€‚\n\n## COSé‰´æƒæœåŠ¡\n\nä½¿ç”¨å¯¹è±¡å­˜å‚¨æœåŠ¡ COS æ—¶ï¼Œå¯é€šè¿‡ RESTful API å¯¹ COS å‘èµ· HTTP åŒ¿åè¯·æ±‚æˆ– HTTP ç­¾åè¯·æ±‚ï¼Œå¯¹äºç­¾åè¯·æ±‚ï¼ŒCOS æœåŠ¡å™¨ç«¯å°†ä¼šè¿›è¡Œå¯¹è¯·æ±‚å‘èµ·è€…çš„èº«ä»½éªŒè¯ã€‚\n\n* åŒ¿åè¯·æ±‚ï¼šHTTP è¯·æ±‚ä¸æºå¸¦ä»»ä½•èº«ä»½æ ‡è¯†å’Œé‰´æƒä¿¡æ¯ï¼Œé€šè¿‡ RESTful API è¿›è¡Œ HTTP è¯·æ±‚æ“ä½œã€‚\n* ç­¾åè¯·æ±‚ï¼šHTTP è¯·æ±‚æ—¶æ·»åŠ ç­¾åï¼ŒCOSæœåŠ¡å™¨ç«¯æ”¶åˆ°æ¶ˆæ¯åï¼Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒéªŒè¯æˆåŠŸåˆ™å¯æ¥å—å¹¶æ‰§è¡Œè¯·æ±‚ï¼Œå¦åˆ™å°†ä¼šè¿”å›é”™è¯¯ä¿¡æ¯å¹¶ä¸¢å¼ƒæ­¤è¯·æ±‚ã€‚\nè…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ï¼ŒåŸºäºå¯†é’¥ HMAC (Hash Message Authentication Code) çš„è‡ªå®šä¹‰ HTTP æ–¹æ¡ˆè¿›è¡Œèº«ä»½éªŒè¯ã€‚\n\nä¸Šä¼ å›¾ç‰‡æ˜¯ä¸€ä¸ªç­¾åè¯·æ±‚ï¼Œéœ€è¦è¿›è¡Œç­¾åéªŒè¯ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬\n\n### ç­¾åæµç¨‹\n\nå®¢æˆ·é€šè¿‡å¯¹ HTTP è¯·æ±‚è¿›è¡Œç­¾åï¼Œå¹¶å°†ç­¾ååçš„è¯·æ±‚å‘é€è‡³è…¾è®¯äº‘è¿›è¡Œç­¾åéªŒè¯ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![ç­¾åæµç¨‹](https://mc.qcloudimg.com/static/img/4a1eb29033caa977c648cb84d9398fdd/image.png)\n\næˆ‘ä»¬ä½¿ç”¨ sdk å¼€å‘ï¼Œè¿™ä¸ªæµç¨‹å¤§è‡´äº†è§£ä¸‹å°±è¡Œï¼Œç­¾åçš„å®ç° sdk å·²ç»åŒ…å«ï¼Œåªéœ€è¦è°ƒç”¨æ–¹æ³•å³å¯ã€‚\n\né€šè¿‡ç­¾åæµç¨‹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç­¾åéœ€è¦ SecretId å’Œ SecretKeyï¼Œè¿™ä¸¤ä¸ªä¿¡æ¯ä¸é€‚åˆå­˜æ”¾åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å•ç‹¬éƒ¨ç½²ä¸€ä¸ªé‰´æƒæœåŠ¡å™¨çš„ä¸»è¦åŸå› ã€‚\n\n### ç­¾åç”Ÿæˆ API\n\nä¸Šä¸€ç¯‡[å°ç¨‹åºå¼€å‘ï¼špython sanic å®ç°å°ç¨‹åºç™»å½•æ³¨å†Œ]() æˆ‘ä»¬ä»‹ç»è¿‡ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ [`sanic`](https://github.com/channelcat/sanic) æ¡†æ¶ + [`swagger_py_codegen`](https://github.com/guokr/swagger-py-codegen) ç”Ÿæˆ rest-apiã€‚\n\næ·»åŠ ç­¾åç”Ÿæˆ api æˆ‘ä»¬éœ€è¦å…ˆåœ¨æ–‡æ¡£ä¸­æ·»åŠ  API çš„ç›¸å…³æè¿°ã€‚[æ–‡æ¡£ä»£ç ï¼šhttps://github.com/gusibi/Metis/blob/master/docs/v1.yml](https://github.com/gusibi/Metis/blob/master/docs/v1.yml)\n\n```yml\n    /qc_cos/config:\n        get:\n            summary: è…¾è®¯äº‘é…ç½®\n            description: è…¾è®¯äº‘é…ç½®\n            tags: [Config]\n            operationId: get_qc_cos_config\n            parameters:\n                - $ref: '#/parameters/AccessToken'\n                - $ref: '#/parameters/qcos_path_in_query'\n            responses:\n                200:\n                    schema:\n                        $ref: '#/definitions/QCOSConfig'\n                default:\n                    description: Unexpected error\n                    schema:\n                        $ref: '#/definitions/Error'\n            security:\n                - OAuth2: [open]\n```\n\n> è¿™ä¸ªæ¥å£æˆ‘ä»¬è¦æ±‚ç™»å½•æ‰èƒ½è°ƒç”¨ã€‚\næ–‡æ¡£å®šä¹‰å®Œæˆä¹‹åï¼Œè°ƒç”¨ \n```sh\nswagger_py_codegen -s  docs/v1.yml . -p apis -tlp sanic\n```\nç”Ÿæˆä»£ç æ¨¡æ¿ï¼ŒAPI ä»£ç å®ç°å¦‚ä¸‹ï¼š\n```python\n    from qcloud_cos.cos_auth import Auth\n    \n    async def get(self, request):\n        auth = Auth(appid=Config.QCOS_APPID,\n                    secret_id=Config.QCOS_SECRET_ID,\n                    secret_key=Config.QCOS_SECRET_KEY)\n        expired = time() + 3600 # ç­¾åæœ‰æ•ˆæ—¶é—´ 3600 ç§’\n        # ä¸Šä¼ åˆ° cos bucket çš„ç›®å½•\n        dir_name = request.raw_args.get('cos_path', '/xrzeti')\n        # ç”Ÿæˆç­¾å\n        sign = auth.sign_more(Config.QCOS_BUCKET_NAME,\n                              cos_path=dir_name,\n                              expired=expired)\n        return {\"sign\": sign}, 200\n```\n\n> ç”±äº è…¾è®¯äº‘COSv4 çš„Python SDK åªæ”¯æŒ python2ï¼Œè€Œ sanic éœ€è¦ python3.5+ æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ fork å‡ºæ¥ä¸€ä»½æ·»åŠ äº† python3 çš„æ”¯æŒã€‚\n[https://github.com/gusibi/cos-python-sdk-v4](https://github.com/gusibi/cos-python-sdk-v4)ã€‚ä½¿ç”¨ python3 ç¯å¢ƒçš„å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬ã€‚\n\n##  ä¸Šä¼ å›¾ç‰‡åˆ° cos\n\n### é€‰æ‹©å›¾ç‰‡\n\n> `wx.chooseImage(OBJECT)`\nä»æœ¬åœ°ç›¸å†Œé€‰æ‹©å›¾ç‰‡æˆ–ä½¿ç”¨ç›¸æœºæ‹ç…§ã€‚\n\nè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°ç¨‹åºä¼šæŠŠé€‰æ‹©çš„å›¾ç‰‡æ”¾åˆ°ä¸´æ—¶è·¯å¾„ï¼ˆåœ¨å°ç¨‹åºæœ¬æ¬¡å¯åŠ¨æœŸé—´å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œå¦‚éœ€æŒä¹…ä¿å­˜ï¼Œéœ€åœ¨ä¸»åŠ¨è°ƒç”¨ wx.saveFileï¼Œåœ¨å°ç¨‹åºä¸‹æ¬¡å¯åŠ¨æ—¶æ‰èƒ½è®¿é—®å¾—åˆ°ï¼‰ï¼Œæˆ‘ä»¬åªèƒ½å°†ä¸´æ—¶è·¯å¾„çš„æ–‡ä»¶ä¸Šä¼ ã€‚\n\næ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š\n\n```js\n    uploadToCos: function () {\n        var that = this;\n\n        // é€‰æ‹©ä¸Šä¼ çš„å›¾ç‰‡\n        wx.chooseImage({\n            sizeType: ['original', 'compressed'], // å›¾ç‰‡ç±»å‹ original åŸå›¾ï¼Œcompressed å‹ç¼©å›¾ï¼Œé»˜è®¤äºŒè€…éƒ½æœ‰\n            success: function (res) {\n\n                // è·å–æ–‡ä»¶è·¯å¾„\n                var file = res.tempFiles[0];\n                console.log(file.size);\n\n                // è·å–æ–‡ä»¶å\n                var fileName = file.path.match(/(wxfile:\\/\\/)(.+)/)\n                fileName = fileName[2]\n\n                // è·å–åˆ°å›¾ç‰‡ä¸´æ—¶è·¯å¾„åï¼ŒæŒ‡å®šæ–‡ä»¶å ä¸Šä¼ åˆ°cos\n                upload(file.path, fileName, that);\n            }\n        })\n    }\n    \n```\nè¿™é‡Œå›¾ç‰‡é€‰æ‹©æˆåŠŸåï¼Œæˆ‘ä»¬å–åŸå›¾ä¸Šä¼ åˆ° cosã€‚\n\n### ä¸Šä¼ å›¾ç‰‡\n\ncos ä¸Šä¼ å›¾ç‰‡çš„URLç”± cos_regionï¼Œappidï¼Œbucket_nameå’Œ cos_dir_name æ‹¼æ¥è€Œæˆã€‚\næŠŠä»¥ä¸‹å­—æ®µé…ç½®æˆè‡ªå·±çš„cosç›¸å…³ä¿¡æ¯ï¼Œè¯¦æƒ…å¯çœ‹[APIæ–‡æ¡£](https://www.qcloud.com/document/product/436/6066)\n```js\ncosUrl = \"https://\" + REGION + \".file.myqcloud.com/files/v2/\" + APPID + \"/\" + BUCKET_NAME + DIR_NAME;\n```\n\n> `REGION`: cosä¸Šä¼ çš„åœ°åŒº\n> `APPID`: è´¦å·çš„appid\n> `BUCKET_NAME`: cos bucketçš„åå­—\n> `DIR_NAME`: ä¸Šä¼ çš„æ–‡ä»¶ç›®å½•\n\n\n```js\nvar config = require('../config.js');\n// å…ˆç¡®å®šä¸Šä¼ çš„ URL\nvar cosUrl = \"https://\" + config.cos_region + \".file.myqcloud.com/files/v2/\" + config.cos_appid + \"/\" + config.cos_bucket_name + config.cos_dir_name;\n\n//å¡«å†™è‡ªå·±çš„é‰´æƒæœåŠ¡å™¨åœ°å€\nvar cosSignatureUrl = config.host + '/v1/qc_cos/config?cos_path=' + config.cos_dir_name;\n\n/**\n * ä¸Šä¼ æ–¹æ³•\n * filePath: ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„\n * fileNameï¼š ä¸Šä¼ åˆ°cosåçš„æ–‡ä»¶å\n * that: å°ç¨‹åºæ‰€åœ¨å½“å‰é¡µé¢çš„ object\n */\nfunction upload(filePath, fileName, that) {\n    var data;\n\n    // é‰´æƒè·å–ç­¾å\n    wx.request({\n        url: cosSignatureUrl,\n        header: {\n            Authorization: 'JWT' + ' ' + that.data.jwt.access_token\n        },\n        success: function (cosRes) {\n            // è·å–ç­¾å\n            var signature = cosRes.data.sign;\n\n            // å¤´éƒ¨å¸¦ä¸Šç­¾åï¼Œä¸Šä¼ æ–‡ä»¶è‡³COS\n            var uploadTask = wx.uploadFile({\n                url: cosUrl + '/' + fileName,\n                filePath: filePath,\n                header: {\n                    'Authorization': signature\n                },\n                name: 'filecontent',\n                formData: {\n                    op: 'upload'\n                },\n                success: function (uploadRes) {\n                    // ä¸Šä¼ æˆåŠŸåçš„æ“ä½œ\n                    var upload_res = JSON.parse(uploadRes.data)\n                    var files = that.data.files;\n                    files.push(upload_res.data.source_url);\n                    that.setData({\n                        upload_res: upload_res,\n                        files: files,\n                        test_image: upload_res.data.source_url\n                    })\n                },\n                fail: function (e) {\n                    console.log('e', e)\n                }\n            });\n            // ä¸Šä¼ è¿›åº¦æ¡\n            uploadTask.onProgressUpdate((res) => {\n                that.setData({\n                    upload_progress: res.progress\n                })\n                if (res.progress === 100){\n                    that.setData({\n                        upload_progress: 0\n                    })\n                }\n            })\n        }\n    })\n    return data\n}\n```\nå°ç¨‹åºæä¾›äº† `uploadTask.onProgressUpdate()` æ¥è·å–å›¾ç‰‡çš„ä¸Šä¼ è¿›åº¦ï¼Œè¿™é‡Œæˆ‘å°†å›¾ç‰‡çš„ä¸Šä¼ è¿›åº¦æ˜¾ç¤ºäº†å‡ºæ¥ã€‚\n\nå®Œæ•´ä»£ç å‚è€ƒï¼š[metis-wxapp: https://github.com/gusibi/Metis-wxapp](https://github.com/gusibi/Metis-wxapp/tree/master/dist)\n\n## å‚è€ƒé“¾æ¥\n\n* [WeCOS-UGC-DEMOâ€”â€”å¾®ä¿¡å°ç¨‹åºç”¨æˆ·èµ„æºä¸Šä¼ COSç¤ºä¾‹](https://github.com/tencentyun/wecos-ugc-upload-demo/blob/master/README.md)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å°ç¨‹åºå¼€å‘ï¼šä¸Šä¼ å›¾ç‰‡åˆ°è…¾è®¯äº‘",
        "date": "2017-08-27 04:17:13",
        "tags": [
          "python",
          "tutorial",
          "weixin",
          "å°ç¨‹åº",
          "swagger"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "metis-2-weapp-upload-file-to-cos"
    },
    {
      "content": "\n> è¿™æ˜¯ã€ŠCSSè®¾è®¡æŒ‡å—ã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œç”¨äºåŠ æ·±å­¦ä¹ æ•ˆæœã€‚\n\n## display å±æ€§\n\n`display`æ˜¯ CSS ä¸­æœ€é‡è¦çš„ç”¨äºæ§åˆ¶å¸ƒå±€çš„å±æ€§ã€‚æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ display å€¼ã€‚å¯¹äºå¤§å¤šæ•°å…ƒç´ å®ƒä»¬çš„é»˜è®¤å€¼é€šå¸¸æ˜¯ block æˆ– inline ã€‚ä¸€ä¸ª block å…ƒç´ é€šå¸¸è¢«å«åšå—çº§å…ƒç´ ã€‚ä¸€ä¸ª inline å…ƒç´ é€šå¸¸è¢«å«åšè¡Œå†…å…ƒç´ ã€‚\n\n#### block\n\n`div` æ˜¯ä¸€ä¸ªæ ‡å‡†çš„å—çº§å…ƒç´ ã€‚ä¸€ä¸ªå—çº§å…ƒç´ ä¼šæ–°å¼€å§‹ä¸€è¡Œå¹¶ä¸”å°½å¯èƒ½æ’‘æ»¡å®¹å™¨ã€‚å…¶ä»–å¸¸ç”¨çš„å—çº§å…ƒç´ åŒ…æ‹¬ `p` ã€ `form` å’ŒHTML5ä¸­çš„æ–°å…ƒç´ ï¼š `header` ã€ `footer` ã€ `section` ç­‰ç­‰ã€‚\n\n#### inline\n\n`img` æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è¡Œå†…å…ƒç´ ã€‚ä½ å¯ä»¥æŠŠä¸¤ä¸ª `<img>` æ ‡ç­¾å†™åœ¨ä¸¤è¡Œï¼Œä½†è¿™å¹¶ä¸å½±å“å›¾ç‰‡å†æµè§ˆå™¨ä¸­çš„æ˜¾ç¤ºæ•ˆæœï¼Œå®ƒä»¬ä¼šå¹¶åˆ—å‡ºç°åœ¨ä¸€è¡Œä¸Šã€‚è€Œä¸”æ ‡ç­¾ç›´æ¥çš„ç©ºç™½ï¼ˆæ ‡è®°ä¸­çš„ä¸¤ä¸ª<img>æ ‡ç­¾è™½ç„¶åˆ†åˆ«ä½äºä¸¤è¡Œï¼Œä½†è¿™å¹¶ä¸å½±å“å›¾ç‰‡åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºæ—¶çš„æ•ˆæœã€‚å›¾ç‰‡æ˜¯è¡Œå†…å…ƒç´ ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¾ç¤ºçš„æ—¶å€™å°±ä¼šå¹¶åˆ—å‡ºç°åœ¨ä¸€è¡Œä¸Šã€‚è€Œä¸”ï¼Œæ ‡ç­¾ä¹‹é—´çš„ç©ºç™½ï¼ˆåŒ…æ‹¬åˆ¶è¡¨ã€å›è½¦å’Œç©ºæ ¼ï¼‰éƒ½ä¼šè¢«æµè§ˆå™¨å¿½ç•¥ã€‚\n\n`a` å…ƒç´ æ˜¯æœ€å¸¸ç”¨çš„è¡Œå†…å…ƒç´ ï¼Œå®ƒå¯ä»¥è¢«ç”¨ä½œé“¾æ¥ã€‚\n\n#### none\n\nå¦ä¸€ä¸ªå¸¸ç”¨çš„ display å€¼æ˜¯ noneã€‚ä¸€äº›ç‰¹æ®Šå…ƒç´ çš„é»˜è®¤ display å€¼æ˜¯å®ƒï¼Œä¾‹å¦‚`script`ã€‚display:none é€šå¸¸è¢« JavaScript ç”¨æ¥åœ¨ä¸åˆ é™¤å…ƒç´ çš„æƒ…å†µä¸‹éšè—æˆ–æ˜¾ç¤ºå…ƒç´ ã€‚\næŠŠdisplayè®¾ç½®ä¸º noneï¼Œè¯¥å…ƒç´ åŠæ‰€æœ‰åŒ…å«åœ¨å…¶ä¸­çš„å…ƒç´ ï¼Œéƒ½ä¸ä¼šåœ¨é¡µé¢ä¸­æ˜¾ç¤ºã€‚å®ƒä»¬åŸæ¥å æ®çš„ç©ºé—´ä¹Ÿä¼šè¢«å›æ”¶ã€‚\n\n> ç›¸å¯¹çš„å±æ€§æ˜¯ `visibility`ï¼Œè¿™ä¸ªå±æ€§å¸¸ç”¨çš„å€¼æ˜¯ visibleï¼ˆé»˜è®¤ï¼‰å’Œ hiddenã€‚æŠŠå…ƒç´ çš„ visibility è®¾å®šä¸º hiddenï¼Œå…ƒç´ ä¼šéšè—ï¼Œä½†å®ƒå æ®çš„ç©ºé—´ä»ç„¶å­˜åœ¨ã€‚\n\n#### å…¶ä»– display å€¼\n\nè¿˜æœ‰å¾ˆå¤šçš„æ›´æœ‰æ„æ€çš„ display å€¼ï¼Œå‡ ä¹æ‰€æœ‰HTMLå…ƒç´ çš„displayå±æ€§å€¼è¦ä¹ˆä¸ºblockï¼Œè¦ä¹ˆä¸ºinlineã€‚æœ€æ˜æ˜¾çš„ä¸€ä¸ªä¾‹å¤–æ˜¯tableå…ƒç´ ï¼Œå®ƒæœ‰è‡ªå·±ç‰¹æ®Šçš„displayå±æ€§å€¼ã€‚[è¿™é‡Œæœ‰ä¸€ä»½è¯¦ç»†çš„åˆ—è¡¨](https://developer.mozilla.org/en-US/docs/Web/CSS/display)ã€‚\n\nå—çº§å…ƒç´ ï¼ˆæ¯”å¦‚æ ‡é¢˜å’Œæ®µè½ï¼‰ä¼šç›¸äº’å †å åœ¨ä¸€èµ·æ²¿é¡µé¢å‘ä¸‹æ’åˆ—ï¼Œæ¯ä¸ªå…ƒç´ åˆ†åˆ«å ä¸€è¡Œã€‚è€Œè¡Œå†…å…ƒç´ ï¼ˆæ¯”å¦‚é“¾æ¥å’Œå›¾ç‰‡ï¼‰åˆ™ä¼šç›¸äº’å¹¶åˆ—ï¼Œåªæœ‰åœ¨ç©ºé—´ä¸è¶³ä»¥å¹¶åˆ—çš„æƒ…å†µä¸‹æ‰ä¼šæŠ˜åˆ°ä¸‹ä¸€è¡Œæ˜¾ç¤º ã€‚\n\nå—çº§å…ƒç´ å’Œè¡Œå†…å…ƒç´ æ˜¯å¯ä»¥äº’ç›¸è½¬åŒ–çš„ï¼š\n\n```css\n/*é»˜è®¤ä¸ºå—çº§å…ƒç´ */\np {display: inline;}\n/*é»˜è®¤ä¸ºè¡Œå†…å…ƒç´ */\na {display: block;}\n```\n\nå±æ€§äº† display å±æ€§ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¡µé¢å¸ƒå±€ï¼š\n\n## å¸ƒå±€çš„åŸºæœ¬æ¦‚å¿µ\n\nå¤šæ å¸ƒå±€æœ‰ä¸‰ç§åŸºæœ¬çš„å®ç°æ–¹æ¡ˆï¼š`å›ºå®šå®½åº¦`ã€`æµåŠ¨`ã€ `å¼¹æ€§`ã€‚\n\n* å›ºå®šå®½åº¦å¸ƒå±€çš„å¤§å°ä¸ä¼šéšç”¨æˆ·è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°è€Œå˜åŒ–ï¼Œä¸€èˆ¬æ˜¯900åˆ°1100åƒç´ å®½ã€‚å…¶ä¸­960åƒç´ æ˜¯æœ€å¸¸è§çš„ï¼Œå› ä¸ºè¿™ä¸ªå®½åº¦é€‚åˆæ‰€æœ‰ç°ä»£æ˜¾ç¤ºå™¨ï¼Œè€Œä¸”èƒ½å¤Ÿè¢«16ã€12ã€10ã€8ã€6ã€5ã€4å’Œ3æ•´é™¤ï¼Œä¸ä»…å®¹æ˜“è®¡ç®—ç­‰å®½åˆ†æ çš„æ•°é‡ï¼Œè€Œä¸”è®¡ç®—ç»“æœä¹Ÿèƒ½å¾—åˆ°æ²¡æœ‰å°æ•°çš„åƒç´ æ•°ã€‚ \n\n* æµåŠ¨å¸ƒå±€çš„å¤§å°ä¼šéšç”¨æˆ·è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°è€Œå˜åŒ–ã€‚è¿™ç§å¸ƒå±€èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å¤§å±å¹•ï¼Œä½†åŒæ—¶ä¹Ÿæ„å‘³ç€æ”¾å¼ƒå¯¹é¡µé¢æŸäº›æ–¹é¢çš„æ§åˆ¶ï¼Œæ¯”å¦‚éšç€é¡µé¢å®½åº¦å˜åŒ–ï¼Œæ–‡æœ¬è¡Œçš„é•¿åº¦å’Œé¡µé¢å…ƒç´ ä¹‹é—´çš„ä½ç½®å…³ç³»éƒ½å¯èƒ½å˜åŒ–ã€‚Amazon.comçš„é¡µé¢é‡‡ç”¨çš„å°±æ˜¯æµåŠ¨ä¸­æ å¸ƒå±€ï¼Œåœ¨å„æ å®½åº¦åŠ å¤§æ—¶é€šè¿‡ä¸ºå†…å®¹å…ƒç´ å‘¨å›´æ·»åŠ ç©ºç™½æ¥ä¿æŒå†…å®¹å±…ä¸­ï¼Œè€Œä¸”ç°åœ¨çš„å¯¼èˆªæ¡ä¼šåœ¨å¸ƒå±€å˜çª„åˆ°æŸä¸ªå®½åº¦æ—¶æ”¶ç¼©è¿›ä¸€ä¸ªä¸‹æ‹‰èœå•ä¸­ï¼Œä»è€Œä¸ºå†…å®¹è…¾å‡ºç©ºé—´ã€‚\n\n* å¼¹æ€§å¸ƒå±€ä¸æµåŠ¨å¸ƒå±€ç±»ä¼¼ï¼Œåœ¨æµè§ˆå™¨çª—å£å˜å®½æ—¶ï¼Œä¸ä»…å¸ƒå±€å˜å®½ï¼Œè€Œä¸”æ‰€æœ‰å†…å®¹å…ƒç´ çš„å¤§å°ä¹Ÿä¼šå˜åŒ–ï¼Œè®©äººäº§ç”Ÿä¸€ç§æ‰€æœ‰ä¸œè¥¿éƒ½å˜å¤§äº†çš„æ„Ÿè§‰ã€‚\n\n### å¸ƒå±€çš„é«˜åº¦\n\nå¤šæ•°æƒ…å†µä¸‹ï¼Œå¸ƒå±€ä¸­ç»“æ„åŒ–å…ƒç´ ï¼ˆä¹ƒè‡³ä»»ä½•å…ƒç´ ï¼‰çš„é«˜åº¦æ˜¯ä¸å¿…è®¾å®šçš„ã€‚äº‹å®ä¸Šï¼Œæˆ‘ç”šè‡³æƒ³å‘Šè¯‰ä½ æ ¹æœ¬ä¸åº”è¯¥ç»™å…ƒç´ è®¾å®šé«˜åº¦ã€‚é™¤éä½ ç¡®å®éœ€è¦è¿™æ ·åšï¼Œæ¯”å¦‚åœ¨é¡µé¢ä¸­åˆ›é€ ä¸€ä¸ªç»å¯¹å®šä½çš„å…ƒç´ ã€‚\n\n> ä¸ºä»€ä¹ˆæ­£å¸¸æƒ…å†µä¸‹éƒ½åº”è¯¥ä¿æŒå…ƒç´ heightå±æ€§çš„é»˜è®¤å€¼autoä¸å˜å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªæœ‰è¿™æ ·å…ƒç´ æ‰èƒ½éšè‡ªå·±åŒ…å«å†…å®¹çš„å¢åŠ è€Œåœ¨å‚ç›´æ–¹å‘ä¸Šæ‰©å±•ã€‚è¿™æ ·æ‰©å±•çš„å…ƒç´ ä¼šæŠŠä¸‹æ–¹çš„å…ƒç´ å‘ä¸‹æ¨ï¼Œè€Œå¸ƒå±€ä¹Ÿèƒ½éšç€å†…å®¹æ•°é‡çš„å¢å‡è€Œå‚ç›´ä¼¸ç¼©ã€‚å‡å¦‚ä½ æ˜ç¡®è®¾å®šäº†å…ƒç´ çš„é«˜åº¦ï¼Œé‚£ä¹ˆè¶…å‡ºçš„å†…å®¹è¦ä¹ˆè¢«å‰ªæ‰ï¼Œè¦ä¹ˆä¼šè·‘åˆ°å®¹å™¨ä¹‹å¤–â€”â€”å–å†³äºå…ƒç´ overflowå±æ€§çš„è®¾å®šã€‚\n\n### å¸ƒå±€çš„å®½åº¦\n\nä¸é«˜åº¦ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦æ›´ç²¾ç»†åœ°æ§åˆ¶å¸ƒå±€å®½åº¦ï¼Œä»¥ä¾¿éšç€æµè§ˆå™¨çª—å£å®½åº¦çš„åˆç†å˜åŒ–ï¼Œå¸ƒå±€èƒ½å¤Ÿä½œå‡ºé€‚å½“çš„è°ƒæ•´ï¼Œç¡®ä¿æ–‡æœ¬è¡Œä¸ä¼šè¿‡é•¿æˆ–è¿‡çŸ­ã€‚å¦‚æœéšæ„ç»™å…ƒç´ æ·»åŠ å†…è¾¹è·ã€è¾¹æ¡†ï¼Œæˆ–è€…å…ƒç´ æœ¬èº«è¿‡å¤§ï¼Œå¯¼è‡´æµ®åŠ¨å…ƒç´ çš„å®½åº¦è¶…è¿‡åŒ…å«å…ƒç´ çš„å¸ƒå±€å®½åº¦ï¼Œé‚£æµ®åŠ¨å…ƒç´ å°±å¯èƒ½â€œèº²â€åˆ°å…¶ä»–å…ƒç´ ä¸‹æ–¹ã€‚åº”è¯¥è®©è¿™äº›å†…å®¹å…ƒç´ è‡ªåŠ¨æ‰©å±•åˆ°å¡«æ»¡æ çš„å®½åº¦ã€‚(è¿™æ˜¯å—çº§å…ƒç´ çš„é»˜è®¤è¡Œä¸º)\n\n## ä¸‰æ -å›ºå®šå®½åº¦å¸ƒå±€\n\næˆ‘ä»¬å…ˆä»ä¸€ä¸ªç®€å•çš„å±…ä¸­çš„å•æ å¸ƒå±€å¼€å§‹å§ã€‚çœ‹ä¸‹é¢ HTML ä»£ç ï¼Œä¸»è¦æ ‡è®°çš„ ID æ˜¯ wrapperï¼š\n\n```html\n<div id=\"wrapper\">\n\t<article>\n        <h1>Single-Column Layout</h1>\n        <p>è¿™æ˜¯ç¬¬ä¸€æ®µ</p>\n        <h2>This is a Second-Level Heading</h2>\n        <p>è¿™æ˜¯ç¬¬äºŒæ®µ</p>\n    </article>\n</div>\n```\nå¸ƒå±€ç›¸å…³ css å¦‚ä¸‹ï¼š\n\n```css\n#wrapper {\n\twidth:960px; margin:0 auto; border:1px solid;\n}\narticle {\n\tbackground:#ffed53;\t\n}\n```\n\n![æ•ˆæœå›¾](http://media.gusibi.mobi/ehJIyepJP3ARTLkMYIDfndpryupJA8PrXFP1MlcUdPiDuX0gfMZo8r15dRn35M9l)\n\n> å¦‚å›¾æ‰€ç¤ºï¼Œé€šè¿‡ç»™å¤–åŒ…è£…è®¾å®šå®½åº¦å€¼ï¼Œå¹¶å°†å…¶æ°´å¹³å¤–è¾¹è·è®¾å®šä¸º autoï¼Œè¿™ä¸ªå•æ å¸ƒå±€åœ¨é¡µé¢ä¸Šå±…ä¸­äº†ã€‚éšç€å‘é‡Œæ·»åŠ å†…å®¹ï¼Œè¿™ä¸€æ çš„é«˜åº¦ä¼šç›¸åº”å¢åŠ ã€‚å¤–åŒ…è£…ä¸­çš„articleå…ƒç´ æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å®½åº¦çš„å—çº§ç›’å­ï¼ˆå…³äºâ€œæ²¡æœ‰å®½åº¦çš„ç›’å­â€ï¼Œè¯·å‚è§3.2èŠ‚ï¼‰ï¼Œå®ƒæ°´å¹³æ‰©å±•å¡«æ»¡äº†å¤–åŒ…è£…ã€‚\n\nä¸‹é¢ï¼Œæˆ‘ä»¬å†å‘å¤–åŒ…è£…é‡Œæ·»åŠ ä¸€ä¸ªå¯¼èˆªå…ƒç´ ï¼Œè®©å®ƒä½œä¸ºç¬¬äºŒæ ã€‚\n\nHTML ä»£ç å¦‚ä¸‹ï¼š\n\n```html\n<div id=\"wrapper\">\n\t<nav>\n        <ul>\n            <li><a href=\"#\">Link 1</a></li>\n            <li><a href=\"#\">Link 2</a></li>\n            <li><a href=\"#\">Link 3</a></li>\n        </ul>\n    </nav>\n    <article>\n        <h1>Single-Column Layout</h1>\n        <p>è¿™æ˜¯ç¬¬ä¸€æ®µ</p>\n        <h2>This is a Second-Level Heading</h2>\n        <p>è¿™æ˜¯ç¬¬äºŒæ®µ.</p>\n    </article>\n</div>\n```\n\nè¿™é‡Œæˆ‘ä»¬å°†ä¸¤æ éƒ½æ·»åŠ `float: left`ï¼Œä»¥è®©å®ƒä»¬å¹¶æ’æ˜¾ç¤ºã€‚\n\n```css\n#wrapper {\n\twidth:960px; \n\tmargin:0 auto; \n\tborder:1px solid; \n\toverflow:hidden;\n}\nnav {\n\twidth:150px;\n\tfloat:left; /*æµ®åŠ¨*/\n\tbackground:#dcd9c0;\n\t}\nnav li {\n    /*å»æ‰åˆ—è¡¨é¡¹ç›®ç¬¦å·*/\n\tlist-style-type:none;\n\t}\narticle {\n\twidth:810px;\n\tfloat:left; /*æµ®åŠ¨*/\n\tbackground:#ffed53;\t\n\t}\n```\n![æ•ˆæœå›¾](http://media.gusibi.mobi/FJAogkzMENomRRtTqAobo1o3EiGsSSMBjhdz-4NZc2NOP0vaEjUF6br4TeZvH943)\n> è¿™é‡Œæˆ‘ä»¬æŠŠä¸¤æ çš„æ€»å®½åº¦è®¾å®šä¸ºå¤–åŒ…è£…çš„å®½åº¦ï¼ˆ150+810=960ï¼‰ï¼Œå¹¶æµ®åŠ¨å®ƒä»¬ï¼Œå°±å¯ä»¥åˆ›é€ å‡ºå¹¶è‚©æ’åˆ—çš„ä¸¤æ æ¥ã€‚æ¯ä¸€æ çš„é•¿åº¦å–å†³äºå†…å®¹å¤šå°‘ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ ç¬¬ä¸‰æ ã€‚\n\n```html\n<div id=\"wrapper\">\n\t<nav>\n        <ul>\n            <li><a href=\"#\">Link 1</a></li>\n            <li><a href=\"#\">Link 2</a></li>\n            <li><a href=\"#\">Link 3</a></li>\n        </ul>\n    </nav>\n    <article>\n        <h1>Single-Column Layout</h1>\n        <p>è¿™æ˜¯ç¬¬ä¸€æ®µ</p>\n        <h2>This is a Second-Level Heading</h2>\n        <p>è¿™æ˜¯ç¬¬äºŒæ®µ.</p>\n    </article>\n    <aside>\n        <h3>This is the Sidebar</h3>\n        <p>è¿™æ˜¯ä¾§è¾¹æ .</p>\n    </aside>\n</div>\n```\næ¥ä¸‹æ¥æˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹ article è¿™ä¸€æ çš„å®½åº¦ï¼Œä¸ºç¬¬ä¸‰æ è…¾å‡ºç©ºé—´\n\n```css\n#wrapper {\n\twidth:960px; margin:0 auto; border:1px solid; overflow:hidden;\n}\nnav {\n\twidth:150px;\n\tfloat:left;\n\tbackground:#dcd9c0;\n}\narticle {\n\twidth:600px;\n\tfloat:left;\n\tbackground:#ffed53;\t\n}\naside {\n\twidth:210px;\n\tfloat:left;\n\tbackground:#3f7ccf;\n}\n```\n\n![ä¸‰æ çš„ç¤ºæ„å›¾](http://media.gusibi.mobi/ih7NWCcRAtvH4fHkIJ26zbdTl0K378Ew4oKFbVu1y8TCUrQsqvFFruceGWPdPoaP)\n\n> å¦‚å›¾æ‰€ç¤ºï¼Œé€šè¿‡æŠŠä¸‰ä¸ªæµ®åŠ¨å®¹å™¨çš„æ€»å®½åº¦è®¾å®šä¸ºæ°å¥½ç­‰äºå¤–åŒ…è£…çš„å®½åº¦ï¼ˆ150+600+210=960ï¼‰ï¼Œå°±æœ‰äº†ä¸‰æ å¸ƒå±€çš„æ¡†æ¶ã€‚\n\nç°åœ¨æˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªé¡µçœ‰å’Œé¡µè„šï¼š\n\n```html\n<div id=\"wrapper\">\n\t<header>\n\t\t<h1>A Fixed-Width Layout</h1>\n\t</header>\n\t<nav>\n        <ul>\n            <li><a href=\"#\">Link 1</a></li>\n            <li><a href=\"#\">Link 2</a></li>\n            <li><a href=\"#\">Link 3</a></li>\n        </ul>\n    </nav>\n    <article>\n        <h1>Single-Column Layout</h1>\n        <p>è¿™æ˜¯ç¬¬ä¸€æ®µ</p>\n        <h2>This is a Second-Level Heading</h2>\n        <p>è¿™æ˜¯ç¬¬äºŒæ®µ.</p>\n    </article>\n    <aside>\n        <h3>This is the Sidebar</h3>\n        <p>è¿™æ˜¯ä¾§è¾¹æ .</p>\n    </aside>\n   \t<footer>\n        <p>This is the footer. Phasellus pretium gravida interdum. Nam interdum posuere tempus. Ut commodo laoreet dolor, non hendrerit mi dictum vitae. Nam nec egestas libero.</p>\n    </footer>\n</div>\n```\nä¸ºäº†è®©é¡µè„šåœ¨æœ€ä¸‹ä¸€æ ä¸æµ®åŠ¨åˆ° `aside` åè¾¹ï¼Œæˆ‘ä»¬ä¸ºé¡µè„šåº”ç”¨`clear:both`ï¼Œä»¥ç»„ç»‡å®ƒå‘ä¸Šç§»åŠ¨ã€‚\ncss æ ·å¼å¦‚ä¸‹ï¼š\n\n```css\n* {margin:0; padding:0;} \n#wrapper {\n    width:960px;\n    margin:0 auto;\n    border:1px solid;\n} \nheader {\n    background:#f00;\n} \nnav {\n    width:150px;\n    float:left;\n    background:#dcd9c0;\n} \nnav li {\n    list-style-type:none;\n} \narticle {\n    width:600px;\n    float:left;\n    background:#ffed53;\n}\naside {\n    width:210px;\n    float:left;\n    background:#3f7ccf;\n} \nfooter {\n    clear:both;\n    background:#000;\n}\n```\nç°åœ¨æ•ˆæœå¦‚å›¾ï¼š\n![ä¸‰æ +é¡µçœ‰+é¡µè„šçš„æ•ˆæœå›¾](http://media.gusibi.mobi/qGmwPd79PzMw_N-UcZFSj8teXyQ11LnBN_r5aeExPp44vtBtZ4YGYRNor_Pp2bfq)\n\nç°åœ¨å„æ å¤ªæ‹¥æŒ¤ï¼Œæ¯æ çš„é«˜åº¦ä¹Ÿéƒ½ç”±æ–‡æœ¬å†…å®¹å†³å®šï¼Œæˆ‘ä»¬ç°åœ¨ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸ºå†…å®¹é—´åŠ ä¸Šç©ºç™½ã€‚\n\n### ä¸ºæ è®¾å®šå†…è¾¹è·å’Œè¾¹è·\n\nä¸ºäº†è®©å†…å®¹ä¸æ è¾¹ç•Œç©ºå¼€è·ç¦»ï¼Œä¸ºæ æ·»åŠ æ°´å¹³å¤–è¾¹è·å’Œå†…è¾¹è·ï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´å¸ƒå±€å®½åº¦å¢å¤§ï¼Œè¿›è€Œæµ®åŠ¨æ ä¸‹æ»‘ã€‚\næ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™ article å¢åŠ å†…è¾¹è·ï¼š\n\n```css\narticle {\n    width: 600px;\n    float: left;\n    background: #ffed53;\n    padding: 10px 20px;\n}\n```\næ•ˆæœå¦‚å›¾ï¼š\n\n![article å¢åŠ å†…è¾¹è·åçš„æ•ˆæœå›¾](http://media.gusibi.mobi/rjwewoLYNvkPSRnwJYZJTCUqZLYpsDr6P1oFgWe0X3fdQDdApeNcrKvb07jQw4AR)\n\nç”±äºå¢åŠ äº†å†…è¾¹è·å¯¼è‡´`article`çš„æ€»å®½åº¦å¢åŠ ï¼Œå¯¼è‡´å³è¾¹çš„æ ä¸èƒ½å†ä¸å‰ä¸¤æ’å¹¶åˆ—åœ¨ä¸€èµ·ã€‚æœ‰ä¸‰ç§æ–¹æ³•æ¥é¢„é˜²æ”¹é—®é¢˜å‘ç”Ÿï¼š\n\n* ä»è®¾å®šçš„å…ƒç´ å®½åº¦ä¸­å‡å»æ·»åŠ çš„æ°´å¹³å¤–è¾¹è·ã€è¾¹æ¡†å’Œå†…è¾¹è·çš„å®½åº¦å’Œã€‚ \n* åœ¨å®¹å™¨å†…éƒ¨çš„å…ƒç´ ä¸Šæ·»åŠ å†…è¾¹è·æˆ–å¤–è¾¹è·ã€‚ \n* ä½¿ç”¨CSS3çš„box-sizingå±æ€§åˆ‡æ¢ç›’å­ç¼©æ”¾æ–¹å¼ï¼Œæ¯”å¦‚section {box-sizing:border-box;} ã€‚ åº”ç”¨box-sizingå±æ€§åï¼Œç»™sectionæ·»åŠ è¾¹æ¡†å’Œå†…è¾¹è·éƒ½ä¸ä¼šå¢å¤§ç›’å­ï¼Œç›¸åä¼šå¯¼è‡´å†…å®¹å˜çª„ã€‚\n\n### é‡è®¾å®½åº¦ä»¥æŠµæ¶ˆå†…è¾¹è·å’Œè¾¹æ¡†\n\nä¸€ä¸ªä»£ä»£ç›¸ä¼ çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡æ•°å­¦è®¡ç®—ã€‚CSSå¼€å‘è€…éœ€è¦ç”¨æ¯”ä»–ä»¬å®é™…æƒ³è¦çš„å®½åº¦å°ä¸€ç‚¹çš„å®½åº¦ï¼Œéœ€è¦å‡å»å†…è¾¹è·å’Œè¾¹æ¡†çš„å®½åº¦ã€‚`æ¯”å¦‚æˆ‘ä»¬ç»™600åƒç´ å®½çš„ä¸­é—´æ å¢åŠ äº†20åƒç´ çš„å†…è¾¹è·ï¼Œä¸ºäº†æŠµæ¶ˆå¢åŠ çš„å†…è¾¹è·ï¼Œå¯ä»¥æŠŠæ å‡å°‘40åƒç´ è€Œè®¾å®šä¸º560åƒç´ ã€‚`å€¼å¾—åº†å¹¸åœ°æ˜¯ä½ ä¸éœ€è¦å†è¿™ä¹ˆåšäº†...\n\n### ç»™å®¹å™¨å†…éƒ¨å…ƒç´ åº”ç”¨å†…è¾¹è·å’Œè¾¹æ¡†\n\næŠŠå¤–è¾¹è·å’Œå†…è¾¹è·åº”ç”¨åˆ°å†…å®¹å…ƒç´ ä¸Šç¡®å®æœ‰æ•ˆï¼Œä¸è¿‡è¿™æ ·çš„å‰ææ˜¯è¿™äº›å…ƒç´ æ²¡æœ‰æ˜ç¡®çš„è®¾å®šå®½åº¦ï¼Œè¿™æ ·å†…å®¹æ‰ä¼šéšå†…å¤–è¾¹è·çš„å¢åŠ è€Œç¼©å°ã€‚\nä¸å…¶ä¸ºå®¹å™¨ä¸­çš„å…ƒç´ æ·»åŠ å¤–è¾¹è·ï¼Œä¸å¦‚åœ¨æ ä¸­å†æ·»åŠ ä¸€ä¸ªæ²¡æœ‰å®½åº¦çš„divï¼Œè®©å®ƒåŒ…å«æ‰€æœ‰å†…å®¹å…ƒç´ ï¼Œç„¶åå†ç»™è¿™ä¸ªdivåº”ç”¨è¾¹æ¡†å’Œå†…è¾¹è·ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œåªè¦ä¸ºå†…éƒ¨divè®¾å®šä¸€æ¬¡æ ·å¼ï¼Œå°±å¯ä»¥æŠŠè®©æ‰€æœ‰å†…å®¹å…ƒç´ ä¸æ è¾¹ç•Œä¿æŒä¸€è‡´çš„è·ç¦»ã€‚è€Œä¸”ï¼Œå°†æ¥å†éœ€è¦è°ƒæ•´æ—¶ä¹Ÿä¼šå¾ˆæ–¹ä¾¿ã€‚ä»»ä½•æ–°å¢å†…å®¹å…ƒç´ çš„å®½åº¦éƒ½ç”±è¿™ä¸ªå†…éƒ¨divå†³å®šã€‚\n\nä¸‹é¢æˆ‘ä»¬ç”¨è¿™ç§æ–¹æ³•ä¿®å¤ä¸Šé¢ç¬¬ä¸‰æ æµ®åŠ¨åˆ°ä¸‹è¾¹çš„é—®é¢˜ã€‚\n\n```html\n<article>\n    <div class=\"inner\">\n    <!-- è¿™é‡Œæ˜¯å„ç§å†…å®¹ -->\n    </div>\n</article>\n```\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ä»…è¦ç»™å†…éƒ¨ div åº”ç”¨å†…è¾¹è·ï¼Œè¿˜è¦ç»™å¥¹åº”ç”¨å¤–è¾¹è·å’Œè¾¹æ¡†ã€‚\n\n```css\n/*æ›´æ–° css*/\narticle {\n\twidth:600px;\n\tfloat:left;\n\tbackground:#ffed53;\n}\narticle .inner {\n\tmargin:10px; \n\tborder:2px solid red;\n\tpadding:20px; \n}\n```\n\næ•ˆæœå¦‚å›¾ï¼š\n![ç»™å®¹å™¨å†…éƒ¨å…ƒç´ åº”ç”¨å†…è¾¹è·å’Œè¾¹æ¡†çš„ç¤ºä¾‹å›¾](http://media.gusibi.mobi/rQINy0ZYV9tT-nU7LJPlfY-RqwcDLA7n5PdZzdEEa-eGPz43J0G40nnLbbYvycAa)\n\nä»¥ä¸Šæªæ–½ä½¿å¸ƒå±€æœ‰äº†æ˜æ˜¾æ”¹è§‚ã€‚å°±è¿™ä¹ˆç®€å•çš„å‡ ä¸‹ï¼Œå¸ƒå±€å°±æ˜¾å¾—æ›´ä¸“ä¸šäº†ã€‚å¤„ç†æ åŠå…¶å†…éƒ¨divçš„å…³é”®åœ¨äºï¼Œæµ®åŠ¨æ å¹¶è®¾å®šæ å®½ï¼Œä½†ä¸ç»™ä»»ä½•å†…å®¹å…ƒç´ è®¾å®šå®½åº¦ã€‚è¦è®©å†…å®¹å…ƒç´ æ‰©å±•ä»¥å¡«å……å®ƒä»¬çš„çˆ¶å…ƒç´ â€”â€”å†…éƒ¨divã€‚è¿™æ ·ï¼Œåªè¦ç®€å•åœ°è®¾å®šå†…éƒ¨divçš„å¤–è¾¹è·å’Œå†…è¾¹è·ï¼Œå°±å¯ä»¥è®©å®ƒä»¬ä»¥åŠå®ƒä»¬åŒ…å«çš„å†…å®¹ä¸æ è¾¹ç•Œä¿æŒä¸€å®šè·ç¦»ã€‚\n\n### ä½¿ç”¨ box-sizing:border-box\n\näººä»¬æ…¢æ…¢çš„æ„è¯†åˆ°ä¼ ç»Ÿçš„ç›’å­æ¨¡å‹ä¸ç›´æ¥ï¼Œæ‰€ä»¥ä»–ä»¬æ–°å¢äº†ä¸€ä¸ªå«åš box-sizing çš„CSSå±æ€§ã€‚å½“ä½ è®¾ç½®ä¸€ä¸ªå…ƒç´ ä¸º box-sizing: border-box; æ—¶ï¼Œæ­¤å…ƒç´ çš„å†…è¾¹è·å’Œè¾¹æ¡†ä¸å†ä¼šå¢åŠ å®ƒçš„å®½åº¦ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¸å‰ä¸€é¡µç›¸åŒçš„ä¾‹å­ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ä¸¤ä¸ªå…ƒç´ éƒ½è®¾ç½®äº† box-sizing: border-box; \n\n```css\nnav {\n\t-webkit-box-sizing:border-box;\n    -moz-box-sizing:border-box;\n\tbox-sizing:border-box;\n\twidth:150px;\n\tfloat:left;\n\tbackground:#dcd9c0;\n\tpadding:10px 10px;\n\t}\narticle {\n\t-webkit-box-sizing:border-box;\n    -moz-box-sizing:border-box;\n\tbox-sizing:border-box;\n\twidth:600px;\n\tfloat:left;\n\tbackground:#ffed53;\t\n\tpadding:10px 20px;\n}\naside {\n    -webkit-box-sizing:border-box;\n    -moz-box-sizing:border-box;\n\tbox-sizing:border-box;\n\twidth:210px;\n\tfloat:left;\n\tbackground:#3f7ccf;\n\tpadding:10px 10px;\n}\n```\n\n![ä½¿ç”¨ box-sizing: border-box; çš„æ•ˆæœå›¾](http://media.gusibi.mobi/W72nR0pZ9isuBunBOxwMX5O1fnacmxEZdNSTQkT0uDPm_87znZleYhehw83kslGH)\n\nè¿™æ˜¯ç›®å‰ä¸ºæ­¢æœ€å¥½çš„è§£å†³æ–¹æ³•äº†ï¼Œé‚£æœ€ç®€å•æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯åœ¨ css é‡Œæ·»åŠ è¿™æ ·ä¸€æ¡è§„åˆ™ï¼š\n\n```css\n* {\n    -webkit-box-sizing:border-box;\n    -moz-box-sizing:border-box;\n    box-sizing:border-box;        \n    }\n```\n## ä¸‰æ -ä¸­æ æµåŠ¨å¸ƒå±€\n\nä¸­æ æµåŠ¨å¸ƒå±€çš„ç›®çš„æ˜¯åœ¨å±å¹•å˜çª„æ—¶ï¼Œä¸­æ å˜çª„ï¼Œå·¦æ å’Œå³æ å®½åº¦ä¸å˜ã€‚\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`è´Ÿå¤–è¾¹è·`å®ç°ã€‚\n\n### ç”¨è´Ÿå¤–è¾¹è·å®ç°\n\nå®ç°ä¸‰æ å¸ƒå±€ä¸”è®©ä¸­æ å†…å®¹åŒºæµåŠ¨ï¼ˆä¸å›ºå®šï¼‰çš„æ ¸å¿ƒé—®é¢˜æ˜¯å¤„ç†å³æ çš„å®šä½ï¼Œå¹¶åœ¨ä¸­æ å†…å®¹åŒºå¤§å°æ”¹å˜æ—¶æ§åˆ¶å³æ ä¸å¸ƒå±€çš„å…³ç³»ã€‚\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`Ryan Brill`ç»™å‡ºçš„æ§åˆ¶ä¸¤ä¸ªå¤–åŒ…è£…å®¹å™¨çš„å¤–è¾¹è·çš„è§£å†³æ–¹æ¡ˆã€‚å…¶ä¸­ä¸€ä¸ªå¤–åŒ…è£…åŒ…å›´ä¸‰æ ï¼Œå¦ä¸€ä¸ªå¤–ä¿éšœåŒ…å›´å·¦æ å’Œä¸­æ ã€‚\n\nhtmlä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š\n```html\n<div id=\"main_wrapper\">\n    <header>\n        <!-- é¡µçœ‰-->\n    </header>\n    <div id=\"threecolwrap\">/*ä¸‰æ å¤–åŒ…è£…ï¼ˆåŒ…å›´å…¨éƒ¨ä¸‰æ ï¼‰*/\n        <div id=\"twocolwrap\">/*ä¸¤æ å¤–åŒ…è£…ï¼ˆåŒ…å›´å·¦æ å’Œä¸­æ ï¼‰*/ /*å·¦æ */\n            <nav>\n                <!-- å¯¼èˆª -->\n            </nav> /*ä¸­æ */\n            <article>\n                <!-- åŒºå— -->\n            </article>\n        </div>/*ç»“æŸä¸¤æ å¤–åŒ…è£…ï¼ˆtwocolwrapï¼‰*/ /*å³æ */\n        <aside>\n            <!-- ä¾§æ  -->\n        </aside>\n    </div>/*ç»“æŸä¸‰æ å¤–åŒ…è£…ï¼ˆthreecolwrapï¼‰*/\n    <footer>\n        <!-- é¡µè„š -->\n    </footer>\n</div> \n```\ncssè§„åˆ™å¦‚ä¸‹ï¼š\n\n```css\n* {\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    font: 1em helvetica, arial, sans-serif;\n}\n\ndiv#main_wrapper {\n    min-width: 600px;\n    max-width: 1100px;\n    /*è¶…è¿‡æœ€å¤§å®½åº¦æ—¶ï¼Œå±…ä¸­å¸ƒå±€*/\n    margin: 0 auto;\n    /*èƒŒæ™¯å›¾ç‰‡é»˜è®¤ä»å·¦ä¸Šè§’å¼€å§‹æ‹¼æ¥*/\n    background: url(images/bg_tile_150pxw.png) repeat-y #eee;\n}\n\nheader {\n    padding: 5px 10px;\n    background: #3f7ccf;\n}\n\ndiv#threecolwrap {\n    /*æµ®åŠ¨å¼ºåˆ¶å®ƒåŒ…å›´æµ®åŠ¨çš„æ */\n    float: left;\n    width: 100%;\n    /*èƒŒæ™¯å›¾ç‰‡å³å¯¹é½*/\n    background: url(images/bg_tile_210pxw.png) top right repeat-y;\n}\n\ndiv#twocolwrap {\n    /*æµ®åŠ¨å¼ºåˆ¶å®ƒåŒ…å›´æµ®åŠ¨çš„æ */\n    float: left;\n    width: 100%;\n    /*æŠŠå³æ æ‹‰åˆ°åŒºå—å¤–è¾¹è·è…¾å‡ºçš„ä½ç½®ä¸Š*/\n    margin-right: -210px;\n}\n\nnav {\n    float: left;\n    width: 150px;\n    background: #f00;\n    padding: 20px 0;\n}\n\n/*è®©å­å…ƒç´ ä¸æ è¾¹ç•Œä¿æŒä¸€å®šè·ç¦»*/\n\nnav>* {\n    margin: 0 10px;\n}\n\narticle {\n    width: auto;\n    margin-left: 150px;\n    /*åœ¨æµåŠ¨å±…ä¸­çš„æ å³ä¾§è…¾å‡ºç©ºé—´*/\n    margin-right: 210px;\n    background: #eee;\n    padding: 20px 0;\n}\n\n/*è®©å­å…ƒç´ ä¸æ è¾¹ç•Œä¿æŒä¸€å®šè·ç¦»*/ \narticle>* {\n    margin: 0 20px;\n}\n\naside {\n    float: left;\n    width: 210px;\n    background: #ffed53;\n    padding: 20px 0;\n}\n\n/*è®©å­å…ƒç´ ä¸æ è¾¹ç•Œä¿æŒä¸€å®šè·ç¦»*/ \naside>* {\n    margin: 0 10px;\n}\n\nfooter {\n    clear: both;\n    width: 100%;\n    text-align: center;\n    background: #000;\n}\n```\n![å®½å±æ•ˆæœ](http://media.gusibi.mobi/DMdD7nQ_BMk1Q8tQMwYgnu6BJDVM_BZMRx5C1sUUVj1AtFFb5EkD9aEshr-qDEhb)\n![çª„å±æ•ˆæœ](http://media.gusibi.mobi/9S7ij-86f1AF6eV7jOziitveLNrUpbO_untKwE4uofOXyvE5UrVvxY_1DEnVzp50)\n\n> `åŸºæœ¬åŸç†ï¼š`ä¸Šé¢ä¸¤å¹…å›¾å±•ç¤ºäº†æµåŠ¨ä¸­æ å¸ƒå±€ã€‚ä¸‰æ ä¸­çš„å³æ æ˜¯210åƒç´ å®½ã€‚ä¸ºäº†ç»™å³æ è…¾å‡ºç©ºé—´ï¼Œä¸­æ articleå…ƒç´ æœ‰ä¸€ä¸ª210åƒç´ çš„å³å¤–è¾¹è·ã€‚åŒ…å›´å·¦æ å’Œä¸­æ çš„ä¸¤æ å¤–åŒ…è£…ä¸Š210åƒç´ çš„è´Ÿå³å¤–è¾¹è·ï¼Œä¼šæŠŠå³æ æ‹‰å›articleå…ƒç´ å³å¤–è¾¹è·ï¼ˆåœ¨ä¸¤æ å¤–åŒ…è£…å†…éƒ¨å³ä¾§ï¼‰åˆ›é€ çš„ç©ºé—´å†…ã€‚ä¸­æ aticleå…ƒç´ çš„å®½åº¦æ˜¯autoï¼Œå› æ­¤å®ƒä»ç„¶ä¼šåŠ›æ±‚å æ®æµ®åŠ¨å·¦æ å‰©ä½™çš„æ‰€æœ‰ç©ºé—´ã€‚å¯æ˜¯ï¼Œä¸€æ–¹é¢å®ƒè‡ªå·±çš„å³å¤–è¾¹è·åœ¨ä¸¤æ å¤–åŒ…è£…å†…ä¸ºå³æ è…¾å‡ºäº†ç©ºé—´ï¼Œå¦ä¸€æ–¹é¢ä¸¤æ å¤–åŒ…è£…çš„è´Ÿå³å¤–è¾¹è·åˆæŠŠå³æ æ‹‰åˆ°äº†è¯¥ç©ºé—´å†…ã€‚\n\n### ç™¾åˆ†æ¯”å®½åº¦\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†`ç™¾åˆ†æ¯”å®½åº¦`ï¼Œç™¾åˆ†æ¯”æ˜¯ä¸€ç§ç›¸å¯¹äºåŒ…å«å—çš„è®¡é‡å•ä½ã€‚ä½ è¿˜èƒ½åŒæ—¶ä½¿ç”¨ min-width å’Œ max-width æ¥é™åˆ¶æœ€å¤§æˆ–æœ€å°å®½åº¦ï¼\n\nä½ å¯ä»¥ç”¨ç™¾åˆ†æ¯”åšå¸ƒå±€ï¼Œä½†æ˜¯è¿™éœ€è¦æ›´å¤šçš„å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬ä¸Šè¾¹çš„ä¾‹å­ä¸­ nav ç”¨ç™¾åˆ†æ¯”å®½åº¦åšå¸ƒå±€ï¼Œå½“çª—å£å®½åº¦å¾ˆçª„æ—¶ nav çš„å†…å®¹ä¼šä»¥ä¸€ç§ä¸å¤ªå‹å¥½çš„æ–¹å¼è¢«åŒ…è£¹èµ·æ¥ã€‚\n\n## inline-block å¸ƒå±€\n\nä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å®ç°å¤šæ å¹¶åˆ—çš„æ–¹å¼æ˜¯ä½¿ç”¨`float`ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`inline-block`ã€‚ä¸‹è¾¹æ˜¯æˆ‘ä»¬æŠŠ float æ›¿æ¢ä¸º`inline-block` çš„ä¾‹å­ã€‚\n\n```css\nnav {\n\twidth:150px;\n    display: inline-block;\n    vertical-align: top;\n\tbackground:#dcd9c0;\n\t}\narticle {\n    word-spacing:0;\n\twidth:600px;\n    display: inline-block;\n    vertical-align: top;\n\tbackground:#ffed53;\t\n\t}\naside {\n    word-spacing:0;\n\twidth:210px;\n    display: inline-block;\n    vertical-align: top;\n\tbackground:#3f7ccf;\n\t}\n```\n\nä½¿ç”¨`inline-block`ï¼Œæœ‰ä¸€äº›äº‹æƒ…éœ€è¦ä½ ç‰¢è®°ï¼š\n* vertical-align å±æ€§ä¼šå½±å“åˆ° inline-block å…ƒç´ ï¼Œä½ å¯èƒ½ä¼šæŠŠå®ƒçš„å€¼è®¾ç½®ä¸º top ã€‚\n* ä½ éœ€è¦è®¾ç½®æ¯ä¸€åˆ—çš„å®½åº¦\n* å¦‚æœHTMLæºä»£ç ä¸­å…ƒç´ ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œé‚£ä¹ˆåˆ—ä¸åˆ—ä¹‹é—´ä¼šäº§ç”Ÿç©ºéš™\n\nç‰¹åˆ«æ˜¯ç¬¬ä¸‰æ¡ï¼Œå¦‚æœæˆ‘ä»¬ä¸åšä»»ä½•ä¿®æ”¹ï¼Œä¸¤ä¸ª block ä¹‹é—´ä¼šå­˜åœ¨ç©ºæ ¼ï¼Œåƒè¿™æ ·ï¼š\n\n![åˆ—ä¸åˆ—ä¹‹é—´æœ‰ç©ºæ ¼](http://media.gusibi.mobi/8uHhpJiVoVCzg007mXBb2vHjceIB8Ja4Irws_AvxpE07QhjH360KZhiFniFMpmzr)\n\nå› ä¸ºåˆ—ä¸åˆ—ä¹‹é—´äº§ç”Ÿäº†ç©ºæ ¼ï¼Œæ‰€ä»¥ aside è·‘åˆ°äº†ä¸‹è¾¹ã€‚è¿™é‡Œæœ€ç®€å•çš„è§£å†³åŠæ³•æ˜¯ï¼š\n\n```html\n<nav>\nå¯¼èˆª\n</nav><article>\nå†…å®¹\n</article><aside>\nç¬¬ä¸‰æ \n</aside>\n```\n\nå…¶ä»–è§£å†³æ–¹æ¡ˆå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  [Fighting the Space Between Inline Block Elements](https://css-tricks.com/fighting-the-space-between-inline-block-elements/)\n\n## å…¶ä»–å¸ƒå±€æ–¹å¼\n\nåˆæ¬¡ä¹‹å¤–ï¼Œcss è¿˜æä¾›äº† `column`ã€`flexbox`ç­‰å¸ƒå±€æ–¹å¼ï¼Œè¿™äº›ä»¥åæœ‰æœºä¼šå†ä»‹ç»å§ã€‚\n\n## æ€»ç»“\n\nè¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº†ç”¨æµ®åŠ¨çš„æœ‰å®½åº¦çš„å…ƒç´ æ¥åˆ›å»ºå¤šæ å¸ƒå±€ã€å¦‚ä½•è®©å›ºå®šå¸ƒå±€åœ¨é¡µé¢ä¸Šå±…ä¸­ä»¥åŠè®©å®ƒä»¬åœ¨ä¸€å®šèŒƒå›´å†…å¯ä»¥ä¼¸ç¼©ã€‚åŒæ—¶ä¹Ÿäº†è§£äº†å¦‚ä½•ä½¿ç”¨å†…éƒ¨divåœ¨æµ®åŠ¨å…ƒç´ ä¸­ç”Ÿæˆé—´è·ï¼Œè€Œåˆä¸ä¼šæ”¹å˜å¸ƒå±€çš„æ€»å®½åº¦ã€‚\n\n## å‚è€ƒé“¾æ¥\n* [CSSå…¥é—¨æŒ‡å—-2ï¼šç›’å­æ¨¡å‹ã€æµ®åŠ¨å’Œæ¸…é™¤](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752018&idx=1&sn=6915e4f11ba08fa196a64375224cd92e&chksm=80b0b878b7c7316e1a065ae991c534cc11ca5fe72b33690a98fb1c3f6f53f8c98c4c8744cd3a#rd)\n* [CSSå…¥é—¨æŒ‡å—-3ï¼šå®šä½å…ƒç´ ](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752022&idx=1&sn=a37d1ec3bab1d8188ae6ae45b1b1a211&chksm=80b0b87cb7c7316ac3dcf29669d83f84300f1d85f8262848519ab1a37d754846b8eb482be436#rd)\n* [å­¦ä¹ CSSå¸ƒå±€](http://zh.learnlayout.com)\n* [Fighting the Space Between Inline Block Elements](https://css-tricks.com/fighting-the-space-between-inline-block-elements/)\n* [Flex å¸ƒå±€æ•™ç¨‹ï¼šè¯­æ³•ç¯‡](http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html)\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "CSSå…¥é—¨æŒ‡å—-4ï¼šé¡µé¢å¸ƒå±€",
        "date": "2017-08-10 14:36:53",
        "tags": [
          "css",
          "è¯»ä¹¦ç¬”è®°",
          "html",
          "tutorial",
          "å‰ç«¯"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "css-learing-4-page-layout"
    },
    {
      "content": "\nå¼€å‘å¾®ä¿¡å°ç¨‹åºæ—¶ï¼Œæ¥å…¥å°ç¨‹åºçš„æˆæƒç™»å½•å¯ä»¥å¿«é€Ÿå®ç°ç”¨æˆ·æ³¨å†Œç™»å½•çš„æ­¥éª¤ï¼Œæ˜¯å¿«é€Ÿå»ºç«‹ç”¨æˆ·ä½“ç³»çš„é‡è¦ä¸€æ­¥ã€‚è¿™ç¯‡æ–‡ç« å°†ä»‹ç» python + sanic + å¾®ä¿¡å°ç¨‹åºå®ç°ç”¨æˆ·å¿«é€Ÿæ³¨å†Œç™»å½•å…¨æ ˆæ–¹æ¡ˆã€‚\n\n**å¾®ä¿¡å°ç¨‹åºç™»å½•æ—¶åºå›¾å¦‚ä¸‹ï¼š**\n\n![ç™»å½•æ—¶åºå›¾](http://media.gusibi.mobi/_5HFdz7B13G7D1rN0hnqAvRwE_tLPZCQc_7YHkBID_zHVzVxzLClBPr9DPnufdSf)\n\nè¿™ä¸ªæµç¨‹åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š\n1. å°ç¨‹åºä½¿ç”¨ wx.login() API è·å– codeï¼Œè°ƒç”¨ wx.getUserInfo() API è·å– encryptedData å’Œ ivï¼Œç„¶åå°†è¿™ä¸‰ä¸ªä¿¡æ¯å‘é€ç»™ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ã€‚\n2. ç¬¬ä¸‰æ–¹æœåŠ¡å™¨è·å–åˆ° codeã€encryptedDataå’Œ iv åï¼Œä½¿ç”¨ code æ¢å– session_keyï¼Œç„¶åå°† session_key åˆ©ç”¨ encryptedData å’Œ iv è§£å¯†åœ¨æœåŠ¡ç«¯è·å–ç”¨æˆ·ä¿¡æ¯ã€‚æ ¹æ®ç”¨æˆ·ä¿¡æ¯è¿”å› jwt æ•°æ®ï¼Œå®Œæˆç™»å½•ã€‚\n\nä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å°ç¨‹åºæä¾›çš„ APIã€‚\n\n## å°ç¨‹åºç™»å½• API\n\nåœ¨è¿™ä¸ªæˆæƒç™»å½•çš„è¿‡ç¨‹ä¸­ï¼Œç”¨åˆ°çš„ API å¦‚ä¸‹ï¼š\n\n* wx.login\n* wx.getUserInfo\n\n`wx.chekSession` æ˜¯å¯é€‰çš„ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç”¨åˆ°ã€‚\n\n### wx.login(OBJECT)\n\nè°ƒç”¨æ­¤æ¥å£å¯ä»¥è·å–ç™»å½•å‡­è¯ï¼ˆcodeï¼‰ï¼Œä»¥ç”¨æ¥æ¢å–ç”¨æˆ·ç™»å½•æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼ˆopenidï¼‰ åŠæœ¬æ¬¡ç™»å½•çš„ ä¼šè¯å¯†é’¥ï¼ˆsession_keyï¼‰ã€‚\n\nå¦‚æœæ¥å£è°ƒç”¨æˆåŠŸï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š\n\nå‚æ•°å | ç±»å‹ | è¯´æ˜\n------|------|------\nerrMsg |String| è°ƒç”¨ç»“æœ\ncode  |String| ç”¨æˆ·å…è®¸ç™»å½•åï¼Œå›è°ƒå†…å®¹ä¼šå¸¦ä¸Š codeï¼ˆæœ‰æ•ˆæœŸäº”åˆ†é’Ÿï¼‰ï¼Œå¼€å‘è€…éœ€è¦å°† code å‘é€åˆ°å¼€å‘è€…æœåŠ¡å™¨åå°ï¼Œä½¿ç”¨code æ¢å– session_key apiï¼Œå°† code æ¢æˆ openid å’Œ session_key\n\n#### code æ¢å– session_key \n\nå¼€å‘è€…æœåŠ¡å™¨ä½¿ç”¨ç™»å½•å‡­è¯ code è·å– session_key å’Œ openidã€‚å…¶ä¸­ session_key æ˜¯å¯¹ç”¨æˆ·æ•°æ®è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥ã€‚ä¸ºäº†è‡ªèº«åº”ç”¨å®‰å…¨ï¼Œsession_key ä¸åº”è¯¥åœ¨ç½‘ç»œä¸Šä¼ è¾“ã€‚æ‰€ä»¥è¿™ä¸€æ­¥åº”è¯¥åœ¨æœåŠ¡å™¨ç«¯å®ç°ã€‚\n\n### wx.getUserInfo\n\næ­¤æ¥å£ç”¨æ¥è·å–ç”¨æˆ·ä¿¡æ¯ã€‚\n\n> å½“ `withCredentials` ä¸º true æ—¶ï¼Œè¦æ±‚æ­¤å‰æœ‰è°ƒç”¨è¿‡ wx.login ä¸”ç™»å½•æ€å°šæœªè¿‡æœŸï¼Œæ­¤æ—¶è¿”å›çš„æ•°æ®ä¼šåŒ…å« encryptedData, iv ç­‰æ•æ„Ÿä¿¡æ¯ï¼›å½“ withCredentials ä¸º false æ—¶ï¼Œä¸è¦æ±‚æœ‰ç™»å½•æ€ï¼Œè¿”å›çš„æ•°æ®ä¸åŒ…å« encryptedData, iv ç­‰æ•æ„Ÿä¿¡æ¯ã€‚\n\næ¥å£success æ—¶è¿”å›å‚æ•°å¦‚ä¸‹ï¼š\n\nå‚æ•°å | ç±»å‹ | è¯´æ˜\n------|------|------\nuserInfo |\tOBJECT|\tç”¨æˆ·ä¿¡æ¯å¯¹è±¡ï¼Œä¸åŒ…å« openid ç­‰æ•æ„Ÿä¿¡æ¯\nrawData\t| String |\tä¸åŒ…æ‹¬æ•æ„Ÿä¿¡æ¯çš„åŸå§‹æ•°æ®å­—ç¬¦ä¸²ï¼Œç”¨äºè®¡ç®—ç­¾åã€‚\nsignature | \tString |\tä½¿ç”¨ sha1( rawData + sessionkey ) å¾—åˆ°å­—ç¬¦ä¸²ï¼Œç”¨äºæ ¡éªŒç”¨æˆ·ä¿¡æ¯ï¼Œå‚è€ƒæ–‡æ¡£ signatureã€‚\nencryptedData\t|String |\tåŒ…æ‹¬æ•æ„Ÿæ•°æ®åœ¨å†…çš„å®Œæ•´ç”¨æˆ·ä¿¡æ¯çš„åŠ å¯†æ•°æ®ï¼Œè¯¦ç»†è§åŠ å¯†æ•°æ®è§£å¯†ç®—æ³•\niv\t| String\t| åŠ å¯†ç®—æ³•çš„åˆå§‹å‘é‡ï¼Œè¯¦ç»†è§åŠ å¯†æ•°æ®è§£å¯†ç®—æ³•\n\n`encryptedData` è§£å¯†åä¸ºä»¥ä¸‹ json ç»“æ„ï¼Œè¯¦è§åŠ å¯†æ•°æ®è§£å¯†ç®—æ³•\n\n```json\n{\n    \"openId\": \"OPENID\",\n    \"nickName\": \"NICKNAME\",\n    \"gender\": GENDER,\n    \"city\": \"CITY\",\n    \"province\": \"PROVINCE\",\n    \"country\": \"COUNTRY\",\n    \"avatarUrl\": \"AVATARURL\",\n    \"unionId\": \"UNIONID\",\n    \"watermark\":\n    {\n        \"appid\":\"APPID\",\n    \"timestamp\":TIMESTAMP\n    }\n}\n```\n\n> ç”±äºè§£å¯† encryptedData éœ€è¦ session_key å’Œ iv æ‰€ä»¥ï¼Œåœ¨ç»™æœåŠ¡å™¨ç«¯å‘é€æˆæƒéªŒè¯çš„è¿‡ç¨‹ä¸­éœ€è¦å°† codeã€encryptedData å’Œ iv ä¸€èµ·å‘é€ã€‚\n\n## æœåŠ¡å™¨ç«¯æä¾›çš„ API\n\næœåŠ¡å™¨ç«¯æˆæƒéœ€è¦æä¾›ä¸¤ä¸ª APIï¼š\n\n1. /oauth/token é€šè¿‡å°ç¨‹åºæä¾›çš„éªŒè¯ä¿¡æ¯è·å–æœåŠ¡å™¨è‡ªå·±çš„ token\n2. /accounts/wxapp å¦‚æœç™»å½•ç”¨æˆ·æ˜¯æœªæ³¨å†Œç”¨æˆ·ï¼Œä½¿ç”¨æ­¤æ¥å£æ³¨å†Œä¸ºæ–°ç”¨æˆ·ã€‚\n\n### æ¢å–ç¬¬ä¸‰æ–¹ tokenï¼ˆ/oauth/tokenï¼‰\n\nå¼€å§‹æˆæƒæ—¶ï¼Œå°ç¨‹åºè°ƒç”¨æ­¤ API å°è¯•æ¢å–jwtï¼Œå¦‚æœç”¨æˆ·æœªæ³¨å†Œè¿”å›401ï¼Œå¦‚æœç”¨æˆ·å‘é€å‚æ•°é”™è¯¯ï¼Œè¿”å›403ã€‚\n\næ¥å£ è·å– jwt æˆåŠŸæ—¶è¿”å›å‚æ•°å¦‚ä¸‹ï¼š\n\nå‚æ•°å | ç±»å‹ | è¯´æ˜\n------|------|------\naccount_id | string | å½“å‰æˆæƒç”¨æˆ·çš„ç”¨æˆ· ID\naccess_token | string | jwtï¼ˆç™»å½•æµç¨‹ä¸­çš„ç¬¬ä¸‰æ–¹ session_key\ntoken_type | string | token ç±»å‹ï¼ˆå›ºå®šBearerï¼‰\n\nå°ç¨‹åºæˆæƒååº”è¯¥å…ˆè°ƒç”¨æ­¤æ¥å£ï¼Œå¦‚æœç»“æœæ˜¯ç”¨æˆ·æœªæ³¨å†Œï¼Œåˆ™åº”è¯¥è°ƒç”¨æ–°ç”¨æˆ·æ³¨å†Œçš„æ¥å£å…ˆæ³¨å†Œæ–°ç”¨æˆ·ï¼Œæ³¨å†ŒæˆåŠŸåå†è°ƒç”¨æ­¤æ¥å£æ¢å– jwtã€‚\n\n### æ–°ç”¨æˆ·æ³¨å†Œï¼ˆ/accounts/wxappï¼‰\n\næ³¨å†Œæ–°ç”¨æˆ·æ—¶ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦å­˜å‚¨å½“å‰ç”¨æˆ·çš„ openidï¼Œæ‰€ä»¥å’Œæˆæƒæ¥å£ä¸€æ ·ï¼Œè¯·æ±‚æ—¶éœ€è¦çš„å‚æ•°ä¸º codeã€encryptedData å’Œ ivã€‚\n\næ³¨å†ŒæˆåŠŸåï¼Œå°†è¿”å›ç”¨æˆ·çš„ ID å’Œæ³¨å†Œæ—¶é—´ã€‚æ­¤æ—¶ï¼Œåº”è¯¥å†æ¬¡è°ƒç”¨è·å– token çš„æ¥å£å»æ¢å–ç¬¬ä¸‰æ–¹ tokenï¼Œä»¥ç”¨æ¥ä¸‹æ¬¡ç™»å½•ã€‚\n\n## å®ç°æµç¨‹\n\næ¥å£å®šä¹‰å¥½ä¹‹åï¼Œæ¥çœ‹ä¸‹å‰åç«¯æ•´ä½“çš„æˆæƒç™»å½•æµç¨‹ã€‚\n\n![å°ç¨‹åºæˆæƒç™»å½•æµç¨‹](http://media.gusibi.mobi/epM1xSYKuQ84VNnsNMH88km6edqNdkLLNcqYyWxs8UYMsUqlasLvYkmb14FtZF9K)\n\nè¿™ä¸ªæµç¨‹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ C æ­¥ï¼ˆä½¿ç”¨ code æ¢å– session ï¼‰ä¹‹åæˆ‘ä»¬å¾—åˆ° session_keyï¼Œç„¶åéœ€è¦ç”¨ session_key è§£å¯†å¾—åˆ°ç”¨æˆ·æ•°æ®ã€‚\n\nç„¶åä½¿ç”¨ openid åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»æ³¨å†Œï¼Œå¦‚æœç”¨æˆ·å·²ç»æ³¨å†Œï¼Œç”Ÿæˆ  jwt è¿”å›ç»™å°ç¨‹åºã€‚\nå¦‚æœç”¨æˆ·æœªæ³¨å†Œè¿”å›401ï¼Œ æç¤ºç”¨æˆ·æœªæ³¨å†Œã€‚\n\n> `jwt(3rd_session)` ç”¨äºç¬¬ä¸‰æ–¹æœåŠ¡å™¨å’Œå°ç¨‹åºä¹‹é—´åšç™»å½•æ€æ ¡éªŒï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œjwt åº”è¯¥æ»¡è¶³ï¼š\n> 1. è¶³å¤Ÿé•¿ã€‚å»ºè®®æœ‰ 2^128 ç»„åˆ\n> 2. é¿å…ä½¿ç”¨ srand(å½“å‰æ—¶é—´)ï¼Œç„¶å rand() çš„æ–¹æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„çœŸæ­£éšæœºæ•°æœºåˆ¶ã€‚\n> 3. è®¾ç½®ä¸€å®šçš„æœ‰æ•ˆæ—¶é—´ï¼Œ\n\nå½“ç„¶ï¼Œåœ¨å°ç¨‹åºä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰‹æœºå·ç™»å½•ï¼Œä¸è¿‡è¿™æ˜¯å¦ä¸€ä¸ªåŠŸèƒ½äº†ï¼Œå°±ä¸åœ¨è¿™é‡Œå™è¿°äº†ã€‚\n\n## ä»£ç å®ç°\n\nè¯´äº†è¿™ä¹ˆå¤šï¼Œæ¥ä¸‹æ¥çœ‹ä»£ç å§ã€‚\n\n### å°ç¨‹åºç«¯ä»£ç \n\nä»£ç é€»è¾‘ä¸ºï¼š\n\n1. ç”¨æˆ·åœ¨å°ç¨‹åºæˆæƒ\n2. å°ç¨‹åºå°†æˆæƒæ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»æ³¨å†Œï¼Œå¦‚æœæ³¨å†Œè¿”å› jwtï¼Œå¦‚æœæ²¡æ³¨å†Œæç¤ºç”¨æˆ·æœªæ³¨å†Œï¼Œç„¶åå°ç¨‹åºé‡æ–°è¯·æ±‚æ³¨å†Œæ¥å£ï¼Œæ³¨å†Œç”¨æˆ·ï¼Œæ³¨å†ŒæˆåŠŸåé‡å¤è¿™ä¸€æ­¥ã€‚\n\nä¸ºäº†ç®€ä¾¿ï¼Œè¿™é‡Œåœ¨å°ç¨‹åº å¯åŠ¨çš„æ—¶å€™å°±è¯·æ±‚æˆæƒã€‚ä»£ç å®ç°å¦‚ä¸‹ã€‚\n\n```javascript\n// app.js\nvar config = require('./config.js')\n\nApp({\n  onLaunch: function () {\n    // è°ƒç”¨APIä»æœ¬åœ°ç¼“å­˜ä¸­è·å–æ•°æ®\n    var jwt = wx.getStorageSync('jwt')\n    var that = this\n    if (!jwt.access_token) { // æ£€æŸ¥ jwt æ˜¯å¦å­˜åœ¨ å¦‚æœä¸å­˜åœ¨è°ƒç”¨ç™»å½•\n      that.login()\n    } else {\n      console.log(jwt.account_id)\n    }\n  },\n  login: function () {\n    // ç™»å½•éƒ¨åˆ†ä»£ç \n    var that = this\n    wx.login({\n      // è°ƒç”¨ login è·å– code\n      success: function (res) {\n        var code = res.code\n        wx.getUserInfo({\n          // è°ƒç”¨ getUserInfo è·å– encryptedData å’Œ iv\n          success: function (res) {\n            // success\n            that.globalData.userInfo = res.userInfo\n            var encryptedData = res.encryptedData || 'encry'\n            var iv = res.iv || 'iv'\n            console.log(config.basic_token)\n            wx.request({ // å‘é€è¯·æ±‚ è·å– jwt\n              url: config.host + '/auth/oauth/token?code=' + code,\n              header: {\n                Authorization: config.basic_token\n              },\n              data: {\n                username: encryptedData,\n                password: iv,\n                grant_type: 'password',\n                auth_approach: 'wxapp'\n              },\n              method: 'POST',\n              success: function (res) {\n                if (res.statusCode === 201) {\n                  // å¾—åˆ° jwt åå­˜å‚¨åˆ° storageï¼Œ\n                  wx.showToast({\n                    title: 'ç™»å½•æˆåŠŸ',\n                    icon: 'success'\n                  })\n                  wx.setStorage({\n                    key: 'jwt',\n                    data: res.data\n                  })\n                  that.globalData.access_token = res.data.access_token\n                  that.globalData.account_id = res.data.sub\n                } else if (res.statusCode === 401) {\n                  // å¦‚æœæ²¡æœ‰æ³¨å†Œè°ƒç”¨æ³¨å†Œæ¥å£\n                  that.register()\n                } else {\n                  // æç¤ºé”™è¯¯ä¿¡æ¯\n                  wx.showToast({\n                    title: res.data.text,\n                    icon: 'success',\n                    duration: 2000\n                  })\n                }\n              },\n              fail: function (res) {\n                console.log('request token fail')\n              }\n            })\n          },\n          fail: function () {\n            // fail\n          },\n          complete: function () {\n            // complete\n          }\n        })\n      }\n    })\n  },\n  register: function () {\n    // æ³¨å†Œä»£ç \n    var that = this\n    wx.login({ // è°ƒç”¨ç™»å½•æ¥å£è·å– code\n      success: function (res) {\n        var code = res.code\n        wx.getUserInfo({\n          // è°ƒç”¨ getUserInfo è·å– encryptedData å’Œ iv\n          success: function (res) {\n            // success\n            that.globalData.userInfo = res.userInfo\n            var encryptedData = res.encryptedData || 'encry'\n            var iv = res.iv || 'iv'\n            console.log(iv)\n            wx.request({ // è¯·æ±‚æ³¨å†Œç”¨æˆ·æ¥å£\n              url: config.host + '/auth/accounts/wxapp',\n              header: {\n                Authorization: config.basic_token\n              },\n              data: {\n                username: encryptedData,\n                password: iv,\n                code: code\n              },\n              method: 'POST',\n              success: function (res) {\n                if (res.statusCode === 201) {\n                  wx.showToast({\n                    title: 'æ³¨å†ŒæˆåŠŸ',\n                    icon: 'success'\n                  })\n                  that.login()\n                } else if (res.statusCode === 400) {\n                  wx.showToast({\n                    title: 'ç”¨æˆ·å·²æ³¨å†Œ',\n                    icon: 'success'\n                  })\n                  that.login()\n                } else if (res.statusCode === 403) {\n                  wx.showToast({\n                    title: res.data.text,\n                    icon: 'success'\n                  })\n                }\n                console.log(res.statusCode)\n                console.log('request token success')\n              },\n              fail: function (res) {\n                console.log('request token fail')\n              }\n            })\n          },\n          fail: function () {\n            // fail\n          },\n          complete: function () {\n            // complete\n          }\n        })\n      }\n    })\n  },\n\n  get_user_info: function (jwt) {\n    wx.request({\n      url: config.host + '/auth/accounts/self',\n      header: {\n        Authorization: jwt.token_type + ' ' + jwt.access_token\n      },\n      method: 'GET',\n      success: function (res) {\n        if (res.statusCode === 201) {\n          wx.showToast({\n            title: 'å·²æ³¨å†Œ',\n            icon: 'success'\n          })\n        } else if (res.statusCode === 401 || res.statusCode === 403) {\n          wx.showToast({\n            title: 'æœªæ³¨å†Œ',\n            icon: 'error'\n          })\n        }\n\n        console.log(res.statusCode)\n        console.log('request token success')\n      },\n      fail: function (res) {\n        console.log('request token fail')\n      }\n    })\n  },\n\n  globalData: {\n    userInfo: null\n  }\n})\n\n```\n\n### æœåŠ¡ç«¯ä»£ç \n\næœåŠ¡ç«¯ä½¿ç”¨ [`sanic`](https://github.com/channelcat/sanic) æ¡†æ¶ + [`swagger_py_codegen`](https://github.com/guokr/swagger-py-codegen) ç”Ÿæˆ rest-apiã€‚\næ•°æ®åº“ä½¿ç”¨ MongoDBï¼Œ[`python-weixin`](https://github.com/gusibi/python-weixin) å®ç°äº†ç™»å½•è¿‡ç¨‹ä¸­ code æ¢å– session_key ä»¥åŠ encryptedData è§£å¯†çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨python-weixin ä½œä¸º python å¾®ä¿¡ sdk ä½¿ç”¨ã€‚\n\n> ä¸ºäº†è¿‡æ»¤æ— æ•ˆè¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯è¦æ±‚ç”¨æˆ·åœ¨è·å– token æˆ–æˆæƒæ—¶åœ¨ header ä¸­å¸¦ä¸Š `Authorization` ä¿¡æ¯ã€‚ `Authorization` åœ¨ç™»å½•å‰ä½¿ç”¨çš„æ˜¯ Basic éªŒè¯ï¼ˆæ ¼å¼ (Basic hashkey) æ³¨ hashkeyä¸ºclient_id + client_secret åšBASE64å¤„ç†ï¼‰ï¼Œåªæ˜¯ç”¨æ¥æ ¡éªŒè¯·æ±‚çš„å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•ã€‚ä¸è¿‡Basic åŸºæœ¬ç­‰åŒäºæ˜æ–‡ï¼Œå¹¶ä¸èƒ½ç”¨å®ƒæ¥è¿›è¡Œä¸¥æ ¼çš„æˆæƒéªŒè¯ã€‚\n\n> jwt åŸç†åŠä½¿ç”¨å‚è§ [ç†è§£JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯åŠå®è·µ](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752020&idx=1&sn=b5e56989a57e9b8067eb6614381a04fd&chksm=80b0b87eb7c73168d7eb1d7f1a95e759b9b0934318571de4f6d2455402e654e6c09d9b022f25)\n\nä½¿ç”¨ swagger ç”Ÿæˆä»£ç ç»“æ„å¦‚ä¸‹ï¼š\n\n![](http://media.gusibi.mobi/BOj58PeS7fLB1FzEivAQA07SYkXPy3ajaajEXKYDUo05rGTfZSThiPg5Mqi7janu)\n\nç”±äºä»£ç å¤ªé•¿ï¼Œè¿™é‡Œåªæ”¾è·å– jwt çš„é€»è¾‘ï¼š\n\n```python\ndef get_wxapp_userinfo(encrypted_data, iv, code):\n    from weixin.lib.wxcrypt import WXBizDataCrypt\n    from weixin import WXAPPAPI\n    from weixin.oauth2 import OAuth2AuthExchangeError\n    appid = Config.WXAPP_ID\n    secret = Config.WXAPP_SECRET\n    api = WXAPPAPI(appid=appid, app_secret=secret)\n    try:\n        # ä½¿ç”¨ code  æ¢å– session key    \n        session_info = api.exchange_code_for_session_key(code=code)\n    except OAuth2AuthExchangeError as e:\n        raise Unauthorized(e.code, e.description)\n    session_key = session_info.get('session_key')\n    crypt = WXBizDataCrypt(appid, session_key)\n    # è§£å¯†å¾—åˆ° ç”¨æˆ·ä¿¡æ¯\n    user_info = crypt.decrypt(encrypted_data, iv)\n    return user_info\n\n\ndef verify_wxapp(encrypted_data, iv, code):\n    user_info = get_wxapp_userinfo(encrypted_data, iv, code)\n    # è·å– openid\n    openid = user_info.get('openId', None)\n    if openid:\n        auth = Account.get_by_wxapp(openid)\n        if not auth:\n            raise Unauthorized('wxapp_not_registered')\n        return auth\n    raise Unauthorized('invalid_wxapp_code')\n    \n    \ndef create_token(request):\n    # verify basic token\n    approach = request.json.get('auth_approach')\n    username = request.json['username']\n    password = request.json['password']\n    if approach == 'password':\n        account = verify_password(username, password)\n    elif approach == 'wxapp':\n        account = verify_wxapp(username, password, request.args.get('code'))\n    if not account:\n        return False, {}\n    payload = {\n        \"iss\": Config.ISS,\n        \"iat\": int(time.time()),\n        \"exp\": int(time.time()) + 86400 * 7,\n        \"aud\": Config.AUDIENCE,\n        \"sub\": str(account['_id']),\n        \"nickname\": account['nickname'],\n        \"scopes\": ['open']\n    }\n    token = jwt.encode(payload, 'secret', algorithm='HS256')\n    # ç”±äº account ä¸­ _id æ˜¯ä¸€ä¸ª object éœ€è¦è½¬åŒ–æˆå­—ç¬¦ä¸²\n    return True, {'access_token': token, 'account_id': str(account['_id'])}\n```\n\nå…·ä½“ä»£ç å¯ä»¥åœ¨ [Metisï¼šhttps://github.com/gusibi/Metis](https://github.com/gusibi/Metis) æŸ¥çœ‹ã€‚\n\n> `Note`: å¦‚æœè¯•ç”¨ä»£ç ï¼Œè¯·å…ˆè®¾å®š oauth2_clientï¼Œä½¿ç”¨è‡ªå·±çš„é…ç½®ã€‚\n> > ä¸è¦å°†ç§å¯†é…ç½®ä¿¡æ¯æäº¤åˆ° githubã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [ã€Šå¾®ä¿¡å°ç¨‹åºä¸ƒæ—¥è°ˆã€‹- ç¬¬äº”å¤©ï¼šä½ å¯èƒ½è¦åœ¨ç™»å½•åŠŸèƒ½ä¸ŠèŠ±è´¹å¤§åŠ›æ°”ï¼šhttp://www.cnblogs.com/ihardcoder/p/6279602.html](http://www.cnblogs.com/ihardcoder/p/6279602.html)\n* [ç†è§£JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯åŠå®è·µ](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752020&idx=1&sn=b5e56989a57e9b8067eb6614381a04fd&chksm=80b0b87eb7c73168d7eb1d7f1a95e759b9b0934318571de4f6d2455402e654e6c09d9b022f25)\n* [ç½‘ç«™å¾®ä¿¡ç™»å½•ï¼python å®ç°ï¼šhttp://blog.gusibi.site/post/weixin-python-login/](http://blog.gusibi.site/post/weixin-python-login/)\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å°ç¨‹åºå¼€å‘ï¼špython sanic å®ç°å°ç¨‹åºç™»å½•æ³¨å†Œ",
        "date": "2017-07-30 04:17:13",
        "tags": [
          "python",
          "tutorial",
          "weixin",
          "å°ç¨‹åº",
          "swagger"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "metis-1-wxapp-login"
    },
    {
      "content": "\n> è¿™æ˜¯ã€ŠCSSè®¾è®¡æŒ‡å—ã€‹çš„è¯»ä¹¦ç¬”è®°ï¼Œç”¨äºåŠ æ·±å­¦ä¹ æ•ˆæœã€‚\nå‰ä¸€ç¯‡[CSSå…¥é—¨æŒ‡å—-2ï¼šç›’å­æ¨¡å‹ã€æµ®åŠ¨å’Œæ¸…é™¤](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752018&idx=1&sn=6915e4f11ba08fa196a64375224cd92e&chksm=80b0b878b7c7316e1a065ae991c534cc11ca5fe72b33690a98fb1c3f6f53f8c98c4c8744cd3a#rd)ä»‹ç»äº†cssç›’å­æ¨¡å‹ã€æµ®åŠ¨å’Œæ¸…é™¤ï¼Œè¿™ä¸€ç¯‡ä»‹ç» csså…ƒç´ çš„å®šä½ã€‚\n\n## å®šä½ï¼ˆpositionï¼‰\nCSS å¸ƒå±€çš„æ ¸å¿ƒæ˜¯ position å±æ€§ï¼Œå¯¹å…ƒç´ ç›’å­åº”ç”¨è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥ç›¸å¯¹äºå®ƒåœ¨å¸¸è§„æ–‡æ¡£æµä¸­çš„ä½ç½®é‡æ–°å®šä½ã€‚\nposition å±æ€§æœ‰4ä¸ªå€¼ï¼š`static`ã€`relative`ã€`absoulte`ã€`fixed`ï¼Œé»˜è®¤å€¼ä¸º staticã€‚\n\næ¥ä¸‹æ¥æˆ‘ä¼šç”¨ä»¥ä¸‹å››ä¸ªæ®µè½æ¥é€ä¸ªè¯´æ˜è¿™äº›å±æ€§æ˜¯ä»€ä¹ˆæ„æ€ã€‚\n\n```html\n<p id=\"first\">First Paragraph</p>\n<p id=\"Second\">Second Paragraph</p>\n<p id=\"specialpara\">Third Paragraph</p>\n<p id=\"fourth\">First Paragraph</p>\n```\n\n### é™æ€å®šä½ï¼ˆstaticï¼‰\n\næˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å››ä¸ªæ®µè½éƒ½é‡‡ç”¨é™æ€å®šä½çš„æ•ˆæœã€‚\n\n![å››æ®µéƒ½é‡‡ç”¨é™æ€å®šä½çš„å›¾ç¤º](http://media.gusibi.mobi/R_7xrRQEA1TEc4S1GJsxwpfz99rx6nvnb0KZNOc1m-D5P8bdMAq-mQsvZ85xxMSb)\n\n> é™æ€å®šä½ä¸‹ï¼Œæ¯ä¸ªå…ƒç´ åœ¨å¤„åœ¨å¸¸è§„æ–‡æ¡£æµä¸­ï¼Œå®ƒä»¬éƒ½æ˜¯å—çº§å…ƒç´ ï¼Œæ‰€ä»¥ä¼šåœ¨é¡µé¢ä¸­è‡ªä¸Šè€Œä¸‹åœ°å †å ã€‚\n\n### ç›¸å¯¹å®šä½ï¼ˆrelativeï¼‰\n\nç°åœ¨æˆ‘æŠŠç¬¬ä¸‰æ®µçš„ position å±æ€§è®¾ç½®ä¸º relativeã€‚\n\n```css\np#specialpara {\n    position: relative;\n    top: 25px;\n    left: 30px;\n}\n```\n\nå› ä¸ºç›¸å¯¹å®šä½`ç›¸å¯¹çš„æ˜¯å®ƒåŸæ¥åœ¨æ–‡æ¡£æµä¸­çš„ä½ç½®ï¼ˆé»˜è®¤ä½ç½®ï¼‰`ï¼Œæ‰€ä»¥å¦‚æœåªè®¾ç½® position æ ·å¼ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ã€‚è¿™é‡Œæˆ‘åŒæ—¶è®¾ç½®äº† top å’Œ left å±æ€§æ¥æ”¹å˜å®ƒçš„ä½ç½®ã€‚\n\nç°åœ¨å®ƒçš„æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š\n\n![ç¬¬ä¸‰æ®µä½¿ç”¨ç›¸å¯¹å®šä½çš„æ•ˆæœå›¾](http://media.gusibi.mobi/5OFF-2lXXl-JAY4tUuAl0V3Z5q6livJzUz11Fs7N8nIbz9mYgGp8GlzA6oM6_U9J)\n\n> ç°åœ¨ï¼Œç¬¬ä¸‰æ®µä»åŸæ¥çš„å…ƒç´ ï¼ˆbodyï¼‰ä¸­æŒ£è„±äº†å‡ºæ¥ï¼Œä¸å®ƒåœ¨æ–‡æ¡£ä¸­çš„é»˜è®¤ä½ç½®ç›¸æ¯”å‘ä¸‹ç§»åŠ¨äº†25åƒç´ ï¼Œå‘å³ç§»åŠ¨äº†30åƒç´ ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé™¤äº†è¿™ä¸ªå…ƒç´ è‡ªå·±ç›¸å¯¹äºåŸå§‹ä½ç½®æŒªåŠ¨äº†ä¸€ä¸‹ä»¥å¤–ï¼Œé¡µé¢æ²¡æœ‰ä»»ä½•æ”¹å˜ã€‚è¿™ä¸ªå…ƒç´ åŸæ¥å æ®çš„ç©ºé—´æ²¡æœ‰åŠ¨ï¼Œå…¶ä»–å…ƒç´ ä¹Ÿæ²¡åŠ¨ã€‚\n\nè¿™æ—¶ï¼Œå¦‚æœä¸æƒ³ç¬¬å››æ®µè¢«å®ƒæŒ¡ä½ï¼Œå¯ä»¥ç»™ç¬¬å››æ®µè®¾ç½®ä¸€ä¸ª margin-top å€¼ã€‚\n\n### ç»å¯¹å®šä½ï¼ˆabsoulteï¼‰\n\nç»å¯¹å®šä½è·Ÿé™æ€å®šä½å’Œç›¸å¯¹å®šä½ç›¸æ¯”ï¼Œå®ƒä¼šæŠŠå…ƒç´ å½»åº•ä»æ–‡æ¡£æµä¸­æ‹¿å‡ºæ¥ã€‚\n\næˆ‘ä»¬æŠŠ position æ”¹ä¸ºç»å¯¹å®šä½çœ‹ä¸€ä¸‹ï¼š\n\n```css\np#specialpara {\n    position: absoulte;\n    top: 25px;\n    left: 30px;\n}\n```\n\næ•ˆæœå¦‚å›¾ï¼š\n\n![ç¬¬ä¸‰æ®µä½¿ç”¨ç»å¯¹å®šä½çš„æ•ˆæœå›¾](http://media.gusibi.mobi/2-U0Y3OwzCz9gOLmV-LF96-U1nnRhPUjvX6InOVjCfPo9vWCqwx0d_mQlmsFCkWL)\n\n> å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸‰æ®µåŸæ¥çš„ä½ç½®è¢«å›æ”¶äº†ã€‚è¿™è¯´æ˜ç»å¯¹å®šä½çš„å…ƒç´ è„±ç¦»äº†å¸¸è§„æ–‡æ¡£æµï¼Œå®ƒç°åœ¨æ˜¯ç›¸å¯¹äºé¡¶çº§å…ƒç´  body åœ¨å®šä½ã€‚\n\nç°åœ¨å°±æ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼š`å®šä½ä¸Šä¸‹æ–‡`ï¼Œè¿™ä¸ªåè¾¹è¯´ï¼Œå…ˆç»§ç»­çœ‹æœ€åä¸€ç§å®šä½æ–¹å¼ï¼š`å›ºå®šå®šä½`ã€‚\n\n> `ç›’å­ä½ç§»å±æ€§æ˜¯å¦‚ä½•å·¥ä½œï¼Ÿ`\n\n>ç›’å­çš„ä½ç§»å±æ€§æœ‰å››ä¸ªâ€œtopã€rightã€bottomå’Œleftâ€ï¼Œç”¨æ¥æŒ‡å®šå…ƒç´ çš„å®šä½ä½ç½®å’Œæ–¹å‘ã€‚è¿™äº›å±æ€§åªèƒ½åœ¨å…ƒç´ çš„â€œpositionâ€å±æ€§è®¾ç½®äº†â€œrelativeã€absoluteå’Œfixedâ€å±æ€§å€¼ï¼Œæ‰ç”Ÿæ•ˆã€‚\n\n>å¯¹äºç›¸å¯¹å®šä½å…ƒç´ ï¼Œè¿™äº›å±æ€§çš„è®¾ç½®è®©å…ƒç´ ä»é»˜è®¤ä½ç½®ç§»åŠ¨ã€‚ä¾‹å¦‚ï¼Œtopè®¾ç½®ä¸€ä¸ªå€¼â€œ20pxâ€åœ¨ä¸€ä¸ªç›¸å¯¹å®šä½çš„å…ƒç´ ä¸Šï¼Œè¿™ä¸ªå…ƒç´ ä¼šåœ¨åŸæ¥ä½ç½®å‘ä¸‹ç§»åŠ¨â€œ20pxâ€ã€‚\n\n>å¯¹äºç»å¯¹å®šä½å’Œå›ºå®šå®šä½ï¼Œè¿™äº›å±æ€§æŒ‡å®šäº†å…ƒç´ ä¸çˆ¶å…ƒç´ è¾¹ç¼˜ä¹‹é—´çš„è·ç¦»ï¼Œä¾‹å¦‚ï¼Œç»å¯¹å®šä½çš„å…ƒç´ è®¾ç½®ä¸€ä¸ªâ€œtopâ€å€¼ä¸ºâ€œ20pxâ€ï¼Œå°†ä½¿ç»å¯¹å®šä½å…ƒç´ ç›¸å¯¹äºå…¶è®¾ç½®äº†ç›¸å¯¹å®šä½çš„ç¥–å…ˆå…ƒç´ é¡¶éƒ¨è¾¹ç¼˜å‘ä¸‹ç§»åŠ¨â€œ20pxâ€ï¼Œåä¹‹ï¼Œå¦‚æœè®¾ç½®ä¸€ä¸ªâ€œtopâ€å€¼ä¸ºâ€œ20pxâ€ï¼Œå°†ä½¿ç»å¯¹å®šä½å…ƒç´ ç›¸å¯¹äºå…¶è®¾ç½®äº†ç›¸å¯¹å®šä½çš„ç¥–å…ˆå…ƒç´ é¡¶éƒ¨è¾¹ç¼˜å‘ä¸Šç§»åŠ¨â€œ20pxâ€ã€‚ï¼ˆç»å¯¹å®šä½çš„å‚è€ƒç‚¹æ˜¯å…¶ç¥–å…ˆå…ƒç´ è®¾ç½®äº†â€œrelativeâ€æˆ–è€…â€œabsoluteâ€å€¼ï¼‰ã€‚\n\näº‹å®ä¸Šï¼Œä¸€ä¸ªç›¸å¯¹å®šä½å…ƒç´ åŒæ—¶è®¾ç½®äº†â€œtopâ€å’Œâ€œbottomâ€ä½ç§»å±æ€§å€¼ï¼Œå®é™…ä¸Šâ€œtopâ€ä¼˜å…ˆçº§é«˜äºâ€œbottomâ€ã€‚ç„¶è€Œï¼Œä¸€ä¸ªç›¸å¯¹å®šä½å…ƒç´ åŒæ—¶è®¾ç½®äº†â€œleftâ€å’Œâ€œrightâ€ä½ç§»å±æ€§ï¼Œä»–ä»¬çš„ä¼˜å…ˆçº§å–å†³äºé¡µé¢ä½¿ç”¨çš„æ˜¯å“ªç§è¯­è¨€ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ çš„é¡µé¢æ˜¯è‹±æ–‡é¡µé¢ï¼Œé‚£ä¹ˆâ€œleftâ€ä½ç§»å±æ€§ä¼˜å…ˆçº§é«˜ï¼Œå¦‚æœä½ çš„é¡µé¢æ˜¯é˜¿æ‹‰ä¼¯è¯­ï¼Œé‚£ä¹ˆâ€œrightâ€çš„ä½ç§»å±æ€§ä¼˜å…ˆçº§é«˜\n\n### å›ºå®šå®šä½ï¼ˆfixedï¼‰\n\nå›ºå®šå®šä½ä¸ç»å¯¹å®šä½ç±»ä¼¼ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹æŠŠå®šä½æ”¹ä¸ºç›¸å¯¹å®šä½çš„æ•ˆæœï¼š\n\n```css\np#specialpara {\n    position: fixed;\n    top: 25px;\n    left: 30px;\n}\n```\n\næ•ˆæœå¦‚å›¾ï¼š\n\n![ç¬¬ä¸‰æ®µä½¿ç”¨å›ºå®šå®šä½çš„æ•ˆæœå›¾](http://media.gusibi.mobi/g_yr-9KcVSriUd_apawLXJRM3qoZ5fHF3rbJXhq2kUafT3A_eg9D2Jv8Dd0sUTMf)\n\n> è¿™æ ·çœ‹æ•ˆæœå’Œç»å¯¹å®šä½å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯å›ºå®šå®šä½çš„å®šä½ä¸Šä¸‹æ–‡æ˜¯`æµè§ˆå™¨çª—å£`ï¼Œå¥¹å¹¶ä¸ä¼šéšé¡µé¢æ»šåŠ¨ã€‚\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨ç›¸å¯¹å®šä½å’Œå›ºå®šå®šä½çš„å›¾ç¤ºï¼š\n\n![ä½¿ç”¨å›ºå®šå®šä½çš„ç¤ºæ„å›¾](http://media.gusibi.mobi/31atM18aEdu0ogKsBdM0c1Dmc-l_Gyw2sIee4TE6NCCIG7A1YXAbSUZA_OWRUttM)\n\n![ä½¿ç”¨ç»å¯¹å®šä½çš„ç¤ºæ„å›¾](http://media.gusibi.mobi/G0pLxrvwS6cxCaesieCs9inVKgzsyolbzRFIYcqvwDhnIIprWTlRWj8p6UCFo9SP)\n\n#### å›ºå®šé¡µå¤´å’Œé¡µè„š\n\nå›ºå®šå®šä½æœ€å¸¸è§çš„ä¸€ç§ç”¨é€”å°±æ˜¯åœ¨é¡µé¢ä¸­åˆ›å»ºä¸€ä¸ªå›ºå®šå¤´éƒ¨ã€æˆ–è€…è„šéƒ¨ã€æˆ–è€…å›ºå®šé¡µé¢çš„ä¸€ä¸ªä¾§é¢ã€‚å°±ç®—æ˜¯ç”¨æˆ·ç§»åŠ¨æµè§ˆå™¨çš„æ»šåŠ¨æ¡ï¼Œè¿˜æ˜¯ä¼šå›ºå®šåœ¨é¡µé¢ã€‚\n\nç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹å®šä½ä¸Šä¸‹æ–‡ã€‚\n\n## å®šä½ä¸Šä¸‹æ–‡\n\næŠŠå…ƒç´ çš„ position å±æ€§è®¾å®šä¸º relativeã€absoluteæˆ– fixed åï¼Œå¯ä»¥ä½¿ç”¨ topã€rightã€bottom å’Œ left å±æ€§ï¼Œç›¸å¯¹äºå¦ä¸€ä¸ªå…ƒç´ ç§»åŠ¨è¯¥å…ƒç´ çš„ä½ç½®ã€‚è¿™é‡Œ`å¦ä¸€ä¸ªå…ƒç´ `å°±æ˜¯å½“å‰å…ƒç´ çš„`å®šä½ä¸Šä¸‹æ–‡`ã€‚\n\næˆ‘ä»¬åœ¨ä»‹ç»ç»å¯¹å®šä½çš„æ—¶å€™è¯´è¿‡ï¼Œç»å¯¹å®šä½å…ƒç´ é»˜è®¤çš„å®šä½ä¸Šä¸‹æ–‡æ˜¯  `body`ï¼Œè¿™æ˜¯å› ä¸º body æ˜¯æ ‡è®°ä¸­æ‰€æœ‰å…ƒç´ å”¯ä¸€çš„ç¥–å…ˆå…ƒç´ ã€‚ä¸è¿‡ï¼Œå¦‚æœæŠŠä»–ç›¸åº”çš„å…ƒç´ è®¾å®šä¸º relativeï¼Œç»å¯¹å®šä½å…ƒç´ çš„ä»»ä½•ç¥–å…ˆå…ƒç´ éƒ½å¯ä»¥æˆä¸ºå®ƒçš„å®šä½ä¸Šä¸‹æ–‡ã€‚\n\næ¯”å¦‚ï¼š\n\n```html\n<body>\n    <div id=\"outer\">\n      <div id=\"inner\"> This is text for a paragraph to demonstrate contextual\n        positioning. Here are two divs, one nested in the other. The inner div now\n        has absolute positioning, so it positions itself relative to the default\n        positioning context, body.</div>\n    </div>\n</body>\n```\n\ncss æ ·å¼å¦‚ä¸‹ï¼š\n\n```css\ndiv#outer {\n    width:250px; \n    margin:100px 40px; \n    border-top:3px solid red;\n}\ndiv#inner {\n    top:10px; \n    left:20px; \n    background:#DDD;\n}\n```\n\nç»“æœå¦‚å›¾ï¼š\n\n![ä¸¤ä¸ªåµŒå¥—çš„ divã€‚ç»™å¤–éƒ¨çš„ä¸Šæ–¹åŠ äº†è¾¹æ¡†ï¼Œç»™å†…éƒ¨çš„åŠ äº†èƒŒæ™¯](http://media.gusibi.mobi/GMOwNNvXspDO5-z8jgN_xtU39GWx6F8kGIgO4f1rjWfLBbY8GxRspaF65xve5nJy)\n\n> è¿™é‡Œå†…éƒ¨å’Œå¤–éƒ¨çš„ div éƒ½æ˜¯æ˜¯é™æ€å®šä½ï¼Œä¸å­˜åœ¨è°æ˜¯è°çš„å®šä½ä¸Šä¸‹æ–‡è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ top å’Œ left å±æ€§å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚\n\nä¸‹é¢æˆ‘ä»¬æŠŠå†…éƒ¨ div è®¾å®šä¸ºç»å¯¹å®šä½ï¼Œæ¥çœ‹ä¸€ä¸‹å˜åŒ–ã€‚\n\n```css\ndiv#inner {\n    top:10px; \n    left:20px; \n    background:#DDD;\n}\n```\n\nè¿™æ˜¯æ•ˆæœå¦‚å›¾ï¼š\n![è¿™é‡Œç”±äºå®šä½ä¸Šä¸‹æ–‡æ˜¯ bodyï¼Œæ‰€ä»¥ top å’Œ left éƒ½æ˜¯ç›¸å¯¹äº body çš„ç§»åŠ¨](http://media.gusibi.mobi/tIL-dsUeItz8GycFe89rmxUphejURxfSZLEkO4KjefpEJATysQV5_Ny-EujVmlcT)\n\nè¿™é‡Œç”±äºä¸å­˜åœ¨ç›¸å¯¹å®šä½çš„å…¶ä»–ç¥–å…ˆå…ƒç´ å¯ä»¥ä½œä¸ºå®šä½ä¸Šä¸‹æ–‡ï¼Œç»å¯¹å®šä½åªèƒ½ç›¸å¯¹äº body å®šä½ã€‚\n\n> äº‹å®ä¸Šï¼Œåªè¦æŠŠå…ƒç´ çš„å¤–è¾¹è·å’Œå†…è¾¹è·è®¾å®šå¥½ï¼Œå¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨é™æ€å®šä½å°±å¯ä»¥å®ç°é¡µé¢å¸ƒå±€äº†ã€‚`é™¤éçœŸæ­£éœ€è¦é‚£ä¹ˆåšï¼Œå¦åˆ™ä¸è¦è½»æ˜“ä¿®æ”¹å…ƒç´ çš„ position å±æ€§ã€‚`\n\nç°åœ¨æˆ‘ä»¬æŠŠå¤–éƒ¨ div çš„ position è®¾ç½®ä¸º relativeï¼š\n\n```css\ndiv#outer {\n    position: relative;\n    width:250px; \n    margin:100px 40px; \n    border-top:3px solid red;\n}\n```\n\n![å¤–éƒ¨ div æ”¹ä¸ºç›¸å¯¹å®šä½çš„æ•ˆæœå›¾](http://media.gusibi.mobi/jA4DvQn5T5PjIWmFJc7FE8bx5a31PMF5Y8czNOGD0d_5MdAoE_PM44bIT1-fa0_y)\n\nå¤–éƒ¨ div æ”¹ä¸ºç›¸å¯¹å®šä½ä¹‹åï¼Œåä»£ä¸­ç»å¯¹å®šä½çš„å…ƒç´ å°±ä¼šæŒ‰ç…§ top å’Œ left å±æ€§çš„è®¾å®šï¼Œç›¸å¯¹äºå¤–éƒ¨ div å®šä½ã€‚æ­¤æ—¶å†…éƒ¨ divçš„ top å’Œ left å±æ€§å‚ç…§çš„å°±æ˜¯å¤–éƒ¨ divã€‚\n\næœ€åæˆ‘ä»¬è¯´ä¸€ä¸‹å’Œå®šä½ç›¸å…³çš„æ˜¾ç¤ºå±æ€§ã€‚\n\n## æ˜¾ç¤ºå±æ€§\n\næ‰€æœ‰çš„å…ƒç´ éƒ½æœ‰`display`å±æ€§ã€‚display å±æ€§æœ‰ä¸¤ä¸ªæœ€å¸¸ç”¨çš„å€¼ï¼š`blockï¼ˆå—çº§å…ƒç´ ï¼‰`å’Œ`inlineï¼ˆè¡Œå†…å…ƒç´ ï¼‰`ã€‚\n\n* å—çº§å…ƒç´ ï¼šæ¯”å¦‚æ®µè½ã€æ ‡é¢˜ã€åˆ—è¡¨ç­‰ï¼Œåœ¨æµè§ˆå™¨ä¸­ä¸Šä¸‹å †å æ˜¾ç¤ºã€‚\n* è¡Œå†…å…ƒç´ ï¼šæ¯”å¦‚ aã€spanã€å’Œ imgï¼Œåœ¨æµè§ˆå™¨ä¸­å·¦å³å¹¶æ’æ˜¾ç¤ºï¼Œåªæœ‰å‰ä¸€è¡Œæ²¡æœ‰ç©ºé—´æ—¶æ‰ä¼šæ˜¾ç¤ºå¯¹ä¸‹ä¸€è¡Œã€‚\n\nå—çº§å…ƒç´ å’Œè¡Œå†…å…ƒç´ æ˜¯å¯ä»¥äº’ç›¸è½¬åŒ–çš„ï¼š\n\n```css\n/*é»˜è®¤ä¸ºå—çº§å…ƒç´ */\np {display: inline;}\n/*é»˜è®¤ä¸ºè¡Œå†…å…ƒç´ */\na {display: block;}\n```\n\n> display è¿˜æœ‰ä¸€ä¸ªå±æ€§å€¼ï¼š`none`ã€‚æŠŠdisplayè®¾ç½®ä¸º noneï¼Œè¯¥å…ƒç´ åŠæ‰€æœ‰åŒ…å«åœ¨å…¶ä¸­çš„å…ƒç´ ï¼Œéƒ½ä¸ä¼šåœ¨é¡µé¢ä¸­æ˜¾ç¤ºã€‚å®ƒä»¬åŸæ¥å æ®çš„ç©ºé—´ä¹Ÿä¼šè¢«å›æ”¶\n> ç›¸å¯¹çš„å±æ€§æ˜¯ `visibility`ï¼Œè¿™ä¸ªå±æ€§å¸¸ç”¨çš„å€¼æ˜¯ visibleï¼ˆé»˜è®¤ï¼‰å’Œ hiddenã€‚æŠŠå…ƒç´ çš„ visibility è®¾å®šä¸º hiddenï¼Œå…ƒç´ ä¼šéšè—ï¼Œä½†å®ƒå æ®çš„ç©ºé—´ä»ç„¶å­˜åœ¨ã€‚\n\næˆ‘ä»¬ä¸Šä¸€ç¯‡ [CSSå…¥é—¨æŒ‡å—-2ï¼šç›’å­æ¨¡å‹ã€æµ®åŠ¨å’Œæ¸…é™¤](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752018&idx=1&sn=6915e4f11ba08fa196a64375224cd92e&chksm=80b0b878b7c7316e1a065ae991c534cc11ca5fe72b33690a98fb1c3f6f53f8c98c4c8744cd3a#rd) ä¸­æåˆ°çš„ `clearfix` ç±»å°±ç”¨åˆ°äº†è¿™ä¸ªå±æ€§ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬ä¼šæ·»åŠ ä¸€ä¸ªå—çº§å…ƒç´ ï¼Œç„¶åæŠŠå†…å®¹éšè—ï¼Œä»¥ç”¨æ¥æ¸…é™¤æµ®åŠ¨ã€‚clearfix çš„æ ·å¼å¦‚ä¸‹ï¼š\n\n```css\n.clearfix:after {\n     content: \".\";\n     display: block;\n     height: 0;\n     clear: both;\n     visibility: hidden;\n    }\n```\n\n## å‚è€ƒé“¾æ¥\n\n* [10æ­¥æŒæ¡CSSå®šä½: position static relative absolute float](http://www.see-design.com.tw/i/css_position.html)\n* [HTMLå’ŒCSSé«˜çº§æŒ‡å—ä¹‹äºŒâ€”â€”å®šä½è¯¦è§£](https://www.w3cplus.com/css/advanced-html-css-lesson2-detailed-css-positioning.html)\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "categories": [
          "development",
          "web",
          "è¯»ä¹¦ç¬”è®°",
          "å‰ç«¯"
        ],
        "date": "2017-07-26 14:21:49",
        "author": "goodspeed",
        "permalink": "/post/css-learing-3-positioning-elements",
        "tags": [
          "css",
          "è¯»ä¹¦ç¬”è®°",
          "html",
          "tutorial",
          "å‰ç«¯"
        ],
        "title": "CSSå…¥é—¨æŒ‡å—-3ï¼šå®šä½å…ƒç´ ",
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "css-learing-3-positioning-elements"
    },
    {
      "content": "\n> æœ€è¿‘æƒ³åšä¸ªå°ç¨‹åºï¼Œéœ€è¦ç”¨åˆ°æˆæƒè®¤è¯æµç¨‹ã€‚ä»¥å‰é¡¹ç›®éƒ½æ˜¯ç”¨çš„ OAuth2 è®¤è¯ï¼Œä½†æ˜¯Sanic ä½¿ç”¨OAuth2 ä¸å¤ªæ–¹ä¾¿ï¼Œå°±æƒ³è¯•ä¸€ä¸‹ JWT çš„è®¤è¯æ–¹å¼ã€‚\n> è¿™ä¸€ç¯‡ä¸»è¦å†…å®¹æ˜¯ JWT çš„è®¤è¯åŸç†ï¼Œä»¥åŠpython ä½¿ç”¨ jwt è®¤è¯†çš„å®è·µã€‚\n\n## å‡ ç§å¸¸ç”¨çš„è®¤è¯æœºåˆ¶\nHUGOMORE42\n### HTTP Basic Auth\n\n`HTTP Basic Auth` åœ¨HTTPä¸­ï¼ŒåŸºæœ¬è®¤è¯æ˜¯ä¸€ç§ç”¨æ¥å…è®¸Webæµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯ç¨‹åºåœ¨è¯·æ±‚æ—¶æä¾›ç”¨æˆ·åå’Œå£ä»¤å½¢å¼çš„èº«ä»½å‡­è¯çš„ä¸€ç§ç™»å½•éªŒè¯æ–¹å¼ï¼Œé€šå¸¸ç”¨æˆ·åå’Œæ˜ç ä¼šé€šè¿‡HTTPå¤´ä¼ é€’ã€‚\n\nåœ¨å‘é€ä¹‹å‰æ˜¯ä»¥ç”¨æˆ·åè¿½åŠ ä¸€ä¸ªå†’å·ç„¶åä¸²æ¥ä¸Šå£ä»¤ï¼Œå¹¶å°†å¾—å‡ºçš„ç»“æœå­—ç¬¦ä¸²å†ç”¨Base64ç®—æ³•ç¼–ç ã€‚ä¾‹å¦‚ï¼Œæä¾›çš„ç”¨æˆ·åæ˜¯Aladdinã€å£ä»¤æ˜¯open sesameï¼Œåˆ™æ‹¼æ¥åçš„ç»“æœå°±æ˜¯Aladdin:open sesameï¼Œç„¶åå†å°†å…¶ç”¨`Base64ç¼–ç `ï¼Œå¾—åˆ°QWxhZGRpbjpvcGVuIHNlc2FtZQ==ã€‚æœ€ç»ˆå°†Base64ç¼–ç çš„å­—ç¬¦ä¸²å‘é€å‡ºå»ï¼Œç”±æ¥æ”¶è€…è§£ç å¾—åˆ°ä¸€ä¸ªç”±å†’å·åˆ†éš”çš„ç”¨æˆ·åå’Œå£ä»¤çš„å­—ç¬¦ä¸²ã€‚\n\n> `ä¼˜ç‚¹` \nåŸºæœ¬è®¤è¯çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯åŸºæœ¬ä¸Šæ‰€æœ‰æµè¡Œçš„ç½‘é¡µæµè§ˆå™¨éƒ½æ”¯æŒåŸºæœ¬è®¤è¯ã€‚\n\n> `ç¼ºç‚¹` \nç”±äºç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯Base64ç¼–ç çš„ï¼Œè€ŒBase64ç¼–ç æ˜¯å¯é€†çš„ï¼Œæ‰€ä»¥ç”¨æˆ·åå’Œå¯†ç å¯ä»¥è®¤ä¸ºæ˜¯æ˜æ–‡ã€‚æ‰€ä»¥åªæœ‰åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸»æœºä¹‹é—´çš„è¿æ¥æ˜¯å®‰å…¨å¯ä¿¡çš„å‰æä¸‹æ‰å¯ä»¥ä½¿ç”¨ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´åŠ å®‰å…¨ä¹Ÿé€‚ç”¨èŒƒå›´æ›´å¤§çš„è®¤è¯æ–¹å¼ `OAuth`ã€‚\n\n### OAuth\n\nOAuth æ˜¯ä¸€ä¸ªå…³äºæˆæƒï¼ˆauthorizationï¼‰çš„å¼€æ”¾ç½‘ç»œæ ‡å‡†ã€‚å…è®¸ç”¨æˆ·æä¾›ä¸€ä¸ªä»¤ç‰Œï¼Œè€Œä¸æ˜¯ç”¨æˆ·åå’Œå¯†ç æ¥è®¿é—®ä»–ä»¬å­˜æ”¾åœ¨ç‰¹å®šæœåŠ¡æä¾›è€…çš„æ•°æ®ã€‚ç°åœ¨çš„ç‰ˆæœ¬æ˜¯2.0ç‰ˆã€‚\n\nä¸¥æ ¼æ¥è¯´ï¼ŒOAuth2ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªå®‰å…¨çš„æˆæƒæ¡†æ¶ã€‚å®ƒè¯¦ç»†æè¿°äº†ç³»ç»Ÿä¸­ä¸åŒè§’è‰²ã€ç”¨æˆ·ã€æœåŠ¡å‰ç«¯åº”ç”¨ï¼ˆæ¯”å¦‚APIï¼‰ï¼Œä»¥åŠå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ç½‘ç«™æˆ–ç§»åŠ¨Appï¼‰ä¹‹é—´æ€ä¹ˆå®ç°ç›¸äº’è®¤è¯ã€‚\n\n#### åè¯å®šä¹‰\n\n* Third-party application: ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œåˆç§°\"å®¢æˆ·ç«¯\"ï¼ˆclientï¼‰\n* HTTP serviceï¼šHTTPæœåŠ¡æä¾›å•†\n* Resource Ownerï¼šèµ„æºæ‰€æœ‰è€…ï¼Œé€šå¸¸ç§°\"ç”¨æˆ·\"ï¼ˆuserï¼‰ã€‚\n* User Agentï¼šç”¨æˆ·ä»£ç†ï¼Œæ¯”å¦‚æµè§ˆå™¨ã€‚\n* Authorization serverï¼šè®¤è¯æœåŠ¡å™¨ï¼Œå³æœåŠ¡æä¾›å•†ä¸“é—¨ç”¨æ¥å¤„ç†è®¤è¯çš„æœåŠ¡å™¨ã€‚\n* Resource serverï¼šèµ„æºæœåŠ¡å™¨ï¼Œå³æœåŠ¡æä¾›å•†å­˜æ”¾ç”¨æˆ·ç”Ÿæˆçš„èµ„æºçš„æœåŠ¡å™¨ã€‚å®ƒä¸è®¤è¯æœåŠ¡å™¨ï¼Œå¯ä»¥æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„æœåŠ¡å™¨ã€‚\n\nOAuth 2.0 è¿è¡Œæµç¨‹å¦‚å›¾ï¼š\n\n![OAuth 2.0 è¿è¡Œæµç¨‹](http://media.gusibi.mobi/9zOAPS-K2Eo9C8vlyPe4EpQ15mRaKCsK8gCy5Wdu2bhogzTImDN0g_v8y7ufbdRl)\n\nï¼ˆAï¼‰ç”¨æˆ·æ‰“å¼€å®¢æˆ·ç«¯ä»¥åï¼Œå®¢æˆ·ç«¯è¦æ±‚ç”¨æˆ·ç»™äºˆæˆæƒã€‚\nï¼ˆBï¼‰ç”¨æˆ·åŒæ„ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚\nï¼ˆCï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä¸Šä¸€æ­¥è·å¾—çš„æˆæƒï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚\nï¼ˆDï¼‰è®¤è¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ä»¥åï¼Œç¡®è®¤æ— è¯¯ï¼ŒåŒæ„å‘æ”¾ä»¤ç‰Œã€‚\nï¼ˆEï¼‰å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œï¼Œå‘èµ„æºæœåŠ¡å™¨ç”³è¯·è·å–èµ„æºã€‚\nï¼ˆFï¼‰èµ„æºæœåŠ¡å™¨ç¡®è®¤ä»¤ç‰Œæ— è¯¯ï¼ŒåŒæ„å‘å®¢æˆ·ç«¯å¼€æ”¾èµ„æºã€‚\n\n> `ä¼˜ç‚¹`\nå¿«é€Ÿå¼€å‘\nå®æ–½ä»£ç é‡å°\nç»´æŠ¤å·¥ä½œå‡å°‘\nå¦‚æœè®¾è®¡çš„APIè¦è¢«ä¸åŒçš„Appä½¿ç”¨ï¼Œå¹¶ä¸”æ¯ä¸ªAppä½¿ç”¨çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·ï¼Œä½¿ç”¨OAuth2æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\n\n> `ç¼ºç‚¹`ï¼š\n> OAuth2æ˜¯ä¸€ä¸ªå®‰å…¨æ¡†æ¶ï¼Œæè¿°äº†åœ¨å„ç§ä¸åŒåœºæ™¯ä¸‹ï¼Œå¤šä¸ªåº”ç”¨ä¹‹é—´çš„æˆæƒé—®é¢˜ã€‚æœ‰æµ·é‡çš„èµ„æ–™éœ€è¦å­¦ä¹ ï¼Œè¦å®Œå…¨ç†è§£éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚\n> OAuth2ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„æ ‡å‡†åè®®ï¼Œå› æ­¤åœ¨å®æ–½è¿‡ç¨‹ä¸­æ›´å®¹æ˜“å‡ºé”™ã€‚\n\näº†è§£äº†ä»¥ä¸Šä¸¤ç§æ–¹å¼åï¼Œç°åœ¨ç»ˆäºåˆ°äº†æœ¬ç¯‡çš„é‡ç‚¹ï¼ŒJWT è®¤è¯ã€‚\n\n## JWT è®¤è¯\n\n> `Json web token (JWT)`, æ ¹æ®å®˜ç½‘çš„å®šä¹‰ï¼Œæ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆ(RFC 7519).è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚\n\n### JWT ç‰¹ç‚¹\n\n* ä½“ç§¯å°ï¼Œå› è€Œä¼ è¾“é€Ÿåº¦å¿«\n* ä¼ è¾“æ–¹å¼å¤šæ ·ï¼Œå¯ä»¥é€šè¿‡URL/POSTå‚æ•°/HTTPå¤´éƒ¨ç­‰æ–¹å¼ä¼ è¾“\n* ä¸¥æ ¼çš„ç»“æ„åŒ–ã€‚å®ƒè‡ªèº«ï¼ˆåœ¨ payload ä¸­ï¼‰å°±åŒ…å«äº†æ‰€æœ‰ä¸ç”¨æˆ·ç›¸å…³çš„éªŒè¯æ¶ˆæ¯ï¼Œå¦‚ç”¨æˆ·å¯è®¿é—®è·¯ç”±ã€è®¿é—®æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ— éœ€å†å»è¿æ¥æ•°æ®åº“éªŒè¯ä¿¡æ¯çš„æœ‰æ•ˆæ€§ï¼Œå¹¶ä¸” payload æ”¯æŒä¸ºä½ çš„åº”ç”¨è€Œå®šåˆ¶åŒ–ã€‚\n* æ”¯æŒè·¨åŸŸéªŒè¯ï¼Œå¯ä»¥åº”ç”¨äºå•ç‚¹ç™»å½•ã€‚\n\n### JWTåŸç†\n\nJWTæ˜¯Auth0æå‡ºçš„é€šè¿‡å¯¹JSONè¿›è¡ŒåŠ å¯†ç­¾åæ¥å®ç°æˆæƒéªŒè¯çš„æ–¹æ¡ˆï¼Œç¼–ç ä¹‹åçš„JWTçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ä¸€ä¸²å­—ç¬¦ï¼š\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ  \n```\nç”± `.` åˆ†ä¸ºä¸‰æ®µï¼Œé€šè¿‡è§£ç å¯ä»¥å¾—åˆ°ï¼š\n\n#### 1. å¤´éƒ¨ï¼ˆHeaderï¼‰\n\n```python\n// åŒ…æ‹¬ç±»åˆ«ï¼ˆtypï¼‰ã€åŠ å¯†ç®—æ³•ï¼ˆalgï¼‰ï¼›\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n```\n\njwtçš„å¤´éƒ¨åŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š\n\n* å£°æ˜ç±»å‹ï¼Œè¿™é‡Œæ˜¯jwt\n* å£°æ˜åŠ å¯†çš„ç®—æ³• é€šå¸¸ç›´æ¥ä½¿ç”¨ HMAC SHA256\n\nç„¶åå°†å¤´éƒ¨è¿›è¡Œbase64åŠ å¯†ï¼ˆè¯¥åŠ å¯†æ˜¯å¯ä»¥å¯¹ç§°è§£å¯†çš„)ï¼Œæ„æˆäº†ç¬¬ä¸€éƒ¨åˆ†ã€‚\n\n```sh\neyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9\n```\n\n#### 2. è½½è·ï¼ˆpayloadï¼‰\n\nè½½è·å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ã€‚è¿™äº›æœ‰æ•ˆä¿¡æ¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š\n\n* æ ‡å‡†ä¸­æ³¨å†Œå£°æ˜\n* å…¬å…±çš„å£°å\n* ç§æœ‰çš„å£°æ˜\n\n`å…¬å…±çš„å£°æ˜ ï¼š`\nå…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯.ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†ã€‚\n\n`ç§æœ‰çš„å£°æ˜ ï¼š`\nç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64æ˜¯å¯¹ç§°è§£å¯†çš„ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\n\n``` python\n// åŒ…æ‹¬éœ€è¦ä¼ é€’çš„ç”¨æˆ·ä¿¡æ¯ï¼›\n{ \"iss\": \"Online JWT Builder\", \n  \"iat\": 1416797419, \n  \"exp\": 1448333419, \n  \"aud\": \"www.gusibi.com\", \n  \"sub\": \"uid\", \n  \"nickname\": \"goodspeed\", \n  \"username\": \"goodspeed\", \n  \"scopes\": [ \"admin\", \"user\" ] \n}\n```\n\n* iss: è¯¥JWTçš„ç­¾å‘è€…ï¼Œæ˜¯å¦ä½¿ç”¨æ˜¯å¯é€‰çš„ï¼›\n* sub: è¯¥JWTæ‰€é¢å‘çš„ç”¨æˆ·ï¼Œæ˜¯å¦ä½¿ç”¨æ˜¯å¯é€‰çš„ï¼›\n* aud: æ¥æ”¶è¯¥JWTçš„ä¸€æ–¹ï¼Œæ˜¯å¦ä½¿ç”¨æ˜¯å¯é€‰çš„ï¼›\n* exp(expires): ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªUnixæ—¶é—´æˆ³ï¼Œæ˜¯å¦ä½¿ç”¨æ˜¯å¯é€‰çš„ï¼›\n* iat(issued at): åœ¨ä»€ä¹ˆæ—¶å€™ç­¾å‘çš„(UNIXæ—¶é—´)ï¼Œæ˜¯å¦ä½¿ç”¨æ˜¯å¯é€‰çš„ï¼›\n\nå…¶ä»–è¿˜æœ‰ï¼š\n\n* nbf (Not Before)ï¼šå¦‚æœå½“å‰æ—¶é—´åœ¨nbfé‡Œçš„æ—¶é—´ä¹‹å‰ï¼Œåˆ™Tokenä¸è¢«æ¥å—ï¼›ä¸€èˆ¬éƒ½ä¼šç•™ä¸€äº›ä½™åœ°ï¼Œæ¯”å¦‚å‡ åˆ†é’Ÿï¼›ï¼Œæ˜¯å¦ä½¿ç”¨æ˜¯å¯é€‰çš„ï¼›\n* jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§tokenï¼Œä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚\n\nå°†ä¸Šé¢çš„JSONå¯¹è±¡è¿›è¡Œ`base64ç¼–ç `å¯ä»¥å¾—åˆ°ä¸‹é¢çš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå­—ç¬¦ä¸²æˆ‘ä»¬å°†å®ƒç§°ä½œJWTçš„Payloadï¼ˆè½½è·ï¼‰ã€‚\n\n```\neyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE0MTY3OTc0MTksImV4cCI6MTQ0ODMzMzQxOSwiYXVkIjoid3d3Lmd1c2liaS5jb20iLCJzdWIiOiIwMTIzNDU2Nzg5Iiwibmlja25hbWUiOiJnb29kc3BlZWQiLCJ1c2VybmFtZSI6Imdvb2RzcGVlZCIsInNjb3BlcyI6WyJhZG1pbiIsInVzZXIiXX0\n```\n> `ä¿¡æ¯ä¼šæš´éœ²`ï¼šç”±äºè¿™é‡Œç”¨çš„æ˜¯å¯é€†çš„base64 ç¼–ç ï¼Œæ‰€ä»¥ç¬¬äºŒéƒ¨åˆ†çš„æ•°æ®å®é™…ä¸Šæ˜¯æ˜æ–‡çš„ã€‚æˆ‘ä»¬åº”è¯¥é¿å…åœ¨è¿™é‡Œå­˜æ”¾ä¸èƒ½å…¬å¼€çš„éšç§ä¿¡æ¯ã€‚\n\n#### 3. ç­¾åï¼ˆsignatureï¼‰\n\n```python\n// æ ¹æ®algç®—æ³•ä¸ç§æœ‰ç§˜é’¥è¿›è¡ŒåŠ å¯†å¾—åˆ°çš„ç­¾åå­—ä¸²ï¼›\n// è¿™ä¸€æ®µæ˜¯æœ€é‡è¦çš„æ•æ„Ÿä¿¡æ¯ï¼Œåªèƒ½åœ¨æœåŠ¡ç«¯è§£å¯†ï¼›\nHMACSHA256(  \n    base64UrlEncode(header) + \".\" +\n    base64UrlEncode(payload),\n    SECREATE_KEY\n)\n```\n\njwtçš„ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾è¯ä¿¡æ¯ï¼Œè¿™ä¸ªç­¾è¯ä¿¡æ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n\n* header (base64åçš„)\n* payload (base64åçš„)\n* secret\n\nå°†ä¸Šé¢çš„ä¸¤ä¸ªç¼–ç åçš„å­—ç¬¦ä¸²éƒ½ç”¨å¥å·.è¿æ¥åœ¨ä¸€èµ·ï¼ˆå¤´éƒ¨åœ¨å‰ï¼‰ï¼Œå°±å½¢æˆäº†:\n\n```\neyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJKb2huIFd1IEpXVCIsImlhdCI6MTQ0MTU5MzUwMiwiZXhwIjoxNDQxNTk0NzIyLCJhdWQiOiJ3d3cuZXhhbXBsZS5jb20iLCJzdWIiOiJqcm9ja2V0QGV4YW1wbGUuY29tIiwiZnJvbV91c2VyIjoiQiIsInRhcmdldF91c2VyIjoiQSJ9\n```\n\næœ€åï¼Œæˆ‘ä»¬å°†ä¸Šé¢æ‹¼æ¥å®Œçš„å­—ç¬¦ä¸²ç”¨HS256ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚åœ¨åŠ å¯†çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚å¦‚æœæˆ‘ä»¬ç”¨ `secret` ä½œä¸ºå¯†é’¥çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬åŠ å¯†åçš„å†…å®¹:\n\n```\npq5IDv-yaktw6XEa5GEv07SzS9ehe6AcVSdTj0Ini4o\n```\n\nå°†è¿™ä¸‰éƒ¨åˆ†ç”¨.è¿æ¥æˆä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²,æ„æˆäº†æœ€ç»ˆçš„jwt:\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJPbmxpbmUgSldUIEJ1aWxkZXIiLCJpYXQiOjE0MTY3OTc0MTksImV4cCI6MTQ0ODMzMzQxOSwiYXVkIjoid3d3Lmd1c2liaS5jb20iLCJzdWIiOiIwMTIzNDU2Nzg5Iiwibmlja25hbWUiOiJnb29kc3BlZWQiLCJ1c2VybmFtZSI6Imdvb2RzcGVlZCIsInNjb3BlcyI6WyJhZG1pbiIsInVzZXIiXX0.pq5IDv-yaktw6XEa5GEv07SzS9ehe6AcVSdTj0Ini4o\n```\n\n> `ç­¾åçš„ç›®çš„`ï¼šç­¾åå®é™…ä¸Šæ˜¯å¯¹å¤´éƒ¨ä»¥åŠè½½è·å†…å®¹è¿›è¡Œç­¾åã€‚æ‰€ä»¥ï¼Œå¦‚æœæœ‰äººå¯¹å¤´éƒ¨ä»¥åŠè½½è·çš„å†…å®¹è§£ç ä¹‹åè¿›è¡Œä¿®æ”¹ï¼Œå†è¿›è¡Œç¼–ç çš„è¯ï¼Œé‚£ä¹ˆæ–°çš„å¤´éƒ¨å’Œè½½è·çš„ç­¾åå’Œä¹‹å‰çš„ç­¾åå°±å°†æ˜¯ä¸ä¸€æ ·çš„ã€‚è€Œä¸”ï¼Œå¦‚æœä¸çŸ¥é“æœåŠ¡å™¨åŠ å¯†çš„æ—¶å€™ç”¨çš„å¯†é’¥çš„è¯ï¼Œå¾—å‡ºæ¥çš„ç­¾åä¹Ÿä¸€å®šä¼šæ˜¯ä¸ä¸€æ ·çš„ã€‚\n> è¿™æ ·å°±èƒ½ä¿è¯tokenä¸ä¼šè¢«ç¯¡æ”¹ã€‚\n\ntoken ç”Ÿæˆå¥½ä¹‹åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç”¨tokenæ¥å’ŒæœåŠ¡å™¨è¿›è¡Œé€šè®¯äº†ã€‚\n\nä¸‹å›¾æ˜¯client ä½¿ç”¨ JWT ä¸server äº¤äº’è¿‡ç¨‹:\n\n![client ä½¿ç”¨ JWT ä¸server äº¤äº’è¿‡ç¨‹](http://media.gusibi.mobi/o-dTqqd8zFCnMRDTifTFZJ-8ASvco764IQHFQt5fYDQDmNPn_XuCgMNy_XSUYh1N)\n\nè¿™é‡Œåœ¨ç¬¬ä¸‰æ­¥æˆ‘ä»¬å¾—åˆ° JWT ä¹‹åï¼Œéœ€è¦å°†JWTå­˜æ”¾åœ¨ clientï¼Œä¹‹åçš„æ¯æ¬¡éœ€è¦è®¤è¯çš„è¯·æ±‚éƒ½è¦æŠŠJWTå‘é€è¿‡æ¥ã€‚ï¼ˆè¯·æ±‚æ—¶å¯ä»¥æ”¾åˆ° header çš„ Authorization ï¼‰\n\n### JWT ä½¿ç”¨åœºæ™¯\n\nJWTçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºä½¿ç”¨æ— çŠ¶æ€ã€å¯æ‰©å±•çš„æ–¹å¼å¤„ç†åº”ç”¨ä¸­çš„ç”¨æˆ·ä¼šè¯ã€‚æœåŠ¡ç«¯å¯ä»¥é€šè¿‡å†…åµŒçš„å£°æ˜ä¿¡æ¯ï¼Œå¾ˆå®¹æ˜“åœ°è·å–ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦å»è®¿é—®ç”¨æˆ·æˆ–ä¼šè¯çš„æ•°æ®åº“ã€‚åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼çš„é¢å‘æœåŠ¡çš„æ¡†æ¶ä¸­ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœç³»ç»Ÿä¸­éœ€è¦ä½¿ç”¨é»‘åå•å®ç°é•¿æœŸæœ‰æ•ˆçš„tokenåˆ·æ–°æœºåˆ¶ï¼Œè¿™ç§æ— çŠ¶æ€çš„ä¼˜åŠ¿å°±ä¸æ˜æ˜¾äº†ã€‚\n\n> `ä¼˜ç‚¹`\nå¿«é€Ÿå¼€å‘\nä¸éœ€è¦cookie\nJSONåœ¨ç§»åŠ¨ç«¯çš„å¹¿æ³›åº”ç”¨\nä¸ä¾èµ–äºç¤¾äº¤ç™»å½•\nç›¸å¯¹ç®€å•çš„æ¦‚å¿µç†è§£\n\n> `ç¼ºç‚¹`\nTokenæœ‰é•¿åº¦é™åˆ¶\nTokenä¸èƒ½æ’¤é”€\néœ€è¦tokenæœ‰å¤±æ•ˆæ—¶é—´é™åˆ¶(exp)\n\n## python ä½¿ç”¨JWTå®è·µ\n\næˆ‘åŸºæœ¬æ˜¯ä½¿ç”¨ python ä½œä¸ºæœåŠ¡ç«¯è¯­è¨€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [pyjwtï¼šhttps://github.com/jpadilla/pyjwt/](https://github.com/jpadilla/pyjwt/)\n\nä½¿ç”¨æ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸‹è¾¹æ˜¯æˆ‘åœ¨åº”ç”¨ä¸­ä½¿ç”¨çš„ä¾‹å­ï¼š\n\n```python\nimport jwt\nimport time\n\n# ä½¿ç”¨ sanic ä½œä¸ºrestful api æ¡†æ¶ \ndef create_token(request):\n    grant_type = request.json.get('grant_type')\n    username = request.json['username']\n    password = request.json['password']\n    if grant_type == 'password':\n        account = verify_password(username, password)\n    elif grant_type == 'wxapp':\n        account = verify_wxapp(username, password)\n    if not account:\n        return {}\n    payload = {\n        \"iss\": \"gusibi.com\",\n         \"iat\": int(time.time()),\n         \"exp\": int(time.time()) + 86400 * 7,\n         \"aud\": \"www.gusibi.com\",\n         \"sub\": account['_id'],\n         \"username\": account['username'],\n         \"scopes\": ['open']\n    }\n    token = jwt.encode(payload, 'secret', algorithm='HS256')\n    return True, {'access_token': token, 'account_id': account['_id']}\n    \n\ndef verify_bearer_token(token):\n    #  å¦‚æœåœ¨ç”Ÿæˆtokençš„æ—¶å€™ä½¿ç”¨äº†audå‚æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒçš„æ—¶å€™ä¹Ÿéœ€è¦æ·»åŠ æ­¤å‚æ•°\n    payload = jwt.decode(token, 'secret', audience='www.gusibi.com', algorithms=['HS256'])\n    if payload:\n        return True, token\n    return False, token\n```\n\nè¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ jwt ç›´æ¥ç”Ÿæˆ tokenï¼Œä¸ç”¨æ‰‹åŠ¨base64åŠ å¯†å’Œæ‹¼æ¥ã€‚\n\nè¯¦ç»†ä»£ç å¯ä»¥å‚è€ƒ [gusibi/Metis: ä¸€ä¸ªæµ‹è¯•ç±»å°ç¨‹åºï¼ˆåŒ…å«å‰åç«¯ä»£ç ï¼‰](https://github.com/gusibi/Metis/blob/master/apis/verification.py)ã€‚\n\n> è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œapi ä½¿ç”¨ python sanicï¼Œæ–‡æ¡£ä½¿ç”¨ [swagger-py-codegen](https://github.com/guokr/swagger-py-codegen) ç”Ÿæˆï¼Œæä¾› swagger uiã€‚\n\nç°åœ¨å¯ä»¥ä½¿ç”¨ swagger ui æ¥æµ‹è¯•jwtã€‚\n\n![swagger ui ç•Œé¢](http://media.gusibi.mobi/QJiuK_OVWOjin9Lrh_Z9Y3Q8TKce5XAHgU1v4p7e7XG-TpS4rowapEbjl--zoMle)\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»äº† jwt çš„åŸç†ã€éªŒè¯æ­¥éª¤ï¼Œæœ€åæ˜¯ä½¿ç”¨ `pyjwt` åŒ…æ¼”ç¤º ç”Ÿæˆtokenä»¥åŠæ ¡éªŒtokençš„æ–¹æ³•ã€‚\n\n> ä»¥ä¸Šæåˆ°çš„åŒ…å¯ä»¥åœ¨`å…¬å·å›å¤å…³é”®å­—`è·å–åœ°å€\n\n### é¢„å‘Šï¼Œä¸‹ä¸€ç¯‡æ˜¯ä»‹ç»å°ç¨‹åºä¸­ä½¿ç”¨ JWT çš„è®¤è¯æµç¨‹åŠå®ç°ã€‚ \n\n## å‚è€ƒé“¾æ¥\n\n* [HTTPåŸºæœ¬è®¤è¯](https://zh.wikipedia.org/wiki/HTTPåŸºæœ¬è®¤è¯)\n* [è®¿é—®éœ€è¦HTTP Basic Authenticationè®¤è¯çš„èµ„æºçš„å„ç§è¯­è¨€çš„å®ç°](http://www.cnblogs.com/QLeelulu/archive/2009/11/22/1607898.html)\n* [ç†è§£OAuth 2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)\n* [OAuth 2å’ŒJWT - å¦‚ä½•è®¾è®¡å®‰å…¨çš„APIï¼Ÿ](http://moakap.leanote.com/post/OAuth-2-vs.-JSON-Web-Token-JWT-å¦‚ä½•è®¾è®¡å®‰å…¨çš„APIï¼Ÿ)\n* [Securing RESTful Web Services with OAuth2](https://content.pivotal.io/blog/securing-restful-web-services-with-oauth2)\n* [Server ç«¯çš„è®¤è¯â€”â€”æ‹¥æŠ± ](https://juejin.im/entry/581c8e92bf22ec0068c0cbfc)\n* [JSON Web Token - åœ¨Webåº”ç”¨é—´å®‰å…¨åœ°ä¼ é€’ä¿¡æ¯](http://blog.leapoahead.com/2015/09/06/understanding-jwt/)\n* [å…«å¹…æ¼«ç”»ç†è§£ä½¿ç”¨JSON Web](http://blog.leapoahead.com/2015/09/07/user-authentication-with-jwt/)\n* [åŸºäºTokençš„WEBåå°è®¤è¯æœºåˆ¶](http://www.cnblogs.com/xiekeli/p/5607107.html)\n* [ä»€ä¹ˆæ˜¯ JWT -- JSON WEB TOKEN](http://www.jianshu.com/p/576dbf44b2ae)\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "ç†è§£JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯åŠå®è·µ",
        "date": "2017-07-23 13:05:57",
        "tags": [
          "restful",
          "tutorial",
          "swagger"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "jwt-learn-and-practice-with"
    },
    {
      "content": "> è¿™æ˜¯CSSè®¾è®¡æŒ‡å—çš„è¯»ä¹¦ç¬”è®°ï¼Œç”¨äºåŠ æ·±å­¦ä¹ æ•ˆæœã€‚\n\nä¸Šä¸€ç¯‡ä»‹ç»äº†css çš„å·¥ä½œåŸç†ï¼Œè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»`ç›’å­æ¨¡å‹`å’Œ`æµ®åŠ¨`ã€‚\n\n## ç›’å­æ¨¡å‹\n\n> æ‰€è°“ç›’å­æ¨¡å‹ï¼Œå°±æ˜¯æµè§ˆå™¨ä¸ºé¡µé¢ä¸­çš„æ¯ä¸ªHTMLå…ƒç´ ç”Ÿæˆçš„çŸ©å½¢ç›’å­ã€‚è¿™äº›ç›’å­ä»¬éƒ½è¦æŒ‰ç…§å¯è§ç‰ˆå¼æ¨¡å‹åœ¨é¡µé¢ä¸Šæ’å¸ƒã€‚\n\nHUGOMORE42\n\nå¯è§çš„é¡µé¢ç‰ˆå¼ä¸»è¦ç”±ä¸‰ä¸ªå±æ€§æ§åˆ¶ï¼špositionã€displayå’Œfloatã€‚\n\n* positionï¼šæ§åˆ¶é¡µé¢ä¸Šå…ƒç´ çš„ä½ç½®å…³ç³»\n* displayï¼šæ§åˆ¶å…ƒç´ æ˜¯å †å ã€å¹¶æ’è¿˜æ˜¯ä¸åœ¨é¡µé¢å‡ºç°\n* floatï¼šæä¾›æ§åˆ¶çš„æ–¹å¼ï¼Œä»¥ä¾¿å§å…ƒç´ ç»„æˆå¤šæ å¸ƒå±€\n\nå…ƒç´ ç›’å­çš„å±æ€§å¯ä»¥åˆ†æˆä¸‰ç»„ï¼š\n\n* è¾¹æ¡†(board)ã€‚å¯ä»¥ç”šè‡³è¾¹æ¡†çš„å®½çª„ã€æ ·å¼å’Œé¢œè‰²\n* å†…è¾¹è·(padding)ã€‚å¯ä»¥ç”šè‡³ç›’å­å†…å®¹åŒºä¸è¾¹æ¡†çš„é—´è·\n* å¤–è¾¹è·(margin)ã€‚å¯ä»¥è®¾ç½®ç›’å­ä¸ç›¸é‚»å…ƒç´ çš„é—´è·\n\n\n![ç›’æ¨¡å‹ç¤ºæ„å›¾å±•ç¤ºäº†HTMLå…ƒç´ çš„è¾¹æ¡†ã€å†…è¾¹è·å’Œå¤–è¾¹è·ä¹‹é—´çš„å…³ç³»](http://omuo4kh1k.bkt.clouddn.com/4J2VDi7TIFFuSOVgWp-3uuDrzvYh7oMDxeNv5OxgpaQoUGlHPo8tL43fAa5iheKn)\n\nå…ƒç´ ç›’å­è¿˜æœ‰ä¸€ä¸ªèƒŒæ™¯å±‚ï¼Œå¯ä»¥æ”¹å˜é¢œè‰²ï¼Œä¹Ÿå¯ä»¥æ·»åŠ å›¾ç‰‡ã€‚\n\n### ç®€å†™æ ·å¼\n\nCSSä¸ºè¾¹æ¡†ã€å†…è¾¹è·å’Œå¤–è¾¹è·åˆ†åˆ«è§„å®šäº†ç®€å†™å±æ€§ï¼Œæ¯ä¸ªç®€å†™å£°æ˜ä¸­ï¼Œå±æ€§å€¼å¾—é¡ºåºéƒ½æ˜¯ä¸Šã€å³ã€ä¸‹ã€å·¦ã€‚\n\næ¯”å¦‚ï¼š\n\n```css\n{\n  margin-top: 5px; \n  margin-right: 10px;\n  margin-bottom: 12px; \n  margin-left: 8px;\n}\n```\n\nä½¿ç”¨ç®€å†™åˆ™ä¸ºè¿™æ ·ï¼š\n\n```css\n{\n    margin: 12px 10px 12px 8px;\n}\n```\nå¦‚æœæœ‰ä¸€ä¸ªå€¼æ²¡å†™ï¼Œé‚£ä¹ˆåˆ™ä½¿ç”¨å¯¹è¾¹çš„å€¼ã€‚\n\næ¯”å¦‚ï¼š\n\n```css\n{margin: 12px 10px 12px;}\n/*ç­‰åŒäº*/\n{\n    margin: 12px 10px 12px 10px;\n}\n```\n\nå¦‚æœåªå†™ä¸€ä¸ªå€¼ï¼Œåˆ™4ä¸ªè¾¹éƒ½å–è¿™ä¸ªå€¼ã€‚\n\n```css\n{margin: 12px;}\n/*ç­‰åŒäº*/\n{margin: 12px 12px 12px 12px;}\n```\n\nå¦å¤–æ¯ä¸ªç›’å­çš„å±æ€§ä¹Ÿåˆ†ä¸‰ä¸ªç²’åº¦ï¼Œè¿™ä¸‰ä¸ªç²’åº¦ä»ä¸€èˆ¬åˆ°ç‰¹æ®Šåˆ†åˆ«ä¸¾ä¾‹å¦‚ä¸‹ï¼š\n\n```css\n{\n    border: 2px dashed red;\n}\n```\n\næ··åˆä½¿ç”¨ä¸‰ç§ç²’åº¦çš„ç®€å†™å±æ€§è¾¾æˆè®¾è®¡ç›®æ ‡æ˜¯å¾ˆå¸¸è§çš„ã€‚æ¯”å¦‚ï¼Œæƒ³ä¸ºç›’å­çš„ä¸Šè¾¹å’Œä¸‹è¾¹æ·»åŠ 4åƒç´ çš„çº¢è‰²è¾¹æ¡†ï¼Œä¸ºå·¦è¾¹æ·»åŠ 1åƒç´ å®½çš„çº¢è‰²è¾¹æ¡†ï¼Œè€Œå³è¾¹æ²¡æœ‰ã€‚å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```css\n{border: 4px solid red;} /* å…ˆç»™4æ¡è¾¹è®¾ç½®ç›¸åŒçš„æ ·å¼*/\n{border-left-width: 1px;} /* ä¿®æ”¹å·¦è¾¹æ¡†å®½åº¦*/\n{border-fight: none;} /*ç§»å‡ºå³è¾¹æ¡†*/\n```\n\n### ç›’å­è¾¹æ¡†\n\nborder æœ‰ä¸‰ä¸ªç›¸å…³å±æ€§ã€‚\n\n* å®½åº¦ï¼ˆborder-width)ã€‚å¯ä»¥ä½¿ç”¨thinã€mediumå’Œthickç­‰æ–‡æœ¬å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é™¤ç™¾åˆ†æ¯”å’Œè´Ÿå€¼ä¹‹å¤–çš„ä»»ä½•ç»å¯¹å€¼ã€‚\n* æ ·å¼ï¼ˆborder-style)ã€‚æœ‰noneã€hiddenã€dottedã€dashedç­‰æ–‡æœ¬å€¼ã€‚\n* é¢œè‰²ï¼ˆborder-colorï¼‰ã€‚å¯ä»¥ä½¿ç”¨ä»»æ„é¢œè‰²å€¼ï¼ŒåŒ…æ‹¬RGBã€HSLã€åå…­è¿›åˆ¶é¢œè‰²å€¼å’Œé¢œè‰²å…³é”®å­—ã€‚\n\n### ç›’å­å†…è¾¹è·\n\nå†…è¾¹è·æ˜¯ç›’å­å†…å®¹åŒºä¸ç›’å­è¾¹æ¡†ä¹‹é—´çš„è·ç¦»ã€‚\n\n![](http://omuo4kh1k.bkt.clouddn.com/sKiD0I3LeE7lTK8rARqH8TFpzVK9vh4QoAWCg_7Ll7m9V8VMkBNKY_YfvVUueia8)\n\nä¸Šå›¾çš„æ ·å¼ä¸ºï¼š\n\n```css\np {\n    font: 16px helvetica, sans-serif; \n    width: 220px; \n    border: 2px solid red; \n    background-color: #caebff;\n}\n```\nå¯ä»¥çœ‹åˆ°åœ¨æ²¡æœ‰è®¾å®šå†…è¾¹è·çš„æƒ…å†µä¸‹ï¼Œå†…å®¹ç´§æŒ¨ç€è¾¹æ¡†ã€‚\n\nè®¾å®šè¾¹æ¡†åï¼š\n\n```css\np {\n    font: 16px helvetica, arial, sans-serif; \n    width: 220px; \n    border: 2px solid red; \n    background-color: #caebff; \n    padding: 10px;\n}\n```\næ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ ·å¼èˆ’æœäº†å¾ˆå¤šï¼š\n\n![æ·»åŠ å†…è¾¹è·åçš„æ•ˆæœå›¾](http://omuo4kh1k.bkt.clouddn.com/k6hxSxGq2igZL_RfVnFVqsdD-kX40LgyIPKoXyOprfTQfgL2DdnU4RRBB0c7qYXB)\n\n> å†…è¾¹è·åœ¨ç›’å­çš„å†…éƒ¨ï¼Œæ‰€ä»¥ä¹Ÿä¼šå–å¾—ç›’å­èƒŒæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šå‡ºæ¥çš„å†…è¾¹è·å¹¶æ²¡æœ‰æŒ¤å‹æ–‡æœ¬å†…å®¹ï¼Œå®é™…æ˜¯åŠ åœ¨äº†å£°æ˜çš„ç›’å­å®½åº¦ä¹‹ä¸Šã€‚\n\n### ç›’å­å¤–è¾¹è·\n\n![å¤–è¾¹è·çš„ä¾‹å­](http://media.gusibi.mobi/nU6FAYz7aFdQrfj7ByrBHbcvJx5F86G_jlpttdfaGt24vpb4KsYUln3JuVW7ZZ14)\n\nä¸Šå›¾çš„ä¾‹å­ä¸­ï¼Œç¬¬ä¸€ç»„æ˜¯é»˜è®¤æƒ…å†µï¼Œç¬¬äºŒç»„æ˜¯åœ¨ç¬¬ä¸€ç»„åŸºç¡€ä¸Šæ·»åŠ äº†è¾¹æ¡†ï¼Œç¬¬ä¸‰ç»„æ˜¯æŠŠç¬¬äºŒç»„çš„å¤–è¾¹è·è®¾ç½®ä¸ºäº†0ï¼Œæ ‡é¢˜å’Œæ®µè½å…¨ç´§æŒ¨åœ¨ä¸€èµ·äº†ã€‚\n\n> æ¨èå¤§å®¶å§è¿™æ¡è§„åˆ™ä½œä¸ºæ ·å¼è¡¨çš„ç¬¬ä¸€æ¡è§„åˆ™ï¼š\n\n```css\n* {margin: 0; padding: 0;}\n```\n\nè¿™æ¡è§„åˆ™æ˜¯æŠŠæ‰€æœ‰å…ƒç´ é»˜è®¤çš„å¤–è¾¹è·å’Œå†…è¾¹è·éƒ½è®¾å®šä¸º0ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºé‚£äº›çœŸæ­£éœ€è¦æ·»åŠ è¾¹è·çš„å…ƒç´ è®¾å®šè¾¹è·ã€‚\n\n### å åŠ å¤–è¾¹è·\n\næ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæ ·å¼ï¼š\n\n```css\np {\n    height: 50px;\n    border: 1px solid #000;\n    backgroundcolor: #fff;\n    margin-top: 50px;\n    margin-bottom: 30px;\n}\n```\n\nå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªæ ·å¼åº”ç”¨åˆ°3ä¸ªå‰åç›¸æ¥çš„æ®µè½ä¸Šï¼Œç”±äºä¸Šè¾¹è·å’Œä¸‹è¾¹è·ç›¸é‚»ï¼Œ`ä½ å¯èƒ½ä¼šè®¤ä¸ºä»–ä»¬ä¹‹é—´çš„å¤–è¾¹è·æ˜¯80ï¼ˆ50+30ï¼‰åƒç´ ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯50åƒç´ `ï¼Œè¿™å°±æ˜¯è¾¹è·å åŠ ã€‚\n\n> å‚ç›´æ–¹å‘ä¸Šå¤–è¾¹è·ä¼šå åŠ  æ°´å¹³æ–¹å‘çš„ä¸ä¼š\n> `å¤–è¾¹è·å•ä½` æ ¹æ®ç»éªŒï¼Œæ°´å¹³è¾¹è·å¯ä»¥ä½¿ç”¨åƒç´ ï¼Œä»¥ä¾¿è¯¥æ®µæ–‡æœ¬å§‹ç»ˆä¸åŒ…å«å…ƒç´ è¾¹ç•Œä¿æŒå›ºå®šé—´è·ï¼Œä¸å—è‡ªè±ªå˜å¤§æˆ–å˜å°çš„å½±å“ã€‚è€Œå¯¹äºä¸Šä¸‹å¤–è¾¹è·ï¼Œå·²`em` ä¸ºå•ä½åˆ™å¯ä»¥è®©æ®µé—´è·éšå­—å·å˜åŒ–è€Œç›¸åº”å¢å¤§æˆ–ç¼©å°ã€‚\n\n\n### ç›’å­æœ‰å¤šå¤§\n\n### æ²¡æœ‰å®½åº¦çš„ç›’å­\n\nå¦‚æœæ²¡æœ‰æ˜¾å¼çš„è®¾ç½®å…ƒç´ çš„ `width` å±æ€§ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸ªç›’å­æ²¡æœ‰å®½åº¦ã€‚\nå¦‚æœæ²¡æœ‰è®¾å®š widthï¼Œ é‚£ä¹ˆè¿™ä¸ªå±æ€§çš„é»˜è®¤å€¼æ˜¯ autoï¼Œä¼šè®©å…ƒç´ çš„å®½åº¦æ‰©å±•åˆ°ä¸çˆ¶å…ƒç´ åŒå®½ã€‚\n\næˆ‘ä»¬çœ‹ä¸ªä¾‹å­ğŸŒ°ï¼š\n\n```html\n<body>\n<p> è¿™ä¸ªå…ƒç´ æ²¡æœ‰è®¾ç½®å®½åº¦</p>\n</body>\n```\n\nè®¾ç½®æ ·å¼ï¼š\n\n```css\nbody {\n    font-family: helvetica, arial, sans-serif;\n    size: 1em;\n    marging: 0px;\n    background-color: #caebff;\n}\n\np {\n    margin: 0;\n    background-color: #fff;\n}\n```\n\n![ä¸è®¾ç½®å®½åº¦çš„æ ·å¼](http://media.gusibi.mobi/ZzLp1aWGAOITCd_lxtpRdQ6NX1NRqE8Sgjk38YvazbBCB8nExjmrAL5CPZsDAG7U)\n\nå¯ä»¥çœ‹åˆ°ï¼Œä¸ç»™æ®µè½è®¾ç½®å®½åº¦ï¼Œæ®µè½ä¼šå¡«æ»¡ body å…ƒç´ ã€‚\n\nä¸ºäº†æ›´åŠ æ˜æ˜¾ï¼Œæˆ‘ç»™æ®µè½å·¦å³åˆ†åˆ«åŠ ä¸€ä¸ªè¾¹æ¡†ï¼Œå†åŠ ä¸€ä¸ªå¤–è¾¹è·ã€‚\n\n```css\np {\n    margin:0 30px; \n    background-color:#fff; \n    padding:0 20px; \n    border: solid red; \n    border-width: 0 6px;\n}\n```\n\n![æ®µè½æ·»åŠ å·¦å³è¾¹æ¡†](http://media.gusibi.mobi/Wc3Sep8w8seiPVOK-aC70y-maRXmdR0gqqLq9pLXZvjtu0FuTKruWq8mKX_dLMj6)\n\nè¿™æ—¶æ®µè½å†…å®¹åŒºåŸŸå˜æˆäº† 288åƒç´ ï¼ˆæˆ‘æŠŠæµè§ˆå™¨å®½åº¦æ‰‹åŠ¨è°ƒæˆäº†400pxï¼Œ400-(20+6+30)x2ï¼‰ã€‚\n\n> `ç»“è®º`ï¼šæ²¡æœ‰å®½åº¦çš„å…ƒç´ å§‹ç»ˆä¼šæ‰©å±•åˆ°å¡«æ»¡å…¶çˆ¶å…ƒç´ çš„å®½åº¦ä¸ºæ­¢ã€‚æ·»åŠ æ°´å¹³è¾¹æ¡†ã€å†…è¾¹è·å’Œå¤–è¾¹è·ä¼šå¯¼è‡´å†…å®¹å®½åº¦å‡å°‘ï¼Œå‡å°‘é‡ç­‰äºæ°´å¹³è¾¹æ¡†ã€å†…è¾¹è·å’Œå¤–è¾¹è·çš„å’Œã€‚\n\n### æœ‰å®½åº¦çš„ç›’å­\n\nè¿˜æ˜¯ä¸Šè¾¹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å…ˆæŠŠå¤–è¾¹è·å»æ‰ï¼Œå›ºå®šå®½åº¦400pxï¼›\n\n```css\np {\n    width:400px; \n    margin:0; \n    padding:0 20px;  \n    border:solid red;  \n    border-width: 0 6px  0 6px;  \n    background-color:#fff;\n}\n```\n\n![è®¾å®šå®½åº¦ã€å†…è¾¹è·ã€è¾¹æ¡†çš„æ ·å¼](http://media.gusibi.mobi/p-NHopjzQr4Wb9oQGYVrmjTT-kROYvB0p-cBVEW2uEtliPKnMDxZC-0NowuYuzs0)\n\nå¯ä»¥çœ‹åˆ°ï¼Œç›’å­çš„å®½åº¦å¹¶ä¸æ˜¯400pxï¼Œè€Œæ˜¯452åƒç´ ï¼ˆ400+(20+6)*2ï¼‰ã€‚\n\nå†ç»™ç›’å­åŠ ä¸Šå¤–è¾¹è·ï¼š\n\n```css\np {\n    width:400px; \n    margin:0 30px; \n    padding:0 20px;  \n    border:solid red;  \n    border-width: 0 6px  0 6px;  \n    background-color:#fff;\n}\n```\n\n![è®¾å®šå®½åº¦ã€å†…è¾¹è·ã€å¤–è¾¹è·ã€è¾¹æ¡†çš„æ ·å¼](http://media.gusibi.mobi/t1Np4vU0aQAiAJ-anFl4nJEEJVh_58Mtv5wgwG6umS103kIolQz374za8QFWbiP1)\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ—¶æ€»å®½åº¦è¾¾åˆ°äº†512åƒç´ ï¼ˆ30+6+20+400+20+6+30=512ï¼‰\n\n> `ç»“è®º`: ä¸ºè®¾å®šäº†å®½åº¦çš„ç›’å­æ·»åŠ è¾¹æ¡†ã€å†…è¾¹è·å’Œå¤–è¾¹è·ï¼Œä¼šå¯¼è‡´ç›’å­æ›´å®½ã€‚å®é™…ä¸Šç›’å­çš„ width å±æ€§è®¾å®šçš„åªæ˜¯ç›’å­å†…å®¹åŒºçš„å®½åº¦ï¼Œè€Œéç›’å­æ•´ä½“çš„å®½åº¦\n\n## æµ®åŠ¨ä¸æ¸…é™¤\n\n### æµ®åŠ¨\n\ncss è®¾è®¡ floatï¼ˆæµ®åŠ¨ï¼‰å±æ€§çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å®ç°æ–‡æœ¬ç»•æ’å›¾ç‰‡çš„æ•ˆæœï¼Œè¿™ä¸ªå±æ€§ä¹Ÿæ˜¯åˆ›å»ºå¤šæ å¸ƒå±€æœ€ç®€å•çš„æ–¹å¼ã€‚\næˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š\n\n```html\n<img .../>\n<p>..the paragraph text...</p>\n```\n\ncss è§„åˆ™å¦‚ä¸‹ã€‚\n\n```css\np {\n    margin: 0;\n    border: 1px solid red;\n}\nimg {\n    float: left;\n    margin: 0 4px 4px 0;\n}\n```\nè¿™ä¸ªä¾‹å­çš„æ ·å¼å¦‚å›¾æ‰€ç¤ºï¼š\n![](http://media.gusibi.mobi/oO9LyVmGMagZ6OLJTOp6X4cVPsXliIY5i6DgzFeFm7tflJwZeZLbImciTfmC9yDl)\n> è¿™é‡Œæˆ‘ä»¬ç»™å›¾ç‰‡åŠ äº† `float: left` æ ·å¼ï¼Œè¿™æ—¶æµè§ˆå™¨å°±ä¼šæŠŠå›¾ç‰‡å‘ä¸Šæ¨ï¼Œç›´åˆ°å®ƒç¢°åˆ°çˆ¶å…ƒç´ çš„å†…è¾¹ç•Œï¼ˆä¹Ÿå°±æ˜¯bodyï¼‰ã€‚åé¢çš„å†…å®¹ä¸å†è®¤ä¸ºæµ®åŠ¨å…ƒç´ åœ¨å®ƒçš„å‰è¾¹ï¼Œæ‰€ä»¥å®ƒä¼šå æ®çˆ¶å…ƒç´ å·¦ä¸Šè§’çš„ä½ç½®ã€‚ä¸è¿‡ï¼Œå®ƒçš„å†…å®¹ä¼šç»•å¼€æµ®åŠ¨çš„å›¾ç‰‡ã€‚\n\n### åˆ›å»ºåˆ†æ \n\nåœ¨ä¸Šé¢çš„åŸºåˆä¸Šå¦‚ä½•ä½¿å†…å®¹åˆ†æ å‘¢ï¼Ÿ\nåªè¦å†ç”¨ä¸€`float` å±æ€§å°±å¯ä»¥äº†ã€‚\n\n```css\np {\n    float: left; /* åŠ ä¸Šè¿™ä¸¤è¡Œ*/\n    width: 200px;\n    ...\n}\n```\n\n![](http://media.gusibi.mobi/uLsus15W0rQdkt-NzbZwFJuRlczzkEyAWgLb94eGAOGJN-9P_Xi644qyJcgviz8w)\n\nè¿™æ ·åŒæ—¶æµ®åŠ¨å›¾ç‰‡å’Œæœ‰å®½åº¦çš„æ®µè½ï¼Œä¼šä½¿å›¾ç‰‡ç»•æ’æ•ˆæœæ¶ˆå¤±ï¼Œè€Œæµ®åŠ¨çš„æ®µè½ä¹Ÿå‘å·¦å‘ä¸Šç§»åŠ¨ã€‚å˜æˆäº†å¤šæ çš„æ•ˆæœã€‚\n\n### å›´ä½æµ®åŠ¨å…ƒç´ \n\nçœ‹ä¸‹è¿™ä¸ªä¾‹å­ï¼š\n\n```html\n<section>\n    <img src=\"images/rubber_duck2.jpg\">\n    <p>It's fun to float.</p>\n</section>\n<footer>Here is the footer element that runs across</footer>\n```\n\nåº”ç”¨æ ·å¼å¦‚ä¸‹ï¼š\n\n```css\nsection {\n    border: 1px solid blue;\n    margin: 0 0 10px 0;\n}\np {\n    marging: 0;\n}\nfooter {\n    border: 1px solid red;\n}\n```\n\næ•ˆæœå¦‚å›¾ï¼š\n\n![æµ®åŠ¨å›¾ç‰‡åæ ‡é¢˜è·‘åˆ°äº†å³è¾¹ï¼Œä½†çˆ¶å…ƒç´ sectionä¹Ÿæ”¶ç¼©åˆ°åªåŒ…å«æ–‡æœ¬çš„é«˜åº¦](http://media.gusibi.mobi/FgZ9xXjRtez6W2GXoMKbhzDq25LRtJISiO90AYkJ6yEKJ9WB0QUvU1Zz-f7wEmlB)\n\nä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³è®©footer è¢«æåˆ°ä¸Šè¾¹ã€‚\næµ®åŠ¨å…ƒç´ è„±ç¦»äº†åŸæ¥çš„æ–‡æ¡£æµï¼Œä¸å—çˆ¶å…ƒç´ çš„æ§åˆ¶ã€‚å¦‚æœæˆ‘ä»¬æƒ³è®©çˆ¶å…ƒç´ è¿˜åŒ…å«æµ®åŠ¨çš„å­å…ƒç´ ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ\næœ‰ä¸‰ç§æ–¹æ³•ï¼š\n\n#### ä¸ºçˆ¶å…ƒç´ åº”ç”¨ `overflow: hidden`\n\nåªéœ€è¦åœ¨ `section` åŠ ä¸Šè¿™ä¸ªæ ·å¼ï¼š\n```css\nsection {\n    overflow: hidden;\n    ...\n}\n```\nç°åœ¨æ•ˆæœå¦‚å›¾ï¼š\n\n![section åˆåŒ…å›´äº†æµ®åŠ¨çš„å›¾ç‰‡](http://media.gusibi.mobi/Kepon_jsAnaY99ITC0Oc5SapqZD5PjXOhwAuyeX-O8OH2Ag2hmryl9wH5jdI_gSR)\n\n> å®é™…ä¸Šï¼Œ`overflow: hidden` å£°æ˜å‡¯çœŸæ­£ç”¨é€”æ˜¯é˜²æ­¢åŒ…å«å…ƒç´ è¢«è¶…å¤§å†…å®¹æ’‘å¤§ã€‚ä¹Ÿå°±æ˜¯è¯´åº”ç”¨ä¸Šè¿™ä¸ªä¹‹åï¼ŒåŒ…å«å…ƒç´ ï¼ˆçˆ¶å…ƒç´ ï¼‰ä¼šä¿æŒå…¶è®¾å®šçš„å®½åº¦ï¼Œå¦‚æœå­å…ƒç´ è¿‡å¤§ï¼Œä¼šè¢«æˆªæ‰ã€‚\n\n#### æµ®åŠ¨çˆ¶å…ƒç´ \n\nç¬¬äºŒç§æ–¹æ³•æ˜¯è®©çˆ¶å…ƒç´ å’Œå­å…ƒç´ åŒæ—¶æµ®åŠ¨ã€‚\n\n```css\nsection {\n    float: left;\n    width: 100%;\n    border: 1px solid blue;\n}\nimg {\n    float: left;\n}\nfooter {\n    border: 1px solid red;\n    clear: left;\n}\n```\n\næµ®åŠ¨section åï¼Œä¸ç®¡å…¶å­å…ƒç´ æ˜¯å¦æµ®åŠ¨ï¼Œéƒ½ä¼šè¢«åŒ…å›´ã€‚å› æ­¤éœ€è¦ç”¨ `width: 100%` è®©section ä¸æµè§ˆå™¨åŒå®½ã€‚ç”±äºsection ä¹Ÿæµ®åŠ¨ï¼Œæ‰€ä»¥footer ä¼šå¾€å®ƒæ—è¾¹æŒ¤ï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ `clear: left` ä»¥ä¿è¯ä¸ä¼šè¢«æå‡åˆ°æµ®åŠ¨çš„å…ƒç´ æ—è¾¹ã€‚\n\n#### åœ¨çˆ¶å…ƒç´ å†…å®¹çš„æœ«å°¾æ·»åŠ æµ®åŠ¨å…ƒç´ ï¼Œå¯ä»¥ç›´æ¥åœ¨æ ‡è®°ä¸­åŠ ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç»™çˆ¶å…ƒç´ æ·»åŠ clearfix ç±»æ¥åŠ ã€‚\n\nç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ç»™çˆ¶å…ƒç´ æ·»åŠ ä¸€ä¸ªéæµ®åŠ¨çš„å­å…ƒç´ ï¼Œç„¶åæ¸…é™¤è¯¥å­å…ƒç´ ã€‚\n\n> è¿™ç§æ–¹å¼å¯ä»¥ç”Ÿæ•ˆæ˜¯å› ä¸ºçˆ¶å…ƒç´ ä¸€å®šä¼šåŒ…å›´éæµ®åŠ¨å­å…ƒç´ ï¼Œä¸”æ¸…é™¤ä¼šè®©è¿™ä¸ªå­å…ƒç´ å¤„äºæœ€ä¸‹ã€‚\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¥å¥‡çš„ `clearfix` è§„åˆ™ï¼š\n\n```css\n.clearfix:after {\n\t content: \".\";\n\t display: block;\n\t height: 0;\n\t clear: both;\n\t visibility: hidden;\n\t}\n```\n\nè¿™ä¸ª `clearfix` è§„åˆ™æœ€æ—©æ˜¯ç”±ç¨‹åºå‘˜ `Tony Aslett` å‘æ˜çš„ï¼Œå®ƒåªæ·»åŠ äº†ä¸€ä¸ªæ¸…é™¤çš„åŒ…å«å¥ç‚¹ä½œä¸ºéæµ®åŠ¨å…ƒç´ ï¼ˆå¿…é¡»æœ‰å†…å®¹ï¼Œå¥ç‚¹æ˜¯æœ€å°çš„å†…å®¹ï¼‰ã€‚è§„åˆ™ä¸­å…¶ä»–ç”Ÿå‘½æ˜¯ä¸ºäº†ç¡®ä¿è¿™ä¸ªä¼ªå…ƒç´ æ²¡æœ‰é«˜åº¦ï¼Œè€Œä¸”ä¸å¯è§ã€‚\n\n> `after` ä¼šåœ¨å…ƒç´ å†…å®¹ï¼ˆè€Œä¸æ˜¯å…ƒç´ åæ’å…¥ä¸€ä¸ªä¼ªå…ƒç´ ï¼‰\n> ä½¿ç”¨clear: both æ„å‘³ç€ section ä¸­æ–°å¢çš„å­å…ƒç´ ä¼šè¢«æ¸…é™¤å·¦å³æµ®åŠ¨å…ƒç´ ã€‚\n\næˆ‘ä»¬çœ‹äº†ä¸‰ç§æ–¹æ³•å›´ä½æµ®åŠ¨å…ƒç´ çš„æ–¹å¼ã€‚\n\né‚£å¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œå¦‚æœæ¸…é™¤æµ®åŠ¨å‘¢ï¼Ÿ\n\næ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªä¾‹å­ï¼š\n\n```html\n<section>\n    <img src=\"images/rubber_duck3.jpg\">\n    <p>This text sits next to the image and because the text extends below the bottom of the image, the next image positions itself correctly under the previous image.</p>\n    <img src=\"images/beach_ball.jpg\">\n    <p>This text is short, so the next image can float up beside this one.</p>\n    <img src=\"images/yellow_float.jpg\">\n    <p>Because the previous image's text does not extend below it, this image and text move up next to the previous image. This problem can be solved by the use of the clear property.</p>\n</section>\n```\næ ·å¼å¦‚ä¸‹ï¼š\n\n```css\nsection {\n    width:300px; b\n    order:1px solid red;\n}\nimg {\n    float:left; \n    margin:0 4px 4px 0;\n}\np {\n    font-family:helvetica, arial, sans-serif; \n    margin:0 0 5px 0;\n}\n```\n\næ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š\n\n![](http://media.gusibi.mobi/bgZc0EUo1bur6AIje1zvk3hrV2XF4obDGJ3YzGRfDEriPyfneQWQ45Xb5iEVIJCD)\n\nç”±äºç¬¬äºŒå¼ å›¾ä¸‹æ–¹æœ‰ç©ºé—´ï¼Œæ‰€ä»¥ç¬¬ä¸‰å¼ å›¾åŠè¯´æ˜æ–‡å­—ä¼šä¸Šæµ®åˆ°ç¬¬äºŒå¼ å›¾ç‰‡å³ä¾§ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚\n\næˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯å¦‚ä¸‹å›¾è¿™æ ·ï¼š\n\n![](http://media.gusibi.mobi/VBkwrlGf31kzH72-6luCmCeBgqCB2_-8giCfqQtY9KBWV0pU-5KsUFJ8STTJde2J)\n\né‚£æ€ä¹ˆå®ç°å‘¢ï¼Ÿ è¿˜æ˜¯åº”ç”¨ `clearfix` è§„åˆ™ã€‚ä¸ºæ¯ä¸ªæ®µè½åŠ ä¸Šclearfix ç±»ã€‚é€šè¿‡`clearfix`ç±»æ¸…é™¤å…ƒç´ åï¼Œå¸ƒå±€å°±æ˜¯æˆ‘ä»¬å¸Œæœ›çš„äº†ã€‚\n\n\nè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»äº†ç›’å­æ¨¡å‹ï¼Œæµ®åŠ¨å’Œæ¸…é™¤ã€‚ä¸‹ä¸€ç¯‡ä»‹ç»css å¸ƒå±€ã€‚\n\n-------\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "CSSå…¥é—¨æŒ‡å—-2ï¼šç›’å­æ¨¡å‹ã€æµ®åŠ¨å’Œæ¸…é™¤",
        "date": "2017-07-19 14:22:49",
        "tags": [
          "css",
          "è¯»ä¹¦ç¬”è®°",
          "html",
          "tutorial",
          "å‰ç«¯"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "css-learing-2-box-model-float-and-clear"
    },
    {
      "content": "\n> <section class=\"caption\">asyncio </section> ä¸Šä¸€ç¯‡æˆ‘ä»¬ä»‹ç»äº† asyncio åŒ…ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹ç®¡ç†ç½‘ç»œåº”ç”¨ä¸­çš„é«˜å¹¶å‘ã€‚åœ¨è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ä½¿ç”¨ asyncio åŒ…ç¼–ç¨‹çš„ä¸¤ä¸ªä¾‹å­ã€‚\n\n## async/awaitè¯­æ³•\n\næˆ‘ä»¬å…ˆä»‹ç»ä¸‹ async/await è¯­æ³•ï¼Œè¦ä¸ç„¶çœ‹å®Œè¿™ç¯‡å¯èƒ½ä¼šå›°æƒ‘ï¼Œä¸ºä»€ä¹ˆä¹‹å‰ä½¿ç”¨ asyncio.coroutine è£…é¥°å™¨ å’Œ yield fromï¼Œè¿™é‡Œéƒ½æ˜¯ ç”¨çš„ async å’Œ awaitï¼Ÿ\n\n> [pythonå¹¶å‘2ï¼šä½¿ç”¨asyncioå¤„ç†å¹¶å‘](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751998&idx=1&sn=37833d3d7582d38f85a526de7eeda814)\n\nasync/await æ˜¯Python3.5 çš„æ–°è¯­æ³•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\n\n```python\nasync def read_data(db):\n    pass\n```\nasync æ˜¯æ˜ç¡®å°†å‡½æ•°å£°æ˜ä¸ºåç¨‹çš„å…³é”®å­—ï¼Œå³ä½¿æ²¡æœ‰awaitè¡¨è¾¾å¼ï¼Œå‡½æ•°æ‰§è¡Œä¹Ÿä¼šè¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ã€‚\nåœ¨åç¨‹å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥åœ¨æŸä¸ªè¡¨è¾¾å¼ä¹‹å‰ä½¿ç”¨ await å…³é”®å­—æ¥æš‚åœåç¨‹çš„æ‰§è¡Œï¼Œä»¥ç­‰å¾…æŸåç¨‹å®Œæˆï¼š\n\n```python\nasync def read_data(db):\n    data = await db.fetch('SELECT ...')\n```\n\nè¿™ä¸ªä»£ç å¦‚æœä½¿ç”¨ asyncio.coroutine è£…é¥°å™¨è¯­æ³•ä¸ºï¼š\n\n```python\n@asyncio.coroutine\ndef read_data(db):\n    data = yield from db.fetch('SELECT ...')\n```\n\nè¿™ä¸¤æ®µä»£ç æ‰§è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ å¯ä»¥æŠŠ asyncio.coroutine æ›¿æ¢ä¸º asyncï¼Œ yield from æ›¿æ¢ä¸º awaitã€‚\n\nä½¿ç”¨æ–°çš„è¯­æ³•æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼š\n* ä½¿ç”Ÿæˆå™¨å’Œåç¨‹çš„æ¦‚å¿µæ›´å®¹æ˜“ç†è§£ï¼Œå› ä¸ºè¯­æ³•ä¸åŒ\n* å¯ä»¥æ¶ˆé™¤ç”±äºé‡æ„æ—¶ä¸å°å¿ƒç§»å‡ºåç¨‹ä¸­yield å£°æ˜è€Œå¯¼è‡´çš„ä¸æ˜ç¡®é”™è¯¯ï¼Œè¿™å›å¯¼è‡´åç¨‹å˜æˆæ™®é€šçš„ç”Ÿæˆå™¨ã€‚\n\n## ä½¿ç”¨ asyncio åŒ…ç¼–å†™æœåŠ¡å™¨\n\nè¿™ä¸ªä¾‹å­ä¸»è¦æ˜¯ä½¿ç”¨ asyncio åŒ… å’Œ unicodedata æ¨¡å—ï¼Œå®ç°é€šè¿‡è§„èŒƒåç§°æŸ¥æ‰¾Unicode å­—ç¬¦ã€‚\n\næˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä»£ç ï¼š\n\n```python\n# charfinder.py\nimport sys\nimport re\nimport unicodedata\nimport pickle\nimport warnings\nimport itertools\nimport functools\nfrom collections import namedtuple\n\nRE_WORD = re.compile('\\w+')\nRE_UNICODE_NAME = re.compile('^[A-Z0-9 -]+$')\nRE_CODEPOINT = re.compile('U\\+[0-9A-F]{4, 6}')\n\nINDEX_NAME = 'charfinder_index.pickle'\nMINIMUM_SAVE_LEN = 10000\nCJK_UNI_PREFIX = 'CJK UNIFIED IDEOGRAPH'\nCJK_CMP_PREFIX = 'CJK COMPATIBILITY IDEOGRAPH'\n\nsample_chars = [\n    '$',  # DOLLAR SIGN\n    'A',  # LATIN CAPITAL LETTER A\n    'a',  # LATIN SMALL LETTER A\n    '\\u20a0',  # EURO-CURRENCY SIGN\n    '\\u20ac',  # EURO SIGN\n]\n\nCharDescription = namedtuple('CharDescription', 'code_str char name')\n\nQueryResult = namedtuple('QueryResult', 'count items')\n\n\ndef tokenize(text):\n    '''\n    :param text: \n    :return: return iterable of uppercased words \n    '''\n    for match in RE_WORD.finditer(text):\n        yield match.group().upper()\n\n\ndef query_type(text):\n    text_upper = text.upper()\n    if 'U+' in text_upper:\n        return 'CODEPOINT'\n    elif RE_UNICODE_NAME.match(text_upper):\n        return 'NAME'\n    else:\n        return 'CHARACTERS'\n\n\nclass UnicodeNameIndex:\n    # unicode name ç´¢å¼•ç±»\n\n    def __init__(self, chars=None):\n        self.load(chars)\n\n    def load(self, chars=None):\n        # åŠ è½½ unicode name    \n        self.index = None\n        if chars is None:\n            try:\n                with open(INDEX_NAME, 'rb') as fp:\n                    self.index = pickle.load(fp)\n            except OSError:\n                pass\n        if self.index is None:\n            self.build_index(chars)\n        if len(self.index) > MINIMUM_SAVE_LEN:\n            try:\n                self.save()\n            except OSError as exc:\n                warnings.warn('Could not save {!r}: {}'\n                              .format(INDEX_NAME, exc))\n\n    def save(self):\n        with open(INDEX_NAME, 'wb') as fp:\n            pickle.dump(self.index, fp)\n\n    def build_index(self, chars=None):\n        if chars is None:\n            chars = (chr(i) for i in range(32, sys.maxunicode))\n        index = {}\n        for char in chars:\n            try:\n                name = unicodedata.name(char)\n            except ValueError:\n                continue\n            if name.startswith(CJK_UNI_PREFIX):\n                name = CJK_UNI_PREFIX\n            elif name.startswith(CJK_CMP_PREFIX):\n                name = CJK_CMP_PREFIX\n\n            for word in tokenize(name):\n                index.setdefault(word, set()).add(char)\n\n        self.index = index\n\n    def word_rank(self, top=None):\n        # (len(self.index[key], key) æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œéœ€è¦ç”¨list è½¬æˆåˆ—è¡¨ï¼Œè¦ä¸ç„¶ä¸‹è¾¹æ’åºä¼šæŠ¥é”™\n        res = [list((len(self.index[key], key)) for key in self.index)]\n        res.sort(key=lambda  item: (-item[0], item[1]))\n        if top is not None:\n            res = res[:top]\n        return res\n\n    def word_report(self, top=None):\n        for postings, key in self.word_rank(top):\n            print('{:5} {}'.format(postings, key))\n\n    def find_chars(self, query, start=0, stop=None):\n        stop = sys.maxsize if stop is None else stop\n        result_sets = []\n        for word in tokenize(query):\n            # tokenize æ˜¯query çš„ç”Ÿæˆå™¨ a b ä¼šæ˜¯ ['a', 'b'] çš„ç”Ÿæˆå™¨\n            chars = self.index.get(word)\n            if chars is None:\n                result_sets = []\n                break\n            result_sets.append(chars)\n\n        if not result_sets:\n            return QueryResult(0, ())\n\n        result = functools.reduce(set.intersection, result_sets)\n        result = sorted(result)  # must sort to support start, stop\n        result_iter = itertools.islice(result, start, stop)\n        return QueryResult(len(result),\n                           (char for char in result_iter))\n\n    def describe(self, char):\n        code_str = 'U+{:04X}'.format(ord(char))\n        name = unicodedata.name(char)\n        return CharDescription(code_str, char, name)\n\n    def find_descriptions(self, query, start=0, stop=None):\n        for char in self.find_chars(query, start, stop).items:\n            yield self.describe(char)\n\n    def get_descriptions(self, chars):\n        for char in chars:\n            yield self.describe(char)\n\n    def describe_str(self, char):\n        return '{:7}\\t{}\\t{}'.format(*self.describe(char))\n\n    def find_description_strs(self, query, start=0, stop=None):\n        for char in self.find_chars(query, start, stop).items:\n            yield self.describe_str(char)\n\n    @staticmethod  # not an instance method due to concurrency\n    def status(query, counter):\n        if counter == 0:\n            msg = 'No match'\n        elif counter == 1:\n            msg = '1 match'\n        else:\n            msg = '{} matches'.format(counter)\n        return '{} for {!r}'.format(msg, query)\n\ndef main(*args):\n    index = UnicodeNameIndex()\n    query = ' '.join(args)\n    n = 0\n    for n, line in enumerate(index.find_description_strs(query), 1):\n        print(line)\n    print('({})'.format(index.status(query, n)))\n\n\nif __name__ == '__main__':\n    if len(sys.argv) > 1:\n        main(*sys.argv[1:])\n    else:\n        print('Usage: {} word1 [word2]...'.format(sys.argv[0]))\n\n```\n\nè¿™ä¸ªæ¨¡å—è¯»å–Pythonå†…å»ºçš„Unicodeæ•°æ®åº“ï¼Œä¸ºæ¯ä¸ªå­—ç¬¦åç§°ä¸­çš„æ¯ä¸ªå•è¯å»ºç«‹ç´¢å¼•ï¼Œç„¶åå€’æ’ç´¢å¼•ï¼Œå­˜å…¥ä¸€ä¸ªå­—å…¸ã€‚\nä¾‹å¦‚ï¼Œåœ¨å€’æ’ç´¢å¼•ä¸­ï¼Œ'SUN' é”®å¯¹åº”çš„æ¡ç›®æ˜¯ä¸€ä¸ªé›†åˆï¼Œé‡Œé¢æ˜¯åç§°ä¸­åŒ…å«'SUN' è¿™ä¸ªè¯çš„10ä¸ªUnicodeå­—ç¬¦ã€‚å€’æ’ç´¢å¼•ä¿å­˜åœ¨æœ¬åœ°ä¸€ä¸ªåä¸ºcharfinder_index.pickle çš„æ–‡ä»¶ä¸­ã€‚å¦‚æœæŸ¥è¯¢å¤šä¸ªå•è¯ï¼Œä¼šè®¡ç®—ä»ç´¢å¼•ä¸­æ‰€å¾—é›†åˆçš„äº¤é›†ã€‚\nè¿è¡Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```python\n    >>> main('rook')  # doctest: +NORMALIZE_WHITESPACE\n    U+2656  â™–  WHITE CHESS ROOK\n    U+265C  â™œ  BLACK CHESS ROOK\n    (2 matches for 'rook')\n    >>> main('rook', 'black')  # doctest: +NORMALIZE_WHITESPACE\n    U+265C  â™œ  BLACK CHESS ROOK\n    (1 match for 'rook black')\n    >>> main('white bishop')  # doctest: +NORMALIZE_WHITESPACE\n    U+2657  â™—   WHITE CHESS BISHOP\n    (1 match for 'white bishop')\n    >>> main(\"jabberwocky's vest\")\n    (No match for \"jabberwocky's vest\")\n```\n\nè¿™ä¸ªæ¨¡å—æ²¡æœ‰ä½¿ç”¨å¹¶å‘ï¼Œä¸»è¦ä½œç”¨æ˜¯ä¸ºä½¿ç”¨ asyncio åŒ…ç¼–å†™çš„æœåŠ¡å™¨æä¾›æ”¯æŒã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹ tcp_charfinder.py è„šæœ¬ï¼š\n\n```python\n# tcp_charfinder.py\nimport sys\nimport asyncio\n\n# ç”¨äºæ„å»ºç´¢å¼•ï¼Œæä¾›æŸ¥è¯¢æ–¹æ³•\nfrom charfinder import UnicodeNameIndex\n\nCRLF = b'\\r\\n'\nPROMPT = b'?> '\n\n# å®ä¾‹åŒ–UnicodeNameIndex ç±»ï¼Œå®ƒä¼šä½¿ç”¨charfinder_index.pickle æ–‡ä»¶\nindex = UnicodeNameIndex()\n\nasync def handle_queries(reader, writer):\n    # è¿™ä¸ªåç¨‹è¦ä¼ ç»™asyncio.start_server å‡½æ•°ï¼Œæ¥æ”¶çš„ä¸¤ä¸ªå‚æ•°æ˜¯asyncio.StreamReader å¯¹è±¡å’Œ asyncio.StreamWriter å¯¹è±¡\n    while True:  # è¿™ä¸ªå¾ªç¯å¤„ç†ä¼šè¯ï¼Œç›´åˆ°ä»å®¢æˆ·ç«¯æ”¶åˆ°æ§åˆ¶å­—ç¬¦åé€€å‡º\n        writer.write(PROMPT)  # can't await!  # è¿™ä¸ªæ–¹æ³•ä¸æ˜¯åç¨‹ï¼Œåªæ˜¯æ™®é€šå‡½æ•°ï¼›è¿™ä¸€è¡Œå‘é€ ?> æç¤ºç¬¦\n        await writer.drain()  # must await!  # è¿™ä¸ªæ–¹æ³•åˆ·æ–°writer ç¼“å†²ï¼›å› ä¸ºå®ƒæ˜¯åç¨‹ï¼Œæ‰€ä»¥è¦ç”¨ await\n        data = await reader.readline()  # è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯åç¨‹ï¼Œè¿”å›ä¸€ä¸ªbyteså¯¹è±¡ï¼Œä¹Ÿè¦ç”¨await\n        try:\n            query = data.decode().strip()\n        except UnicodeDecodeError:\n            # Telenet å®¢æˆ·ç«¯å‘é€æ§åˆ¶å­—ç¬¦æ—¶ï¼Œå¯èƒ½ä¼šæŠ›å‡ºUnicodeDecodeErrorå¼‚å¸¸\n            # æˆ‘ä»¬è¿™é‡Œé»˜è®¤å‘é€ç©ºå­—ç¬¦\n            query = '\\x00'\n        client = writer.get_extra_info('peername')  # è¿”å›å¥—æ¥å­—è¿æ¥çš„è¿œç¨‹åœ°å€\n        print('Received from {}: {!r}'.format(client, query))  # åœ¨æ§åˆ¶å°æ‰“å°æŸ¥è¯¢è®°å½•\n        if query:\n            if ord(query[:1]) < 32:  # å¦‚æœæ”¶åˆ°æ§åˆ¶å­—ç¬¦æˆ–è€…ç©ºå­—ç¬¦ï¼Œé€€å‡ºå¾ªç¯\n                break\n            # è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œäº§å‡ºåŒ…å«Unicode ç ä½ã€çœŸæ­£çš„å­—ç¬¦å’Œå­—ç¬¦åç§°çš„å­—ç¬¦ä¸²\n            lines = list(index.find_description_strs(query)) \n            if lines:\n                # ä½¿ç”¨é»˜è®¤çš„UTF-8 ç¼–ç æŠŠlines    è½¬æ¢æˆbytes å¯¹è±¡ï¼Œå¹¶åœ¨æ¯ä¸€è¡Œæœ«æ·»åŠ å›è½¦ç¬¦åˆæ¢è¡Œç¬¦\n                # å‚æ•°åˆ—è¡¨æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨\n                writer.writelines(line.encode() + CRLF for line in lines) \n            writer.write(index.status(query, len(lines)).encode() + CRLF) # è¾“å‡ºçŠ¶æ€\n\n            await writer.drain()  # åˆ·æ–°è¾“å‡ºç¼“å†²\n            print('Sent {} results'.format(len(lines)))  # åœ¨æœåŠ¡å™¨æ§åˆ¶å°è®°å½•å“åº”\n\n    print('Close the client socket')  # åœ¨æ§åˆ¶å°è®°å½•ä¼šè¯ç»“æŸ\n    writer.close()  # å…³é—­StreamWriteræµ\n\n\n\ndef main(address='127.0.0.1', port=2323):  # æ·»åŠ é»˜è®¤åœ°å€å’Œç«¯å£ï¼Œæ‰€ä»¥è°ƒç”¨é»˜è®¤å¯ä»¥ä¸åŠ å‚æ•°\n    port = int(port)\n    loop = asyncio.get_event_loop()\n    # asyncio.start_server åç¨‹è¿è¡Œç»“æŸåï¼Œ\n    # è¿”å›çš„åç¨‹å¯¹è±¡è¿”å›ä¸€ä¸ªasyncio.Server å®ä¾‹ï¼Œå³ä¸€ä¸ªTCPå¥—æ¥å­—æœåŠ¡å™¨\n    server_coro = asyncio.start_server(handle_queries, address, port,\n                                loop=loop) \n    server = loop.run_until_complete(server_coro) # é©±åŠ¨server_coro åç¨‹ï¼Œå¯åŠ¨æœåŠ¡å™¨\n\n    host = server.sockets[0].getsockname()  # è·å¾—è¿™ä¸ªæœåŠ¡å™¨çš„ç¬¬ä¸€ä¸ªå¥—æ¥å­—çš„åœ°å€å’Œç«¯å£\n    print('Serving on {}. Hit CTRL-C to stop.'.format(host))  # åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºåœ°å€å’Œç«¯å£\n    try:\n        loop.run_forever()  # è¿è¡Œäº‹ä»¶å¾ªç¯ main å‡½æ•°åœ¨è¿™é‡Œé˜»å¡ï¼Œç›´åˆ°æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸­æŒ‰CTRL-C é”®\n    except KeyboardInterrupt:  # CTRL+C pressed\n        pass\n\n    print('Server shutting down.')\n    server.close()\n    # server.wait_closedè¿”å›ä¸€ä¸ª future\n    # è°ƒç”¨loop.run_until_complete æ–¹æ³•ï¼Œè¿è¡Œ future\n    loop.run_until_complete(server.wait_closed())  \n    loop.close()  # ç»ˆæ­¢äº‹ä»¶å¾ªç¯\n\n\nif __name__ == '__main__':\n    main(*sys.argv[1:])\n\n```\n\nè¿è¡Œ tcp_charfinders.py\n\n```bash\npython tcp_charfinders.py\n```\n\næ‰“å¼€ç»ˆç«¯ï¼Œä½¿ç”¨ telnet å‘½ä»¤è¯·æ±‚æœåŠ¡ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n![åœ¨ telnet ä¼šè¯ä¸­è®¿é—®tcpç‰ˆå­—ç¬¦ä¸²æŸ¥æ‰¾æœåŠ¡å™¨æ‰€åšçš„æŸ¥è¯¢](http://media.gusibi.mobi/gjKne6lhnA1QoQEksLjU8ujZEIlaH-F622yCUcfD6QTB-M6DT84qK04A9rLMSosx)\n\nmain å‡½æ•°å‡ ä¹ä¼šç«‹å³æ˜¾ç¤º Serving on... æ¶ˆæ¯ï¼Œç„¶ååœ¨è°ƒç”¨loop.run_forever() æ–¹æ³•æ—¶é˜»å¡ã€‚è¿™æ—¶ï¼Œæ§åˆ¶æƒæµåŠ¨åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œè€Œä¸”ä¸€ç›´ç­‰å¾…ï¼Œå¶å°”ä¼šå›åˆ°handle_queries åç¨‹ï¼Œè¿™ä¸ªåç¨‹éœ€è¦ç­‰å¾…ç½‘ç»œå‘é€æˆ–æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶æƒåˆäº¤ç»™äº‹ä»¶å¾ªç¯ã€‚\n\nhandle_queries åç¨‹å¯ä»¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯å‘æ¥çš„å¤šæ¬¡è¯·æ±‚ã€‚åªè¦æœ‰æ–°å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªhandle_queries åç¨‹å®ä¾‹ã€‚\n\n> handle_queries çš„I/Oæ“ä½œéƒ½æ˜¯ä½¿ç”¨bytesæ ¼å¼ã€‚æˆ‘ä»¬ä»ç½‘ç»œå¾—åˆ°çš„æ•°æ®è¦è§£ç ï¼Œå‘å‡ºå»çš„æ•°æ®ä¹Ÿè¦ç¼–ç \n\nasyncioåŒ…æä¾›äº†é«˜å±‚çš„æµAPIï¼Œæä¾›äº†ç°æˆçš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹æ–‡æ¡£ï¼š[https://docs.python.org/3/library/asyncio-stream.html](https://docs.python.org/3/library/asyncio-stream.html)\n\nè™½ç„¶ï¼ŒasyncioåŒ…æä¾›äº†æœåŠ¡å™¨ï¼Œä½†æ˜¯åŠŸèƒ½ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒç®€é™‹çš„ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸‹ åŸºäºasyncioåŒ…çš„ web æ¡†æ¶ sanciï¼Œç”¨å®ƒæ¥å®ç°ä¸€ä¸ªhttpç‰ˆçš„ç®€æ˜“æœåŠ¡å™¨\n\n> <section class=\"caption\">sanic</section> çš„ç®€å•å…¥é—¨åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ‰ä»‹ç»ï¼Œ[python web æ¡†æ¶ Sanci å¿«é€Ÿå…¥é—¨](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752001&idx=1&sn=2c2e84f5f493514fdbff482a28dd7551&chksm=80b0b86bb7c7317df9d1c7b13411a231b91bb107de5e99c5379a3d9d072d5d3fb8117f364188#rd)\n\n## ä½¿ç”¨ sanic åŒ…ç¼–å†™web æœåŠ¡å™¨\n \nSanic æ˜¯ä¸€ä¸ªå’Œç±»Flask çš„åŸºäºPython3.5+çš„webæ¡†æ¶ï¼Œæä¾›äº†æ¯”è¾ƒé«˜é˜¶çš„APIï¼Œæ¯”å¦‚è·¯ç”±ã€requestå‚æ•°ï¼Œresponseç­‰ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°å¤„ç†é€»è¾‘å³å¯ã€‚\n\nä¸‹è¾¹æ˜¯ä½¿ç”¨ sanic å®ç°çš„ç®€æ˜“çš„ å­—ç¬¦æŸ¥è¯¢http web æœåŠ¡ï¼š\n\n```python\nfrom sanic import Sanic\nfrom sanic import response\n\nfrom charfinder import UnicodeNameIndex\n\napp = Sanic()\n\nindex = UnicodeNameIndex()\n\nhtml_temp = '<p>{char}</p>'\n\n@app.route('/charfinder')  # app.route å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯url pathï¼Œæˆ‘ä»¬è¿™é‡ŒæŒ‡å®šè·¯å¾„æ˜¯charfinder\nasync def charfinder(request):\n    # request.args å¯ä»¥å–åˆ°url çš„æŸ¥è¯¢å‚æ•°\n    # ?key1=value1&key2=value2 çš„ç»“æœæ˜¯ {'key1': ['value1'], 'key2': ['value2']}\n    # æˆ‘ä»¬è¿™é‡Œæ”¯æŒä¼ å…¥å¤šä¸ªæŸ¥è¯¢å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ request.args.getlist('char')\n    # å¦‚æœæˆ‘ä»¬ ä½¿ç”¨ request.args.get('char') åªèƒ½å–åˆ°ç¬¬ä¸€ä¸ªå‚æ•°\n    query = request.args.getlist('char')\n    query = ' '.join(query)\n    lines = list(index.find_description_strs(query))\n    # å°†å¾—åˆ°çš„ç»“æœç”Ÿæˆhtml\n    html = '\\n'.join([html_temp.format(char=line) for line in lines])\n    return response.html(html)\n\nif __name__ == '__main__':\n    app.run(host=\"0.0.0.0\", port=8000)  # è®¾ç½®æœåŠ¡å™¨è¿è¡Œåœ°å€å’Œç«¯å£å·\n```\n\nå¯¹æ¯”ä¸¤æ®µä»£ç å¯ä»¥å‘ç°ï¼Œä½¿ç”¨ sanic éå¸¸ç®€å•ã€‚\n\nè¿è¡ŒæœåŠ¡ï¼š\n\n```sh\npython http_charsfinder.py\n```\næˆ‘ä»¬åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ http://0.0.0.0:8000/charfinder?char=sun ç»“æœç¤ºä¾‹å¦‚ä¸‹\n\n![http://media.gusibi.mobi/BruF3mWEA0c2KEh5wqP92DajeNuZ_2LI6LeamF-kpYcDqmy8xlVw3V98tbIdHEeI](http://media.gusibi.mobi/BruF3mWEA0c2KEh5wqP92DajeNuZ_2LI6LeamF-kpYcDqmy8xlVw3V98tbIdHEeI)\n\n### ç°åœ¨å¯¹æ¯”ä¸‹ä¸¤æ®µä»£ç  \n\nåœ¨TCP çš„ç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡mainå‡½æ•°ä¸‹çš„è¿™ä¸¤è¡Œä»£ç åˆ›å»ºå¹¶æ’å®šè¿è¡Œæ—¶é—´ï¼š\n\n```python\nserver_coro = asyncio.start_server(handle_queries, address, port,\n                                loop=loop)\nserver = loop.run_until_complete(server_coro)\n```\n\nè€Œåœ¨sanicçš„HTTPç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ï¼Œåˆ›å»ºæœåŠ¡å™¨ï¼š\n\n```python\napp.run(host=\"0.0.0.0\", port=8000)\n```\n\nè¿™ä¸¤ä¸ªçœ‹èµ·æ¥è¿è¡Œæ–¹å¼å®Œå…¨ä¸åŒï¼Œä½†å¦‚æœæˆ‘ä»¬ç¿»å¼€sanicçš„æºç ä¼šçœ‹åˆ° app.run() å†…éƒ¨æ˜¯è°ƒç”¨ çš„ `server_coroutine = loop.create_server()`åˆ›å»ºæœåŠ¡å™¨ï¼Œ\nserver_coroutine æ˜¯é€šè¿‡ `loop.run_until_complete()`é©±åŠ¨çš„ã€‚\n\næ‰€ä»¥è¯´ï¼Œä¸ºäº†å¯åŠ¨æœåŠ¡å™¨ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯ç”± loop.run_until_complete é©±åŠ¨ï¼Œå®Œæˆè¿è¡Œçš„ã€‚åªä¸è¿‡ sanic å°è£…äº†run æ–¹æ³•ï¼Œä½¿å¾—ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚\n\n> è¿™é‡Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªåŸºæœ¬äº‹å®ï¼šåªæœ‰é©±åŠ¨åç¨‹ï¼Œåç¨‹æ‰èƒ½åšäº‹ï¼Œè€Œé©±åŠ¨ asyncio.coroutine è£…é¥°çš„åç¨‹æœ‰ä¸¤ç§æ–¹å¼ï¼Œä½¿ç”¨ yield from æˆ–è€…ä¼ ç»™asyncio åŒ…ä¸­æŸä¸ªå‚æ•°ä¸ºåç¨‹æˆ–futureçš„å‡½æ•°ï¼Œä¾‹å¦‚ run_until_complete\n\nç°åœ¨å¦‚æœä½ æœç´¢ cjkï¼Œä¼šå¾—åˆ°7ä¸‡å¤šæ¡æ•°æ®3M çš„ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œè€—æ—¶å¤§çº¦2sï¼Œè¿™å¦‚æœæ˜¯ç”Ÿäº§æœåŠ¡çš„ä¸€ä¸ªè¯·æ±‚ï¼Œè€—æ—¶2sæ˜¯ä¸èƒ½æ¥æ”¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ†é¡µï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ¯æ¬¡åªå–200æ¡æ•°æ®ï¼Œå½“ç”¨æˆ·æƒ³çœ‹æ›´å¤šæ•°æ®æ—¶å†ä½¿ç”¨ ajax æˆ–è€… websocketså‘é€ä¸‹ä¸€æ‰¹æ•°æ®ã€‚\n\nè¿™ä¸€ç¯‡æˆ‘ä»¬ä½¿ç”¨ asyncio åŒ…å®ç°äº†TCPæœåŠ¡å™¨ï¼Œä½¿ç”¨sanicï¼ˆåŸºäºasyncio `sanic é»˜è®¤ä½¿ç”¨ uvloopæ›¿ä»£asyncio`ï¼‰å®ç°äº†HTTPæœåŠ¡å™¨ï¼Œç”¨äºæŒ‰åç§°æœç´¢Unicode å­—ç¬¦ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰æ¶‰åŠæœåŠ¡å™¨å¹¶å‘éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å¯ä»¥ä»¥åå†è®¨è®ºã€‚\n\n> è¿™ä¸€ç¯‡è¿˜æ˜¯ ã€Šæµç•…çš„pythonã€‹asyncio ä¸€ç« çš„è¯»ä¹¦ç¬”è®°ï¼Œä¸‹ä¸€ç¯‡å°†æ˜¯pythonå¹¶å‘çš„ç¬¬ä¸‰ç¯‡ï¼Œã€Šä½¿ç”¨çº¿ç¨‹å¤„ç†å¹¶å‘ã€‹ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [Python 3.5å°†æ”¯æŒAsync/Awaitå¼‚æ­¥ç¼–ç¨‹:http://www.infoq.com/cn/news/2015/05/python-async-await](http://www.infoq.com/cn/news/2015/05/python-async-await)\n* [python web æ¡†æ¶ Sanci å¿«é€Ÿå…¥é—¨](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752001&idx=1&sn=2c2e84f5f493514fdbff482a28dd7551&chksm=80b0b86bb7c7317df9d1c7b13411a231b91bb107de5e99c5379a3d9d072d5d3fb8117f364188#rd)\n* [pythonå¹¶å‘2ï¼šä½¿ç”¨asyncioå¤„ç†å¹¶å‘](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751998&idx=1&sn=37833d3d7582d38f85a526de7eeda814)\n\n------\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonå¹¶å‘3ï¼šä½¿ç”¨asyncioç¼–å†™æœåŠ¡å™¨",
        "date": "2017-06-30 08:29:39",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°",
          "å¹¶å‘"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-asyncio-server"
    },
    {
      "content": "\n## asyncio \n\n`asyncio` æ˜¯Python3.4 ä¹‹åå¼•å…¥çš„æ ‡å‡†åº“çš„ï¼Œè¿™ä¸ªåŒ…ä½¿ç”¨äº‹ä»¶å¾ªç¯é©±åŠ¨çš„åç¨‹å®ç°å¹¶å‘ã€‚\nasyncio åŒ…åœ¨å¼•å…¥æ ‡å‡†åº“ä¹‹å‰ä»£å· `â€œTulipâ€ï¼ˆéƒé‡‘é¦™ï¼‰`ï¼Œæ‰€ä»¥åœ¨ç½‘ä¸Šæœç´¢èµ„æ–™æ—¶ï¼Œä¼šç»å¸¸çœ‹åˆ°è¿™ç§èŠ±çš„åå­—ã€‚\n\n### ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯?\n\n`wiki ä¸Šè¯´ï¼š`äº‹ä»¶å¾ªç¯æ˜¯â€ä¸€ç§ç­‰å¾…ç¨‹åºåˆ†é…äº‹ä»¶æˆ–è€…æ¶ˆæ¯çš„ç¼–ç¨‹æ¶æ„â€œã€‚åŸºæœ¬ä¸Šæ¥è¯´äº‹ä»¶å¾ªç¯å°±æ˜¯ï¼š`â€å½“Aå‘ç”Ÿæ—¶ï¼Œæ‰§è¡ŒB\"`ã€‚æˆ–è€…ç”¨æœ€ç®€å•çš„ä¾‹å­æ¥è§£é‡Šè¿™ä¸€æ¦‚å¿µå°±æ˜¯æ¯ä¸ªæµè§ˆå™¨ä¸­éƒ½å­˜åœ¨çš„JavaScriptäº‹ä»¶å¾ªç¯ã€‚å½“ä½ ç‚¹å‡»äº†æŸä¸ªä¸œè¥¿ï¼ˆâ€œå½“Aå‘ç”Ÿæ—¶â€ï¼‰ï¼Œè¿™ä¸€ç‚¹å‡»åŠ¨ä½œä¼šå‘é€ç»™JavaScriptçš„äº‹ä»¶å¾ªç¯ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ³¨å†Œè¿‡çš„onclick å›è°ƒæ¥å¤„ç†è¿™ä¸€ç‚¹å‡»ï¼ˆæ‰§è¡ŒB)ã€‚åªè¦æœ‰æ³¨å†Œè¿‡çš„å›è°ƒå‡½æ•°å°±ä¼šä¼´éšç‚¹å‡»åŠ¨ä½œçš„ç»†èŠ‚ä¿¡æ¯è¢«æ‰§è¡Œã€‚äº‹ä»¶å¾ªç¯è¢«è®¤ä¸ºæ˜¯ä¸€ç§è™šå¹»æ˜¯å› ä¸ºå®ƒä¸åœçš„æ‰‹æœºäº‹ä»¶å¹¶é€šè¿‡å¾ªç¯æ¥å‘å¦‚ä½•åº”å¯¹è¿™äº›äº‹ä»¶ã€‚\n\nå¯¹ Python æ¥è¯´ï¼Œç”¨æ¥æä¾›äº‹ä»¶å¾ªç¯çš„ asyncio è¢«åŠ å…¥æ ‡å‡†åº“ä¸­ã€‚asyncio é‡ç‚¹è§£å†³ç½‘ç»œæœåŠ¡ä¸­çš„é—®é¢˜ï¼Œäº‹ä»¶å¾ªç¯åœ¨è¿™é‡Œå°†æ¥è‡ªå¥—æ¥å­—ï¼ˆsocketï¼‰çš„ I/O å·²ç»å‡†å¤‡å¥½è¯»å’Œ/æˆ–å†™ä½œä¸ºâ€œå½“Aå‘ç”Ÿæ—¶â€ï¼ˆé€šè¿‡selectorsæ¨¡å—ï¼‰ã€‚é™¤äº† GUI å’Œ I/Oï¼Œäº‹ä»¶å¾ªç¯ä¹Ÿç»å¸¸ç”¨äºåœ¨åˆ«çš„çº¿ç¨‹æˆ–å­è¿›ç¨‹ä¸­æ‰§è¡Œä»£ç ï¼Œå¹¶å°†äº‹ä»¶å¾ªç¯ä½œä¸ºè°ƒèŠ‚æœºåˆ¶ï¼ˆä¾‹å¦‚ï¼Œåˆä½œå¼å¤šä»»åŠ¡ï¼‰ã€‚å¦‚æœä½ æ°å¥½ç†è§£ Python çš„ GILï¼Œäº‹ä»¶å¾ªç¯å¯¹äºéœ€è¦é‡Šæ”¾ GIL çš„åœ°æ–¹å¾ˆæœ‰ç”¨ã€‚\n\n## çº¿ç¨‹ä¸åç¨‹\n\næˆ‘ä»¬å…ˆçœ‹ä¸¤æ–­ä»£ç ï¼Œåˆ†åˆ«ç”¨ threading æ¨¡å—å’Œasyncio åŒ…å®ç°çš„ä¸€æ®µä»£ç ã€‚\n\n```python\n# sinner_thread.py\n\nimport threading\nimport itertools\nimport time\nimport sys\n\n\nclass Signal: # è¿™ä¸ªç±»å®šä¹‰ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œç”¨äºä»å¤–éƒ¨æ§åˆ¶çº¿ç¨‹\n    go = True\n\n\ndef spin(msg, signal):  # è¿™ä¸ªå‡½æ•°ä¼šåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œsignal å‚æ•°æ˜¯å‰è¾¹å®šä¹‰çš„Signalç±»çš„å®ä¾‹\n    write, flush = sys.stdout.write, sys.stdout.flush\n    for char in itertools.cycle('|/-\\\\'):  # itertools.cycle å‡½æ•°ä»æŒ‡å®šçš„åºåˆ—ä¸­åå¤ä¸æ–­åœ°ç”Ÿæˆå…ƒç´ \n        status = char + ' ' + msg\n        write(status)\n        flush()\n        write('\\x08' * len(status))  # ä½¿ç”¨é€€æ ¼ç¬¦æŠŠå…‰æ ‡ç§»å›è¡Œé¦–\n        time.sleep(.1)  # æ¯ 0.1 ç§’åˆ·æ–°ä¸€æ¬¡\n        if not signal.go:  # å¦‚æœ goå±æ€§ä¸æ˜¯ Trueï¼Œé€€å‡ºå¾ªç¯\n            break\n\n    write(' ' * len(status) + '\\x08' * len(status))  # ä½¿ç”¨ç©ºæ ¼æ¸…é™¤çŠ¶æ€æ¶ˆæ¯ï¼ŒæŠŠå…‰æ ‡ç§»å›å¼€å¤´\n\n\ndef slow_function():  # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ\n    # å‡è£…ç­‰å¾…I/Oä¸€æ®µæ—¶é—´\n    time.sleep(3)  # è°ƒç”¨sleep ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè¿™ä¹ˆåšäº‹ä¸ºäº†é‡Šæ”¾GILï¼Œåˆ›å»ºä»å±çº¿ç¨‹\n    return 42\n\n\ndef supervisor():  # è¿™ä¸ªå‡½æ•°è®¾ç½®ä»å±çº¿ç¨‹ï¼Œæ˜¾ç¤ºçº¿ç¨‹å¯¹è±¡ï¼Œè¿è¡Œè€—æ—¶è®¡ç®—ï¼Œæœ€åæ€æ­»è¿›ç¨‹\n    signal = Signal()\n    spinner = threading.Thread(target=spin,\n                               args=('thinking!', signal))\n    print('spinner object:', spinner)  # æ˜¾ç¤ºçº¿ç¨‹å¯¹è±¡ è¾“å‡º spinner object: <Thread(Thread-1, initial)>\n    spinner.start()  # å¯åŠ¨ä»å±è¿›ç¨‹\n    result = slow_function()  # è¿è¡Œslow_function è¡Œæ•°ï¼Œé˜»å¡ä¸»çº¿ç¨‹ã€‚åŒæ—¶ä¸›ä¹¦çº¿ç¨‹ä»¥åŠ¨ç”»å½¢å¼æ—‹è½¬æŒ‡é’ˆ\n    signal.go = False\n    spinner.join()  # ç­‰å¾…spinner çº¿ç¨‹ç»“æŸ\n    return result\n\ndef main():\n    result = supervisor()  \n    print('Answer', result)\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\næ‰§è¡Œä¸€ä¸‹ï¼Œç»“æœå¤§è‡´æ˜¯è¿™ä¸ªæ ·å­ï¼š\n\n![](http://omuo4kh1k.bkt.clouddn.com/QQ20170619-224013-HD.gif)\n\nè¿™æ˜¯ä¸€ä¸ªåŠ¨å›¾ï¼Œâ€œthinking\" å‰çš„ \\ çº¿æ˜¯ä¼šåŠ¨çš„ï¼ˆä¸ºäº†å½•å±ï¼Œæˆ‘æŠŠsleep çš„æ—¶é—´è°ƒå¤§äº†ï¼‰\n\n> python å¹¶æ²¡æœ‰æä¾›ç»ˆæ­¢çº¿ç¨‹çš„APIï¼Œæ‰€ä»¥è‹¥æƒ³å…³é—­çº¿ç¨‹ï¼Œå¿…é¡»ç»™çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨signal.go å±æ€§ï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æŠŠå®ƒè®¾ç½®ä¸ºFalseåï¼Œspinner çº¿ç¨‹ä¼šæ¥æ”¶åˆ°ï¼Œç„¶åé€€å‡º\n\nç°åœ¨æˆ‘ä»¬å†çœ‹ä¸‹ä½¿ç”¨ asyncio åŒ…çš„ç‰ˆæœ¬ï¼š\n\n```python\n# spinner_asyncio.py\n# é€šè¿‡åç¨‹ä»¥åŠ¨ç”»çš„å½¢å¼æ˜¾ç¤ºæ–‡æœ¬å¼æ—‹è½¬æŒ‡é’ˆ\n\nimport asyncio\nimport itertools\nimport sys\n\n@asyncio.coroutine # æ‰“ç®—äº¤ç»™asyncio å¤„ç†çš„åç¨‹è¦ä½¿ç”¨ @asyncio.coroutine è£…é¥°\ndef spin(msg):\n    write, flush = sys.stdout.write, sys.stdout.flush\n    for char in itertools.cycle('|/-\\\\'):  # itertools.cycle å‡½æ•°ä»æŒ‡å®šçš„åºåˆ—ä¸­åå¤ä¸æ–­åœ°ç”Ÿæˆå…ƒç´ \n        status = char + ' ' + msg\n        write(status)\n        flush()\n        write('\\x08' * len(status))  # ä½¿ç”¨é€€æ ¼ç¬¦æŠŠå…‰æ ‡ç§»å›è¡Œé¦–\n        try:\n            yield from asyncio.sleep(0.1)  # ä½¿ç”¨ yield from asyncio.sleep(0.1) ä»£æ›¿ time.sleep(.1), è¿™æ ·çš„ä¼‘çœ ä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯\n        except asyncio.CancelledError:  # å¦‚æœ spin å‡½æ•°è‹é†’åæŠ›å‡º asyncio.CancelledError å¼‚å¸¸ï¼Œå…¶åŸå› æ˜¯å‘å‡ºäº†å–æ¶ˆè¯·æ±‚\n            break\n\n    write(' ' * len(status) + '\\x08' * len(status))  # ä½¿ç”¨ç©ºæ ¼æ¸…é™¤çŠ¶æ€æ¶ˆæ¯ï¼ŒæŠŠå…‰æ ‡ç§»å›å¼€å¤´\n\n\n@asyncio.coroutine\ndef slow_function():  # 5 ç°åœ¨æ­¤å‡½æ•°æ˜¯åç¨‹ï¼Œä½¿ç”¨ä¼‘çœ å‡è£…è¿›è¡ŒI/O æ“ä½œæ—¶ï¼Œä½¿ç”¨ yield from ç»§ç»­æ‰§è¡Œäº‹ä»¶å¾ªç¯\n    # å‡è£…ç­‰å¾…I/Oä¸€æ®µæ—¶é—´\n    yield from asyncio.sleep(3)  # æ­¤è¡¨è¾¾å¼æŠŠæ§åˆ¶æƒäº¤ç»™ä¸»å¾ªç¯ï¼Œåœ¨ä¼‘çœ ç»“æŸåå›å¤è¿™ä¸ªåç¨‹\n    return 42\n\n\n@asyncio.coroutine\ndef supervisor():  #è¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯åç¨‹ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ yield from é©±åŠ¨ slow_function\n    spinner = asyncio.async(spin('thinking!'))  # asyncio.async() å‡½æ•°æ’å®šåç¨‹çš„è¿è¡Œæ—¶é—´ï¼Œä½¿ç”¨ä¸€ä¸ª Task å¯¹è±¡åŒ…è£…spin åç¨‹ï¼Œå¹¶ç«‹å³è¿”å›\n    print('spinner object:', spinner)  # Task å¯¹è±¡ï¼Œè¾“å‡ºç±»ä¼¼ spinner object: <Task pending coro=<spin() running at spinner_asyncio.py:6>>\n    # é©±åŠ¨slow_function() å‡½æ•°ï¼Œç»“æŸåï¼Œè·å–è¿”å›å€¼ã€‚åŒäº‹äº‹ä»¶å¾ªç¯ç»§ç»­è¿è¡Œï¼Œ\n    # å› ä¸ºslow_function å‡½æ•°æœ€åä½¿ç”¨yield from asyncio.sleep(3) è¡¨è¾¾å¼æŠŠæ§åˆ¶æƒäº¤ç»™ä¸»å¾ªç¯\n    result = yield from slow_function()\n    # Task å¯¹è±¡å¯ä»¥å–æ¶ˆï¼›å–æ¶ˆåä¼šåœ¨åç¨‹å½“å‰æš‚åœçš„yieldå¤„æŠ›å‡º asyncio.CancelledError å¼‚å¸¸\n    # åç¨‹å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥å»¶è¿Ÿå–æ¶ˆï¼Œç”šè‡³æ‹’ç»å–æ¶ˆ\n    spinner.cancel()\n\n    return result\n\ndef main():\n    loop = asyncio.get_event_loop()  # è·å–äº‹ä»¶å¾ªç¯å¼•ç”¨\n    # é©±åŠ¨supervisor åç¨‹ï¼Œè®©å®ƒè¿è¡Œå®Œæ¯•ï¼›è¿™ä¸ªåç¨‹çš„è¿”å›å€¼æ˜¯è¿™æ¬¡è°ƒç”¨çš„è¿”å›å€¼\n    result = loop.run_until_complete(supervisor())\n    loop.close()\n    print('Answer', result)\n\n\nif __name__ == '__main__':\n    main()\n```\n\n> é™¤éæƒ³é˜»å¡ä¸»çº¿ç¨‹ï¼Œä»è€Œå†»ç»“äº‹ä»¶å¾ªç¯æˆ–æ•´ä¸ªåº”ç”¨ï¼Œå¦åˆ™ä¸è¦å† asyncio åç¨‹ä¸­ä½¿ç”¨ time.sleep().\n> å¦‚æœåç¨‹éœ€è¦åœ¨ä¸€æ®µæ—¶é—´å†…ä»€ä¹ˆéƒ½ä¸åšï¼Œåº”è¯¥ä½¿ç”¨ yield from asyncio.sleep(DELAY)\n\nä½¿ç”¨ @asyncio.coroutine è£…é¥°å™¨ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œä½†å»ºè®®è¿™ä¹ˆåšå› ä¸ºè¿™æ ·èƒ½åœ¨ä»£ç ä¸­çªæ˜¾åç¨‹ï¼Œå¦‚æœè¿˜æ²¡ä»ä¸­äº§å‡ºå€¼ï¼Œåç¨‹å°±æŠŠåƒåœ¾å›æ”¶äº†ï¼ˆæ„å‘³ç€æ“ä½œæœªå®Œæˆï¼Œå¯èƒ½æœ‰ç¼ºé™·ï¼‰ï¼Œå¯ä»¥å‘å‡ºè­¦å‘Šã€‚è¿™ä¸ªè£…é¥°å™¨ä¸ä¼šé¢„æ¿€åç¨‹ã€‚\n\nè¿™ä¸¤æ®µä»£ç çš„æ‰§è¡Œç»“æœåŸºæœ¬ç›¸åŒï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸¤æ®µä»£ç çš„æ ¸å¿ƒä»£ç  supervisor ä¸»è¦åŒºåˆ«ï¼š\n\n* asyncio.Task å¯¹è±¡å·®ä¸å¤šä¸ threading.Thread å¯¹è±¡ç­‰æ•ˆï¼ˆTask å¯¹è±¡åƒæ˜¯å®ç°å†™ä½œæ—¶å¤šä»»åŠ¡çš„åº“ä¸­çš„ç»¿è‰²çº¿ç¨‹\n* Task å¯¹è±¡ç”¨äºé©±åŠ¨åç¨‹ï¼ŒThread å¯¹è±¡ç”¨äºè°ƒç”¨å¯è°ƒç”¨çš„å¯¹è±¡\n* Task å¯¹è±¡ä¸ç”±è‡ªå·±åŠ¨æ‰‹å®ä¾‹åŒ–ï¼Œè€Œæ˜¯é€šè¿‡æŠŠåç¨‹ä¼ ç»™ asyncio.async(...) å‡½æ•°æˆ– loop.create_task(...) æ–¹æ³•è·å–\n* è·å–çš„Task å¯¹è±¡å·²ç»æ’å®šäº†è¿è¡Œæ—¶é—´ï¼›Thread å®ä¾‹å¿…é¡»è°ƒç”¨startæ–¹æ³•ï¼Œæ˜ç¡®å‘ŠçŸ¥å®ƒè¿è¡Œ\n* åœ¨çº¿ç¨‹ç‰ˆsupervisorå‡½æ•°ä¸­ï¼Œslow_function æ˜¯æ™®é€šçš„å‡½æ•°ï¼Œç”±çº¿ç¨‹ç›´æ¥è°ƒç”¨ï¼Œè€Œå¼‚æ­¥ç‰ˆçš„slow_function å‡½æ•°æ˜¯åç¨‹ï¼Œç”±yield from é©±åŠ¨ã€‚\n* æ²¡æœ‰APIèƒ½ä»å¤–éƒ¨ç»ˆæ­¢çº¿ç¨‹ï¼Œå› ä¸ºçº¿ç¨‹éšæ—¶å¯èƒ½è¢«ä¸­æ–­ã€‚è€Œå¦‚æœæƒ³ç»ˆæ­¢ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨Task.cancel() å®ä¾‹æ–¹æ³•ï¼Œåœ¨åç¨‹å†…éƒ¨æŠ›å‡ºCancelledError å¼‚å¸¸ã€‚åç¨‹å¯ä»¥åœ¨æš‚åœçš„yield å¤„æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå¤„ç†ç»ˆæ­¢è¯·æ±‚\n* supervisor åç¨‹å¿…é¡»åœ¨main å‡½æ•°ä¸­ç”±loop.run_until_complete æ–¹æ³•æ‰§è¡Œã€‚\n\n> åç¨‹å’Œçº¿ç¨‹ç›¸æ¯”å…³é”®çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œ\n> çº¿ç¨‹å¿…é¡»è®°ä½ä¿ç•™é”ï¼Œå»ä¿æŠ¤ç¨‹åºä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œé˜²æ­¢å¤šæ­¥æ“ä½œå†æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸­æ–­ï¼Œé˜²æ­¢å±±æ°´å¤„äºäºæ™“çŠ¶æ€\n> åç¨‹é»˜è®¤ä¼šåšå¥½ä¿æŠ¤ï¼Œæˆ‘ä»¬å¿…é¡»æ˜¾å¼äº§å‡ºï¼ˆä½¿ç”¨yield æˆ– yield from äº¤å‡ºæ§åˆ¶æƒï¼‰æ‰èƒ½è®©ç¨‹åºçš„ä½™ä¸‹éƒ¨åˆ†è¿è¡Œã€‚\n\n### asyncio.Futureï¼šæ•…æ„ä¸é˜»å¡\n\nasynci.Future ç±»ä¸ concurrent.futures.Future ç±»çš„æ¥å£åŸºæœ¬ä¸€è‡´ï¼Œä¸è¿‡å®ç°æ–¹å¼ä¸åŒï¼Œä¸å¯äº’æ¢ã€‚\n\nä¸Šä¸€ç¯‡[pythonå¹¶å‘ 1ï¼šä½¿ç”¨ futures å¤„ç†å¹¶å‘](http://blog.gusibi.site/post/python-concurrency-with-futures/)æˆ‘ä»¬ä»‹ç»è¿‡ concurrent.futures.Future çš„ futureï¼Œåœ¨ concurrent.futures.Future ä¸­ï¼Œfutureåªæ˜¯è°ƒåº¦æ‰§è¡ŒæŸç‰©çš„ç»“æœã€‚åœ¨ asyncio åŒ…ä¸­ï¼ŒBaseEventLoop.create_task(...) æ–¹æ³•æ¥æ”¶ä¸€ä¸ªåç¨‹ï¼Œæ’å®šå®ƒçš„è¿è¡Œæ—¶é—´ï¼Œç„¶åè¿”å›ä¸€ä¸ªasyncio.Task å®ä¾‹ï¼ˆä¹Ÿæ˜¯asyncio.Future ç±»çš„å®ä¾‹ï¼Œå› ä¸º Task æ˜¯ Future çš„å­ç±»ï¼Œç”¨äºåŒ…è£…åç¨‹ã€‚ï¼ˆåœ¨ concurrent.futures.Future ä¸­ï¼Œç±»ä¼¼çš„æ“ä½œæ˜¯Executor.submit(...)ï¼‰ã€‚\n\nä¸concurrent.futures.Future ç±»ä¼¼ï¼Œasyncio.Future ç±»ä¹Ÿæä¾›äº† \n\n* .done()  è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºFuture æ˜¯å¦å·²ç»æ‰§è¡Œ\n* .add_done_callback() è¿™ä¸ªæ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œç±»å‹æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼ŒFutureè¿è¡Œç»“æŸåä¼šå›è°ƒè¿™ä¸ªå¯¹è±¡ã€‚\n* .result() è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œå› æ­¤ä¸èƒ½æŒ‡å®šè¶…æ—¶æ—¶é—´ã€‚ å¦‚æœè°ƒç”¨ .result() æ–¹æ³•æ—¶æœŸè¿˜æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼Œä¼šæŠ›å‡º asyncio.InvalidStateError å¼‚å¸¸ã€‚\n\n> å¯¹åº”çš„ concurrent.futures.Future ç±»ä¸­çš„ Future è¿è¡Œç»“æŸåè°ƒç”¨result(), ä¼šè¿”å›å¯è°ƒç”¨å¯¹è±¡çš„ç»“æœæˆ–è€…æŠ›å‡ºæ‰§è¡Œå¯è°ƒç”¨å¯¹è±¡æ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¦‚æœæ˜¯ Future æ²¡æœ‰è¿è¡Œç»“æŸæ—¶è°ƒç”¨ f.result()æ–¹æ³•ï¼Œè¿™æ—¶ä¼šé˜»å¡è°ƒç”¨æ–¹æ‰€åœ¨çš„çº¿ç¨‹ï¼Œç›´åˆ°æœ‰ç»“æœè¿”å›ã€‚æ­¤æ—¶result æ–¹æ³•è¿˜å¯ä»¥æ¥æ”¶ timeout å‚æ•°ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†… Future æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼Œä¼šæŠ›å‡º TimeoutError å¼‚å¸¸ã€‚\n\n*æˆ‘ä»¬ä½¿ç”¨asyncio.Future æ—¶ï¼Œ é€šå¸¸ä½¿ç”¨yield fromï¼Œä»ä¸­è·å–ç»“æœï¼Œè€Œä¸æ˜¯ä½¿ç”¨ result()æ–¹æ³•* yield from è¡¨è¾¾å¼åœ¨æš‚åœçš„åç¨‹ä¸­ç”Ÿæˆè¿”å›å€¼ï¼Œå›å¤æ‰§è¡Œè¿‡ç¨‹ã€‚\n\nasyncio.Future ç±»çš„ç›®çš„æ˜¯ä¸ yield from ä¸€èµ·ä½¿ç”¨ï¼Œæ‰€ä»¥é€šå¸¸ä¸éœ€è¦ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š\n\n* ä¸éœ€è°ƒç”¨ my_future.add_down_callback(...), å› ä¸ºå¯ä»¥ç›´æ¥æŠŠæƒ³åœ¨ future è¿è¡Œç»“æŸåçš„æ“ä½œæ”¾åœ¨åç¨‹ä¸­ yield from my_future è¡¨è¾¾å¼çš„åè¾¹ã€‚ï¼ˆå› ä¸ºåç¨‹å¯ä»¥æš‚åœå’Œæ¢å¤å‡½æ•°ï¼‰\n* æ— éœ€è°ƒç”¨ my_future.result(), å› ä¸º yield from äº§ç”Ÿçš„ç»“æœå°±æ˜¯ï¼ˆresult = yield from my_future)\n\nåœ¨ asyncio åŒ…ä¸­ï¼Œå¯ä»¥ä½¿ç”¨yield from ä»asyncio.Future å¯¹è±¡ä¸­äº§å‡ºç»“æœã€‚è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```python\nres = yield from foo()  # foo å¯ä»¥æ˜¯åç¨‹å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿”å› Future æˆ– task å®ä¾‹çš„æ™®é€šå‡½æ•°\n```\n\n#### asyncio.async(...)* å‡½æ•°\n\n```python\nasyncio.async(coro_or_future, *, loop=None)\n```\nè¿™ä¸ªå‡½æ•°ç»Ÿä¸€äº†åç¨‹å’ŒFuture: ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯äºŒè€…ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚å¦‚æœæ˜¯Future æˆ–è€… Task å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ˜¯åç¨‹ï¼Œé‚£ä¹ˆasync å‡½æ•°ä¼šè‡ªåŠ¨è°ƒç”¨ loop.create_task(...) æ–¹æ³•åˆ›å»º Task å¯¹è±¡ã€‚ loop å‚æ•°æ˜¯å¯é€‰çš„ï¼Œç”¨äºä¼ å…¥äº‹ä»¶å¾ªç¯; å¦‚æœæ²¡æœ‰ä¼ å…¥ï¼Œé‚£ä¹ˆasyncå‡½æ•°ä¼šé€šè¿‡è°ƒç”¨asyncio.get_event_loop() å‡½æ•°è·å–å¾ªç¯å¯¹è±¡ã€‚\n\n#### BaseEventLoop.create_task(coro)\n\nè¿™ä¸ªæ–¹æ³•æ’å®šåç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œè¿”å›ä¸€ä¸ª asyncio.Task å¯¹è±¡ã€‚å¦‚æœåœ¨è‡ªå®šä¹‰çš„BaseEventLoop å­ç±»ä¸Šè°ƒç”¨ï¼Œè¿”å›çš„å¯¹è±¡å¯èƒ½æ˜¯å¤–éƒ¨åº“ä¸­ä¸Taskç±»å…¼å®¹çš„æŸä¸ªç±»çš„å®ä¾‹ã€‚\n\n> BaseEventLoop.create_task() æ–¹æ³•åªåœ¨Python3.4.2 åŠä»¥ä¸Šç‰ˆæœ¬å¯ç”¨ã€‚ Python3.3 åªèƒ½ä½¿ç”¨ asyncio.async(...)å‡½æ•°ã€‚\n\nå¦‚æœæƒ³åœ¨Pythonæ§åˆ¶å°æˆ–è€…å°å‹æµ‹è¯•è„šæœ¬ä¸­å®éªŒfutureå’Œåç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç‰‡æ®µï¼š\n\n```python\nimport asyncio\n\ndef run_sync(coro_or_future):\n    loop = asyncio.get_event_loop()\n    return loop.run_until_complete(coro_or_future)\n\na = run_sync(some_coroutine())\n```\n\n## ä½¿ç”¨asyncio å’Œ aiohttp åŒ…ä¸‹è½½\n\nç°åœ¨ï¼Œæˆ‘ä»¬äº†è§£äº†asyncio çš„åŸºç¡€çŸ¥è¯†ï¼Œæ˜¯æ—¶å€™ä½¿ç”¨asyncio æ¥é‡å†™æˆ‘ä»¬ ä¸Šä¸€ç¯‡ [pythonå¹¶å‘ 1ï¼šä½¿ç”¨ futures å¤„ç†å¹¶å‘](http://blog.gusibi.site/post/python-concurrency-with-futures/) ä¸‹è½½å›½æ——çš„è„šæœ¬äº†ã€‚\n\nå…ˆçœ‹ä¸€ä¸‹ä»£ç ï¼š\n\n```python\nimport asyncio\n\nimport aiohttp  # éœ€è¦pip install aiohttp\n\nfrom flags import save_flag, show, main, BASE_URL\n\n\n@asyncio.coroutine  # æˆ‘ä»¬çŸ¥é“ï¼Œåç¨‹åº”è¯¥ä½¿ç”¨ asyncio.coroutine è£…é¥°\ndef get_flag(cc):\n    url = \"{}/{cc}/{cc}.gif\".format(BASE_URL, cc=cc.lower())\n     # é˜»å¡çš„æ“ä½œé€šè¿‡åç¨‹å®ç°ï¼Œå®¢æˆ·ä»£ç é€šè¿‡yield from æŠŠæŒ‡è´£å§”æ‰˜ç»™åç¨‹ï¼Œä»¥ä¾¿å¼‚æ­¥æ“ä½œ\n    resp = yield from aiohttp.request('GET', url) \n    # è¯»å–ä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œ\n    image = yield from resp.read()\n    return image\n\n\n@asyncio.coroutine\ndef download_one(cc):  # è¿™ä¸ªå‡½æ•°ä¹Ÿå¿…é¡»æ˜¯åç¨‹ï¼Œå› ä¸ºç”¨åˆ°äº†yield from\n    image = yield from get_flag(cc) \n    show(cc)\n    save_flag(image, cc.lower() + '.gif')\n    return cc\n\n\ndef download_many(cc_list):\n    loop = asyncio.get_event_loop()  # è·å–äº‹ä»¶åºå·åº•å±‚å®ç°çš„å¼•ç”¨\n    to_do = [download_one(cc) for cc in sorted(cc_list)] # è°ƒç”¨download_one è·å–å„ä¸ªå›½æ——ï¼Œæ„å»ºä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡åˆ—è¡¨\n    # è™½ç„¶å‡½æ•°åç§°æ˜¯wait ä½†å®ƒä¸æ˜¯é˜»å¡å‹å‡½æ•°ï¼Œwait æ˜¯ä¸€ä¸ªåç¨‹ï¼Œç­‰ä¼ ç»™ä»–çš„æ‰€æœ‰åç¨‹è¿è¡Œå®Œæ¯•åç»“æŸ\n    wait_coro = asyncio.wait(to_do)\n    res, _ = loop.run_until_complete(wait_coro) # æ‰§è¡Œäº‹ä»¶å¾ªç¯ï¼ŒçŸ¥é“wait_coro è¿è¡Œç»“æŸï¼›äº‹ä»¶å¾ªç¯è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªè„šæœ¬ä¼šåœ¨è¿™é‡Œé˜»å¡ã€‚\n    loop.close() # å…³é—­äº‹ä»¶å¾ªç¯\n    return len(res)\n\nif __name__ == '__main__':\n    main(download_many)\n```\n\nè¿™æ®µä»£ç çš„è¿è¡Œç®€è¿°å¦‚ä¸‹ï¼š\n\n1. åœ¨download_many å‡½æ•°è·å–ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå¤„ç†è°ƒç”¨download_one å‡½æ•°ç”Ÿæˆçš„å‡ ä¸ªåç¨‹å¯¹è±¡\n2. asyncio äº‹ä»¶å¾ªç¯ä¸€æ¬¡æ¿€æ´»å„ä¸ªåç¨‹\n3. å®¢æˆ·ä»£ç ä¸­çš„åç¨‹ï¼ˆget_flagï¼‰ä½¿ç”¨ yield from æŠŠæŒ‡è´£å§”æ‰˜ç»™åº“é‡Œçš„åç¨‹ï¼ˆaiohttp.request)æ—¶ï¼Œæ§åˆ¶æƒäº¤è¿˜ç»™äº‹ä»¶å¾ªç¯ï¼Œæ‰§è¡Œä¹‹å‰æ’å®šçš„åç¨‹\n4. äº‹ä»¶å¾ªç¯é€šè¿‡åŸºäºå›è°ƒçš„åº•å±‚APIï¼Œåœ¨é˜»å¡çš„æ“ä½œæ‰§è¡Œå®Œæ¯•åè·å¾—é€šçŸ¥ã€‚\n5. è·å¾—é€šçŸ¥åï¼Œä¸»å¾ªç¯æŠŠç»“æœå‘ç»™æš‚åœçš„åç¨‹\n6. åç¨‹å‘å‰æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªyield from è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ get_flag å‡½æ•°çš„yield from resp.read()ã€‚äº‹ä»¶å¾ªç¯å†æ¬¡å¾—åˆ°æ§åˆ¶æƒï¼Œé‡å¤ç¬¬4~6æ­¥ï¼Œç›´åˆ°å¾ªç¯ç»ˆæ­¢ã€‚\n\ndownload_many å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† asyncio.wait(...) å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªåç¨‹ï¼Œåç¨‹çš„å‚æ•°æ˜¯ä¸€ä¸ªç”±futureæˆ–è€…åç¨‹æ„æˆçš„å¯è¿­ä»£å¯¹è±¡ï¼›wait ä¼šåˆ†åˆ«æŠŠå„ä¸ªåç¨‹åŒ…è£…è¿›ä¸€ä¸ªTaskå¯¹è±¡ã€‚æœ€ç»ˆçš„ç»“æœæ˜¯ï¼Œwait å¤„ç†çš„æ‰€æœ‰å¯¹è±¡éƒ½é€šè¿‡æŸç§æ–¹å¼å˜æˆFuture ç±»çš„å®ä¾‹ã€‚\n\n> wait æ˜¯åç¨‹å‡½æ•°ï¼Œå› æ­¤ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåç¨‹æˆ–è€…ç”Ÿæˆå™¨å¯¹è±¡ï¼›waite_coro å˜é‡ä¸­å­˜å‚¨çš„å°±æ˜¯è¿™ç§å¯¹è±¡\n\nloop.run_until_complete æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªfuture æˆ–åç¨‹ã€‚å¦‚æœæ˜¯åç¨‹ï¼Œrun_until_complete æ–¹æ³•ä¸ wait å‡½æ•°ä¸€æ ·ï¼ŒæŠŠåç¨‹åŒ…è£…è¿›ä¸€ä¸ªTask å¯¹è±¡ä¸­ã€‚è¿™é‡Œ run_until_complete æ–¹æ³•æŠŠ wait_coro åŒ…è£…è¿›ä¸€ä¸ªTask å¯¹è±¡ä¸­ï¼Œç”±yield from é©±åŠ¨ã€‚wait_coro è¿è¡Œç»“æŸåè¿”å›ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»“æŸçš„future ç¬¬äºŒä¸ªå‚æ•°æ˜¯æœªç»“æŸçš„futureã€‚\n\n> <section class=\"caption\">wait</section>æœ‰ä¸¤ä¸ªå‘½åå‚æ•°ï¼Œtimeout å’Œ return_when å¦‚æœè®¾ç½®äº†å¯èƒ½ä¼šè¿”å›æœªç»“æŸçš„futureã€‚\n\næœ‰ä¸€ç‚¹ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬é‡å†™äº†get_flags å‡½æ•°ï¼Œæ˜¯å› ä¸ºä¹‹å‰ç”¨åˆ°çš„ requests åº“æ‰§è¡Œçš„æ˜¯é˜»å¡å‹I/Oæ“ä½œã€‚ä¸ºäº†ä½¿ç”¨ asyncio åŒ…ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠå‡½æ•°æ”¹æˆå¼‚æ­¥ç‰ˆã€‚\n\n### å°æŠ€å·§\n\nå¦‚æœä½ è§‰å¾— ä½¿ç”¨äº†åç¨‹åä»£ç éš¾ä»¥ç†è§£ï¼Œå¯ä»¥é‡‡ç”¨ Pythonä¹‹çˆ¶ï¼ˆGuido van Rossumï¼‰çš„å»ºè®®ï¼Œå‡è£…æ²¡æœ‰yield fromã€‚\n\nå·²ä¸Šè¾¹è¿™æ®µä»£ç ä¸ºä¾‹ï¼š\n\n```python\n@asyncio.coroutine\ndef get_flag(cc):\n    url = \"{}/{cc}/{cc}.gif\".format(BASE_URL, cc=cc.lower())\n    resp = yield from aiohttp.request('GET', url) \n    image = yield from resp.read()\n    return image\n\n# æŠŠyield form å»æ‰\n\ndef get_flag(cc):\n    url = \"{}/{cc}/{cc}.gif\".format(BASE_URL, cc=cc.lower())\n    resp = aiohttp.request('GET', url) \n    image = resp.read()\n    return image\n\n# ç°åœ¨æ˜¯ä¸æ˜¯æ¸…æ™°å¤šäº†\n```\n\n### çŸ¥è¯†ç‚¹\n\nåœ¨asyncio åŒ…çš„APIä¸­ä½¿ç”¨ yield from æ—¶ï¼Œæœ‰ä¸ªç»†èŠ‚è¦æ³¨æ„ï¼š\n\nä½¿ç”¨asyncioåŒ…æ—¶ï¼Œæˆ‘ä»¬ç¼–å†™çš„å¼‚æ­¥ä»£ç ä¸­åŒ…å«ç”±asyncioæœ¬èº«é©±åŠ¨çš„åç¨‹ï¼ˆå§”æ´¾ç”Ÿæˆå™¨ï¼‰ï¼Œè€Œç”Ÿæˆå™¨æœ€ç»ˆæŠŠæŒ‡è´£å§”æ‰˜ç»™asyncioåŒ…æˆ–è€…ç¬¬ä¸‰æ–¹åº“ä¸­çš„åç¨‹ã€‚è¿™ç§å¤„ç†æ–¹å¼ç›¸å½“äºæ¶èµ·äº†ç®¡é“ï¼Œè®©asyncioäº‹ä»¶å¾ªç¯é©±åŠ¨æ‰§è¡Œåº•å±‚å¼‚æ­¥I/Oçš„åº“å‡½æ•°ã€‚\n\n\n## é¿å…é˜»å¡å‹è°ƒç”¨\n\næˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå›¾ï¼Œè¿™ä¸ªå›¾æ˜¾ç¤ºäº†ç”µè„‘ä»ä¸åŒå­˜å‚¨ä»‹è´¨ä¸­è¯»å–æ•°æ®çš„å»¶è¿Ÿæƒ…å†µï¼š\n\n![](http://media.gusibi.mobi/w8Yl9AQJQ3JzHTnPCUPqwRBuN_BdmLH3iRlvpaNbavfCOvlmiUz5PLexfSZEOXo6)\n\né€šè¿‡è¿™ä¸ªå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé˜»å¡å‹è°ƒç”¨å¯¹äºCPUæ¥è¯´æ˜¯å·¨å¤§çš„æµªè´¹ã€‚æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥é¿å…é˜»å¡å‹è°ƒç”¨ä¸­æ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºä¹ˆï¼Ÿ\n\næœ‰ä¸¤ç§æ–¹æ³•ï¼š\n\n* åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œå„ä¸ªé˜»å¡å‹æ“ä½œ\n* æŠŠæ¯ä¸ªé˜»å¡å‹æ“ä½œè½¬åŒ–æˆéé˜»å¡çš„å¼‚æ­¥è°ƒç”¨ä½¿ç”¨\n\nå½“ç„¶æˆ‘ä»¬æ¨èç¬¬äºŒç§æ–¹æ¡ˆï¼Œå› ä¸ºç¬¬ä¸€ç§æ–¹æ¡ˆä¸­å¦‚æœæ¯ä¸ªè¿æ¥éƒ½ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆæœ¬å¤ªé«˜ã€‚\nç¬¬äºŒç§æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠŠç”Ÿæˆå™¨å½“åšåç¨‹ä½¿ç”¨çš„æ–¹å¼å®ç°å¼‚æ­¥ç¼–ç¨‹ã€‚å¯¹äº‹ä»¶å¾ªç¯æ¥è¯´ï¼Œè°ƒç”¨å›è°ƒä¸åœ¨æš‚åœçš„åç¨‹ä¸Šè°ƒç”¨ .send() æ–¹æ³•æ•ˆæœå·®ä¸å¤šã€‚å„ä¸ªæš‚åœçš„åç¨‹æ¶ˆè€—çš„å†…å­˜æ¯”çº¿ç¨‹å°çš„å¤šã€‚\n\nç°åœ¨ï¼Œä½ åº”è¯¥èƒ½ç†è§£ä¸ºä»€ä¹ˆ flags_asyncio.py è„šæœ¬æ¯” flags.py å¿«çš„å¤šäº†å§ã€‚\n\n> å› ä¸ºflags.py æ˜¯ä¾æ¬¡åŒæ­¥ä¸‹è½½ï¼Œæ¯æ¬¡ä¸‹è½½éƒ½è¦ç”¨å‡ åäº¿ä¸ªCPUå‘¨æœŸç­‰å¾…ç»“æœã€‚è€Œåœ¨flags_asyncio.pyä¸­ï¼Œåœ¨download_many å‡½æ•°ä¸­è°ƒç”¨loop.run_until_complete æ–¹æ³•æ—¶ï¼Œäº‹ä»¶å¾ªç¯é©±åŠ¨å„ä¸ªdownload_one åç¨‹ï¼Œè¿è¡Œåˆ°yield from è¡¨è¾¾å¼å‡ºï¼Œé‚£ä¸ªè¡¨è¾¾å¼åˆé©±åŠ¨å„ä¸ª get_flag åç¨‹ï¼Œè¿è¡Œåˆ°ç¬¬ä¸€ä¸ªyield from è¡¨è¾¾å¼å¤„ï¼Œè°ƒç”¨ aiohttp.request()å‡½æ•°ã€‚è¿™äº›è°ƒç”¨ä¸ä¼šé˜»å¡ï¼Œå› æ­¤åœ¨é›¶ç‚¹å‡ ç§’å†…æ‰€æœ‰è¯·æ±‚éƒ½å¯ä»¥å…¨éƒ¨å¼€å§‹ã€‚\n\n## æ”¹è¿› asyncio ä¸‹è½½è„šæœ¬\nç°åœ¨æˆ‘ä»¬æ”¹è¿›ä¸€ä¸‹ä¸Šè¾¹çš„ flags_asyncio.pyï¼Œåœ¨å…¶ä¸­æ·»åŠ ä¸Šå¼‚å¸¸å¤„ç†ï¼Œè®¡æ•°å™¨\n\n```python\nimport asyncio\nimport collections\nfrom collections import namedtuple\nfrom enum import Enum\n\nimport aiohttp\nfrom aiohttp import web\n\nfrom flags import save_flag, show, main, BASE_URL\n\nDEFAULT_CONCUR_REQ = 5\nMAX_CONCUR_REQ = 1000\n\nResult = namedtuple('Result', 'status data')\nHTTPStatus = Enum('Status', 'ok not_found error')\n\n# è‡ªå®šä¹‰å¼‚å¸¸ç”¨äºåŒ…è£…å…¶ä»–HTTPè´§ç½‘ç»œå¼‚å¸¸ï¼Œå¹¶è·å–country_codeï¼Œä»¥ä¾¿æŠ¥å‘Šé”™è¯¯\nclass FetchError(Exception):\n    def __init__(self, country_code):\n        self.country_code = country_code\n\n\n@asyncio.coroutine\ndef get_flag(cc):\n    # æ­¤åç¨‹æœ‰ä¸‰ç§è¿”å›ç»“æœï¼š\n    # 1.  è¿”å›ä¸‹è½½åˆ°çš„å›¾ç‰‡\n    # 2. HTTP å“åº”ä¸º404 æ—¶ï¼ŒæŠ›å‡ºweb.HTTPNotFound å¼‚å¸¸\n    # 3. è¿”å›å…¶ä»–HTTPçŠ¶æ€ç æ—¶ï¼Œ æŠ›å‡ºaiohttp.HttpProcessingError\n    url = \"{}/{cc}/{cc}.gif\".format(BASE_URL, cc=cc.lower())\n    resp = yield from aiohttp.request('GET', url)\n    if resp.status == 200:\n        image = yield from resp.read()\n        return image\n    elif resp.status == 404:\n        raise web.HttpNotFound()\n    else:\n        raise aiohttp.HttpProcessionError(\n            code=resp.status, message=resp.reason,\n            headers=resp.headers\n        )\n\n\n@asyncio.coroutine\ndef download_one(cc, semaphore):\n    # semaphore å‚æ•°æ˜¯ asyncio.Semaphore ç±»çš„å®ä¾‹\n    # Semaphore ç±»æ˜¯åŒæ­¥è£…ç½®ï¼Œç”¨äºé™åˆ¶å¹¶å‘è¯·æ±‚\n    try:\n        with (yield from semaphore):\n             # åœ¨yield    from  è¡¨è¾¾å¼ä¸­æŠŠsemaphore   å½“æˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ä½¿ç”¨ï¼Œé˜²æ­¢é˜»å¡æ•´ä¸ªç³»ç»Ÿ\n             # å¦‚æœsemaphore è®¡æ•°å™¨çš„å€¼æ˜¯æ‰€å…è®¸çš„æœ€å¤§å€¼ï¼Œåªæœ‰è¿™ä¸ªåç¨‹ä¼šé˜»å¡\n              image = yield from get_flag(cc)\n              # é€€å‡ºwithè¯­å¥å semaphore è®¡æ•°å™¨çš„å€¼ä¼šé€’å‡ï¼Œ\n              # è§£é™¤é˜»å¡å¯èƒ½åœ¨ç­‰å¾…åŒä¸€ä¸ªsemaphoreå¯¹è±¡çš„å…¶ä»–åç¨‹å®ä¾‹\n    except web.HTTPNotFound:\n        status = HTTPStatus.not_found\n        msg = 'not found'\n    except Exception as exc:\n        raise FetchError(cc) from exc\n    else:\n        save_flag(image, cc.lower() + '.gif')\n        status = HTTPStatus.ok\n        msg = 'ok'\n    return Result(status, cc)\n\n@asyncio.coroutine\ndef downloader_coro(cc_list):\n    counter = collections.Counter()\n    # åˆ›å»ºä¸€ä¸ª asyncio.Semaphore å®ä¾‹ï¼Œæœ€å¤šå…è®¸æ¿€æ´»MAX_CONCUR_REQä¸ªä½¿ç”¨è¿™ä¸ªè®¡æ•°å™¨çš„åç¨‹\n    semaphore = asyncio.Semaphore(MAX_CONCUR_REQ)\n    # å¤šæ¬¡è°ƒç”¨ download_one åç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªåç¨‹å¯¹è±¡åˆ—è¡¨\n    to_do = [download_one(cc, semaphore) for cc in sorted(cc_list)]\n    # è·å–ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿™ä¸ªè¿­ä»£å™¨ä¼šåœ¨futureè¿è¡Œç»“æŸåè¿”å›future\n    to_do_iter = asyncio.as_completed(to_do)\n    for future in to_do_iter:\n        # è¿­ä»£å…è®¸ç»“æŸçš„ future    \n        try:\n            res = yield from future # è·å–asyncio.Future å¯¹è±¡çš„ç»“æœï¼ˆä¹Ÿå¯ä»¥è°ƒç”¨future.resultï¼‰\n        except FetchError as exc:\n            # æŠ›å‡ºçš„å¼‚å¸¸éƒ½åŒ…è£…åœ¨FetchError  å¯¹è±¡é‡Œ\n            country_code = exc.country_code\n            try:\n                # å°è¯•ä»åŸæ¥çš„å¼‚å¸¸ ï¼ˆ__cause__ï¼‰ä¸­è·å–é”™è¯¯æ¶ˆæ¯\n                error_msg = exc.__cause__.args[0]\n            except IndexError:\n                # å¦‚æœåœ¨åŸæ¥çš„å¼‚å¸¸ä¸­æ‰¾ä¸åˆ°é”™è¯¯æ¶ˆæ¯ï¼Œä½¿ç”¨æ‰€è¿æ¥å¼‚å¸¸çš„ç±»åä½œä¸ºé”™è¯¯æ¶ˆæ¯\n                error_msg = exc.__cause__.__class__.__name__\n            if error_msg:\n                msg = '*** Error for {}: {}'\n                print(msg.format(country_code, error_msg))\n            status = HTTPStatus.error\n        else:\n            status = res.status\n        counter[status] += 1\n    return counter\n\ndef download_many(cc_list):\n    loop = asyncio.get_event_loop()\n    coro = downloader_coro(cc_list)\n    counts = loop.run_until_complete(coro)\n    loop.close()\n    return counts\n\n\nif __name__ == '__main__':\n    main(download_many)\n```\n\nç”±äºåç¨‹å‘èµ·çš„è¯·æ±‚é€Ÿåº¦è¾ƒå¿«ï¼Œä¸ºäº†é˜²æ­¢å‘æœåŠ¡å™¨å‘èµ·å¤ªå¤šçš„å¹¶å‘è¯·æ±‚ï¼Œä½¿æœåŠ¡å™¨è¿‡è½½ï¼Œæˆ‘ä»¬åœ¨download_coro å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªasyncio.Semaphore å®ä¾‹ï¼Œç„¶åæŠŠå®ƒä¼ ç»™download_one å‡½æ•°ã€‚\n\n> `Semaphore` å¯¹è±¡ç»´æŠ¤ç€ä¸€ä¸ªå†…éƒ¨è®¡æ•°å™¨ï¼Œè‹¥åœ¨å¯¹è±¡ä¸Šè°ƒç”¨ `.acquire()` åç¨‹æ–¹æ³•ï¼Œè®¡æ•°å™¨åˆ™é€’å‡ï¼›è‹¥åœ¨å¯¹è±¡ä¸Šè°ƒç”¨ `.release()` åç¨‹æ–¹æ³•ï¼Œè®¡æ•°å™¨åˆ™é€’å¢ã€‚è®¡æ•°å™¨çš„å€¼æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™è®¾å®šã€‚\nå¦‚æœè®¡æ•°å™¨å¤§äº0ï¼Œé‚£ä¹ˆè°ƒç”¨ `.acquire()` æ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º0ï¼Œ `.acquire()` æ–¹æ³•ä¼šé˜»å¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åç¨‹ï¼Œç›´åˆ°å…¶ä»–åç¨‹åœ¨åŒä¸€ä¸ª Semaphore å¯¹è±¡ä¸Šè°ƒç”¨ `.release()` æ–¹æ³•ï¼Œè®©è®¡æ•°å™¨é€’å¢ã€‚\n\nåœ¨ä¸Šè¾¹çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ‰‹åŠ¨è°ƒç”¨ .acquire() æˆ– .release() æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨ download_one å‡½æ•°ä¸­ æŠŠ semaphore å½“åšä¸Šä¸‹æ–‡ç®¡ç†å™¨ä½¿ç”¨:\n\n```python\nwith (yield from semaphore):\n    image = yield from get_flag(cc)\n```\nè¿™æ®µä»£ç ä¿è¯ï¼Œä»»ä½•æ—¶å€™éƒ½ä¸ä¼šæœ‰è¶…è¿‡ MAX_CONCUR_REQ ä¸ª get_flag åç¨‹å¯åŠ¨ã€‚\n\n### ä½¿ç”¨ asyncio.as_completed å‡½æ•°\n\nå› ä¸ºè¦ä½¿ç”¨ yield from è·å– asyncio.as_completed å‡½æ•°äº§å‡ºçš„futureçš„ç»“æœï¼Œæ‰€ä»¥ as_completed å‡½æ•°ç§©åºåœ¨åç¨‹ä¸­è°ƒç”¨ã€‚ç”±äº download_many è¦ä½œä¸ºå‚æ•°ä¼ ç»™éåç¨‹çš„main å‡½æ•°ï¼Œæˆ‘å·²æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ downloader_coro åç¨‹ï¼Œè®©download_many å‡½æ•°åªç”¨äºè®¾ç½®äº‹ä»¶å¾ªç¯ã€‚\n\n### ä½¿ç”¨Executor å¯¹è±¡ï¼Œé˜²æ­¢é˜»å¡äº‹ä»¶å¾ªç¯\nç°åœ¨æˆ‘ä»¬å›å»çœ‹ä¸‹ä¸Šè¾¹**å…³äºç”µè„‘ä»ä¸åŒå­˜å‚¨ä»‹è´¨è¯»å–æ•°æ®çš„å»¶è¿Ÿæƒ…å†µå›¾**ï¼Œæœ‰ä¸€ä¸ªå®æ—¶éœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¼šé˜»å¡ã€‚\nä¸Šè¾¹çš„ä»£ç ä¸­ï¼Œsave_flag å‡½æ•°é˜»å¡äº†å®¢æˆ·ä»£ç ä¸ asyncio äº‹ä»¶å¾ªç¯å…¬ç”¨çš„å”¯ä¸€çº¿ç¨‹ï¼Œå› æ­¤ä¿å­˜æ–‡ä»¶æ—¶ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šæš‚åœã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨äº‹ä»¶å¾ªç¯å¯¹è±¡çš„ run_in_executor æ–¹æ³•ã€‚\n\nasyncio çš„äº‹ä»¶å¾ªç¯åœ¨åå°ç»´æŠ¤ç€ä¸€ä¸ªThreadPoolExecutor å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ run_in_executor æ–¹æ³•ï¼ŒæŠŠå¯è°ƒç”¨çš„å¯¹è±¡å‘ç»™å®ƒæ‰§è¡Œã€‚\nä¸‹è¾¹æ˜¯æˆ‘ä»¬æ”¹åŠ¨åçš„ä»£ç ï¼š\n\n```python\n@asyncio.coroutine\ndef download_one(cc, semaphore):\n    try:\n        with (yield from semaphore):\n            image = yield from get_flag(cc)\n    except web.HTTPNotFound:\n        status = HTTPStatus.not_found\n        msg = 'not found'\n    except Exception as exc:\n        raise FetchError(cc) from exc\n    else:\n        # è¿™é‡Œæ˜¯æ”¹åŠ¨éƒ¨åˆ†\n        loop = asyncio.get_event_loop()  # è·å–äº‹ä»¶å¾ªç¯çš„å¼•ç”¨\n        loop.run_in_executor(None, save_flag, image, cc.lower() + '.gif')\n        status = HTTPStatus.ok\n        msg = 'ok'\n    return Result(status, cc)\n\n```\n\nrun_in_executor æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Executor å®ä¾‹ï¼›å¦‚æœè®¾ä¸ºNone,ä½¿ç”¨äº‹ä»¶å¾ªç¯çš„é»˜è®¤ ThreadPoolExecutor å®ä¾‹ã€‚\n\n## ä»å›è°ƒåˆ°futureåˆ°åç¨‹\n\nåœ¨æ¥è§¦åç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½å¯¹å›è°ƒæœ‰ä¸€å®šçš„è®¤è¯†ï¼Œé‚£ä¹ˆå’Œå›è°ƒç›¸æ¯”ï¼Œåç¨‹æœ‰ä»€ä¹ˆæ”¹è¿›å‘¢ï¼Ÿ\n\npythonä¸­çš„å›è°ƒä»£ç æ ·å¼ï¼š\n\n```python\ndef stage1(response1):\n    request2 = step1(response1)\n    api_call2(request2, stage2)\n    \ndef stage2(response2):\n    request3 = step3(response3)\n    api_call3(request3, stage3)   \n\n def stage3(response3):\n     step3(response3) \n\napi_call1(request1, stage1)\n```\nä¸Šè¾¹çš„ä»£ç çš„ç¼ºé™·ï¼š\n* å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±\n* ä»£ç éš¾ä»¥é˜…è¯»\n\nåœ¨è¿™ä¸ªé—®é¢˜ä¸Šï¼Œåç¨‹èƒ½å‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ã€‚å¦‚æœæ¢æˆåç¨‹å’Œyield from ç»“æœåšçš„å¼‚æ­¥ä»£ç ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```python\n@asyncio.coroutine\ndef three_stages(request1):\n    response1 = yield from api_call1(request1)\n    request2 = step1(response1)\n    response2 = yield from api_call2(requests)\n    request3 = step2(response2)\n    response3 = yield from api_call3(requests)\n    step3(response3)  \n    \nloop.create_task(three_stages(request1)\n```\nå’Œä¹‹å‰çš„ä»£ç ç›¸æ¯”ï¼Œè¿™ä¸ªä»£ç å°±å®¹æ˜“ç†è§£å¤šäº†ã€‚å¦‚æœå¼‚æ­¥è°ƒç”¨ api_call1,api_call2,api_call3 ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠç›¸åº”çš„ yield from è¡¨è¾¾å¼æ”¾åœ¨ try/except å—ä¸­å¤„ç†å¼‚å¸¸ã€‚\nä½¿ç”¨åç¨‹å¿…é¡»ä¹ æƒ¯ yield from è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åç¨‹ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œå¿…é¡»æ˜¾å¼çš„æ’å®šåç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œæˆ–åœ¨å…¶ä»–æ’å®šäº†æ‰§è¡Œæ—¶é—´çš„åç¨‹ä¸­ä½¿ç”¨yield from è¡¨è¾¾å¼å§å®ƒæ¿€æ´»ã€‚å¦‚æœä¸ä½¿ç”¨ loop.create_task(three_stages(request1))ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚\n\nä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š\n\n#### æ¯æ¬¡ä¸‹è½½å‘èµ·å¤šæ¬¡è¯·æ±‚\n\næˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä¸Šè¾¹ä¸‹è½½å›½æ——çš„ä»£ç ï¼Œä½¿åœ¨ä¸‹è½½å›½æ——çš„åŒæ—¶è¿˜å¯ä»¥è·å–å›½å®¶åç§°åœ¨ä¿å­˜å›¾ç‰‡çš„æ—¶å€™ä½¿ç”¨ã€‚\næˆ‘ä»¬ä½¿ç”¨åç¨‹å’Œyield from è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\n\n```python\n@asyncio.coroutine\ndef http_get(url):\n    resp = yield from aiohttp.request('GET', url)\n    if resp.status == 200:\n        ctype = resp.headers.get('Content-type', '').lower()\n        if 'json' in ctype or url.endswith('json'):\n            data = yield from resp.json()\n        else:\n            data = yield from resp.read()\n        return data\n    elif resp.status == 404:\n        raise web.HttpNotFound()\n    else:\n        raise aiohttp.HttpProcessionError(\n            code=resp.status, message=resp.reason,\n            headers=resp.headers)\n\n\n@asyncio.coroutine\ndef get_country(cc):\n    url = \"{}/{cc}/metadata.json\".format(BASE_URL, cc=cc.lower())\n    metadata = yield from http_get(url)\n    return metadata['country']\n\n\n@asyncio.coroutine\ndef get_flag(cc):\n    url = \"{}/{cc}/{cc}.gif\".format(BASE_URL, cc=cc.lower())\n    return (yield from http_get(url))\n\n\n@asyncio.coroutine\ndef download_one(cc, semaphore):\n    try:\n        with (yield from semaphore):\n            image = yield from get_flag(cc)\n        with (yield from semaphore):\n            country = yield from get_country(cc)\n    except web.HTTPNotFound:\n        status = HTTPStatus.not_found\n        msg = 'not found'\n    except Exception as exc:\n        raise FetchError(cc) from exc\n    else:\n        country = country.replace(' ', '_')\n        filename = '{}--{}.gif'.format(country, cc)\n        print(filename)\n        loop = asyncio.get_event_loop()\n        loop.run_in_executor(None, save_flag, image, filename)\n        status = HTTPStatus.ok\n        msg = 'ok'\n    return Result(status, cc)\n```\nåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨download_one å‡½æ•°ä¸­åˆ†åˆ«åœ¨ semaphore æ§åˆ¶çš„ä¸¤ä¸ªwith å—ä¸­è°ƒç”¨get_flag å’Œ get_countryï¼Œæ˜¯ä¸ºäº†èŠ‚çº¦æ—¶é—´ã€‚\n\nget_flag çš„return è¯­å¥åœ¨å¤–å±‚åŠ ä¸Šæ‹¬å·ï¼Œæ˜¯å› ä¸º() çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜ï¼Œä¼šå…ˆæ‰§è¡Œæ‹¬å·å†…çš„yield from è¯­å¥ è¿”å›çš„ç»“æœã€‚å¦‚æœä¸åŠ  ä¼šæŠ¥å¥æ³•é”™è¯¯\nåŠ () ï¼Œç›¸å½“äº \n```python\nimage = yield from http_get(url)\nreturn image\n```\nå¦‚æœä¸åŠ ()ï¼Œé‚£ä¹ˆç¨‹åºä¼šåœ¨ yield from å¤„ä¸­æ–­ï¼Œäº¤å‡ºæ§åˆ¶æƒï¼Œè¿™æ—¶ä½¿ç”¨return ä¼šæŠ¥å¥æ³•é”™è¯¯ã€‚\n\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡æˆ‘ä»¬è®¨è®ºäº†ï¼š\n\n* å¯¹æ¯”äº†ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºå’Œasyncioç‰ˆï¼Œè¯´æ˜äº†å¤šçº¿ç¨‹å’Œå¼‚æ­¥ä»»åŠ¡ä¹‹é—´çš„å…³ç³»\n* æ¯”è¾ƒäº† asyncio.Future ç±» å’Œ concurrent.futures.Future ç±»çš„åŒºåˆ«\n* å¦‚ä½•ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹ç®¡ç†ç½‘ç»œåº”ç”¨ä¸­çš„é«˜å¹¶å‘\n* åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œä¸å›è°ƒç›¸æ¯”ï¼Œåç¨‹æ˜¾è‘—æå‡æ€§èƒ½çš„æ–¹å¼\n\nä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨asyncioåŒ…ç¼–å†™æœåŠ¡å™¨\n\n## å‚è€ƒé“¾æ¥\n\n* [class asyncio.Semaphore](https://docs.python.org/3/library/asyncio-sync.html#asyncio.Semaphore)\n* [asyncio â€” Asynchronous I/O, event loop, coroutines and tasks](https://docs.python.org/3/library/asyncio.html)\n* [ã€è¯‘ã€‘ Python 3.5 åç¨‹ç©¶ç«Ÿæ˜¯ä¸ªå•¥](http://blog.rainy.im/2016/03/10/how-the-heck-does-async-await-work-in-python-3-5/)\n* [PEP 0492 Coroutines with async and await syntax](https://www.python.org/dev/peps/pep-0492/)\n* [Python ä¹‹ asyncio](https://juejin.im/entry/57b138e1165abd00542ab1fa)\n* [æˆ‘æ‰€ä¸èƒ½ç†è§£çš„Pythonä¸­çš„Asyncioæ¨¡å—](https://python.freelycode.com/contribution/detail/515)\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonå¹¶å‘2ï¼šä½¿ç”¨asyncioå¤„ç†å¹¶å‘",
        "date": "2017-06-23 08:29:39",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°",
          "å¹¶å‘"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-asyncio"
    },
    {
      "content": "\n> ä½œä¸ºPythonç¨‹åºå‘˜ï¼Œå¹³æ—¶å¾ˆå°‘ä½¿ç”¨å¹¶å‘ç¼–ç¨‹ï¼Œå¶å°”ä½¿ç”¨ä¹Ÿåªéœ€è¦æ´¾ç”Ÿå‡ºä¸€æ‰¹ç‹¬ç«‹çš„çº¿ç¨‹ï¼Œç„¶åæ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ‰¹é‡æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œä¸å¤¸å¼ çš„è¯´ï¼Œè™½ç„¶æˆ‘çŸ¥é“çº¿ç¨‹ã€è¿›ç¨‹ã€å¹¶è¡Œã€å¹¶å‘çš„æ¦‚å¿µï¼Œä½†æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™å¯èƒ½è¿˜éœ€è¦å†æ‰“å¼€æ–‡æ¡£å›é¡¾ä¸€ä¸‹ã€‚\n\nç°åœ¨è¿™ä¸€ç¯‡è¿˜æ˜¯ *ã€Šæµç•…çš„pythonã€‹è¯»ä¹¦ç¬”è®°*ï¼Œè¯‘è€…åœ¨è¿™é‡ŒæŠŠfuture ç¿»è¯‘ä¸ºâ€œæœŸç‰©â€ï¼Œæˆ‘è§‰å¾—ä¸å¤ªåˆé€‚ï¼Œæ—¢ç„¶futureä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„è¯æ±‡ï¼Œæš‚æ—¶è¿˜æ˜¯ç›´æ¥ä½¿ç”¨ future å§ã€‚\n\n\n## concurrent.futures\n\nfuture æ˜¯ä¸€ç§å¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥æ‰§è¡Œçš„æ“ä½œã€‚è¿™ä¸ªæ¦‚å¿µæ˜¯ concurrent.futuresæ¨¡å—å’ŒasyncioåŒ…çš„åŸºç¡€ã€‚\n\nconcurrent.futures æ¨¡å—æ˜¯Python3.2 å¼•å…¥çš„ï¼Œå¯¹äºPython2x ç‰ˆæœ¬ï¼ŒPython2.5 ä»¥ä¸Šçš„ç‰ˆæœ¬å¯ä»¥å®‰è£… futures åŒ…æ¥ä½¿ç”¨è¿™ä¸ªæ¨¡å—ã€‚\n\nHUGOMORE42\n\nä»Python3.4èµ·ï¼Œæ ‡å‡†åº“ä¸­æœ‰ä¸¤ä¸ªä¸ºFutureçš„ç±»ï¼šconcurrent.futures.Future å’Œ asyncio.Futureã€‚è¿™ä¸¤ä¸ªç±»ä½œç”¨ç›¸åŒï¼šä¸¤ä¸ªFutureç±»çš„å®ä¾‹éƒ½è¡¨ç¤ºå¯èƒ½å·²ç»å®Œæˆæˆ–æœªå®Œæˆçš„å»¶è¿Ÿè®¡ç®—ã€‚\n\nFuture å°è£…å¾…å®Œæˆçš„æ“ä½œï¼Œå¯æ”¾å…¥é˜Ÿåˆ—ï¼Œå®Œæˆçš„çŠ¶æ€å¯ä»¥æŸ¥è¯¢ï¼Œå¾—åˆ°ç»“æœï¼ˆæˆ–æŠ›å‡ºå¼‚å¸¸ï¼‰åå¯ä»¥è·å–ç»“æœï¼ˆæˆ–å¼‚å¸¸ï¼‰ã€‚\n\næˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœç¨‹åºä¸­åŒ…å«I/Oæ“ä½œï¼Œç¨‹åºä¼šæœ‰å¾ˆé«˜çš„å»¶è¿Ÿï¼ŒCPUä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œè¿™æ—¶å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨å¹¶å‘ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚\n\n### ç¤ºä¾‹\n\næˆ‘ä»¬å…ˆä¸¾ä¸ªä¾‹å­ï¼š\n\nä¸‹è¾¹æ˜¯æœ‰ä¸¤æ®µä»£ç ï¼Œä¸»è¦åŠŸèƒ½éƒ½æ˜¯ä»ç½‘ä¸Šä¸‹è½½äººå£å‰20çš„å›½é™…çš„å›½æ——ï¼š\nç¬¬ä¸€æ®µä»£ç (flagss.py)æ˜¯ä¾åºä¸‹è½½ï¼šä¸‹è½½å®Œä¸€ä¸ªå›¾ç‰‡åä¿å­˜åˆ°ç¡¬ç›˜ï¼Œç„¶åè¯·æ±‚ä¸‹ä¸€å¼ å›¾ç‰‡ï¼›\nç¬¬äºŒæ®µä»£ç (flagss_threadpool.py)ä½¿ç”¨ concurrent.futures æ¨¡å—ï¼Œæ‰¹é‡ä¸‹è½½10å¼ å›¾ç‰‡ã€‚\n\nè¿è¡Œåˆ†åˆ«è¿è¡Œä¸¤æ®µä»£ç 3æ¬¡ï¼Œç»“æœå¦‚ä¸‹ï¼š\n\nimages.py çš„ç»“æœå¦‚ä¸‹\n\n```bash\n$ python flags.py\nBD BR CD CN DE EG ET FR ID IN IR JP MX NG PH PK RU TR US VN \n20 flags downloaded in 6.18s\n\n$ python flags.py\nBD BR CD CN DE EG ET FR ID IN IR JP MX NG PH PK RU TR US VN \n20 flags downloaded in 5.67s\n\n$ python flags.py\nBD BR CD CN DE EG ET FR ID IN IR JP MX NG PH PK RU TR US VN \n20 flags downloaded in 6.55s\n\n```\n\n> å¯ä»¥çœ‹åˆ°ï¼Œä¾æ¬¡ä¸‹è½½10å¼ å›¾ç‰‡ï¼Œå¹³å‡éœ€è¦6ç§’\n\nflags_threadpool.py çš„ç»“æœå¦‚ä¸‹ï¼š\n\n```bash\n$ python flags_threadpool.py\nNG EG VN BR JP FR DE CN TR BD PK MX PH US RU IN ET CD ID IR \n20 flags downloaded in 2.12s\n\n$ python flags_threadpool.py\nBR IN DE FR TR RU EG NG JP CN ID ET PK MX PH US IR CD VN BD \n20 flags downloaded in 2.23s\n\n$ python flags_threadpool.py\nCN BR DE ID NG RU TR IN MX US IR BD VN CD PH EG FR JP ET PK \n20 flags downloaded in 1.18s\n\n```\n> ä½¿ç”¨ concurrent.futures åï¼Œä¸‹è½½10å¼ å›¾ç‰‡å¹³å‡éœ€è¦2ç§’\n\né€šè¿‡ä¸Šè¾¹çš„ç»“æœæˆ‘ä»¬å‘ç°ä½¿ç”¨ concurrent.futures åï¼Œä¸‹è½½æ•ˆç‡å¤§å¹…æå‡ã€‚\n\nä¸‹è¾¹æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸¤æ®µä»£ç ã€‚\n\nåŒæ­¥æ‰§è¡Œçš„ä»£ç flags.pyï¼š\n\n```python\n#! -*- coding: utf-8 -*-\n\nimport os\nimport time\nimport sys\n\nimport requests  # <1>\n\nPOP20_CC = ('CN IN US ID BR PK NG BD RU JP '\n            'MX PH VN ET EG DE IR TR CD FR').split()  # <2>\n\nBASE_URL = 'http://flupy.org/data/flags'  # <3>\n\nDEST_DIR = 'images/'  # <4>\n\n\n# ä¿å­˜å›¾ç‰‡\ndef save_flag(img, filename):  # <5>\n    path = os.path.join(DEST_DIR, filename)\n    with open(path, 'wb') as fp:\n        fp.write(img)\n\n\n# ä¸‹è½½å›¾ç‰‡\ndef get_flag(cc):  # <6>\n    url = '{}/{cc}/{cc}.gif'.format(BASE_URL, cc=cc.lower())\n    # è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ requests åŒ…ï¼Œéœ€è¦å…ˆé€šè¿‡pypiå®‰è£…\n    resp = requests.get(url)\n    return resp.content\n\n\n# æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶ååˆ·æ–°sys.stdout,ç›®çš„æ˜¯åœ¨ä¸€è¡Œæ¶ˆæ¯ä¸­çœ‹åˆ°è¿›åº¦\ndef show(text):  # <7>\n    print(text, end=' ')\n    sys.stdout.flush()\n\n\ndef download_many(cc_list):  # <8>\n    for cc in sorted(cc_list):  # <9>\n        image = get_flag(cc)\n        show(cc)\n        save_flag(image, cc.lower() + '.gif')\n\n    return len(cc_list)\n\n\ndef main(download_many):  # <10>\n    t0 = time.time()\n    count = download_many(POP20_CC)\n    elapsed = time.time() - t0\n    msg = '\\n{} flags downloaded in {:.2f}s'\n    print(msg.format(count, elapsed))\n\n\nif __name__ == '__main__':\n    main(download_many)  # <11>\n```\n\nä½¿ç”¨ concurrent.future å¹¶å‘çš„ä»£ç  flags_threadpool.py\n\n```python\n#! -*- coding: utf-8 -*-\n\nfrom concurrent import futures\n\nfrom flags import save_flag, get_flag, show, main\n\n# è®¾å®šThreadPoolExecutor ç±»æœ€å¤šä½¿ç”¨å‡ ä¸ªçº¿ç¨‹\nMAX_WORKERS = 20\n\n\n# ä¸‹è½½ä¸€ä¸ªå›¾ç‰‡\ndef download_one(cc):\n    image = get_flag(cc)\n    show(cc)\n    save_flag(image, cc.lower() + '.gif')\n    return cc\n\n\ndef download_many(cc_list):\n    # è®¾å®šå·¥ä½œçš„çº¿ç¨‹æ•°é‡ï¼Œä½¿ç”¨çº¦éœ€çš„æœ€å¤§å€¼ä¸è¦å¤„ç†çš„æ•°é‡ç›´æ¥è¾ƒå°çš„é‚£ä¸ªå€¼ï¼Œä»¥å…åˆ›å»ºå¤šä½™çš„çº¿ç¨‹\n    workers = min(MAX_WORKERS, len(cc_list))  # <4>\n    # ä½¿ç”¨å·¥ä½œçš„çº¿ç¨‹æ•°å®ä¾‹åŒ–ThreadPoolExecutorç±»ï¼›\n    # executor.__exit__æ–¹æ³•ä¼šè°ƒç”¨executor.shutdown(wait=True)æ–¹æ³•ï¼Œ\n    # å®ƒä¼šåœ¨æ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•å‰é˜»å¡çº¿ç¨‹\n    with futures.ThreadPoolExecutor(workers) as executor:  # <5>\n        # map ä¸å†…ç½®mapæ–¹æ³•ç±»ä¼¼ï¼Œä¸è¿‡download_one å‡½æ•°ä¼šåœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¹¶å‘è°ƒç”¨ï¼›\n        # map æ–¹æ³•è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå› æ­¤å¯ä»¥è¿­ä»£ï¼Œ\n        # è¿­ä»£å™¨çš„__next__æ–¹æ³•è°ƒç”¨å„ä¸ªFuture çš„ result æ–¹æ³•\n        res = executor.map(download_one, sorted(cc_list))\n\n    # è¿”å›è·å–çš„ç»“æœæ•°é‡ï¼›å¦‚æœæœ‰ç°æˆæŠ›å‡ºå¼‚å¸¸ï¼Œä¼šåœ¨è¿™é‡ŒæŠ›å‡º\n    # è¿™ä¸éšå¼è°ƒç”¨next() å‡½æ•°ä»è¿­ä»£å™¨ä¸­è·å–ç›¸åº”çš„è¿”å›å€¼ä¸€æ ·ã€‚\n    return len(list(res))  # <7>\n    return len(results)\n\n\nif __name__ == '__main__':\n    main(download_many)\n```\n\nä¸Šè¾¹çš„ä»£ç ï¼Œæˆ‘ä»¬å¯¹ concurrent.futures çš„ä½¿ç”¨æœ‰äº†å¤§è‡´çš„äº†è§£ã€‚ä½† future åœ¨å“ªé‡Œå‘¢ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°ã€‚\n\nFuture æ˜¯ concurrent.futures æ¨¡å—å’Œ asyncio åŒ…çš„é‡è¦ç»„ä»¶ã€‚ä»Python3.4èµ·ï¼Œæ ‡å‡†åº“ä¸­æœ‰ä¸¤ä¸ªä¸ºFutureçš„ç±»ï¼šconcurrent.futures.Future å’Œ asyncio.Futureã€‚è¿™ä¸¤ä¸ªFutureä½œç”¨ç›¸åŒã€‚\n\nFuture å°è£…å¾…å®Œæˆçš„æ“ä½œï¼Œå¯æ”¾å…¥é˜Ÿåˆ—ï¼Œå®Œæˆçš„çŠ¶æ€å¯ä»¥æŸ¥è¯¢ï¼Œå¾—åˆ°ç»“æœï¼ˆæˆ–æŠ›å‡ºå¼‚å¸¸ï¼‰åå¯ä»¥è·å–ç»“æœï¼ˆæˆ–å¼‚å¸¸ï¼‰ã€‚\nFuture è¡¨ç¤ºç»ˆå°†å‘ç”Ÿçš„äº‹æƒ…ï¼Œè€Œç¡®å®šæŸä»¶äº‹æƒ…ä¼šå‘ç”Ÿçš„å”¯ä¸€æ–¹å¼æ˜¯æ‰§è¡Œçš„æ—¶é—´å·²ç»æ’å®šã€‚å› æ­¤åªæœ‰æŠŠæŸä»¶äº‹äº¤ç»™ concurrent.futures.Executor å­ç±»å¤„ç†æ—¶ï¼Œæ‰ä¼šåˆ›å»º concurrent.futures.Future å®ä¾‹ã€‚\n\n> ä¾‹å¦‚ï¼Œè°ƒç”¨Executor.submit() æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•åä¼šä¸ºä¼ å…¥çš„å¯è°ƒç”¨å¯¹è±¡æ’æœŸï¼Œå¹¶è¿”å›ä¸€ä¸ªFutureã€‚\n\nFuture æœ‰ä¸‰ä¸ªé‡è¦çš„æ–¹æ³•ï¼š\n\n* .done()  è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºFuture æ˜¯å¦å·²ç»æ‰§è¡Œ\n* .add_done_callback() è¿™ä¸ªæ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œç±»å‹æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼ŒFutureè¿è¡Œç»“æŸåä¼šå›è°ƒè¿™ä¸ªå¯¹è±¡ã€‚\n* .result() å¦‚æœ Future è¿è¡Œç»“æŸåè°ƒç”¨result(), ä¼šè¿”å›å¯è°ƒç”¨å¯¹è±¡çš„ç»“æœæˆ–è€…æŠ›å‡ºæ‰§è¡Œå¯è°ƒç”¨å¯¹è±¡æ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¦‚æœæ˜¯ Future æ²¡æœ‰è¿è¡Œç»“æŸæ—¶è°ƒç”¨ f.result()æ–¹æ³•ï¼Œè¿™æ—¶ä¼šé˜»å¡è°ƒç”¨æ–¹æ‰€åœ¨çš„çº¿ç¨‹ï¼Œç›´åˆ°æœ‰ç»“æœè¿”å›ã€‚æ­¤æ—¶result æ–¹æ³•è¿˜å¯ä»¥æ¥æ”¶ timeout å‚æ•°ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†… Future æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼Œä¼šæŠ›å‡º TimeoutError å¼‚å¸¸ã€‚\n\n> asyncio.Future.result æ–¹æ³•ä¸æ”¯æŒè®¾å®šè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœæƒ³è·å– Future çš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ yield from ç»“æ„\n\n\nä¸ºäº†åŠ æ·±å¯¹ Future çš„ç†è§£ï¼Œç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸‹ flags_threadpool.py download_many å‡½æ•°ã€‚\n\n\n```python\ndef download_many(cc_list):\n    cc_list = cc_list[:5]\n    with futures.ThreadPoolExecutor(max_workers=3) as executor:\n        to_do = []\n        # ç”¨äºåˆ›å»ºå¹¶æ’å®š future\n        for cc in sorted(cc_list):\n            # submit æ–¹æ³•æ’å®šå¯è°ƒç”¨å¯¹è±¡çš„æ‰§è¡Œæ—¶é—´ç„¶åè¿”å›ä¸€ä¸ªfutureï¼Œè¡¨ç¤ºè¿™ä¸ªå¾…æ‰§è¡Œçš„æ“ä½œ\n            future = executor.submit(download_one, cc)\n            to_do.append(future)\n            msg = 'Scheduled for {}: {}'\n            print(msg.format(cc, future))\n        \n        results = []\n        # ç”¨äºè·å–future ç»“æœ\n        # as_completed æ¥æ”¶ä¸€ä¸ªfuture åˆ—è¡¨ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œåœ¨è¿è¡Œç»“æŸåäº§å‡ºfuture\n        for future in futures.as_completed(to_do):\n            res = future.result()\n            msg = '{} result: {!r}'\n            print(msg.format(future, res))\n            results.append(res)\n    \n    return len(results)\n\n```\n\nç°åœ¨æ‰§è¡Œä»£ç ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\n```python\nScheduled for BR: <Future at 0x10d43cb70 state=running>\nScheduled for CN: <Future at 0x10d4434a8 state=running>\nScheduled for ID: <Future at 0x10d443ef0 state=running>\nScheduled for IN: <Future at 0x10d443978 state=pending>\nScheduled for US: <Future at 0x10d44f748 state=pending>\nBR <Future at 0x10d43cb70 state=finished returned str> result: 'BR'\nIN <Future at 0x10d443978 state=finished returned str> result: 'IN'\nCN <Future at 0x10d4434a8 state=finished returned str> result: 'CN'\nID <Future at 0x10d443ef0 state=finished returned str> result: 'ID'\nUS <Future at 0x10d44f748 state=finished returned str> result: 'US'\n\n5 flags downloaded in 1.47s\n```\n\nä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œfuture çš„ repr() æ–¹æ³•ä¼šæ˜¾ç¤ºçŠ¶æ€ï¼Œå‰ä¸‰ä¸ª æ˜¯running æ˜¯å› ä¸ºæˆ‘ä»¬è®¾å®šäº†ä¸‰ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥åä¸¤ä¸ªæ˜¯pendding çŠ¶æ€ã€‚å¦‚æœå°†max_workerså‚æ•°è®¾ç½®ä¸º5ï¼Œç»“æœå°±ä¼šå…¨éƒ½æ˜¯ runningã€‚\n\nè™½ç„¶ï¼Œä½¿ç”¨ future çš„è„šæ­¥æ¯”ç¬¬ä¸€ä¸ªè„šæœ¬çš„æ‰§è¡Œé€Ÿåº¦å¿«äº†å¾ˆå¤šï¼Œä½†ç”±äºå—GILçš„é™åˆ¶ï¼Œä¸‹è½½å¹¶ä¸æ˜¯å¹¶è¡Œçš„ã€‚\n\n## GILï¼ˆGlobal Interpreter Lockï¼‰å’Œé˜»å¡å‹I/O\n\nCPython è§£é‡Šå™¨æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤è§£é‡Šå™¨è¢«ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é”ä¿æŠ¤ç€ï¼Œå®ƒç¡®ä¿ä»»ä½•æ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªPythonçº¿ç¨‹æ‰§è¡Œã€‚\n\nç„¶è€Œï¼ŒPythonæ ‡å‡†åº“ä¸­æ‰€æœ‰æ‰§è¡Œé˜»å¡å‹I/Oæ“ä½œçš„å‡½æ•°ï¼Œåœ¨ç­‰å¾…ç³»ç»Ÿè¿”å›ç»“æœæ—¶éƒ½ä¼šé‡Šæ”¾GILã€‚è¿™æ„å‘³ç€I/Oå¯†é›†å‹Pythonç¨‹åºèƒ½ä»ä¸­å—ç›Šï¼šä¸€ä¸ªPythonçº¿ç¨‹ç­‰å¾…ç½‘ç»œå“åº”æ—¶ï¼Œé˜»å¡å‹I/Oå‡½æ•°ä¼šé‡Šæ”¾GILï¼Œå†è¿è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚\n\n> Python æ ‡å‡†åº“ä¸­æ‰€æœ‰é˜»å¡å‹I/Oå‡½æ•°éƒ½ä¼šé‡Šæ”¾GILï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è¿è¡Œã€‚time.sleep()å‡½æ•°ä¹Ÿä¼šé‡Šæ”¾GILã€‚\n\n**é‚£ä¹ˆå¦‚ä½•åœ¨CPUå¯†é›†å‹ä½œä¸šä¸­ä½¿ç”¨ concurrent.futures æ¨¡å—ç»•å¼€GILå‘¢ï¼Ÿ**\n\nç­”æ¡ˆæ˜¯ ä½¿ç”¨ *ProcessPoolExecutor* ç±»ã€‚\n\nä½¿ç”¨è¿™ä¸ªæ¨¡å—å¯ä»¥åœ¨åšCPUå¯†é›†å‹å·¥ä½œæ˜¯ç»•å¼€GILï¼Œåˆ©ç”¨æ‰€æœ‰å¯ç”¨æ ¸å¿ƒã€‚\n\n\nThreadPoolExecutor å’Œ ProcessPoolExecutor éƒ½å®ç°äº†é€šç”¨çš„ Executor æ¥å£ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„å°†åŸºäºçº¿ç¨‹çš„æ–¹æ¡ˆæ”¹ä¸ºä½¿ç”¨è¿›ç¨‹çš„æ–¹æ¡ˆã€‚\n\næ¯”å¦‚ä¸‹è¾¹è¿™æ ·ï¼š\n\n```python\ndef download_many(cc_list):\n    workers = min(MAX_WORKERS, len(cc_list))\n    with futures.ThreadPoolExecutor(workers) as executor:\n        pass\n\n# æ”¹æˆ\ndef download_many(cc_list):\n    with futures.ProcessPoolExecutor() as executor:\n        pass\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒThreadPoolExecutor éœ€è¦æŒ‡å®š max_workers å‚æ•°ï¼Œ\nè€Œ ProcessPoolExecutor çš„è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„é»˜è®¤å€¼æ˜¯ os.cup_count()(è®¡ç®—æœºcpuæ ¸å¿ƒæ•°)ã€‚\n\nProcessPoolExecutor çš„ä»·å€¼ä¸»è¦ä½“ç°åœ¨CPUå¯†é›†å‹ä½œä¸šä¸Šã€‚\n\n> ä½¿ç”¨Pythonå¤„ç†CPUå¯†é›†å‹å·¥ä½œï¼Œåº”è¯¥è¯•è¯•PyPyï¼Œä¼šæœ‰æ›´é«˜çš„æ‰§è¡Œé€Ÿåº¦ã€‚\n\nç°åœ¨æˆ‘ä»¬å›åˆ°å¼€å§‹çš„ä»£ç ï¼Œçœ‹ä¸‹ Executor.map å‡½æ•°ã€‚\n\næ–‡æ¡£ä¸­å¯¹mapå‡½æ•°çš„ä»‹ç»å¦‚ä¸‹ã€‚\n\n> map(func, *iterables, timeout=None, chunksize=1)\n\n> ç­‰åŒäº map(func, *iterables)ï¼Œä¸åŒçš„æ˜¯ func æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶è¿›è¡Œå¯¹ func çš„å¤šä¸ªè°ƒç”¨ã€‚å¦‚æœè°ƒç”¨ __next__()ï¼Œåˆ™è¿”å›çš„è¿­ä»£å™¨æå‡º concurrent.futures.TimeoutErrorï¼Œå¹¶ä¸”åœ¨ä» Executor.map() çš„åŸå§‹è°ƒç”¨èµ·çš„ timeout ç§’ä¹‹åç»“æœä¸å¯ç”¨ã€‚ timeout å¯ä»¥æ˜¯intæˆ–floatã€‚å¦‚æœæœªæŒ‡å®š timeout æˆ– Noneï¼Œåˆ™ç­‰å¾…æ—¶é—´æ²¡æœ‰é™åˆ¶ã€‚å¦‚æœè°ƒç”¨å¼•å‘å¼‚å¸¸ï¼Œé‚£ä¹ˆå½“ä»è¿­ä»£å™¨æ£€ç´¢å…¶å€¼æ—¶ï¼Œå°†å¼•å‘å¼‚å¸¸ã€‚å½“ä½¿ç”¨ ProcessPoolExecutor æ—¶ï¼Œæ­¤æ–¹æ³•å°† iterables åˆ†æˆå¤šä¸ªå—ï¼Œå®ƒä½œä¸ºå•ç‹¬çš„ä»»åŠ¡æäº¤åˆ°è¿›ç¨‹æ± ã€‚è¿™äº›å—çš„ï¼ˆè¿‘ä¼¼ï¼‰å¤§å°å¯ä»¥é€šè¿‡å°† chunksize è®¾ç½®ä¸ºæ­£æ•´æ•°æ¥æŒ‡å®šã€‚å¯¹äºéå¸¸é•¿çš„è¿­ä»£ï¼Œä¸é»˜è®¤å¤§å°1ç›¸æ¯”ï¼Œä½¿ç”¨å¤§å€¼ chunksize å¯ä»¥æ˜¾ç€æé«˜æ€§èƒ½ã€‚ä½¿ç”¨ ThreadPoolExecutorï¼Œchunksize æ²¡æœ‰æ•ˆæœã€‚\n\n> åœ¨ 3.5 ç‰ˆæ›´æ”¹: æ·»åŠ äº† chunksize å‚æ•°ã€‚\n\nExecutor.map è¿˜æœ‰ä¸ªç‰¹æ€§æ¯”è¾ƒæœ‰ç”¨ï¼Œé‚£å°±æ˜¯è¿™ä¸ªå‡½æ•°è¿”å›ç»“æœçš„é¡ºåºäºè°ƒç”¨å¼€å§‹çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚å¦‚æœç¬¬ä¸€ä¸ªè°ƒç”¨ç§°å…¶ç»“æœç”¨æ—¶10ç§’ï¼Œå…¶ä»–è°ƒç”¨åªç”¨1ç§’ï¼Œä»£ç ä¼šé˜»å¡10ç§’ï¼Œè·å–mapæ–¹æ³•è¿”å›çš„ç”Ÿæˆå™¨äº§å‡ºçš„ç¬¬ä¸€ä¸ªç»“æœã€‚\n\nå¦‚æœä¸æ˜¯è·å–åˆ°æ‰€æœ‰ç»“æœå†å¤„ç†ï¼Œé€šå¸¸ä¼šä½¿ç”¨ Executor.submit + Executor.as_completed ç»„åˆä½¿ç”¨çš„æ–¹æ¡ˆã€‚\n\nExecutor.submit + Executor.as_completed è¿™ä¸ªç»„åˆæ›´çµæ´»ï¼Œå› ä¸ºsubmitæ–¹æ³•èƒ½å¤„ç†ä¸åŒçš„å¯è°ƒç”¨å¯¹è±¡å’Œå‚æ•°ï¼Œè€Œexecutor.map åªèƒ½å¤„ç†å‚æ•°ä¸åŒçš„åŒä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ã€‚æ­¤å¤–ï¼Œä¼ ç»™futures.as_completed å‡½æ•°çš„æœŸç‰©é›†åˆå¯ä»¥æ¥è‡ªä¸åŒçš„ Executor å®ä¾‹ã€‚\n\n## future çš„å¼‚å¸¸å¤„ç†\n\nfutures æœ‰ä¸‰ä¸ªå¼‚å¸¸ç±»ï¼š\n\n* exception concurrent.futures.CancelledError  åœ¨futureå–æ¶ˆæ—¶å¼•å‘ã€‚\n* exception concurrent.futures.TimeoutError åœ¨futureæ“ä½œè¶…è¿‡ç»™å®šè¶…æ—¶æ—¶è§¦å‘ã€‚\n* exception concurrent.futures.process.BrokenProcessPool\nä» RuntimeError æ´¾ç”Ÿï¼Œå½“ ProcessPoolExecutor çš„ä¸€ä¸ªå·¥äººä»¥éå¹²å‡€æ–¹å¼ç»ˆæ­¢ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå®ƒä»å¤–éƒ¨è¢«æ€æ­»ï¼‰æ—¶ï¼Œå¼•å‘æ­¤å¼‚å¸¸ç±»ã€‚\n\næˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ï¼Œfuture.result() å‡ºç°å¼‚å¸¸çš„å¤„ç†æƒ…å†µã€‚ä»£ç æ”¹åŠ¨å¦‚ä¸‹ï¼š\n\n```python\n\n# å°†ç¬¬ä¸€ä¸ª CN æ”¹ä¸ºCN1 ä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒä»»æ„é”™è¯¯ä»£ç \nPOP20_CC = ('CN1 IN US ID BR PK NG BD RU JP '\n            'MX PH VN ET EG DE IR TR CD FR').split()\n\n\ndef get_flag(cc):  # <6>\n    url = '{}/{cc}/{cc}.gif'.format(BASE_URL, cc=cc.lower())\n    resp = requests.get(url)\n    if resp.status_code != 200:  # <1>\n        resp.raise_for_status() # å¦‚æœä¸æ˜¯200 æŠ›å‡ºå¼‚å¸¸\n    return resp.content\n\ndef download_one(cc):\n    try:\n        image = get_flag(cc)\n    # æ•è· requests.exceptions.HTTPError\n    except requests.exceptions.HTTPError as exc:  #\n        # å¦‚æœæœ‰å¼‚å¸¸ ç›´æ¥æŠ›å‡º\n        raise\n    else:\n        save_flag(image, cc.lower() + '.gif')\n    return cc\n\n```\n\nç°åœ¨æ‰§è¡Œä»£ç ï¼Œä¼šå‘ç° download_one ä¸­çš„å¼‚å¸¸ä¼ é€’åˆ°äº†download_many ä¸­,å¹¶ä¸”å¯¼è‡´æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæœªæ‰§è¡Œå®Œçš„å…¶å®ƒfuture ä¹Ÿéƒ½ä¸­æ–­ã€‚\n\nä¸ºäº†èƒ½ä¿è¯å…¶å®ƒæ²¡æœ‰é”™è¯¯çš„future å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å¯¹future.result() åšå¼‚å¸¸å¤„ç†ã€‚\n\næ”¹åŠ¨ç»“æœå¦‚ä¸‹ï¼š\n\n```python\ndef download_many(cc_list):\n    cc_list = cc_list[:5]\n    with futures.ThreadPoolExecutor(max_workers=20) as executor:\n        to_do_map = {}\n        for cc in sorted(cc_list):\n            future = executor.submit(download_one, cc)\n            to_do_map[future] = cc\n            msg = 'Scheduled for {}: {}'\n            print(msg.format(cc, future))\n\n        results = []\n        for future in futures.as_completed(to_do_map):\n            try:\n                res = future.result()\n            except requests.exceptions.HTTPError as exc:\n                # å¤„ç†å¯èƒ½å‡ºç°çš„å¼‚å¸¸\n                error_msg = '{} result {}'.format(cc, exc)\n            else:\n                error_msg = ''\n            if error_msg:\n                cc = to_do_map[future]  # <16>\n                print('*** Error for {}: {}'.format(cc, error_msg))\n            else:\n                msg = '{} result: {!r}'\n                print(msg.format(future, res))\n                results.append(res)\n\n    return len(results)\n\n```\n\nè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°äº†ä¸€ä¸ªå¯¹ futures.as_completed å‡½æ•°ç‰¹åˆ«æœ‰ç”¨çš„æƒ¯ç”¨æ³•ï¼šæ„å»ºä¸€ä¸ªå­—å…¸ï¼ŒæŠŠå„ä¸ªfutureæ˜ å°„åˆ°å…¶ä»–æ•°æ®ï¼ˆfutureè¿è¡Œç»“æŸåå¯èƒ½ç”¨çš„ï¼‰ä¸Šã€‚è¿™æ ·ï¼Œè™½ç„¶ futureç”Ÿæˆçš„é¡ºåºè™½ç„¶å·²ç»ä¹±äº†ï¼Œä¾ç„¶ä¾¿äºä½¿ç”¨ç»“æœåšåç»­å¤„ç†ã€‚\n\nä¸€ç¯‡å†™å®Œäº†æ²¡æœ‰æ€»ç»“æ€»æ„Ÿè§‰å°‘ç‚¹ä»€ä¹ˆï¼Œæ‰€ä»¥ã€‚\n\n## æ€»ç»“\n\nPython è‡ª 0.9.8 ç‰ˆå°±æ”¯æŒçº¿ç¨‹äº†ï¼Œconcurrent.futures åªä¸è¿‡æ˜¯ä½¿ç”¨çº¿ç¨‹çš„æœ€æ–°æ–¹å¼ã€‚\n\nfutures.ThreadPoolExecutor ç±»å°è£…äº† threading æ¨¡å—çš„ç»„ä»¶ï¼Œä½¿ä½¿ç”¨çº¿ç¨‹å˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚\n\né¡ºä¾¿å†æ¨èä¸€ä¸‹ ã€Šæµç•…çš„pythonã€‹ï¼Œç»å¯¹å€¼å¾—ä¸€ä¸‹ã€‚\n\nä¸‹ä¸€ç¯‡ç¬”è®°åº”è¯¥æ˜¯ä½¿ç”¨ asyncio å¤„ç†å¹¶å‘ã€‚\n\n------------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonå¹¶å‘ 1ï¼šä½¿ç”¨ futures å¤„ç†å¹¶å‘",
        "date": "2017-06-17 14:01:51",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°",
          "å¹¶å‘"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-concurrency-with-futures"
    },
    {
      "content": "\n> æœ€è¿‘æ‰¾åˆ°ä¸€æœ¬pythonå¥½ä¹¦ã€Šæµç•…çš„pythonã€‹ï¼Œæ˜¯åˆ°ç°åœ¨ä¸ºæ­¢çœ‹åˆ°çš„å¯¹pythoné«˜çº§ç‰¹æ€§è®²è¿°æœ€è¯¦ç»†çš„ä¸€æœ¬ã€‚\n> çœ‹äº†åç¨‹ä¸€ç« ï¼Œåšä¸ªè¯»ä¹¦ç¬”è®°ï¼ŒåŠ æ·±å°è±¡ã€‚\n\n## åç¨‹å®šä¹‰\n\nåç¨‹çš„åº•å±‚æ¶æ„æ˜¯åœ¨pep342 ä¸­å®šä¹‰ï¼Œå¹¶åœ¨python2.5 å®ç°çš„ã€‚\n\nHUGOMORE42\n\npython2.5 ä¸­ï¼Œyieldå…³é”®å­—å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œè€Œä¸”\bç”Ÿæˆå™¨APIä¸­å¢åŠ äº† .send(value)æ–¹æ³•ã€‚ç”Ÿæˆå™¨å¯ä»¥ä½¿ç”¨\b.send(...)æ–¹æ³•å‘é€æ•°æ®ï¼Œå‘é€çš„æ•°æ®ä¼šæˆä¸ºç”Ÿæˆå™¨å‡½æ•°ä¸­yieldè¡¨è¾¾å¼çš„å€¼ã€‚\n\nåç¨‹æ˜¯æŒ‡ä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸è°ƒç”¨æ–¹åä½œï¼Œ\bäº§å‡ºæœ‰è°ƒç”¨æ–¹æä¾›çš„å€¼ã€‚å› æ­¤ï¼Œç”Ÿæˆå™¨å¯ä»¥ä½œä¸ºåç¨‹ä½¿ç”¨ã€‚\n\n> é™¤äº† .send(...)æ–¹æ³•ï¼Œpep342 å’Œæ·»åŠ äº† .throw(...)ï¼ˆè®©è°ƒç”¨æ–¹æŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨ç”Ÿæˆå™¨ä¸­å¤„ç†ï¼‰å’Œ.close()ï¼ˆç»ˆæ­¢ç”Ÿæˆå™¨ï¼‰æ–¹æ³•ã€‚\n\npython3.3åï¼Œpep380å¯¹ç”Ÿæˆå™¨å‡½æ•°åšäº†ä¸¤å¤„æ”¹åŠ¨ï¼š\n\n* \bç”Ÿæˆå™¨å¯ä»¥è¿”å›ä¸€ä¸ªå€¼ï¼›ä»¥å‰ï¼Œå¦‚æœç”Ÿæˆå™¨ä¸­ç»™returnè¯­å¥æä¾›å€¼ï¼Œä¼šæŠ›å‡ºSyntaxErrorå¼‚å¸¸ã€‚\n* å¼•å…¥yield from è¯­æ³•ï¼Œä½¿ç”¨å®ƒå¯ä»¥æŠŠå¤æ‚çš„ç”Ÿæˆå™¨é‡æ„æˆå°å‹çš„åµŒå¥—ç”Ÿæˆå™¨ï¼Œçœå»ä¹‹å‰æŠŠç”Ÿæˆå™¨çš„å·¥ä½œå§”æ‰˜ç»™å­ç”Ÿæˆå™¨æ‰€éœ€çš„å¤§é‡æ¨¡æ¿ä»£ç ã€‚\n\n## åç¨‹ç”Ÿæˆå™¨çš„åŸºæœ¬è¡Œä¸º\n\né¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œåç¨‹æœ‰å››ä¸ªçŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨inspect.getgeneratorstate(...)å‡½æ•°ç¡®å®šï¼š\n\n* GEN_CREATED    # ç­‰å¾…å¼€å§‹æ‰§è¡Œ\n* GEN_RUNNING    # è§£é‡Šå™¨æ­£åœ¨æ‰§è¡Œï¼ˆåªæœ‰åœ¨å¤šçº¿ç¨‹åº”ç”¨ä¸­æ‰èƒ½çœ‹åˆ°è¿™ä¸ªçŠ¶æ€ï¼‰\n* GEN_SUSPENDED  # åœ¨yieldè¡¨è¾¾å¼å¤„æš‚åœ\n* GEN_CLOSED     # æ‰§è¡Œç»“æŸ\n\n```python\n#! -*- coding: utf-8 -*-\nimport inspect\n\n# åç¨‹ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°å®šä¹‰ï¼šå®šä¹‰ä½“ä¸­æœ‰yieldå…³é”®å­—ã€‚\ndef simple_coroutine():\n    print('-> coroutine started')\n    # yield åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼›å¦‚æœåç¨‹åªéœ€è¦ä»å®¢æˆ·é‚£é‡Œæ¥æ”¶æ•°æ®ï¼Œyieldå…³é”®å­—å³è¾¹ä¸éœ€è¦åŠ è¡¨è¾¾å¼ï¼ˆyieldé»˜è®¤è¿”å›Noneï¼‰\n    x = yield\n    print('-> coroutine received:', x)\n\nmy_coro = simple_coroutine()\nmy_coro # å’Œåˆ›å»ºç”Ÿæˆå™¨çš„æ–¹å¼ä¸€æ ·ï¼Œè°ƒç”¨å‡½æ•°å¾—åˆ°ç”Ÿæˆå™¨å¯¹è±¡ã€‚\n# åç¨‹å¤„äº GEN_CREATED (ç­‰å¾…å¼€å§‹çŠ¶æ€)\nprint(inspect.getgeneratorstate(my_coro))\n\nmy_coro.send(None)\n# é¦–å…ˆè¦è°ƒç”¨next()å‡½æ•°ï¼Œå› ä¸ºç”Ÿæˆå™¨è¿˜æ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åœ¨yieldè¯­å¥å¤„æš‚åœï¼Œæ‰€ä»¥å¼€å§‹æ— æ³•å‘é€æ•°æ®\n# å‘é€ None å¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœ my_coro.send(None) \nnext(my_coro)\n# æ­¤æ—¶åç¨‹å¤„äº GEN_SUSPENDED (åœ¨yieldè¡¨è¾¾å¼å¤„æš‚åœ)\nprint(inspect.getgeneratorstate(my_coro))\n\n# è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼Œåç¨‹å®šä¹‰ä½“ä¸­çš„yieldè¡¨è¾¾å¼ä¼šè®¡ç®—å‡º42ï¼›ç°åœ¨åç¨‹ä¼šæ¢å¤ï¼Œä¸€ç›´è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªyieldè¡¨è¾¾å¼ï¼Œæˆ–è€…ç»ˆæ­¢ã€‚\nmy_coro.send(42)\nprint(inspect.getgeneratorstate(my_coro))\n```\n\nè¿è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹\n\n```python\nGEN_CREATED\n-> coroutine started\nGEN_SUSPENDED\n-> coroutine received: 42\n\n# è¿™é‡Œï¼Œæ§åˆ¶æƒæµåŠ¨åˆ°åç¨‹å®šä¹‰ä½“çš„å°¾éƒ¨ï¼Œå¯¼è‡´ç”Ÿæˆå™¨åƒå¾€å¸¸ä¸€æ ·æŠ›å‡ºStopIterationå¼‚å¸¸\nTraceback (most recent call last):\n  File \"/Users/gs/coroutine.py\", line 18, in <module> \n    my_coro.send(42)\nStopIteration\n```\n\n> sendæ–¹æ³•çš„å‚æ•°ä¼šæˆä¸ºæš‚åœyieldè¡¨è¾¾å¼çš„å€¼ï¼Œæ‰€ä»¥ï¼Œä»…å½“åç¨‹å¤„äºæš‚åœçŠ¶æ€æ˜¯æ‰èƒ½è°ƒç”¨sendæ–¹æ³•ã€‚\n> å¦‚æœåç¨‹è¿˜æœªæ¿€æ´»ï¼ˆGEN_CREATED çŠ¶æ€ï¼‰è¦è°ƒç”¨next(my_coro) æ¿€æ´»åç¨‹ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨my_coro.send(None)\n\n\nå¦‚æœåˆ›å»ºåç¨‹å¯¹è±¡åç«‹å³æŠŠNoneä¹‹å¤–çš„å€¼å‘ç»™å®ƒï¼Œä¼šå‡ºç°ä¸‹è¿°é”™è¯¯ï¼š\n\n```python\n>>> my_coro = simple_coroutine()\n>>> my_coro.send(123)\n\nTraceback (most recent call last):\n  File \"/Users/gs/coroutine.py\", line 14, in <module>\n    my_coro.send(123)\nTypeError: can't send non-None value to a just-started generator\n```\nä»”ç»†çœ‹é”™è¯¯æ¶ˆæ¯\n\n> can't send non-None value to a just-started generator\n\næœ€å…ˆè°ƒç”¨next(my_coro) è¿™ä¸€æ­¥é€šå¸¸ç§°ä¸ºâ€é¢„æ¿€â€œï¼ˆprimeï¼‰åç¨‹---å³ï¼Œè®©åç¨‹å‘å‰æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ªyieldè¡¨è¾¾å¼ï¼Œå‡†å¤‡å¥½ä½œä¸ºæ´»è·ƒçš„åç¨‹ä½¿ç”¨ã€‚\n\n#### å†çœ‹ä¸€ä¸ªä¸¤ä¸ªå€¼å¾—åç¨‹\n\n```python\ndef simple_coro2(a):\n    print('-> coroutine started: a =', a)\n    b = yield a\n    print('-> Received: b =', b)\n    c = yield a + b\n    print('-> Received: c =', c)\n\nmy_coro2 = simple_coro2(14)\nprint(inspect.getgeneratorstate(my_coro2))\n# è¿™é‡Œinspect.getgeneratorstate(my_coro2) å¾—åˆ°ç»“æœä¸º GEN_CREATED ï¼ˆåç¨‹æœªå¯åŠ¨ï¼‰\n\nnext(my_coro2)\n# å‘å‰æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ªyield å¤„ æ‰“å° â€œ-> coroutine started: a = 14â€\n# å¹¶ä¸”äº§ç”Ÿå€¼ 14 ï¼ˆyield a æ‰§è¡Œ ç­‰å¾…ä¸ºbèµ‹å€¼ï¼‰\nprint(inspect.getgeneratorstate(my_coro2))\n# è¿™é‡Œinspect.getgeneratorstate(my_coro2) å¾—åˆ°ç»“æœä¸º GEN_SUSPENDED ï¼ˆåç¨‹å¤„äºæš‚åœçŠ¶æ€ï¼‰\n\nmy_coro2.send(28)\n# å‘å‰æ‰§è¡Œåˆ°ç¬¬äºŒä¸ªyield å¤„ æ‰“å° â€œ-> Received: b = 28â€\n# å¹¶ä¸”äº§ç”Ÿå€¼ a + b = 42ï¼ˆyield a + b æ‰§è¡Œ å¾—åˆ°ç»“æœ42 ç­‰å¾…ä¸ºcèµ‹å€¼ï¼‰\nprint(inspect.getgeneratorstate(my_coro2))\n# è¿™é‡Œinspect.getgeneratorstate(my_coro2) å¾—åˆ°ç»“æœä¸º GEN_SUSPENDED ï¼ˆåç¨‹å¤„äºæš‚åœçŠ¶æ€ï¼‰\n\nmy_coro2.send(99)\n# æŠŠæ•°å­—99å‘é€ç»™æš‚åœåç¨‹ï¼Œè®¡ç®—yield è¡¨è¾¾å¼ï¼Œå¾—åˆ°99ï¼Œç„¶åæŠŠé‚£ä¸ªæ•°èµ‹å€¼ç»™c æ‰“å° â€œ-> Received: c = 99â€\n# åç¨‹ç»ˆæ­¢ï¼ŒæŠ›å‡ºStopIteration\n```\n\nè¿è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹\n\n```python\nGEN_CREATED\n-> coroutine started: a = 14\nGEN_SUSPENDED\n-> Received: b = 28\n-> Received: c = 99\n\nTraceback (most recent call last):\n  File \"/Users/gs/coroutine.py\", line 37, in <module>\n    my_coro2.send(99)\nStopIteration\n```\n\nsimple_coro2 åç¨‹çš„æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸º3ä¸ªé˜¶æ®µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\n\n![](http://omuo4kh1k.bkt.clouddn.com/3b3UCuR_iYj3-r_V4PUErxrFm0v1uIo7p4yoplxnqaQt7PK4iUO8CAWlg7chZyW_)\n\n1. è°ƒç”¨next(my_coro2)ï¼Œæ‰“å°ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œyield aï¼Œäº§å‡ºæ•°å­—14.\n2. è°ƒç”¨my_coro2.send(28)ï¼ŒæŠŠ28èµ‹å€¼ç»™bï¼Œæ‰“å°ç¬¬äºŒä¸ªæ¶ˆæ¯ï¼Œç„¶åæ‰§è¡Œ yield a + b äº§ç”Ÿæ•°å­—42\n3. è°ƒç”¨my_coro2.send(99)ï¼ŒæŠŠ99èµ‹å€¼ç»™cï¼Œç„¶åæ‰“å°ç¬¬ä¸‰ä¸ªæ¶ˆæ¯ï¼Œåç¨‹ç»ˆæ­¢ã€‚\n\n## ä½¿ç”¨è£…é¥°å™¨é¢„æ¿€åç¨‹\n\næˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œåç¨‹å¦‚æœä¸é¢„æ¿€ï¼Œä¸èƒ½ä½¿ç”¨send() ä¼ å…¥éNone æ•°æ®ã€‚æ‰€ä»¥ï¼Œè°ƒç”¨my_coro.send(x)ä¹‹å‰ï¼Œä¸€å®šè¦è°ƒç”¨next(my_coro)ã€‚\nä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨è£…é¥°å™¨é¢„æ¿€åç¨‹ã€‚\n\n```python\nfrom functools import wraps\n\ndef coroutinue(func):\n    '''\n    è£…é¥°å™¨ï¼š å‘å‰æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª`yield`è¡¨è¾¾å¼ï¼Œé¢„æ¿€`func`\n    :param func: func name\n    :return: primer\n    '''\n\n    @wraps(func)\n    def primer(*args, **kwargs):\n        # æŠŠè£…é¥°å™¨ç”Ÿæˆå™¨å‡½æ•°æ›¿æ¢æˆè¿™é‡Œçš„primerå‡½æ•°ï¼›è°ƒç”¨primerå‡½æ•°æ—¶ï¼Œè¿”å›é¢„æ¿€åçš„ç”Ÿæˆå™¨ã€‚\n        gen = func(*args, **kwargs)\n        # è°ƒç”¨è¢«è¢«è£…é¥°å‡½æ•°ï¼Œè·å–ç”Ÿæˆå™¨å¯¹è±¡\n        next(gen)  # é¢„æ¿€ç”Ÿæˆå™¨\n        return gen  # è¿”å›ç”Ÿæˆå™¨\n    return primer\n\n\n# ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹\n\n@coroutinue\ndef simple_coro(a):\n    a = yield\n\nsimple_coro(12)  # å·²ç»é¢„æ¿€\n```\n\n## ç»ˆæ­¢åç¨‹å’Œå¼‚å¸¸å¤„ç†\n\nåç¨‹ä¸­ï¼Œä¸ºå¤„ç†çš„å¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ é€’ç»™nextå‡½æ•°æˆ–sendæ–¹æ³•çš„è°ƒç”¨æ–¹ï¼Œæœªå¤„ç†çš„å¼‚å¸¸ä¼šå¯¼è‡´åç¨‹ç»ˆæ­¢ã€‚\n\nçœ‹ä¸‹è¾¹è¿™ä¸ªä¾‹å­\n\n```python\n#! -*- coding: utf-8 -*-\n\nfrom functools import wraps\n\ndef coroutinue(func):\n    '''\n    è£…é¥°å™¨ï¼š å‘å‰æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª`yield`è¡¨è¾¾å¼ï¼Œé¢„æ¿€`func`\n    :param func: func name\n    :return: primer\n    '''\n\n    @wraps(func)\n    def primer(*args, **kwargs):\n        # æŠŠè£…é¥°å™¨ç”Ÿæˆå™¨å‡½æ•°æ›¿æ¢æˆè¿™é‡Œçš„primerå‡½æ•°ï¼›è°ƒç”¨primerå‡½æ•°æ—¶ï¼Œè¿”å›é¢„æ¿€åçš„ç”Ÿæˆå™¨ã€‚\n        gen = func(*args, **kwargs)\n        # è°ƒç”¨è¢«è¢«è£…é¥°å‡½æ•°ï¼Œè·å–ç”Ÿæˆå™¨å¯¹è±¡\n        next(gen)  # é¢„æ¿€ç”Ÿæˆå™¨\n        return gen  # è¿”å›ç”Ÿæˆå™¨\n    return primer\n\n\n@coroutinue\ndef averager():\n    # ä½¿ç”¨åç¨‹æ±‚å¹³å‡å€¼\n    total = 0.0\n    count = 0\n    average = None\n    while True:\n        term = yield average\n        total += term\n        count += 1\n        average = total/count\n\ncoro_avg = averager()\nprint(coro_avg.send(40))\nprint(coro_avg.send(50))\nprint(coro_avg.send('123')) # ç”±äºå‘é€çš„ä¸æ˜¯æ•°å­—ï¼Œå¯¼è‡´å†…éƒ¨æœ‰å¼‚å¸¸æŠ›å‡ºã€‚\n```\n\næ‰§è¡Œä¸Šè¿°ä»£ç ç»“æœå¦‚ä¸‹\n\n```python\n40.0\n45.0\nTraceback (most recent call last):\n  File \"/Users/gs/coro_exception.py\", line 37, in <module>\n    print(coro_avg.send('123'))\n  File \"/Users/gs/coro_exception.py\", line 30, in averager\n    total += term\nTypeError: unsupported operand type(s) for +=: 'float' and 'str'\n```\n\nå‡ºé”™çš„åŸå› æ˜¯å‘é€ç»™åç¨‹çš„'123'å€¼ä¸èƒ½åŠ åˆ°totalå˜é‡ä¸Šã€‚\nå‡ºé”™åï¼Œå¦‚æœå†æ¬¡è°ƒç”¨ coro_avg.send(x) æ–¹æ³• ä¼šæŠ›å‡º StopIteration å¼‚å¸¸ã€‚\n\nç”±ä¸Šè¾¹çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœæƒ³è®©åç¨‹é€€å‡ºï¼Œå¯ä»¥å‘é€ç»™å®ƒä¸€ä¸ªç‰¹å®šçš„å€¼ã€‚æ¯”å¦‚Noneå’ŒEllipsisã€‚ï¼ˆæ¨èä½¿ç”¨Ellipsisï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¤ªä½¿ç”¨è¿™ä¸ªå€¼ï¼‰\nä»Python2.5 å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç”Ÿæˆå™¨ä¸Šè°ƒç”¨ä¸¤ä¸ªæ–¹æ³•ï¼Œæ˜¾å¼çš„æŠŠå¼‚å¸¸å‘ç»™åç¨‹ã€‚\nè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯throwå’Œcloseã€‚\n\n```python\ngenerator.throw(exc_type[, exc_value[, traceback]])\n```\n\nè¿™ä¸ªæ–¹æ³•ä½¿ç”Ÿæˆå™¨åœ¨æš‚åœçš„yieldè¡¨è¾¾å¼å¤„æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ã€‚å¦‚æœç”Ÿæˆå™¨å¤„ç†äº†æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä»£ç ä¼šå‘å‰æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªyieldè¡¨è¾¾å¼ï¼Œè€Œäº§å‡ºçš„å€¼ä¼šæˆä¸ºè°ƒç”¨throwæ–¹æ³•å¾—åˆ°çš„è¿”å›å€¼ã€‚å¦‚æœæ²¡æœ‰å¤„ç†ï¼Œåˆ™å‘ä¸Šå†’æ³¡ï¼Œç›´æ¥æŠ›å‡ºã€‚\n\n```python\ngenerator.close()\n```\n\nç”Ÿæˆå™¨åœ¨æš‚åœçš„yieldè¡¨è¾¾å¼å¤„æŠ›å‡ºGeneratorExitå¼‚å¸¸ã€‚\nå¦‚æœç”Ÿæˆå™¨æ²¡æœ‰å¤„ç†è¿™ä¸ªå¼‚å¸¸æˆ–è€…æŠ›å‡ºäº†StopIterationå¼‚å¸¸ï¼Œè°ƒç”¨æ–¹ä¸ä¼šæŠ¥é”™ã€‚å¦‚æœæ”¶åˆ°GeneratorExitå¼‚å¸¸ï¼Œç”Ÿæˆå™¨ä¸€å®šä¸èƒ½äº§å‡ºå€¼ï¼Œå¦åˆ™è§£é‡Šå™¨ä¼šæŠ›å‡ºRuntimeErrorå¼‚å¸¸ã€‚\n\n#### ç¤ºä¾‹ï¼š ä½¿ç”¨closeå’Œthrowæ–¹æ³•æ§åˆ¶åç¨‹ã€‚\n\n```python\nimport inspect\n\n\nclass DemoException(Exception):\n    pass\n\n\n@coroutinue\ndef exc_handling():\n    print('-> coroutine started')\n    while True:\n        try:\n            x = yield\n        except DemoException:\n            print('*** DemoException handled. Conginuing...')\n        else:\n            # å¦‚æœæ²¡æœ‰å¼‚å¸¸æ˜¾ç¤ºæ¥æ”¶åˆ°çš„å€¼\n            print('--> coroutine received: {!r}'.format(x))\n    raise RuntimeError('This line should never run.')  # è¿™ä¸€è¡Œæ°¸è¿œä¸ä¼šæ‰§è¡Œ \n\n\nexc_coro = exc_handling()\n\nexc_coro.send(11)\nexc_coro.send(12)\nexc_coro.send(13)\nexc_coro.close()\nprint(inspect.getgeneratorstate(exc_coro))\n```\n\n> raise RuntimeError('This line should never run.') æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºåªæœ‰æœªå¤„ç†çš„å¼‚å¸¸æ‰ä¼šç»ˆæ­¢å¾ªç¯ï¼Œè€Œä¸€æ—¦å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œåç¨‹ä¼šç«‹å³ç»ˆæ­¢ã€‚\n\næ‰§è¡Œä¸Šè¿°ä»£ç å¾—åˆ°ç»“æœä¸ºï¼š\n\n```python\n-> coroutine started\n--> coroutine received: 11\n--> coroutine received: 12\n--> coroutine received: 13\nGEN_CLOSED    # åç¨‹ç»ˆæ­¢\n```\n\nä¸Šè¿°ä»£ç ï¼Œå¦‚æœä¼ å…¥DemoExceptionï¼Œåç¨‹ä¸ä¼šä¸­æ­¢ï¼Œå› ä¸ºåšäº†å¼‚å¸¸å¤„ç†ã€‚\n\n```python\nexc_coro = exc_handling()\n\nexc_coro.send(11)\nexc_coro.send(12)\nexc_coro.send(13)\nexc_coro.throw(DemoException) # åç¨‹ä¸ä¼šä¸­æ­¢ï¼Œä½†æ˜¯å¦‚æœä¼ å…¥çš„æ˜¯æœªå¤„ç†çš„å¼‚å¸¸ï¼Œåç¨‹ä¼šç»ˆæ­¢\nprint(inspect.getgeneratorstate(exc_coro))\nexc_coro.close()\nprint(inspect.getgeneratorstate(exc_coro))\n\n## output\n\n-> coroutine started\n--> coroutine received: 11\n--> coroutine received: 12\n--> coroutine received: 13\n*** DemoException handled. Conginuing...\nGEN_SUSPENDED\nGEN_CLOSED\n```\n\nå¦‚æœä¸ç®¡åç¨‹å¦‚ä½•ç»“æŸéƒ½æƒ³åšäº›å¤„ç†å·¥ä½œï¼Œè¦æŠŠåç¨‹å®šä¹‰ä½“é‡çš„ç›¸å…³ä»£ç æ”¾å…¥try/finallyå—ä¸­ã€‚\n\n```python\n@coroutinue\ndef exc_handling():\n    print('-> coroutine started')\n    try:\n        while True:\n            try:\n                x = yield\n            except DemoException:\n                print('*** DemoException handled. Conginuing...')\n            else:\n                # å¦‚æœæ²¡æœ‰å¼‚å¸¸æ˜¾ç¤ºæ¥æ”¶åˆ°çš„å€¼\n                print('--> coroutine received: {!r}'.format(x))\n    finally:\n        print('-> coroutine ending')\n```\n\nä¸Šè¿°éƒ¨åˆ†ä»‹ç»äº†ï¼š\n\n* ç”Ÿæˆå™¨ä½œä¸ºåç¨‹ä½¿ç”¨æ—¶çš„è¡Œä¸ºå’ŒçŠ¶æ€\n* ä½¿ç”¨è£…é¥°å™¨é¢„æ¿€åç¨‹\n* è°ƒç”¨æ–¹å¦‚ä½•ä½¿ç”¨ç”Ÿæˆå™¨å¯¹è±¡çš„ .throw(...)\bå’Œ.close() æ–¹æ³•æ§åˆ¶åç¨‹\n\nä¸‹ä¸€éƒ¨åˆ†å°†ä»‹ç»ï¼š\n\n* åç¨‹ç»ˆæ­¢æ—¶å¦‚ä½•è¿”å›å€¼\n* yieldæ–°å¥æ³•çš„ç”¨é€”å’Œè¯­ä¹‰\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonåç¨‹1ï¼šåç¨‹ 10åˆ†é’Ÿå…¥é—¨",
        "date": "2017-06-12 09:22:49",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-coroutine-1"
    },
    {
      "content": "\n> è¿™æ˜¯CSSè®¾è®¡æŒ‡å—çš„è¯»ä¹¦ç¬”è®°ï¼Œç”¨äºåŠ æ·±å­¦ä¹ æ•ˆæœã€‚\n\næœ€è¿‘æƒ³åšä¸€ä¸ªå°ç¨‹åºï¼Œå‰ç«¯æ˜¯å¿…ä¿®è¯¾ï¼Œé‚£å°±ä»csså¼€å§‹å§ã€‚\n\n## css å·¥ä½œåŸç†\næ¯ä¸ªhtmlå…ƒç´ éƒ½æœ‰ä¸€ç»„æ ·å¼å±æ€§ï¼Œå¯ä»¥é€šè¿‡cssæ¥è®¾å®šã€‚å½“htmlå…ƒç´ çš„åŒä¸€ä¸ªæ ·å¼å±æ€§æœ‰å¤šç§æ ·å¼å€¼çš„æ—¶å€™ï¼Œcsså°±è¦é å±‚å æœºæ™ºæ¥å†³å®šæœ€ç»ˆåº”ç”¨å“ªç§æ ·å¼ã€‚\n\nHUGOMORE42\n\n### cssè§„åˆ™\nè§„åˆ™å®é™…ä¸Šæ˜¯ä¸€æ¡å®Œæ•´çš„cssæŒ‡ä»¤ï¼Œè§„åˆ™å£°æ˜äº†è¦ä¿®æ”¹çš„å…ƒç´ å’Œè¦åº”ç”¨ç»™æ”¹å…ƒç´ çš„æ ·å¼ã€‚\n\n#### ä¸ºæ–‡æ¡£æ·»åŠ æ ·å¼çš„ä¸‰ç§æ–¹æ³•ï¼š\n1. å†™åœ¨å…ƒç´ æ ‡ç­¾é‡Œï¼ˆä¹Ÿå«è¡Œå†…æ ·å¼ï¼Œåªèƒ½å½±å“å®ƒæ‰€åœ¨çš„æ ‡ç­¾ï¼Œä¼šè¦†ç›–åµŒå…¥æ ·å¼å’Œé“¾æ¥æ ·å¼ï¼‰\n2. å†™åœ¨\\<style> æ ‡ç­¾é‡Œï¼ˆä¹Ÿå°±åµŒå…¥æ ·å¼ï¼Œåº”ç”¨èŒƒå›´ä»…é™äºå½“å‰é¡µé¢ï¼Œé¡µé¢æ ·å¼ä¼šè¦†ç›–å¤–éƒ¨æ ·å¼è¡¨ä¸­çš„æ ·å¼ï¼Œä½†ä¼šè¢«è¡Œå†…æ ·å¼è¦†ç›–ï¼‰\n3. å†™åœ¨å•ç‹¬cssæ ·å¼è¡¨ä¸­ï¼ˆä¹Ÿå«é“¾æ¥æ ·å¼ï¼Œæ ·å¼è¡¨æ˜¯ä¸€ä¸ªæ‰©å±•åä¸º.css çš„æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ä»»æ„å¤šä¸ªHTMLé¡µé¢é“¾æ¥åŒä¸€ä¸ªæ ·å¼è¡¨æ–‡ä»¶ã€‚é“¾æ¥æ ·å¼çš„ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªç½‘ç«™ï¼‰\n\n\né™¤äº†è¿™ä¸‰ç§ä¸ºé¡µé¢æ·»åŠ æ ·å¼çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç§åœ¨æ ·å¼è¡¨ä¸­é“¾æ¥å…¶ä»–æ ·å¼è¡¨çš„æ–¹æ³•ï¼Œä½¿ç”¨@import æŒ‡ä»¤ï¼šä¾‹å¦‚\n\n```\n@import url(css/styles.css)\n```\n@import æŒ‡ä»¤å¿…é¡»å‡ºç°åœ¨æ ·å¼è¡¨ä¸­å…¶ä»–æ ·å¼ä¹‹å‰ï¼Œå¦åˆ™@å¹ç­ï¼›@importå¼•ç”¨çš„æ ·å¼è¡¨ä¸ä¼šè¢«åŠ è½½ã€‚\n![css è§„åˆ™å‘½åæƒ¯ä¾‹](http://omuo4kh1k.bkt.clouddn.com/cpByY2yOl7gHv6vEFDL2CyMt8YJQ-0t0MRxo6itjABg0PeYrrqz6wrIV6q5kKsm8)\n\nå¯¹è¿™ä¸ªåŸºæœ¬çš„ç»“æ„æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥è¿›è¡Œæ‰©å±•\n\n**ç¬¬ä¸€ç§æ–¹æ³•ï¼š**å¤šä¸ªå£°æ˜åŒ…å«åœ¨ä¸€æ¡è§„åˆ™é‡Œã€‚\n\n```css\np {color: red; font-size: 12px; font-weight: bold;}\n```\n**ç¬¬äºŒç§æ–¹æ³•ï¼š**å¤šä¸ªé€‰æ‹©å™¨ç»„åˆåœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼šå¦‚æœæƒ³è®©\\<h1>ã€\\<h2>å’Œ\\<h3>çš„æ–‡æœ¬éƒ½å˜æˆè“è‰²ç²—ä½“å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```css\nh1 {color: blue; font-weight: bold;}\nh2 {color: blue; font-weight: bold;}\nh3 {color: blue; font-weight: bold;}\n```\n\nä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```css\nh1, h2, h3 {color: blue; font-weight: bold;}\n```\n\n**åˆ†ç»„é€‰æ‹©ç¬¦ä»¥é€—å·ä½œä¸ºåˆ†éš”ç¬¦**\n\n**ç¬¬ä¸‰ç§æ–¹æ³•ï¼š** å¤šæ¡è§„åˆ™åº”ç”¨ç»™ä¸€ä¸ªé€‰æ‹©ç¬¦ã€‚\nä¾‹å¦‚ï¼Œå†™å®Œä¸Šè¾¹çš„è§„åˆ™ï¼Œè¿˜æƒ³æŠŠh3å˜æˆæ–œä½“ï¼Œé‚£ä¹ˆå¯ä»¥å†ä¸ºh3å•ç‹¬å†™ä¸€æ¡è§„åˆ™ï¼š\n\n```css\nh1, h2, h3 {color: blue; font-weight: bold;}\nh3 {font-style: italic;}\n```\n\n### é€‰æ‹©ç‰¹å®šå…ƒç´ çš„é€‰æ‹©ç¬¦\n\nç”¨äºé€‰æ‹©ç‰¹å®šå…ƒç´ çš„æ“ä½œç¬¦æœ‰ä¸‰ç§\n\n1. **ä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦**ã€‚åŸºäºç¥–å…ˆæˆ–è€…åŒèƒå…ƒç´ é€‰æ‹©ä¸€ä¸ªå…ƒç´ ã€‚\n2. **IDå’Œç±»é€‰æ‹©ç¬¦**ã€‚åŸºäºidå’Œclasså±æ€§çš„å€¼é€‰æ‹©å…ƒç´ ã€‚\n3. **å±æ€§é€‰æ‹©ç¬¦**ã€‚åŸºäºå±æ€§çš„æœ‰æ— å’Œç‰¹å¾é€‰æ‹©å…ƒç´ ã€‚\n\n#### ä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦\n\næ¯”å¦‚æˆ‘ä»¬æƒ³ç»™articleä¸­çš„æ®µè½è®¾ç½®ä¸åŒçš„å­—å·ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦æ¥è§£å†³ã€‚\n\nä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦çš„æ ¼å¼å¦‚ä¸‹ï¼š\n\n> æ ‡ç­¾1 æ ‡ç­¾2 {å£°æ˜}\n\nå…¶ä¸­**æ ‡ç­¾2** æ˜¯æˆ‘ä»¬è¦é€‰æ‹©çš„ç›®æ ‡ï¼Œè€Œä¸”åªæœ‰åœ¨ **æ ‡ç­¾1**æ˜¯å…¶ç¥–å…ˆå…ƒç´ çš„æƒ…å†µä¸‹æ‰ä¼šè¢«é€‰ä¸­ã€‚\n\nä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦ï¼Œå«åä»£ç»„åˆå¼é€‰æ‹©ç¬¦ï¼Œå°±æ˜¯ä¸€ç»„ä»¥ç©ºæ ¼åˆ†éš”çš„æ ‡ç­¾åã€‚ç”¨äºé€‰æ‹©ä½œä¸ºç‰¹å®šç¥–å…ˆå…ƒç´ åä»£çš„æ ‡ç­¾ã€‚\n\n```css\narticle p {font-weight: bold;}\n```\n\nä¸Šè¾¹ä¾‹å­ä¸­ï¼Œåªæœ‰articleåä»£çš„på…ƒç´ æ‰ä¼šåº”ç”¨åè¾¹çš„æ ·å¼ã€‚\n\n**ä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦ä»¥ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦**\n\n##### ç‰¹æ®Šçš„ä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦\n\n* å­é€‰æ‹©ç¬¦ >\n\næ ¼å¼å¦‚ä¸‹ï¼š\n\n> æ ‡ç­¾1 > æ ‡ç­¾2\n\n**æ ‡ç­¾1** å¿…é¡»æ˜¯ **æ ‡ç­¾2** çš„**çˆ¶å…ƒç´ **ï¼Œä¸èƒ½æ˜¯å…¶å®ƒçš„ç¥–å…ˆå…ƒç´ ã€‚\n\n```css\nsection > h2 {font-style: italic;}\n```\n\n* ç´§é‚»åŒèƒé€‰æ‹©ç¬¦+\n\næ ¼å¼å¦‚ä¸‹ï¼š\n\n> æ ‡ç­¾1 + æ ‡ç­¾2\n\næ ‡ç­¾2 å¿…é¡»ç´§è·Ÿåœ¨æœŸåŒèƒæ ‡ç­¾1åé¢ã€‚\n\n```css\nh2 + p {font-variant: small-caps;}\n```\n\næ ‡ç­¾ h2 å’Œ p ä¸ºåŒä¸€çº§æ ‡ç­¾ï¼Œä¸”æ ‡ç­¾på’Œ h2 ç›¸é‚»ã€‚(åªåº”ç”¨åˆ°pæ ‡ç­¾ï¼‰\n\n* ä¸€èˆ¬åŒèƒé€‰æ‹©ç¬¦ ~\n\næ ¼å¼å¦‚ä¸‹ï¼š\n\n> æ ‡ç­¾1 ~ æ ‡ç­¾2\n\n**æ ‡ç­¾2** å¿…é¡»è·Ÿåœ¨å…¶ **åŒèƒæ ‡ç­¾1** åé¢ï¼ˆå¯ä»¥ä¸ç›¸é‚»ï¼‰ã€‚\n\n```css\nh2 ~ a {color: red;}\n```\n\næ ‡ç­¾a å’Œ æ ‡ç­¾h2 åŒä¸€çº§ï¼Œä¸”aæ ‡ç­¾åœ¨h2 æ ‡ç­¾ä¹‹åã€‚ï¼ˆåªåº”ç”¨ä¸aæ ‡ç­¾ï¼‰\n\n* é€šç”¨é€‰æ‹©ç¬¦ *\n\né€šç”¨é€‰æ‹©ç¬¦ * æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œå®ƒåŒ¹é…ä»»ä½•å…ƒç´ ã€‚\n\n```css\n* {color: green;}\n```\n\nè¿™æ¡è§„åˆ™ä¼šå°†æ‰€æœ‰å…ƒç´ ï¼ˆæ–‡æœ¬å’Œè¾¹æ¡†ï¼‰éƒ½å˜æˆç»¿è‰²ã€‚\n\n```css\np * {color: red;}\n```\nè¿™æ¡è§„åˆ™ä¼šæŠŠpåŒ…å«çš„æ‰€æœ‰å…ƒç´ çš„æ–‡æœ¬éƒ½å˜æˆçº¢è‰²ã€‚\n\n```css\nsection * a {font-size: 1.3em;}\n```\n\næ‰€æœ‰sectionæ ‡ç­¾çš„ éå­æ ‡ç­¾ï¼ˆ*æ˜¯æ‰€æœ‰çš„å­æ ‡ç­¾ï¼‰çš„aæ ‡ç­¾å­—ä½“è®¾ç½®ä¸º 1.3 em;\n\n#### IDå’Œç±»é€‰æ‹©ç¬¦\n\nä½¿ç”¨IDå’Œç±»é€‰æ‹©ç¬¦ï¼Œé¦–å…ˆè¦åœ¨HTMLæ ‡è®°ä¸­ä¸ºå…ƒç´ æ·»åŠ idå’Œclasså±æ€§ã€‚\n\n> å¯ä»¥ç»™idå’Œclasså±æ€§è®¾å®šä»»æ„å€¼ï¼Œä½†ä¸èƒ½ä»¥æ•°å­—æˆ–ç‰¹æ®Šç¬¦å·å¼€å¤´\n\n##### ç±»å±æ€§\n\nç»™æ ‡ç­¾h1æ·»åŠ  specialtext ç±»ã€‚\n\n```css\n<h1 class=\"specialtext\">This is text</h1>\n```\n\n* ç±»é€‰æ‹©ç¬¦\n\næ ¼å¼ä¸ºï¼š\n\n> .ç±»å\n\nç±»é€‰æ‹©ç¬¦ä½¿ç”¨ç‚¹(.)ï¼Œç´§è·Ÿç±»åã€‚\n\n* æ ‡ç­¾å¸¦ç±»é€‰æ‹©ç¬¦\n\næ ¼å¼ä¸ºï¼š\n> æ ‡ç­¾1.ç±»å\n\næ¯”å¦‚ï¼š\n\n```css\np.specialtext {color: red;}\n```\nåªå¯¹æœ‰ specialtext ç±»çš„pæ ‡ç­¾æœ‰æ•ˆã€‚\n\n* å¤šç±»é€‰æ‹©ç¬¦\n\nå¯ä»¥ç»™å…ƒç´ æ·»åŠ å¤šä¸ªç±»ï¼š\n\n```html\n<p class=\"specialtext featured\">Here the span tag <span> may or may not</span> be styled.</p>\n```\nå¤šä¸ªç±»åæ”¾åœ¨åŒä¸€å¯¹å¼•å·åƒï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚\n\nè¦é€‰æ‹©åŒæ—¶å­˜åœ¨è¿™ä¸¤ä¸ªç±»åçš„å…ƒç´ å¯ä»¥è¿™æ ·å†™ï¼š\n\n```css\n.specialtext.featured {font-size: 120%;}\n```\nCSS é€‰æ‹©ç¬¦çš„ä¸¤ä¸ªç±»åç›´æ¥æ²¡æœ‰ç©ºæ ¼ã€‚å¦‚æœåŠ äº†ï¼Œå°±å˜æˆç¥–å…ˆ/åä»£å…³ç³»çš„ä¸Šä¸‹æ–‡é€‰æ‹©ç¬¦äº†ã€‚\n\n##### IDå±æ€§\n\nIDå±æ€§ä¸ç±»å†™æ³•ç±»ä¼¼ï¼Œç”¨#è¡¨ç¤ºã€‚\n\n```html\n<p id=\"specialtext\">This is text</p>\n```\nä¸Šè¾¹pæ ‡ç­¾å°±è®¾ç½®äº†IDå±æ€§specialtextã€‚\n\nç›¸åº”çš„IDé€‰æ‹©ç¬¦å°±è¿™æ ·å†™ï¼š\n\n```css\n#specialtext {cssæ ·å¼}\n```\n\né€‰æ‹©å…ƒç´ æ–¹å¼å…¶ä½™å’Œclass ä¸€è‡´ã€‚\n\n#### IDå±æ€§å’Œç±»å±æ€§çš„åŒºåˆ«\n\n* IDå¯ä»¥ç”¨äºé¡µé¢å¯¼èˆªé“¾æ¥ä¸­ã€‚\nä¾‹å¦‚ï¼š\n\n```html\n<a href=\"#bio\">Biggraphy</a>\n``` \nç”¨æˆ·ç‚¹å‡»è¿™ä¸ªé“¾æ¥ä¼šæ»šåˆ°IDå€¼ä¸ºbioçš„ä½ç½®ã€‚å¦‚æœhrefå±æ€§é‡Œåªæœ‰ä¸€ä¸ª#ï¼Œé‚£ä¹ˆç‚¹å‡»é“¾æ¥ä¼šè·³åˆ°é¡¶éƒ¨ã€‚\n\n* IDå€¼éœ€è¦æ—¶ç‹¬ä¸€æ— äºŒçš„ã€‚\n* ç±»çš„ç›®çš„æ˜¯ä¸ºäº†æ ‡è¯†ä¸€ç»„å…·æœ‰ç›¸åŒç‰¹å¾çš„å…ƒç´ ï¼Œä»¥ä¾¿æˆ‘ä»¬ä¸ºè¿™äº›å…ƒç´ åº”ç”¨ç›¸åŒçš„cssæ ·å¼ã€‚\n\n#### å±æ€§é€‰æ‹©ç¬¦\n\n##### å±æ€§åé€‰æ‹©ç¬¦\n\næ ¼å¼å¦‚ä¸‹ï¼š\n\n> æ ‡ç­¾å[å±æ€§å]\n\né€‰æ‹©ä»»ä½•å¸¦æœ‰å±æ€§åçš„æ ‡ç­¾åã€‚\n\næ¯”å¦‚ï¼š\n\n```css\nimg[title] {border: 2px solid blue;}\n```\n\nè¿™ä¸ªè§„åˆ™ä¼šé€‰æ‹©å¸¦æœ‰titleå±æ€§çš„HTML imgå…ƒç´ ï¼Œtitleæ˜¯ä»€ä¹ˆå€¼éƒ½å¯ä»¥ã€‚\n\n##### å±æ€§å€¼é€‰æ‹©ç¬¦\n\næ ¼å¼å¦‚ä¸‹ï¼š\n\n> æ ‡ç­¾å[å±æ€§å=\"å±æ€§å€¼\"]ï¼ˆåœ¨html5ä¸­ï¼Œå±æ€§å€¼å¾—å¼•å·å¯ä¸åŠ )\n\nä¾‹å¦‚ï¼š\n\n```css\nimg[title=\"red flower\"] {border: 2px solid blue;}\n```\nè¿™ä¸ªè§„åˆ™ä¼šé€‰æ‹©å¸¦æœ‰titleå±æ€§çš„HTML imgå…ƒç´ ï¼Œä¸”titleå€¼ä¸º\"red flower\"ã€‚\n\n#### ä¼ªç±»\n\nä¼ªç±»åˆ†ä¸¤ç§ï¼š\n1. UIä¼ªç±»ä¼šåœ¨HTMLå…ƒç´ å¤„äºæŸä¸ªçŠ¶æ€æ—¶ï¼Œä¸ºè¯¥å…ƒç´ åº”ç”¨CSSæ ·å¼ã€‚\n2. ç»“æ„åŒ–ä¼ªç±»ä¼šåœ¨æ ‡è®°ä¸­å­˜åœ¨æŸç§ç»“æ„ä¸Šçš„å…³ç³»æ—¶ï¼Œä¸ºç›¸åº”å…ƒç´ åº”ç”¨CSSæ ·å¼ã€‚\n\nä¼ªç±»ä½¿ç”¨:(å†’å·)ä½œä¸ºé€‰æ‹©ç¬¦ã€‚\nä¸¤ä¸ªå†’å·(::)è¡¨ç¤ºæ–°å¢çš„ä¼ªå…ƒç´ ã€‚\n\n#### UIä¼ªç±»\n\nUIä¼ªç±»ä¼šåŸºäºç‰¹å®šçš„HTMLå…ƒç´ çš„çŠ¶æ€åº”ç”¨æ ·å¼ã€‚\n\n##### é“¾æ¥ä¼ªç±»\n\né’ˆå¯¹é“¾æ¥çš„ä¼ªç±»æœ‰4ä¸ªï¼š\n\n* Linkã€‚ æ­¤æ—¶ï¼Œé“¾æ¥ä¸ºè¢«ç‚¹å‡»\n* Visitedã€‚ç”¨æˆ·ç‚¹å‡»è¿‡é“¾æ¥ä¹‹å\n* Hoverã€‚é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Š\n* Activeã€‚é“¾æ¥æ­£åœ¨è¢«ç‚¹å‡»\n\nä½¿ç”¨æ–¹å¼ä¸¾ä¾‹ï¼š\n\n```css\na:link {color: black;}\na:visited {color: blue;}\na:hover {text-decoration: none;}\na:active {color: red;}\n```\n\nhoverä¼ªç±»å¯ä»¥åº”ç”¨åœ¨ä»»ä½•å…ƒç´ ã€‚\n\n```css\np:hover {background-color: gray;}\n```\n##### :focus ä¼ªç±»\n\nå¯ä»¥åº”ç”¨äºä»»ä½•å…ƒç´ ã€‚\n\nç‚¹å‡»æ—¶ä¼šæˆ–å¾—ç„¦ç‚¹ã€‚\n\n##### :target ä¼ªç±»\n\nå¯ä»¥åº”ç”¨äºä»»ä½•å…ƒç´ ã€‚\nå¦‚æœç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæŒ‡å‘é¡µé¢ä¸­å…¶ä»–å…ƒç´ çš„é“¾æ¥ï¼Œåˆ™é‚£ä¸ªå…ƒç´ å°±æ˜¯ç›®æ ‡ï¼Œå¯ä»¥ç”¨:target é€‰ä¸­ã€‚\n\næ¯”å¦‚ï¼š\n\n```html\n<a href=\"#more_info\">More Infomation</a>\n```\nåº”ç”¨ä¸Šä¼ªç±»åï¼ŒIDä¸ºmore_infoçš„å…ƒç´ å°±æ˜¯ç›®æ ‡ã€‚ç‚¹å‡»aæ ‡ç­¾æ—¶ï¼Œä¼šåº”ç”¨cssæ ·å¼ã€‚\n\ncssè§„åˆ™å¦‚ä¸‹ï¼š\n\n```css\n#more_info:target {background: #eee;}\n```\n\n#### ç»“æ„åŒ–ä¼ªç±»\n\n##### :first-childå’Œ:last-child\n\n* :first-child ä»£è¡¨ä¸€ç»„åŒèƒå…ƒç´ çš„ç¬¬ä¸€ä¸ªå…ƒç´ \n* :last-child ä»£è¡¨ä¸€ç»„åŒèƒå…ƒç´ çš„æœ€åä¸€ä¸ªå…ƒç´ \n\n##### :nth-child\n\nè§„åˆ™å¦‚ä¸‹ï¼š\n\n```css\ne:nth-child(n)\n```\n\neè¡¨ç¤ºå…ƒç´ åï¼Œnè¡¨ç¤ºä¸€ä¸ªæ•°å€¼ã€‚\n\næ¯”å¦‚ï¼š\n\n```css\nli:nth-child(3)\n```\nä¼šé€‰ä¸­ä¸€ç»„åˆ—è¡¨çš„æ¯ä¸ªç¬¬ä¸‰é¡¹ã€‚\n\n#### ä¼ªå…ƒç´ \n\nä¼ªå…ƒç´ æ˜¯æ–‡æ¡£ä¸­è‹¥æœ‰å®æ— çš„å…ƒç´ ã€‚\nå¸¸ç”¨çš„ä¼ªç±»å¦‚ä¸‹ï¼š\n\n##### ::first-letter\n\né€‰æ‹©é¦–å­—æ¯ï¼Œä½¿ç”¨è§„åˆ™ï¼š\n\n```css\ne::first-letter\n```\n\næ¯”å¦‚\n```css\np::first-letter {font-size:300%;}\n```\nä¼šè®©é¦–å­—æ¯å˜å¤§ã€‚\n\n##### ::first-line \n\né€‰æ‹©æ®µè½çš„ç¬¬ä¸€è¡Œã€‚\n\n```css\ne::first-line\n```\n##### ::beforeå’Œ::after\n\nä½¿ç”¨è§„åˆ™å¦‚ä¸‹ï¼š\n\n```css\ne::before\ne::after\n```\nå¯ç”¨äºåœ¨ç‰¹å®šçš„å…ƒç´ å‰é¢æˆ–è€…åé¢æ·»åŠ ç‰¹æ®Šå†…å®¹ã€‚\n\nä»¥ä¸ŠCSSé€‰æ‹©ç¬¦å·²ç»ä»‹ç»å®Œäº†ï¼Œæ¥ä¸‹æ¥è®¨è®ºåœ¨ä¸€ä¸ªå¤§çš„æ ·å¼è¡¨ä¸­ï¼Œè§„åˆ™é€‰æ‹©çš„é—®é¢˜ã€‚\n\nCSSæä¾›äº†ä¸‰ç§æœºåˆ¶æ¥å†³å®šé‚£æ¡è§„åˆ™ä¼šèƒœå‡ºï¼š\n\n* ç»§æ‰¿\n* å±‚å \n* ç‰¹æŒ‡\n\n### ç»§æ‰¿\n\nCSSå±æ€§çš„å€¼ä¼šå‘ä¸‹ä¼ é€’ã€‚\næ¯”å¦‚æˆ‘ä»¬æ·»åŠ ä¸€æ¡è¿™æ ·çš„è§„åˆ™ï¼š\n\n```css\nbody: {font-family: arial;}\n```\n\né‚£ä¹ˆæ–‡æ¡£çš„æ‰€æœ‰å…ƒç´ éƒ½å°†ç»§æ‰¿è¿™ä¸ªæ ·å¼ã€‚\n\n### å±‚å \n\nå±‚å ï¼Œæ˜¯æ ·å¼åœ¨æ–‡æ¡£å±‚æ¬¡ä¸­é€å±‚å åŠ çš„è¿‡ç¨‹ï¼Œç›®çš„æ˜¯è®©æµè§ˆå™¨é¢å¯¹æŸä¸ªæ ‡ç­¾ç‰¹å®šå±æ€§å€¼å¾—å¤šä¸ªæ¥æºï¼Œç¡®å®šæœ€ç»ˆä½¿ç”¨å“ªä¸ªå€¼ã€‚\n\n#### æ ·å¼æ¥æº\n\nä»¥ä¸‹æ˜¯æµè§ˆå™¨å±‚å å„ä¸ªæ¥æºæ ·å¼çš„é¡ºåºï¼š\n\n1. æµè§ˆå™¨é»˜è®¤çš„æ ·å¼è¡¨\n2. ç”¨æˆ·çš„æ ·å¼è¡¨\n3. ä½œè€…é“¾æ¥æ ·å¼è¡¨ï¼ˆæŒ‰ç…§å®ƒä»¬é“¾æ¥åˆ°é¡µé¢çš„å…ˆåé¡ºåºï¼‰\n4. ä½œè€…åµŒå…¥æ ·å¼\n5. ä½œè€…è¡Œå†…æ ·å¼\n\næµè§ˆå™¨ä¼šæŒ‰ä¸Šè¿°é¡ºåºä¾æ¬¡æ£€æŸ¥æ¯ä¸ªæ¥æºçš„æ ·å¼ï¼Œå¹¶åœ¨æœ‰å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œæ›´æ–°å¯¹æ¯ä¸ªæ ‡ç­¾å±æ€§å€¼å¾—è®¾å®šã€‚æ•´ä¸ªæ£€æŸ¥æ›´æ–°è¿‡ç¨‹ç»“æŸåï¼Œå†å°†æ¯ä¸ªæ ‡ç­¾å·²æœ€ç»ˆè®¾å®šçš„æ ·å¼æ˜¾ç¤ºå‡ºæ¥ã€‚\n\næ¯”å¦‚ï¼Œå¦‚æœä½œè€…é“¾æ¥æ ·å¼è¡¨å°†pçš„å­—ä½“è®¾å®šä¸ºHelveticaï¼Œè€Œé¡µé¢ä¸­æœ‰ä¸€æ¡åµŒå…¥è§„åˆ™ä»¥ç›¸åŒçš„é€‰æ‹©ç¬¦å§å­—ä½“è®¾å®šä¸ºVerdanaï¼Œé‚£ä¹ˆæ®µè½æ–‡æœ¬æœ€ç»ˆä¼šä»¥Verdanaå­—ä½“æ˜¾ç¤ºã€‚**å› ä¸ºæµè§ˆå™¨æ˜¯åœ¨è¯»å–é“¾æ¥æ ·å¼è¡¨ä¹‹åè¯»å–åµŒå…¥æ ·å¼ã€‚**\n\n#### å±‚å è§„åˆ™\n\n**å±‚å è§„åˆ™ä¸€ï¼š**æ‰¾åˆ°åº”ç”¨ç»™æ¯ä¸ªå…ƒç´ å’Œå±æ€§çš„æ‰€æœ‰å£°æ˜ã€‚\n\n**å±‚å è§„åˆ™äºŒï¼š**æŒ‰ç…§é¡ºåºå’Œæƒé‡æ’åºã€‚æµè§ˆå™¨ä¸€æ¬¡æ£€æŸ¥5ä¸ªæ¥æºï¼Œå¹¶è®¾å®šåŒ¹é…çš„å±æ€§ï¼Œå¦‚æœåŒ¹é…çš„å±æ€§åœ¨ä¸‹ä¸€ä¸ªæ¥æºæœ‰å®šä¹‰ï¼Œåˆ™æ›´æ–°æ”¹å±æ€§å€¼ã€‚\n\nå£°æ˜ä¹Ÿå¯ä»¥åŠ æƒé‡ã€‚æ¯”å¦‚ï¼š\n\n```css\np {color: green !important; font-size: 12pt;}\n```\nç©ºæ ¼!importantåˆ†å·(;) ç”¨äºåŠ é‡å£°æ˜çš„æƒé‡ã€‚\n\nè¿™æ¡è§„åˆ™åŠ é‡äº†å°†æ–‡æœ¬è®¾ç½®ä¸ºç»¿è‰²çš„æƒé‡ã€‚æ‰€ä»¥å°±ç®—å±‚å çš„ä¸‹ä¸€æ¥æºç»™æ®µè½è®¾å®šäº†å…¶ä»–é¢œè‰²ï¼Œæœ€ç»ˆçš„é¢œè‰²ä»ç„¶è¿˜æ˜¯ç»¿è‰²ã€‚\n\n**å±‚å è§„åˆ™ä¸‰ï¼š**æŒ‰ç‰¹æŒ‡åº¦æ’åºã€‚ç‰¹æŒ‡åº¦æ˜¯è¡¨ç¤ºä¸€æ¡è§„åˆ™æœ‰å¤šæ˜ç¡®ã€‚\n\næ¯”å¦‚æŸä¸ªæ ·å¼è¡¨ä¸­åŒ…å«å¦‚ä¸‹è§„åˆ™ï¼š\n\n```css\np {font-size: 12px;}\np.largetext {font-size: 16px;}\n\n<p class=\"largetext\">A bit of text</p>\n```\n\né‚£ä¹ˆä¸Šè¾¹çš„pæ ‡ç­¾å°†æ˜¾ç¤º16px æ–‡æœ¬ï¼Œå› ä¸ºç¬¬äºŒæ¡è§„åˆ™çš„é€‰æ‹©ç¬¦æ—¢åŒ…å«æ ‡ç­¾åï¼ŒåˆåŒ…å«ç±»åï¼ˆç‰¹æŒ‡åº¦é«˜ï¼‰ã€‚\n\nå¦‚æœæ˜¯ä¸‹è¾¹çš„æ ·å¼ï¼š\n\n```css\np {font-size: 12px;}\n.largetext {font-size: 16px;}\n\n<p class=\"largetext\">A bit of text</p>\n```\nè¿˜æ˜¯ä¼šæ˜¾ç¤º16pxåƒç´ ï¼Œå› ä¸ºç±»çš„ç‰¹æŒ‡åº¦é«˜ã€‚\n\n**å±‚å è§„åˆ™å››** é¡ºåºå†³å®šæƒé‡ã€‚å¦‚æœä¸¤æ¡è§„åˆ™éƒ½å½±å“æŸä¸€å…ƒç´ çš„å±æ€§ï¼Œç‰¹æŒ‡åº¦ä¹Ÿç›¸åŒï¼Œåå‡ºç°çš„èƒœå‡ºã€‚\n\n##### è®¡ç®—ç‰¹æŒ‡åº¦\n\nè®¡ç®—ç‰¹æŒ‡åº¦æœ‰ä¸€ä¸ªè®°åˆ†è§„åˆ™ï¼Œè¢«ç§°ä¸ºâ€œICEâ€å…¬å¼ï¼š\n\n**I-C-E**\n\nI(ID)C(Class)E(Element)å¹¶éçœŸæ­£çš„ä¸‰ä¸ªæ•°ï¼Œä½†æ˜¯ 0-1-12æ¯”0-2-0 å°ã€‚\n\nICEè®°åˆ†è§„åˆ™å¦‚ä¸‹ï¼š\n\n1. é€‰æ‹©ç¬¦ä¸­æœ‰ä¸€ä¸ªIDï¼Œåœ¨Içš„ä½ç½®ä¸ŠåŠ 1ï¼›\n2. é€‰æ‹©ç¬¦ä¸­æœ‰ä¸€ä¸ªç±»ï¼Œåœ¨Cçš„ä½ç½®ä¸ŠåŠ 1ï¼›\n3. é€‰æ‹©ç¬¦ä¸­æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨Eçš„ä½ç½®ä¸ŠåŠ 1ï¼›\n4. å¾—åˆ°ä¸€ä¸ªä¸‰ä½æ•°ã€‚\n\nå¥½äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n\n\né€‰æ‹©ç¬¦                   | ç‰¹æŒ‡åº¦\n----------------------- | -------\np                       | 0-0-1\np.largetext             |0-1-1\np#largetext             |1-0-1\nbody p#largetext        |1-0-2\nbody p#largetext ul.mylist| 1-1-3\nbody p#largetext ul.mylist li | 1-1-4\n\n\n##### ç®€åŒ–ç‰ˆå±‚å è§„åˆ™\n\n1. åŒ…å«IDçš„é€‰æ‹©ç¬¦èƒœè¿‡åŒ…å«ç±»çš„é€‰æ‹©ç¬¦ï¼ŒåŒ…å«ç±»çš„èƒœè¿‡åŒ…å«æ ‡ç­¾çš„é€‰æ‹©ç¬¦ã€‚\n2. å¦‚æœå‡ ä¸ªä¸åŒæ¥æºéƒ½ä¸ºåŒä¸€ä¸ªæ ‡ç­¾çš„åŒä¸€ä¸ªå±æ€§å®šä¹‰äº†æ ·å¼ï¼Œè¡Œå†…æ ·å¼èƒœè¿‡åµŒå…¥æ ·å¼ï¼ŒåµŒå…¥æ ·å¼èƒœè¿‡é“¾æ¥æ ·å¼ã€‚åœ¨é“¾æ¥æ ·å¼è¡¨ä¸­ï¼Œå…·æœ‰ç›¸åŒç‰¹æŒ‡åº¦çš„æ ·å¼ï¼Œåå£°æ˜çš„ä¼˜å…ˆã€‚\n3. è§„åˆ™ä¸€èƒœè¿‡è§„åˆ™äºŒã€‚\n4. è®¾å®šçš„æ ·å¼èƒœè¿‡ç»§æ‰¿çš„æ ·å¼ã€‚\n\n\nè¿™ä¸€ç¯‡æˆ‘ä»¬ä¸»è¦ä»‹ç»äº†CSSè§„åˆ™ï¼Œä»¥åŠå¦‚ä½•ç”¨å®ƒæ¥ä¸ºHTMLåº”ç”¨æ ·å¼ã€‚\n\n-------\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "CSSå…¥é—¨æŒ‡å—-1ï¼šå·¥ä½œåŸç†",
        "date": "2017-05-27 09:22:49",
        "tags": [
          "css",
          "è¯»ä¹¦ç¬”è®°",
          "å‰ç«¯",
          "html",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "css-learing-1-how-it-workds"
    },
    {
      "content": "\nå®‰è£…ä½¿ç”¨ Elasticsearch ä¸¤ç§æ–¹æ³•ï¼š\n\n### æ–¹æ³•1 æ‰‹åŠ¨å®‰è£… Elasticsearch\n\n##### å®‰è£…åˆ°ubuntu\n\nElasticsearchä¸Logstashéœ€è¦Javaä½œä¸ºè¿è¡Œç¯å¢ƒ\n\n## å®‰è£…Java 8\n\nå°†ç”²éª¨æ–‡Java PPAæ·»åŠ è‡³aptï¼š\n\n```shell\nsudo add-apt-repository -y ppa:webupd8team/java\n```\n\næ›´æ–°aptè½¯ä»¶åŒ…æ•°æ®åº“ï¼š\n\n```shell\nsudo apt-get update\n```\n\nHUGOMORE42\n\nå®‰è£…ç”²éª¨æ–‡Java 8çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼ˆåœ¨å¼¹å‡ºçš„è®¸å¯åè®®ä¸­ç‚¹å‡»æ¥å—ï¼‰ï¼š\n\n```shell\nsudo apt-get -y install oracle-java8-installer\n```\n\n## å®‰è£…Elasticsearch\n\n### æ–¹æ³•1 é€šè¿‡æ·»åŠ Elasticçš„è½¯ä»¶åŒ…æºåˆ—è¡¨åˆ©ç”¨è½¯ä»¶åŒ…ç®¡ç†å™¨å®‰è£…Elasticsearchã€‚\n\nè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å°†Elasticsearchå…¬å…±GPGå¯†é’¥å¯¼å…¥aptï¼š\n\n```shell\nwget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -\n```\næ¥ä¸‹æ¥ï¼Œåˆ›å»ºElasticsearchæºåˆ—è¡¨ï¼š\n\n```shell\necho \"deb http://packages.elastic.co/elasticsearch/${ELASTICSEARCH_VERSION}/debian stable main\" | sudo tee -a /etc/apt/sources.list.d/elk.list\n```\n\næ›´æ–°aptè½¯ä»¶åŒ…æ•°æ®åº“ï¼š\n\n```shell\nsudo apt-get update\n```\nå®‰è£…Elasticsearch\n\n```shell\nsudo apt-get -y install elasticsearch\n```\n\nElasticsearchå·²ç»å®‰è£…å®Œæˆã€‚ä¸‹é¢ç¼–è¾‘å…¶é…ç½®æ–‡ä»¶ï¼š\n\n```shell\nsudo vi /etc/elasticsearch/elasticsearch.yml\n```\n\né™åˆ¶æ¥è‡ªå¤–éƒ¨çš„Elasticsearchå®ä¾‹è®¿é—®æ´»åŠ¨ï¼ˆç«¯å£9200ï¼‰ï¼Œæ‰¾åˆ°æŒ‡å®šnetwork.hostçš„ä¸€è¡Œï¼Œå–æ¶ˆå…¶æ³¨é‡Šå¹¶å°†å…¶å€¼æ›¿æ¢ä¸ºâ€œlocalhostâ€ï¼š\n\n```shell\nelasticsearch.yml excerpt (updated)\n\nnetwork.host: localhost\n```\nå¯åŠ¨elasticsearch\n\n```shell\nsudo service elasticsearch restart\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ è„šæœ¬ å®‰è£…\n\n```shell\n#!/bin/bash\n\n### USAGE\n###\n### ./ElasticSearch.sh 1.7 will install Elasticsearch 1.7\n### ./ElasticSearch.sh will fail because no version was specified (exit code 1)\n###\n### CLI options Contributed by @janpieper\n### Check http://www.elasticsearch.org/download/ for latest version of ElasticSearch\n\n### ElasticSearch version\nif [ -z \"$1\" ]; then\n  echo \"\"\n  echo \"  Please specify the Elasticsearch version you want to install!\"\n  echo \"\"\n  echo \"    $ $0 1.7\"\n  echo \"\"\n  exit 1\nfi\n\nELASTICSEARCH_VERSION=$1\n\nif [[ ! \"${ELASTICSEARCH_VERSION}\" =~ ^[0-9]+\\.[0-9]+ ]]; then\n  echo \"\"\n  echo \"  The specified Elasticsearch version isn't valid!\"\n  echo \"\"\n  echo \"    $ $0 1.7\"\n  echo \"\"\n  exit 2\nfi\n\n### Install Java 8\ncd ~\nsudo apt-get install python-software-properties -y\nsleep 1\nsudo add-apt-repository ppa:webupd8team/java -y\nsleep 1\nsudo apt-get update\nsleep 1\nsudo apt-get install oracle-java8-installer -y\n\n### Download and install the Public Signing Key\nwget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -\n\n### Setup Repository\necho \"deb http://packages.elastic.co/elasticsearch/${ELASTICSEARCH_VERSION}/debian stable main\" | sudo tee -a /etc/apt/sources.list.d/elk.list\n\n### Install Elasticsearch\nsudo apt-get update && sudo apt-get install elasticsearch -y\n\n### Start ElasticSearch\nsudo service elasticsearch start\n\n### Lets wait a little while ElasticSearch starts\nsleep 5\n\n### Make sure service is running\ncurl http://localhost:9200\n\n### Should return something like this:\n# {\n#  \"status\" : 200,\n#  \"name\" : \"Storm\",\n#  \"version\" : {\n#    \"number\" : \"1.3.1\",\n#    \"build_hash\" : \"2de6dc5268c32fb49b205233c138d93aaf772015\",\n#    \"build_timestamp\" : \"2014-07-28T14:45:15Z\",\n#    \"build_snapshot\" : false,\n#    \"lucene_version\" : \"4.9\"\n#  },\n#  \"tagline\" : \"You Know, for Search\"\n# }\n\n```\n\n##### å®‰è£…åˆ° Mac\n\n1. åˆ° https://www.elastic.co/downloads/elasticsearch ä¸‹è½½elasticsearch\n2. è§£å‹ cd åˆ°ç›®å½• æ‰§è¡Œ\n\n```shell\nsudo bin/elasticsearch\n```\n\n### æ–¹æ³•2 ä½¿ç”¨ docker\n\n1. ä¸‹è½½ elasticsearch é•œåƒ\n\n```shell\ndocker pull elasticsearch\n```\n2. æ–°å»º docker-compose.yml æ–‡ä»¶\n\n```yml\nes:\n   image: elasticsearch\n   volumes:\n     - /data:/usr/share/elasticsearch/data/\n   ports:\n     - \"9200:9200\"\n   mem_limit: 2g\n   environment:\n    ES_JAVA_OPTS: \"-Xmx1g -Xms1g\"\n```\n\nè¿è¡Œå‘½ä»¤\n\n```shell\ndocker-compose -f es-docker-compose.yml up -d\n```\n\nå¯åŠ¨ elasticsearch\n\n### æµ‹è¯•å®‰è£…\n\næµè§ˆå™¨ä¸­è®¿é—®http://localhost:9200/ï¼Œçœ‹åˆ°ä¸€ä¸ªjsonç»“æœé›†ï¼Œè¡¨æ˜å®‰è£…æˆåŠŸï¼š\n\n```json\n{\n  \"name\" : \"g1WVNJ8\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"cluster_uuid\" : \"RjwyeM4kRRajDZzE3Tcq8g\",\n  \"version\" : {\n    \"number\" : \"5.4.0\",\n    \"build_hash\" : \"780f8c4\",\n    \"build_date\" : \"2017-04-28T17:43:27.229Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"6.5.0\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n\n```\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Elasticsearch å®‰è£…å’Œä½¿ç”¨",
        "date": "2017-05-18 06:22:49",
        "tags": [
          "å·¥å…·",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "elasticsearch-install"
    },
    {
      "content": "\n> ä¸Šä¸€èŠ‚ä»‹ç»äº†DynamoDB çš„æŸ¥è¯¢ï¼Œæœ¬æ¥è®¡åˆ’è¿™ä¸€èŠ‚ä»‹ç»ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ï¼Œä¸è¿‡éšæœºçœ‹åˆ°äº†æ›´æ–°æ“ä½œï¼Œå°±å…ˆå†™æ›´æ–°æ“ä½œå§\n\n## update (ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®)\n\nSQL è¯­è¨€æä¾›ç”¨äºä¿®æ”¹æ•°æ®çš„ UPDATE è¯­å¥ã€‚DynamoDB ä½¿ç”¨ UpdateItem æ“ä½œå®Œæˆç±»ä¼¼çš„ä»»åŠ¡ã€‚\n\n### SQL\n\nåœ¨ SQL ä¸­ï¼Œå¯ä½¿ç”¨ UPDATE è¯­å¥ä¿®æ”¹ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œã€‚SET å­å¥ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåˆ—æŒ‡å®šæ–°å€¼ï¼ŒWHERE å­å¥ç¡®å®šä¿®æ”¹çš„è¡Œã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```sql\nUPDATE Music\nSET RecordLabel = 'Global Records'\nWHERE Artist = 'No One You Know' AND SongTitle = 'Call Me Today';\n```\n\nHUGOMORE42\n\nå¦‚æœä»»ä½•è¡Œå‡ä¸åŒ¹é… WHERE å­å¥ï¼Œåˆ™ UPDATE è¯­å¥ä¸èµ·ä½œç”¨ã€‚\n\n### DynamoDB\n\nåœ¨ DynamoDB ä¸­ï¼Œå¯ä½¿ç”¨ UpdateItem æ“ä½œä¿®æ”¹å•ä¸ªé¡¹ç›®ã€‚\n\nAPI è¯­æ³•å¦‚ä¸‹ï¼š\n\n```json\n{\n   \"AttributeUpdates\": {\n      \"string\" : {\n         \"Action\": \"string\",\n         \"Value\": {\n            \"B\": blob,\n            \"BOOL\": boolean,\n            \"BS\": [ blob ],\n            \"L\": [\n               \"AttributeValue\"\n            ],\n            \"M\": {\n               \"string\" : \"AttributeValue\"\n            },\n            \"N\": \"string\",\n            \"NS\": [ \"string\" ],\n            \"NULL\": boolean,\n            \"S\": \"string\",\n            \"SS\": [ \"string\" ]\n         }\n      }\n   },\n   \"ConditionalOperator\": \"string\",\n   \"ConditionExpression\": \"string\",\n   \"Expected\": {\n      \"string\" : {\n         \"AttributeValueList\": [\n            {\n               \"B\": blob,\n               \"BOOL\": boolean,\n               \"BS\": [ blob ],\n               \"L\": [\n                  \"AttributeValue\"\n               ],\n               \"M\": {\n                  \"string\" : \"AttributeValue\"\n               },\n               \"N\": \"string\",\n               \"NS\": [ \"string\" ],\n               \"NULL\": boolean,\n               \"S\": \"string\",\n               \"SS\": [ \"string\" ]\n            }\n         ],\n         \"ComparisonOperator\": \"string\",\n         \"Exists\": boolean,\n         \"Value\": {\n            \"B\": blob,\n            \"BOOL\": boolean,\n            \"BS\": [ blob ],\n            \"L\": [\n               \"AttributeValue\"\n            ],\n            \"M\": {\n               \"string\" : \"AttributeValue\"\n            },\n            \"N\": \"string\",\n            \"NS\": [ \"string\" ],\n            \"NULL\": boolean,\n            \"S\": \"string\",\n            \"SS\": [ \"string\" ]\n         }\n      }\n   },\n   \"ExpressionAttributeNames\": {\n      \"string\" : \"string\"\n   },\n   \"ExpressionAttributeValues\": {\n      \"string\" : {\n         \"B\": blob,\n         \"BOOL\": boolean,\n         \"BS\": [ blob ],\n         \"L\": [\n            \"AttributeValue\"\n         ],\n         \"M\": {\n            \"string\" : \"AttributeValue\"\n         },\n         \"N\": \"string\",\n         \"NS\": [ \"string\" ],\n         \"NULL\": boolean,\n         \"S\": \"string\",\n         \"SS\": [ \"string\" ]\n      }\n   },\n   \"Key\": {\n      \"string\" : {\n         \"B\": blob,\n         \"BOOL\": boolean,\n         \"BS\": [ blob ],\n         \"L\": [\n            \"AttributeValue\"\n         ],\n         \"M\": {\n            \"string\" : \"AttributeValue\"\n         },\n         \"N\": \"string\",\n         \"NS\": [ \"string\" ],\n         \"NULL\": boolean,\n         \"S\": \"string\",\n         \"SS\": [ \"string\" ]\n      }\n   },\n   \"ReturnConsumedCapacity\": \"string\",\n   \"ReturnItemCollectionMetrics\": \"string\",\n   \"ReturnValues\": \"string\",\n   \"TableName\": \"string\",\n   \"UpdateExpression\": \"string\"\n}\n```\n\nå‚æ•°è¯´æ˜ï¼š\n\n- Key: ä¸»é”®ï¼Œç”¨äºå®šä½é¡¹ç›®\n- TableNameï¼šè¡¨å ï¼ˆæœ€å° 3. æœ€å¤§ 255ï¼‰\n- Expectedï¼š\n- AttributeUpdatesï¼š é—ç•™å‚æ•°ï¼Œå·²åºŸå¼ƒ\n- ConditionalOperatorï¼š é—ç•™å‚æ•°ï¼Œå·²åºŸå¼ƒ\n- ConditionExpressionï¼šæ¡ä»¶è¡¨è¾¾å¼ï¼ˆä»…åœ¨ç‰¹å®š ConditionExpression çš„è®¡ç®—ç»“æœä¸º true æ—¶æˆåŠŸå®Œæˆï¼‰\n- ExpressionAttributeNamesï¼šæ¡ä»¶è¡¨è¾¾å¼çš„åç§°çš„åˆ«åï¼Œæ¯”å¦‚ date ä¸ºä¿ç•™å­—ï¼Œå¯ç”¨åˆ«åå®šä¹‰ä¸º #d\n- ExpressionAttributeValuesï¼šæ¡ä»¶è¡¨è¾¾å¼çš„å€¼\n- ReturnConsumedCapacityï¼šæ˜¾ç¤ºä½¿ç”¨çš„å†™å…¥å®¹é‡å•ä½æ•°\n    - TOTAL ä¼šè¿”å›ç”±è¡¨åŠå…¶æ‰€æœ‰global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n    - INDEXES ä»…è¿”å›ç”±global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n    - NONE è¡¨ç¤ºæ‚¨ä¸éœ€è¦è¿”å›ä»»ä½•å ç”¨å®¹é‡ç»Ÿè®¡æ•°æ®ã€‚\n- ReturnValues: æ›´æ–°åè¿”å›çš„æ•°æ®.\n    - NONE - å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œè¿”å›None (è¿™ä¸ªæ˜¯é»˜è®¤å€¼)\n    - ALL_OLD - æŒ‰åœ¨è¿›è¡Œæ›´æ–°ä¹‹å‰çš„æƒ…å†µï¼Œè¿”å›æ•´ä¸ªé¡¹ç›®ã€‚\n    - ALL_NEW - æŒ‰åœ¨è¿›è¡Œæ›´æ–°ä¹‹åçš„æƒ…å†µï¼Œè¿”å›æ•´ä¸ªé¡¹ç›®ã€‚\n    - UPDATED_OLD - æŒ‰åœ¨è¿›è¡Œæ›´æ–°ä¹‹å‰çš„æƒ…å†µï¼Œä»…è¿”å›æ›´æ–°çš„å€¼ã€‚\n    - UPDATED_NEW - æŒ‰åœ¨è¿›è¡Œæ›´æ–°ä¹‹åçš„æƒ…å†µï¼Œä»…è¿”å›æ›´æ–°çš„å€¼ã€‚\n- UpdateExpressionï¼šæŒ‡å®šè¦ä¿®æ”¹çš„å±æ€§ä»¥åŠè¿™äº›å±æ€§çš„æ–°å€¼ï¼Œæ›´æ–°è¡¨è¾¾å¼è¿˜æŒ‡å®šå¦‚ä½•ä¿®æ”¹å±æ€§ã€‚ä¸‹é¢æ˜¯æ›´æ–°è¡¨è¾¾å¼çš„è¯­æ³•æ‘˜è¦ï¼š\n```\nupdate-expression ::=\nSET set-action , ...\n| REMOVE remove-action , ...  \n| ADD add-action , ...\n| DELETE delete-action , ...  \n```\næ›´æ–°è¡¨è¾¾å¼ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆã€‚æ¯ä¸ªéƒ¨åˆ†ä»¥ä¸€ä¸ª SETã€REMOVEã€ADD æˆ– DELETE å…³é”®å­—å¼€å¤´ã€‚æ‚¨å¯åœ¨æ›´æ–°è¡¨è¾¾å¼ä¸­æŒ‰ä»»æ„é¡ºåºåŒ…å«å…¶ä¸­ä»»æ„éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªéƒ¨åˆ†å…³é”®å­—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚æ‚¨å¯ä»¥åŒæ—¶ä¿®æ”¹å¤šä¸ªå±æ€§ã€‚ä»¥ä¸‹æ˜¯æ›´æ–°è¡¨è¾¾å¼çš„ä¸€äº›ç¤ºä¾‹ï¼š\n\n* SET list[0] = :val1\n* REMOVE #m.nestedField1, #m.nestedField2\n* ADD aNumber :val2, anotherNumber :val3\n* DELETE aSet :val4\n\nä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¸¦æœ‰å¤šä¸ªéƒ¨åˆ†çš„å•ä¸ªæ›´æ–°è¡¨è¾¾å¼ï¼š\n\n```json\nSET list[0] = :val1 REMOVE #m.nestedField1, #m.nestedField2 ADD aNumber :val2, anotherNumber :val3 DELETE aSet :val4\n```\n\næˆ‘ä»¬å¯ä»¥åœ¨æ›´æ–°è¡¨è¾¾å¼ä¸­ä½¿ç”¨ä»»æ„å±æ€§åç§°ï¼Œ*ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ a-z æˆ– A-Z*ï¼Œ*ç¬¬äºŒä¸ªå­—ç¬¦ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ˜¯ a-zã€A-Z æˆ– 0-9*ã€‚\nå¦‚æœå±æ€§åç§°ä¸æ»¡è¶³æ­¤è¦æ±‚ï¼Œåˆ™éœ€è¦å°†è¡¨è¾¾å¼å±æ€§åç§°å®šä¹‰ä¸ºå ä½ç¬¦ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒï¼ˆè¡¨è¾¾å¼å±æ€§åç§°ï¼‰ã€‚\n\nè¦åœ¨æ›´æ–°è¡¨è¾¾å¼ä¸­æŒ‡å®šæ–‡æœ¬å€¼ï¼Œå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼å±æ€§å€¼ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒï¼ˆè¡¨è¾¾å¼å±æ€§å€¼ï¼‰ã€‚\n\n------\n\n##### SET\n\nåœ¨æ›´æ–°è¡¨è¾¾å¼ä¸­ä½¿ç”¨ SET æ“ä½œå¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ä¸å€¼æ·»åŠ åˆ°é¡¹ç›®ã€‚å¦‚æœè¿™äº›å±æ€§å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°ã€‚è¿˜å¯ä»¥ä½¿ç”¨ SET æ¥åŠ æˆ–å‡æ•°å­—ç±»å‹çš„å±æ€§ã€‚å¯¹å¤šä¸ªå±æ€§æ‰§è¡Œ SET æ“ä½œï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚\n\nsetè¯­æ³•å¦‚ä¸‹ï¼š\n```\nset-action ::=\n    path = value\n\nvalue ::=\n    operand\n    | operand '+' operand\n    | operand '-' operand\n\noperand ::=\n    path | function\n```\n\n* path å…ƒç´ æ˜¯é¡¹ç›®çš„æ–‡æ¡£è·¯å¾„ã€‚(æ¯”å¦‚é¡¹ç›®ä¸­info ä¸ºå­—å…¸ info ä¸­ a çš„è·¯å¾„ä¸ºinfo['a'])\n* operand å…ƒç´ å¯ä»¥ä¸ºé¡¹ç›®çš„æ–‡æ¡£è·¯å¾„ï¼Œæˆ–è€…ä¸ºå‡½æ•°ã€‚\n\nSET æ“ä½œæ”¯æŒä»¥ä¸‹å‡½æ•°ï¼š\n\n* if_not_exists (path, operand) - å¦‚æœé¡¹ç›®åœ¨æŒ‡å®š path ä¸­ä¸åŒ…å«å±æ€§ï¼Œåˆ™ if_not_exists çš„æ±‚å€¼ç»“æœä¸º operandï¼›å¦åˆ™æ±‚å€¼ç»“æœä¸º pathã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°æ¥é¿å…è¦†ç›–é¡¹ç›®ä¸­å·²å­˜åœ¨çš„å±æ€§ã€‚\n* list_append (operand, operand) - æ­¤å‡½æ•°çš„æ±‚å€¼ç»“æœä¸ºåˆ—è¡¨ï¼Œæ–°å…ƒç´ å°†æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚æ–°å…ƒç´ å¿…é¡»åŒ…å«åœ¨åˆ—è¡¨ä¸­ï¼Œä¾‹å¦‚è¦å‘åˆ—è¡¨ä¸­æ·»åŠ  2ï¼Œæ“ä½œæ•°å°†æˆä¸º [2]ã€‚æ‚¨å¯ä»¥é€šè¿‡åè½¬æ“ä½œæ•°çš„é¡ºåºï¼Œå°†æ–°å…ƒç´ é™„åŠ åˆ°åˆ—è¡¨çš„å¼€å¤´æˆ–ç»“å°¾ã€‚\n\nä»¥ä¸‹æ˜¯åœ¨è¿™äº›å‡½æ•°ä¸­ä½¿ç”¨ SET æ“ä½œçš„ä¸€äº›ç¤ºä¾‹ã€‚\n\nå¦‚æœå±æ€§å·²å­˜åœ¨ï¼Œåˆ™ä»¥ä¸‹ç¤ºä¾‹ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦åˆ™å®ƒä¼šå°†å±æ€§è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚\n```\nSET Price = if_not_exists(Price, 100)\n```\nä»¥ä¸‹ç¤ºä¾‹å°†æ–°å…ƒç´ æ·»åŠ åˆ° FiveStar è¯„è®ºåˆ—è¡¨ã€‚è¡¨è¾¾å¼å±æ€§åç§° #pr æ˜¯ ProductReviewsï¼›å±æ€§å€¼ :r æ˜¯åªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚å¦‚æœåˆ—è¡¨ä¹‹å‰æœ‰ä¸¤ä¸ªå…ƒç´  [0] å’Œ [1]ï¼Œåˆ™æ–°å…ƒç´ å°†ä¸º [2]ã€‚\n```\nSET #pr.FiveStar = list_append(#pr.FiveStar, :r)\n```\nä»¥ä¸‹ç¤ºä¾‹å°†å¦ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ° FiveStar è¯„è®ºåˆ—è¡¨ä¸­ï¼Œä½†æ­¤æ—¶å…ƒç´ å°†é™„åŠ åˆ°åˆ—è¡¨å¼€å¤´çš„ä½ç½® [0] å¤„ã€‚åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…¶ä»–å…ƒç´ å°†ä¼šç§»åŠ¨ä¸€ä½ã€‚\n```\nSET #pr.FiveStar = list_append(:r, #pr.FiveStar)\n```\n\n##### REMOVE\n\nåœ¨æ›´æ–°è¡¨è¾¾å¼ä¸­ä½¿ç”¨ REMOVE æ“ä½œå¯ä»é¡¹ç›®ä¸­åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚è¦æ‰§è¡Œå¤šä¸ª REMOVE æ“ä½œï¼Œè¯·ä½¿ç”¨é€—å·åˆ†éš”ã€‚\n\nä¸‹é¢æ˜¯æ›´æ–°è¡¨è¾¾å¼ä¸­çš„ REMOVE çš„è¯­æ³•æ‘˜è¦ã€‚å”¯ä¸€çš„æ“ä½œæ•°æ˜¯æ‚¨è¦åˆ é™¤çš„å±æ€§çš„æ–‡æ¡£è·¯å¾„ï¼š\n\n```\nremove-action ::=\n    path\n```\nä»¥ä¸‹æ˜¯ä½¿ç”¨ REMOVE æ“ä½œçš„æ›´æ–°è¡¨è¾¾å¼ç¤ºä¾‹ã€‚ä»é¡¹ç›®ä¸­åˆ é™¤å¤šä¸ªå±æ€§ï¼š\n\n```\nREMOVE Title, RelatedItems[2], Pictures.RearView\n```\nå¯¹åˆ—è¡¨å…ƒç´ ä½¿ç”¨ REMOVE\n\nå½“åˆ é™¤ç°æœ‰åˆ—è¡¨å…ƒç´ æ—¶ï¼Œå‰©ä½™çš„å…ƒç´ å°†ä¼šç§»ä½ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹åˆ—è¡¨ï¼š\n```\nMyNumbers: { [\"Zero\",\"One\",\"Two\",\"Three\",\"Four\"] }\n```\nåˆ—è¡¨åŒ…å«å…ƒç´  [0]ã€[1]ã€[2]ã€[3] å’Œ [4]ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ REMOVE æ“ä½œåˆ é™¤ä¸¤ä¸ªå…ƒç´ ï¼š\n```\nREMOVE MyNumbers[1], MyNumbers[3]\n```\nå‰©ä½™çš„å…ƒç´ ä¼šå‘å³ç§»ä½ï¼Œç”Ÿæˆå¸¦æœ‰å…ƒç´  [0]ã€[1] å’Œ [2] çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ å…·æœ‰ä»¥ä¸‹æ•°æ®ï¼š\n```\nMyNumbers: { [\"Zero\",\"Two\",\"Four\"] }\n```\n> å¦‚æœæ‚¨ä½¿ç”¨ REMOVE æ¥åˆ é™¤è¶…å‡ºåˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ ä½ç½®çš„ä¸å­˜åœ¨é¡¹ç›®ï¼Œåˆ™å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼šä¹Ÿå°±æ˜¯ä¸åˆ é™¤ä»»ä½•æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹è¡¨è¾¾å¼å¯¹ MyNumbers åˆ—è¡¨æ²¡æœ‰ä»»ä½•æ•ˆæœï¼š\n\n```\nREMOVE MyNumbers[11]\n```\n\n##### ADD\n\n*ADD æ“ä½œä»…æ”¯æŒæ•°å­—å’Œé›†æ•°æ®ç±»å‹ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ SET è€Œä¸æ˜¯ ADDã€‚*\n\nåœ¨æ›´æ–°è¡¨è¾¾å¼ä¸­ä½¿ç”¨ ADD å¯æ‰§è¡Œä»¥ä¸‹ä»»ä¸€æ“ä½œï¼š\n\n* å¦‚æœå±æ€§å°šä¸å­˜åœ¨ï¼Œåˆ™å°†æ–°å±æ€§åŠå…¶å€¼æ·»åŠ åˆ°é¡¹ç›®ã€‚\n* å¦‚æœå±æ€§å·²å­˜åœ¨ï¼Œåˆ™ ADD çš„è¡Œä¸ºå–å†³äºå±æ€§çš„æ•°æ®ç±»å‹ï¼š\n* å¦‚æœå±æ€§æ˜¯æ•°å­—ï¼Œå¹¶ä¸”æ·»åŠ çš„å€¼ä¹Ÿæ˜¯æ•°å­—ï¼Œåˆ™è¯¥å€¼å°†æŒ‰æ•°å­¦è¿ç®—ä¸ç°æœ‰å±æ€§ç›¸åŠ ã€‚ï¼ˆå¦‚æœè¯¥å€¼ä¸ºè´Ÿæ•°ï¼Œåˆ™ä»ç°æœ‰å±æ€§å‡å»è¯¥å€¼ã€‚ï¼‰\n* å¦‚æœå±æ€§æ˜¯é›†ï¼Œå¹¶ä¸”æ‚¨æ·»åŠ çš„å€¼ä¹Ÿæ˜¯é›†ï¼Œåˆ™è¯¥å€¼å°†é™„åŠ åˆ°ç°æœ‰é›†ä¸­ã€‚\n* è¦æ‰§è¡Œå¤šä¸ª ADD æ“ä½œï¼Œè¯·ä½¿ç”¨é€—å·åˆ†éš”ã€‚\n\nåœ¨ä»¥ä¸‹è¯­æ³•æ‘˜è¦ä¸­ï¼š\n\n* path å…ƒç´ æ˜¯å±æ€§çš„æ–‡æ¡£è·¯å¾„ã€‚å±æ€§å¿…é¡»ä¸ºæ•°å­—æˆ–é›†æ•°æ®ç±»å‹ã€‚\n* value å…ƒç´ æ˜¯è¦ä¸å±æ€§ç›¸åŠ çš„å€¼ï¼ˆå¯¹äºæ•°å­—æ•°æ®ç±»å‹ï¼‰ï¼Œæˆ–è€…æ˜¯è¦é™„åŠ åˆ°å±æ€§ä¸­çš„é›†ï¼ˆå¯¹äºé›†ç±»å‹ï¼‰ã€‚\n\n```\nadd-action ::=\n    path value\n```\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨ add æ“ä½œçš„ä¸€äº›æ›´æ–°è¡¨è¾¾å¼ç¤ºä¾‹ã€‚\n\nä»¥ä¸‹ç¤ºä¾‹å¯¹æ•°å­—è¿›è¡ŒåŠ è¿ç®—ã€‚è¡¨è¾¾å¼å±æ€§å€¼ :n æ˜¯æ•°å­—ï¼Œæ­¤å€¼å°†ä¸ Price ç›¸åŠ ã€‚\n```\nADD Price :n\n```\nä»¥ä¸‹ç¤ºä¾‹å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ·»åŠ åˆ° Color é›†ã€‚è¡¨è¾¾å¼å±æ€§å€¼ :c æ˜¯å­—ç¬¦ä¸²é›†ã€‚\n```\nADD Color :c\n```\n\n##### DELETE\n\n*DELETE æ“ä½œåªæ”¯æŒé›†æ•°æ®ç±»å‹ã€‚*\n\nåœ¨æ›´æ–°è¡¨è¾¾å¼ä¸­ä½¿ç”¨ DELETE æ“ä½œå¯ä»é›†ä¸­åˆ é™¤å…ƒç´ ã€‚è¦æ‰§è¡Œå¤šä¸ª DELETE æ“ä½œï¼Œè¯·ä½¿ç”¨é€—å·åˆ†éš”ã€‚\n\nåœ¨ä»¥ä¸‹è¯­æ³•æ‘˜è¦ä¸­ï¼š\n\n* path å…ƒç´ æ˜¯å±æ€§çš„æ–‡æ¡£è·¯å¾„ã€‚è¯¥å±æ€§å¿…é¡»æ˜¯é›†æ•°æ®ç±»å‹ã€‚\n* value å…ƒç´ æ˜¯é›†ä¸­è¦åˆ é™¤çš„å…ƒç´ ã€‚\n\n```\ndelete-action ::=\n    path value\n```\n\nä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ DELETE æ“ä½œä» Color é›†ä¸­åˆ é™¤å…ƒç´ ã€‚è¡¨è¾¾å¼å±æ€§å€¼ :c æ˜¯å­—ç¬¦ä¸²é›†ã€‚\n\n```\nDELETE Color :c\n```\n\n#### UpdateItem ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```json\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET RecordLabel = :label\",\n    ExpressionAttributeValues: {\n        \":label\": \"Global Records\"\n    }\n}\n```\n\n* UpdateItemå¿…é¡»æŒ‡å®šè¦ä¿®æ”¹çš„é¡¹ç›®çš„ Key å±æ€§å’Œä¸€ä¸ªç”¨äºæŒ‡å®šå±æ€§å€¼çš„ UpdateExpressionã€‚\n* UpdateItem æ›¿æ¢æ•´ä¸ªé¡¹ç›®ï¼Œè€Œä¸æ˜¯æ›¿æ¢å•ä¸ªå±æ€§ã€‚\n* UpdateItem çš„è¡Œä¸ºä¸â€œupsertâ€æ“ä½œçš„è¡Œä¸ºç±»ä¼¼ï¼šå¦‚æœé¡¹ç›®ä½äºè¡¨ä¸­ï¼Œåˆ™æ›´æ–°é¡¹ç›®ï¼Œå¦åˆ™æ·»åŠ ï¼ˆæ’å…¥ï¼‰æ–°é¡¹ç›®ã€‚\n* UpdateItemåªèƒ½ä¿®æ”¹å•ä¸ªé¡¹ç›®ï¼Œå¦‚æœè¦ä¿®æ”¹å¤šä¸ªé¡¹ç›®ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¤šä¸ª UpdateItem æ“ä½œã€‚\n* UpdateItem æ”¯æŒæ¡ä»¶å†™å…¥ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œæ“ä½œä»…åœ¨ç‰¹å®š ConditionExpression çš„è®¡ç®—ç»“æœä¸º true æ—¶æˆåŠŸå®Œæˆã€‚ä¾‹å¦‚ï¼Œé™¤éæ­Œæ›²çš„ä»·æ ¼å¤§äºæˆ–ç­‰äº 2.00ï¼Œå¦åˆ™ä»¥ä¸‹ UpdateItem æ“ä½œä¸ä¼šæ‰§è¡Œæ›´æ–°ï¼š\n\n#### æ¡ä»¶å†™å…¥\n\nè¦æ‰§è¡Œæ¡ä»¶æ›´æ–°ï¼Œè¯·ä½¿ç”¨æ›´æ–°è¡¨è¾¾å¼ä»¥åŠæ¡ä»¶è¡¨è¾¾å¼æ¥æ‰§è¡Œ UpdateItem æ“ä½œã€‚è¦ç»§ç»­æ‰§è¡Œæ“ä½œï¼Œæ¡ä»¶è¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœå¿…é¡»ä¸º trueï¼›å¦åˆ™æ“ä½œå°†å¤±è´¥ã€‚\n\nå‡è®¾æ‚¨è¦å°†æŸé¡¹ç›®çš„ä»·æ ¼æé«˜ä¸€å®šé‡‘é¢ï¼Œå¦‚ :amtï¼Œä½†å‰ææ˜¯ç»“æœä¸å¾—è¶…è¿‡æœ€é«˜ä»·ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥è®¡ç®—å½“å‰å…è®¸æä»·çš„æœ€é«˜ä»·ï¼Œç„¶åä»æœ€é«˜ä»·ä¸­å‡å»æé«˜çš„é‡‘é¢ :amtã€‚å°†ç»“æœå®šä¹‰ä¸º :limitï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹æ¡ä»¶è¡¨è¾¾å¼ï¼š\n\næ¡ä»¶è¡¨è¾¾å¼ï¼šPrice <= :limit)\næ›´æ–°è¡¨è¾¾å¼ï¼šSET Price = Price + :amt\nç°åœ¨å‡è®¾æ‚¨è¦ä¸ºé¡¹ç›®è®¾ç½®å‰è§†å›¾å›¾ç‰‡ï¼Œä¸è¿‡å‰ææ˜¯è¯¥é¡¹ç›®è¿˜æ²¡æœ‰ä»»ä½•å›¾ç‰‡ï¼Œä¸å¸Œæœ›è¦†ç›–ä»»ä½•ç°æœ‰å…ƒç´ ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¡¨è¾¾å¼æ¥æ‰§è¡Œæ“ä½œï¼š\n\næ›´æ–°è¡¨è¾¾å¼ï¼šSET Pictures.FrontView = :myUR\nï¼ˆå‡è®¾ :myURL æ˜¯é¡¹ç›®å›¾ç‰‡çš„ä½ç½®ï¼Œä¾‹å¦‚ http://example.com/picture.jpgã€‚ï¼‰\næ¡ä»¶è¡¨è¾¾å¼ï¼šattribute_not_exists(Pictures.FrontView)\n\n```python\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET RecordLabel = :label\",\n    ConditionExpression: \"Price >= :p\",\n    ExpressionAttributeValues: {\n        \":label\": \"Global Records\",\n        \":p\": 2.00\n    }\n}\n```\n\n* UpdateItem è¿˜æ”¯æŒåŸå­è®¡æ•°å™¨æˆ–ç±»å‹ä¸º Number çš„å±æ€§ï¼ˆå¯é€’å¢æˆ–é€’å‡ï¼‰ã€‚åŸå­è®¡æ•°å™¨åœ¨å¾ˆå¤šæ–¹é¢éƒ½ç±»ä¼¼äº SQL æ•°æ®åº“ä¸­çš„é¡ºåºç”Ÿæˆå™¨ã€èº«ä»½åˆ—æˆ–è‡ªé€’å¢å­—æ®µã€‚\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ª UpdateItem æ“ä½œçš„ç¤ºä¾‹ï¼Œå®ƒåˆå§‹åŒ–ä¸€ä¸ªæ–°å±æ€§ (Plays) æ¥è·Ÿè¸ªæ­Œæ›²çš„å·²æ’­æ”¾æ¬¡æ•°ï¼š\n\n```json\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET Plays = :val\",\n    ExpressionAttributeValues: {\n        \":val\": 0\n    },\n    ReturnValues: \"UPDATED_NEW\"\n}\n```\nReturnValues å‚æ•°è®¾ç½®ä¸º UPDATED_NEWï¼Œè¿™å°†è¿”å›å·²æ›´æ–°çš„ä»»ä½•å±æ€§çš„æ–°å€¼ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå®ƒè¿”å› 0ï¼ˆé›¶ï¼‰ã€‚\n\nå½“æŸäººæ’­æ”¾æ­¤æ­Œæ›²æ—¶ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹ UpdateItem æ“ä½œæ¥å°† Plays å¢åŠ  1ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET Plays = Plays + :incr\",\n    ExpressionAttributeValues: {\n        \":incr\": 1\n    },\n    ReturnValues: \"UPDATED_NEW\"\n}\n```\n\n#### æ€»ç»“ä¸€ä¸‹\n\n* UpdateItem ä¸€æ¬¡åªèƒ½æ›´æ–°ä¸€ä¸ªé¡¹ç›®\n* UpdateItem æ›´æ–°æ›´æ–°æ•´ä¸ªé¡¹ç›®è€Œä¸æ˜¯åªä¿®æ”¹ç‰¹ç‚¹çš„å€¼\n* UpdateItem æ”¯æŒæ¡ä»¶å†™å…¥\n\n> è¿™ä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†DynamoDB é¡¹ç›®çš„æ›´æ–°æ“ä½œï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†ä»‹ç»é¡¹ç›®çš„åˆ é™¤æ“ä½œï¼ˆç´¢å¼•çš„æŸ¥è¯¢åˆè¦å»¶åäº†ã€‚ã€‚\n\n[åŸæ–‡é“¾æ¥](http://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751962&idx=1&sn=9d3e387c3fa946305598bc269b40fd3e&chksm=80b0b830b7c73126364b48cb33915d9a51552327afb4cc73388984f5449f99871fd44465baa6#rd)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨7ï¼šé¡¹ç›®æ›´æ–°",
        "date": "2017-02-07 14:23:33",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-UpdateItem"
    },
    {
      "content": "\n> ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†DynamoDBç´¢å¼•çš„åˆ›å»ºåŠç®¡ç†ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å°†ä»‹ç»queryï¼ˆæŸ¥è¯¢ï¼‰å’Œscanï¼ˆæ‰«æï¼‰çš„ä½¿ç”¨ã€‚\n\n# æŸ¥è¯¢Query\n\nSQL å¯ä½¿ç”¨ SELECT è¯­å¥æŸ¥è¯¢å…³é”®åˆ—ã€éå…³é”®åˆ—æˆ–ä»»æ„ç»„åˆã€‚WHERE å­å¥ç¡®å®šè¿”å›çš„è¡Œã€‚\n\nDynamoDB Query æ“ä½œæä¾›å¯¹å­˜å‚¨æ•°æ®çš„ç‰©ç†ä½ç½®çš„å¿«é€Ÿé«˜æ•ˆè®¿é—®ã€‚ å¯ä»¥å°† Query ç”¨äºä»»ä½•å…·æœ‰å¤åˆä¸»é”®ï¼ˆåˆ†åŒºé”®å’Œæ’åºé”®ï¼‰çš„è¡¨ã€‚è¿™é‡Œçš„è¡¨å¿…é¡»æŒ‡å®šåˆ†åŒºé”®çš„ç›¸ç­‰æ¡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©æ€§ä¸ºæ’åºé”®æä¾›å¦ä¸€ä¸ªæ¡ä»¶ã€‚ KeyConditionExpression å‚æ•°æŒ‡å®šè¦æŸ¥è¯¢çš„é”®å€¼ã€‚\n\nHUGOMORE42\n\n> å¯ä½¿ç”¨å¯é€‰ FilterExpression åœ¨ç»“æœä¸­çš„æ‰¾å‡ºæŸäº›ç¬¦å·æ¡ä»¶çš„é¡¹ç›®ã€‚\n\nåœ¨ DynamoDB ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ ExpressionAttributeValues ä½œä¸ºè¡¨è¾¾å¼å‚æ•°ï¼ˆä¾‹å¦‚ï¼ŒKeyConditionExpressionå’Œ FilterExpressionï¼‰ä¸­çš„å ä½ç¬¦ã€‚è¿™ç±»ä¼¼äºåœ¨å…³ç³»æ•°æ®åº“ä¸­ä½¿ç”¨ç»‘å®šå˜é‡ï¼Œåœ¨è¿è¡Œæ—¶å°†å®é™…å€¼ä»£å…¥ SELECTè¯­å¥ã€‚ ä¸‹è¾¹æ˜¯queryçš„è¯­æ³•ï¼š\n\n```python\nresponse = table.query(\n    IndexName='string',\n    Select='ALL_ATTRIBUTES'|'ALL_PROJECTED_ATTRIBUTES'|'SPECIFIC_ATTRIBUTES'|'COUNT',\n    AttributesToGet=[\n        'string',\n    ],\n    Limit=123,\n    ConsistentRead=True|False,\n    ConditionalOperator='AND'|'OR',\n    ScanIndexForward=True|False,\n    ExclusiveStartKey={\n      'string': 'string'|123|Binary(b'bytes')|True|None|set(['string'])|set([123])|set([Binary(b'bytes')])|[]|{}\n    },\n    ReturnConsumedCapacity='INDEXES'|'TOTAL'|'NONE',\n    ProjectionExpression='string',\n    FilterExpression=Attr('myattribute').eq('myvalue'),\n    KeyConditionExpression=Key('mykey').eq('myvalue'),\n    ExpressionAttributeNames={\n        'string': 'string'\n    },\n    ExpressionAttributeValues={\n        'string': 'string'|123|Binary(b'bytes')|True|None|set(['string'])|set([123])|set([Binary(b'bytes')])|[]|{}\n    }\n)\n```\n\nå‚æ•°è¯´æ˜ï¼š\n\n- ExclusiveStartKey: èµ·å§‹æŸ¥è¯¢çš„keyï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€é¡µçš„æœ€åä¸€æ¡æ•°æ®\n- ConsistentRead: æ˜¯å¦ä½¿ç”¨å¼ºåˆ¶ä¸€è‡´æ€§ é»˜è®¤False\n- ScanIndexForward: ç´¢å¼•çš„æ’åºæ–¹å¼ True ä¸ºæ­£åº False ä¸ºå€’åº é»˜è®¤True\n- ReturnConsumedCapacity: DynamoDB å°†è¿”å›æ¡ä»¶å†™å…¥æœŸé—´ä½¿ç”¨çš„å†™å…¥å®¹é‡å•ä½æ•°\n\n  - TOTAL ä¼šè¿”å›ç”±è¡¨åŠå…¶æ‰€æœ‰global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n  - INDEXES ä»…è¿”å›ç”±global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n  - NONE è¡¨ç¤ºæ‚¨ä¸éœ€è¦è¿”å›ä»»ä½•å ç”¨å®¹é‡ç»Ÿè®¡æ•°æ®ã€‚\n\n- ProjectionExpression: ç”¨äºæŒ‡å®šè¦åœ¨æ‰«æç»“æœä¸­åŒ…å«çš„å±æ€§\n\n- FilterExpression: æŒ‡å®šä¸€ä¸ªæ¡ä»¶ï¼Œä»¥ä¾¿ä»…è¿”å›ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®\n\n- KeyConditionExpression: è¦æŸ¥è¯¢çš„é”®å€¼\n\n- ExpressionAttributeNames: æä¾›åç§°æ›¿æ¢åŠŸèƒ½\n- ExpressionAttributeValues: æä¾›å€¼æ›¿æ¢åŠŸèƒ½\n\nä»¥ä¸‹æ˜¯ DynamoDB ä¸­çš„å‡ ä¸ª Query ç¤ºä¾‹ï¼š\n\nè¿”å› Aritist = 'No One You Know' SongTitle='Call Me Today' çš„æ­Œæ›²ï¼š\n\n```json\n{\n    TableName: \"Music\",\n    KeyConditionExpression: \"Artist = :a and SongTitle = :t\",\n    ExpressionAttributeValues: {\n        \":a\": \"No One You Know\",\n        \":t\": \"Call Me Today\"\n    }\n}\n```\n\nè¿”å› Aitist='No One You Know' çš„æ‰€ä»¥æ­Œæ›²ï¼š\n\n```json\n{\n    TableName: \"Music\",\n    KeyConditionExpression: \"Artist = :a\",\n    ExpressionAttributeValues: {\n        \":a\": \"No One You Know\"\n    }\n}\n```\n\nè¿”å›Aritist ='No One You Know' å¹¶ä¸” SongTitle å¼€å¤´ä¸ºCall çš„æ‰€æœ‰æ­Œæ›²ï¼š\n\n```json\n{\n    TableName: \"Music\",\n    KeyConditionExpression: \"Artist = :a and begins_with(SongTitle, :t)\",\n    ExpressionAttributeValues: {\n        \":a\": \"No One You Know\",\n        \":t\": \"Call\"\n    }\n}\n```\n\nè¿”å›Aritist ='No One You Know' å¹¶ä¸” SongTitle å¼€å¤´ä¸ºToday å¹¶ä¸”ä»·æ ¼å°äº1 çš„æ‰€æœ‰æ­Œæ›²ï¼š\n\n```json\n{\n    TableName: \"Music\",\n    KeyConditionExpression: \"Artist = :a and contains(SongTitle, :t)\",\n    FilterExpression: \"price < :p\",\n    ExpressionAttributeValues: {\n        \":a\": \"No One You Know\",\n        \":t\": \"Today\",\n        \":p\": 1.00\n    }\n}\n```\n\n## Python Example\n\nboto3\n\nè¿”å› Aitist='The Acme Band' çš„æ‰€æœ‰æ­Œæ›²ï¼š\n\n```python\n# ...\nfrom boto3.dynamodb.conditions import Key, Attr\n\ntable = db3.Table('Music')\n\nresponse = table.query(\n    KeyConditionExpression=Key('Artist').eq('The Acme Band')\n)\n\nitems = response['Items']\nprint(items)\n\n## output\n[\n{\n    u'Genre': u'Rock',\n    u'Price': Decimal('0.99'),\n    u'Artist': u'The Acme Band',\n    u'SongTitle': u'Look Out, World',\n    u'AlbumTitle': u'The Buck Starts Here'\n},\n{\n    u'Artist': u'The Acme Band',\n    u'Price': Decimal('2.47'),\n    u'AlbumTitle': u'The Buck Starts Here',\n    u'PromotionInfo': {\n        u'RadioStationsPlaying': [u'KHCR', u'KBQX', u'WTNR', u'WJJH'],\n        u'Rotation': u'Heavy',\n        u'TourDates': {u'Seattle': u'20150625', u'Cleveland': u'20150630'}\n    },\n    u'Genre': u'Rock', u'SongTitle': u'Still In Love'\n    }\n]\n```\n\nè¿”å› Artist='No One You Know' å¹¶ä¸”SongTitle='Somewhere Down The Road' çš„æ‰€æœ‰æ­Œæ›²ï¼š\n\n```python\nresponse = table.query(\n    KeyConditionExpression=Key('Artist').eq('No One You Know') & Key('SongTitle').eq('Somewhere Down The Road')\n)\nitems = response['Items']\nprint(items)\n\n## output\n\n[{\n    u'Artist': u'No One You Know',\n    u'AlbumTitle': u'Somewhat Famous',\n    u'CriticRating': Decimal('8.4'),\n    u'Year': Decimal('1984'),\n    u'Genre': u'Country',\n    u'SongTitle': u'Somewhere Down The Road'\n  }\n]\n```\n\nè¿”å›Aritist ='No One You Know' å¹¶ä¸” SongTitle å¼€å¤´ä¸º Call çš„æ‰€æœ‰æ­Œæ›²ï¼š\n\n```python\nresponse = table.query(\n    KeyConditionExpression=Key('Artist').eq('The Acme Band') & Key('SongTitle').begins_with('Look')\n)\nitems = response['Items']\nprint(items)\n\n## output\n\n[\n{\n    u'Genre': u'Rock',\n    u'Price': Decimal('0.99'),\n    u'Artist': u'The Acme Band',\n    u'SongTitle': u'Look Out, World',\n    u'AlbumTitle': u'The Buck Starts Here'\n}\n]\n```\n\nè¿”å›Aritist ='No One You Know' å¹¶ä¸” SongTitle å¼€å¤´ä¸ºToday å¹¶ä¸”ä»·æ ¼å°äº1 çš„æ‰€æœ‰æ­Œæ›²ï¼š\n\n```python\nresponse = table.query(\n    KeyConditionExpression=Key('Artist').eq('The Acme Band'),\n    FilterExpression=Attr('Price').lt(1)\n)\nitems = response['Items']\nprint(items)\n\n## output\n[{\n    u'Genre': u'Rock',\n    u'Price': Decimal('0.99'),\n    u'Artist': u'The Acme Band',\n    u'SongTitle': u'Look Out, World',\n    u'AlbumTitle': u'The Buck Starts Here'\n},\n]\n```\n\n### Note\n\nç‰¹åˆ«æ³¨æ„ï¼š å¦‚æœç­›é€‰æ¡ä»¶æ˜¯æ’åºé”®ï¼Œåˆ™æ˜¯å…ˆè¿‡æ»¤å†è¿”å›ç»“æœï¼Œå’ŒSQLä¸­where ç­›é€‰ç±»ä¼¼ã€‚ å¦‚æœæ’åºå€¼ä¸æ˜¯æ’åºå»ºï¼Œåˆ™å…ˆè¿”å›ç»“æœå†è¿‡æ»¤ã€‚\n\nä¾‹å¦‚ï¼š\n\nè¡¨ç»“æ„å’Œé¡¹ç›®å€¼å¦‚ä¸‹ï¼š\n\n```\nTable Test:\n    a: hash_key\n    b: range_key\n    c: number\n\nfor i in range(10):\n    Test(a=1, b=i*10, c=i*20)\n```\n\næŸ¥è¯¢ï¼š\n\n```python\nresponse = table.query(\n    KeyConditionExpression=Key('a').eq('1') & Key('b').gt('40'),\n    Limit=2\n)\n\næŸ¥è¯¢ç»“æœä¸ºä¸¤ä¸ªé¡¹ç›®ï¼š\n\na=1, b=50, c=80\na=1, b=60, c=100\n\nresponse = table.query(\n    KeyConditionExpression=Key('a').eq('1'),\n    FilterExpression=Attr('c').gt('80'),\n    Limit=2\n)\n\nä¼šå‘ç°æŸ¥è¯¢æ²¡æœ‰ç»“æœã€‚\n\nè¿™æ˜¯å› ä¸ºDynamoDB ä¼šé»˜è®¤æŒ‰ç…§ b æ­£åºæ’åˆ—ï¼Œlimit=2 åˆ™é™å®šäº†ç»“æœä¸ºï¼š\na=1, b=10, c=20\na=1, b=20, c=40\n\nå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç»“æœä¸­å¹¶æ²¡æœ‰ç¬¦åˆ c > 80 çš„é¡¹ç›®ã€‚\næ‰€ä»¥ ç»“æœä¸ºç©ºã€‚\n\nä¸è¿‡è¿˜æ˜¯ä¼šå è¯»å–ååé‡ã€‚\n```\n\n## Scan\n\nåœ¨ SQL ä¸­ï¼Œä¸å¸¦ WHERE å­å¥çš„ SELECT è¯­å¥å°†è¿”å›è¡¨ä¸­çš„æ¯ä¸ªè¡Œã€‚åœ¨ DynamoDB ä¸­ï¼ŒScan æ“ä½œå¯æ‰§è¡Œç›¸åŒçš„å·¥ä½œã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‚¨éƒ½å¯ä»¥æ£€ç´¢æ‰€æœ‰é¡¹ç›®æˆ–éƒ¨åˆ†é¡¹ç›®ã€‚ æ— è®ºæ‚¨ä½¿ç”¨çš„æ˜¯ SQL è¿˜æ˜¯ NoSQL æ•°æ®åº“ï¼Œéƒ½åº”è°¨æ…ä½¿ç”¨æ‰«ææ“ä½œï¼Œå› ä¸ºå®ƒä»¬ä¼šå ç”¨å¤§é‡ç³»ç»Ÿèµ„æº\n\nåœ¨ SQL ä¸­ï¼Œå¯åœ¨ä¸æŒ‡å®š WHERE å­å¥çš„æƒ…å†µä¸‹ä½¿ç”¨ SELECT è¯­å¥æ‰«æè¡¨å¹¶æ£€ç´¢å…¶æ‰€æœ‰æ•°æ®ã€‚æ‚¨å¯ä»¥åœ¨ç»“æœä¸­è¯·æ±‚ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ã€‚æˆ–è€…ï¼Œå¦‚æœæ‚¨ä½¿ç”¨é€šé…ç¬¦ (*)ï¼Œåˆ™å¯è¯·æ±‚æ‰€æœ‰åˆ—ã€‚ ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š\n\n```sql\n/* Return all of the data in the table */\nSELECT * FROM Music;\n/* Return all of the values for Artist and Title */\nSELECT Artist, Title FROM Music;\n```\n\nDynamoDB æä¾›ä»¥ç›¸ä¼¼æ–¹å¼å·¥ä½œçš„ Scan æ“ä½œã€‚ ä¸‹é¢æ˜¯Scan çš„è¯­æ³•ç¤ºä¾‹ï¼š\n\n```python\nresponse = table.scan(\n    IndexName='string',\n    AttributesToGet=[\n        'string',\n    ],\n    Limit=123,\n    Select='ALL_ATTRIBUTES'|'ALL_PROJECTED_ATTRIBUTES'|'SPECIFIC_ATTRIBUTES'|'COUNT',\n    ConditionalOperator='AND'|'OR',\n    ExclusiveStartKey={\n        'string': 'string'|123|Binary(b'bytes')|True|None|set(['string'])|set([123])|set([Binary(b'bytes')])|[]|{}\n    },\n    ReturnConsumedCapacity='INDEXES'|'TOTAL'|'NONE',\n    TotalSegments=123,\n    Segment=123,\n    ProjectionExpression='string',\n    FilterExpression=Attr('myattribute').eq('myvalue'),\n    ExpressionAttributeNames={\n        'string': 'string'\n    },\n    ExpressionAttributeValues={\n        'string': 'string'|123|Binary(b'bytes')|True|None|set(['string'])|set([123])|set([Binary(b'bytes')])|[]|{}\n    },\n    ConsistentRead=True|False\n)\n```\n\nå‚æ•°è¯´æ˜ï¼š\n\n- ExclusiveStartKey: èµ·å§‹æŸ¥è¯¢çš„keyï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€é¡µçš„æœ€åä¸€æ¡æ•°æ®\n- ConsistentRead: æ˜¯å¦ä½¿ç”¨å¼ºåˆ¶ä¸€è‡´æ€§ é»˜è®¤False\n- ScanIndexForward: ç´¢å¼•çš„æ’åºæ–¹å¼ True ä¸ºæ­£åº False ä¸ºå€’åº é»˜è®¤True\n- ReturnConsumedCapacity: DynamoDB å°†è¿”å›æ¡ä»¶å†™å…¥æœŸé—´ä½¿ç”¨çš„å†™å…¥å®¹é‡å•ä½æ•°\n\n  - TOTAL ä¼šè¿”å›ç”±è¡¨åŠå…¶æ‰€æœ‰global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n  - INDEXES ä»…è¿”å›ç”±global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n  - NONE è¡¨ç¤ºæ‚¨ä¸éœ€è¦è¿”å›ä»»ä½•å ç”¨å®¹é‡ç»Ÿè®¡æ•°æ®ã€‚\n\n- ProjectionExpression: ç”¨äºæŒ‡å®šè¦åœ¨æ‰«æç»“æœä¸­åŒ…å«çš„å±æ€§\n\n- FilterExpression: æŒ‡å®šä¸€ä¸ªæ¡ä»¶ï¼Œä»¥ä¾¿ä»…è¿”å›ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®\n\n- KeyConditionExpression: è¦æŸ¥è¯¢çš„é”®å€¼\n\n- ExpressionAttributeNames: æä¾›åç§°æ›¿æ¢åŠŸèƒ½\n- ExpressionAttributeValues: æä¾›å€¼æ›¿æ¢åŠŸèƒ½\n\n> scan çš„æŸ¥è¯¢æ–¹å¼æ˜¯å…ˆæ‰«ææ‰€æœ‰æ•°æ®ï¼Œç­›é€‰æ¡ä»¶ä¹Ÿä»…åœ¨æ‰«ææ•´ä¸ªè¡¨åè¿›è¡Œåº”ç”¨ï¼Œæ‰€ä»¥ä¼šå ç”¨å¤§é‡çš„è¯»å–ååé‡ã€‚\n\nä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š\n\n```json\n// Return all of the data in the table\n{\n    TableName:  \"Music\"\n}\n// Return all of the values for Artist and Title\n{\n    TableName:  \"Music\",\n    ProjectionExpression: \"Artist, Title\"\n}\n```\n\nScan æ“ä½œè¿˜æä¾›ä¸€ä¸ª FilterExpression å‚æ•°ä»¥è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®ã€‚åœ¨æ‰«ææ•´ä¸ªè¡¨åä¸”ç»“æœè¿”å›ä¹‹å‰ï¼Œåº”ç”¨ FilterExpressionã€‚ï¼ˆå»ºè®®ä¸è¦å¯¹å¤§å‹è¡¨è¿™æ ·åšï¼šå³ä½¿ä»…è¿”å›å‡ ä¸ªåŒ¹é…é¡¹ç›®ï¼Œä»éœ€ä¸ºæ•´ä¸ª Scan ä»˜è´¹ã€‚ä¼šå ç”¨ååé‡ï¼‰\n\n### Python Example\n\nboto3\n\nè¿”å›Aritist ='No One You Know' å¹¶ä¸” SongTitle å¼€å¤´ä¸ºToday å¹¶ä¸”ä»·æ ¼å°äº1 çš„æ‰€æœ‰æ­Œæ›²ï¼š\n\n```python\nresponse = table.scan(\n    FilterExpression=Attr('Price').lt(2)&Key('Artist').eq('The Acme Band')\n)\nitems = response['Items']\nprint(items)\n\n## output\n[{\n    u'Genre': u'Rock',\n    u'Price': Decimal('0.99'),\n    u'Artist': u'The Acme Band',\n    u'SongTitle': u'Look Out, World',\n    u'AlbumTitle': u'The Buck Starts Here'\n},]\n```\n\nåœ¨ä»£ç ä¸­ï¼Œè¯·æ³¨æ„ä»¥ä¸‹æƒ…å†µï¼š\n\n- ProjectionExpression ç”¨äºæŒ‡å®šè¦åœ¨æ‰«æç»“æœä¸­åŒ…å«çš„å±æ€§ã€‚\n- FilterExpression ç”¨äºæŒ‡å®šä¸€ä¸ªæ¡ä»¶ï¼Œä»¥ä¾¿ä»…è¿”å›ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®ã€‚æ‰€æœ‰å…¶ä»–é¡¹ç›®éƒ½å°†è¢«èˆå¼ƒã€‚\n- scan æ–¹æ³•æ¯æ¬¡è¿”å›é¡¹ç›®çš„ä¸€ä¸ªå­é›†ï¼ˆç§°ä¸ºé¡µé¢ï¼‰ã€‚å“åº”ä¸­çš„ LastEvaluatedKey å€¼éšåé€šè¿‡ ExclusiveStartKey å‚æ•°ä¼ é€’ç»™ scan æ–¹æ³•ã€‚å½“è¿”å›æœ€åä¸€é¡µåï¼ŒLastEvaluatedKey å°†ä¸æ˜¯å“åº”çš„ä¸€éƒ¨åˆ†ã€‚\n\nNote\n\n- ExpressionAttributeNames æä¾›åç§°æ›¿æ¢åŠŸèƒ½ã€‚æˆ‘ä»¬ä½¿ç”¨æ­¤å‚æ•°æ˜¯å› ä¸º year æ˜¯ DynamoDB ä¸­çš„ä¿ç•™å­—ï¼Œæ‚¨ä¸èƒ½ç›´æ¥åœ¨ä»»ä½•è¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒï¼ŒåŒ…æ‹¬ KeyConditionExpressionã€‚æˆ‘ä»¬ä½¿ç”¨è¡¨è¾¾å¼å±æ€§åç§° #yr æ¥è§£å†³æ­¤é—®é¢˜ã€‚\n- ExpressionAttributeValues æä¾›å€¼æ›¿æ¢åŠŸèƒ½ã€‚æˆ‘ä»¬ä½¿ç”¨æ­¤å‚æ•°æ˜¯å› ä¸ºæ‚¨ä¸èƒ½åœ¨ä»»ä½•è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ–‡å­—ï¼ŒåŒ…æ‹¬ KeyConditionExpressionã€‚æˆ‘ä»¬ä½¿ç”¨è¡¨è¾¾å¼å±æ€§å€¼ :yyyy æ¥è§£å†³æ­¤é—®é¢˜ã€‚\n\n> è¿™ä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†DynamoDB queryå’Œscançš„åŸºæœ¬ç”¨æ³•ï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢\n\ntips:\nä»è¿™å‡ ç¯‡çš„ä»‹ç»å¯ä»¥å‘ç°DynamoDBçš„æŸ¥è¯¢è¯­æ³•æ¯”è¾ƒç¹çï¼Œå†™èµ·æ¥éå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘æ¨¡ä»¿sqlalchemy å†™äº†ä¸€ä¸ªormï¼Œæ¬¢è¿ä½¿ç”¨[!https://github.com/gusibi/dynamodb-py](https://github.com/gusibi/dynamodb-py)\n\n[åŸæ–‡åœ°å€](http://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751959&idx=1&sn=ba71eac3e0113239031c326e421015ea&chksm=80b0b83db7c7312b0eaf427dee3abdf6a94a7694d9c58974912db368d88128900da77ab25aba#rd)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨6ï¼šquery å’Œ scan",
        "date": "2017-01-31 09:46:28",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-query-and-scan"
    },
    {
      "content": "\n> ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†é¡¹ç›®çš„æ·»åŠ ã€ä¿®æ”¹ã€è·å–ã€åˆ é™¤ï¼ˆCRUDï¼‰æ“ä½œï¼Œè¿™ä¸€èŠ‚å°†ä»‹ç»ç´¢å¼•çš„åˆ›å»ºåŠç®¡ç†ã€‚\n\n### åˆ›å»ºç´¢å¼•\n\n#### SQL\n\nåœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œç´¢å¼•æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå¯å¯¹è¡¨ä¸­çš„ä¸åŒçš„åˆ—æ‰§è¡Œå¿«é€ŸæŸ¥è¯¢ã€‚å¯ä»¥ä½¿ç”¨ CREATE INDEX SQL è¯­å¥å°†ç´¢å¼•æ·»åŠ åˆ°ç°æœ‰è¡¨ï¼Œå¹¶æŒ‡å®šè¦å»ºç«‹ç´¢å¼•çš„åˆ—ã€‚åœ¨åˆ›å»ºç´¢å¼•åï¼Œå¯ä»¥ç…§å¸¸æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä½†ç°åœ¨æ•°æ®åº“å¯ä½¿ç”¨ç´¢å¼•å¿«é€ŸæŸ¥æ‰¾è¡¨ä¸­çš„æŒ‡å®šè¡Œï¼Œè€Œä¸æ˜¯æ‰«ææ•´ä¸ªè¡¨ã€‚\n\nåœ¨åˆ›å»ºä¸€ä¸ªç´¢å¼•åï¼Œæ•°æ®åº“å°†è‡ªåŠ¨ç»´æŠ¤æ­¤ç´¢å¼•ã€‚åªè¦ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®ï¼Œå°±ä¼šè‡ªåŠ¨æ›´æ”¹ç´¢å¼•ä»¥åæ˜ è¡¨ä¸­çš„æ›´æ”¹ã€‚\n\nHUGOMORE42\n\nåœ¨ MySQL ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¦‚ä¸‹æ‰€ç¤ºçš„ç´¢å¼•ï¼š\n\n```\nCREATE INDEX GenreAndPriceIndex\nON Music (genre, price);\n```\n#### DynamoDB\n\nåœ¨ DynamoDB ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨secondary indexæ¥å®ç°ç±»ä¼¼ç›®çš„ã€‚\n\nDynamoDB ä¸­çš„ç´¢å¼•ä¸å…¶å…³ç³»å¯¹åº”é¡¹ä¸åŒã€‚å½“æˆ‘ä»¬åˆ›å»ºsecondary indexæ—¶ï¼Œå¿…é¡»æŒ‡å®šå…¶é”®å±æ€§ - åˆ†åŒºé”®å’Œæ’åºé”®ã€‚\nåœ¨åˆ›å»ºsecondary indexåï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å®ƒæ‰§è¡Œ Query æˆ– Scan æ“ä½œï¼Œå°±å¦‚åŒå¯¹è¡¨æ‰§è¡Œè¿™äº›æ“ä½œä¸€æ ·ã€‚\nDynamoDB æ²¡æœ‰æŸ¥è¯¢ä¼˜åŒ–ç¨‹åºï¼Œå› æ­¤ï¼Œä»…åœ¨æˆ‘ä»¬å¯¹secondary indexæ‰§è¡Œ Query æˆ– Scan æ“ä½œæ—¶ä½¿ç”¨å®ƒã€‚\n\nDynamoDB æ”¯æŒä¸¤ç§ä¸åŒçš„ç´¢å¼•ï¼š\n\n* å…¨å±€äºŒçº§ç´¢å¼• - ç´¢å¼•çš„ä¸»é”®å¯ä»¥æ˜¯å…¶è¡¨ä¸­çš„ä»»æ„ä¸¤ä¸ªå±æ€§ï¼ˆ**å¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶åˆ›å»ºï¼Œä¹Ÿå¯ä»¥å‘ç°æœ‰è¡¨æ·»åŠ æ–°å…¨å±€äºŒçº§ç´¢å¼•ï¼Œæˆ–è€…åˆ é™¤ç°æœ‰çš„å…¨å±€äºŒçº§ç´¢å¼•**ï¼‰ã€‚\n* æœ¬åœ°äºŒçº§ç´¢å¼• - ç´¢å¼•çš„åˆ†åŒºé”®å¿…é¡»ä¸å…¶è¡¨çš„åˆ†åŒºé”®ç›¸åŒã€‚ä¸è¿‡ï¼Œæ’åºé”®å¯ä»¥æ˜¯ä»»ä½•å…¶ä»–å±æ€§ï¼ˆ**æ˜¯åœ¨åˆ›å»ºè¡¨çš„åŒæ—¶åˆ›å»ºçš„ã€‚ä¸èƒ½å‘ç°æœ‰è¡¨æ·»åŠ æœ¬åœ°äºŒçº§ç´¢å¼•ï¼Œä¹Ÿä¸èƒ½åˆ é™¤å·²å­˜åœ¨çš„ä»»ä½•æœ¬åœ°äºŒçº§ç´¢å¼•**ï¼‰ã€‚\n\n\nDynamoDB ç¡®ä¿secondary indexä¸­çš„æ•°æ®æœ€ç»ˆä¸å…¶è¡¨ä¿æŒä¸€è‡´ã€‚æˆ‘ä»¬å¯ä»¥è¯·æ±‚å¯¹è¡¨æˆ–local secondary index**æ‰§è¡Œå¼ºä¸€è‡´æ€§ Query æˆ– Scan æ“ä½œ**ã€‚ä½†æ˜¯ï¼Œ**å…¨å±€äºŒçº§ç´¢å¼•ä»…æ”¯æŒæœ€ç»ˆä¸€è‡´æ€§**ã€‚\n\nå¯ä½¿ç”¨ UpdateTable æ“ä½œå¹¶æŒ‡å®š GlobalSecondaryIndexUpdates æ¥å°†global secondary indexæ·»åŠ åˆ°ç°æœ‰è¡¨ï¼š\n\n```\n{\n    TableName: \"Music\",\n    AttributeDefinitions:[\n        {AttributeName: \"Genre\", AttributeType: \"S\"},\n        {AttributeName: \"Price\", AttributeType: \"N\"}\n    ],\n    GlobalSecondaryIndexUpdates: [\n        {\n            Create: {\n                IndexName: \"GenreAndPriceIndex\",\n                KeySchema: [\n                    {AttributeName: \"Genre\", KeyType: \"HASH\"}, //Partition key\n                    {AttributeName: \"Price\", KeyType: \"RANGE\"}, //Sort key\n                ],\n                Projection: {\n                    \"ProjectionType\": \"ALL\"\n                },\n                ProvisionedThroughput: {\n                    \"ReadCapacityUnits\": 1,\"WriteCapacityUnits\": 1\n                }\n            }\n        }\n    ]\n}\n```\n\næ·»åŠ ç´¢å¼•æ—¶å¿…é¡»å‘ UpdateTable æä¾›ä»¥ä¸‹å‚æ•°ï¼š\n\n* TableName â€“ ç´¢å¼•å°†å…³è”åˆ°çš„è¡¨ã€‚\n* AttributeDefinitions â€“ ç´¢å¼•çš„é”®æ¶æ„å±æ€§çš„æ•°æ®ç±»å‹ã€‚\n* GlobalSecondaryIndexUpdates â€“ æœ‰å…³è¦åˆ›å»ºçš„ç´¢å¼•çš„è¯¦ç»†ä¿¡æ¯ï¼š\n\n    * IndexName - ç´¢å¼•çš„åç§°ã€‚\n    * KeySchema â€“ ç”¨äºç´¢å¼•ä¸»é”®çš„å±æ€§ã€‚\n    * Projection - è¡¨ä¸­è¦å¤åˆ¶åˆ°ç´¢å¼•çš„å±æ€§ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼ŒALL æ„å‘³ç€å¤åˆ¶æ‰€æœ‰å±æ€§ã€‚\n    * ProvisionedThroughput â€“ æ¯ç§’éœ€å¯¹æ­¤ç´¢å¼•æ‰§è¡Œçš„è¯»å–å’Œå†™å…¥æ¬¡æ•°ã€‚ï¼ˆå®ƒä¸è¡¨çš„é¢„é…ç½®ååé‡è®¾ç½®æ˜¯åˆ†å¼€çš„ã€‚ï¼‰\n\nåœ¨æ­¤æ“ä½œä¸­ï¼Œä¼šå°†è¡¨ä¸­çš„æ•°æ®å›å¡«åˆ°æ–°ç´¢å¼•ã€‚åœ¨å›å¡«æœŸé—´ï¼Œè¡¨ä¿æŒå¯ç”¨ã€‚ä½†ç´¢å¼•æœªå‡†å¤‡å°±ç»ªï¼Œç›´è‡³å…¶ Backfilling å±æ€§ä» true å˜ä¸º falseã€‚æ‚¨å¯ä»¥ä½¿ç”¨ DescribeTable æ“ä½œæŸ¥çœ‹æ­¤å±æ€§ã€‚\n\n#### python ç¤ºä¾‹\n\nboto3\n\n```\nimport boto3\ndb3 = boto3.resource('dynamodb', endpoint_url='http://localhost:8000',  region_name='us-west-2')\n\ntable = db3.meta.client.update_table(\n    TableName='Music',\n    AttributeDefinitions=[\n        {\n            'AttributeName': \"Genre\",\n            'AttributeType': \"S\"\n        },\n        {\n            'AttributeName': \"Price\",\n            'AttributeType': \"N\"\n        }\n    ],\n    GlobalSecondaryIndexUpdates=[\n        {\n            'Create': {\n                'IndexName': \"GenreAndPriceIndex\",\n                'KeySchema': [\n                    {'AttributeName': \"Genre\", 'KeyType': \"HASH\"},  # Partition key\n                    {'AttributeName': \"Price\", 'KeyType': \"RANGE\"}, # Sort key\n                ],\n                'Projection': {\n                    \"ProjectionType\": \"ALL\"\n                },\n                'ProvisionedThroughput': {\n                    \"ReadCapacityUnits\": 10,\"WriteCapacityUnits\": 10\n                }\n            }\n        }\n    ]\n)\n\ndb3.meta.client.describe_table(TableName='Music')\n```\n\n> output\n\n```\n{'ResponseMetadata': {'HTTPHeaders': {'content-length': '1082',\n   'content-type': 'application/x-amz-json-1.0',\n   'server': 'Jetty(8.1.12.v20130726)',\n   'x-amz-crc32': '3717567836',\n   'x-amzn-requestid': 'd63c0176-8257-428b-b6f3-af87219ba45b'},\n  'HTTPStatusCode': 200,\n  'RequestId': 'd63c0176-8257-428b-b6f3-af87219ba45b',\n  'RetryAttempts': 0},\n u'Table': {u'AttributeDefinitions': [{u'AttributeName': u'Artist',\n    u'AttributeType': u'S'},\n   {u'AttributeName': u'Price', u'AttributeType': u'N'},\n   {u'AttributeName': u'SongTitle', u'AttributeType': u'S'},\n   {u'AttributeName': u'Genre', u'AttributeType': u'S'}],\n  u'CreationDateTime': datetime.datetime(2017, 1, 14, 3, 9, 42, 63000, tzinfo=tzlocal()),\n  u'GlobalSecondaryIndexes': [{u'IndexArn': u'arn:aws:dynamodb:ddblocal:000000000000:table/Music/index/GenreAndPriceIndex',\n    u'IndexName': u'GenreAndPriceIndex',\n    u'IndexSizeBytes': 0,\n    u'IndexStatus': u'ACTIVE',\n    u'ItemCount': 0,\n    u'KeySchema': [{u'AttributeName': u'Genre', u'KeyType': u'HASH'},\n     {u'AttributeName': u'Price', u'KeyType': u'RANGE'}],\n    u'Projection': {u'ProjectionType': u'ALL'},\n    u'ProvisionedThroughput': {u'ReadCapacityUnits': 10,\n     u'WriteCapacityUnits': 10}}],\n  u'ItemCount': 0,\n  u'KeySchema': [{u'AttributeName': u'Artist', u'KeyType': u'HASH'},\n   {u'AttributeName': u'SongTitle', u'KeyType': u'RANGE'}],\n  u'ProvisionedThroughput': {u'LastDecreaseDateTime': datetime.datetime(1970, 1, 1, 8, 0, tzinfo=tzlocal()),\n   u'LastIncreaseDateTime': datetime.datetime(1970, 1, 1, 8, 0, tzinfo=tzlocal()),\n   u'NumberOfDecreasesToday': 0,\n   u'ReadCapacityUnits': 10,\n   u'WriteCapacityUnits': 10},\n  u'TableArn': u'arn:aws:dynamodb:ddblocal:000000000000:table/Music',\n  u'TableName': u'Music',\n  u'TableSizeBytes': 0,\n  u'TableStatus': u'ACTIVE'}}\n\n```\n---------\n### ç´¢å¼•æ‰©å±•\n\n### ç®¡ç†ç´¢å¼•\n\nç´¢å¼•å¯ä»¥è®¿é—®æ›¿ä»£æŸ¥è¯¢æ¨¡å¼ï¼Œå¹¶å¯ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚\n\næ— è®ºä½¿ç”¨çš„æ˜¯å…³ç³»æ•°æ®åº“è¿˜æ˜¯ DynamoDBï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶éƒ½åº”è°¨æ…ã€‚åªè¦å¯¹è¡¨è¿›è¡Œå†™å…¥ï¼Œå°±å¿…é¡»æ›´æ–°è¡¨çš„æ‰€æœ‰ç´¢å¼•ã€‚åœ¨å…·æœ‰å¤§å‹è¡¨çš„å†™å…¥å¯†é›†å‹ç¯å¢ƒä¸­ï¼Œè¿™ä¼šå ç”¨å¤§é‡ç³»ç»Ÿèµ„æºã€‚\n\nä¸ºäº†å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œé«˜æ•ˆè®¿é—®ï¼ŒAmazon DynamoDB å¯¹ä¸»é”®å±æ€§åˆ›å»ºå¹¶ç»´æŠ¤ç´¢å¼•ã€‚è¿™å¯ä»¥è®©åº”ç”¨ç¨‹åºé€šè¿‡æŒ‡å®šä¸»é”®å€¼å¿«é€Ÿåœ°æ£€ç´¢æ•°æ®ã€‚\nå¯ä»¥å¯¹è¡¨åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªäºŒçº§ç´¢å¼•ï¼Œç„¶åå¯¹è¿™äº›ç´¢å¼•å‘å‡º Query æˆ– Scan è¯·æ±‚ï¼Œä»¥ä¾¿é€šè¿‡ä¸»é”®ä»¥å¤–çš„å±æ€§å¯¹æ•°æ®è¿›è¡Œé«˜æ•ˆè®¿é—®ã€‚\n\nsecondary index æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒåŒ…å«è¡¨ä¸­å±æ€§çš„å­é›†ä»¥åŠä¸€ä¸ªæ”¯æŒ Query æ“ä½œçš„æ›¿ä»£é”®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Query ä»ç´¢å¼•ä¸­æ£€ç´¢æ•°æ®ï¼Œå…¶æ–¹å¼ä¸å¯¹è¡¨ä½¿ç”¨ Query å¤§è‡´ç›¸åŒã€‚ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªsecondary indexï¼Œè¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®è®¸å¤šä¸åŒçš„æŸ¥è¯¢æ¨¡å¼ã€‚\n\n> ä¹Ÿå¯ä»¥å¯¹ç´¢å¼•ä½¿ç”¨ Scanï¼Œå…¶æ–¹å¼ä¸å¯¹è¡¨ä½¿ç”¨ Scan å¤§è‡´ç›¸åŒã€‚\n\nsecondary indexä¸­çš„æ•°æ®ç”±ä»è¡¨æŠ•å½± æˆ–å¤åˆ¶åˆ°ç´¢å¼•ä¸­çš„å±æ€§ç»„æˆã€‚åœ¨åˆ›å»ºsecondary indexæ—¶ï¼Œå¯ä»¥å®šä¹‰ç´¢å¼•çš„æ›¿ä»£é”®ä»¥åŠè¦åœ¨ç´¢å¼•ä¸­æŠ•å½±çš„ä»»ä½•å…¶ä»–å±æ€§ã€‚DynamoDB å°†è¿™äº›å±æ€§ä¸è¡¨ä¸­çš„ä¸»é”®å±æ€§ä¸€èµ·å¤åˆ¶åˆ°ç´¢å¼•ä¸­ã€‚ç„¶åï¼Œå°±å¯ä»¥åƒæŸ¥è¯¢æˆ–æ‰«æè¡¨ä¸€æ ·æŸ¥è¯¢æˆ–æ‰«æè¯¥ç´¢å¼•ã€‚\n\næ¯ä¸ªsecondary indexéƒ½ç”± DynamoDB è‡ªåŠ¨ç»´æŠ¤ã€‚åœ¨è¡¨ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤é¡¹ç›®æ—¶ï¼Œè¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•ä¹Ÿä¼šæ›´æ–°ã€‚\n\nDynamoDB æ”¯æŒä¸¤ç§secondary indexï¼š\n\n* Global secondary index â€“ å…¶åˆ†åŒºé”®å’Œæ’åºé”®å¯ä»¥ä¸è¡¨ä¸Šçš„åˆ†åŒºé”®å’Œæ’åºé”®ä¸åŒçš„ç´¢å¼•ã€‚global secondary indexè¢«è§†ä¸ºâ€œå…¨å±€â€ï¼Œæ˜¯å› ä¸ºå¯¹ç´¢å¼•è¿›è¡Œçš„æŸ¥è¯¢å¯ä»¥è·¨è¡¨ä¸­æ‰€æœ‰åˆ†åŒºçš„æ‰€æœ‰æ•°æ®ã€‚\n* Local secondary index â€“ ä¸€ç§åˆ†åŒºé”®ä¸è¡¨ä¸­çš„ç›¸åŒä½†æ’åºé”®ä¸è¡¨ä¸­çš„ä¸åŒçš„ç´¢å¼•ã€‚local secondary indexçš„å«ä¹‰æ˜¯â€œæœ¬åœ°â€ï¼Œè¡¨ç¤ºlocal secondary indexçš„æ¯ä¸ªåˆ†åŒºçš„èŒƒå›´éƒ½é™å®šä¸ºå…·æœ‰ç›¸åŒåˆ†åŒºé”®å€¼çš„è¡¨åˆ†åŒºã€‚\n\n\nä¸‹è¡¨æ˜¯global secondary indexä¸local secondary indexçš„ä¸»è¦å·®å¼‚ï¼š\n\n-------\n\næ€§èƒ½ | å…¨å±€äºŒçº§ç´¢å¼•  | æœ¬åœ°äºŒçº§ç´¢å¼•\n---|---|---\né”®æ¶æ„|\tglobal secondary indexçš„**ä¸»é”®å¯ä»¥æ˜¯ç®€å•ä¸»é”®ï¼ˆåˆ†åŒºé”®ï¼‰æˆ–å¤åˆä¸»é”®ï¼ˆåˆ†åŒºé”®å’Œæ’åºé”®ï¼‰**ã€‚\t|local secondary indexçš„**ä¸»é”®å¿…é¡»æ˜¯å¤åˆä¸»é”®**ï¼ˆåˆ†åŒºé”®å’Œæ’åºé”®ï¼‰ã€‚\né”®å±æ€§|\tç´¢å¼•åˆ†åŒºé”®å’Œæ’åºé”®ï¼ˆå¦‚æœæœ‰ï¼‰å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—æˆ–äºŒè¿›åˆ¶ç±»å‹çš„ä»»ä½•è¡¨å±æ€§ã€‚\t|ç´¢å¼•çš„åˆ†åŒºé”®æ˜¯ä¸è¡¨çš„åˆ†åŒºé”®ç›¸åŒçš„å±æ€§ã€‚æ’åºé”®å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—æˆ–äºŒè¿›åˆ¶ç±»å‹çš„ä»»ä½•è¡¨å±æ€§ã€‚\næ¯ä¸ªåˆ†åŒºé”®å€¼çš„å¤§å°é™åˆ¶|\tglobal secondary index**æ²¡æœ‰å¤§å°é™åˆ¶**ã€‚\t|å¯¹äºæ¯ä¸ªåˆ†åŒºé”®å€¼ï¼Œ**æ‰€æœ‰ç´¢å¼•é¡¹ç›®çš„å¤§å°æ€»å’Œå¿…é¡»ä¸º 10GB æˆ–æ›´å°**ã€‚\nåœ¨çº¿ç´¢å¼•æ“ä½œ|\tå¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶åˆ›å»ºGlobal secondary indexã€‚ä¹Ÿå¯ä»¥å‘ç°æœ‰è¡¨æ·»åŠ æ–°global secondary indexï¼Œæˆ–è€…åˆ é™¤ç°æœ‰global secondary indexã€‚|Local secondary indexæ˜¯åœ¨**åˆ›å»ºè¡¨çš„åŒæ—¶åˆ›å»ºçš„**ã€‚ä¸èƒ½å‘ç°æœ‰è¡¨æ·»åŠ local secondary indexï¼Œä¹Ÿä¸èƒ½åˆ é™¤å·²å­˜åœ¨çš„ä»»ä½•local secondary indexã€‚\næŸ¥è¯¢å’Œåˆ†åŒº|\té€šè¿‡global secondary indexï¼Œ**å¯ä»¥è·¨æ‰€æœ‰åˆ†åŒºæŸ¥è¯¢æ•´ä¸ªè¡¨**ã€‚\t|å€ŸåŠ©local secondary indexï¼Œ**å¯ä»¥å¯¹æŸ¥è¯¢ä¸­åˆ†åŒºé”®å€¼æŒ‡å®šçš„å•ä¸ªåˆ†åŒºè¿›è¡ŒæŸ¥è¯¢**ã€‚\nè¯»å–ä¸€è‡´æ€§|\tå¯¹global secondary indexè¿›è¡Œçš„æŸ¥è¯¢**ä»…æ”¯æŒæœ€ç»ˆä¸€è‡´æ€§**ã€‚\t|æŸ¥è¯¢local secondary indexæ—¶ï¼Œ**å¯ä»¥é€‰æ‹©æœ€ç»ˆä¸€è‡´æ€§æˆ–å¼ºä¸€è‡´æ€§**ã€‚\né¢„é…ç½®ååé‡ä½¿ç”¨|\tæ¯ä¸ªglobal secondary indexéƒ½**æœ‰è‡ªå·±çš„ç”¨äºè¯»å–å’Œå†™å…¥æ´»åŠ¨çš„é¢„é…ç½®ååé‡è®¾ç½®**ã€‚å¯¹global secondary indexè¿›è¡Œçš„æŸ¥è¯¢æˆ–æ‰«æä¼šå ç”¨ç´¢å¼•ï¼ˆè€Œéè¡¨ï¼‰çš„å®¹é‡å•ä½ã€‚global secondary indexæ›´æ–°ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºä¼šè¿›è¡Œè¡¨å†™å…¥ã€‚\t|å¯¹local secondary indexè¿›è¡Œçš„æŸ¥è¯¢æˆ–æ‰«æ**ä¼šå ç”¨è¡¨çš„è¯»å–å®¹é‡å•ä½**ã€‚å‘è¡¨å†™å…¥æ—¶ï¼Œå…¶local secondary indexä¹Ÿä¼šæ›´æ–°ï¼›è¿™äº›æ›´æ–°ä¼šå ç”¨è¡¨çš„å†™å…¥å®¹é‡å•ä½ã€‚\næŠ•å½±å±æ€§|\tå¯¹äºglobal secondary indexæŸ¥è¯¢æˆ–æ‰«æï¼Œ**åªèƒ½è¯·æ±‚æŠ•å½±åˆ°ç´¢å¼•ä¸­çš„å±æ€§**ã€‚DynamoDB ä¸ä»è¡¨æå–ä»»ä½•å±æ€§ã€‚\t|å¦‚æœæ‚¨æŸ¥è¯¢æˆ–æ‰«ælocal secondary indexï¼Œå¯ä»¥**è¯·æ±‚æœªæŠ•å½±åˆ°ç´¢å¼•ä¸­çš„å±æ€§**ã€‚DynamoDB è‡ªåŠ¨ä»è¡¨æå–è¿™äº›å±æ€§ã€‚\n\n-------\n\n> å¦‚æœè¦åˆ›å»ºå¤šä¸ªå«æœ‰secondary indexçš„è¡¨ï¼Œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œæ­¤æ“ä½œã€‚ä¾‹å¦‚ï¼Œå…ˆåˆ›å»ºç¬¬ä¸€ä¸ªè¡¨ï¼Œç­‰å¾…å…¶çŠ¶æ€å˜ä¸º ACTIVEï¼Œåˆ›å»ºä¸‹ä¸€ä¸ªè¡¨ï¼Œç­‰å¾…å…¶çŠ¶æ€å˜ä¸º ACTIVEï¼Œä¾æ­¤ç±»æ¨ã€‚å¦‚æœæˆ‘ä»¬å°è¯•åŒæ—¶åˆ›å»ºå¤šä¸ªå«æœ‰secondary indexçš„è¡¨ï¼ŒDynamoDB ä¼šè¿”å› LimitExceededExceptionã€‚\n\nå¯¹äºæ¯ä¸ªsecondary indexï¼Œå¿…é¡»æŒ‡å®šä»¥ä¸‹å†…å®¹ï¼š\n\n* è¦åˆ›å»ºçš„ç´¢å¼•çš„ç±»å‹ â€“ global secondary indexæˆ–local secondary indexã€‚\n* ç´¢å¼•çš„åç§°ã€‚ç´¢å¼•çš„å‘½åè§„åˆ™ä¸è¡¨çš„å‘½åè§„åˆ™ç›¸åŒï¼Œå¯¹äºå¬ä¸€ä¸ªè¡¨çš„ä¸åŒç´¢å¼•ï¼Œç´¢åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸è¿‡ï¼Œä¸ä¸åŒçš„è¡¨çš„ç´¢å¼•çš„åç§°å¯ä»¥ç›¸åŒã€‚\n* ç´¢å¼•çš„é”®æ¶æ„ã€‚ç´¢å¼•é”®æ¶æ„ä¸­çš„æ¯ä¸ªå±æ€§å¿…é¡»æ˜¯ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€æ•°å­—æˆ–äºŒè¿›åˆ¶çš„é¡¶çº§å±æ€§ã€‚å…¶ä»–æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ–‡æ¡£å’Œé›†ï¼Œå‡ä¸å—æ”¯æŒã€‚é”®æ¶æ„çš„å…¶ä»–è¦æ±‚å–å†³äºç´¢å¼•çš„ç±»å‹ï¼š\n    * å¯¹äºglobal secondary indexï¼Œåˆ†åŒºé”®å¯ä»¥æ˜¯ä»»ä½•æ ‡é‡è¡¨å±æ€§ã€‚æ’åºé”®æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»ä½•æ ‡é‡è¡¨å±æ€§ã€‚\n    * å¯¹äºlocal secondary indexï¼Œåˆ†åŒºé”®å¿…é¡»ä¸è¡¨çš„åˆ†åŒºé”®ç›¸åŒï¼Œæ’åºé”®å¿…é¡»æ˜¯éé”®è¡¨å±æ€§ã€‚\n* ä»è¡¨æŠ•å½±åˆ°ç´¢å¼•ä¸­çš„å…¶ä»–å±æ€§ï¼ˆå¦‚æœæœ‰ï¼‰å¿…é¡»æ˜¯é™¤è¡¨é”®å±æ€§ä¹‹å¤–çš„å±æ€§ã€‚ï¼ˆè¡¨é”®å±æ€§ä¼šè‡ªåŠ¨æŠ•å½±åˆ°æ¯ä¸ªç´¢å¼•ï¼‰\n* ç´¢å¼•çš„é¢„é…ç½®ååé‡è®¾ç½®ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ï¼š\n    * å¯¹äºglobal secondary indexï¼Œå¿…é¡»æŒ‡å®šè¯»å–å’Œå†™å…¥å®¹é‡å•ä½è®¾ç½®ã€‚è¿™äº›é¢„é…ç½®ååé‡è®¾ç½®ç‹¬ç«‹äºè¡¨çš„è®¾ç½®ã€‚\n    * å¯¹äºlocal secondary indexï¼Œæ— éœ€æŒ‡å®šè¯»å–å’Œå†™å…¥å®¹é‡å•ä½è®¾ç½®ã€‚å¯¹local secondary indexè¿›è¡Œçš„è¯»å–å’Œå†™å…¥æ“ä½œä¼šå ç”¨å…¶çˆ¶è¡¨çš„é¢„é…ç½®ååé‡è®¾ç½®ã€‚\n\n> ä¸ºè·å¾—æœ€å¤§æŸ¥è¯¢çµæ´»æ€§ï¼Œæ‚¨å¯ä»¥ä¸ºæ¯ä¸ªè¡¨åˆ›å»ºæœ€å¤š 5 ä¸ª global secondary indexå’Œæœ€å¤š 5 ä¸ªlocal secondary indexã€‚\n\nå¯ä»¥ä½¿ç”¨ DescribeTable æ“ä½œè·å–è¡¨ä¸Šsecondary indexçš„è¯¦ç»†åˆ—è¡¨ã€‚DescribeTable è¿”å›è¡¨ä¸Šæ¯ä¸ªsecondary indexçš„åç§°ã€å­˜å‚¨å¤§å°å’Œé¡¹ç›®æ•°ã€‚**ç³»ç»Ÿå¹¶ä¸ä¼šå®æ—¶æ›´æ–°è¿™äº›å€¼ï¼Œä½†ä¼šå¤§çº¦æ¯éš”å…­ä¸ªå°æ—¶åˆ·æ–°ä¸€æ¬¡**ã€‚\n\n[åŸæ–‡åœ°å€](http://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751953&idx=1&sn=13195866ffc6106d90bb60df86347101&chksm=80b0b83bb7c7312d00c186d2603835ff7f49a6c0fb77c1c94c3ee7cd30b45f7661c7b8c03e42#rd)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨5ï¼šç´¢å¼•åˆ›å»ºåŠç®¡ç†",
        "date": "2017-01-18 13:55:39",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-Indexes"
    },
    {
      "content": "\n> ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†DynamoDB è¡¨çš„æ“ä½œï¼Œè¿™ä¸€èŠ‚å°†ä»‹ç»é¡¹ç›®çš„æ·»åŠ  ä¿®æ”¹ è·å– åˆ é™¤æ“ä½œã€‚\n\n## åˆ›å»ºé¡¹ç›®\n\nAmazon DynamoDB æä¾›äº† PutItem å’Œ BatchWriteItem ä¸¤ç§æ–¹å¼å†™å…¥æ•°æ®\n\n### æ·»åŠ å•ä¸ªé¡¹ç›®\n\nåœ¨ Amazon DynamoDB ä¸­ï¼Œä½¿ç”¨ PutItem æ“ä½œå‘è¡¨æ·»åŠ é¡¹ç›®ï¼š\n\nHUGOMORE42\n\n```\n{\n    TableName: \"Music\",\n    Item: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\",\n        \"AlbumTitle\":\"Somewhat Famous\",\n        \"Year\": 2015,\n        \"Price\": 2.14,\n        \"Genre\": \"Country\",\n        \"Tags\": {\n            \"Composers\": [\n                  \"Smith\",\n                  \"Jones\",\n                  \"Davis\"\n            ],\n            \"LengthInSeconds\": 214\n        }\n    }\n}\n```\n\næ­¤è¡¨çš„ä¸»é”®åŒ…å« Artist å’Œ SongTitleã€‚æ‚¨å¿…é¡»ä¸ºè¿™äº›å±æ€§æŒ‡å®šå€¼ã€‚\nä»¥ä¸‹æ˜¯è¦äº†è§£çš„æœ‰å…³æ­¤ PutItem ç¤ºä¾‹çš„å‡ ä¸ªå…³é”®äº‹é¡¹ï¼š\n\n* DynamoDB ä½¿ç”¨ JSON æä¾›å¯¹æ–‡æ¡£çš„æœ¬æœºæ”¯æŒã€‚è¿™ä½¿å¾— DynamoDB éå¸¸é€‚åˆå­˜å‚¨åŠç»“æ„åŒ–æ•°æ®ï¼Œä¾‹å¦‚ Tagsã€‚æ‚¨ä¹Ÿå¯ä»¥ä» JSON æ–‡æ¡£ä¸­æ£€ç´¢å’Œæ“ä½œæ•°æ®ã€‚\n\n* é™¤äº†ä¸»é”®ï¼ˆArtist å’Œ SongTitleï¼‰ï¼ŒMusic è¡¨æ²¡æœ‰é¢„å®šä¹‰çš„å±æ€§ã€‚\n\n* å¤§å¤šæ•° SQL æ•°æ®åº“æ˜¯é¢å‘äº‹åŠ¡çš„ã€‚å½“æ‚¨å‘å‡º INSERT è¯­å¥æ—¶ï¼Œæ•°æ®ä¿®æ”¹ä¸æ˜¯æ°¸ä¹…æ€§çš„ï¼Œç›´è‡³æ‚¨å‘å‡º COMMIT è¯­å¥ã€‚åˆ©ç”¨ Amazon DynamoDBï¼Œå½“ DynamoDB é€šè¿‡ HTTP 200 çŠ¶æ€ä»£ç  (OK) è¿›è¡Œå›å¤æ—¶ï¼ŒPutItem æ“ä½œçš„æ•ˆæœæ˜¯æ°¸ä¹…æ€§çš„ã€‚\n\n\n#### Python Example\n\nboto3\n\n```\n# ...\ntable = db3.Table('Music')\ntable.put_item(\n      Item = {\n        \"Artist\": \"No One You Know\",\n        \"SongTitle\": \"My Dog Spot\",\n        \"AlbumTitle\": \"Hey Now\",\n        \"Price\": Decimal('1.98'),\n        \"Genre\": \"Country\",\n        \"CriticRating\": Decimal('8.4')\n    }\n)\n\nOut[98]:\n{'ResponseMetadata': {'HTTPHeaders': {'content-length': '2',\n   'content-type': 'application/x-amz-json-1.0',\n   'server': 'Jetty(8.1.12.v20130726)',\n   'x-amz-crc32': '2745614147',\n   'x-amzn-requestid': 'c7c6be12-9752-403f-97b1-a9ac451a0a98'},\n  'HTTPStatusCode': 200,\n  'RequestId': 'c7c6be12-9752-403f-97b1-a9ac451a0a98',\n  'RetryAttempts': 0}}\n\ntable.put_item(\n      Item = {\n        \"Artist\": \"No One You Know\",\n        \"SongTitle\": \"Somewhere Down The Road\",\n        \"AlbumTitle\":\"Somewhat Famous\",\n        \"Genre\": \"Country\",\n        \"CriticRating\": Decimal('8.4'),\n        \"Year\": 1984\n    }\n)\ntable.put_item(\n      Item = {\n        \"Artist\": \"The Acme Band\",\n        \"SongTitle\": \"Still In Love\",\n        \"AlbumTitle\":\"The Buck Starts Here\",\n        \"Price\": Decimal('2.47'),\n        \"Genre\": \"Rock\",\n        \"PromotionInfo\": {\n            \"RadioStationsPlaying\":[\n                 \"KHCR\", \"KBQX\", \"WTNR\", \"WJJH\"\n            ],\n            \"TourDates\": {\n                \"Seattle\": \"20150625\",\n                \"Cleveland\": \"20150630\"\n            },\n            \"Rotation\": \"Heavy\"\n        }\n    }\n)\n\ntable.put_item(\n      Item = {\n        \"Artist\": \"The Acme Band\",\n        \"SongTitle\": \"Look Out, World\",\n        \"AlbumTitle\":\"The Buck Starts Here\",\n        \"Price\": Decimal('0.99'),\n        \"Genre\": \"Rock\"\n    }\n)\n\n```\nNote\n\n* PutItem æ˜¯è¦†ç›–æ“ä½œï¼Œå¦‚æœä¸»é”®ç›¸åŒï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œå°†è¦†ç›–æ‰ä¹‹å‰çš„æ•°æ®\n* é™¤äº† PutItem ä¹‹å¤–ï¼ŒAmazon DynamoDB è¿˜æ”¯æŒåŒæ—¶å†™å…¥å¤šä¸ªï¼ˆæœ€å¤š25ä¸ªï¼‰é¡¹ç›®çš„ BatchWriteItem æ“ä½œã€‚\n\n### æ·»åŠ å¤šä¸ªé¡¹ç›®\n\n#### Python Example\n\nboto3\n\n```\n# ...\ntable = db3.Table('Music')\n\nwith table.batch_writer() as batch:\n    batch.put_item(\n        Item = {\n            \"Artist\": \"The Acme Band\",\n            \"SongTitle\": \"Look Out, World\",\n            \"AlbumTitle\":\"The Buck Starts Here\",\n            \"Price\": Decimal('0.99'),\n            \"Genre\": \"Rock\"\n        }\n    )\n    batch.put_item(\n        Item = {\n            \"Artist\": \"The Acme Band 0\",\n            \"SongTitle\": \"Look Out, World\",\n            \"AlbumTitle\":\"The Buck Starts Here\",\n            \"Price\": Decimal('1.99'),\n            \"Genre\": \"Rock\"\n        }\n    )\n    batch.put_item(\n        Item = {\n            \"Artist\": \"The Acme Band 1\",\n            \"SongTitle\": \"Look Out, World\",\n            \"AlbumTitle\":\"The Buck Starts Here\",\n            \"Price\": Decimal('2.99'),\n            \"Genre\": \"Rock\"\n        }\n    )\n    batch.put_item(\n        Item = {\n            \"Artist\": \"The Acme Band 1\",\n            \"SongTitle\": \"Look Out, World\",\n            \"AlbumTitle\":\"The Buck Starts Here\",\n        }\n    )\n```\n\nBatchWriteItem ä½¿ç”¨ overwrite_by_pkeys=['partition_key','sort_key'] å‚æ•°å»é™¤é¡¹ç›®ä¸­é‡å¤çš„éƒ¨åˆ†ã€‚\n\n```\nwith table.batch_writer(overwrite_by_pkeys=['partition_key', 'sort_key']) as batch:\n    batch.put_item(\n        Item={\n            'partition_key': 'p1',\n            'sort_key': 's1',\n            'other': '111',\n        }\n    )\n    batch.put_item(\n        Item={\n            'partition_key': 'p1',\n            'sort_key': 's1',\n            'other': '222',\n        }\n    )\n```\nå»é‡åï¼Œç­‰åŒäº:\n\n```\nwith table.batch_writer(overwrite_by_pkeys=['partition_key', 'sort_key']) as batch:\n    batch.put_item(\n        Item={\n            'partition_key': 'p1',\n            'sort_key': 's1',\n            'other': '222',\n        }\n    )\n```\n\n\n## è¯»å–æ•°æ®\n\n\nåˆ©ç”¨ SQLï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SELECT è¯­å¥ä»è¡¨ä¸­æ£€ç´¢ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œã€‚å¯ä½¿ç”¨ WHERE å­å¥æ¥ç¡®å®šè¿”å›ç»™æ‚¨çš„æ•°æ®\n\nDynamoDB æä¾›ä»¥ä¸‹æ“ä½œæ¥è¯»å–æ•°æ®ï¼š\n\n* GetItem - ä»è¡¨ä¸­æ£€ç´¢å•ä¸ªé¡¹ç›®ã€‚è¿™æ˜¯è¯»å–å•ä¸ªé¡¹ç›®çš„æœ€é«˜æ•ˆæ–¹å¼ï¼Œå› ä¸ºå®ƒå°†æä¾›å¯¹é¡¹ç›®çš„ç‰©ç†ä½ç½®çš„ç›´æ¥è®¿é—®ã€‚ï¼ˆDynamoDB è¿˜æä¾› BatchGetItem æ“ä½œï¼Œåœ¨å•ä¸ªæ“ä½œä¸­æ‰§è¡Œæœ€å¤š 100 ä¸ª GetItem è°ƒç”¨ã€‚ï¼‰\n* Query - æ£€ç´¢å…·æœ‰ç‰¹å®šåˆ†åŒºé”®çš„æ‰€æœ‰é¡¹ç›®ã€‚åœ¨è¿™äº›é¡¹ç›®ä¸­ï¼Œæ‚¨å¯ä»¥å°†æ¡ä»¶åº”ç”¨äºæ’åºé”®å¹¶ä»…æ£€ç´¢ä¸€éƒ¨åˆ†æ•°æ®ã€‚Queryæä¾›å¯¹å­˜å‚¨æ•°æ®çš„åˆ†åŒºçš„å¿«é€Ÿé«˜æ•ˆçš„è®¿é—®ã€‚\n* Scan - æ£€ç´¢æŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰é¡¹ç›®ã€‚\n\nNote\n\nåˆ©ç”¨å…³ç³»æ•°æ®åº“ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SELECT è¯­å¥è”æ¥å¤šä¸ªè¡¨ä¸­çš„æ•°æ®å¹¶è¿”å›ç»“æœã€‚è”æ¥æ˜¯å…³ç³»æ¨¡å‹çš„åŸºç¡€ã€‚è¦ç¡®ä¿è”æ¥é«˜æ•ˆæ‰§è¡Œï¼Œåº”æŒç»­ä¼˜åŒ–æ•°æ®åº“åŠå…¶åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚\nDynamoDB æ˜¯ä¸€ä¸ªéå…³ç³» NoSQL æ•°æ®åº“ä¸”ä¸æ”¯æŒè¡¨è”æ¥ã€‚ç›¸åï¼Œåº”ç”¨ç¨‹åºä¸€æ¬¡ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–æ•°æ®ã€‚\n\n### ä½¿ç”¨é¡¹ç›®çš„ä¸»é”®è¯»å–é¡¹ç›®\n\nDynamoDB æä¾› GetItem æ“ä½œæ¥æŒ‰é¡¹ç›®çš„ä¸»é”®æ£€ç´¢é¡¹ç›®ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒGetItem å°†è¿”å›æ•´ä¸ªé¡¹ç›®åŠå…¶æ‰€æœ‰å±æ€§ã€‚\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\": \"No One You Know\",\n        \"SongTitle\": \"Call Me Today\"\n    }\n}\n```\n\nå¯ä»¥æ·»åŠ  ProjectionExpression å‚æ•°ä»¥ä»…è¿”å›ä¸€äº›å±æ€§ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\": \"No One You Know\",\n        \"SongTitle\": \"Call Me Today\"\n    },\n    \"ProjectionExpression\": \"AlbumTitle, Price\"\n}\n```\n\n* DynamoDB GetItem æ“ä½œéå¸¸é«˜æ•ˆï¼šæ­¤æ“ä½œä½¿ç”¨ä¸»é”®å€¼ç¡®å®šç›¸å…³é¡¹ç›®çš„å‡†ç¡®å­˜å‚¨ä½ç½®ï¼Œå¹¶ç›´æ¥æ­¤ä½ç½®æ£€ç´¢è¯¥é¡¹ç›®ã€‚\n* SQL SELECT è¯­å¥æ”¯æŒå¤šç§æŸ¥è¯¢å’Œè¡¨æ‰«æã€‚DynamoDB é€šè¿‡å…¶ Query å’Œ Scan æ“ä½œæä¾›ç›¸ä¼¼åŠŸèƒ½ï¼Œå¦‚æŸ¥è¯¢è¡¨å’Œæ‰«æè¡¨ä¸­æ‰€è¿°ã€‚\n* SQL SELECT è¯­å¥å¯æ‰§è¡Œè¡¨è”æ¥ï¼Œè¿™å…è®¸æ‚¨åŒæ—¶ä»å¤šä¸ªè¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚DynamoDB æ˜¯ä¸€ä¸ªéå…³ç³»æ•°æ®åº“ã€‚å› æ­¤ï¼Œå®ƒä¸æ”¯æŒè¡¨è”æ¥ã€‚\n\n> Query å’Œ Scan æ“ä½œå°†åœ¨ä¹‹åçš„ç« èŠ‚è¯¦ç»†ä»‹ç»ã€‚\n\n#### Python Example\n\nboto3\n\n```\n# ...\ntable = db3.Table('Music')\nresponse = table.get_item(\n    Key={\n        \"Artist\": \"The Acme Band\",\n        \"SongTitle\": \"Still In Love\"\n    }\n)\nitem = response['Item']\nprint(item)\n\n# output\n{\n        \"Artist\": \"The Acme Band\",\n        \"SongTitle\": \"Still In Love\",\n        \"AlbumTitle\":\"The Buck Starts Here\",\n        \"Price\": Decimal('2.47'),\n        \"Genre\": \"Rock\",\n        \"PromotionInfo\": {\n            \"RadioStationsPlaying\":[\n                 \"KHCR\", \"KBQX\", \"WTNR\", \"WJJH\"\n            ],\n            \"TourDates\": {\n                \"Seattle\": \"20150625\",\n                \"Cleveland\": \"20150630\"\n            },\n            \"Rotation\": \"Heavy\"\n        }\n    }\n\nresponse = table.get_item(\n    Key={\n        \"Artist\": \"The Acme Band\",\n        \"SongTitle\": \"Still In Love\"\n    },\n    ProjectionExpression = \"AlbumTitle, Price\"\n)\nitem = response['Item']\nprint(item)\n{\n    'AlbumTitle': u'The Buck Starts Here',\n    'Price': Decimal('2.47')\n}\n```\n## æ›´æ–°\n\nSQL è¯­è¨€æä¾›ç”¨äºä¿®æ”¹æ•°æ®çš„ UPDATE è¯­å¥ã€‚DynamoDB ä½¿ç”¨ UpdateItem æ“ä½œå®Œæˆç±»ä¼¼çš„ä»»åŠ¡ã€‚\n\nåœ¨ DynamoDB ä¸­ï¼Œå¯ä½¿ç”¨ UpdateItem æ“ä½œä¿®æ”¹å•ä¸ªé¡¹ç›®ã€‚ï¼ˆå¦‚æœè¦ä¿®æ”¹å¤šä¸ªé¡¹ç›®ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¤šä¸ª UpdateItem æ“ä½œã€‚ï¼‰\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET RecordLabel = :label\",\n    ExpressionAttributeValues: {\n        \":label\": \"Global Records\"\n    }\n}\n```\n\n* å¿…é¡»æŒ‡å®šè¦ä¿®æ”¹çš„é¡¹ç›®çš„ Key å±æ€§å’Œä¸€ä¸ªç”¨äºæŒ‡å®šå±æ€§å€¼çš„ UpdateExpressionã€‚\n* UpdateItem æ›¿æ¢æ•´ä¸ªé¡¹ç›®ï¼Œè€Œä¸æ˜¯æ›¿æ¢å•ä¸ªå±æ€§ã€‚\n* UpdateItem çš„è¡Œä¸ºä¸**â€œupsertâ€æ“ä½œçš„è¡Œä¸ºç±»ä¼¼**ï¼šå¦‚æœé¡¹ç›®ä½äºè¡¨ä¸­ï¼Œåˆ™æ›´æ–°é¡¹ç›®ï¼Œå¦åˆ™æ·»åŠ ï¼ˆæ’å…¥ï¼‰æ–°é¡¹ç›®ã€‚\n* UpdateItem æ”¯æŒæ¡ä»¶å†™å…¥ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œæ“ä½œä»…åœ¨ç‰¹å®š ConditionExpression çš„è®¡ç®—ç»“æœä¸º true æ—¶æˆåŠŸå®Œæˆ\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET RecordLabel = :label\",\n    ConditionExpression: \"Price >= :p\",\n    ExpressionAttributeValues: {\n        \":label\": \"Global Records\",\n        \":p\": 2.00\n    }\n}\n```\n\n* UpdateItem è¿˜æ”¯æŒåŸå­è®¡æ•°å™¨æˆ–ç±»å‹ä¸º Number çš„å±æ€§ï¼ˆå¯é€’å¢æˆ–é€’å‡ï¼‰ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ª UpdateItem æ“ä½œçš„ç¤ºä¾‹ï¼Œå®ƒåˆå§‹åŒ–ä¸€ä¸ªæ–°å±æ€§ (Plays) æ¥è·Ÿè¸ªæ­Œæ›²çš„å·²æ’­æ”¾æ¬¡æ•°ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET Plays = :val\",\n    ExpressionAttributeValues: {\n        \":val\": 0\n    },\n    ReturnValues: \"UPDATED_NEW\"\n}\n\n```\n\nReturnValues å‚æ•°è®¾ç½®ä¸º UPDATED_NEWï¼Œè¿™å°†è¿”å›å·²æ›´æ–°çš„ä»»ä½•å±æ€§çš„æ–°å€¼ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå®ƒè¿”å› 0ï¼ˆé›¶ï¼‰ã€‚\n\nå½“æŸäººæ’­æ”¾æ­¤æ­Œæ›²æ—¶ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹ UpdateItem æ“ä½œæ¥å°† Plays å¢åŠ  1ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression: \"SET Plays = Plays + :incr\",\n    ExpressionAttributeValues: {\n        \":incr\": 1\n    },\n    ReturnValues: \"UPDATED_NEW\"\n}\n```\n#### Python Example\n\nboto3\nä½¿ç”¨ UpdateItem æ“ä½œä¿®æ”¹å•ä¸ªé¡¹ç›®\n\n```\nimport boto3\nimport json\nimport decimal\n\nclass DecimalEncoder(json.JSONEncoder):\n    def default(self, o):\n        if isinstance(o, decimal.Decimal):\n            if o % 1 > 0:\n                return float(o)\n            else:\n                return int(o)\n        return super(DecimalEncoder, self).default(o)\n\ndb3 = boto3.resource('dynamodb', region_name='us-west-2', endpoint_url=\"http://localhost:8000\")\n\ntable = db3.Table('Music')\n\nresponse = table.update_item(\n    Key={\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression=\"SET RecordLabel = :label\",\n    ExpressionAttributeValues={\n        \":label\": \"Global Records\"\n    },\n    ReturnValues=\"UPDATED_NEW\"\n)\n\nprint(json.dumps(response, indent=4, cls=DecimalEncoder))\n```\n\nUpdateItem æ¡ä»¶å†™å…¥ ä»·æ ¼å¤§äºæˆ–ç­‰äº 2.00 UpdateItem æ‰§è¡Œæ›´æ–°\n\n```\ntable = db3.Table('Music')\n\nresponse = table.update_item(\n    Key={\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression=\"SET RecordLabel = :label\",\n    ConditionExpression=\"Price >= :p\",\n    ExpressionAttributeValues={\n        \":label\": \"Global Records\",\n        \":p\": 2.00\n    },\n    ReturnValues=\"UPDATED_NEW\"\n)\n\n```\nUpdateItem æ“ä½œçš„ç¤ºä¾‹ï¼Œå®ƒåˆå§‹åŒ–ä¸€ä¸ªæ–°å±æ€§ (Plays) æ¥è·Ÿè¸ªæ­Œæ›²çš„å·²æ’­æ”¾æ¬¡æ•°\n\n```\ntable = db3.Table('Music')\n\nresponse = table.update_item(\n    Key={\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression=\"SET Plays = :val\",\n    ExpressionAttributeValues={\n        \":val\": 0\n    },\n    ReturnValues=\"UPDATED_NEW\"\n)\n\n```\nä½¿ç”¨ UpdateItem æ“ä½œæ¥å°† Plays å¢åŠ  1\n\n```\ntable = db3.Table('Music')\n\nresponse = table.update_item(\n    Key={\n        \"Artist\":\"No One You Know\",\n        \"SongTitle\":\"Call Me Today\"\n    },\n    UpdateExpression=\"SET Plays = Plays + :incr\",\n    ExpressionAttributeValues={\n        \":incr\": 1\n    },\n    ReturnValues=\"UPDATED_NEW\"\n)\n\n```\n\n## åˆ é™¤é¡¹ç›®\n\nåœ¨ SQL ä¸­ï¼ŒDELETE è¯­å¥ä»è¡¨ä¸­åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œã€‚DynamoDB ä½¿ç”¨ DeleteItem æ“ä½œä¸€æ¬¡åˆ é™¤ä¸€ä¸ªé¡¹ç›®ã€‚\n\nåœ¨ DynamoDB ä¸­ï¼Œå¯ä½¿ç”¨ DeleteItem æ“ä½œä»è¡¨ä¸­åˆ é™¤æ•°æ®ï¼ˆä¸€æ¬¡åˆ é™¤ä¸€ä¸ªé¡¹ç›®ï¼‰ã€‚æ‚¨å¿…é¡»æŒ‡å®šé¡¹ç›®çš„ä¸»é”®å€¼ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        Artist: \"The Acme Band\",\n        SongTitle: \"Look Out, World\"\n    }\n}\n```\n\nNote\n\né™¤äº† DeleteItem ä¹‹å¤–ï¼ŒAmazon DynamoDB è¿˜æ”¯æŒåŒæ—¶åˆ é™¤å¤šä¸ªé¡¹ç›®çš„ BatchWriteItem æ“ä½œã€‚\n\nDeleteItem æ”¯æŒæ¡ä»¶å†™å…¥ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œæ“ä½œä»…åœ¨ç‰¹å®š ConditionExpression çš„è®¡ç®—ç»“æœä¸º true æ—¶æˆåŠŸå®Œæˆã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ DeleteItem æ“ä½œä»…åœ¨é¡¹ç›®å…·æœ‰ RecordLabel å±æ€§æ—¶åˆ é™¤é¡¹ç›®ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        Artist: \"The Acme Band\",\n        SongTitle: \"Look Out, World\"\n    },\n   ConditionExpression: \"attribute_exists(RecordLabel)\"\n}\n```\n\n#### Python Example\n\nboto3\n\n```\ntable = db3.Table('Music')\ntable.delete_item(\n    Key={\n        'AlbumTitle': 'Hey Now'\n        'Artist': 'No One You Know'\n    }\n)\n\n```\n\n> è¿™ä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†é¡¹ç›®çš„åŸºæœ¬æ“ä½œï¼ˆCRUDï¼‰ï¼Œä¸‹ä¸€èŠ‚å°†ä»‹ç»ç´¢å¼•çš„åˆ›å»ºå’Œç®¡ç†ã€‚\n\n[åŸæ–‡åœ°å€](http://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751948&idx=1&sn=22046f0c62fa0e3a740306b5f106488a&chksm=80b0b826b7c73130e0f65057f83aebea9b41c5edcdccd3230a07fe24f5864c5ed11e89f0ae05#rd)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨4ï¼šé¡¹ç›®çš„åŸºæœ¬æ“ä½œï¼ˆCRUDï¼‰",
        "date": "2017-01-18 13:53:38",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-Item-CRUD"
    },
    {
      "content": "\n> ä¹‹å‰ä¸¤ç¯‡æ–‡ç« ä»‹ç»äº†DynamoDBå¦‚ä½•åœ¨æœ¬åœ°å®‰è£…ä»¥åŠåŸºæœ¬çš„å·¥ä½œåŸç†å’ŒAPIï¼Œè¿™ä¸€èŠ‚ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨DynamoDBã€‚\n\nåŸºæœ¬çš„DynamoDB æ“ä½œåŒ…æ‹¬è¡¨æ“ä½œã€é¡¹ç›®æ“ä½œå’Œç´¢å¼•ç®¡ç†ã€‚\n\né¦–å…ˆæ˜¯é“¾æ¥æ•°æ®åº“ã€‚å’Œå…³ç³»å‹æ•°æ®åº“ä¸åŒï¼Œ**DynamoDB æ˜¯ä¸€é¡¹ Web æœåŠ¡ï¼Œä¸å…¶è¿›è¡Œçš„äº¤äº’æ˜¯æ— çŠ¶æ€çš„ã€‚åº”ç”¨ç¨‹åºä¸éœ€è¦ç»´æŠ¤æŒä¹…æ€§ç½‘ç»œè¿æ¥ã€‚ç›¸åï¼Œä¸ DynamoDB çš„äº¤äº’æ˜¯é€šè¿‡ HTTP(S) è¯·æ±‚å’Œå“åº”è¿›è¡Œçš„ã€‚**\n\nHUGOMORE42\n\næ‰§è¡ŒæŸé¡¹æ“ä½œçš„æ­¥éª¤ä¸ºï¼š\n\n1. **åº”ç”¨ç¨‹åºå°† HTTP(S) è¯·æ±‚å‘é€åˆ° DynamoDBã€‚è¯¥è¯·æ±‚åŒ…å«è¦æ‰§è¡Œçš„ DynamoDB æ“ä½œçš„åç§°å’Œå‚æ•°ã€‚DynamoDB å°†ç«‹å³æ‰§è¡Œè¯·æ±‚ã€‚**\n2. **DynamoDB è¿”å›ä¸€ä¸ªåŒ…å«æ“ä½œç»“æœçš„ HTTP(S) å“åº”ã€‚å¦‚æœå‡ºé”™ï¼ŒDynamoDB å°†è¿”å› HTTP é”™è¯¯çŠ¶æ€å’Œæ¶ˆæ¯ã€‚**\n\nå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¼–å†™åº”ç”¨ç¨‹åºä»£ç è®¿é—®DynamoDBã€‚åŒæ—¶è¿˜å¯ä»¥ä½¿ç”¨ AWS ç®¡ç†æ§åˆ¶å°æˆ– AWS Command Line Interface (AWS CLI) å‘ DynamoDB å‘é€ä¸´æ—¶è¯·æ±‚å¹¶æŸ¥çœ‹ç»“æœã€‚\n\nå‰©ä¸‹çš„å°±è®©æˆ‘ä»¬ç”¨ä»£ç å±•ç¤ºå§ï¼\n\n## è¡¨æ“ä½œ\n\næˆ‘ä»¬çŸ¥é“ï¼Œå…³ç³»æ¨¡å‹éœ€è¦ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„æ¶æ„ï¼Œå…¶ä¸­ï¼Œæ•°æ®å°†æ ‡å‡†åŒ–ä¸ºè¡¨ã€åˆ—å’Œè¡Œã€‚æ­¤å¤–ï¼Œåœ¨è¡¨ã€åˆ—ã€ç´¢å¼•å’Œå…¶ä»–æ•°æ®åº“å…ƒç´ ä¹‹é—´å®šä¹‰æ‰€æœ‰å…³ç³»ã€‚ä½† DynamoDB ä¸åŒï¼Œ**DynamoDB æ²¡æœ‰æ¶æ„ã€‚æ¯ä¸ªè¡¨å¿…é¡»å…·æœ‰ä¸€ä¸ªç”¨æ¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªæ•°æ®é¡¹ç›®çš„ä¸»é”®ï¼Œä½†å¯¹å…¶ä»–éé”®å±æ€§æ²¡æœ‰ç±»ä¼¼çš„çº¦æŸã€‚DynamoDB å¯ä»¥ç®¡ç†ç»“æ„åŒ–æˆ–åŠç»“æ„åŒ–çš„æ•°æ®ï¼ŒåŒ…æ‹¬ JSON æ–‡æ¡£ã€‚**\n\nè¡¨æ˜¯å…³ç³»æ•°æ®åº“å’Œ DynamoDB ä¸­çš„åŸºæœ¬æ•°æ®ç»“æ„ã€‚å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ (RDBMS) è¦æ±‚åœ¨åˆ›å»ºè¡¨æ—¶å®šä¹‰è¡¨çš„æ¶æ„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒDynamoDB è¡¨æ²¡æœ‰æ¶æ„ - ä¸ä¸»é”®ä¸åŒï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºè¡¨æ—¶æ— éœ€å®šä¹‰ä»»ä½•å±æ€§æˆ–æ•°æ®ç±»å‹ã€‚\n\n### æ–°å»ºè¡¨\n\nDynamoDB ä½¿ç”¨ CreateTable æ“ä½œåˆ›å»ºè¡¨ï¼Œå¹¶æŒ‡å®šå‚æ•°ï¼Œè¯·æ±‚è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\n{\n   \"AttributeDefinitions\": [\n      {\n         \"AttributeName\": \"string\",\n         \"AttributeType\": \"string\"\n      }\n   ],\n   \"GlobalSecondaryIndexes\": [\n      {\n         \"IndexName\": \"string\",\n         \"KeySchema\": [\n            {\n               \"AttributeName\": \"string\",\n               \"KeyType\": \"string\"\n            }\n         ],\n         \"Projection\": {\n            \"NonKeyAttributes\": [ \"string\" ],\n            \"ProjectionType\": \"string\"\n         },\n         \"ProvisionedThroughput\": {\n            \"ReadCapacityUnits\": number,\n            \"WriteCapacityUnits\": number\n         }\n      }\n   ],\n   \"KeySchema\": [\n      {\n         \"AttributeName\": \"string\",\n         \"KeyType\": \"string\"\n      }\n   ],\n   \"LocalSecondaryIndexes\": [\n      {\n         \"IndexName\": \"string\",\n         \"KeySchema\": [\n            {\n               \"AttributeName\": \"string\",\n               \"KeyType\": \"string\"\n            }\n         ],\n         \"Projection\": {\n            \"NonKeyAttributes\": [ \"string\" ],\n            \"ProjectionType\": \"string\"\n         }\n      }\n   ],\n   \"ProvisionedThroughput\": {\n      \"ReadCapacityUnits\": number,\n      \"WriteCapacityUnits\": number\n   },\n   \"StreamSpecification\": {\n      \"StreamEnabled\": boolean,\n      \"StreamViewType\": \"string\"\n   },\n   \"TableName\": \"string\"\n}\n\n\n```\n\nå¿…é¡»å‘ CreateTable æä¾›ä»¥ä¸‹å‚æ•°ï¼š\n\n* TableName â€“ è¡¨åç§°ã€‚\n* KeySchema â€“ ç”¨äºä¸»é”®çš„å±æ€§ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… è¡¨ã€é¡¹ç›®å’Œå±æ€§ å’Œ ä¸»é”®ã€‚\n* AttributeDefinitions â€“ é”®æ¶æ„å±æ€§çš„æ•°æ®ç±»å‹ã€‚\n* ProvisionedThroughput â€“ æ¯ç§’éœ€å¯¹æ­¤è¡¨æ‰§è¡Œçš„è¯»å–å’Œå†™å…¥æ¬¡æ•°ã€‚DynamoDB å°†ä¿ç•™è¶³é‡çš„å­˜å‚¨å’Œç³»ç»Ÿèµ„æºï¼Œä»¥ä¾¿å§‹ç»ˆæ»¡è¶³ååé‡è¦æ±‚ã€‚ä¹Ÿå¯åœ¨åˆ›å»ºä¹‹åä½¿ç”¨ UpdateTable æ“ä½œåæ›´æ”¹è¿™äº›è®¾ç½®ã€‚å­˜å‚¨åˆ†é…å®Œå…¨ç”± DynamoDB ç®¡ç†ï¼Œæˆ‘ä»¬æ— éœ€æŒ‡å®šè¡¨çš„å­˜å‚¨è¦æ±‚ã€‚\n\nAttributeType çš„å®šä¹‰ä¸­ï¼š\n\n* S - å­—ç¬¦ä¸²ç±»å‹\n* N - æ•°å­—ç±»å‹\n* B - äºŒè¿›åˆ¶ç±»å‹\n\n\n#### Python Example\n\nboto3\n\n```\nimport boto3\ndb3 = boto3.resource('dynamodb', endpoint_url='http://localhost:8000',  region_name='us-west-2')\n\n\ntable = db3.create_table(\n    TableName='Music',\n    KeySchema=[\n        {\n            'AttributeName': \"Artist\",\n            'KeyType': \"HASH\"\n        },\n        {\n            'AttributeName': \"SongTitle\",\n            'KeyType': \"RANGE\"\n        }\n    ],\n    AttributeDefinitions=[\n        {\n            'AttributeName': \"Artist\",\n            'AttributeType': \"S\"\n        },\n        {\n            'AttributeName': \"SongTitle\",\n            'AttributeType': \"S\"\n        }\n    ],\n    ProvisionedThroughput={       \n        'ReadCapacityUnits': 1,\n        'WriteCapacityUnits': 1\n    }\n)\n\n\n# Wait until the table exists.\ntable.meta.client.get_waiter('table_exists').wait(TableName='Music')\n\n# Print out some data about the table.\nprint(table.item_count)\n\n```\næ­¤è¡¨çš„ä¸»é”®åŒ…æ‹¬ Artistï¼ˆåˆ†åŒºé”®ï¼‰å’Œ SongTitleï¼ˆæ’åºé”®ï¼‰ã€‚\n\n### è·å–æœ‰å…³è¡¨çš„ä¿¡æ¯\n\nè¡¨å»ºå¥½åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ DescribeTable å‘½ä»¤æŸ¥çœ‹è¡¨çš„ä¿¡æ¯ã€‚\nå”¯ä¸€çš„å‚æ•°æ˜¯è¡¨åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\n{\n    TableName : \"Music\"\n}\n```\n\næ¥è‡ª DescribeTable å›å¤å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\n{\n  \"Table\": {\n    \"AttributeDefinitions\": [\n      {\n        \"AttributeName\": \"Artist\",\n        \"AttributeType\": \"S\"\n      },\n      {\n        \"AttributeName\": \"SongTitle\",\n        \"AttributeType\": \"S\"\n      }\n    ],\n    \"TableName\": \"Music\",\n    \"KeySchema\": [\n      {\n        \"AttributeName\": \"Artist\",\n        \"KeyType\": \"HASH\"  //Partition key\n      },\n      {\n        \"AttributeName\": \"SongTitle\",\n        \"KeyType\": \"RANGE\"  //Sort key\n      }\n    ],\n\n    ...remaining output omitted...\n```\n\nDescribeTable è¿˜å°†è¿”å›æœ‰å…³è¡¨ä¸­çš„ç´¢å¼•ã€é¢„é…ç½®çš„ååé‡è®¾ç½®ã€å¤§çº¦é¡¹ç›®æ•°å’Œå…¶ä»–å…ƒæ•°æ®çš„ä¿¡æ¯ã€‚\n\n#### Python Example\n\nboto3\n\n```\nimport boto3\ndb3 = boto3.resource('dynamodb', endpoint_url='http://localhost:8000',  region_name='us-west-2')\n\ndb3.meta.client.describe_table(TableName='Music')\n```\n```\n# è¿”å›ç»“æœå¦‚ä¸‹\n\n{'ResponseMetadata': {'HTTPHeaders': {'content-length': '569',\n   'content-type': 'application/x-amz-json-1.0',\n   'server': 'Jetty(8.1.12.v20130726)',\n   'x-amz-crc32': '2801025854',\n   'x-amzn-requestid': '2dafeeab-8d79-4b32-ad1f-03983624ab41'},\n  'HTTPStatusCode': 200,\n  'RequestId': '2dafeeab-8d79-4b32-ad1f-03983624ab41',\n  'RetryAttempts': 0},\n u'Table': {u'AttributeDefinitions': [{u'AttributeName': u'Artist',\n    u'AttributeType': u'S'},\n   {u'AttributeName': u'SongTitle', u'AttributeType': u'S'}],\n  u'CreationDateTime': datetime.datetime(2016, 12, 28, 11, 25, 12, 657000, tzinfo=tzlocal()),\n  u'ItemCount': 0,\n  u'KeySchema': [{u'AttributeName': u'Artist', u'KeyType': u'HASH'},\n   {u'AttributeName': u'SongTitle', u'KeyType': u'RANGE'}],\n  u'ProvisionedThroughput': {u'LastDecreaseDateTime': datetime.datetime(1970, 1, 1, 8, 0, tzinfo=tzlocal()),\n   u'LastIncreaseDateTime': datetime.datetime(1970, 1, 1, 8, 0, tzinfo=tzlocal()),\n   u'NumberOfDecreasesToday': 0,\n   u'ReadCapacityUnits': 1,\n   u'WriteCapacityUnits': 1},\n  u'TableArn': u'arn:aws:dynamodb:ddblocal:000000000000:table/Music',\n  u'TableName': u'Music',\n  u'TableSizeBytes': 0,\n  u'TableStatus': u'ACTIVE'}}\n```\n\n### åˆ é™¤è¡¨\n\nå½“ä¸å†éœ€è¦ä¸€ä¸ªè¡¨å¹¶å¸Œæœ›å°†å®ƒæ°¸ä¹…æ€§ä¸¢å¼ƒæ—¶ï¼Œå¯ä½¿ç”¨ DeleteTableï¼š\n\nè¡¨ä¸€ç»åˆ é™¤ä¾¿æ— æ³•æ¢å¤ã€‚ï¼ˆä¸€äº›å…³ç³»æ•°æ®åº“å…è®¸æ’¤æ¶ˆ DROP TABLE æ“ä½œï¼‰\n\n```\n{\n    TableName: \"Music\"\n}\n```\n\n#### Python Example\n\nboto3\n\n ```\nfrom __future__ import print_function # Python 2/3 compatibility\nimport boto3\n\ndynamodb = boto3.resource('dynamodb', region_name='us-west-2', endpoint_url=\"http://localhost:8000\")\n\ntable = dynamodb.Table('Music')\n\ntable.delete()\n\n## output\n\n{'ResponseMetadata': {\n    'HTTPHeaders': {\n        'content-length': '1012',\n        'content-type': 'application/x-amz-json-1.0',\n        'server': 'Jetty(8.1.12.v20130726)',\n        'x-amz-crc32': '2473676771',\n        'x-amzn-requestid': '84938373-870f-420f-b19e-4de2c6301743'},\n    'HTTPStatusCode': 200,\n    'RequestId': '84938373-870f-420f-b19e-4de2c6301743',\n    'RetryAttempts': 0},\n    u'TableDescription': {\n    ...\n    }\n}\n ```\n\n### ä¿®æ”¹è¡¨\n\nå½“ä¸€ä¸ªè¡¨åˆ›å»ºå¥½ä¹‹åå¦‚æœæƒ³è¦è°ƒæ•´ï¼Œå¯ä»¥ä½¿ç”¨UpdateTableå‘½ä»¤\n\nä¿®æ”¹è¡¨æ—¶æˆ‘ä»¬ä¸€æ¬¡åªå¯ä»¥åšä¸€ä¸ªæ“ä½œ:\n\n\t* ä¿®æ”¹é¢„è®¾çš„ååé‡ã€‚\n\t* å¼€å¯æˆ–è€…åœæ­¢ä½¿ç”¨Streamsã€‚\n\t* åˆ é™¤ä¸€ä¸ªå…¨å±€è€³æœºç´¢å¼•ã€‚\n\t* åˆ›å»ºä¸€ä¸ªå…¨å±€çš„äºŒçº§ç´¢å¼•ã€‚å½“ç´¢å¼•å¼€å§‹åå°æ‰§è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨UpdateTableè¿›è¡Œä¸‹ä¸€ä¸ªæ“ä½œã€‚\n\n> UpdateTable æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œ; å½“å®ƒå¼€å§‹æ‰§è¡Œæ—¶ï¼Œè¡¨çš„çŠ¶æ€å°†ç”± ACTIVE å˜ä¸º UPDATINGã€‚\n\nè¯·æ±‚è¯­æ³•ä¸ºï¼š\n\n```\n{\n   \"AttributeDefinitions\": [\n      {\n         \"AttributeName\": \"string\",\n         \"AttributeType\": \"string\"\n      }\n   ],\n   \"GlobalSecondaryIndexUpdates\": [\n      {\n         \"Create\": {\n            \"IndexName\": \"string\",\n            \"KeySchema\": [\n               {\n                  \"AttributeName\": \"string\",\n                  \"KeyType\": \"string\"\n               }\n            ],\n            \"Projection\": {\n               \"NonKeyAttributes\": [ \"string\" ],\n               \"ProjectionType\": \"string\"\n            },\n            \"ProvisionedThroughput\": {\n               \"ReadCapacityUnits\": number,\n               \"WriteCapacityUnits\": number\n            }\n         },\n         \"Delete\": {\n            \"IndexName\": \"string\"\n         },\n         \"Update\": {\n            \"IndexName\": \"string\",\n            \"ProvisionedThroughput\": {\n               \"ReadCapacityUnits\": number,\n               \"WriteCapacityUnits\": number\n            }\n         }\n      }\n   ],\n   \"ProvisionedThroughput\": {\n      \"ReadCapacityUnits\": number,\n      \"WriteCapacityUnits\": number\n   },\n   \"StreamSpecification\": {\n      \"StreamEnabled\": boolean,\n      \"StreamViewType\": \"string\"\n   },\n   \"TableName\": \"string\"\n}\n\n```\n\n#### Python Example\n\nboto3\n\n```\nimport boto3\ndb3 = boto3.resource('dynamodb', endpoint_url='http://localhost:8000',  region_name='us-west-2')\n\n\ntable = db3.meta.client.update_table(\n    TableName='Music',\n    AttributeDefinitions=[\n        {\n            'AttributeName': \"Artist\",\n            'AttributeType': \"S\"\n        },\n        {\n            'AttributeName': \"SongTitle\",\n            'AttributeType': \"S\"\n        }\n    ],\n    ProvisionedThroughput={       \n        'ReadCapacityUnits': 10,\n        'WriteCapacityUnits': 10\n    }\n)\n\ndb3.meta.client.describe_table(TableName='Music')\n\n```\n\nç°åœ¨æŸ¥çœ‹Music è¡¨ä¼šå‘ç°é¢„è®¾çš„ååé‡éƒ½å·²ç»ä¿®æ”¹ä¸ºäº†10\n\n[DynamoDB UpdateTable æ“ä½œ](http://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/APIReference/API_UpdateTable.html)\n\n> ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†è¦ç»“æŸDynamoDB æœ€å¸¸ç”¨çš„éƒ¨åˆ†ï¼Œ**é¡¹ç›®çš„åŸºæœ¬æ“ä½œï¼ˆCRUDï¼‰**ã€‚\n\n[åŸæ–‡é“¾æ¥](http://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751935&idx=3&sn=7dac29e441ebaabfbf70600fee042bd3&chksm=80b0b9d5b7c730c390dd96fc1c4853219fd8d39a634506081631b41e147faaee38f0e8d35730#rd)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨3ï¼š è¡¨çš„åŸºæœ¬æ“ä½œ",
        "date": "2017-01-14 10:13:42",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-table-operator"
    },
    {
      "content": "\n\n## Amazon DynamoDB å…¥é—¨2ï¼š å·¥ä½œåŸç†ã€APIå’Œæ•°æ®ç±»å‹ä»‹ç»\n\n:::tip\næœ¬èŠ‚ä¸»è¦ä»‹ç»DynamoDB åŸºæœ¬æ¦‚å¿µã€æ ¸å¿ƒç»„ä»¶ã€æ•°æ®ç»“æ„ã€Api\n:::\n\n\n\n## DynamoDB åŸºæœ¬æ¦‚å¿µ\n\nDynamoDB æ˜¯ AWS ç‹¬æœ‰çš„å®Œå…¨æ‰˜ç®¡çš„ NoSQL Databaseã€‚å®ƒçš„æ€æƒ³æ¥æºäº Amazon 2007 å¹´å‘è¡¨çš„ä¸€ç¯‡è®ºæ–‡ï¼šDynamo: Amazonâ€™s Highly Available Key-value Storeã€‚åœ¨è¿™ç¯‡è®ºæ–‡é‡Œï¼ŒAmazon ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Commodity Hardware æ¥æ‰“é€ é«˜å¯ç”¨ã€é«˜å¼¹æ€§çš„æ•°æ®å­˜å‚¨ã€‚æƒ³è¦ç†è§£ DynamoDBï¼Œé¦–å…ˆè¦ç†è§£ Consistent Hashingã€‚Consistent Hashing çš„åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n![](http://note.youdao.com/yws/public/resource/b99dcbe9b4a2069a3337badbeafe4b29/xmlnote/WEBRESOURCEb477b81f1e511ee919b14f3393326749/470)\n\nHUGOMORE42\n\nå®ƒçš„æ¦‚å¿µæ˜¯ï¼š\n\n1. æˆ‘æœ‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„Keyspaceï¼ˆ2çš„160æ¬¡æ–¹ï¼Œæ¯”è¾ƒä¸€ä¸‹ï¼šIPv6æ˜¯2çš„128æ¬¡æ–¹ï¼‰ï¼Œæˆ‘ä»¬è®°ä½œXã€‚\n2. ç„¶åå°†Xæ”¾åœ¨ä¸€ä¸ªç¯å½¢çš„ç©ºé—´é‡Œåˆ’åˆ†æˆå¤§å°ç›¸ç­‰çš„Yä¸ª Partitionï¼Œä¾æ¬¡å¾ªç¯æ’åˆ—ï¼ˆå¦‚å›¾ï¼‰ï¼Œæ¯ä¸ª Partition ç”±ä¸€ä¸ªVnodeï¼ˆRiakçš„æ¦‚å¿µï¼‰ç®¡ç†ï¼Œ\n3. å½“ä½ æœ‰Mä¸ªDatabase Serverï¼ˆNodeï¼‰ï¼ŒYä¸ªVnodeå†å¹³å‡æ˜ å°„åˆ°Mä¸ªNodeä¸Šã€‚\n4. å½“æ•°æ®è¦æ’å…¥æ—¶ï¼Œå°†å…¶ä¸»é”®ï¼ˆHash Keyï¼‰æ˜ å°„åˆ°Kä¸­çš„ä¸€ä¸ªåœ°å€ï¼ˆAddrï¼‰ï¼Œå¯¹åº”åˆ°æŸä¸ªVnodeï¼Œå†è¿›ä¸€æ­¥å¯¹åº”åˆ°æŸä¸ªNodeï¼Œå¦‚æœè¿™ä¸ªæ•°æ®éœ€è¦Nä¸ªReplicaï¼Œåˆ™å°†æ•°æ®å†™å…¥Addrï¼ˆVnode aï¼‰ï¼ŒAddr + 1ï¼ˆVnode bï¼‰ï¼Œ â€¦ï¼ŒAdd + Nï¼ˆVnode nï¼‰ã€‚\n5. è¿™é‡Œï¼ŒMå°±æ˜¯ä½ çš„Shardsï¼ŒNæ˜¯Replicaã€‚\n\nä»¥åæ·»åŠ æ–°çš„Nodeæ—¶ï¼Œæ˜ å°„å‘ç”Ÿå˜åŒ–ï¼Œåªéœ€è¦æŠŠç›¸åº”çš„å˜åŒ–äº†çš„Vnodeè¿ç§»åˆ°æ–°çš„Nodeä¸Šå³å¯ã€‚åœ¨è¿™ç§ç»“æ„ä¸‹ï¼ŒSharding/Replicaå¯¹ç¨‹åºå‘˜åŸºæœ¬ä¸Šæ˜¯é€æ˜çš„ã€‚\n\n\n## DynamoDB æ ¸å¿ƒç»„ä»¶\n\nåŸºæœ¬ DynamoDB ç»„ä»¶åŒ…æ‹¬ï¼šè¡¨ã€é¡¹ç›®ã€å±æ€§\n\n* è¡¨ - ç±»ä¼¼äºå…¶ä»–æ•°æ®åº“ç³»ç»Ÿï¼ŒDynamoDBå°†æ•°æ®å­˜å‚¨åœ¨è¡¨ä¸­ã€‚è¡¨æ˜¯æ•°æ®çš„é›†åˆã€‚ï¼ˆç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼‰\n* é¡¹ç›® - æ¯ä¸ªè¡¨åŒ…å«å¤šä¸ªé¡¹ç›®ã€‚é¡¹ç›®æ˜¯ä¸€ç»„å±æ€§ï¼Œå…·æœ‰ä¸åŒäºæ‰€æœ‰å…¶ä»–é¡¹ç›®çš„å”¯ä¸€æ ‡è¯†ã€‚ï¼ˆç±»ä¼¼äºå…¶ä»–æ•°æ®åº“ç³»ç»Ÿä¸­çš„è¡Œã€è®°å½•æˆ–å…ƒç»„ã€‚ï¼‰\n* å±æ€§ - æ¯ä¸ªé¡¹ç›®åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ã€‚å±æ€§æ˜¯åŸºç¡€çš„æ•°æ®å…ƒç´ ï¼Œæ— éœ€è¿›ä¸€æ­¥åˆ†è§£ã€‚ï¼ˆç±»ä¼¼äºå…¶ä»–æ•°æ®åº“ç³»ç»Ÿä¸­çš„å­—æ®µæˆ–åˆ—ã€‚ï¼‰\n\nä¸‹å›¾æ˜¯ä¸€ä¸ªåä¸º People çš„è¡¨ï¼Œå…¶ä¸­æ˜¾ç¤ºäº†ä¸€äº›ç¤ºä¾‹é¡¹ç›®å’Œå±æ€§ï¼š\n\n![image](http://note.youdao.com/yws/public/resource/b99dcbe9b4a2069a3337badbeafe4b29/xmlnote/WEBRESOURCEe0de7341429c0ba6408f2a3b1a60d214/100)\n\nè¯·æ³¨æ„æœ‰å…³ People è¡¨çš„ä»¥ä¸‹å†…å®¹ï¼š\n\n* è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦æˆ–ä¸»é”®ï¼Œç”¨äºå°†é¡¹ç›®ä¸è¡¨ä¸­çš„æ‰€æœ‰å…¶ä»–å†…å®¹åŒºåˆ†å¼€æ¥ã€‚åœ¨ People è¡¨ä¸­ï¼Œä¸»é”®åŒ…å«ä¸€ä¸ªå±æ€§ (PersonID)ã€‚\n* ä¸ä¸»é”®å¤–ä¸åŒï¼ŒPeopleè¡¨æ˜¯æ— æ¶æ„çš„ï¼Œè¿™è¡¨ç¤ºå±æ€§åŠå…¶æ•°æ®ç±»å‹éƒ½ä¸éœ€è¦é¢„å…ˆå®šä¹‰ã€‚æ¯ä¸ªé¡¹ç›®éƒ½èƒ½æ‹¥æœ‰å…¶è‡ªå·±çš„ç‹¬ç‰¹å±æ€§ã€‚\n* å¤§å¤šæ•°å±æ€§æ˜¯æ ‡é‡ç±»å‹çš„ï¼Œè¿™è¡¨ç¤ºå®ƒä»¬åªèƒ½å…·æœ‰ä¸€ä¸ªå€¼ã€‚å­—ç¬¦ä¸²å’Œæ•°å­—æ˜¯æ ‡é‡çš„å¸¸è§ç¤ºä¾‹ã€‚\n* æŸäº›é¡¹ç›®å…·æœ‰åµŒå¥—å±æ€§ (Address)ã€‚DynamoDB æ”¯æŒæœ€é«˜ 32çº§æ·±åº¦çš„åµŒå¥—å±æ€§ã€‚\n\nè¿™é‡Œï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ç¬¬ä¸€ä¸ªæ¦‚å¿µï¼šä¸»é”®ã€‚\n\n### ä¸»é”®\n\nåˆ›å»ºè¡¨æ—¶ï¼Œé™¤è¡¨åç§°å¤–ï¼Œæ‚¨è¿˜å¿…é¡»æŒ‡å®šè¡¨çš„ä¸»é”®ã€‚ä¸»é”®å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç›®ï¼Œå› æ­¤ï¼Œä»»æ„ä¸¤ä¸ªé¡¹ç›®çš„ä¸»é”®éƒ½ä¸ç›¸åŒã€‚\nDynamoDB æ”¯æŒä¸¤ç§ä¸åŒç±»å‹çš„ä¸»é”®ï¼š\n\n* åˆ†åŒºé”® - ç®€å•çš„ä¸»é”®ï¼Œç”±ä¸€ä¸ªç§°ä¸ºåˆ†åŒºé”®çš„å±æ€§ç»„æˆã€‚\n\n> å¦‚æœè¡¨å…·æœ‰ç®€å•ä¸»é”®ï¼ˆåªæœ‰åˆ†åŒºé”®ï¼‰ï¼ŒDynamoDB å°†æ ¹æ®å…¶åˆ†åŒºé”®å€¼å­˜å‚¨å’Œæ£€ç´¢å„ä¸ªé¡¹ç›®ã€‚åŒæ—¶ï¼ŒDynamoDB ä½¿ç”¨åˆ†åŒºé”®çš„å€¼ä½œä¸ºå†…éƒ¨å“ˆå¸Œå‡½æ•°çš„è¾“å…¥å€¼ï¼Œä»è€Œå°†é¡¹ç›®å†™å…¥è¡¨ä¸­ã€‚å“ˆå¸Œå‡½æ•°çš„è¾“å‡ºå€¼å†³å®šäº†é¡¹ç›®å°†è¦å­˜å‚¨åœ¨å“ªä¸ªåˆ†åŒºã€‚\nè¦ä»è¡¨ä¸­è¯»å–æŸä¸ªé¡¹ç›®ï¼Œå¿…é¡»ä¸ºè¯¥é¡¹ç›®æŒ‡å®šåˆ†åŒºé”®å€¼ã€‚DynamoDB ä½¿ç”¨æ­¤å€¼ä½œä¸ºå…¶å“ˆå¸Œå‡½æ•°çš„è¾“å…¥å€¼ï¼Œä»è€Œç”Ÿæˆå¯ä»ä¸­æ‰¾åˆ°è¯¥é¡¹ç›®çš„åˆ†åŒºã€‚**ï¼ˆæ­¤æ—¶ï¼Œåˆ†åŒºé”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸å¯é‡å¤ã€‚ï¼‰**\n\nä¸‹å›¾æ˜¾ç¤ºäº†åä¸º Pets çš„è¡¨ï¼Œè¯¥è¡¨è·¨å¤šä¸ªåˆ†åŒºã€‚è¡¨çš„ä¸»é”®ä¸º AnimalTypeï¼ˆä»…æ˜¾ç¤ºæ­¤é”®å±æ€§ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDynamoDB ä¼šæ ¹æ®å­—ç¬¦ä¸² Dog çš„å“ˆå¸Œå€¼ï¼Œä½¿ç”¨å…¶å“ˆå¸Œå‡½æ•°å†³å®šæ–°é¡¹ç›®çš„å­˜å‚¨ä½ç½®ã€‚è¯·æ³¨æ„ï¼Œé¡¹ç›®å¹¶éæŒ‰æ’åºé¡ºåºå­˜å‚¨çš„ã€‚æ¯ä¸ªé¡¹ç›®çš„ä½ç½®ç”±å…¶åˆ†åŒºé”®çš„å“ˆå¸Œå€¼å†³å®šã€‚\n\n![ç®€å•åˆ†åŒºç¤ºä¾‹](http://note.youdao.com/yws/public/resource/49e3721094381363857f5112db30fa65/xmlnote/WEBRESOURCE26a15082f1205bda684be3d5b68f5058/329)\n\n* åˆ†åŒºé”®å’Œæ’åºé”® - ç§°ä¸ºå¤åˆä¸»é”®ï¼Œæ­¤ç±»å‹çš„é”®ç”±ä¸¤ä¸ªå±æ€§ç»„æˆã€‚ç¬¬ä¸€ä¸ªå±æ€§æ˜¯åˆ†åŒºé”®ï¼Œç¬¬äºŒä¸ªå±æ€§æ˜¯æ’åºé”®ã€‚\n\n> DynamoDB ä½¿ç”¨åˆ†åŒºé”®å€¼ä½œä¸ºå¯¹å†…éƒ¨å“ˆå¸Œå‡½æ•°çš„è¾“å…¥ã€‚æ¥è‡ªå“ˆå¸Œå‡½æ•°çš„è¾“å‡ºå†³å®šäº†é¡¹ç›®å°†å­˜å‚¨åˆ°çš„åˆ†åŒºï¼ˆDynamoDB å†…éƒ¨çš„ç‰©ç†å­˜å‚¨ï¼‰ã€‚å…·æœ‰ç›¸åŒåˆ†åŒºé”®çš„æ‰€æœ‰é¡¹ç›®æŒ‰æ’åºé”®å€¼çš„æ’åºé¡ºåºå­˜å‚¨åœ¨ä¸€èµ·ã€‚ä¸¤ä¸ªé¡¹ç›®å¯å…·æœ‰ç›¸åŒçš„åˆ†åŒºé”®å€¼ï¼Œ**ä½†è¿™ä¸¤ä¸ªé¡¹ç›®å¿…é¡»å…·æœ‰ä¸åŒçš„æ’åºé”®å€¼ã€‚**\n\nä¸ºå°†æŸä¸ªé¡¹ç›®å†™å…¥è¡¨ä¸­ï¼ŒDynamoDB ä¼šè®¡ç®—åˆ†åŒºé”®çš„å“ˆå¸Œå€¼ä»¥ç¡®å®šè¯¥é¡¹ç›®çš„å­˜å‚¨åˆ†åŒºã€‚åœ¨è¯¥åˆ†åŒºä¸­ï¼Œå¯èƒ½æœ‰å‡ ä¸ªå…·æœ‰ç›¸åŒåˆ†åŒºé”®å€¼çš„é¡¹ç›®ï¼Œå› æ­¤ DynamoDB ä¼šæŒ‰æ’åºé”®çš„å‡åºå°†è¯¥é¡¹ç›®å­˜å‚¨åœ¨å…¶ä»–é¡¹ç›®ä¸­ã€‚\n\nè¦è¯»å–è¡¨ä¸­çš„æŸä¸ªé¡¹ç›®ï¼Œæ‚¨å¿…é¡»ä¸ºè¯¥é¡¹ç›®æŒ‡å®šåˆ†åŒºé”®å€¼å’Œæ’åºé”®å€¼ã€‚DynamoDB ä¼šè®¡ç®—åˆ†åŒºé”®çš„å“ˆå¸Œå€¼ï¼Œä»è€Œç”Ÿæˆå¯ä»ä¸­æ‰¾åˆ°è¯¥é¡¹ç›®çš„åˆ†åŒºã€‚\n\nå¦‚æœæˆ‘ä»¬æŸ¥è¯¢çš„é¡¹ç›®å…·æœ‰ç›¸åŒçš„åˆ†åŒºé”®å€¼ï¼Œåˆ™å¯ä»¥é€šè¿‡å•ä¸€æ“ä½œ (Query) è¯»å–è¡¨ä¸­çš„å¤šä¸ªé¡¹ç›®ã€‚DynamoDB å°†è¿”å›å…·æœ‰è¯¥åˆ†åŒºé”®å€¼çš„æ‰€æœ‰é¡¹ç›®ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥å¯¹æ’åºé”®åº”ç”¨æŸä¸ªæ¡ä»¶ï¼Œä»¥ä¾¿å®ƒä»…è¿”å›ç‰¹å®šå€¼èŒƒå›´å†…çš„é¡¹ç›®ã€‚\n\nå‡è®¾ Pets è¡¨å…·æœ‰ç”± AnimalTypeï¼ˆåˆ†åŒºé”®ï¼‰å’Œ Nameï¼ˆæ’åºé”®ï¼‰æ„æˆçš„å¤åˆä¸»é”®ã€‚\n\nä¸‹å›¾æ˜¾ç¤ºäº† DynamoDB å†™å…¥é¡¹ç›®çš„è¿‡ç¨‹ï¼Œåˆ†åŒºé”®å€¼ä¸º Dogã€æ’åºé”®å€¼ä¸º Fidoã€‚\n\n![](http://note.youdao.com/yws/public/resource/49e3721094381363857f5112db30fa65/xmlnote/WEBRESOURCE264adc571f86df9053404818d240230f/337)\n\n> * ä¸ºè¯»å– Pets è¡¨ä¸­çš„åŒä¸€é¡¹ç›®ï¼ŒDynamoDB ä¼šè®¡ç®— Dog çš„å“ˆå¸Œå€¼ï¼Œä»è€Œç”Ÿæˆè¿™äº›é¡¹ç›®çš„å­˜å‚¨åˆ†åŒºã€‚ç„¶åï¼ŒDynamoDB ä¼šæ‰«æè¿™äº›æ’åºé”®å±æ€§å€¼ï¼Œç›´è‡³æ‰¾åˆ° Fidoã€‚\n> * è¦è¯»å– AnimalType ä¸º Dog çš„æ‰€æœ‰é¡¹ç›®ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œ Query æ“ä½œï¼Œæ— éœ€æŒ‡å®šæ’åºé”®æ¡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›é¡¹ç›®ä¼šæŒ‰å­˜å‚¨é¡ºåºï¼ˆå³æŒ‰æ’åºé”®çš„å‡åºï¼‰è¿”å›ã€‚æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥è¯·æ±‚ä»¥é™åºè¿”å›ã€‚\n> * è¦ä»…æŸ¥è¯¢æŸäº› Dog é¡¹ç›®ï¼Œæ‚¨å¯ä»¥å¯¹æ’åºé”®åº”ç”¨æ¡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä»…é™ Name åœ¨ A è‡³ K èŒƒå›´å†…çš„ Dog é¡¹ç›®ï¼‰ã€‚\n\n\n#### Note\n* æ¯ä¸ªä¸»é”®å±æ€§å¿…é¡»ä¸ºæ ‡é‡ï¼ˆè¡¨ç¤ºå®ƒåªèƒ½å…·æœ‰ä¸€ä¸ªå€¼ï¼‰ã€‚ä¸»é”®å±æ€§å”¯ä¸€å…è®¸çš„æ•°æ®ç±»å‹æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—å’ŒäºŒè¿›åˆ¶ã€‚å¯¹äºå…¶ä»–éé”®å±æ€§æ²¡æœ‰ä»»ä½•æ­¤ç±»é™åˆ¶ã€‚\n* DynamoDB ä¼šè‡ªåŠ¨åˆ†é…è¶³å¤Ÿçš„å­˜å‚¨ï¼Œæ¯ä¸ªåˆ†åŒºé”®å€¼çš„éé‡å¤æ’åºé”®å€¼æ— æ•°é‡ä¸Šé™ã€‚æ‰€ä»¥å³ä½¿éœ€è¦åœ¨ Dog è¡¨ä¸­å­˜å‚¨æ•°åäº¿ Petsé¡¹ç›®ï¼ŒDynamoDB ä¹Ÿèƒ½è¿™ä¸€éœ€æ±‚ã€‚\n\n### äºŒçº§ç´¢å¼•\n\nDynamoDBæ”¯æŒåœ¨ä¸€ä¸ªè¡¨ä¸Šåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªäºŒçº§ç´¢å¼•ã€‚åˆ©ç”¨ secondary indexï¼Œé™¤äº†å¯å¯¹ä¸»é”®è¿›è¡ŒæŸ¥è¯¢å¤–ï¼Œè¿˜å¯ä½¿ç”¨æ›¿ä»£é”®æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ã€‚\n\nDynamoDB æ”¯æŒä¸¤ç§ç´¢å¼•ï¼š\n\n* Global secondary index - ä¸€ç§å¸¦æœ‰å¯èƒ½ä¸è¡¨ä¸­ä¸åŒçš„åˆ†åŒºé”®å’Œæ’åºé”®çš„ç´¢å¼•ã€‚\n* Local secondary index - ä¸€ç§åˆ†åŒºé”®ä¸è¡¨ä¸­çš„ç›¸åŒä½†æ’åºé”®ä¸è¡¨ä¸­çš„ä¸åŒçš„ç´¢å¼•ã€‚\n\n**æœ€å¤šå¯ä»¥ä¸ºæ¯ä¸ªè¡¨å®šä¹‰ 5 ä¸ªå…¨å±€äºŒçº§ç´¢å¼•å’Œ 5 ä¸ªæœ¬åœ°äºŒçº§ç´¢å¼•ã€‚**\n\nä¸‹å›¾æ˜¾ç¤ºäº†ç¤ºä¾‹ Music è¡¨ï¼Œè¯¥è¡¨åŒ…å«ä¸€ä¸ªåä¸º GenreAlbumTitle çš„æ–°ç´¢å¼•\n\n![image](http://note.youdao.com/yws/public/resource/b99dcbe9b4a2069a3337badbeafe4b29/xmlnote/WEBRESOURCE829a617865ac76c1bb9a564e5789079d/125)\n\nå¯¹äºMusicè¡¨ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æŒ‰ Artistï¼ˆåˆ†åŒºé”®ï¼‰æˆ–æŒ‰ Artist å’Œ SongTitleï¼ˆåˆ†åŒºé”®å’Œæ’åºé”®ï¼‰æŸ¥è¯¢æ•°æ®é¡¹ã€‚è¿˜å¯ä»¥æŒ‰ Genre å’Œ AlbumTitle æŸ¥è¯¢æ•°æ®ã€‚\n\n#### Note\n\nè¯·æ³¨æ„æœ‰å…³ GenreAlbumTitle ç´¢å¼•çš„ä»¥ä¸‹å†…å®¹ï¼š\n\n* æ¯ä¸ªç´¢å¼•å±äºä¸€ä¸ªè¡¨ï¼ˆç§°ä¸ºç´¢å¼•çš„åŸºè¡¨ï¼‰ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒMusic æ˜¯ GenreAlbumTitle ç´¢å¼•çš„åŸºè¡¨ã€‚\n* DynamoDB å°†è‡ªåŠ¨ç»´æŠ¤ç´¢å¼•ã€‚å½“æ·»åŠ ã€æ›´æ–°æˆ–åˆ é™¤åŸºè¡¨ä¸­çš„æŸä¸ªé¡¹ç›®æ—¶ï¼ŒDynamoDB ä¼šæ·»åŠ ã€æ›´æ–°æˆ–åˆ é™¤å±äºè¯¥è¡¨çš„ä»»ä½•ç´¢å¼•ä¸­çš„å¯¹åº”é¡¹ç›®ã€‚\n* å½“åˆ›å»ºç´¢å¼•æ—¶ï¼Œå¯æŒ‡å®šå“ªäº›å±æ€§å°†ä»åŸºè¡¨å¤åˆ¶æˆ–æŠ•å½±åˆ°ç´¢å¼•ã€‚DynamoDB è‡³å°‘ä¼šå°†é”®å±æ€§ä»åŸºè¡¨æŠ•å½±åˆ°ç´¢å¼•ä¸­ã€‚å¯¹äº GenreAlbumTitle ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåªä¸è¿‡æ­¤æ—¶åªæœ‰ Music è¡¨ä¸­çš„é”®å±æ€§ä¼šæŠ•å½±åˆ°ç´¢å¼•ä¸­ã€‚\n\n## DynamoDB æ•°æ®ç±»å‹\n\nDynamoDB å¯¹è¡¨ä¸­çš„å±æ€§æ”¯æŒå¾ˆå¤šä¸åŒçš„æ•°æ®ç±»å‹ã€‚å¯æŒ‰ä»¥ä¸‹æ–¹å¼ä¸ºå±æ€§åˆ†ç±»ï¼š\n\n* æ ‡é‡ç±»å‹ - æ ‡é‡ç±»å‹å¯å‡†ç¡®åœ°è¡¨ç¤ºä¸€ä¸ªå€¼ã€‚æ ‡é‡ç±»å‹åŒ…æ‹¬**æ•°å­—ã€å­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶ã€å¸ƒå°”å€¼å’Œ nullã€‚**\n* æ–‡æ¡£ç±»å‹ - æ–‡æ¡£ç±»å‹å¯è¡¨ç¤ºå…·æœ‰åµŒå¥—å±æ€§çš„å¤æ‚ç»“æ„ã€‚æ–‡æ¡£ç±»å‹åŒ…æ‹¬åˆ—è¡¨å’Œæ˜ å°„ã€‚\n* é›†ç±»å‹ - é›†ç±»å‹å¯è¡¨ç¤ºå¤šä¸ªæ ‡é‡å€¼ã€‚é›†ç±»å‹åŒ…æ‹¬å­—ç¬¦ä¸²é›†ã€æ•°å­—é›†å’ŒäºŒè¿›åˆ¶é›†ã€‚\n\n**å½“åˆ›å»ºè¡¨æˆ–secondary indexæ—¶ï¼Œå¿…é¡»æŒ‡å®šæ¯ä¸ªä¸»é”®å±æ€§ï¼ˆåˆ†åŒºé”®å’Œæ’åºé”®ï¼‰çš„åç§°å’Œæ•°æ®ç±»å‹ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªä¸»é”®å±æ€§å¿…é¡»å®šä¹‰ä¸ºå­—ç¬¦ä¸²ã€æ•°å­—æˆ–äºŒè¿›åˆ¶ç±»å‹ã€‚**\n\n### æ ‡é‡ç±»å‹\n\næ ‡é‡ç±»å‹åŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶ã€å¸ƒå°”å€¼å’Œ nullã€‚\n\næ•°æ®ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹\n---|---|---\nå­—ç¬¦ä¸² |  å­—ç¬¦ä¸²æ˜¯ä½¿ç”¨ UTF-8 äºŒè¿›åˆ¶ç¼–ç çš„ Unicodeã€‚å­—ç¬¦ä¸²çš„é•¿åº¦å¿…é¡»å¤§äºé›¶ä¸”å—é™äºæœ€å¤§ DynamoDB é¡¹ç›®å¤§å° 400 KBã€‚| \"Bicycle\"\næ•°å­—   | æ•°å­—å¯ä¸ºæ­£æ•°ã€è´Ÿæ•°æˆ–é›¶ã€‚æ•°å­—æœ€å¤šå¯ç²¾ç¡®åˆ° 38 ä½ - è¶…è¿‡æ­¤ä½æ•°å°†å¯¼è‡´æ„å¤– | 300\näºŒè¿›åˆ¶ | äºŒè¿›åˆ¶ç±»å‹å±æ€§å¯ä»¥å­˜å‚¨ä»»æ„äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚å‹ç¼©æ–‡æœ¬ã€åŠ å¯†æ•°æ®æˆ–å›¾åƒã€‚DynamoDB ä¼šåœ¨æ¯”è¾ƒäºŒè¿›åˆ¶å€¼æ—¶å°†äºŒè¿›åˆ¶æ•°æ®çš„æ¯ä¸ªå­—èŠ‚è§†ä¸ºæ— ç¬¦å·ã€‚äºŒè¿›åˆ¶å±æ€§çš„é•¿åº¦å¿…é¡»å¤§äºé›¶ä¸”å—é™äºæœ€å¤§ DynamoDB é¡¹ç›®å¤§å° 400 KBã€‚| è¿™æ˜¯ä¸€ä¸ªé‡‡ç”¨ Base64 ç¼–ç æ–‡æœ¬çš„äºŒè¿›åˆ¶å±æ€§ï¼š dGhpcyB0ZXh0IGlzIGJhc2U2NC1lbmNvZGVk\nå¸ƒå°”å€¼ | å¸ƒå°”ç±»å‹å±æ€§å¯ä»¥å­˜å‚¨ true æˆ– falseã€‚| true\nç©º     | ç©ºä»£è¡¨å±æ€§å…·æœ‰æœªçŸ¥æˆ–æœªå®šä¹‰çŠ¶æ€ã€‚    | NULL\n\n### å­—ç¬¦ä¸²\n\nå¦‚æœå°†ä¸»é”®å±æ€§å®šä¹‰ä¸ºå­—ç¬¦ä¸²ç±»å‹å±æ€§ï¼Œä»¥ä¸‹é™„åŠ é™åˆ¶å°†é€‚ç”¨ï¼š\n* å¯¹äºç®€å•çš„ä¸»é”®ï¼Œç¬¬ä¸€ä¸ªå±æ€§å€¼ï¼ˆåˆ†åŒºé”®ï¼‰çš„æœ€å¤§é•¿åº¦ä¸º 2048 å­—èŠ‚ã€‚\n* å¯¹äºå¤åˆä¸»é”®ï¼Œç¬¬äºŒä¸ªå±æ€§å€¼ï¼ˆæ’åºé”®ï¼‰çš„æœ€å¤§é•¿åº¦ä¸º 1024 å­—èŠ‚\n\n> DynamoDB ä½¿ç”¨åŸºç¡€çš„ UTF-8 å­—ç¬¦ä¸²ç¼–ç å­—èŠ‚æ•´ç†å’Œæ¯”è¾ƒå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œâ€œaâ€(0x61) å¤§äºâ€œAâ€(0x41)ï¼Œâ€œÂ¿â€(0xC2BF) å¤§äºâ€œzâ€(0x7A)ã€‚\n\nå¯ä½¿ç”¨å­—ç¬¦ä¸²æ•°æ®ç±»å‹è¡¨ç¤ºæ—¥æœŸæˆ–æ—¶é—´æˆ³ã€‚æ‰§è¡Œæ­¤æ“ä½œçš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ ISO 8601 å­—ç¬¦ä¸²ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š\n\n* 2016-02-15\n* 2015-12-21T17:42:34Z\n* 20150311T122706Z\n\n**ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°å­—æ•°æ®ç±»å‹è¡¨ç¤ºæ—¥æœŸæˆ–æ—¶é—´æˆ³**\n\n### æ•°å­—\n\næ•°å­—èŒƒå›´\n\n* æ­£æ•°èŒƒå›´ï¼š1E-130 åˆ° 9.9999999999999999999999999999999999999E+125\n* è´Ÿæ•°èŒƒå›´ï¼š-9.9999999999999999999999999999999999999E+125 åˆ° -1E-130\n\n> åœ¨ DynamoDB ä¸­ï¼Œæ•°å­—ä»¥å¯å˜é•¿åº¦å½¢å¼è¡¨ç¤ºã€‚ç³»ç»Ÿä¼šåˆ å‡å¼€å¤´å’Œç»“å°¾çš„ 0ã€‚\n\næ‰€æœ‰æ•°å­—å°†ä½œä¸ºå­—ç¬¦ä¸²é€šè¿‡ç½‘ç»œå‘é€åˆ° DynamoDBï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°æé«˜ä¸åŒè¯­è¨€å’Œåº“ä¹‹é—´çš„å…¼å®¹æ€§ã€‚ä½†æ˜¯ï¼ŒDynamoDB ä¼šå°†å®ƒä»¬è§†ä¸ºæ•°å­—ç±»å‹å±æ€§ä»¥æ–¹ä¾¿æ•°å­¦è¿ç®—ã€‚\n\n**Note**\n\nå¦‚æœæ•°å­—ç²¾åº¦ååˆ†é‡è¦ï¼Œåˆ™åº”ä½¿ç”¨ä»æ•°å­—ç±»å‹è½¬æ¢çš„å­—ç¬¦ä¸²å°†æ•°å­—ä¼ é€’ç»™ DynamoDBã€‚\n\n### äºŒè¿›åˆ¶\n\nå¦‚æœå°†ä¸»é”®å±æ€§å®šä¹‰ä¸ºäºŒè¿›åˆ¶ç±»å‹å±æ€§ï¼Œä»¥ä¸‹é™„åŠ é™åˆ¶å°†é€‚ç”¨ï¼š\n\n* å¯¹äºç®€å•çš„ä¸»é”®ï¼Œç¬¬ä¸€ä¸ªå±æ€§å€¼ï¼ˆåˆ†åŒºé”®ï¼‰çš„æœ€å¤§é•¿åº¦ä¸º 2048 å­—èŠ‚ã€‚\n* å¯¹äºå¤åˆä¸»é”®ï¼Œç¬¬äºŒä¸ªå±æ€§å€¼ï¼ˆæ’åºé”®ï¼‰çš„æœ€å¤§é•¿åº¦ä¸º 1024 å­—èŠ‚ã€‚\n\n> åœ¨å°†äºŒè¿›åˆ¶å€¼å‘é€åˆ° DynamoDB ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»é‡‡ç”¨ Base64 ç¼–ç æ ¼å¼å¯¹å…¶è¿›è¡Œç¼–ç ã€‚æ”¶åˆ°è¿™äº›å€¼åï¼ŒDynamoDB ä¼šå°†æ•°æ®è§£ç ä¸ºæ— ç¬¦å·å­—èŠ‚æ•°ç»„ï¼Œå°†å…¶ç”¨ä½œäºŒè¿›åˆ¶å±æ€§çš„é•¿åº¦ã€‚\n\n### æ–‡æ¡£ç±»å‹\n\næ–‡æ¡£ç±»å‹åŒ…æ‹¬åˆ—è¡¨å’Œæ˜ å°„ã€‚è¿™äº›æ•°æ®ç±»å‹å¯ä»¥äº’ç›¸åµŒå¥—ï¼Œç”¨æ¥è¡¨ç¤ºæ·±åº¦æœ€å¤šä¸º 32 å±‚çš„å¤æ‚æ•°æ®ç»“æ„ã€‚\nåªè¦åŒ…å«å€¼çš„é¡¹ç›®å¤§å°åœ¨ DynamoDB **é¡¹ç›®å¤§å°é™åˆ¶ (400 KB) å†…**ï¼Œåˆ—è¡¨æˆ–æ˜ å°„ä¸­å€¼çš„æ•°é‡å°±æ²¡æœ‰é™åˆ¶ã€‚\n\næ•°æ®ç±»å‹| è¯´æ˜ | ç¤ºä¾‹\n---|---|---\nåˆ—è¡¨ | åˆ—è¡¨ç±»å‹å±æ€§å¯å­˜å‚¨å€¼çš„æœ‰åºé›†åˆã€‚åˆ—è¡¨ç”¨æ–¹æ‹¬å·æ‹¬èµ·ï¼š[ ... ]ã€‚åˆ—è¡¨ç±»ä¼¼äº JSON æ•°ç»„ã€‚åˆ—è¡¨å…ƒç´ ä¸­å¯ä»¥å­˜å‚¨çš„æ•°æ®ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œåˆ—è¡¨å…ƒç´ ä¸­çš„å…ƒç´ ä¹Ÿä¸ä¸€å®šä¸ºç›¸åŒç±»å‹ã€‚| FavoriteThings: [\"Cookies\", \"Coffee\", 3.14159]\næ˜ å°„ | æ˜ å°„ç±»å‹å±æ€§å¯ä»¥å­˜å‚¨åç§°/å€¼å¯¹çš„æ— åºé›†åˆã€‚æ˜ å°„ç”¨å¤§æ‹¬å·æ‹¬èµ·ï¼š{ ... }ã€‚æ˜ å°„ç±»ä¼¼äº JSON å¯¹è±¡ã€‚æ˜ å°„å…ƒç´ ä¸­å¯ä»¥å­˜å‚¨çš„æ•°æ®ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œæ˜ å°„ä¸­çš„å…ƒç´ ä¹Ÿä¸ä¸€å®šä¸ºç›¸åŒç±»å‹ã€‚|ç¤ºä¾‹å¦‚ä¸‹\n\n```\n{\n    Day: \"Monday\",\n    UnreadEmails: 42,\n    ItemsOnMyDesk: [\n        \"Coffee Cup\",\n        \"Telephone\",\n        {\n            Pens: { Quantity : 3},\n            Pencils: { Quantity : 2},\n            Erasers: { Quantity : 1}\n        }\n    ]\n}\n```\n\n#### Note\n\n> DynamoDB è®©æ‚¨å¯ä»¥ä½¿ç”¨æ˜ å°„/åˆ—è¡¨ä¸­çš„å•ä¸ªå…ƒç´ \n\n### é›†\n\nDynamoDB æ”¯æŒè¡¨ç¤ºæ•°å­—ã€å­—ç¬¦ä¸²æˆ–äºŒè¿›åˆ¶å€¼é›†çš„ç±»å‹ã€‚é›†ä¸­çš„æ‰€æœ‰å…ƒç´ å¿…é¡»ä¸ºç›¸åŒç±»å‹ï¼ˆ\n\né›†ä¸­çš„æ¯ä¸ªå€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚é›†ä¸­çš„å€¼çš„é¡ºåºä¸ä¼šä¿ç•™ã€‚ä¸æ”¯æŒç©ºé›†ã€‚\n\n**Example ï¼ˆå­—ç¬¦ä¸²é›†ã€æ•°å­—é›†å’ŒäºŒè¿›åˆ¶é›†ï¼‰**\n\n```\n# å¿…é¡»æ˜¯ç›¸åŒçš„æ•°æ®ç±»å‹\n# å­—ç¬¦ä¸²é›†\n[\"Black\", \"Green\" ,\"Red\"]\n# æ•°å­—é›†\n[42.2, -19, 7.5, 3.14]\n# äºŒè¿›åˆ¶é›†\n[\"U3Vubnk=\", \"UmFpbnk=\", \"U25vd3k=\"]\n```\n\n## DynamoDB API\n\nDynamoDB çš„apiæ“ä½œä¸»è¦ç”¨äºæ§åˆ¶å±‚é¢ã€æ•°æ®å±‚é¢å’ŒDynamoDB Streamsã€‚\n\n### æ§åˆ¶å±‚é¢\n\næ§åˆ¶å±‚é¢ æ“ä½œå¯è®©æˆ‘ä»¬å¯ä»¥åˆ›å»ºå’Œç®¡ç†DynamoDBè¡¨ã€‚å®ƒä»¬è¿˜å¯è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¾èµ–äºè¡¨çš„ç´¢å¼•ã€æµå’Œå…¶ä»–å¯¹è±¡ã€‚\n\n* CreateTable - åˆ›å»ºæ–°è¡¨ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªäºŒçº§ç´¢å¼•å¹¶ä¸ºè¡¨å¯ç”¨ DynamoDB Streamsã€‚\n* DescribeTable - è¿”å›æœ‰å…³è¡¨çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œè¡¨çš„ä¸»é”®æ¶æ„ã€ååé‡è®¾ç½®ã€ç´¢å¼•ä¿¡æ¯ç­‰ã€‚\n* ListTables - è¿”å›åˆ—è¡¨ä¸­æ‰€æœ‰è¡¨çš„åç§°ã€‚\n* UpdateTable - ä¿®æ”¹è¡¨æˆ–å…¶ç´¢å¼•çš„è®¾ç½®ã€åˆ›å»ºæˆ–åˆ é™¤è¡¨ä¸Šçš„æ–°ç´¢å¼•æˆ–ä¿®æ”¹è¡¨çš„ DynamoDB Streams è®¾ç½®ã€‚\n* DeleteTable - ä» DynamoDB ä¸­åˆ é™¤è¡¨åŠå…¶æ‰€æœ‰ä¾èµ–å¯¹è±¡ã€‚\n\n### æ•°æ®å±‚é¢\n\n**æ•°æ®å±‚é¢**æ“ä½œå¯è®©æˆ‘ä»¬å¯¹è¡¨ä¸­çš„æ•°æ®æ‰§è¡Œåˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤ï¼ˆä¹Ÿç§°ä¸º CRUDï¼‰æ“ä½œã€‚æŸäº›æ•°æ®å±‚é¢æ“ä½œè¿˜å¯è®©æˆ‘ä»¬å¯ä»¥ä»secondary indexä¸­è¯»å–æ•°æ®ã€‚\n\n#### åˆ›å»ºæ•°æ®\n\n* PutItem - å°†å•ä¸ªé¡¹ç›®å†™å…¥åˆ°è¡¨ä¸­ã€‚æ‚¨å¿…é¡»æŒ‡å®šä¸»é”®å±æ€§ï¼Œä½†ä¸å¿…æŒ‡å®šå…¶ä»–å±æ€§ã€‚\n* BatchWriteItem - å°†æœ€å¤š 25 ä¸ªé¡¹ç›®å†™å…¥åˆ°è¡¨ä¸­ã€‚\n\n#### è¯»å–æ•°æ®\n\n* GetItem - ä»è¡¨ä¸­æ£€ç´¢å•ä¸ªé¡¹ç›®ã€‚æˆ‘ä»¬å¿…é¡»ä¸ºæ‰€éœ€çš„é¡¹ç›®æŒ‡å®šä¸»é”®ã€‚æˆ‘ä»¬å¯ä»¥æ£€ç´¢æ•´ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ä»…æ£€ç´¢å…¶å±æ€§çš„å­é›†ã€‚\n* BatchGetItem - ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æ£€ç´¢æœ€å¤š 100 ä¸ªé¡¹ç›®ã€‚\n* Query - æ£€ç´¢å…·æœ‰ç‰¹å®šåˆ†åŒºé”®çš„æ‰€æœ‰é¡¹ç›®ã€‚æˆ‘ä»¬å¿…é¡»æŒ‡å®šåˆ†åŒºé”®å€¼ã€‚\n\n  > å¯ä»¥æ£€ç´¢æ•´ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ä»…æ£€ç´¢å…¶å±æ€§çš„å­é›†ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥å¯¹æ’åºé”®å€¼åº”ç”¨æ¡ä»¶ï¼Œä»¥ä¾¿åªæ£€ç´¢å…·æœ‰ç›¸åŒåˆ†åŒºé”®çš„æ•°æ®å­é›†ã€‚æˆ‘ä»¬å¯ä»¥å¯¹è¡¨ä½¿ç”¨æ­¤æ“ä½œï¼Œå‰ææ˜¯è¯¥è¡¨åŒæ—¶å…·æœ‰åˆ†åŒºé”®å’Œæ’åºé”®ã€‚è¿˜å¯ä»¥å¯¹ç´¢å¼•ä½¿ç”¨æ­¤æ“ä½œï¼Œå‰ææ˜¯è¯¥ç´¢å¼•åŒæ—¶å…·æœ‰åˆ†åŒºé”®å’Œæ’åºé”®ã€‚\n\n* Scan - æ£€ç´¢æŒ‡å®šè¡¨æˆ–ç´¢å¼•ä¸­çš„æ‰€æœ‰é¡¹ç›®ã€‚æˆ‘ä»¬å¯ä»¥æ£€ç´¢æ•´ä¸ªé¡¹ç›®ï¼Œä¹Ÿå¯ä»¥ä»…æ£€ç´¢å…¶å±æ€§çš„å­é›†ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åº”ç”¨ç­›é€‰æ¡ä»¶ä»¥ä»…è¿”å›æ„Ÿå…´è¶£çš„å€¼å¹¶æ”¾å¼ƒå‰©ä½™çš„å€¼ã€‚\n\n\n#### æ›´æ–°æ•°æ®\n\n* UpdateItem - ä¿®æ”¹é¡¹ç›®ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ã€‚å¿…é¡»ä¸ºè¦ä¿®æ”¹çš„é¡¹ç›®æŒ‡å®šä¸»é”®ã€‚\n\n  > å¯ä»¥æ·»åŠ æ–°å±æ€§ä»¥åŠä¿®æ”¹æˆ–åˆ é™¤ç°æœ‰å±æ€§ã€‚è¿˜å¯ä»¥æ‰§è¡Œæœ‰æ¡ä»¶æ›´æ–°ã€‚ä¹Ÿå¯ä»¥å®æ–½ä¸€ä¸ªåŸå­è®¡æ•°å™¨ï¼Œè¯¥è®¡æ•°å™¨å¯åœ¨ä¸å¹²é¢„å…¶ä»–å†™å…¥è¯·æ±‚çš„æƒ…å†µä¸‹é€’å¢æˆ–é€’å‡æ•°å­—å±æ€§ã€‚\n\n#### åˆ é™¤æ•°æ®\n\n* DeleteItem - ä»è¡¨ä¸­åˆ é™¤å•ä¸ªé¡¹ç›®ã€‚æ‚¨å¿…é¡»ä¸ºè¦åˆ é™¤çš„é¡¹ç›®æŒ‡å®šä¸»é”®ã€‚\n* BatchWriteItem - ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­åˆ é™¤æœ€å¤š 25 ä¸ªé¡¹ç›®\n\n#### Note\n> Batch æ“ä½œæ¯”è°ƒç”¨å¤šæ¬¡å•ä¸ªè¯·æ±‚ï¼ˆDeleteItem, GetItem, PutItem)æ›´æœ‰æ•ˆï¼Œå› ä¸ºç§©åºä¸€ä¸ªç½‘ç»œè¯·æ±‚å³å¯æ“ä½œå¤šä¸ªé¡¹ç›®ã€‚\n\n### DynamoDB Streams\n\nDynamoDB Streams æ“ä½œå¯å¯¹è¡¨å¯ç”¨æˆ–ç¦ç”¨æµï¼Œå¹¶èƒ½å…è®¸å¯¹åŒ…å«åœ¨æµä¸­çš„æ•°æ®ä¿®æ”¹è®°å½•çš„è®¿é—®ã€‚\n\n* ListStreams - è¿”å›æ‰€æœ‰æµçš„åˆ—è¡¨ï¼Œæˆ–ä»…è¿”å›ç‰¹å®šè¡¨çš„æµã€‚\n* DescribeStream - è¿”å›æœ‰å…³æµçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæµçš„ Amazon èµ„æºåç§° (ARN) å’Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯å¼€å§‹è¯»å–å‰å‡ æ¡æµè®°å½•çš„ä½ç½®ã€‚\n* GetShardIterator - è¿”å›ä¸€ä¸ªåˆ†åŒºè¿­ä»£å™¨ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç”¨æ¥ä»æµä¸­æ£€ç´¢è®°å½•çš„æ•°æ®ç»“æ„ã€‚\n* GetRecords - ä½¿ç”¨ç»™å®šåˆ†åŒºè¿­ä»£å™¨æ£€ç´¢ä¸€æ¡æˆ–å¤šæ¡æµè®°å½•ã€‚\n\n\n## å‘½åè§„åˆ™\n\nDynamoDB ä¸­çš„è¡¨ã€å±æ€§å’Œå…¶ä»–å¯¹è±¡å¿…é¡»å…·æœ‰åç§°ã€‚åç§°åº”è¯¥ç®€æ˜æ‰¼è¦ - ä¾‹å¦‚ï¼ŒProductsã€Books å’Œ Authors ä¹‹ç±»çš„åç§°æ˜¯éƒ½æ˜¯ä¸è¨€è€Œå–»çš„ã€‚\n\nä¸‹é¢æ˜¯ DynamoDB çš„å‘½åè§„åˆ™ï¼š\n\n* æ‰€æœ‰åç§°éƒ½å¿…é¡»ä½¿ç”¨ UTF-8 è¿›è¡Œç¼–ç ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™ã€‚\n* è¡¨åç§°å’Œç´¢å¼•åç§°çš„é•¿åº¦å¿…é¡»ä»‹äº 3 åˆ° 255 ä¸ªå­—ç¬¦ä¹‹é—´ï¼Œè€Œä¸”åªèƒ½åŒ…å«ä»¥ä¸‹å­—ç¬¦ï¼š\n    - a-z\n    - A-Z\n    - 0-9\n    - _ï¼ˆä¸‹åˆ’çº¿ï¼‰\n    - -ï¼ˆçŸ­åˆ’çº¿ï¼‰\n    - .ï¼ˆåœ†ç‚¹ï¼‰\n* å±æ€§åç§°çš„é•¿åº¦å¿…é¡»ä»‹äº 1 åˆ° 255 ä¸ªå­—ç¬¦ä¹‹é—´ã€‚\n\n\n### ä¿ç•™å…³é”®å­—å’Œç‰¹æ®Šå­—ç¬¦\n\nä¸å¾ˆå¤šå…¶ä»–æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç›¸ä¼¼ï¼ŒDynamoDB ä¹Ÿå…·æœ‰ä¸€ç³»åˆ—ä¿ç•™å…³é”®å­—å’Œç‰¹æ®Šå­—ç¬¦ã€‚\n\n* æœ‰å…³ DynamoDB ä¸­çš„ä¿ç•™å…³é”®å­—çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… [DynamoDB ä¸­çš„ä¿ç•™å…³é”®å­—](http://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/ReservedWords.html)ã€‚\n* #ï¼ˆå“ˆå¸Œï¼‰å’Œ :ï¼ˆå†’å·ï¼‰åœ¨ DynamoDB ä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰\n\nDynamoDBå…è®¸ä½¿ç”¨è¿™äº›å…³é”®å­—å’Œç‰¹æ®Šç¬¦å·ç”¨äºå‘½åï¼Œä½†æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆåš\n\næœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [ä¸ºå±æ€§åç§°å’Œå€¼ä½¿ç”¨å ä½ç¬¦](http://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/ExpressionPlaceholders.html)ã€‚\n\n\n## è¯»å–ä¸€è‡´æ€§\n\nAmazon DynamoDB åœ¨å…¨ä¸–ç•Œå¤šä¸ª AWS åŒºåŸŸå¯ç”¨ã€‚æ¯ä¸ªåŒºåŸŸå‡ä¸å…¶ä»– AWS åŒºåŸŸå®Œå…¨ç‹¬ç«‹å’Œéš”ç¦»ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ us-east-1 åŒºåŸŸæœ‰ä¸€ä¸ªåä¸º People çš„è¡¨ï¼Œå¹¶åœ¨ us-west-2 åŒºåŸŸæœ‰å¦ä¸€ä¸ªåä¸º People çš„è¡¨ï¼Œåˆ™è¿™ä¸¤ä¸ªè¡¨å°†è¢«è§†ä¸ºå®Œå…¨ç‹¬ç«‹çš„è¡¨ã€‚\n\næ¯ä¸ª AWS åŒºåŸŸåŒ…å«å¤šä¸ªä¸åŒçš„ç§°ä¸ºâ€œå¯ç”¨åŒºâ€çš„ä½ç½®ã€‚æ¯ä¸ªå¯ç”¨åŒºéƒ½è¢«è®¾è®¡æˆä¸å—å…¶ä»–å¯ç”¨åŒºæ•…éšœçš„å½±å“ï¼Œå¹¶æä¾›ä½ä»·ã€ä½å»¶è¿Ÿçš„ç½‘ç»œè¿æ¥ï¼Œä»¥è¿æ¥åˆ°åŒä¸€åŒºåŸŸå…¶ä»–å¯ç”¨åŒºã€‚æ­¤è®¾è®¡å¯ä¿è¯æˆ‘ä»¬å¯ä»¥åœ¨æŸä¸ªåŒºåŸŸçš„å¤šä¸ªå¯ç”¨åŒºä¸­å¿«é€Ÿå¤åˆ¶æ•°æ®ã€‚\n\nå½“æˆ‘ä»¬å°†æŸä¸ªæ•°æ®å†™å…¥ DynamoDB è¡¨å¹¶æ”¶åˆ° HTTP 200 å“åº” (OK) æ—¶ï¼Œè¯¥æ•°æ®çš„æ‰€æœ‰å‰¯æœ¬éƒ½ä¼šæ›´æ–°ã€‚ä½†æ˜¯ï¼Œè¦å°†æ•°æ®ä¼ æ’­åˆ°å½“å‰ AWS åŒºåŸŸå†…çš„æ‰€æœ‰å­˜å‚¨ä½ç½®éœ€è¦è€—è´¹ä¸€å®šçš„æ—¶é—´ã€‚è¯¥æ•°æ®æœ€ç»ˆå°†åœ¨ä¸Šè¿°æ‰€æœ‰å­˜å‚¨ä½ç½®ä¸­ä¿æŒä¸€è‡´ï¼Œé€šå¸¸åªéœ€ä¸€ç§’æˆ–æ›´çŸ­æ—¶é—´ã€‚\n\nä¸ºäº†æ”¯æŒå„ç§åº”ç”¨ç¨‹åºè¦æ±‚ï¼ŒDynamoDB åŒæ—¶æ”¯æŒ**æœ€ç»ˆä¸€è‡´æ€§** **è¯»å–å’Œå¼ºä¸€è‡´æ€§** è¯»å–ã€‚\n\n#### æœ€ç»ˆä¸€è‡´æ€§è¯»å–\n\nå½“æˆ‘ä»¬ä» DynamoDB è¡¨ä¸­è¯»å–æ•°æ®æ—¶ï¼Œè¿”å›çš„å¯èƒ½ä¸æ˜¯åˆšåˆšå®Œæˆçš„å†™å…¥æ“ä½œçš„ç»“æœã€‚å“åº”å¯èƒ½åŒ…å«æŸäº›æ—§çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨çŸ­æ—¶é—´åé‡å¤è¯»å–è¯·æ±‚ï¼Œå“åº”å°†è¿”å›æœ€æ–°çš„æ•°æ®ã€‚\n\n#### å¼ºä¸€è‡´æ€§è¯»å–\n\nå½“æˆ‘ä»¬è¯·æ±‚å¼ºä¸€è‡´æ€§è¯»å–æ—¶ï¼ŒDynamoDB ä¼šè¿”å›å…·æœ‰æœ€æ–°æ•°æ®çš„å“åº”ï¼Œä»è€Œåæ˜ æ¥è‡ªæ‰€æœ‰å·²æˆåŠŸçš„ä¹‹å‰å†™å…¥æ“ä½œçš„æ›´æ–°ã€‚ä½†æ˜¯ï¼Œ**å¦‚æœç½‘ç»œå»¶è¿Ÿæˆ–ä¸­æ–­ï¼Œå¯èƒ½ä¼šæ— æ³•æ‰§è¡Œå¼ºä¸€è‡´æ€§è¯»å–**ã€‚\n\n##### Note\n\nDynamoDB é»˜è®¤ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§è¯»å–ã€‚è¯»å–æ“ä½œï¼ˆä¾‹å¦‚ GetItemã€Query å’Œ Scanï¼‰æä¾›äº†ä¸€ä¸ª ConsistentRead å‚æ•°ï¼šæ­¤å‚æ•°è®¾ç½®ä¸º trueï¼ŒDynamoDB å°†åœ¨æ“ä½œè¿‡ç¨‹ä¸­ä½¿ç”¨å¼ºä¸€è‡´æ€§è¯»å–ã€‚\n\nç¤ºä¾‹ï¼š\n\n```\n{\n    TableName: \"Music\",\n    Key: {\n        \"Artist\": \"No One You Know\",\n        \"SongTitle\": \"Call Me Today\"\n    },\n    ConsistentRead: true\n}\n```\n\n#### python ç¤ºä¾‹\n\n```\ntable = db3.Table('Music')\nresponse = table.get_item(\n    Key={\n        \"Artist\": \"The Acme Band\",\n        \"SongTitle\": \"Still In Love\"\n    },\n    ConsistentRead=True\n)\n```\n\n[åŸæ–‡é“¾æ¥](http://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751935&idx=2&sn=23943243c2f5a5a1efdff4fb5308e8ab&chksm=80b0b9d5b7c730c3e7d1115665d63cb47c79ad514a070de205ade4312048598f3c05b0067caa#rd)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨2ï¼š å·¥ä½œåŸç†ã€APIå’Œæ•°æ®ç±»å‹ä»‹ç»",
        "date": "2017-01-09 14:37:11",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-how-it-works"
    },
    {
      "content": "\n### æœ¬èŠ‚ä¸»è¦ä»‹ç»AmazonDynamoDB å®‰è£…é…ç½®åŠPythonå¼€å‘ç¤ºä¾‹\"\n\n## ä»€ä¹ˆæ˜¯ Amazon DynamoDB\nAmazon DynamoDB æ˜¯ä¸€ç§å®Œå…¨æ‰˜ç®¡çš„ NoSQL æ•°æ®åº“æœåŠ¡ï¼Œæä¾›å¿«é€Ÿè€Œå¯é¢„æµ‹çš„æ€§èƒ½ï¼Œèƒ½å¤Ÿå®ç°æ— ç¼æ‰©å±•ã€‚ä½¿ç”¨ DynamoDBï¼Œæ‚¨å¯ä»¥å…é™¤æ“ä½œå’Œæ‰©å±•åˆ†å¸ƒå¼æ•°æ®åº“çš„ç®¡ç†å·¥ä½œè´Ÿæ‹…ï¼Œå› è€Œæ— éœ€æ‹…å¿ƒç¡¬ä»¶é¢„ç½®ã€è®¾ç½®å’Œé…ç½®ã€å¤åˆ¶ã€è½¯ä»¶ä¿®è¡¥æˆ–é›†ç¾¤æ‰©å±•ç­‰é—®é¢˜ã€‚\n\nä½¿ç”¨ DynamoDBï¼Œæ‚¨å¯ä»¥åˆ›å»ºæ•°æ®åº“è¡¨æ¥å­˜å‚¨å’Œæ£€ç´¢ä»»æ„é‡çº§çš„æ•°æ®ï¼Œå¹¶æä¾›ä»»æ„çº§åˆ«çš„è¯·æ±‚æµé‡ã€‚æ‚¨å¯ä»¥æ‰©å±•æˆ–ç¼©å‡æ‚¨çš„è¡¨çš„ååå®¹é‡ï¼Œè€Œä¸ä¼šå¯¼è‡´åœæœºæˆ–æ€§èƒ½ä¸‹é™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ AWS ç®¡ç†æ§åˆ¶å°æ¥ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µå’Œå„ç§æ€§èƒ½æŒ‡æ ‡ã€‚\n\nHUGOMORE42\n\n## Amazon DynamoDB ç‰¹ç‚¹\n\nDynamoDB ä¼šè‡ªåŠ¨å°†æ•°æ®å’Œæµé‡åˆ†æ•£åˆ°è¶³å¤Ÿæ•°é‡çš„æœåŠ¡å™¨ä¸Šï¼Œä»¥æ»¡è¶³ååé‡å’Œå­˜å‚¨éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒå§‹ç»ˆå¦‚ä¸€çš„é«˜æ€§èƒ½ã€‚æ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨å›ºæ€ç¡¬ç›˜ (SSD) ä¸­ï¼Œå¹¶ä¼šè‡ªåŠ¨å¤åˆ¶åˆ° AWS åŒºåŸŸä¸­çš„å¤šä¸ªå¯ç”¨åŒºä¸­ï¼Œä»è€Œæä¾›å†…ç½®çš„é«˜å¯ç”¨æ€§å’Œæ•°æ®æŒä¹…æ€§ã€‚\n\nDynamoDB æ˜¯ NoSQL æ•°æ®åº“å¹¶ä¸”æ— æ¶æ„ï¼Œè¿™æ„å‘³ç€ï¼Œä¸ä¸»é”®å±æ€§ä¸åŒï¼Œæ— éœ€åœ¨åˆ›å»ºè¡¨æ—¶å®šä¹‰ä»»ä½•å±æ€§æˆ–æ•°æ®ç±»å‹ã€‚ä¸æ­¤ç›¸å¯¹ï¼Œå…³ç³»æ•°æ®åº“è¦æ±‚åœ¨åˆ›å»ºè¡¨æ—¶å®šä¹‰æ¯ä¸ªåˆ—çš„åç§°å’Œæ•°æ®ç±»å‹ã€‚\n\n## Amazon DynamoDB ä½¿ç”¨\n\n### AWS é…ç½®\n\n1. æ³¨å†Œ Amazon Web Services å¹¶åˆ›å»ºè®¿é—®å¯†é’¥\n2. åˆ›å»º AWS å‡­è¯æ–‡ä»¶\n3. å¼€å¯DynamoDB æœåŠ¡\n\n### åœ¨è®¡ç®—æœºä¸Šè¿è¡Œ DynamoDB\n\né™¤äº† Amazon DynamoDB Web æœåŠ¡ä¹‹å¤–ï¼ŒAWS è¿˜æä¾›å¯æœ¬åœ°è¿è¡Œçš„å¯ä¸‹è½½ç‰ˆæœ¬çš„ DynamoDBã€‚\nä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬ï¼Œåœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶æ— éœ€ Internet è¿æ¥ã€‚\n\n#### æ–¹æ³•1 ç›´æ¥åœ¨è®¡ç®—æœºä¸Šå®‰è£…\n\n> éœ€è¦å®‰è£…javaç¯å¢ƒ\n\n1. ä¸‹è½½ DynamoDB\n2. è§£å‹ï¼Œå¹¶å°†è§£å‹åçš„ç›®å½•å¤åˆ¶åˆ°æŸä¸ªä½ç½®\n3. æ‰“å¼€å‘½ä»¤æç¤ºç¬¦çª—å£ï¼Œæ‰“å¼€ DynamoDBLocal.jar çš„ç›®å½•ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\njava -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar -sharedDb\n```\n\nç°åœ¨å°±å¯ä»¥ä½¿ç”¨äº†\n\n**å‘½ä»¤è¡Œé€‰é¡¹**\n\nDynamoDB æ¥å—ä»¥ä¸‹å‘½ä»¤å‚æ•°ï¼š\n\n* -cors value - å¯ç”¨é€‚ç”¨äº JavaScript çš„ CORS æ”¯æŒï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰ã€‚æ‚¨å¿…é¡»æä¾›ç‰¹å®šåŸŸçš„é€—å·åˆ†éš”â€œå…è®¸â€åˆ—è¡¨ã€‚-cors çš„é»˜è®¤è®¾ç½®æ˜¯æ˜Ÿå· (*)ï¼Œè¿™å°†å…è®¸å…¬å¼€è®¿é—®ã€‚\n* -dbPath value - DynamoDB å°†ç”¨äºå†™å…¥å…¶æ•°æ®åº“æ–‡ä»¶çš„ç›®å½•ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹ï¼Œåˆ™æ–‡ä»¶å°†å†™å…¥å½“å‰ç›®å½•ã€‚è¯·æ³¨æ„ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®š -dbPath å’Œ -inMemoryã€‚\n* -delayTransientStatuses - ä½¿ DynamoDB ä¸ºæŸäº›æ“ä½œå¼•å…¥å»¶è¿Ÿã€‚DynamoDB å‡ ä¹å¯ä»¥å³æ—¶æ‰§è¡ŒæŸäº›ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œå¯¹è¡¨å’Œç´¢å¼•æ‰§è¡Œåˆ›å»º/æ›´æ–°/åˆ é™¤æ“ä½œï¼›ä½†æ˜¯ï¼Œå®é™… DynamoDB æœåŠ¡éœ€è¦æ›´å¤šæ—¶é—´æ‰èƒ½å®Œæˆè¿™äº›ä»»åŠ¡ã€‚è®¾ç½®æ­¤å‚æ•°æœ‰åŠ©äº DynamoDB æ›´é€¼çœŸåœ°æ¨¡æ‹Ÿ Amazon DynamoDB Web æœåŠ¡çš„è¡Œä¸ºã€‚ï¼ˆç›®å‰ï¼Œæ­¤å‚æ•°ä»…ä¸ºå¤„äº CREATING æˆ– DELETING çŠ¶æ€çš„global secondary indexå¼•å…¥å»¶è¿Ÿã€‚ï¼‰\n* -help â€“ æ‰“å°ä½¿ç”¨æ‘˜è¦å’Œé€‰é¡¹ã€‚\n* -inMemory â€“ DynamoDB å°†åœ¨å†…å­˜ä¸­è¿è¡Œï¼Œè€Œä¸ä½¿ç”¨æ•°æ®åº“æ–‡ä»¶ã€‚åœæ­¢ DynamoDB æ—¶ï¼Œä¸ä¼šä¿å­˜ä»»ä½•æ•°æ®ã€‚è¯·æ³¨æ„ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®š -dbPath å’Œ -inMemoryã€‚\n* -optimizeDbBeforeStartup â€“ åœ¨è®¡ç®—æœºä¸Šå¯åŠ¨ DynamoDB ä¹‹å‰ä¼˜åŒ–åº•å±‚æ•°æ®åº“è¡¨ã€‚ä½¿ç”¨æ­¤å‚æ•°æ—¶ï¼Œå¿…é¡»è¿˜è¦æŒ‡å®š -dbPathã€‚\n* -port value - DynamoDB å°†ç”¨äºä¸åº”ç”¨ç¨‹åºé€šä¿¡çš„ç«¯å£å·ã€‚å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹ï¼Œåˆ™é»˜è®¤ç«¯å£æ˜¯ 8000\n* -sharedDb - DynamoDB å°†ä½¿ç”¨å•ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œè€Œä¸æ˜¯é’ˆå¯¹æ¯ä¸ªè¯ä¹¦å’ŒåŒºåŸŸä½¿ç”¨ä¸åŒçš„æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®š -sharedDbï¼Œé‚£ä¹ˆæ‰€æœ‰ DynamoDB å®¢æˆ·ç«¯éƒ½å°†ä¸åŒä¸€ç»„è¡¨äº¤äº’ï¼Œæ— è®ºå…¶åŒºåŸŸå’Œè¯ä¹¦é…ç½®å¦‚ä½•ã€‚\n\n[è¯¦ç»†é…ç½®å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£](http://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/DynamoDBLocal.html?shortFooter=true)\n\n#### æ–¹æ³•2 ä½¿ç”¨dockerå®‰è£…\n\n> éœ€è¦å®‰è£…docker\n\næ–¹æ³•ä¸€éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é…ç½®ï¼Œæ“ä½œä¹Ÿéº»çƒ¦ï¼Œå¦‚æœå–œæ¬¢dockerï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨dockerå¿«é€Ÿæ­å»ºæœ¬åœ°ç¯å¢ƒ\n\n```\n1. ä¸‹è½½é•œåƒ\n\ndocker pull ryanratcliff/dynamodb\n\n2. å¯åŠ¨\n\ndocker run -d -p 8000:8000 ryanratcliff/dynamodb\n\n```\n\n[è¯¦ç»†é…ç½®å¯å‚è€ƒ](https://github.com/RyanRatcliff/docker_dynamodb)\n\n\n### Python ä½¿ç”¨ DynamoDB\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‚ç”¨äº Python (Boto 3) çš„ AWS å¼€å‘å·¥å…·åŒ…è¿›è¡Œå¼€å‘ã€‚\n\n1. å®‰è£…boto3\n\n```\npip install boto3\n```\n\n2. ä½¿ç”¨ AWS CLI é…ç½®ç§˜é’¥\n\n```\n# å®‰è£…awscli\nsudo pip install awscli\n# æµ‹è¯•awscli å®‰è£…\naws help\n# è¾“å…¥å‘½ä»¤\naws configure\n# é…ç½® Access Key ID å’Œ Secret Access Key\n\nAWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE\nAWS Secret Access Key [None]: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\nDefault region name [None]: us-west-2\nDefault output format [None]: ENTER\n# è¦æ›´æ–°ä»»ä½•è®¾ç½®ï¼Œåªéœ€å†æ¬¡è¿è¡Œ aws configure å¹¶æ ¹æ®éœ€è¦è¾“å…¥æ–°å€¼ã€‚\n```\n\nCLI å°†ä½¿ç”¨ aws configure æŒ‡å®šçš„è¯ä¹¦å­˜å‚¨åœ¨æ‚¨ä¸»ç›®å½•ä¸­åä¸º .aws çš„æ–‡ä»¶å¤¹ä¸­åä¸º credentials çš„æœ¬åœ°æ–‡ä»¶ä¸­\nå¯ä»¥ä½¿ç”¨ ä»¥ä¸‹å‘½ä»¤åˆ—å‡º .aws æ–‡ä»¶å¤¹å†…å®¹ï¼š\nLinux, OS X, or Unix\n```\n$ ls  ~/.aws\n```\n[å…·ä½“é…ç½®å‚è€ƒå®˜æ–¹æ–‡æ¡£](http://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-getting-started.html?shortFooter=true)\n\n\n3. ä½¿ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯• DynamoDB æ˜¯å¦å¯ç”¨\n\n```\nimport boto3\ndb3 = boto3.resource('dynamodb', endpoint_url='http://localhost:8000', aws_secret_access_key='ticTacToeSampleApp', aws_access_key_id='ticTacToeSampleApp', region_name='us-west-2')\n\ndb3.meta.client.list_tables()\n\n# output\n\n{\n\t'ResponseMetadata': {\n\t    'HTTPHeaders': {\n\t    \t'content-length': '32',\n            'content-type': 'application/x-amz-json-1.0',\n            'server': 'Jetty(8.1.12.v20130726)',\n            'x-amz-crc32': '2024476575',\n            'x-amzn-requestid': '5f0a974a-8900-470d-8b28-a4207247c65e'\n\t    },\n        'HTTPStatusCode': 200,\n        'RequestId': '5f0a974a-8900-470d-8b28-a4207247c65e',\n        'RetryAttempts': 0\n\t},\n    'TableNames': []\n}\n\n```\n\nå¦‚æœè¾“å‡ºä»¥ä¸Šå†…å®¹ï¼Œåˆ™è¯´æ˜DynamoDB æ­£å¸¸ã€‚\n\n[åŸæ–‡é“¾æ¥](http://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751935&idx=1&sn=21e6b4ebe22a18b65c6f5e7b457782f9&chksm=80b0b9d5b7c730c308ef87f324b814d9bdfd573bfdfc68c4c3b9e9f014f68b2bb19d87cdc06b#rd)\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨1ï¼šé…ç½®ï¼ˆæœ¬åœ°ï¼‰åŠpythonç¤ºä¾‹",
        "date": "2017-01-07 14:57:39",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-install-and-setting"
    },
    {
      "content": "\n# ä»è¡¨ä¸­åˆ é™¤æ•°æ®\n\n> ä¸Šä¸€ç¯‡ä»‹ç»äº†DynamoDB çš„æ›´æ–°ï¼Œè¿™ä¸€ç¯‡å°†ä¼šä»‹ç»é¡¹ç›®åˆ é™¤æ“ä½œå’Œdynamoab-py\n\n\nåœ¨ SQL ä¸­ï¼ŒDELETE è¯­å¥ä»è¡¨ä¸­åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œã€‚*DynamoDB ä½¿ç”¨ DeleteItem æ“ä½œä¸€æ¬¡åˆ é™¤ä¸€ä¸ªé¡¹ç›®ã€‚*\n\n### SQL\n\nåœ¨ SQL ä¸­ï¼Œå¯ä½¿ç”¨ DELETE è¯­å¥åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªè¡Œã€‚WHERE å­å¥ç¡®å®šè¦ä¿®æ”¹çš„è¡Œã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\nDELETE FROM Music\nWHERE Artist = 'The Acme Band' AND SongTitle = 'Look Out, World';\næˆ‘ä»¬å¯ä»¥ä¿®æ”¹ WHERE å­å¥ä»¥åˆ é™¤å¤šä¸ªè¡Œã€‚ä¾‹å¦‚ï¼Œåˆ é™¤æŸä¸ªç‰¹æ®Šè‰ºæœ¯å®¶çš„æ‰€æœ‰æ­Œæ›²ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\nDELETE FROM Music WHERE Artist = 'The Acme Band'\n\n#### Note\nå¦‚æœçœç•¥ WHERE å­å¥ï¼Œåˆ™æ•°æ®åº“ä¼šå°è¯•ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰è¡Œã€‚\n\n### DynamoDB\n\nåœ¨ DynamoDB ä¸­ï¼Œå¯ä½¿ç”¨ DeleteItem æ“ä½œä¿®æ”¹å•ä¸ªé¡¹ç›®ã€‚\n\n(http://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/APIReference/API_DeleteItem.html?shortFooter=true)[API è¯­æ³•å¦‚ä¸‹]ï¼š\n\n```json\n{\n   \"ConditionExpression\": \"string\",\n   \"ExpressionAttributeNames\": {\n      \"string\" : \"string\"\n   },\n   \"ExpressionAttributeValues\": {\n      \"string\" : {\n         \"B\": blob,\n         \"BOOL\": boolean,\n         \"BS\": [ blob ],\n         \"L\": [\n            \"AttributeValue\"\n         ],\n         \"M\": {\n            \"string\" : \"AttributeValue\"\n         },\n         \"N\": \"string\",\n         \"NS\": [ \"string\" ],\n         \"NULL\": boolean,\n         \"S\": \"string\",\n         \"SS\": [ \"string\" ]\n      }\n   },\n   \"Key\": {\n      \"string\" : {\n         \"B\": blob,\n         \"BOOL\": boolean,\n         \"BS\": [ blob ],\n         \"L\": [\n            \"AttributeValue\"\n         ],\n         \"M\": {\n            \"string\" : \"AttributeValue\"\n         },\n         \"N\": \"string\",\n         \"NS\": [ \"string\" ],\n         \"NULL\": boolean,\n         \"S\": \"string\",\n         \"SS\": [ \"string\" ]\n      }\n   },\n   \"ReturnConsumedCapacity\": \"string\",\n   \"ReturnItemCollectionMetrics\": \"string\",\n   \"ReturnValues\": \"string\",\n   \"TableName\": \"string\"\n}\n```\n\nå‚æ•°è¯´æ˜ï¼š\n\n- Key: ä¸»é”®ï¼Œç”¨äºå®šä½é¡¹ç›®\n- TableNameï¼šè¡¨å ï¼ˆæœ€å° 3. æœ€å¤§ 255ï¼‰\n- ConditionExpressionï¼šæ¡ä»¶è¡¨è¾¾å¼ï¼ˆä»…åœ¨ç‰¹å®š ConditionExpression çš„è®¡ç®—ç»“æœä¸º true æ—¶æˆåŠŸå®Œæˆï¼‰\n- ExpressionAttributeNamesï¼šæ¡ä»¶è¡¨è¾¾å¼çš„åç§°çš„åˆ«åï¼Œæ¯”å¦‚ date ä¸ºä¿ç•™å­—ï¼Œå¯ç”¨åˆ«åå®šä¹‰ä¸º #d\n- ExpressionAttributeValuesï¼šæ¡ä»¶è¡¨è¾¾å¼çš„å€¼\n- ReturnConsumedCapacityï¼šæ˜¾ç¤ºä½¿ç”¨çš„å†™å…¥å®¹é‡å•ä½æ•°\n    - TOTAL ä¼šè¿”å›ç”±è¡¨åŠå…¶æ‰€æœ‰global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n    - INDEXES ä»…è¿”å›ç”±global secondary indexå ç”¨çš„å†™å…¥å®¹é‡ï¼›\n    - NONE è¡¨ç¤ºæ‚¨ä¸éœ€è¦è¿”å›ä»»ä½•å ç”¨å®¹é‡ç»Ÿè®¡æ•°æ®ã€‚\n- ReturnValues: æ›´æ–°åè¿”å›çš„æ•°æ®.\n    - NONE - å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œè¿”å›None (è¿™ä¸ªæ˜¯é»˜è®¤å€¼)\n    - ALL_OLD - æŒ‰åœ¨è¿›è¡Œæ›´æ–°ä¹‹å‰çš„æƒ…å†µï¼Œè¿”å›æ•´ä¸ªé¡¹ç›®ã€‚\n- ReturnItemCollectionMetricsï¼š Determines whether item collection metrics are returned. If set to SIZE , the response includes statistics about item collections, if any, that were modified during the operation are returned in the response. If set to NONE (the default), no statistics are returned.\n\n(http://boto3.readthedocs.io/en/stable/reference/services/dynamodb.html?highlight=dynamodb#DynamoDB.Table.delete_item)[boto3è¯­æ³•å¦‚ä¸‹]\n\n```python\nresponse = table.delete_item(\n    Key={\n        'string': 'string'|123|Binary(b'bytes')|True|None|set(['string'])|set([123])|set([Binary(b'bytes')])|[]|{}\n    },\n    ConditionalOperator='AND'|'OR',\n    ReturnValues='NONE'|'ALL_OLD'|'UPDATED_OLD'|'ALL_NEW'|'UPDATED_NEW',\n    ReturnConsumedCapacity='INDEXES'|'TOTAL'|'NONE',\n    ReturnItemCollectionMetrics='SIZE'|'NONE',\n    ConditionExpression=Attr('myattribute').eq('myvalue'),\n    ExpressionAttributeNames={\n        'string': 'string'\n    },\n    ExpressionAttributeValues={\n        'string': 'string'|123|Binary(b'bytes')|True|None|set(['string'])|set([123])|set([Binary(b'bytes')])|[]|{}\n    }\n)\n```\n\nåœ¨ DynamoDB ä¸­ï¼Œå¯ä½¿ç”¨ DeleteItem æ“ä½œä»è¡¨ä¸­åˆ é™¤æ•°æ®ï¼ˆä¸€æ¬¡åˆ é™¤ä¸€ä¸ªé¡¹ç›®ï¼‰ã€‚å¿…é¡»æŒ‡å®šé¡¹ç›®çš„ä¸»é”®å€¼ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```python\n{\n    TableName: \"Music\",\n    Key: {\n        Artist: \"The Acme Band\",\n        SongTitle: \"Look Out, World\"\n    }\n}\n```\n\n#### Note\n\né™¤äº† DeleteItem ä¹‹å¤–ï¼ŒAmazon DynamoDB è¿˜æ”¯æŒåŒæ—¶åˆ é™¤å¤šä¸ªé¡¹ç›®çš„ BatchWriteItem æ“ä½œã€‚\n\nDeleteItem æ”¯æŒæ¡ä»¶å†™å…¥ï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œæ“ä½œä»…åœ¨ç‰¹å®š ConditionExpression çš„è®¡ç®—ç»“æœä¸º true æ—¶æˆåŠŸå®Œæˆã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ DeleteItem æ“ä½œä»…åœ¨é¡¹ç›®å…·æœ‰ RecordLabel å±æ€§æ—¶åˆ é™¤é¡¹ç›®ï¼š\n\n```python\n{\n    TableName: \"Music\",\n    Key: {\n        Artist: \"The Acme Band\",\n        SongTitle: \"Look Out, World\"\n    },\n   ConditionExpression: \"attribute_exists(RecordLabel)\"\n}\n```\n\nåˆ é™¤æ“ä½œå°±è¿™ä¹ˆç®€å•ï¼Œä¸‹è¾¹æ˜¯ç¦åˆ©æ—¶é—´ã€‚\n\næ˜¯ä¸æ˜¯æ¯æ¬¡ç”¨boto3 æ“ä½œDynamoDB éƒ½æœ‰ç§ç—›ä¸æ¬²ç”Ÿçš„æ„Ÿè§‰ï¼Œä¸‹è¾¹æˆ‘ä»¬ä»‹ç»ä¸€ä¸ªæ–°å·¥å…·ã€‚\n\n### [dynamodb-py](https://github.com/gusibi/dynamodb-p)\n\ndynamodb-py  æ˜¯æ¨¡ä»¿sqlalchemy ç¼–å†™çš„DynamoDB ORM å®ƒçš„ä½¿ç”¨æ–¹æ³•ç‰¹åˆ«ç®€å•ï¼Œä¸‹è¾¹æ¥çœ‹å‡ ä¸ªç¤ºä¾‹ï¼š\n\n##### è¡¨çš„æ“ä½œ\n\n```python\nfrom dynamodb.model import Model\nfrom dynamodb.fields import CharField, IntegerField, FloatField, DictField\nfrom dynamodb.table import Table\n\nclass Movies(Model):\n\n    __table_name__ = 'Movies'\n\n    ReadCapacityUnits = 10\n    WriteCapacityUnits = 10\n\n    year = IntegerField(name='year', hash_key=True)\n    title = CharField(name='title', range_key=True)\n    rating = FloatField(name='rating', indexed=True)\n    rank = IntegerField(name='rank', indexed=True)\n    release_date = CharField(name='release_date')\n    info = DictField(name='info', default={})\n\n# create_table\nTable(Movies()).create()\n\n# update_table\nTable(Movies()).update()\n\n# delete_table\nTable(Movies()).delete()\n\n```\n\n##### æŸ¥è¯¢é¡¹ç›®\n\n```python\n# query without index\nitems = Movies.query().where(Movies.year.eq(year)).all()\nitems = Movies.query().where(Movies.year.eq(1985)).limit(10).all()\nitems = (Movies.query()\n        .where(Movies.year.eq(1992),\n               Movies.title.between('A', 'L'))\n        .all())\n\n# query with index\nitems = (Movies.query()\n        .where(Movies.year.eq(1992),\n               Movies.title.between('A', 'L'))\n        .order_by(Movies.rating, asc=False)\n        .all())\n```\n\n##### æ›´æ–°é¡¹ç›®\n\n\n```python\nitem = Movies.get(year=year, title=title)\n\nitem.update(rank=2467, rating=7.1)\n```\n\n##### åˆ é™¤é¡¹ç›®\n\n```python\nitem = Movies.get(year=year, title=title)\n\nitem.delete()\n```\n\nå°±æ˜¯è¿™ä¹ˆæ–¹ä¾¿ã€‚\n\nä¸è¿‡[dynamodb-py](https://github.com/gusibi/dynamodb-p) è¿˜åœ¨å¼€å‘ä¸­ï¼Œæ¬¢è¿è¯•ç”¨ï¼Œä¹Ÿæ¬¢è¿è´¡çŒ®è‡ªå·±çš„åŠ›é‡ã€‚\n\n> ç»ˆäºï¼Œä¸‹ä¸€èŠ‚ä»‹ç»ç´¢å¼•çš„æŸ¥è¯¢\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Amazon DynamoDB å…¥é—¨8ï¼šåˆ é™¤é¡¹ç›®",
        "date": "2017-01-03 14:37:11",
        "tags": [
          "AWS",
          "nosql",
          "DynamoDB",
          "python",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "Amazon-DynamoDB-Delete-Item"
    },
    {
      "content": "\n## æ§åˆ¶æµ\n\nä¸Šä¸€ç¯‡æˆ‘ä»¬äº†è§£äº†golang çš„å˜é‡ã€å‡½æ•°å’ŒåŸºæœ¬ç±»å‹ï¼Œè¿™ä¸€ç¯‡å°†ä»‹ç»ä¸€ä¸‹æ§åˆ¶æµ\n\nç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­:\n\nHUGOMORE42\n\n### fibonacci(é€’å½’ç‰ˆ)\n\n```go\n    01 package main\n    02\n    03 import \"fmt\"\n    04\n    05 func main() {\n    06     result := 0\n    07     for i := 0; i <= 10; i++ {\n    08\t     result = fibonacci(i)\n    09\t     fmt.Printf(\"fibonacci(%d) is: %d\\n\", i, result)\n    10\t  }\n    11 }\n    12\n    13 func fibonacci(n int) (res int) {\n    14     if n <= 1 {\n    15         res = 1\n    16 \t   } else {\n    17 \t       res = fibonacci(n-1) + fibonacci(n-2)\n    18 \t   }\n    19 \treturn\n    20 }\n\n    // outputs\n\n    fibonacci(0) is: 1\n    fibonacci(1) is: 1\n    fibonacci(2) is: 2\n    fibonacci(3) is: 3\n    fibonacci(4) is: 5\n    fibonacci(5) is: 8\n    fibonacci(6) is: 13\n    fibonacci(7) is: 21\n    fibonacci(8) is: 34\n    fibonacci(9) is: 55\n    fibonacci(10) is: 89\n```\n\n\n* for i := 0; i <= 10; i++ {} ç¬¬7è¡Œæ˜¯ä¸€ä¸ªå¾ªç¯ç»“æ„ è¿™é‡Œfor å¾ªç¯æ˜¯ä¸€ä¸ªæ§åˆ¶æµ\n\n### æ§åˆ¶æµ\n#### For\n\nGo åªæœ‰ä¸€ç§å¾ªç¯æ¥å£-- for å¾ªç¯\n\nFor æ”¯æŒä¸‰ç§å¾ªç¯æ–¹å¼,åŒ…æ‹¬ç±» while è¯­æ³•\n\n#### 1 åŸºæœ¬forå¾ªç¯ æ”¯æŒåˆå§‹åŒ–è¯­å¥\n```go\n    s := \"abc\"\n    for i, n := 0, len(s); i < n; i++ {\n    \t// i, n ä¸ºå®šä¹‰çš„å˜é‡ åªåœ¨for å¾ªç¯å†…ä½œç”¨\n        println(s[i])\n    }\n```\n\n*åŸºæœ¬çš„ for å¾ªç¯åŒ…å«ä¸‰ä¸ªç”±åˆ†å·åˆ†å¼€çš„ç»„æˆéƒ¨åˆ†ï¼š*\n\n* åˆå§‹åŒ–è¯­å¥ï¼šåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯æ‰§è¡Œå‰è¢«æ‰§è¡Œ\n* å¾ªç¯æ¡ä»¶è¡¨è¾¾å¼ï¼šæ¯è½®è¿­ä»£å¼€å§‹å‰è¢«æ±‚å€¼\n* åç½®è¯­å¥ï¼šæ¯è½®è¿­ä»£åè¢«æ‰§è¡Œ\n\n#### 2 æ›¿ä»£ while (n > 0) {}\nC çš„ while åœ¨ Go ä¸­å«åš for\n```go\n    n := len(s)\n\t// å¾ªç¯åˆå§‹åŒ–è¯­å¥å’Œåç½®è¯­å¥éƒ½æ˜¯å¯é€‰çš„ã€‚\n    for n > 0 { // ç­‰åŒäº for (; n > 0;) {}\n        println(s[n])\n        n--\n    }\n```\n\n#### 3 æ­»å¾ªç¯\n```go\n    for { // while true\n        println(s)\n    }\n```\n\n#### IF\n\n> å°±åƒ for å¾ªç¯ä¸€æ ·ï¼ŒGo çš„ if è¯­å¥ä¹Ÿä¸è¦æ±‚ç”¨ ( ) å°†æ¡ä»¶æ‹¬èµ·æ¥ï¼ŒåŒæ—¶ï¼Œ { } è¿˜æ˜¯å¿…é¡»æœ‰çš„\n\n* å¯çœç•¥æ¡ä»¶è¡¨è¾¾å¼æ‹¬å·\n* æ”¯æŒåˆå§‹åŒ–è¯­å¥,å¯å®šä¹‰ä»£ç å—å±€éƒ¨å˜é‡\n* ä»£ç å—å·¦å¤§æ‹¬å·å¿…é¡»åœ¨æ¡ä»¶è¡¨è¾¾å¼å°¾éƒ¨\n\n```go\n    x := 0\n\n    // if x > 10  // Error: missing condition in if statement(å·¦å¤§æ‹¬å·å¿…é¡»åœ¨æ¡ä»¶è¡¨è¾¾å¼å°¾éƒ¨)\n    // {\n    // }\n\n    if n := \"abc\"; x > 0 {  // åˆå§‹åŒ–è¯­å¥(åœ¨è¿™é‡Œæ˜¯å®šä¹‰å˜é‡)\n    \tprintln(n[2])\n    } else if x < 0 {\n    \tprintln(n[1])\n    } else {\n    \tprintln(n[0])\n    }\n```\n\n> if è¯­å¥å®šä¹‰çš„å˜é‡ä½œç”¨åŸŸä»…åœ¨ifèŒƒå›´ä¹‹å†…(åŒ…å«elseè¯­å¥)\n> ä¸æ”¯æŒä¸‰å…ƒæ“ä½œç¬¦ \"a > b ? a : b\"\n\nä»¥ä¸Šæ˜¯ä¸Šæ®µä»£ç å‡ºç°çš„ä¸¤ä¸ªæ§åˆ¶æµï¼Œå‰©ä¸‹çš„æ§åˆ¶æµè¿˜æœ‰\n\n* Switch\n* Range\n* Goto, Break, Continue, defer\n\n#### Switch\n\nswitch è¯­æ³•å¦‚ä¸‹ï¼š\n\n```go\n    switch optionalStatement; optionalExpression{\n\t\tcase expressionList1: block1\n\t\t...\n\t\tcase expressionListN: blockN\n\t\tdefault: blockD\n\t}\n```\n\nå…ˆçœ‹ä¸€ä¸ªä¾‹å­:\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"runtime\"\n)\n\nfunc main() {\n\tfmt.Print(\"Go runs on \")\n\tswitch os := runtime.GOOS; os {\n\t\tcase \"darwin\":\n\t\t\tfmt.Println(\"OS X.\")\n\t\tcase \"linux\":\n\t\t\tfmt.Println(\"Linux.\")\n\t\tdefault:\n\t\t\t// freebsd, openbsd,\n\t\t\t// plan9, windows...\n\t\t\tfmt.Printf(\"%s.\", os)\n\t\t}\n}\n```\n\n* å¦‚æœæœ‰å¯é€‰è¯­å¥å£°æ˜, åˆ†å·æ˜¯å¿…è¦çš„, æ— è®ºåè¾¹çš„å¯é€‰è¡¨è¾¾å¼è¯­å¥æ˜¯å¦å‡ºç°(å¦‚æœå¯é€‰è¯­å¥æ²¡æœ‰å‡ºç°é»˜è®¤ä¸ºtrue)\n* æ¯ä¸€ä¸ªcase è¯­å¥å¿…é¡»è¦æœ‰ä¸€ä¸ªè¡¨è¾¾å¼åˆ—è¡¨ï¼Œå¤šä¸ªç”¨åˆ†å·éš”å¼€\n* switch è¯­å¥è‡ªä¸Šè€Œä¸‹æ‰§è¡Œï¼Œå½“åŒ¹é…æˆåŠŸåæ‰§è¡Œcaseåˆ†æ”¯çš„ä»£ç å—ï¼Œæ‰§è¡Œç»“æŸåé€€å‡ºswitch\n```go\n    switch i {\n        case 0: // ç©ºåˆ†æ”¯ï¼Œåªæœ‰å½“ i == 0 æ—¶æ‰ä¼šè¿›å…¥åˆ†æ”¯\n        case 1:\n            f() // å½“ i == 0 æ—¶å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨\n    }\n```\n\n* å¦‚æœæƒ³è¦åœ¨æ‰§è¡Œå®Œæ¯ä¸ªåˆ†æ”¯çš„ä»£ç åè¿˜ç»§ç»­æ‰§è¡Œåç»­çš„åˆ†æ”¯ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨fallthrough å…³é”®å­—è¾¾åˆ°ç›®çš„\n\n```go\n    package main\n\n    import \"fmt\"\n\n    func switch1(n int) {\n    \tswitch { // è¿™é‡Œç”¨çš„æ˜¯æ²¡æœ‰æ¡ä»¶çš„switch è¯­å¥ä¼šç›´æ¥æ‰§è¡Œ\n    \tcase n == 0:\n    \t\tfmt.Println(0)\n    \t\tfallthrough\n    \tcase n == 1: // å¦‚æœåŒ¹é…åˆ°0 è¿™é‡Œä¼šç»§ç»­æ‰§è¡Œ\n    \t\tfmt.Println(1)\n    \tcase n == 2: // fallthrough ä¸ä¼šå¯¹è¿™é‡Œæœ‰ä½œç”¨\n    \t\tfmt.Println(2)\n    \tdefault:\n    \t\tfmt.Println(\"default\")\n    \t}\n    }\n\n    func main() {\n    \tswitch1(0)\n    }\n    # output\n    0\n\t1\n```\n* ç”¨ default å¯ä»¥æŒ‡å®šå½“å…¶ä»–æ‰€æœ‰åˆ†æ”¯éƒ½ä¸åŒ¹é…çš„æ—¶å€™çš„è¡Œä¸º\n```go\n    switch i {\n    \tcase 0:\n    \tcase 1:\n    \t\tf()\n    \tdefault:\n    \t\tg()  // å½“iä¸ç­‰äº0 æˆ– 1 æ—¶è°ƒç”¨\n    }\n```\n\n#### Range\n\n> Range ç±»ä¼¼è¿­ä»£å™¨çš„æ“ä½œï¼Œè¿”å›(ç´¢å¼•ï¼Œå€¼)æˆ–(å¥ï¼Œå€¼)\n\nå®ƒå¯ä»¥è¿­ä»£ä»»ä½•ä¸€ä¸ªé›†åˆï¼ˆåŒ…æ‹¬æ•°ç»„å’Œ mapï¼‰\n\nåŸºæœ¬è¯­æ³•å¦‚ä¸‹:\n```go\nfor ix, val := range coll {\n...\n}\n\n```\n\nval å§‹ç»ˆä¸ºé›†åˆä¸­å¯¹åº”ç´¢å¼•çš„å€¼æ‹·è´ï¼Œå› æ­¤å®ƒä¸€èˆ¬åªå…·æœ‰åªè¯»æ€§è´¨ï¼Œå¯¹å®ƒæ‰€åšçš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šå½±å“åˆ°é›†åˆä¸­åŸæœ‰çš„å€¼ï¼ˆè¯‘è€…æ³¨ï¼šå¦‚æœ val ä¸ºæŒ‡é’ˆï¼Œåˆ™ä¼šäº§ç”ŸæŒ‡é’ˆçš„æ‹·è´ï¼Œä¾æ—§å¯ä»¥ä¿®æ”¹é›†åˆä¸­çš„åŸå€¼\nä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ Unicode ç¼–ç çš„å­—ç¬¦ï¼ˆæˆ–ç§°ä¹‹ä¸º runeï¼‰é›†åˆï¼Œå› æ­¤æ‚¨ä¹Ÿå¯ä»¥ç”¨å®ƒè¿­ä»£å­—ç¬¦ä¸²\n\nä¸‹é¢æ˜¯æ¯ç§æ•°æ®ç±»å‹ä½¿ç”¨rangeæ—¶ ixå’Œval çš„å€¼\n\n|            |ix       |val       | å€¼ç±»å‹\n|:-------    |:------  |:-------  |:-------      |\n|string      | index   | s[index] | unicode, rune\n|array/slice | index   | s[index] |\n|map         | key     | m[index] |\n|channel     | element |          |\n\n\n#### Break continue\n\nbreak å’Œ continue éƒ½å¯åœ¨å¤šçº§åµŒå¥—å¾ªç¯ä¸­è·³å‡º (å’Œpythonä¸­çš„ç”¨æ³•åŸºæœ¬ä¸€è‡´)\n\n> break å¯ç”¨äº forã€switchã€select,  continue ä»…èƒ½ äº for å¾ªç¯\n\n\n#### defer\n\ndefer è¯­å¥ä¼šå»¶è¿Ÿå‡½æ•°çš„æ‰§è¡Œç›´åˆ°ä¸Šå±‚å‡½æ•°è¿”å›\n\nå»¶è¿Ÿè°ƒç”¨çš„å‚æ•°ä¼šç«‹åˆ»ç”Ÿæˆï¼Œä½†æ˜¯åœ¨ä¸Šå±‚å‡½æ•°è¿”å›å‰å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tdefer fmt.Println(\"world\")\n\n\tfmt.Println(\"hello\")\n}\n\n// output\nhello\nworld\n```\n\n*defer æ ˆ*\n\nå»¶è¿Ÿçš„å‡½æ•°è°ƒç”¨è¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚å½“å‡½æ•°è¿”å›æ—¶ï¼Œ ä¼šæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºè°ƒç”¨è¢«å»¶è¿Ÿçš„å‡½æ•°è°ƒç”¨ã€‚\ndefer å¸¸ç”¨æ¥å®šä¹‰ç®€å•çš„æ–¹æ³•\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"counting\")\n\n\tfor i := 0; i < 10; i++ {\n\t\t\tdefer fmt.Println(i)\n\t\t}\n\n\t\tfmt.Println(\"done\")\n}\n// å¯ä»¥æƒ³ä¸€ä¸‹ä¼šè¾“å‡ºä»€ä¹ˆ\n// ä»£ç æ‰§è¡Œ https://tour.go-zh.org/flowcontrol/13\n```\n\n*å…³é”®å­— defer å…è®¸æˆ‘ä»¬è¿›è¡Œä¸€äº›å‡½æ•°æ‰§è¡Œå®Œæˆåçš„æ”¶å°¾å·¥ä½œï¼Œä¾‹å¦‚ï¼š*\n\n* å…³é—­æ–‡ä»¶æµï¼š\n\n    // open a file defer file.Close()\n\n* è§£é”ä¸€ä¸ªåŠ é”çš„èµ„æº\n\n    mu.Lock() defer mu.Unlock()\n\n* æ‰“å°æœ€ç»ˆæŠ¥å‘Š\n\n    printHeader() defer printFooter()\n\n* å…³é—­æ•°æ®åº“é“¾æ¥\n\n\t// open a database connection defer disconnectFromDB()\n\nåˆç†ä½¿ç”¨ defer è¯­å¥èƒ½å¤Ÿä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ã€‚\n\nä¸‹é¢çš„ä»£ç å±•ç¤ºäº†åœ¨è°ƒè¯•æ—¶ä½¿ç”¨ defer è¯­å¥çš„æ‰‹æ³•\n\n```go\npackage main\n\nimport (\n\t\"io\"\n    \"log\"\n)\n\nfunc func1(s string) (n int, err error) {\n    defer func() {\n\t        log.Printf(\"func1(%q) = %d, %v\", s, n, err)\n\t    }()\n    return 7, io.EOF\n}\n\nfunc main() {\n    func1(\"Go\")\n}\n\n// è¾“å‡º\nOutput: 2016/04/25 10:46:11 func1(\"Go\") = 7, EOF\n```\n\n[æ›´å¤šdefer çš„ç”¨æ³•](https://blog.go-zh.org/defer-panic-and-recover)\n\n#### goto\n\ngoto è¯­å¥å¯ä»¥é…åˆæ ‡ç­¾ï¼ˆlabelï¼‰å½¢å¼çš„æ ‡è¯†ç¬¦ä½¿ç”¨ï¼Œå³æŸä¸€è¡Œç¬¬ä¸€ä¸ªä»¥å†’å·ï¼ˆ:ï¼‰ç»“å°¾çš„å•è¯\n\n```go\npackage main\n\nfunc main() {\n    i:=0\n    HERE:\n\t    print(i)\n\t\ti++\n        if i==5 {\n\t        return\n\t    }\n        goto HERE\n}\n# output 01234\n```\n\n> ä½¿ç”¨æ ‡ç­¾å’Œ goto è¯­å¥æ˜¯ä¸è¢«é¼“åŠ±çš„ï¼šå®ƒä»¬ä¼šå¾ˆå¿«å¯¼è‡´éå¸¸ç³Ÿç³•çš„ç¨‹åºè®¾è®¡ï¼Œè€Œä¸”æ€»æœ‰æ›´åŠ å¯è¯»çš„æ›¿ä»£æ–¹æ¡ˆæ¥å®ç°ç›¸åŒçš„éœ€æ±‚ã€‚\n\nforã€switch æˆ– select è¯­å¥éƒ½å¯ä»¥é…åˆæ ‡ç­¾ï¼ˆlabelï¼‰å½¢å¼çš„æ ‡è¯†ç¬¦ä½¿ç”¨\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\nLABEL1:\n    for i := 0; i <= 5; i++ {\n\t\tfor j := 0; j <= 5; j++ {\n\t\t\tif j == 4 {\n\t\t\t\tcontinue LABEL1\n\t\t\t}\n\t\t\tfmt.Printf(\"i is: %d, and j is: %d\\n\", i, j)\n\t\t}\n\t}\n}\n\n```\n\n> continue è¯­å¥æŒ‡å‘ LABEL1ï¼Œå½“æ‰§è¡Œåˆ°è¯¥è¯­å¥çš„æ—¶å€™ï¼Œå°±ä¼šè·³è½¬åˆ° LABEL1 æ ‡ç­¾çš„ä½ç½®\n\n\n### å‚è€ƒé“¾æ¥\n\n[Go æŒ‡å—](https://tour.go-zh.org/flowcontrol/1)\n[The way to go -- æ§åˆ¶ç»“æ„](https://github.com/Unknwon/the-way-to-go_ZH_CN/blob/master/eBook/05.0.md)\n[Effective Go](https://golang.org/doc/effective_go.html)\n\nåˆ°è¿™é‡Œç®€å•çš„æ§åˆ¶æµç”¨æ³•è®²è§£å°±ç»“æŸäº†\n\nä¸‹èŠ‚å°†ä¼šæ˜¯golang æ•°æ®ç»“æ„éƒ¨åˆ†, ä¼šç”¨åˆ°çš„ä»£ç ä¸º\n\n### fibonacci(å†…å­˜ç‰ˆ)\n\n```go\n    package main\n\n    import (\n        \"fmt\"\n        \"time\"\n    )\n\n    const LIM = 41\n\n    var fibs [LIM]uint64\n\n    func main() {\n        var result uint64 = 0\n        start := time.Now()\n        for i := 0; i < LIM; i++ {\n    \t\tresult = fibonacci(i)\n    \t\tfmt.Printf(\"fibonacci(%d) is: %d\\n\", i, result)\n        }\n        end := time.Now()\n        delta := end.Sub(start)\n        fmt.Printf(\"longCalculation took this amount of time: %s\\n\", delta)\n    }\n    func fibonacci(n int) (res uint64) {\n        // memoization: check if fibonacci(n) is already known in array:\n        if fibs[n] != 0 {\n    \t\tres = fibs[n]\n    \t\treturn\n        }\n        if n <= 1 {\n    \t\tres = 1\n        } else {\n    \t\tres = fibonacci(n-1) + fibonacci(n-2)\n        }\n        fibs[n] = res\n        return\n    }\n```\n\n---------------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "è·Ÿç€ä»£ç å­¦go 002 -- æ§åˆ¶æµ",
        "date": "2016-04-26 07:49:35",
        "tags": [
          "golang",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "golang-learning-by-code-002"
    },
    {
      "content": "\n## å˜é‡&å‡½æ•°\n\næœ€è¿‘åœ¨å­¦ä¹ golangï¼Œå†™ä¸‹å­¦ä¹ ç¬”è®°æå‡è®°å¿†ã€‚\nä¸ºäº†çœ‹èµ·æ¥ä¸æ˜¯é‚£ä¹ˆæ¯ç‡¥ï¼Œæœ¬å­¦ä¹ ç¬”è®°é‡‡ç”¨åˆ†æä»£ç çš„å½¢å¼ã€‚\n\né¦–å…ˆæ¬å‡ºæˆ‘ä»¬æœ€ç»å…¸çš„ç¬¬ä¸€æ®µä»£ç :\n\n\n### hello world\n\n```go\n    package main // 0\n\n    import \"fmt\" // 1å®ç°æ ¼å¼åŒ–çš„ I/O\n\n    /* Print something */ // 2\n    func main() { // 3\n    \tfmt.Println(\"Hello, world; or ÎºÎ±Î»Î·Î¼Îµ ÌÏÎ± ÎºoÌÏƒÎ¼Îµ; orã“ã‚“ã«ã¡ã¯ ä¸–ç•Œ\") // 4\n    }\n```\n\né¦–å…ˆæˆ‘ä»¬è¦è®¤è¯†åˆ°\n> æ¯ä¸ªGo ç¨‹åºéƒ½æ˜¯ç”±åŒ…ç»„æˆï¼Œç¨‹åºçš„è¿è¡Œå…¥å£æ˜¯åŒ…main\n\n0. é¦–è¡Œè¿™ä¸ªæ˜¯å¿…é¡»çš„ã€‚æ‰€æœ‰çš„ Go æ–‡ä»¶ä»¥ package <something> å¼€å¤´,å¯¹äºç‹¬ç«‹è¿è¡Œçš„æ‰§è¡Œæ–‡ä»¶å¿…é¡»æ˜¯ package main;\n1. è¿™æ˜¯è¯´éœ€è¦å°†fmtåŠ å…¥åˆ°mainã€‚ä¸æ˜¯main çš„åŒ…è¢«ç§°ä¸ºåº“ æœ«å°¾ä»¥ // å¼€å¤´çš„å†…å®¹æ˜¯å•è¡Œæ³¨é‡Š Package fmtåŒ…å«æœ‰æ ¼å¼åŒ–I/Oå‡½æ•°ï¼Œç±»ä¼¼äºCè¯­è¨€çš„printfå’Œscanf\n2. è¿™ä¹Ÿæ˜¯æ³¨é‡Šï¼Œè¡¨ç¤ºå¤šè¡Œæ³¨é‡Šã€‚\n3. package main å¿…é¡»é¦–å…ˆå‡ºç°,ç´§è·Ÿç€æ˜¯ importã€‚åœ¨ Go ä¸­,package æ€»æ˜¯é¦–å…ˆå‡ºç°, ç„¶åæ˜¯ import,ç„¶åæ˜¯å…¶ä»–æ‰€æœ‰å†…å®¹ã€‚å½“ Go ç¨‹åºåœ¨æ‰§è¡Œçš„æ—¶å€™,é¦–å…ˆè°ƒç”¨çš„å‡½æ•° æ˜¯ main.main(),è¿™æ˜¯ä» C ä¸­ç»§æ‰¿è€Œæ¥ã€‚è¿™é‡Œå®šä¹‰äº†è¿™ä¸ªå‡½æ•°\n4. è°ƒç”¨äº†æ¥è‡ªäº fmt åŒ…çš„å‡½æ•°æ‰“å°å­—ç¬¦ä¸²åˆ°å±å¹•ã€‚å­—ç¬¦ä¸²ç”± \" åŒ…è£¹,å¹¶ä¸”å¯ä»¥åŒ…å«é ASCII çš„å­—ç¬¦ã€‚è¿™é‡Œä½¿ç”¨äº†å¸Œè…Šæ–‡å’Œæ—¥æ–‡ã€ä¸­æ–‡\"\n\n### ç¼–è¯‘å’Œè¿è¡Œä»£ç \n\næ„å»º Go ç¨‹åºçš„æœ€ä½³é€”å¾„æ˜¯ä½¿ç”¨ go å·¥å…·ã€‚ æ„å»º helloworld åªéœ€è¦:\n\n```\n    1. go build helloworld.go\n    # ç»“æœæ˜¯å«åš helloworld çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\n    2. ./helloworld\n    # Hello, world; or ÎºÎ±Î»Î·Î¼Îµ ÌÏÎ± ÎºoÌÏƒÎ¼Îµ; or ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ\n```\n\n\n### å˜é‡\n\nGo æ˜¯é™æ€ç±»å‹è¯­è¨€ ,ä¸èƒ½åœ¨è¿è¡ŒæœŸæ”¹å˜å˜é‡ç±»å‹ã€‚\n\nè‡ªåŠ¨åˆå§‹åŒ–ä¸ºé›¶å€¼ã€‚å¦‚æœæä¾›åˆå§‹åŒ–å€¼,å¯çœç•¥å˜é‡ç±»å‹,ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ã€‚\n\n```go\n    var x int\n    // ä½¿ç”¨å…³é”®å­— var å®šä¹‰å˜é‡, è·Ÿå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€æ ·ï¼Œç±»å‹åœ¨åé¢ã€‚\n    var c, python, java bool\n    // å¤šä¸ªç›¸åŒç±»å‹çš„å˜é‡å¯ä»¥å†™åœ¨ä¸€è¡Œã€‚\n    var f float32 = 1.6\n    var i, j int = 1, 2\n    // å˜é‡å®šä¹‰å¯ä»¥åŒ…å«åˆå§‹å€¼ï¼Œæ¯ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ªã€‚\n    var s = \"abc\"\n    // å¦‚æœåˆå§‹åŒ–æ˜¯ä½¿ç”¨è¡¨è¾¾å¼ï¼Œåˆ™å¯ä»¥çœç•¥ç±»å‹ï¼›å˜é‡ä»åˆå§‹å€¼ä¸­è·å¾—ç±»å‹ã€‚\n```go\n\nå˜é‡åœ¨å®šä¹‰æ—¶æ²¡æœ‰æ˜ç¡®çš„åˆå§‹åŒ–æ—¶ä¼šèµ‹å€¼ä¸º*é›¶å€¼* ã€‚\n\né›¶å€¼æ˜¯ï¼š\n\n* æ•°å€¼ç±»å‹ä¸º 0 ï¼Œ\n* å¸ƒå°”ç±»å‹ä¸º false ï¼Œ\n* å­—ç¬¦ä¸²ä¸º \"\" ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ã€‚\n\nåœ¨å‡½æ•°å†…éƒ¨,å¯ç”¨æ›´ç®€ç•¥çš„ \":=\"  å¼å®šä¹‰å˜é‡ã€‚\n\n```go\n    func main() {\n        n, s := 12, \"Hello, World!\"\n        println(s, n)\n    }\n```\n\n> å‡½æ•°å¤–çš„æ¯ä¸ªè¯­å¥éƒ½å¿…é¡»ä»¥å…³é”®å­—å¼€å§‹ï¼ˆ var ã€ func ã€ç­‰ç­‰ï¼‰ï¼Œ := ç»“æ„ä¸èƒ½ä½¿ç”¨åœ¨å‡½æ•°å¤–ã€‚\n\nå¯ä¸€æ¬¡å®šä¹‰å¤šä¸ªå˜é‡ã€‚\n\n```go\n    var x, y, z int\n    var s, n = \"abc\", 123\n    var (\n    \ta int\n    \tb float32\n    )\n\n    func main() {\n        n, s := 0x1234, \"Hello, World!\"\n        println(x, s, n)\n    }\n```go\n\nä¸€ä¸ªç‰¹æ®Šçš„å˜é‡åæ˜¯ \\_(ä¸‹åˆ’çº¿)ã€‚ä»»ä½•èµ‹ç»™å®ƒçš„å€¼éƒ½è¢«ä¸¢å¼ƒã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­,å°† 35 èµ‹å€¼ç»™ b,åŒæ—¶ä¸¢å¼ƒ 34ã€‚\n\n```go\n    _, b := 34, 35\n```go\n\nGo çš„ç¼–è¯‘å™¨ä¼šå¯¹å£°æ˜å´æœªä½¿ç”¨çš„å˜é‡æŠ¥é”™\n\n```go\n    var s string // å…¨å±€å˜é‡æ²¡é—®é¢˜ã€‚\n\n    func main() {\n        i := 0 // Error: i declared and not usedã€‚(å¯ä½¿  \"_ = i\" è§„é¿)\n    }\n```go\n\nå®šä¹‰å®Œä¹‹åçš„å˜é‡å¯ä»¥è¢«é‡æ–°èµ‹å€¼ æ¯”å¦‚ç¬¬8è¡Œï¼Œå°†è®¡ç®—ç»“æœèµ‹å€¼ç»™result\n\n#### å¸¸é‡\n\n> å¸¸é‡å€¼å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¯ç¡®å®šçš„æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€‚\n\nå¸¸é‡çš„å®šä¹‰ä¸å˜é‡ç±»ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨ const å…³é”®å­—\n\n```go\n    const x, y int = 1, 2\n    const s = \"Hello, World!\"\n    // å¤šå¸¸é‡åˆå§‹åŒ– // ç±»å‹æ¨æ–­\n    // å¸¸é‡ç»„\n    const (\n    \ta, b = 10, 100\n    \tc bool = false\n    )\n\n    func main() _{\n    \tconst x = 'xxx'      // æœªä½¿ç”¨å±€éƒ¨å¸¸é‡ä¸ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯\n    }\n```go\n\nåœ¨å¸¸é‡ä¸­ï¼Œå¦‚æœä¸æä¾›ç±»å‹å’Œåˆå§‹åŒ–å€¼ï¼Œé‚£ä¹ˆè¢«çœ‹ä½œå’Œä¸Šä¸€å¸¸é‡ç›¸åŒ\n\n```go\n    const (\n\t\ts = \"abc\"\n\t\tx           // x = \"abc\"\n\t)\n```go\n\n#### åŸºæœ¬ç±»å‹\n\nGo æœ‰æ˜ç¡®çš„æ•°å­—ç±»å‹å‘½å, æ”¯æŒ Unicode, æ”¯æŒå¸¸ç”¨æ•°æ®ç»“æ„\n\n|ç±»å‹          | é•¿åº¦   | é»˜è®¤å€¼| è¯´æ˜|\n|:-------      |:-----  | :---- | :----   |\n|bool          | 1      | false |\n|byte          | 1      | 0     | unit8\n|rune          | 4      | 0     | int32 çš„åˆ«å ä»£è¡¨ä¸€ä¸ªUnicode ç \n|int, unit     | 4 æˆ– 8 | 0     | 32 æˆ– 64\n|int8, unit8   | 1      | 0     | -128 ~ 127, 0~255\n|int16, unit16 | 2      | 0     | -32768 ~ 32767, 0 ~ 65535\n|int32, unit32 | 4      | 0     | -21äº¿~ 21äº¿, 0 ~ 42äº¿\n|int64, unit64 | 8      | 0     |\n|float32       | 4      | 0.0   |\n|float64       | 8      | 0.0   |\n|complex64     | 8      |       |\n|complex128    | 16     |       |\n|unitptr       | 4æˆ–8   |       | è¶³ä»¥å­˜å‚¨æŒ‡é’ˆçš„unit32 æˆ–unit64 æ•´æ•°\n|array         |        |       | å€¼ç±»å‹\n|struct        |        |       | å€¼ç±»å‹\n|string        |        | \"\"    | UTF-8 å­—ç¬¦ä¸²\n|slice         |        | nil   | å¼•ç”¨ç±»å‹\n|map           |        | nil   | å¼•ç”¨ç±»å‹\n|channel       |        | nil   | å¼•ç”¨ç±»å‹\n|interface     |        | nil   | æ¥å£\n|function      |        | nil   | å‡½æ•°\n\n> intï¼Œuint å’Œ uintptr ç±»å‹åœ¨32ä½çš„ç³»ç»Ÿä¸Šä¸€èˆ¬æ˜¯32ä½ï¼Œè€Œåœ¨64ä½ç³»ç»Ÿä¸Šæ˜¯64ä½ã€‚å½“ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ•´æ•°ç±»å‹æ—¶ï¼Œä½ åº”è¯¥é¦–é€‰ intï¼Œä»…å½“æœ‰ç‰¹åˆ«çš„ç†ç”±æ‰ä½¿ç”¨å®šé•¿æ•´æ•°ç±»å‹æˆ–è€…æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚\n> å¼•ç”¨ç±»å‹åŒ…æ‹¬ sliceã€map å’Œ channelã€‚å®ƒä»¬æœ‰å¤æ‚çš„å†…éƒ¨ç»“æ„,é™¤äº†ç”³è¯·å†…å­˜å¤–,è¿˜éœ€è¦åˆå§‹åŒ–ç›¸å…³å±æ€§\n\n\n#### ç±»å‹è½¬æ¢\n\nä¸æ”¯æŒéšå¼çš„ç±»å‹è½¬æ¢\n\nè¡¨è¾¾å¼ T(v) å°†å€¼ v è½¬æ¢ä¸ºç±»å‹ T ã€‚\n\n```go\n\nvar b byte = 100\n// var n int = b // Error: cannot use b (type byte) as type int in assignment\nvar n int = int(b) // æ˜¾å¼è½¬æ¢\n\n```go\n\nä¸èƒ½å°†å…¶ä»–ç±»å‹å½“ bool å€¼ä½¿ç”¨\n\n```go\na := 100\nif a {                  // Error: non-bool a (type int) used as if condition\n    println(\"true\")\n}\n```\n\n### å‡½æ•°\n\né¦–å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç \n\n```go\n    package main\n\n    import \"fmt\"\n\n    func add(x int, y int) int {\n    \treturn x + y\n    }\n\n    func main() {\n    \tfmt.Println(add(42, 13))\n    }\n```\n\n#### å‡½æ•°å®šä¹‰\n\n> ä½¿ç”¨å…³é”®å­— func å®šä¹‰å‡½æ•°,å·¦å¤§æ‹¬å·ä¸èƒ½å¦èµ·ä¸€è¡Œ\n\ngolangä¸­ç¬¦åˆè§„èŒƒçš„å‡½æ•°ä¸€èˆ¬å†™æˆå¦‚ä¸‹çš„å½¢å¼ï¼š\n\n```go\n    func functionName(parameter_list) (return_value_list) {\n       â€¦\n    }\n\n    // parameter_list æ˜¯å‚æ•°åˆ—è¡¨\n    // return_value_list æ˜¯è¿”å›å€¼åˆ—è¡¨ ä¸‹è¾¹æœ‰è¯¦ç»†çš„è®²è§£\n```\n\n#### å‡½æ•°çš„ç‰¹æ€§\n\n* æ— éœ€å£°æ˜åŸå‹ã€‚ (1)\n* æ”¯æŒä¸å®šé•¿å˜å‚ã€‚\n* æ”¯æŒå¤šè¿”å›å€¼ã€‚\n* æ”¯æŒå‘½åè¿”å›å‚æ•°ã€‚\n* æ”¯æŒåŒ¿åå‡½æ•°å’Œé—­åŒ…ã€‚\n* ä¸æ”¯æŒ åµŒå¥— (nested)ã€é‡è½½ (overload) å’Œ é»˜è®¤å‚æ•° (default parameter)\n\n```go\n    func test(x int, y int, s string) (r int, s string) { // ç±»å‹ç›¸åŒçš„ç›¸é‚»å‚æ•°å¯åˆå¹¶\n        n := x + y                                    // å¤šè¿”å›å€¼å¿…é¡»ç”¨æ‹¬å·ã€‚\n        return n, fmt.Sprintf(s, n)\n    }\n\n    /*\n    å…³é”®å­— func ç”¨äºå®šä¹‰ä¸€ä¸ªå‡½æ•°\n    test æ˜¯ä½ å‡½æ•°çš„åå­—\n    intç±»å‹çš„å˜é‡x, y å’Œstringç±»å‹çš„å˜é‡sä½œä¸ºè¾“å…¥å‚æ•° å‚æ•°ç”¨pass-by-valueæ–¹å¼ä¼ é€’,æ„å‘³ç€å®ƒä»¬ä¼šè¢«å¤åˆ¶\n    å½“ä¸¤ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„å‡½æ•°å‘½åå‚æ•°æ˜¯åŒä¸€ç±»å‹ï¼Œåˆ™é™¤äº†æœ€åä¸€ä¸ªç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–éƒ½å¯ä»¥çœç•¥ã€‚\n\n    åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š\n\n        x int, y int\n\n    è¢«ç¼©å†™ä¸º\n\n        x, y int\n\n    å˜é‡ r å’Œ s æ˜¯è¿™ä¸ªå‡½æ•°çš„ å‘½åè¿”å›å€¼ã€‚åœ¨ Go çš„å‡½æ•°ä¸­å¯ä»¥è¿”å›å¤šä¸ªå€¼\n    å¦‚æœä¸æƒ³å¯¹è¿”å›çš„å‚æ•°å‘½å,åªéœ€è¦æä¾›ç±»å‹:(int, string)ã€‚ å¦‚æœåªæœ‰ä¸€ä¸ªè¿”å›å€¼,å¯ä»¥çœç•¥åœ†æ‹¬å·ã€‚å¦‚æœå‡½æ•°æ˜¯ä¸€ä¸ªå­è¿‡ç¨‹,å¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿”å›å€¼,ä¹Ÿå¯ä»¥çœç•¥è¿™äº›å†…å®¹\n    å‡½æ•°ä½“ã€‚æ³¨æ„ return æ˜¯ä¸€ä¸ªè¯­å¥,æ‰€ä»¥åŒ…è£¹å‚æ•°çš„æ‹¬å·æ˜¯å¯é€‰çš„\n    */\n```\n\nä¸å®šé•¿å‚æ•°å…¶å®å°±æ˜¯sliceï¼Œåªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸”å¿…é¡»æ˜¯æœ€åä¸€ä¸ª\n\n```go\n    func test(s string, n ...int) string {\n        var x int\n    \t\tfor _, i := range n {\n    \t\t\t x += i\n    \t\t}\n    \treturn fmt.Sprintf(s, x)\n    }\n    // ä½¿ç”¨slice åšå˜å‚æ—¶ï¼Œå¿…é¡»å±•å¼€\n    func main() {\n        s := []int{1, 2, 3}\n        println(test(\"sum: %d\", s...))\n    }\n```\n\n> å‡½æ•°æ˜¯ç¬¬ä¸€ç±»å¯¹è±¡,å¯ä½œä¸ºå‚æ•°ä¼ é€’\n\nå°±åƒå…¶ä»–åœ¨ Go ä¸­çš„å…¶ä»–ä¸œè¥¿ä¸€æ ·,å‡½æ•°ä¹Ÿæ˜¯å€¼è€Œå·²ã€‚å®ƒä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·èµ‹å€¼ç»™å˜é‡:\n\n```go\n    func main() {\n        a := func() {                  // å®šä¹‰ä¸€ä¸ªåŒ¿åå‡½æ•°,å¹¶ä¸”èµ‹å€¼ç»™ a\n    \t\tprintln(\"Hello\")\n    \t}                              // è¿™é‡Œæ²¡æœ‰ ()\n        a()                            // è°ƒç”¨å‡½æ•°\n    }\n```\n\nå¦‚æœä½¿ç”¨ fmt.Printf(\"\\%T\\n\", a) æ‰“å° a çš„ç±»å‹,è¾“å‡ºç»“æœæ˜¯ func()\n\n#### è¿”å›å€¼\n\nå‡½æ•°å¯ä»¥è¿”å›ä»»æ„æ•°é‡è¿”å›å€¼\n\nGo å‡½æ•°çš„è¿”å›å€¼æˆ–è€…ç»“æœå‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªåå­—,å¹¶ä¸”åƒåŸå§‹çš„å˜é‡é‚£æ ·ä½¿ç”¨,å°±åƒ è¾“å…¥å‚æ•°é‚£æ ·ã€‚å¦‚æœå¯¹å…¶å‘½å,åœ¨å‡½æ•°å¼€å§‹æ—¶,å®ƒä»¬ä¼šç”¨å…¶ç±»å‹çš„é›¶å€¼åˆå§‹åŒ–\n\n```go\n    package main\n\n    import \"fmt\"\n\n    func swap(x, y string) (string, string) {\n    \treturn y, x\n    }\n\n    func main() {\n    \ta, b := swap(\"hello\", \"world\")\n    \tfmt.Println(a, b)\n    }\n\n    /*\n       å‡½æ•°å¯ä»¥è¿”å›ä»»æ„æ•°é‡è¿”å›å€¼\n       swap å‡½æ•°è¿”å›äº†ä¸¤ä¸ªå­—ç¬¦ä¸²\n    */\n\n```\n\nGo çš„è¿”å›å€¼å¯ä»¥è¢«å‘½åï¼Œå¹¶ä¸”å°±åƒåœ¨å‡½æ•°ä½“å¼€å¤´å£°æ˜çš„å˜é‡é‚£æ ·ä½¿ç”¨ã€‚\n\n```go\n    package main\n\n    import \"fmt\"\n\n    func split(sum int) (x, y int) { // åˆå§‹åŒ–è¿”å›å€¼ä¸º x,y\n    \tx = sum * 4 / 9              // x,y å·²ç»åˆå§‹åŒ–ï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼ä½¿ç”¨\n    \ty = sum - x\n    \treturn                       // éšå¼è¿”å›x,y(è£¸è¿”å›)\n    }\n\n    func main() {\n    \tfmt.Println(split(17))\n    }\n\n    /*\n       åœ¨é•¿çš„å‡½æ•°ä¸­è¿™æ ·çš„è£¸è¿”å›ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§ã€‚\n    */\n```\n\n> æœ‰è¿”å›å€¼çš„å‡½æ•°,å¿…é¡»æœ‰æ˜ç¡®çš„return è¯­å¥,å¦åˆ™ä¼šå¼•å‘ç¼–è¯‘é”™è¯¯\n\n### åè¯è§£é‡Š\n\nå‡½æ•°åŸå‹\n\n> å‡½æ•°å£°æ˜ç”±å‡½æ•°è¿”å›ç±»å‹ã€å‡½æ•°åå’Œå½¢å‚åˆ—è¡¨ç»„æˆã€‚å½¢å‚åˆ—è¡¨å¿…é¡»åŒ…æ‹¬å½¢å‚ç±»å‹,ä½†æ˜¯ä¸å¿…å¯¹å½¢å‚å‘½åã€‚è¿™ä¸‰ä¸ªå…ƒç´ è¢«ç§°ä¸ºå‡½æ•°åŸå‹,å‡½æ•°åŸå‹æè¿°äº†å‡½æ•°çš„æ¥å£\nå‡½æ•°åŸå‹ç±»ä¼¼å‡½æ•°å®šä¹‰æ—¶çš„å‡½æ•°å¤´ï¼Œåˆç§°å‡½æ•°å£°æ˜ã€‚ä¸ºäº†èƒ½ä½¿å‡½æ•°åœ¨å®šä¹‰ä¹‹å‰å°±èƒ½è¢«è°ƒç”¨ï¼ŒC++è§„å®šå¯ä»¥å…ˆè¯´æ˜å‡½æ•°åŸå‹ï¼Œç„¶åå°±å¯ä»¥è°ƒç”¨å‡½æ•°ã€‚å‡½æ•°å®šä¹‰å¯æ”¾åœ¨ç¨‹åºåé¢ã€‚ ç”±äºå‡½æ•°åŸå‹æ˜¯ä¸€æ¡è¯­å¥ï¼Œå› æ­¤å‡½æ•°åŸå‹å¿…é¡»ä»¥åˆ†å·ç»“æŸã€‚å‡½æ•°åŸå‹ç”±å‡½æ•°è¿”å›ç±»å‹ã€å‡½æ•°åå’Œå‚æ•°è¡¨ç»„æˆï¼Œå®ƒä¸å‡½æ•°å®šä¹‰çš„è¿”å›ç±»å‹ã€å‡½æ•°åå’Œå‚æ•°è¡¨å¿…é¡»ä¸€è‡´ã€‚å‡½æ•°åŸå‹å¿…é¡»åŒ…å«å‚æ•°çš„æ ‡è¯†ç¬¦ï¼ˆå¯¹å‡½æ•°å£°æ˜è€Œè¨€æ˜¯å¯é€‰çš„ï¼‰æ³¨æ„ï¼šå‡½æ•°åŸå‹ä¸å‡½æ•°å®šä¹‰å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™ä¼šå¼•èµ·è¿æ¥é”™è¯¯\n\n### å‚è€ƒé“¾æ¥\n\n[Go æŒ‡å—](https://tour.go-zh.org/basics/4)\n[The way to go -- å˜é‡](https://github.com/Unknwon/the-way-to-go_ZH_CN/blob/master/eBook/04.4.md)\n[Effective Go](https://golang.org/doc/effective_go.html)\n\nå˜é‡å’Œå‡½æ•°éƒ¨åˆ†æš‚æ—¶è¿™äº›ï¼Œæœ‰æ›´æ–°è¿˜ä¼šè¡¥å……ã€‚ä¸‹ä¸€ç¯‡å°†ä¼šæ˜¯æ§åˆ¶æµ\nå°†ä¼šç”¨åˆ°çš„ä»£ç ä¸º:\n\n```go\n    package main\n\n    import \"fmt\"\n\n    func main() {\n        result := 0\n        for i := 0; i <= 10; i++ {\n          result = fibonacci(i)\n          fmt.Printf(\"fibonacci(%d) is: %d\\n\", i, result)\n       }\n    }\n\n    func fibonacci(n int) (res int) {\n        if n <= 1 {\n            res = 1\n    \t   } else {\n    \t       res = fibonacci(n-1) + fibonacci(n-2)\n    \t   }\n    \treturn\n    }\n```\n\n---------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "è·Ÿç€ä»£ç å­¦go 001 -- å˜é‡&å‡½æ•°",
        "date": "2016-04-25 06:53:47",
        "tags": [
          "golang",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "golang-learning-by-code-001"
    },
    {
      "content": "\n## 1. Golang æ˜¯ä»€ä¹ˆ\n\nGo å®˜æ–¹è¯´æ˜ï¼š\n> Go ç¼–ç¨‹è¯­è¨€æ˜¯ä¸€ä¸ªä½¿å¾—ç¨‹åºå‘˜æ›´åŠ æœ‰æ•ˆç‡çš„å¼€æºé¡¹ç›®ã€‚Go æ˜¯æœ‰è¡¨è¾¾åŠ›ã€ç®€ æ´ã€æ¸…æ™°å’Œæœ‰æ•ˆç‡çš„ã€‚å®ƒçš„å¹¶è¡Œæœºåˆ¶ä½¿å…¶å¾ˆå®¹æ˜“ç¼–å†™å¤šæ ¸å’Œç½‘ç»œåº”ç”¨,è€Œæ–°çš„ç±»å‹ç³»ç»Ÿå…è®¸æ„å»ºæœ‰ æ€§çš„æ¨¡å—åŒ–ç¨‹åºã€‚Go ç¼–è¯‘åˆ°æœºå™¨ç éå¸¸å¿« é€Ÿ,åŒæ—¶å…·æœ‰ä¾¿åˆ©çš„åƒåœ¾å›æ”¶å’Œå¼ºå¤§çš„è¿è¡Œæ—¶åå°„ã€‚å®ƒæ˜¯å¿«é€Ÿçš„ã€é™æ€ç±» å‹ç¼–è¯‘è¯­è¨€,ä½†æ˜¯æ„Ÿè§‰ä¸Šæ˜¯åŠ¨æ€ç±»å‹çš„,è§£é‡Šå‹è¯­è¨€\n\nHUGOMORE42\n\n## 2. ä¸ºä»€ä¹ˆè¦å¼€å‘è¿™ä¸ªè¯­è¨€\n\n### Go è¯­è¨€çš„å‘å±•ç›®æ ‡\n\n* Go è¯­è¨€çš„ä¸»è¦ç›®æ ‡æ˜¯å°†é™æ€è¯­è¨€çš„å®‰å…¨æ€§å’Œé«˜æ•ˆæ€§ä¸åŠ¨æ€è¯­è¨€çš„æ˜“å¼€å‘æ€§è¿›è¡Œæœ‰æœºç»“åˆ\n* Go è¯­è¨€æ˜¯ä¸€é—¨ç±»å‹å®‰å…¨å’Œå†…å­˜å®‰å…¨çš„ç¼–ç¨‹è¯­è¨€ã€‚è™½ç„¶ Go è¯­è¨€ä¸­ä»æœ‰æŒ‡é’ˆçš„å­˜åœ¨ï¼Œä½†å¹¶ä¸å…è®¸è¿›è¡ŒæŒ‡é’ˆè¿ç®—ã€‚\n* Go è¯­è¨€çš„å¦ä¸€ä¸ªç›®æ ‡æ˜¯å¯¹äºç½‘ç»œé€šä¿¡ã€å¹¶å‘å’Œå¹¶è¡Œç¼–ç¨‹çš„æä½³æ”¯æŒï¼Œä»è€Œæ›´å¥½åœ°åˆ©ç”¨å¤§é‡çš„åˆ†å¸ƒå¼å’Œå¤šæ ¸çš„è®¡ç®—æœº\n* Go è¯­è¨€ä¸­å¦ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§å°±æ˜¯å®ƒçš„æ„å»ºé€Ÿåº¦ï¼ˆç¼–è¯‘å’Œé“¾æ¥åˆ°æœºå™¨ä»£ç çš„é€Ÿåº¦ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ„å»ºä¸€ä¸ªç¨‹åºçš„æ—¶é—´åªéœ€è¦æ•°ç™¾æ¯«ç§’åˆ°å‡ ç§’ã€‚\n* Go è¯­è¨€å®ç°é«˜æ•ˆå¿«é€Ÿçš„åƒåœ¾å›æ”¶ï¼ˆä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼‰ã€‚\n\n\n## 3. æœ‰ä»€ä¹ˆç‰¹æ€§&&ç”¨é€”\n\n### è¯­è¨€çš„ç‰¹æ€§\n\n* æ¸…æ™°å¹¶ä¸”ç®€æ´\n\n> Go åŠªåŠ›ä¿æŒå°å¹¶ä¸”ä¼˜ç¾,ä½ å¯ä»¥åœ¨çŸ­çŸ­å‡ è¡Œä»£ç é‡Œåšè®¸å¤šäº‹æƒ…;\n\n* å¹¶è¡Œ\n\n> Go è¯­è¨€ä»æœ¬è´¨ä¸Šï¼ˆç¨‹åºå’Œç»“æ„æ–¹é¢ï¼‰æ¥å®ç°å¹¶å‘ç¼–ç¨‹ã€‚\n> Go è®©å‡½æ•°å¾ˆå®¹æ˜“æˆä¸ºéå¸¸è½»é‡çš„çº¿ç¨‹ã€‚è¿™äº›çº¿ç¨‹åœ¨ Go ä¸­è¢«å«åš goroutines\n\n* Channel\n\n> è¿™äº› goroutines ä¹‹é—´çš„é€šè®¯ç”± channel[18, 25] å®Œæˆ\n\n* å¿«é€Ÿ\n\n> ç¼–è¯‘å¾ˆå¿«,æ‰§è¡Œä¹Ÿå¾ˆå¿«ã€‚ç›®æ ‡æ˜¯è·Ÿ C ä¸€æ ·å¿«ã€‚ç¼–è¯‘æ—¶é—´ç”¨ç§’è®¡ç®—;\n> Go çš„å¯æ‰§è¡Œæ–‡ä»¶éƒ½æ¯”ç›¸å¯¹åº”çš„æºä»£ç æ–‡ä»¶è¦å¤§å¾ˆå¤šï¼Œè¿™æ°æ°è¯´æ˜äº† Go çš„ runtime åµŒå…¥åˆ°äº†æ¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å½“ä¸­ã€‚å½“ç„¶ï¼Œåœ¨éƒ¨ç½²åˆ°æ•°é‡å·¨å¤§çš„é›†ç¾¤æ—¶ï¼Œè¾ƒå¤§çš„æ–‡ä»¶ä½“ç§¯ä¹Ÿæ˜¯æ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ã€‚ä½†æ€»å¾—æ¥è¯´ï¼ŒGo çš„éƒ¨ç½²å·¥ä½œè¿˜æ˜¯è¦æ¯” Java å’Œ Python è½»æ¾å¾—å¤šã€‚å› ä¸º Go ä¸éœ€è¦ä¾èµ–ä»»ä½•å…¶å®ƒæ–‡ä»¶ï¼Œå®ƒåªéœ€è¦ä¸€ä¸ªå•ç‹¬çš„é™æ€æ–‡ä»¶ï¼Œè¿™æ ·ä½ ä¹Ÿä¸ä¼šåƒä½¿ç”¨å…¶å®ƒè¯­è¨€ä¸€æ ·åœ¨å„ç§ä¸åŒç‰ˆæœ¬çš„ä¾èµ–æ–‡ä»¶ä¹‹é—´æ··æ·†ã€‚\n\n* å®‰å…¨\n\n> å½“è½¬æ¢ä¸€ä¸ªç±»å‹åˆ°å¦ä¸€ä¸ªç±»å‹çš„æ—¶å€™éœ€è¦æ˜¾å¼çš„è½¬æ¢å¹¶éµå¾ªä¸¥æ ¼çš„è§„åˆ™ã€‚Go æœ‰ åƒåœ¾æ”¶é›†ï¼ˆä½¿ç”¨äº†ä¸€ä¸ªç®€å•çš„æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼‰,åœ¨ Go ä¸­æ— é¡» free(),è¯­è¨€ä¼šå¤„ç†è¿™ä¸€åˆ‡;\n> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºåƒåœ¾å›æ”¶å’Œè‡ªåŠ¨å†…å­˜åˆ†é…çš„åŸå› ï¼ŒGo è¯­è¨€ä¸é€‚åˆç”¨æ¥å¼€å‘å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„è½¯ä»¶ã€‚\n\n* æ ‡å‡†æ ¼å¼åŒ–\n\n> Go ç¨‹åºå¯ä»¥è¢«æ ¼å¼åŒ–ä¸ºç¨‹åºå‘˜å¸Œæœ›çš„(å‡ ä¹)ä»»ä½•å½¢å¼,ä½†æ˜¯å®˜æ–¹æ ¼å¼æ˜¯å­˜åœ¨çš„ã€‚æ ‡å‡†ä¹Ÿéå¸¸ç®€å•:gofmt çš„è¾“å‡ºå°±æ˜¯å®˜æ–¹è®¤å¯çš„æ ¼å¼;\n\n* ç±»å‹åç½®\n\n> ç±»å‹åœ¨å˜é‡åçš„åé¢,åƒè¿™æ · var a int,æ¥ä»£æ›¿ C ä¸­çš„ int a;\n\n* UTF-8\n\n> ä»»ä½•åœ°æ–¹éƒ½æ˜¯ UTF-8 çš„,åŒ…æ‹¬å­—ç¬¦ä¸²ä»¥åŠç¨‹åºä»£ç ã€‚ä½ å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ Î¦ = Î¦ + 1;\n\n* å¼€æº\n\n> Go çš„è®¸å¯è¯æ˜¯å®Œå…¨å¼€æºçš„,å‚é˜… Go å‘å¸ƒçš„æºç ä¸­çš„ LICENSE æ–‡ä»¶;\n\n* å°½ç®¡ Go ç¼–è¯‘å™¨äº§ç”Ÿçš„æ˜¯æœ¬åœ°å¯æ‰§è¡Œä»£ç ï¼Œè¿™äº›ä»£ç ä»æ—§è¿è¡Œåœ¨ Go çš„ runtimeï¼ˆè¿™éƒ¨åˆ†çš„ä»£ç å¯ä»¥åœ¨ runtime åŒ…ä¸­æ‰¾åˆ°ï¼‰å½“ä¸­ã€‚è¿™ä¸ª runtime ç±»ä¼¼ Java å’Œ .NET è¯­è¨€æ‰€ç”¨åˆ°çš„è™šæ‹Ÿæœºï¼Œå®ƒè´Ÿè´£ç®¡ç†åŒ…æ‹¬å†…å­˜åˆ†é…ã€åƒåœ¾å›æ”¶ï¼ˆç¬¬ 10.8 èŠ‚ï¼‰ã€æ ˆå¤„ç†ã€goroutineã€channelã€åˆ‡ç‰‡ï¼ˆsliceï¼‰ã€map å’Œåå°„ï¼ˆreflectionï¼‰ç­‰ç­‰ã€‚\n\n### æœ‰ä»€ä¹ˆç”¨é€”\n\nGo è¯­è¨€è¢«è®¾è®¡æˆä¸€é—¨åº”ç”¨äºæ­è½½ Web æœåŠ¡å™¨ï¼Œå­˜å‚¨é›†ç¾¤æˆ–ç±»ä¼¼ç”¨é€”çš„å·¨å‹ä¸­å¤®æœåŠ¡å™¨çš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ã€‚å¯¹äºé«˜æ€§èƒ½åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸè€Œè¨€ï¼ŒGo è¯­è¨€æ— ç–‘æ¯”å¤§å¤šæ•°å…¶å®ƒè¯­è¨€æœ‰ç€æ›´é«˜çš„å¼€å‘æ•ˆç‡ã€‚å®ƒæä¾›äº†æµ·é‡å¹¶è¡Œçš„æ”¯æŒï¼Œè¿™å¯¹äºæ¸¸æˆæœåŠ¡ç«¯çš„å¼€å‘ç‰¹åˆ«é€‚ç”¨ã€‚\n\n[ä½¿ç”¨ Go çš„ç»„ç»‡](http://go-lang.cat-v.org/organizations-using-go)\n\n\n## 4. æœ‰ä»€ä¹ˆç¼ºç‚¹\n\n* ä¸ºäº†ç®€åŒ–è®¾è®¡ï¼Œä¸æ”¯æŒå‡½æ•°é‡è½½å’Œæ“ä½œç¬¦é‡è½½\n* ä¸ºäº†é¿å…åœ¨ C/C++ å¼€å‘ä¸­çš„ä¸€äº› Bug å’Œæ··ä¹±ï¼Œä¸æ”¯æŒéšå¼è½¬æ¢\n* Go è¯­è¨€é€šè¿‡å¦ä¸€ç§é€”å¾„å®ç°é¢å‘å¯¹è±¡è®¾è®¡æ¥æ”¾å¼ƒç±»å’Œç±»å‹çš„ç»§æ‰¿\n> ä¸¾ä¾‹è¯´æ˜ç”¨ä»€ä¹ˆé€”å¾„å®ç°ç»§æ‰¿\n\n* å°½ç®¡åœ¨æ¥å£çš„ä½¿ç”¨æ–¹é¢å¯ä»¥å®ç°ç±»ä¼¼å˜ä½“ç±»å‹çš„åŠŸèƒ½ï¼Œä½†æœ¬èº«ä¸æ”¯æŒå˜ä½“ç±»å‹\n* ä¸æ”¯æŒåŠ¨æ€åŠ è½½ä»£ç \n* ä¸æ”¯æŒåŠ¨æ€é“¾æ¥åº“\n* ä¸æ”¯æŒæ³›å‹\n* é€šè¿‡ recover å’Œ panic æ¥æ›¿ä»£å¼‚å¸¸æœºåˆ¶\n> ä¸¾ä¸ªå¼‚å¸¸å¤„ç†çš„ä¾‹å­\n\n* ä¸æ”¯æŒæ–­è¨€\n* ä¸æ”¯æŒé™æ€å˜é‡\n\n\n## 5. å®‰è£…\n\nGo çš„æºä»£ç æœ‰ä»¥ä¸‹ä¸‰ä¸ªåˆ†æ”¯ï¼š\n\n* Go releaseï¼šæœ€æ–°ç¨³å®šç‰ˆï¼Œå®é™…å¼€å‘æœ€ä½³é€‰æ‹©\n* Go weeklyï¼šåŒ…å«æœ€è¿‘æ›´æ–°çš„ç‰ˆæœ¬ï¼Œä¸€èˆ¬æ¯å‘¨æ›´æ–°ä¸€æ¬¡\n* Go tipï¼šæ°¸è¿œä¿æŒæœ€æ–°çš„ç‰ˆæœ¬ï¼Œç›¸å½“äºå†…æµ‹ç‰ˆ\n\nç°åœ¨release æ˜¯1.6 å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚å®‰è£…\n\n### ubuntu & debian\n\n```bash\nsudo apt-get update && apt-get install -y --no-install-recommends \\\n    g++ gcc libc6-dev make\n\nGOLANG_VERSION=1.6\nGOLANG_DOWNLOAD_URL=https://golang.org/dl/go$GOLANG_VERSION.linux-amd64.tar.gz\nGOLANG_DOWNLOAD_SHA256=5470eac05d273c74ff8bac7bef5bad0b5abbd1c4052efbdbc8db45332e836b0b\n\nsudo curl -fsSL \"$GOLANG_DOWNLOAD_URL\" -o golang.tar.gz \\\n    && echo \"$GOLANG_DOWNLOAD_SHA256  golang.tar.gz\" | sha256sum -c - \\\n    && tar -C /usr/local -xzf golang.tar.gz \\\n    && rm golang.tar.gz\n\n## ä¹Ÿå¯ä»¥ç›´æ¥ sudo apt-get install go ç‰ˆæœ¬å¯èƒ½ä¸æ˜¯1.6\n```\n\n### Mac\n\n```sh\nbrew install go\n```\n\n### Windows\n\nç‚¹å‡»ä¸‹è½½é¡µé¢ç›´æ¥ä¸‹è½½å®‰è£…å§ [ä¸‹è½½é“¾æ¥] (http://golang.org/dl/)\n\n## 6. ç¯å¢ƒé…ç½®&ç¼–è¾‘å™¨\n\nGOROOT GOè¯­è¨€å®‰è£…çš„è·¯å¾„\nGOPATH è¡¨ç¤ºä»£ç åŒ…æ‰€åœ¨çš„åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ª\nPATH å¯æ‰§è¡Œç¨‹åºçš„è·¯å¾„ï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿé»˜è®¤ä¼šåœ¨PATHä¸­æŒ‡å®šè·¯å¾„é‡Œå¯»æ‰¾\n\n```sh\n# å°†ä»¥ä¸‹ç¯å¢ƒå˜é‡åŠ åˆ° .bashrc æˆ–è€… .zshrc æ–‡ä»¶\n# Mac é…ç½®\nexport GOROOT='/usr/local/Cellar/go/1.6/libexec'\nexport GOPATH=$HOME/Golang\nexport PATH=$PATH:$HOME/go/bin:$GOPATH/bin\n\n# ubuntu é…ç½®\nexport GOROOT='/usr/local/go'\nexport GOPATH=/go\nexport PATH=$PATH:$HOME/go/bin:$GOPATH/bin\n\n```\n\n### ç¼–è¾‘å™¨\n\n* vim\n* atom\n* pyCharm\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "golang ä»‹ç»",
        "date": "2016-04-14 14:44:40",
        "tags": [
          "golang",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "golang-description"
    },
    {
      "content": "\n### Hello Hugo\n\nHugo å¸¸ç”¨å‘½ä»¤ åŸºæœ¬é…ç½®\n\n\n### hugo å¸¸ç”¨å‘½ä»¤\n\n```shell script\nhugo help\nhugo version\nhugo new site sitename  # æ–°å»ºä¸€ä¸ªç«™ç‚¹\nhugo new post/good-to-great.md  # æ·»åŠ åˆ°content/post ç›®å½•\nhugo server # å¯åŠ¨server\nhugo server --buildDrafts # é¢„è§ˆè‰ç¨¿\nhugo undraft content/post/good-to-great.md # å‘å¸ƒä¸€ç¯‡æ–‡ç« \nhugo server --theme=hugo_zen # ä»¥zen ä¸»é¢˜å¯åŠ¨server\nhugo --theme=hugo_zen ä»¥zen # ä¸»é¢˜ç”Ÿæˆè‰ç¨¿\n```\n\n*è¯­æ³•é«˜äº®*\n\n[Syntax Highlighting](https://gohugo.io/extras/highlighting/)\n\n```python\n# print hello world\nprint \"hello world\"\n```\n\n\n### Front Matter Example (in TOML)\n\n[front-matter] (https://gohugo.io/content/front-matter/)\n\n```json\n+++\ntitle = \"Hugo: A fast and flexible static site generator\"\ndescription = \"Hugo: A fast and flexible static site generator\"\ntags = [ \"Development\", \"Go\", \"fast\", \"Blogging\" ]\ncategories = [ \"Development\" ]\ndate = \"2012-04-06\"\nseries = [ \"Go Web Dev\" ]\nslug = \"hugo-å¯ä»¥æ›¿ä»£url\"\nproject_url = \"https://github.com/spf13/hugo\"\n+++\n```\n\n### Markdown è¯­æ³•è¯´æ˜\n\n[Markdown è¯­æ³•è¯´æ˜ (ç®€ä½“ä¸­æ–‡ç‰ˆ)] (http://wowubuntu.com/markdown/)\n\n\n### å‚è€ƒé“¾æ¥\n\n* [Hugo Quickstart Guide] (https://gohugo.io/overview/quickstart/)\n* [Hugoé™æ€ç½‘ç«™ç”Ÿæˆå™¨ä¸­æ–‡æ•™ç¨‹] (http://nanshu.wang/post/2015-01-31/)\n* [ä½¿ç”¨hugoæ­å»ºä¸ªäººåšå®¢ç«™ç‚¹] (http://blog.coderzh.com/2015/08/29/hugo/)\n* [Hugoä¸­æ–‡æ–‡æ¡£] (http://www.gohugo.org/)\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "hugo ä½¿ç”¨",
        "date": "2016-04-11 02:47:47",
        "tags": [],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "first"
    },
    {
      "content": "\n> ç¨‹åºå‘˜ åç«¯\n\n\n### å…¬å·\n\n> å…¬å·ï¼šå››æœˆï¼ˆhiiiaprilï¼‰\n![hiiiapril](http://media.gusibi.mobi/WDz3v4cU4LQq1oyKX-fYK1LxIThzZ1hK931ZaPRC8CdcB0t2oTYJciMDuAws70FY)\n\n### ç¤¾äº¤å¸å·\n\n* [æ˜é‡‘](https://juejin.im/user/592291eb570c350069bad8f1)\n* [segmentfault](https://segmentfault.com/u/goodspeed)\n* [github](https://www.github.com/gusibi)\n* [twitter](https://twitter.com/amazing_gs)\n\n\n### ä½œå“\n\n#### å°ç¨‹åº\n\n> è’™å¤ªå¥‡æ‹¼å›¾\n\n![](http://media.gusibi.mobi/P60XX2Lf1n8Mj6lSoj2YKlLvNUrd8BN_1e4AQdJ7MhxuTJHDZbIYE7s2OjFHw4HF)\n\n\n> å®šæŠ•è´¦æœ¬\n\n![](http://media.gusibi.mobi/0iu2yg9c_HC9cVA67EG5mLdqqNVDwvlNgLBFX__j8hM2QHT1Su-PdjeuvRnf3_Cu)\n\n\n#### Github é¡¹ç›®\n\n* [python-weixin-sdk](https://github.com/gusibi/python-weixin)\n* [å¾®ä¿¡èŠå¤©æœºå™¨äºº](https://github.com/gusibi/momo)\n* [Amazon DynamoDB ORM By Python](https://github.com/gusibi/dynamodb-py)\n\n\n#### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å…³äºæˆ‘-é¡¾æ–¯æ¯”",
        "date": "2016-04-05 12:29:39",
        "tags": [],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "about"
    },
    {
      "content": "\n##\n\n### \n\n## å‚è€ƒé“¾æ¥\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "date": "",
        "title": "title",
        "author": "goodspeed",
        "permalink": "/post/url-path",
        "description": "description",
        "tags": [
          "xx",
          "xxxx"
        ],
        "categories": [
          "xxx",
          "xxxx"
        ],
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "gc-copying"
    },
    {
      "content": "> **â€œDoes developer convenience really trump correctness, scalability, performance, separation of concerns, extensibility, and accidental complexity?â€ Vinoski (2008)**\n>\n> å¼€å‘è€…çš„ä¾¿åˆ©æ€§çœŸçš„æ¯”æ­£ç¡®æ€§ã€å¯æ‰©å±•æ€§ã€æ€§èƒ½ã€å…³æ³¨ç‚¹åˆ†ç¦»ã€å¯æ‰©å±•æ€§å’Œå¶ç„¶å¤æ‚åº¦æ›´é‡è¦å—ï¼Ÿ\n\n\n## RPC ä»‹ç»\n\n\n\nè¿œç¨‹è¿‡ç¨‹è°ƒç”¨(Remote Procedure Callï¼ŒRPC)æ˜¯ä¸€ç§å…è®¸ä¸¤ä¸ªå®ä½“é€šè¿‡é€šç”¨**è¯·æ±‚/å“åº”**æœºåˆ¶çš„é€šä¿¡é€šé“è¿›è¡Œé€šä¿¡çš„è®¾è®¡èŒƒä¾‹ã€‚RPC çš„å®šä¹‰åœ¨è¿‡å»ä¸‰åå¹´ä¸­å‘ç”Ÿäº†é‡å¤§çš„å˜åŒ–å’Œæ¼”å˜ï¼Œå› æ­¤ è¿™é‡ŒRPC èŒƒå¼æ˜¯ä¸€ä¸ªå¹¿ä¹‰çš„åˆ†ç±»æœ¯è¯­ï¼ŒæŒ‡çš„æ˜¯è¿‡å»å››åå¹´ä¸­å‡ºç°çš„æ‰€æœ‰ RPC å¼ç³»ç»Ÿã€‚RPC çš„å®šä¹‰ç»è¿‡å‡ åå¹´çš„å‘å±•ã€‚å®ƒå·²ç»ä»ä¸€ä¸ªç®€å•çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨è®¾è®¡è½¬ç§»åˆ°ä¸€ç»„ç›¸äº’è¿æ¥çš„æœåŠ¡ã€‚è™½ç„¶æœ€åˆçš„ RPC å®ç°è¢«è®¾è®¡ä¸ºå°†è®¡ç®—å¤–åŒ…ç»™åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡å™¨çš„å·¥å…·ï¼Œä½† RPC ç»è¿‡å¤šå¹´çš„å‘å±•ï¼Œå·²ç»æ„å»ºäº†ä¸€ä¸ªä¸è¯­è¨€æ— å…³çš„åº”ç”¨ç¨‹åºç”Ÿæ€ç³»ç»Ÿã€‚RPC èŒƒå¼å·²ç»æˆä¸ºåˆ›å»ºçœŸæ­£é©å‘½æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„é©±åŠ¨åŠ›çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”åœ¨ä¸åŒç³»ç»Ÿä¹‹é—´äº§ç”Ÿäº†å„ç§é€šä¿¡æ–¹æ¡ˆå’Œåè®®ã€‚\n\n\n\n\n\n\n\n![45366c44f775abfd0ac3b43bccc1abc3_720w.jpg](http://media.gusibi.mobi/ghNK6n_mtljVYk0tNrZTRm2wGibEA-IdZ6Q3kWsxqAo2u9QLgeoAXZpf611puv4B)\n\næœ€ç®€å•çš„ RPC å®ç°å¦‚å›¾1æ‰€ç¤ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯(æˆ–è°ƒç”¨æ–¹)å’ŒæœåŠ¡å™¨(æˆ–è¢«è°ƒç”¨æ–¹)è¢«ä¸€ä¸ªç‰©ç†ç½‘ç»œåˆ†å¼€ã€‚ç³»ç»Ÿçš„ä¸»è¦ç»„ä»¶æ˜¯å®¢æˆ·ç«¯ä¾‹ç¨‹/ç¨‹åºã€å®¢æˆ·ç«¯å­˜æ ¹ã€æœåŠ¡å™¨ä¾‹ç¨‹/ç¨‹åºã€æœåŠ¡å™¨å­˜æ ¹å’Œç½‘ç»œä¾‹ç¨‹ã€‚å­˜æ ¹æ˜¯ä¸€ä¸ªå°ç¨‹åºï¼Œé€šå¸¸ç”¨ä½œè¾ƒå¤§ç¨‹åºçš„æ›¿ä»£ç¨‹åº(æˆ–æ¥å£)ã€‚å®¢æˆ·ç«¯å­˜æ ¹å‘å®¢æˆ·ç«¯ä¾‹ç¨‹å…¬å¼€æœåŠ¡å™¨ä¾‹ç¨‹æä¾›çš„åŠŸèƒ½ï¼Œè€ŒæœåŠ¡å™¨å­˜æ ¹å‘æœåŠ¡å™¨ä¾‹ç¨‹æä¾›ç±»ä¼¼äºå®¢æˆ·ç«¯çš„ç¨‹åºã€‚å®¢æˆ·ç«¯å­˜æ ¹ä»å®¢æˆ·ç«¯ç¨‹åºè·å–è¾“å…¥å‚æ•°å¹¶è¿”å›ç»“æœï¼Œè€ŒæœåŠ¡å™¨å­˜æ ¹å‘æœåŠ¡å™¨ç¨‹åºæä¾›è¾“å…¥å‚æ•°å¹¶è·å–ç»“æœã€‚å®¢æˆ·ç«¯ç¨‹åºåªèƒ½ä¸å®¢æˆ·ç«¯å­˜æ ¹äº¤äº’ï¼Œåè€…ä¸ºå®¢æˆ·ç«¯æä¾›è¿œç¨‹æœåŠ¡å™¨çš„æ¥å£ã€‚è¿™ä¸ªå­˜æ ¹è¿˜åºåˆ—åŒ–å®¢æˆ·ç«¯ä¾‹ç¨‹å‘é€åˆ°å­˜æ ¹çš„è¾“å…¥å‚æ•°ã€‚ç±»ä¼¼åœ°ï¼ŒæœåŠ¡å™¨å­˜æ ¹ä¸ºæœåŠ¡å™¨ä¾‹ç¨‹æä¾›å®¢æˆ·ç«¯æ¥å£ï¼Œå¹¶å¤„ç†å‘é€åˆ°å®¢æˆ·ç«¯çš„æ•°æ®åºåˆ—åŒ–ã€‚\n\n\n\nå½“å®¢æˆ·ç«¯ä¾‹ç¨‹æ‰§è¡Œè¿œç¨‹è¿‡ç¨‹æ—¶ï¼Œå®ƒè°ƒç”¨å®¢æˆ·ç«¯å­˜æ ¹ï¼Œè¯¥å­˜æ ¹åºåˆ—åŒ–è¾“å…¥å‚æ•°ã€‚è¿™ä¸ªåºåˆ—åŒ–æ•°æ®ä½¿ç”¨ OS ç½‘ç»œä¾‹ç¨‹(TCP/IP)å‘é€åˆ°æœåŠ¡å™¨ã€‚ç„¶åï¼ŒæœåŠ¡å™¨å­˜æ ¹å°†æ•°æ®ååºåˆ—åŒ–ï¼Œå¹¶ä½¿ç”¨ç»™å®šçš„å‚æ•°æä¾›ç»™æœåŠ¡å™¨ä¾‹ç¨‹ã€‚æ¥è‡ªæœåŠ¡å™¨ä¾‹ç¨‹çš„è¿”å›å€¼å†æ¬¡åºåˆ—åŒ–ï¼Œå¹¶é€šè¿‡ç½‘ç»œå‘é€å›å®¢æˆ·ç«¯ï¼Œåœ¨é‚£é‡Œå®¢æˆ·ç«¯å­˜æ ¹å¯¹å…¶è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶æ˜¾ç¤ºç»™å®¢æˆ·ç«¯ä¾‹ç¨‹ã€‚è¿™ä¸ªè¿œç¨‹è¿‡ç¨‹é€šå¸¸å¯¹å®¢æˆ·ç«¯ä¾‹ç¨‹éšè—ï¼Œå¹¶ä½œä¸ºæœ¬åœ°è¿‡ç¨‹æ˜¾ç¤ºç»™å®¢æˆ·ç«¯ã€‚RPC æœåŠ¡è¿˜éœ€è¦ä¸€ä¸ªå‘ç°æœåŠ¡/ä¸»æœºè§£ææœºåˆ¶æ¥å¼•å¯¼å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚\n\n\n\n**å®Œæ•´çš„ RPC æ¡†æ¶**\n\n\nåœ¨ä¸€ä¸ªå…¸å‹ RPC çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼ŒåŒ…å«äº†æœåŠ¡å‘ç°ã€è´Ÿè½½ã€å®¹é”™ã€ç½‘ç»œä¼ è¾“ã€åºåˆ—åŒ–ç­‰ç»„ä»¶ï¼Œå…¶ä¸­â€œRPC åè®®â€å°±æŒ‡æ˜äº†ç¨‹åºå¦‚ä½•è¿›è¡Œç½‘ç»œä¼ è¾“å’Œåºåˆ—åŒ–ã€‚\n\n\n\n![rpc-2021-01-30-1635.png](http://media.gusibi.mobi/5QsjweGQnwmBsWdVcFO2sZ-QGKpthTwB_3wzkyfEYVGW3mglxPl7It2f8WUMo8ar)\n\n## RPC çš„å‘å±•å†ç¨‹\n\n\n\n### 1969å¹´11æœˆï¼ŒARPAnet å¼€å§‹å»ºç«‹ã€‚\n\n\n\n1996å¹´ï¼Œç¾å›½å›½é˜²éƒ¨é«˜çº§ç ”ç©¶è®¡åˆ’ç®¡ç†å±€ï¼ˆARPAå…¨ç§°ï¼šAdvanced Research Projects Agencyï¼‰å¼€å§‹å»ºç«‹ä¸€ä¸ªå‘½åä¸ºARPAnetçš„ç½‘ç»œã€‚æœ€å¼€å§‹åªæœ‰4ä¸ªç»“ç‚¹ï¼Œåˆ†åˆ«æ˜¯æ´›æ‰çŸ¶çš„[åŠ åˆ©ç¦å°¼äºšå·](https://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=25050&ss_c=ssc.citiao.link)å¤§å­¦æ´›æ‰çŸ¶åˆ†æ ¡ã€åŠ å·å¤§å­¦åœ£å·´å·´æ‹‰åˆ†æ ¡ã€[æ–¯å¦ç¦å¤§å­¦](https://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=527469&ss_c=ssc.citiao.link)ã€çŠ¹ä»–å·å¤§å­¦å››æ‰€å¤§å­¦çš„4å°[å¤§å‹è®¡ç®—æœº](https://baike.sogou.com/lemma/ShowInnerLink.htm?lemmaId=7909857&ss_c=ssc.citiao.link)ã€‚é€‰æ‹©è¿™å››ä¸ªèŠ‚ç‚¹çš„ä¸€ä¸ªåŸå› æ˜¯è¦æµ‹è¯•ä¸åŒç±»å‹ä¸»æœºè”ç½‘çš„å…¼å®¹æ€§ã€‚\n\n\n\n### 1974å¹´ï¼šJon Postel å’Œ Jim Whiteå‘è¡¨äº†RFC674\n\n\n\nè¿‡ç¨‹è°ƒç”¨æœ€æ—©å¯ä»¥è¿½æº¯åˆ° Jon Postel å’Œ Jim White åœ¨1974 å¹´å‘è¡¨çš„ Procedure Call Protocol Documents Version 2ï¼ˆRFC674ï¼‰ã€‚è¿™ä¸ªåè®®è¯•å›¾å®šä¹‰ä¸€ç§é€šç”¨çš„æ–¹æ³•ï¼Œç”¨äºè§£å†³ NSW é¡¹ç›®ä¸­å¤šä¸ªè®¡ç®—èŠ‚ç‚¹é€šä¿¡çš„é—®é¢˜ã€‚\n\n\n\nåè®®å‘è¡¨åï¼Œå¼•èµ·äº†éå¸¸å¤§çš„äº‰è®®ï¼Œ1975å¹´ï¼ŒRFC674çš„æ³¨é‡Šç¯‡RFC684 å‘å¸ƒã€‚\n\n\n\n### 1975å¹´ï¼šRFC684 ä½œä¸ºRFC 674 çš„æ³¨é‡Šå‘è¡¨ï¼Œå¯¹RFC 674 çš„äº‰è®®è¿›è¡Œå›å¤\n\n\n\nRFC 684 ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åè®®ï¼Œ ä¸»è¦å¯¹ RFC674 çš„äº‰è®®è¿›è¡Œè®¨è®ºã€‚è®¨è®ºå†…å®¹å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š\n\n\n\n- RFC674 è®¤ä¸ºè¿‡ç¨‹è°ƒç”¨åº”è¯¥æ˜¯ä¸€ä¸ªåŸè¯­æ“ä½œï¼Œå®ƒåº”è¯¥åœ¨æ“ä½œç³»ç»Ÿåº•å±‚è¿›è¡Œæ“ä½œ\n\n- - åŸè¯­æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­è°ƒç”¨æ ¸å¿ƒå±‚å­ç¨‹åºçš„æŒ‡ä»¤ã€‚ä¸ä¸€èˆ¬å¹¿ä¹‰æŒ‡ä»¤çš„åŒºåˆ«åœ¨äºå®ƒæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œè€Œä¸”æ€»æ˜¯ä½œä¸ºä¸€ä¸ªåŸºæœ¬å•ä½å‡ºç°ã€‚\n\n- æœ¬åœ°è°ƒç”¨å’Œè¿œç¨‹è°ƒç”¨æ˜¯ä¸åŒçš„ï¼Œè¿œç¨‹è°ƒç”¨å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœï¼Œå¹¶ä¸”å‘ç”Ÿæ•…éšœåå¯èƒ½æ— æ³•æ¢å¤ã€‚\n- å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ï¼Œæˆ–è€…æ˜¾ç¤ºçš„å£°æ˜ä»€ä¹ˆæ—¶å€™éœ€è¦åŒæ­¥ç­‰å¾…æ¶ˆæ¯è¿”å›åº”è¯¥æ˜¯ä¸€ä¸ªæ›´å¥½çš„æ¨¡å‹ã€‚\n\n\n\nä»è¿™å‡ ç‚¹å‡ºå‘ï¼Œå…³äºè¿™ä¸ªç¼–ç¨‹èŒƒå‹çš„æ‹…å¿§æˆäº†RPC40å¤šå¹´å†å²ä¸­ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ï¼Œå³ï¼š\n\n\n\n- æ•…éšœæˆ–é”™è¯¯åæ€ä¹ˆæ¢å¤ï¼Ÿé‡è¯•ã€æŠ›å‡ºå¼‚å¸¸ï¼Ÿ\n- é¡ºåºæ“ä½œéå¸¸å›°éš¾ã€‚æ¯”å¦‚ä¸€ç³»åˆ—åŒæ­¥è¯·æ±‚ï¼Œå¦‚æœå…¶ä¸­æŸäº›è¯·æ±‚å¤±è´¥ï¼Œæ€ä¹ˆä¿è¯é”™è¯¯çš„è¯·æ±‚é‡æ–°æ‰§è¡Œï¼Œä»¥åŠè¯·æ±‚è¿˜æ˜¯é¡ºåºçš„ï¼Ÿ\n- RPC è¯·æ±‚æ˜¯åŒæ­¥æ¨¡å‹ï¼Œæ–¹æ³•è¢«è°ƒç”¨åä¼šç­‰å¾…å“åº”ï¼Œä½†æ˜¯ç”±äºè¯·æ±‚æ˜¯åŒæ­¥çš„ï¼Œåœ¨ç³»ç»Ÿè´Ÿè½½é«˜æ—¶å¦‚æœå¸Œæœ›ä¼˜å…ˆå“åº”ä¼˜å…ˆçº§é«˜çš„è¯·æ±‚åˆ™å˜æˆäº†éå¸¸å›°éš¾çš„äº‹æƒ…ã€‚\n\n- - åŒæ­¥æ›´å¤šåœ°æ˜¯é’ˆå¯¹ä¸€å¯¹ä¸€çš„è°ƒç”¨å’Œè¿”å›ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å•ä¸ªè¯·æ±‚çš„å¼‚æ­¥ç‰¹æ€§å’Œå¤šä¸ªè¿”å›ã€‚æ­¤å¤–ï¼Œä½ä¼˜å…ˆçº§ã€å¯æŠ¢å çš„åå°ä»»åŠ¡ä¹Ÿä¸å¤ªå¯èƒ½åœ¨è¿‡ç¨‹è°ƒç”¨ä¸­å®ç°ã€‚\n\n\n\n> æ­¤æ—¶çš„åè®®è¿˜æ˜¯åŸºäºé˜¿å¸•ç½‘ï¼ˆARPANETï¼‰ï¼Œäº’è”ç½‘è¿˜æ²¡æœ‰å‡ºç°ï¼Œå·²ç»åœ¨è®¨è®ºåˆ†å¸ƒå¼ç³»ç»Ÿé—´è°ƒç”¨çš„é—®é¢˜äº†ã€‚\n\n\n\n### 1976å¹´ï¼šRFC 707 å‘å¸ƒ\n\n\n\n> ç”±äºè¿œç¨‹å’Œæœ¬åœ°è°ƒç”¨çš„æˆæœ¬å·®å¼‚ï¼Œåº”ç”¨ç¨‹åºç¨‹åºå‘˜å¿…é¡»è°¨æ…ä½¿ç”¨è¿œç¨‹èµ„æºï¼Œå³ä½¿è¿œç¨‹èµ„æºçš„ä½¿ç”¨æœºåˆ¶å°†è¢« RTE å¤§å¤§ç®€åŒ–ã€‚ä¸è™šæ‹Ÿå†…å­˜ä¸€æ ·ï¼Œè¿‡ç¨‹è°ƒç”¨æ¨¡å‹æä¾›äº†æå¤§çš„ä¾¿åˆ©ï¼Œä¹Ÿæä¾›äº†å¼ºå¤§çš„èƒ½åŠ›ï¼Œäºæ­¤åŒæ—¶ä¹Ÿåº”è¯¥å¯¹å¯èƒ½äº§ç”Ÿçš„æ»¥ç”¨æœ‰åˆç†è­¦è§‰\n\n\n\nRFC 707 æ¦‚æ‹¬äº† RFC 684 çš„æ€æƒ³ï¼Œå¹¶è®¨è®ºäº†è¯¸å¦‚ TELNET å’Œ FTP ç­‰æœåŠ¡çš„èµ„æºå…±äº«é—®é¢˜ï¼Œè¿™äº›æœåŠ¡ä¸­çš„æ¯ä¸€ä¸ªéƒ½æä¾›äº†ä¸ä¹‹äº¤äº’çš„ä¸åŒæ¥å£ï¼Œè¿™å°±è¦æ±‚æ“ä½œå‘˜çŸ¥é“ä¸è¯¥æœåŠ¡äº¤äº’çš„å…·ä½“åè®®ã€‚é’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œä½œè€…æå‡ºäº†ä¸€ä¸ªæ–°çš„æƒ³æ³•ï¼šä¸å…¶éœ€è¦çŸ¥é“è¿œç¨‹è®¡ç®—æœºä¸Šæ‰€æœ‰å¯ç”¨çš„å‘½ä»¤å’Œåè®®ï¼Œæˆ‘ä»¬èƒ½å¦å®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ¥å—å‚æ•°å¹¶éµå¾ªè°ƒç”¨/å“åº”æ¨¡å‹çš„æ¥å£æ¥æ‰§è¡Œä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹ã€‚\n\n\n\n### 1983å¹´1æœˆ1æ—¥ï¼ŒARPAç½‘å°†å…¶ç½‘ç»œæ ¸å¿ƒåè®®ç”±ç½‘ç»œæ§åˆ¶ç¨‹åºæ”¹å˜ä¸º TCP/IP åè®®\n\n\n\n1983å¹´1æœˆ1æ—¥ï¼ŒARPAç½‘å°†å…¶ç½‘ç»œæ ¸å¿ƒåè®®ç”±ç½‘ç»œæ§åˆ¶ç¨‹åºæ”¹å˜ä¸º TCP/IP åè®®ï¼Œäº’è”ç½‘çš„ç§å­å¼€å§‹å‘èŠ½ã€‚\n\n\n\n### 1984å¹´ï¼šè®ºæ–‡ ã€ŠImplementing remote procedure callsã€‹å‘è¡¨\n\n\n\nRPC æ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼‰çš„ç¼©å†™å½¢å¼ï¼ŒBirrell å’Œ Nelson åœ¨ 1984 å‘è¡¨äº ACM Transactions on Computer Systems çš„è®ºæ–‡ã€ŠImplementing remote procedure callsã€‹å¯¹ RPC åšäº†ç»å…¸çš„è¯ é‡Šã€‚RPC æ˜¯æŒ‡è®¡ç®—æœº A ä¸Šçš„è¿›ç¨‹ï¼Œè°ƒç”¨å¦å¤–ä¸€å°è®¡ç®—æœº B ä¸Šçš„è¿›ç¨‹ï¼Œå…¶ä¸­ A ä¸Šçš„è°ƒç”¨è¿›ç¨‹è¢«æŒ‚èµ·ï¼Œè€Œ B ä¸Šçš„è¢«è°ƒç”¨è¿›ç¨‹å¼€å§‹æ‰§è¡Œï¼Œå½“å€¼è¿”å›ç»™ A æ—¶ï¼ŒA è¿›ç¨‹ç»§ç»­æ‰§è¡Œã€‚è°ƒç”¨æ–¹å¯ä»¥é€šè¿‡ä½¿ç”¨å‚æ•°å°†ä¿¡æ¯ä¼ é€ç»™è¢«è°ƒç”¨æ–¹ï¼Œè€Œåå¯ä»¥é€šè¿‡ä¼ å›çš„ç»“æœå¾—åˆ°ä¿¡æ¯ã€‚è€Œè¿™ä¸€è¿‡ç¨‹ï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´æ˜¯é€æ˜çš„ã€‚ä¹‹åçš„å‡ å¹´RPCä¸€ç›´è¢«è®¤ä¸ºæ˜¯å»ºç«‹åˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿçš„æœ€åˆé€‚çš„èŒƒå¼ã€‚\n\n\n\n> RPCï¼ˆRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ˜¯å»ºç«‹åœ¨Socketä¹‹ä¸Šçš„ä¸€ç§å¤šè¿›ç¨‹é—´çš„é€šä¿¡æœºåˆ¶ã€‚ä¸åŒäºå¤æ‚çš„Socketé€šä¿¡æ–¹å¼ï¼ŒRPCçš„åˆå¿ƒæ˜¯è®¾è®¡ä¸€å¥—è¿œç¨‹é€šä¿¡çš„é€šç”¨æ¡†æ¶ï¼Œè¿™ä¸ªæ¡†æ¶èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†é€šä¿¡åè®®ã€å¯¹è±¡åºåˆ—åŒ–ã€ç½‘ç»œä¼ è¾“ç­‰å¤æ‚ç»†èŠ‚ï¼Œå¹¶ä¸”å¸Œæœ›å¼€å‘è€…ä½¿ç”¨è¿™ä¸ªæ¡†æ¶ä»¥åï¼Œè°ƒç”¨ä¸€ä¸ªè¿œç¨‹æœºå™¨ä¸Šçš„æ¥å£çš„ä»£ç ä¸ä»¥æœ¬åœ°æ–¹æ³•è°ƒç”¨çš„ä»£ç â€œçœ‹èµ·æ¥æ²¡ä»€ä¹ˆåŒºåˆ«â€ï¼Œä»è€Œå¤§å¤§å‡å°åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼€å‘éš¾åº¦ï¼Œä½¿å¾—ä¸æ‡‚ç½‘ç»œç¼–ç¨‹çš„ç¨‹åºå‘˜ä¹Ÿèƒ½æ¯”è¾ƒå®¹æ˜“åœ°å¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿã€‚\n\n\n\n![20160630-rpc.png](http://media.gusibi.mobi/_41U9sOVjUPiYpGcWjJDTL4FrDu-X3Y_8Mm0NRst05Jcp5z1Ui2_u9cuADXjNnKz)\n\nè¿™æ˜¯è®ºæ–‡ä¸­çš„rpcæ¶æ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°userï¼Œuset-subå’Œå…¶ä¸­ä¸€ä¸ªRPCRuntimeçš„å®ä¾‹åœ¨è°ƒç”¨è€…æœºå™¨ä¸Šæ‰§è¡Œï¼›serverï¼Œserver-subå’Œå¦å¤–ä¸€ä¸ªRPCRuntimeå®ä¾‹åœ¨è¢«è°ƒç”¨è€…æœºå™¨ä¸Šæ‰§è¡Œã€‚å½“userå‘èµ·è¿œç¨‹è°ƒç”¨æ—¶ï¼Œå…¶å®æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªå®Œå…¨æ­£å¸¸çš„æœ¬åœ°è°ƒç”¨ï¼Œè€Œè¿™ä¸ªè°ƒç”¨ä¼šå»è°ƒç”¨user-stubä¸­ç›¸åº”çš„ç¨‹åºã€‚user-stubè´Ÿè´£å°†ç›®æ ‡ç¨‹åºçš„è§„èŒƒå’Œå‚æ•°æ”¾ç½®åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ä¸­ï¼ˆæ‰“åŒ…ï¼‰ï¼Œå¹¶è¯·æ±‚RPCRuntimeå°†è¿™äº›åŒ…å¯é åœ°ä¼ è¾“ç»™è¢«è°ƒç”¨è€…æœºå™¨ã€‚ä¸€æ—¦æ¥æ”¶åˆ°è¿™äº›åŒ…ï¼Œè¢«è°ƒç”¨è€…æœºå™¨ä¸Šçš„RPCRuntimeå°±è¿™äº›åŒ…ä¼ é€ç»™server-stubã€‚server-stubå°†å®ƒä»¬è§£åŒ…ï¼Œåƒæ˜¯æ‰§è¡Œä¸€ä¸ªå®Œå…¨æ­£å¸¸çš„æœ¬åœ°è°ƒç”¨ä¸€æ ·ï¼Œè¯¥æœ¬åœ°è°ƒç”¨ä¼šè°ƒç”¨serverä¸­å¯¹åº”çš„ç¨‹åºã€‚ä¸æ­¤åŒæ—¶ï¼Œè°ƒç”¨è€…æœºå™¨ä¸Šçš„è°ƒç”¨è¿›ç¨‹å°†è¢«æŒ‚èµ·ï¼Œå¹¶ç­‰å¾…ç»“æœåŒ…çš„è¿”å›ã€‚å½“serverä¸­çš„è°ƒç”¨å®Œæˆæ—¶ï¼Œå®ƒå°†ç»“æœè¿”å›ç»™user-stubæ‰“åŒ…ï¼Œç„¶åç»“æœåŒ…å°†ç”±RPCRuntimeå†ä¼ é€å›ç»™è°ƒç”¨è€…æœºå™¨ä¸ŠæŒ‚èµ·çš„è¿›ç¨‹ï¼ˆRCPCRuntimeè´Ÿè´£é‡ä¼ ï¼Œç¡®è®¤ï¼Œæ•°æ®åŒ…è·¯ç”±å’ŒåŠ å¯†ï¼‰ã€‚è¿™äº›åŒ…å°†è¢«user-stubè§£åŒ…å¹¶è¿”å›ç»™userã€‚é™¤å»å¤šæœºå™¨é—´æœºå™¨ç»‘å®šæˆ–è€…é€šä¿¡å¤±è´¥çš„å½±å“ï¼Œè°ƒç”¨å°±ä»¿ä½›userç›´æ¥åœ¨serverä¸Šè°ƒç”¨ç¨‹åºä¸€æ ·ã€‚ç¡®å®æ˜¯è¿™æ ·ï¼Œå¦‚æœuserå’Œserverçš„ä»£ç æ”¾ç½®åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œå¹¶è¢«ç›´æ¥ç»‘å®šåœ¨ä¸€èµ·ï¼ˆæ— éœ€stubï¼‰ï¼Œç¨‹åºå°†ä»èƒ½å·¥ä½œã€‚\n\n\n\n### 1987å¹´ï¼šã€ŠA Critique of the Remote Procedure Call Paradigmã€‹å‘è¡¨\n\n###  \n\n1987å¹´ï¼ŒTanenbaum å’Œ Renesseå‘è¡¨æ–‡ç« ã€ŠA Critique of the Remote Procedure Call Paradigmã€‹ï¼Œè®¨è®ºäº†RPC æ¨¡å‹çš„æ¦‚å¿µé—®é¢˜ã€å®ç°æŠ€æœ¯é—®é¢˜ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å´©æºƒåçš„å¤„ç†é—®é¢˜ã€ä¸åŒç³»ç»Ÿé—´çš„é—®é¢˜ä»¥åŠæ€§èƒ½ç­‰å¤šæ–¹é¢çš„é—®é¢˜ï¼Œå¹¶å¯¹å­˜åœ¨çš„é—®é¢˜è¿›è¡Œäº†åˆ†æã€‚\n\n\n\n> ä¸€ä¸ªé€šç”¨çš„èŒƒä¾‹ä¸åº”è¯¥è¦æ±‚ç¨‹åºå‘˜å°†è‡ªå·±é™åˆ¶åœ¨æ‰€é€‰æ‹©çš„ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªå­é›†ä¸­ï¼Œæˆ–è€…å¼ºè¿«ä»–ä»¬é‡‡ç”¨æŸç§ç¼–ç¨‹é£æ ¼ï¼ˆä¾‹å¦‚ï¼Œä¸è¦ä¸€åˆ€åˆ‡çš„ä½¿ç”¨æŒ‡é’ˆï¼Œå› ä¸º RPC ä¸èƒ½å¤„ç†å®ƒä»¬ï¼‰\n\n\n\nåœ¨è¿™ç¯‡è¯„è®ºä¸­ï¼Œä½œè€…ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼š\n\n\n\n> å‡è®¾ä¸¤ä¸ªç¨‹åºå‘˜åœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šå·¥ä½œã€‚ç¨‹åºå‘˜1æ­£åœ¨ç¼–å†™ä¸»ç¨‹åºã€‚ç¨‹åºå‘˜2ç¼–å†™ä¸€ä¸ªè¢«ä¸»ç¨‹åºè°ƒç”¨çš„è¿‡ç¨‹é›†åˆã€‚RPC çš„ä¸»é¢˜ä»æœªè¢«æåŠï¼Œä¸¤ä¸ªç¨‹åºå‘˜éƒ½è®¤ä¸ºä»–ä»¬çš„æ‰€æœ‰ä»£ç å°†è¢«ç¼–è¯‘å¹¶é“¾æ¥æˆä¸€ä¸ªå•ä¸€çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶ç¨‹åºï¼Œå¹¶åœ¨ç‹¬ç«‹çš„è®¡ç®—æœºä¸Šè¿è¡Œï¼Œä¸è¿æ¥ä»»ä½•ç½‘ç»œã€‚\n>\n> \n>\n> åœ¨æœ€åä¸€åˆ†é’Ÿï¼Œåœ¨æ‰€æœ‰çš„ä»£ç éƒ½ç»è¿‡äº†å½»åº•çš„æµ‹è¯•ã€è°ƒè¯•å’Œè®°å½•ä¹‹åï¼Œä¸¤ä¸ªç¨‹åºå‘˜éƒ½è¾èŒç¦»å¼€äº†è¿™ä¸ªå›½å®¶ï¼Œä»£ç éƒ¨ç½²åœ¨å……æ»¡æ„å¤–çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šè¿è¡Œã€‚ä¸»ç¨‹åºå’Œè¿‡ç¨‹ä»£ç åœ¨ä¸åŒçš„è®¡ç®—æœºä¸Šè¿è¡Œã€‚\n>\n> \n>\n> æˆ‘ä»¬çš„è®ºç‚¹æ˜¯ï¼Œç”±äº RPC è¯•å›¾ä½¿è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çœ‹èµ·æ¥ä¸æœ¬åœ°è¿‡ç¨‹è°ƒç”¨å®Œå…¨ä¸€æ ·ï¼Œä½†æ— æ³•å®Œç¾åœ°å®Œæˆï¼Œè°ƒç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„é”™è¯¯ã€‚è™½ç„¶è®¸å¤šé—®é¢˜å¯ä»¥é€šè¿‡ä¿®æ”¹ä»£ç æ¥è§£å†³ï¼Œä½†æ˜¯è¿™æ ·å°±å¤±å»äº†é€æ˜æ€§ã€‚ä¸€æ—¦æˆ‘ä»¬æ‰¿è®¤çœŸæ­£çš„é€æ˜æ€§æ˜¯ä¸å¯èƒ½çš„ï¼Œå¹¶ä¸”ç¨‹åºå‘˜å¿…é¡»çŸ¥é“å“ªäº›è°ƒç”¨æ˜¯è¿œç¨‹çš„ï¼Œå“ªäº›æ˜¯æœ¬åœ°çš„ï¼Œæˆ‘ä»¬å°±ä¼šé¢ä¸´è¿™æ ·ä¸€ä¸ªé—®é¢˜: åœ¨æ ¹æœ¬æ²¡æœ‰å°è¯•ä½¿è¿œç¨‹è®¡ç®—çœ‹èµ·æ¥åƒæœ¬åœ°çš„å‰æä¸‹ï¼Œéƒ¨åˆ†é€æ˜çš„æœºåˆ¶æ˜¯å¦çœŸçš„æ¯”ä¸“é—¨ä¸ºè¿œç¨‹è®¿é—®è®¾è®¡çš„æœºåˆ¶æ›´å¥½ã€‚\n\n\n\nåŒæ—¶ï¼Œè¿˜è®¨è®ºäº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š\n\n\n\n#### ä¸¤å†›é—®é¢˜\n\n\n\n> ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæ— æ³•ä¿è¯æ•°æ®å¯ä»¥100%æ— è¯¯çš„é€šè¿‡ç½‘ç»œä¼ é€’ã€‚\n\n\n\n#### å‚æ•°é—®é¢˜\n\n\n\n> å‚æ•°ç¼–ç»„ï¼Œå‚æ•°é¡ºåºï¼Œå‚æ•°ä¼ é€’ç­‰ã€‚ç‰¹åˆ«æ˜¯æŒ‡é’ˆç±»å‹çš„å‚æ•°ä¼ é€’ã€‚\n>\n> ç°ä»£RPC é€šå¸¸ä½¿ç”¨----------------------\n\n\n\n#### å…¨å±€å˜é‡\n\n\n\n> æ—¢ç„¶æ˜¯RPC å¯ä»¥åƒæœ¬åœ°è°ƒç”¨ä¸€æ ·ä½¿ç”¨ï¼Œé‚£ä¹ˆå…¨å±€å˜é‡æ˜¯å¦å¯ä»¥é€šç”¨ï¼Ÿ\n\n\n\n#### æ€§èƒ½é—®é¢˜\n\n\n\n#### å¼‚å¸¸å¤„ç†\n\n\n\n> é€šå¸¸å½“ä¸»ç¨‹åºè°ƒç”¨è¿‡ç¨‹æ—¶ï¼Œå¦‚æœä»£ç æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆè¯¥è¿‡ç¨‹æœ€ç»ˆå°†è¿”å›ç»™è°ƒç”¨è€…ã€‚å¦‚æœæœºå™¨å´©æºƒï¼Œä¸»ç¨‹åºå’Œç¨‹åºéƒ½ä¼šæ­»äº¡ï¼Œæ•´ä¸ªç¨‹åºå¿…é¡»é‡æ–°è¿è¡Œã€‚å› æ­¤ï¼ŒåŸºæœ¬ä¸Šæœ‰ä¸¤ç§æ“ä½œæ¨¡å¼: æ•´ä¸ªç¨‹åºå·¥ä½œæˆ–æ•´ä¸ªç¨‹åºå¤±è´¥ã€‚\n>\n> RPC å¼•å…¥äº†å¦ä¸€ç§æ•…éšœæ¨¡å¼: å®¢æˆ·ç«¯å·¥ä½œæ­£å¸¸ï¼Œä½†æœåŠ¡å™¨å´©æºƒã€‚å¦‚æœä¸€ä¸ªä¸»ç¨‹åºè°ƒç”¨ä¸€ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯æ²¡æœ‰å“åº”ï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿåœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯ä¼šæ°¸è¿œæŒ‚èµ·ã€‚\n>\n> å¦ä¸€ç§å¯èƒ½æ˜¯è®©å®¢æˆ·ç«¯å­˜æ ¹åœ¨å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯æ—¶å¯åŠ¨è®¡æ—¶å™¨ã€‚å¦‚æœåœ¨æŸä¸ªæ—¶é—´é—´éš”ä¹‹åæ²¡æœ‰å“åº”ï¼Œå®ƒä¼šä¸€æ¬¡åˆä¸€æ¬¡åœ°å°è¯•ã€‚åœ¨ n æ¬¡é‡è¯•ä¹‹åï¼Œä¾ç„¶å¤±è´¥é‚£ä¹ˆåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯ç æ ‡è¯†æœåŠ¡ä¸å¯ç”¨ã€‚\n\n\n\n#### å¹‚ç­‰é—®é¢˜\n\n\n\n### 1988å¹´ï¼ŒRFC 1057 å‘å¸ƒï¼ŒONC RPC è¢«å®šä¹‰ä¸ºæ ‡å‡†çš„RPC è§„èŒƒ\n\n\n\n> Sun å…¬å¸æ˜¯ç¬¬ä¸€ä¸ªæä¾›å•†ä¸šåŒ– RPC åº“å’Œ RPC ç¼–è¯‘å™¨ã€‚åœ¨1980å¹´ä»£ä¸­æœŸï¼Œ Sun è®¡ç®—æœºæä¾› RPCï¼Œå¹¶åœ¨ Sun Network File System(NFS) å¾—åˆ°æ”¯æŒã€‚è¯¥åè®®è¢«ä¸»è¦ä»¥ Sun å’Œ AT&T ä¸ºé¦–çš„ Open Network Computing ï¼ˆå¼€æ”¾ç½‘ç»œè®¡ç®—ï¼‰ä½œä¸ºä¸€ä¸ªæ ‡å‡†æ¥æ¨åŠ¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§ RPC ç³»ç»Ÿï¼Œå¯ç”¨åœ¨å¤§å¤šæ•° POSIX å’Œç±» POSIX æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨ï¼ŒåŒ…æ‹¬ Linuxã€SunOSã€OS X å’Œå„ç§å‘å¸ƒç‰ˆæœ¬çš„ BSDã€‚è¿™æ ·çš„ç³»ç»Ÿè¢«ç§°ä¸º Sun RPC æˆ– ONC RPCã€‚æœ€ç»ˆsunæˆåŠŸäº†ï¼Œsunrpc æˆäº†ç¬¬ä¸€ä¸ªrpcçš„æ ‡å‡†ã€‚\n\n\n\n> ONC RPC æä¾›äº†ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œéœ€è¦ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹æ¥å£çš„å®šä¹‰æ¥ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„å­˜æ ¹å‡½æ•°ã€‚è¿™ä¸ªç¼–è¯‘å™¨å«åš rpcgenã€‚åœ¨è¿è¡Œæ­¤ç¼–è¯‘å™¨ä¹‹å‰ï¼Œç¨‹åºå‘˜å¿…é¡»æä¾›æ¥å£å®šä¹‰ã€‚åŒ…å«å‡½æ•°å£°æ˜çš„æ¥å£å®šä¹‰ï¼Œé€šè¿‡ç‰ˆæœ¬å·è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è¢«ä¸€ä¸ªç‹¬ç‰¹çš„ç¨‹åºç¼–ç æ¥æ ‡è¯†ã€‚è¯¥ç¨‹åºç¼–ç èƒ½å¤Ÿè®©å®¢æˆ·æ¥ç¡®å®šæ‰€éœ€çš„æ¥å£ã€‚ç‰ˆæœ¬å·æ˜¯éå¸¸æœ‰ç”¨çš„,å³ä½¿å®¢æˆ·æ²¡æœ‰æ›´æ–°åˆ°æœ€æ–°çš„ä»£ç ä»ç„¶å¯ä»¥è¿æ¥åˆ°ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ï¼Œåªè¦è¯¥æœåŠ¡å™¨è¿˜æ”¯æŒæ—§æ¥å£ã€‚\n\n![90dc3e7458138e6f2fd79297c50f347d.jpg-wh_600x-s_771365725.jpg](http://media.gusibi.mobi/GDG3SRhCn3zFDd0kf23qFfNqh2S25w96i2XKGB5GCDI-DeayrzzEOOG-KhhRy97k)\n\n#### RPCçš„è°ƒç”¨æµç¨‹\n\n\n\n1. æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆclientï¼‰ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡ã€‚\n2. client stubæ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ã€‚\n3. client stubæ‰¾åˆ°æœåŠ¡åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ã€‚\n4. server stubæ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç ã€‚\n5. server stubæ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°æœåŠ¡ã€‚\n6. æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æœè¿”å›ç»™server stubã€‚\n7. server stubå°†è¿”å›ç»“æœæ‰“åŒ…æˆæ¶ˆæ¯å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹ã€‚\n8. client stubæ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œè§£ç ã€‚\n9. æœåŠ¡æ¶ˆè´¹æ–¹å¾—åˆ°æœ€ç»ˆç»“æœã€‚\n\n\n#### æœåŠ¡å‘ç°\n\n![20160630-rpc-onc_lookup.png](http://media.gusibi.mobi/htLdzMhUJ1v7952Zl7zmE-WMpTWN9uTrqymWdBC_uNOrmcni5vEOaIg_Oj58vZIY)\n\n\nONC RPC é€šè¿‡æœåŠ¡ç«¯çš„ä¸€ä¸ª portmapper æ¥å®ç°æœåŠ¡å‘ç°ã€‚æœåŠ¡ç«¯åœ¨å¯åŠ¨æ—¶å‘ portmapper æ³¨å†Œï¼Œportmapper çš„ç«¯å£æ˜¯å¤§å®¶éƒ½çŸ¥é“çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ portmapper æ‰¾åˆ°æœåŠ¡ç«¯ã€‚\n\n\n\nONC RPC ä½œä¸ºæœ€æ—©çš„ RPC æ¡†æ¶ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šé—®é¢˜çš„\n\n\n\n1. **åè®®æ ¼å¼è¦æ±‚ä¸¥æ ¼**ï¼šéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å‹ç¼©æ ¼å¼**å®Œå…¨ä¸€è‡´**ã€‚\n2. **åè®®ä¿®æ”¹ä¸çµæ´»**ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½è¦åšä¿®æ”¹ï¼Œå¦‚æœåªæœ‰ä¸€æ–¹åšäº†ä¿®æ”¹ï¼Œ é‚£ RPC å°±ä¼šæœ‰é”™è¯¯ã€‚è¿™å¯¼è‡´ç‰ˆæœ¬æ›´æ–°çš„é—®é¢˜ï¼Œæ¯ä¸€æ¬¡çš„ç‰ˆæœ¬æ›´æ–°ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŸºæœ¬æ˜¯è€¦åˆçš„ï¼Œå¿…é¡»åŒæ—¶ä½œå‡ºæ›´æ”¹ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æœ‰è¿è¡Œï¼Œå®¢æˆ·ç«¯æ˜¯æ— æ³•è¿æ¥åˆ°è¿œç¨‹è¿‡ç¨‹è¿›è¡Œè°ƒç”¨çš„ã€‚ç®¡ç†å‘˜å¿…é¡»è¦ç¡®ä¿åœ¨ä»»ä½•å®¢æˆ·ç«¯è¯•å›¾è¿æ¥åˆ°æœåŠ¡å™¨ä¹‹å‰å°†æœåŠ¡å™¨å¯åŠ¨ã€‚å¦‚æœä¸€ä¸ªæ–°æœåŠ¡æˆ–æ¥å£æ·»åŠ åˆ°äº†ç³»ç»Ÿï¼Œå®¢æˆ·ç«¯æ˜¯ä¸èƒ½å‘ç°çš„ã€‚è¿™å°±è¦æ±‚å¼€å‘å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„éœ€è¦æ˜¯åŒä¸€æ‰¹äººï¼Œæˆ–è€…è‡³å°‘è¦æœ‰å¯†åˆ‡çš„äº¤æµã€‚\n3. **é¢å‘å‡½æ•°**ï¼šé¢å‘å¯¹è±¡çš„è¯­è¨€å¼€å§‹åœ¨1980å¹´ä»£æœ«å…´èµ·ï¼Œé¢å‘å‡½æ•°çš„ONC RPC æ²¡æœ‰æä¾›ä»»ä½•æ”¯æŒè¯¸å¦‚ä»è¿œç¨‹ç±»å®ä¾‹åŒ–è¿œç¨‹å¯¹è±¡ã€è·Ÿè¸ªå¯¹è±¡çš„å®ä¾‹æˆ–æä¾›æ”¯æŒå¤šæ€æ€§ã€‚ç°æœ‰çš„ RPC æœºåˆ¶è™½ç„¶å¯ä»¥è¿ä½œï¼Œä½†ä»–ä»¬ä»ç„¶ä¸æ”¯æŒè‡ªåŠ¨ã€é€æ˜çš„æ–¹å¼çš„é¢å‘å¯¹è±¡ç¼–ç¨‹æŠ€æœ¯ã€‚\n\n\n\n### 1989å¹´ï¼šTim Berners-Lee åˆ›å»ºäº†ä¸‡ç»´ç½‘\n\n\n\n1989å¹´ï¼Œ[è’‚å§†Â·ä¼¯çº³æ–¯-æ](https://zh.wikipedia.org/wiki/è’‚å§†Â·ä¼¯çº³æ–¯-æ)å‘æ˜äº†ä¸‡ç»´ç½‘ã€‚ç¬¬äºŒå¹´9æœˆï¼Œå¼€å‘äº†ç¬¬ä¸€ä¸ªç½‘é¡µæµè§ˆå™¨ã€‚åˆ°1990å¹´åœ£è¯èŠ‚ï¼Œè’‚å§†Â·ä¼¯çº³æ–¯-æåˆ›å»ºè¿è¡Œä¸‡ç»´ç½‘æ‰€éœ€çš„æ‰€æœ‰å·¥å…·ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰ã€è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼ˆHTMLï¼‰ã€ç¬¬ä¸€ä¸ªç½‘é¡µæµè§ˆå™¨ã€ç¬¬ä¸€ä¸ªç½‘é¡µæœåŠ¡å™¨å’Œç¬¬ä¸€ä¸ªç½‘ç«™ï¼Œå®ç°äº†[è¶…æ–‡æœ¬ä¼ è¾“åè®®](https://zh.wikipedia.org/wiki/è¶…æ–‡æœ¬ä¼ è¾“åè®®)å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„ç¬¬ä¸€æ¬¡é€šè®¯ã€‚ä»–ä¹Ÿå› æ­¤è€Œè·å¾—äº†2016å¹´çš„**å›¾çµå¥–**ã€‚\n\n\n\nåˆ°1995å¹´ï¼Œäº’è”ç½‘åœ¨ç¾å›½å·²å®Œå…¨å•†ä¸šåŒ–ã€‚\n\n\n\n### 1991å¹´ï¼šOMG å‘å¸ƒCORBA 1.0\n\n\n\n> OMGæˆç«‹äº1989å¹´ï¼Œä½œä¸ºä¸€ä¸ªéè¥åˆ©æ€§ç»„ç»‡ï¼Œé›†ä¸­è‡´åŠ›äºå¼€å‘åœ¨æŠ€æœ¯ä¸Šå…·æœ‰å…ˆè¿›æ€§ã€åœ¨å•†ä¸šä¸Šå…·æœ‰å¯è¡Œæ€§å¹¶ä¸”ç‹¬ç«‹äºå‚å•†çš„è½¯ä»¶äº’è”è§„èŒƒï¼Œæ¨å¹¿é¢å‘å¯¹è±¡æ¨¡å‹æŠ€æœ¯ï¼Œå¢å¼ºè½¯ä»¶çš„å¯ç§»æ¤æ€§(Portability)ã€å¯é‡ç”¨æ€§(Reusability)å’Œäº’æ“ä½œæ€§(Interoperability)ã€‚è¯¥ç»„ç»‡æˆç«‹ä¹‹åˆï¼Œæˆå‘˜åŒ…æ‹¬Unisysã€Sunã€Cannonã€Hewlett-Packardå’ŒPhilipsç­‰åœ¨ä¸šç•Œäº«æœ‰å£°èª‰çš„è½¯ç¡¬ä»¶å‚å•†ï¼Œç›®å‰è¯¥ç»„ç»‡æ‹¥æœ‰800å¤šå®¶æˆå‘˜ã€‚\n\n\n\nCORBAï¼ˆCommon Object Request Broker Architectureï¼‰ æ˜¯é¢å‘å¯¹è±¡è¯­è¨€çš„ä¸€ä¸ªæŠ½è±¡ï¼Œç”± C++ å¼€å‘ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸åŒçš„è¯­è¨€å’Œä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œçš„ä¸åŒçš„åœ°å€ç©ºé—´ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚CORBA ä¾èµ–äºä½¿ç”¨æ¥å£å®šä¹‰è¯­è¨€(IDL)æ¥æŒ‡å®šè¿œç¨‹å¯¹è±¡ç±»çš„æ¥å£; è¿™ç§ IDL ç”¨äºç”Ÿæˆè¿œç¨‹ç³»ç»Ÿå¯¹è±¡æ¥å£åœ¨æœ¬åœ°æœºå™¨ä¸Šçš„æ¥å£ã€‚è¿™äº› IDL å°†ç”¨äºç”Ÿæˆ IDL æä¾›çš„æŠ½è±¡æ¥å£ä¸ C++ å’Œ Java ç­‰è¯­è¨€çš„å®é™…å®ç°ä¹‹é—´çš„æ˜ å°„ã€‚\n\n\n\nCORBA è¯•å›¾ä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›å‡ ä¸ªå¥½å¤„: **è¯­è¨€ç‹¬ç«‹æ€§ã€æ“ä½œç³»ç»Ÿç‹¬ç«‹æ€§ã€ä½“ç³»ç»“æ„ç‹¬ç«‹æ€§ã€é€šè¿‡ IDL ä¸­çš„æŠ½è±¡ç±»å‹æ˜ å°„åˆ°è¿™äº›ç±»å‹çš„æœºå™¨å’Œè¯­è¨€ç‰¹å®šå®ç°çš„é™æ€ç±»å‹ï¼Œä»¥åŠå¯¹è±¡ä¼ è¾“ï¼Œå…¶ä¸­å¯¹è±¡å¯ä»¥é€šè¿‡ä¸åŒæœºå™¨ä¹‹é—´çš„è¿æ¥è¿›è¡Œè¿ç§»**ã€‚CORBA çš„æ‰¿è¯ºæ˜¯ï¼Œé€šè¿‡ä½¿ç”¨æ˜ å°„ï¼Œè¿œç¨‹è°ƒç”¨å¯ä»¥ä½œä¸ºæœ¬åœ°è°ƒç”¨å‡ºç°ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¼‚å¸¸å¯ä»¥æ˜ å°„åˆ°æœ¬åœ°å¼‚å¸¸ï¼Œå¹¶ç”±æœ¬åœ°å¼‚å¸¸å¤„ç†æœºåˆ¶å¤„ç†ã€‚\n\n\n\n### 1994å¹´ï¼šA Note on Distributed Computing å‘å¸ƒ\n\n\n\nJim Waldo ç­‰äººå‘è¡¨äº†ä¸€ç¯‡ åä¸º ã€Š**A Note on Distributed Computingã€‹çš„è®ºæ–‡ã€‚**  è¿™ç¯‡è®ºæ–‡è¯¦ç»†è®¨è®ºäº†ä¸ºä»€ä¹ˆ RPC æ¨¡å‹æ‰©å±•åˆ°å¯¹è±¡ï¼Œæ˜¯æœ‰é—®é¢˜çš„ã€‚\n\n\n\nåœ¨è¿™ç¯‡è®ºæ–‡ä¸­ï¼Œä½œè€…è®¤ä¸ºå¿½è§†æœ¬åœ°å’Œåˆ†å¸ƒå¼è®¡ç®—ä¹‹å‰çš„å·®å¼‚æ˜¯å¾ˆå±é™©çš„ï¼ŒåŒæ—¶å®ƒè¿˜è®¨è®ºäº†ä¸€ä¸ªç»Ÿä¸€çš„å¯¹è±¡è§†å›¾ï¼Œå¹¶åˆ—ä¸¾äº†åœ¨ RPC ä¸­å°†è¿™äº›å¯¹è±¡åˆ’åˆ†ä¸ºåˆ†å¸ƒå¼è®¡ç®—çš„4ä¸ªä¸»è¦é—®é¢˜: é€šä¿¡å»¶è¿Ÿã€è§£å†³ç©ºé—´åˆ†ç¦»ã€éƒ¨åˆ†æ•…éšœå’Œå¹¶å‘é—®é¢˜(ç”±äºé€šè¿‡ä¸¤ä¸ªå¹¶å‘çš„å®¢æˆ·ç«¯è¯·æ±‚è®¿é—®åŒä¸€ä¸ªè¿œç¨‹å¯¹è±¡è€Œå¯¼è‡´)ã€‚è¿™äº›é—®é¢˜ä¸­çš„å¤§å¤šæ•°(é™¤äº†éƒ¨åˆ†æ•…éšœ)éƒ½ä¸åˆ†å¸ƒå¼è®¡ç®—æœ¬èº«æœ‰ç€å†…åœ¨çš„è”ç³»ï¼Œä½†æ˜¯å¯¹äº RPC ç³»ç»Ÿæ¥è¯´ï¼Œéƒ¨åˆ†æ•…éšœå³æ„å‘³ç€ RPC ç³»ç»Ÿå¹¶ä¸æ€»æ˜¯å¯ç”¨çš„ã€‚\n\n\n\nåŒæ—¶ï¼Œä½œè€…ä¹Ÿè®¤ä¸ºåˆ†å¸ƒå¼è®¡ç®—çš„éš¾é¢˜ä¸åœ¨äºå¦‚ä½•åœ¨çº¿ä¸Šæˆ–è€…çº¿ä¸‹è¿›è¡Œæ“ä½œï¼Œ**å¹¶ä¸”æ¯éš”10å¹´ï¼Œæˆ‘ä»¬å°±ä¼šè¯•å›¾ç»Ÿä¸€æœ¬åœ°è®¡ç®—å’Œè¿œç¨‹è®¡ç®—ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½ä¼šé‡åˆ°åŒæ ·çš„é—®é¢˜ï¼šè¿œç¨‹è®¡ç®—å’Œæœ¬åœ°è®¡ç®—æ˜¯ä¸åŒçš„**ã€‚\n\n\n\nä½œè€…è®¤ä¸ºï¼Œè¿œç¨‹è®¡ç®—çš„é—®é¢˜ä¸»è¦æœ‰ä»¥ä¸‹å†…å®¹ï¼š\n\n\n\n#### å»¶è¿Ÿ\n\n\n\næœ¬åœ°è°ƒç”¨å’Œè¿œç¨‹è°ƒç”¨æœ€æ˜æ˜¾çš„åŒºåˆ«åº”è¯¥æ˜¯å»¶è¿Ÿé—®é¢˜: å¦‚æœå¿½ç•¥å»¶è¿Ÿï¼Œæœ€ç»ˆå°†ç›´æ¥å½±å“è½¯ä»¶æ€§èƒ½ã€‚ä»–æŒ‡å‡ºï¼Œâ€œä¾èµ–äºåº•å±‚ç¡¬ä»¶ç¨³æ­¥å¢é•¿çš„é€Ÿåº¦â€æ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”ä½¿ç”¨ â€œçœŸæ­£çš„å­å¼¹â€ å¹¶ä¸æ€»æ˜¯å¯èƒ½è¿›è¡Œæµ‹è¯•ã€‚æ€§èƒ½åˆ†æå’Œé‡å®šä½æ˜¯éå¸¸é‡è¦çš„ï¼Œåœ¨æŸä¸€ç‚¹ä¸Šæ˜¯æœ€ä¼˜çš„è®¾è®¡ä¸ä¸€å®šä¿æŒæœ€ä¼˜ã€‚\n\n\n\n#### éƒ¨åˆ†å¤±è´¥\n\n\n\nåœ¨æœ¬åœ°è®¡ç®—æœºä¸­ï¼Œæ•…éšœæ˜¯å¯ä»¥æ£€æµ‹åˆ°çš„ï¼Œå¹¶ä¸”ä¸»ç¨‹åºæœ‰è¶³å¤Ÿçš„æ§åˆ¶æƒã€‚ä½†å¯¹äºåˆ†å¸ƒå¼è®¡ç®—æ¥è¯´ï¼Œæƒ…å†µå¹¶éå¦‚æ­¤: è¿œç¨‹ç»„ä»¶å¯èƒ½å¤±è´¥ï¼Œå¦‚æœå‘ç”Ÿäº†éƒ¨åˆ†å¤±è´¥ã€è¿æ¥å¤±è´¥ä¸è¿œç¨‹å¤„ç†å™¨å¤±è´¥æ— æ³•åŒºåˆ†ã€‚\n\n\n\nWaldo è®¤ä¸ºï¼Œå¦‚æœæƒ³è¦å®ç°ç»Ÿä¸€å¯¹è±¡æ¨¡å‹ï¼Œåªæœ‰ä¸¤æ¡é“è·¯ã€‚\n\n\n\n1. å°†æ‰€æœ‰å¯¹è±¡è§†ä¸ºæœ¬åœ°å¯¹è±¡\n2. å°†æ‰€æœ‰å¯¹è±¡è§†ä¸ºè¿œç¨‹å¯¹è±¡ã€‚\n\n\n\n> **ä½†æœ€é‡è¦çš„é—®é¢˜ä¸æ˜¯â€œä½ èƒ½è®©è¿œç¨‹æ–¹æ³•è°ƒç”¨çœ‹èµ·æ¥åƒæœ¬åœ°æ–¹æ³•è°ƒç”¨å—ï¼Ÿè€Œæ˜¯ä½¿è¿œç¨‹æ–¹æ³•è°ƒç”¨ä¸æœ¬åœ°æ–¹æ³•è°ƒç”¨ç›¸åŒçš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ**\n\n\n\n\n\nè¿™æ˜¯ä¸€ä¸ªä¸èƒ½å¿½ç•¥çš„é—®é¢˜ã€‚\n\n\n\n\n\n> åˆ°è¿™é‡Œä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°é’ˆå¯¹RPC çš„è®¨è®ºåŸºæœ¬éƒ½æ˜¯åœ¨è®¨è®ºè®¾è®¡ã€å®ç°ã€é¢å‘å¯¹è±¡ã€æ€§èƒ½ã€åˆ†å¸ƒå¼é—®é¢˜å¦‚ä½•è§£å†³ã€‚æœ‰ä¸€ç‚¹å¥½åƒè¢«å¿½ç•¥äº†ï¼Œé‚£å°±æ˜¯æ˜“ç”¨æ€§ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ˜¯å› ä¸ºå½“æ—¶çš„ç¨‹åºå‘˜å–œæ¬¢å¤æ‚çš„æŠ€æœ¯ä¹ˆï¼Ÿ\n>\n> \n>\n> æˆ‘ä»¥å‰è€å¤§æœ‰ä¸€æ¬¡åˆ†äº«çš„æ—¶å€™è¯´ï¼Œä»–è®¤ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼€å‘è€…éƒ½æ˜¯åˆæ ¼çš„ç¨‹åºå‘˜ï¼Œåˆæ ¼çš„ç¨‹åºå‘˜åº”è¯¥æ˜¯åƒæ—çº³æ–¯ã€ä¸¹å°¼æ–¯ã€è’‚å§†é‚£æ ·ï¼Œå°è¯•æ”¹å˜ä¸–ç•Œå¹¶ä¸”ä¸ºä¹‹åŠªåŠ›çš„äººã€‚äº’è”ç½‘æ—©æœŸï¼Œå¼€å‘è€…æ•°é‡è¾ƒå°‘ï¼Œç¨‹åºå‘˜æ˜¯ä¸€ä¸ªç›¸å¯¹å°ä¼—ç²¾è‹±çš„å›¢ä½“ï¼Œè¿™ç§ç¨‹åºå‘˜å å¾—æ¯”ä¾‹ä¹Ÿå¤§ï¼Œåè®®åˆ¶å®šçš„æ—¶å€™æ›´å¤šè€ƒè™‘çš„ä¹Ÿæ˜¯å¦‚ä½•å‹æ¦¨è®¡ç®—æœºæ€§èƒ½ï¼Œæ˜“ç”¨æ€§å¯èƒ½ä¹Ÿä¸åœ¨ç¬¬ä¸€ä¼˜å…ˆçº§èŒƒå›´å†…ã€‚\n>\n> \n>\n> è€Œåˆ°äº†90å¹´ä»£åæœŸï¼Œäº’è”ç½‘å·²ç»å¼€å§‹æ™®åŠï¼Œéšç€web å¼€å‘çš„å…´èµ·ï¼Œå¼€å‘è€…ä¹Ÿä»¥æŒ‡æ•°çš„é€Ÿåº¦å¢é•¿ï¼Œè¿™æ—¶å¼€å‘æ¡†æ¶å°±ä¸ä»…ä»…è¦è€ƒè™‘å°éƒ¨åˆ†äººçš„ä½¿ç”¨ä½“éªŒè€Œæ˜¯è¦ç…§é¡¾å¤§å¤šæ•°äººçš„ä½¿ç”¨ä½“éªŒäº†ã€‚\n\n\n\n### 1996å¹´ï¼šHTTP/1.x ç‰ˆæœ¬å‘å¸ƒ\n\n\n\n1996 å¹´ï¼ŒHTTP/1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå¤§å¤§ä¸°å¯Œäº† HTTP çš„ä¼ è¾“å†…å®¹ï¼Œé™¤äº†æ–‡å­—ï¼Œè¿˜å¯ä»¥å‘é€å›¾ç‰‡ã€è§†é¢‘ç­‰ï¼Œè¿™ä¸ºäº’è”ç½‘çš„å‘å±•å¥ å®šäº†åŸºç¡€ã€‚\n\nç›¸æ¯” HTTP/0.9ï¼ŒHTTP/1.0 ä¸»è¦æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š\n\n-  è¯·æ±‚ä¸å“åº”æ”¯æŒ HTTP å¤´ï¼Œå¢åŠ äº†çŠ¶æ€ç ï¼Œå“åº”å¯¹è±¡çš„ä¸€å¼€å§‹æ˜¯ä¸€ä¸ªå“åº”çŠ¶æ€è¡Œ\n-  åè®®ç‰ˆæœ¬ä¿¡æ¯éœ€è¦éšç€è¯·æ±‚ä¸€èµ·å‘é€ï¼Œæ”¯æŒ HEADï¼ŒPOST æ–¹æ³•\n-  æ”¯æŒä¼ è¾“ HTML æ–‡ä»¶ä»¥å¤–å…¶ä»–ç±»å‹çš„å†…å®¹\n\nåœ¨ HTTP/1.0 å‘å¸ƒå‡ ä¸ªæœˆåï¼ŒHTTP/1.1 å°±å‘å¸ƒäº†ã€‚HTTP/1.1 æ›´å¤šçš„æ˜¯ä½œä¸ºå¯¹ HTTP/1.0 çš„å®Œå–„\n\n\n\n### 1997å¹´ï¼šOMGå‘å¸ƒCORBA2.0 \n\n\n\n1994å¹´12æœˆï¼ŒCORBA 2.0 å°±å·²ç»å‘å¸ƒè§„èŒƒï¼Œè¯¥è§„èŒƒå¸Œæœ›èƒ½å¤Ÿè§£å†³ä¸åŒå‚å•†æ ¹æ®COBRAè§„èŒƒæ‰€å¼€å‘çš„äº§å“â€œäº’è”äº’ä¸é€šâ€çš„ä¸¥é‡é—®é¢˜ï¼Œä½†ç›´åˆ°1997å¹´ï¼ŒCorba2.0 æ‰æ­£å¼å‘å¸ƒï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯å¤±è´¥äº†ã€‚è‡³äºCOBRAå¤±è´¥çš„åŸå› ï¼ŒCOBRAé˜µè¥çš„æŠ€æœ¯å¤§ç‰›ã€COBRAæŠ€æœ¯çš„æ¨åŠ¨è€…ï¼Œå³åæ¥åŠ å…¥åCOBRAé˜µè¥çš„Michi Henningï¼Œåœ¨ä»–çš„ã€ŠThe rise and fall of CORBAã€‹ä¹¦é‡Œåšäº†å¦‚ä¸‹æ·±åˆ»çš„æ€»ç»“ã€‚\n\n\n\n- **è§„èŒƒå·¨å¤§è€Œå¤æ‚**ï¼šè®¸å¤šç‰¹æ€§éƒ½æœªæ›¾è¢«å®ç°ï¼Œç”šè‡³æ¦‚å¿µæ€§çš„è¯æ˜éƒ½æ²¡æœ‰åšè¿‡ï¼›æœ‰äº›æŠ€æœ¯ç‰¹æ€§æ ¹æœ¬ä¸å¯èƒ½å®ç°ï¼Œå³ä½¿å®ç°ï¼Œä¹Ÿæ— æ³•æä¾›å¯ç§»æ¤æ€§ã€‚\n- **CORBAå­¦ä¹ æ›²çº¿é™¡å³­**ï¼šå¹³å°çš„å­¦ä¹ æ›²çº¿é™¡å³­ï¼ŒæŠ€æœ¯å¤æ‚ï¼Œä¸å®¹æ˜“æ­£ç¡®ä½¿ç”¨ï¼Œè¿™äº›å› ç´ å¯¼è‡´å¼€å‘å‘¨æœŸé•¿ã€æ˜“å‡ºé”™ã€‚æ—©æœŸçš„å®ç°å¸¸å¸¸å……æ»¡Bugå¹¶ä¸”ç¼ºä¹æœ‰è´¨é‡çš„æ–‡æ¡£ï¼Œæœ‰ç»éªŒçš„CORBAç¨‹åºå‘˜ç¨€ç¼ºã€‚\n- **ç¼–ç¨‹å¼€å‘è¿‡äºå¤æ‚**ï¼šæœ‰ç»éªŒçš„CORBAå¼€å‘è€…å‘ç°ç¼–å†™å®ç”¨çš„CORBAåº”ç”¨ç¨‹åºç›¸å½“å›°éš¾ã€‚è®¸å¤šAPIéƒ½å¾ˆå¤æ‚ã€ä¸ä¸€è‡´ï¼Œç”šè‡³è®©äººæ„Ÿè§‰ç¥ç§˜ï¼Œä½¿å¾—å¼€å‘è€…å¿…é¡»å…³æ³¨è®¸å¤šç»†èŠ‚é—®é¢˜ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç»„ä»¶æ¨¡å‹çš„ç®€å•æ€§ï¼Œä¾‹å¦‚åŒæ—¶ä»£çš„EJBï¼Œä½¿å¾—ç¼–ç¨‹ç®€å•å¾ˆå¤šã€‚\n- **è´¹ç”¨æ˜‚è´µ**ï¼šä½¿ç”¨å•†ç”¨CORBAäº§å“æ—¶ï¼Œå¼€å‘è€…ä¸€èˆ¬éƒ½éœ€è¦èŠ±è´¹å‡ åƒç¾å…ƒè´­ä¹°å¼€å‘è€…Licenseï¼Œæ­¤å¤–ï¼Œéƒ¨ç½²CORBAäº§å“ä¸éƒ¨ç½²Oracleæ•°æ®åº“ä¸€æ ·ï¼Œè¿˜éœ€è¦å®¢æˆ·æ”¯ä»˜ä¼ä¸šLicenseè´¹ç”¨ï¼Œè€Œä¸”è¿™ä¸ªè´¹ç”¨å¾ˆå¯èƒ½ä¸éƒ¨ç½²åœ¨CORBAå¹³å°ä¸Šçš„åº”ç”¨æ•°é‡æŒ‚é’©ï¼Œå› æ­¤å¯¹å¾ˆå¤šæ½œåœ¨çš„å®¢æˆ·æ¥è¯´ï¼ŒCORBAè¿™æ ·çš„å¹³å°å¤ªæ˜‚è´µäº†ã€‚\n- **Sunä¸Javaæˆä¸ºCOBRAæœ€å¤§çš„ç«äº‰å¯¹æ‰‹**ï¼šå•†ä¸šå…¬å¸è½¬å‘äº†Sunçš„Javaä¸æ–°å…´çš„Webï¼Œå¹¶ä¸”å¼€å§‹æ„å»ºåŸºäºWebæµè§ˆå™¨ã€Javaå’ŒEJBçš„ç”µå­å•†åŠ¡åŸºç¡€è®¾æ–½ã€‚\n- **XMLæŠ€æœ¯çš„å…´èµ·åŠ é€Ÿäº†COBRAçš„æ²¡è½**ï¼š20ä¸–çºª90å¹´ä»£åæœŸï¼ŒXMLæˆä¸ºè®¡ç®—æœºå·¥ä¸šæ–°çš„é“¶å¼¹ï¼Œå‡ ä¹æ‰€æœ‰å®šä¹‰ä¸ºXMLçš„ä¸œè¥¿éƒ½æ˜¯å¥½çš„ã€‚åœ¨æ”¾å¼ƒäº†DCOMä¹‹åï¼Œå¾®è½¯å¹¶æ²¡æœ‰æŠŠç”µå­å•†åŠ¡å¸‚åœºç•™ç»™ç«äº‰å¯¹æ‰‹ï¼Œæ²¡æœ‰å†å‚ä¸ä¸€åœºä¸å¯èƒ½æ‰“èµ¢çš„æˆ˜äº‰ï¼Œè€Œæ˜¯ä½¿ç”¨XMLå¼€è¾Ÿäº†æ–°çš„æˆ˜åœºã€‚\n\n\n\n> ### **2002å¹´ï¼šZeroC Ice å‘å¸ƒ**\n>\n> \n>\n> æœ€åˆå‚ä¸CORBA çš„ä¸€æ‰¹æŠ€æœ¯ä¸“å®¶ä¸æ»¡CORBA çš„è®¾è®¡ï¼Œå¦èµ·ç‚‰ç¶æ‰“é€ äº†æ–°çš„RPC---å³ ZeroC Iceï¼ŒICE æœ€åˆçš„å¹¿å‘Šè¯­ä¸ºâ€œåå›ä¹‹å†°â€ã€‚å®ƒä¹Ÿä¸€ç›´å»¶ç»­è‡³ä»Šï¼Œå‘å±•æˆäº†ä¸€ä¸ªå¼ºå¤§çš„å¾®æœåŠ¡æ¶æ„å¹³å°ã€‚\n\n\n\n\n\n### 1999å¹´ï¼š SOAP å‘å¸ƒ\n\n\n\n1998 å¹´ XML 1.0 å‘å¸ƒï¼Œè¢« W3C (World Wide Web Consortium) æ¨èä¸ºæ ‡å‡†çš„æè¿°è¯­è¨€ã€‚åŒå¹´ï¼Œå¾®è½¯å’ŒDevelopMentorå‘å¸ƒSOAPï¼ˆSimple Object Access Protocolï¼‰ï¼Œéšåæäº¤ç»™W3Cä½œä¸ºæ ‡å‡†ã€‚SOAP**æ˜¯ä¸€ä¸ªä¸¥æ ¼å®šä¹‰çš„ä¿¡æ¯äº¤æ¢åè®®ï¼Œ**ä½¿ç”¨XMLä½œä¸ºRPCæ–°çš„å¯¹è±¡åºåˆ—åŒ–æœºåˆ¶ï¼Œ**ç”¨äºåœ¨Web Serviceä¸­æŠŠè¿œç¨‹è°ƒç”¨å’Œè¿”å›å°è£…æˆæœºå™¨å¯è¯»çš„æ ¼å¼åŒ–æ•°æ®ã€‚**\n\n\n\n#### åè®®çº¦å®š\n\n\n\nSOAP çš„åè®®çº¦å®šç”¨çš„æ˜¯ WSDL (Web Service Description Language) ï¼Œè¿™æ˜¯ä¸€ç§ Web æœåŠ¡æè¿°è¯­è¨€ï¼Œåœ¨æœåŠ¡çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¼€å‘è€…ä¸ç”¨é¢å¯¹é¢äº¤æµï¼Œåªè¦ç”¨çš„æ˜¯ WSDL å®šä¹‰çš„æ ¼å¼ï¼Œå®¢æˆ·ç«¯çŸ¥é“äº† WSDL æ–‡ä»¶ï¼Œå°±çŸ¥é“æ€ä¹ˆå»å°è£…è¯·æ±‚ï¼Œè°ƒç”¨æœåŠ¡ã€‚\n\n\n\n#### ä¼ è¾“åè®®\n\n\n\nSOAP æ˜¯ç”¨ HTTP è¿›è¡Œä¼ è¾“çš„ï¼Œä¿¡æ¯æœ‰ Header å’Œ Bodyï¼ŒSOAP çš„è¯·æ±‚å’Œå›å¤éƒ½æ”¾åœ¨æ¶ˆæ¯ä¸­ï¼Œè¿›è¡Œä¼ é€’ã€‚\n\n\n\n#### æœåŠ¡å‘ç°\n\n\n\nSOAP çš„æœåŠ¡å‘ç°ç”¨çš„æ˜¯ **UDDI**ï¼ˆUniversal Description, Discovery, Integration) ç»Ÿä¸€æè¿°å‘ç°é›†æˆï¼Œç›¸å½“äºä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡æä¾›æ–¹å°† WSDL æ–‡ä»¶å‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒï¼Œä½¿ç”¨æ–¹å¯ä»¥åˆ°è¿™ä¸ªæ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾ã€‚\n\n\n\nSOAPä¸¥æ ¼æ„ä¹‰ä¸Šæ˜¯å±äºXML-RPCï¼ˆXML Remote Procedure Callï¼‰æŠ€æœ¯çš„ä¸€ä¸ªå˜ç§ï¼Œä¸€ä¸ªXML-RPCè¯·æ±‚æ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªHTTP-POSTè¯·æ±‚æ¶ˆæ¯ï¼Œå…¶è¯·æ±‚æ¶ˆæ¯ä¸»ä½“åŸºäºXMLæ ¼å¼ã€‚å®¢æˆ·ç«¯å‘é€XML-RPCè¯·æ±‚æ¶ˆæ¯åˆ°æœåŠ¡ç«¯ï¼Œè°ƒç”¨æœåŠ¡ç«¯çš„è¿œç¨‹æ–¹æ³•å¹¶åœ¨æœåŠ¡ç«¯ä¸Šè¿è¡Œè¿œç¨‹æ–¹æ³•ã€‚è¿œç¨‹æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè¿”å›å“åº”æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼Œå…¶å“åº”æ¶ˆæ¯ä¸»ä½“åŒæ ·åŸºäºXMLæ ¼å¼ã€‚è¿œç¨‹æ–¹æ³•çš„å‚æ•°æ”¯æŒæ•°å­—ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ï¼Œä¹Ÿæ”¯æŒåˆ—è¡¨æ•°ç»„å’Œå…¶ä»–å¤æ‚ç»“æ„ç±»å‹ï¼ŒSOAPæ˜¯ç¬¬ä¸€æ¬¡çœŸæ­£æˆåŠŸåœ°è§£å†³äº†å¤šè¯­è¨€å¤šå¹³å°æ”¯æŒçš„å¼€æ”¾æ€§RPCæ ‡å‡†ã€‚\n\n\n\nä¸è¿‡SOAPä¹Ÿæœ‰å¾ˆå¤šä¸è¶³ï¼š\n\n\n\n1. æ•ˆç‡ä½ã€‚å› ä¸ºæŠ¥æ–‡åŸºäºXMLï¼ŒæŠ¥æ–‡å†…å®¹é™¤äº†æ•°æ®ä»¥å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šè£å†—ä½™åœ¨æ ¼å¼çš„å®šä¹‰ä¸Šï¼Œå¹¶ä¸”å¯¹äºXMLçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è§£æé€Ÿåº¦ä¹Ÿæ…¢ã€‚\n2. å®ƒè„±ç¦»äº†ç®€å•çš„åˆè¡·ï¼Œå¼€å§‹æ·»åŠ ä¸€å±‚åˆä¸€å±‚è„±ç¦»äº†ç®€å•æ–¹æ³•è°ƒç”¨çš„ä¸€äº›é™„åŠ æ¦‚å¿µï¼šæ·»åŠ äº†å¼‚å¸¸å¤„ç†ã€ äº‹åŠ¡æ”¯æŒã€å®‰å…¨æ€§å’Œæ•°å­—ç­¾åï¼Œäººä»¬æ„Ÿè§‰ SOA å·²ç»å˜æˆäº†ä¸€ä¸ªå¤æ‚åè®®ã€‚\n\n\n\nè¿™åˆå’Œ Waldo çš„ç»å…¸ç»“è®ºä¿æŒäº†ä¸€è‡´ï¼š\n\n\n\n**å°è¯•è®©è¿œç¨‹è°ƒç”¨çš„è¡Œä¸ºåƒæœ¬åœ°è°ƒç”¨çš„ä»£ä»·æ˜¯ä¸å¯å¿½ç•¥çš„ã€‚**\n\n\n\nä¹‹åï¼Œå¤§å®¶å¼€å§‹æ…¢æ…¢æŠ›å¼ƒSOAPæ ‡å‡†ä¸­è¿‡ç¨‹åŒ–ã€åˆ†å±‚çš„æ¦‚å¿µï¼Œå¼€å§‹è½¬å‘æ›´ç®€å•çš„Restä¼ è¾“æ–¹å¼ã€‚\n\n\n\n### 2000å¹´ï¼šRoy Thomas Fielding å‘è¡¨ RESTful æ¶æ„çš„åšå£«è®ºæ–‡\n\n\n\n2000å¹´ï¼Œ[Roy Thomas Fielding](http://en.wikipedia.org/wiki/Roy_Fielding) åšå£«åœ¨ä»–çš„åšå£«è®ºæ–‡ ã€Š[Architectural Styles and the Design of Network-based Software Architectures](https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)ã€‹é¦–æ¬¡æå‡ºäº† REST è¿™ä¸ªè¯ã€‚\n\n\n\n> RESTæä¾›äº†ä¸€ç³»åˆ—æ¶æ„çº¦æŸï¼Œå½“ä½œä¸ºæ•´ä½“ä½¿ç”¨æ—¶ï¼Œå®ƒå¼ºè°ƒç»„ä»¶äº¤äº’çš„å¯æ‰©å±•æ€§ã€æ¥å£çš„é€šç”¨æ€§ã€ç»„ä»¶çš„ç‹¬ç«‹éƒ¨ç½²ï¼Œä»¥åŠé‚£äº›èƒ½å‡å°‘äº¤äº’å»¶è¿Ÿçš„ä¸­é—´ä»¶ï¼Œå®ƒå¼ºåŒ–äº†å®‰å…¨æ€§ï¼Œä¹Ÿèƒ½å°è£…é—ç•™ç³»ç»Ÿã€‚\n>\n> â€‹                         ---- Roy Fielding\n\n\n\nREST ä¸æ˜¯åè®®è€Œæ˜¯ä¸€ç§ä½¿ç”¨HTTP åè®®çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚RESTéå¸¸ç®€å•ï¼Œæ— éœ€å®¢æˆ·ç«¯stub ä»£ç  å’ŒæœåŠ¡ç«¯ stubä»£ç ï¼Œä¸”æ‰€æœ‰è¯­è¨€éƒ½å¯ä»¥é›†æˆå®ç°ã€‚HTTP RESTæ…¢æ…¢ä¾µå äº†RPCå¤§éƒ¨åˆ†åº”ç”¨é¢†åœ°çš„â€œå¼‚ç±»â€ï¼Œå¹¶ä¸”å¯¼è‡´äº†ä¸€åº¦ç››è¡Œçš„XML-RPCçš„ç­ç»ï¼Œä½†åŒæ—¶ä¿ƒè¿›äº†æ­£ç»ŸRPCæŠ€æœ¯èµ°å‘ä¸€ä¸ªæ–°çš„å‘å±•é˜¶æ®µï¼Œè¿½æ±‚æ›´é«˜çš„æ€§èƒ½åŠå¢åŠ å¯¹å¤šè¯­è¨€å¤šå¹³å°çš„æ”¯æŒï¼Œæˆä¸ºè¶Šæ¥è¶Šå¤šçš„å¼€æºRPCæ¡†æ¶çš„ç›®æ ‡ï¼Œå…¸å‹çš„ä»£è¡¨ä¸ºThriftã€Apache Avroç­‰æ–°ç”Ÿçš„å¼€æºæ¡†æ¶ï¼Œè¿™äº›æ¡†æ¶åœ¨å¤§æ•°æ®ç³»ç»Ÿã€å¤§å‹åˆ†å¸ƒå¼ç³»ç»ŸåŠç§»åŠ¨äº’è”ç½‘åº”ç”¨æ–¹é¢è¢«è¶Šæ¥è¶Šå¤šçš„å…¬å¸ä½¿ç”¨ã€‚\n\n\n\n\n\n\n\n**2008å¹´ï¼ŒVinoski åœ¨ä»–çš„è®ºæ–‡ä¸­æå‡ºäº†æˆ‘ä»¬å¼€å¤´çš„æé—®ï¼šâ€œå¼€å‘è€…çš„ä¾¿åˆ©æ€§çœŸçš„æ¯”æ­£ç¡®æ€§ã€å¯æ‰©å±•æ€§ã€æ€§èƒ½ã€å…³æ³¨ç‚¹åˆ†ç¦»ã€å¯æ‰©å±•æ€§å’Œå¶ç„¶å¤æ‚åº¦æ›´é‡è¦å—ï¼Ÿâ€**\n\n\n\næˆ‘çœ‹å…ˆçœ‹ä¸‹2020 å¹´åº¦è¯­è¨€æ’è¡Œæ¦œï¼Œå¯èƒ½èƒ½å¾—åˆ°ä¸€äº›ç­”æ¡ˆï¼š\n\n\n\nè¿™å¼ å›¾æ˜¯2020å¹´å¼€å‘è€…æœ€çˆ±çš„è¯­è¨€ï¼š\n\n![loved.png](http://media.gusibi.mobi/wFVum_ExBQVUuPT2tUcgwjCTXs7XJAFyfpU36aZO47tu70vBKP0TPIKkGS43JVuo)\n\n\n\nè¿™å¼ å›¾æ˜¯2020å¹´æœ€æµè¡Œçš„è¯­è¨€\n\n![æˆªå±2021-01-30 ä¸‹åˆ5.49.05.png](http://media.gusibi.mobi/sAqTnXotN05PxIqVBJA0C4WKQiofqWWg4AODSnQyPSJskW13yUOln-2OD9dnaTd4)\n\n\n\n> ä¸ºä»€ä¹ˆå­¦ä¹ æ›²çº¿é™¡å³­ã€è®¾è®¡å¤æ‚çš„Rust æ˜¯ç¨‹åºå‘˜çš„æœ€çˆ±ï¼Ÿ\n>\n> ä¸ºä»€ä¹ˆæ˜“å­¦æ˜“ç”¨ä½†æœ‰å„ç§è¯­è¨€ç¼ºé™·çš„JavaScript èƒ½æˆä¸ºæœ€æµè¡Œçš„è¯­è¨€å‘¢ï¼Ÿ\n\n\n\n**å¼€å‘è€…çš„ä¾¿åˆ©æ€§çœŸçš„æ¯”æ­£ç¡®æ€§ã€å¯æ‰©å±•æ€§ã€æ€§èƒ½ã€å…³æ³¨ç‚¹åˆ†ç¦»ã€å¯æ‰©å±•æ€§å’Œå¶ç„¶å¤æ‚åº¦æ›´é‡è¦å—ï¼Ÿ**\n\n**\n**\n\n**ä»å¼€å‘è€…çš„é€‰æ‹©æ¥çœ‹ï¼Œç­”æ¡ˆåº”è¯¥æ˜¯YESï¼**\n\n\n\nå¯ä»¥çœ‹åˆ°è‡ª90å¹´ä»£åæœŸè¿›å…¥äº†web å¼€å‘çš„æ—¶ä»£ï¼Œweb1.0ã€web2.0ã€web3.0 ç›¸ç»§å‡ºç°ã€‚ä»¥ http ä¸ºåŸºç¡€çš„è¯·æ±‚/å“åº”æ–¹æ¡ˆï¼ˆXMLã€RESTï¼‰ å¼€å§‹æµè¡Œå¹¶å é¢†äº†å¤§éƒ¨åˆ†çš„å¸‚åœºã€‚RPCä¹Ÿå¼€é€æ¸è¢«å¼€å‘è€…æŠ›å¼ƒï¼Œè¿›å…¥äº†æ²‰é»˜æœŸã€‚\n\n\n\nå½“ç„¶ï¼ŒRPC å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œè€Œæ˜¯åœ¨ç‰¹å®šçš„é¢†åŸŸç»§ç»­ç”Ÿé•¿ã€‚æ¯”å¦‚ï¼šSun å¾®ç³»ç»Ÿçš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ (NFS) å°±æ˜¯å»ºç«‹åœ¨ RPC ä¹‹ä¸Šï¼Œæ˜¯æœ€æ—©è·å¾—æ™®åŠçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸€ã€‚\n\n\n\nè€Œéšç€äº’è”ç½‘çš„æŒ‡æ•°æ‰©å¼ ï¼Œå¾®æœåŠ¡æ¶æ„å¼€å§‹æˆäº†ä¸šç•Œçš„â€œé“¶å¼¹â€ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¼€å§‹å˜çš„æ— å¤„ä¸åœ¨ï¼ŒåŸºäºHTTPçš„RESTfulçš„ç¼ºç‚¹å¼€å§‹æ”¾å¤§ï¼š\n\n1. åªæ”¯æŒè¯·æ±‚/å“åº”æ–¹å¼çš„é€šä¿¡\n2. å•ä¸ªè¯·æ±‚ä¸­è·å–å¤šä¸ªèµ„æºå…·æœ‰æŒ‘æˆ˜æ€§\n3. æœ‰æ—¶å¾ˆéš¾å°†æ›´å¤šæ“ä½œæ˜ å°„åˆ°HTTPåŠ¨è¯\n4. åŸºäºJSONæˆ–è€…XML çš„æ¶ˆæ¯å†—ä½™ä¸¥é‡ï¼Œæ€§èƒ½åº•ä¸‹ã€‚\n\n\n\nè€Œå¤©ç”Ÿå°±æ˜¯ä¸ºåˆ†å¸ƒå¼è®¡ç®—å‡ºç°çš„RPCä¹Ÿå¼€å§‹é‡æ–°èµ°å…¥å¼€å‘è€…çš„è§†é‡ã€‚\n\n\n\n### 2008å¹´ï¼šGoogle å¼€æº Protocol Buffer\n\n\n\nProtocol Buffers æ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¯ä»¥ç”¨äºç»“æ„åŒ–æ•°æ®åºåˆ—åŒ–ï¼Œå¾ˆé€‚åˆåšæ•°æ®å­˜å‚¨æˆ– RPC æ•°æ®äº¤æ¢æ ¼å¼ã€‚å®ƒå¯ç”¨äºé€šè®¯åè®®ã€æ•°æ®å­˜å‚¨ç­‰é¢†åŸŸçš„è¯­è¨€æ— å…³ã€å¹³å°æ— å…³ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®æ ¼å¼ã€‚\n\n\n\n### 2008å¹´ï¼šFaceBook å¼€æº thrift\n\n\n\nThrift æ˜¯ä¸€ä¸ªè·¨è¯­è¨€çš„æœåŠ¡éƒ¨ç½²æ¡†æ¶ï¼Œæœ€åˆç”±Facebookäº2007å¹´å¼€å‘ï¼Œ2008å¹´è¿›å…¥Apacheå¼€æºé¡¹ç›®ã€‚Thrifté€šè¿‡ä¸€ä¸ªä¸­é—´è¯­è¨€(IDL, æ¥å£å®šä¹‰è¯­è¨€)æ¥å®šä¹‰RPCçš„æ¥å£å’Œæ•°æ®ç±»å‹ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆä¸åŒè¯­è¨€çš„ä»£ç ï¼ˆç›®å‰æ”¯æŒC++,Java, Python, PHP, Ruby, Erlang, Perl, Haskell, C#, Cocoa, Smalltalkå’ŒOCamlï¼‰,å¹¶ç”±ç”Ÿæˆçš„ä»£ç è´Ÿè´£RPCåè®®å±‚å’Œä¼ è¾“å±‚çš„å®ç°ã€‚\n\n\n\n> Thrift å’Œ Protocol Buffer ä¸åŒï¼Œå®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°æ®åºåˆ—åŒ–å·¥å…·ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„RPC æ¡†æ¶ã€‚å¦ä¸€ä¸ªä¸åŒç‚¹åœ¨äºï¼ŒProtobuf æ ‡å‡†åŒ–äº†å•ä¸€çš„äºŒè¿›åˆ¶ç¼–ç æ–¹å¼ï¼Œä½†Thrift åˆ™åŒ…å«äº†å¤šç§ä¸åŒçš„åºåˆ—åŒ–æ–¹å¼ï¼ˆThirft ç§°ä¹‹ä¸ºåè®®ï¼‰ã€‚\n\n\n\n### 2010å¹´5æœˆï¼š Avroè„±ç¦»Hadoopé¡¹ç›®ï¼Œæˆä¸ºApacheé¡¶çº§é¡¹ç›®ã€‚ \n\n\n\n[Avro](http://avro.apache.org/) æ˜¯ä¸€ä¸ªåŸºäºäºŒè¿›åˆ¶æ•°æ®ä¼ è¾“é«˜æ€§èƒ½çš„ä¸­é—´ä»¶ï¼Œåœ¨2009å¹´æˆä¸º Hadoop ä¸­çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå¹¶ä¸2015å¹´è„±ç¦»Hadoopï¼ŒåŠ å…¥Apacheæˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ã€‚\n\n\n\nAvro åŒæ ·æ”¯æŒè·¨ç¼–ç¨‹è¯­è¨€å®ç°ï¼ˆC, C++, C#ï¼ŒJava, Python, Ruby, PHPï¼‰ï¼ŒAvro æä¾›ç€ä¸è¯¸å¦‚ Thrift å’Œ Protocol Buffers ç­‰ç³»ç»Ÿç›¸ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨ä¸€äº›åŸºç¡€æ–¹é¢è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¸»è¦æ˜¯ï¼š\n\n1. åŠ¨æ€ç±»å‹ï¼šAvro å¹¶ä¸éœ€è¦ç”Ÿæˆä»£ç ï¼Œæ¨¡å¼å’Œæ•°æ®å­˜æ”¾åœ¨ä¸€èµ·ï¼Œè€Œæ¨¡å¼ä½¿å¾—æ•´ä¸ªæ•°æ®çš„å¤„ç†è¿‡ç¨‹å¹¶ä¸ç”Ÿæˆä»£ç ã€é™æ€æ•°æ®ç±»å‹ç­‰ç­‰ã€‚è¿™æ–¹ä¾¿äº†æ•°æ®å¤„ç†ç³»ç»Ÿå’Œè¯­è¨€çš„æ„é€ ã€‚\n2. æœªæ ‡è®°çš„æ•°æ®ï¼šç”±äºè¯»å–æ•°æ®çš„æ—¶å€™æ¨¡å¼æ˜¯å·²çŸ¥çš„ï¼Œé‚£ä¹ˆéœ€è¦å’Œæ•°æ®ä¸€èµ·ç¼–ç çš„ç±»å‹ä¿¡æ¯å°±å¾ˆå°‘äº†ï¼Œè¿™æ ·åºåˆ—åŒ–çš„è§„æ¨¡ä¹Ÿå°±å°äº†ã€‚\n3. ä¸éœ€è¦ç”¨æˆ·æŒ‡å®šå­—æ®µå·ï¼šå³ä½¿æ¨¡å¼æ”¹å˜ï¼Œå¤„ç†æ•°æ®æ—¶æ–°æ—§æ¨¡å¼éƒ½æ˜¯å·²çŸ¥çš„ï¼Œæ‰€ä»¥é€šè¿‡ä½¿ç”¨å­—æ®µåç§°å¯ä»¥è§£å†³å·®å¼‚é—®é¢˜ã€‚\n\n\n\nAvro å’ŒåŠ¨æ€è¯­è¨€ç»“åˆåï¼Œè¯»/å†™æ•°æ®æ–‡ä»¶å’Œä½¿ç”¨ RPC åè®®éƒ½ä¸éœ€è¦ç”Ÿæˆä»£ç ï¼Œè€Œä»£ç ç”Ÿæˆä½œä¸ºä¸€ç§å¯é€‰çš„ä¼˜åŒ–åªéœ€è¦åœ¨é™æ€ç±»å‹è¯­è¨€ä¸­å®ç°ã€‚\n\nå½“åœ¨ RPC ä¸­ä½¿ç”¨ Avro æ—¶ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯ä»¥åœ¨æ¡æ‰‹è¿æ¥æ—¶äº¤æ¢æ¨¡å¼ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æœ‰ç€å½¼æ­¤å…¨éƒ¨çš„æ¨¡å¼ï¼Œå› æ­¤ç›¸åŒå‘½åå­—æ®µã€ç¼ºå¤±å­—æ®µå’Œå¤šä½™å­—æ®µç­‰ä¿¡æ¯ä¹‹é—´é€šä¿¡ä¸­éœ€è¦è§£å†³çš„ä¸€è‡´æ€§é—®é¢˜å°±å¯ä»¥å®¹æ˜“è§£å†³ã€‚\n\nè¿˜æœ‰ï¼ŒAvro æ¨¡å¼æ˜¯ç”¨ JSONï¼ˆä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ¨¡å¼ï¼‰å®šä¹‰çš„ï¼Œè¿™æ ·å¯¹äºå·²ç»æ‹¥æœ‰ JSON åº“çš„è¯­è¨€å¯ä»¥å®¹æ˜“å®ç°ã€‚\n\n\n\n> å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œavro ç›¸å¯¹pb å’Œ thrift æ¥è¯´æ›´ç®€å•ä¸€ç‚¹ã€‚\n\n\n\n### 2015å¹´ï¼šHTTP/2.0 å‘å¸ƒ\n\n\n\nè™½ç„¶ HTTP/1.1 å·²ç»ä¼˜åŒ–äº†å¾ˆå¤šç‚¹ï¼Œä½œä¸ºä¸€ä¸ªç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„åè®®ç‰ˆæœ¬ï¼Œå·²ç»èƒ½å¤Ÿæ»¡è¶³å¾ˆå¤šç½‘ç»œéœ€æ±‚ï¼Œä½†æ˜¯éšç€ç½‘é¡µå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œç”šè‡³æ¼”å˜æˆä¸ºç‹¬ç«‹çš„åº”ç”¨ï¼ŒHTTP/1.1 é€æ¸æš´éœ²å‡ºäº†ä¸€äº›é—®é¢˜ï¼š\n\n-  åœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œæ¯æ¬¡éƒ½è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œå¯¹ç§»åŠ¨ç«¯ç‰¹åˆ«ä¸å‹å¥½\n-  ä¼ è¾“å†…å®¹æ˜¯æ˜æ–‡ï¼Œä¸å¤Ÿå®‰å…¨\n-  header å†…å®¹è¿‡å¤§ï¼Œæ¯æ¬¡è¯·æ±‚ header å˜åŒ–ä¸å¤§ï¼Œé€ æˆæµªè´¹\n-  keep-alive ç»™æœåŠ¡ç«¯å¸¦æ¥æ€§èƒ½å‹åŠ›\n\n\n\nåœ¨ 2010 å¹´åˆ° 2015 å¹´ï¼Œè°·æ­Œé€šè¿‡å®è·µä¸€ä¸ªå®éªŒæ€§çš„ SPDY åè®®ï¼Œè¯æ˜äº†ä¸€ä¸ªåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯äº¤æ¢æ•°æ®çš„å¦ç±»æ–¹å¼ã€‚å…¶æ”¶é›†äº†æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç«¯çš„å¼€å‘è€…çš„ç„¦ç‚¹é—®é¢˜ï¼Œæ˜ç¡®äº†å“åº”æ•°é‡çš„å¢åŠ å’Œè§£å†³å¤æ‚çš„æ•°æ®ä¼ è¾“ã€‚SPDY æœ€ç»ˆè¿›åŒ–æˆäº†HTTP2.0 å¹¶ä¸2015å¹´å‘å¸ƒã€‚\n\nhttp2.0 æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n\n- ä½¿ç”¨äºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼šåœ¨åº”ç”¨å±‚ä¸ä¼ è¾“å±‚ä¹‹é—´å¢åŠ ä¸€ä¸ªäºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼Œä»¥æ­¤è¾¾åˆ°åœ¨ä¸æ”¹åŠ¨ HTTP çš„è¯­ä¹‰ï¼ŒHTTP æ–¹æ³•ã€çŠ¶æ€ç ã€URI åŠé¦–éƒ¨å­—æ®µçš„æƒ…å†µä¸‹ï¼Œçªç ´HTTP1.1 çš„æ€§èƒ½é™åˆ¶ï¼Œæ”¹è¿›ä¼ è¾“æ€§èƒ½ï¼Œå®ç°ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚åœ¨äºŒè¿›åˆ¶åˆ†å¸§å±‚ä¸Šï¼ŒHTTP2.0 ä¼šå°†æ‰€æœ‰ä¼ è¾“çš„ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶å¯¹å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼çš„ç¼–ç ï¼Œå…¶ä¸­ HTTP1.x çš„é¦–éƒ¨ä¿¡æ¯ä¼šè¢«å°è£…åˆ° Headers å¸§ï¼Œè€Œæˆ‘ä»¬çš„ request body åˆ™å°è£…åˆ° Data å¸§é‡Œé¢ã€‚\n\n-  å¤šè·¯å¤ç”¨ï¼šå¯¹äº HTTP/1.xï¼Œå³ä½¿å¼€å¯äº†é•¿è¿æ¥ï¼Œè¯·æ±‚çš„å‘é€ä¹Ÿæ˜¯ä¸²è¡Œå‘é€çš„ï¼Œåœ¨å¸¦å®½è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œå¯¹å¸¦å®½çš„åˆ©ç”¨ç‡ä¸å¤Ÿï¼ŒHTTP/2.0 é‡‡ç”¨äº†å¤šè·¯å¤ç”¨çš„æ–¹å¼ï¼Œå¯ä»¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚ï¼Œæé«˜å¯¹å¸¦å®½çš„åˆ©ç”¨ç‡ã€‚\n\n-  æ•°æ®æµä¼˜å…ˆçº§ï¼šç”±äºè¯·æ±‚å¯ä»¥å¹¶å‘å‘é€äº†ï¼Œé‚£ä¹ˆå¦‚æœå‡ºç°äº†æµè§ˆå™¨åœ¨ç­‰å¾…å…³é”®çš„ CSS æˆ–è€… JS æ–‡ä»¶å®Œæˆå¯¹é¡µé¢çš„æ¸²æŸ“æ—¶ï¼ŒæœåŠ¡å™¨å´åœ¨ä¸“æ³¨çš„å‘é€å›¾ç‰‡èµ„æºçš„æƒ…å†µæ€ä¹ˆåŠå‘¢ï¼ŸHTTP/2.0 å¯¹æ•°æ®æµå¯ä»¥è®¾ç½®ä¼˜å…ˆå€¼ï¼Œè¿™ä¸ªä¼˜å…ˆå€¼å†³å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¤„ç†ä¸åŒçš„æµé‡‡ç”¨ä¸åŒçš„ä¼˜å…ˆçº§ç­–ç•¥ã€‚\n-  æœåŠ¡ç«¯æ¨é€ï¼šåœ¨ HTTP/2.0 ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·å‘é€è¯·æ±‚ä¹‹å¤–çš„å†…å®¹ï¼Œæ¯”å¦‚æ­£åœ¨è¯·æ±‚ä¸€ä¸ªé¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠé¡µé¢ç›¸å…³çš„ logoï¼ŒCSS ç­‰æ–‡ä»¶ç›´æ¥æ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œè€Œä¸ä¼šç­‰åˆ°è¯·æ±‚æ¥çš„æ—¶å€™å†å‘é€ï¼Œå› ä¸ºæœåŠ¡å™¨è®¤ä¸ºå®¢æˆ·ç«¯ä¼šç”¨åˆ°è¿™äº›ä¸œè¥¿ã€‚è¿™ç›¸å½“äºåœ¨ä¸€ä¸ª HTML æ–‡æ¡£å†…é›†åˆäº†æ‰€æœ‰çš„èµ„æºã€‚\n-  å¤´éƒ¨å‹ç¼©ï¼šä½¿ç”¨é¦–éƒ¨è¡¨æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®å€¼å¯¹ï¼Œå¯¹äºç›¸åŒçš„å†…å®¹ï¼Œä¸ä¼šå†æ¯æ¬¡è¯·æ±‚å’Œå“åº”æ—¶å‘é€ã€‚\n\n\n### 2015å¹´ï¼šGoogle å¼€æºgRPC\n\n\n\n2015 å¹´ï¼ŒGoogle å°†**gRPC**æ¡†æ¶å¼€æºï¼ŒgRPC ä½¿ç”¨ PB ä½œä¸ºåºåˆ—åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œåœ¨ä¼ è¾“çš„ä»‹è´¨ä¸Šä½¿ç”¨äº† HTTP/2è€Œä¸æ˜¯å¸¸è§çš„TCPã€‚gRPC æ˜¯ä¸€ä¸ªå¤šè·¯å¤ç”¨ã€åŒå‘æµå¼ RPC åè®®ã€‚åœ¨ä¸€èˆ¬çš„ RPC æœºåˆ¶ä¸­ï¼Œå®¢æˆ·ç«¯å‘èµ·åˆ°æœåŠ¡å™¨çš„è¿æ¥ï¼Œåªæœ‰å®¢æˆ·ç«¯å¯ä»¥è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨åªèƒ½å“åº”ä¼ å…¥çš„è¯·æ±‚ã€‚ç„¶è€Œï¼Œåœ¨åŒå‘ gRPC æµä¸­ï¼Œè™½ç„¶åˆå§‹è¿æ¥æ˜¯ç”±å®¢æˆ·ç«¯å‘èµ·çš„(ç§°ä¸ºç«¯ç‚¹1) ï¼Œä½†æ˜¯ä¸€æ—¦å»ºç«‹è¿æ¥ï¼ŒæœåŠ¡å™¨(ç§°ä¸ºç«¯ç‚¹2)å’Œç«¯ç‚¹1éƒ½å¯ä»¥å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ã€‚è¿™æå¤§åœ°ç®€åŒ–äº†ä¸¤ä¸ªç«¯ç‚¹ç›¸äº’é€šä¿¡çš„å¼€å‘(å¦‚ç½‘æ ¼è®¡ç®—)ã€‚ç”±äºä¸¤ä¸ªæ•°æ®æµéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™ä¹Ÿçœå»äº†åœ¨ç«¯ç‚¹ä¹‹é—´åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹è¿æ¥çš„éº»çƒ¦(ä¸€ä¸ªä»ç«¯ç‚¹1åˆ°ç«¯ç‚¹2ï¼Œå¦ä¸€ä¸ªä»ç«¯ç‚¹2åˆ°ç«¯ç‚¹1)ã€‚![grpc_concept_diagram_00.png](http://media.gusibi.mobi/oS1I1Y0rCGWI_WHon15Cffe7a2bQeUWGekTcrfVldIzbNpa6PwY5dmzx9xEaalH_)\n\n\n\n\n## æ€»ç»“\n\n\n\n- åˆ†å¸ƒå¼è°ƒç”¨çš„å†å²æ¯”äº’è”ç½‘çš„å†å²è¿˜è¦ä¹…è¿œ\n- RPC çš„å‘å±•æ–¹å‘æ˜¯æ˜“ç”¨æ€§ï¼Œå¼‚æ­¥\n- æ˜“ç”¨æ€§å¯èƒ½çœŸçš„æ¯”æ‰©å±•æ€§ã€æ€§èƒ½ã€å…³æ³¨ç‚¹åˆ†ç¦»ã€å¯æ‰©å±•æ€§å’Œå¶ç„¶å¤æ‚åº¦æ›´é‡è¦\n- è®©è¿œç¨‹è°ƒç”¨å‘æœ¬åœ°è°ƒç”¨ä¸€æ ·çš„ä»£ä»·æ˜¯ä¸å¯å¿½ç•¥çš„\n\n\n\n\n\n\n\n### å‚è€ƒé“¾æ¥ï¼š\n\n\n\n[CORBA](https://baike.so.com/doc/6881614-7099104.html)\n\n[Implementing Remote Procedure Calls ä¸­æ–‡ç‰ˆ](https://www.jianshu.com/p/91be39f72c74)\n\n[èŠ±äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œæˆ‘ç»ˆäºæŠŠRPCæ¡†æ¶æ•´æ˜ç™½äº†](https://developer.51cto.com/art/201906/597963.htm)\n\n[RPCåŸç†è¯¦è§£](https://www.cnblogs.com/metoy/p/4321311.html)\n\n[ç†è§£Restå’ŒRpc](https://www.cnblogs.com/houkai/p/9772111.html)\n\n[è°èƒ½ç”¨é€šä¿—çš„è¯­è¨€è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ RPC æ¡†æ¶ï¼Ÿ](https://www.zhihu.com/question/25536695)\n\n[ä»€ä¹ˆæ˜¯Rpc](https://www.jianshu.com/p/052913a386b7)\n\n[ä»€ä¹ˆæ˜¯Rpc](https://www.jianshu.com/p/7d6853140e13)\n\n[å¾®æœåŠ¡é€šä¿¡](https://developer.ibm.com/zh/articles/j-cn-java-and-microservice-3/)\n\n[å¯»æ ¹æº¯æºï¼šå¾®æœåŠ¡æ¨¡å¼å‘å±•ç®€å²](https://developer.ibm.com/zh/articles/cl-evolution-microservices-patterns/)\n\nhttps://thrift.apache.org\n\nhttp://avro.apache.org\n\nhttps://insights.stackoverflow.com/survey/2020#overview",
      "data": {
        "title": "RPC å‰ä¸–ä»Šç”Ÿ",
        "date": "2021-01-30 18:21:41",
        "tags": [
          "grpc",
          "åç«¯",
          "å¾®æœåŠ¡"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/rpc-history.jpg",
        "isTop": true
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "rpc-history"
    },
    {
      "content": "\n### ä½¿ç”¨è…¾è®¯äº‘ serverless éƒ¨ç½²è¯­é›€é£ä¹¦æœºå™¨äºº\n\n> 1. è¯­é›€å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯æ²¡æœ‰Appï¼Œæ— æ³•é€šçŸ¥\n> 2. é£ä¹¦ç¾¤è‡ªå®šä¹‰æœºå™¨äººå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ä¸çŸ¥é“ç”¨æ¥å¹²å•¥\n> 3. è…¾è®¯äº‘å‡½æ•°è®¡ç®—æœ‰å…è´¹é¢åº¦ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ä¸€ä¸‹ï¼Ÿ\n> 4. é‚£æ˜¯ä¸æ˜¯å¯ä»¥æŠŠè¯­é›€çš„webhook ä½¿ç”¨é£ä¹¦é€šçŸ¥ï¼Œéƒ¨ç½²åœ¨è…¾è®¯äº‘ä¸Šå‘¢ï¼Ÿ\n> 5. å¥½ä¸»æ„\n\nä»£ç åœ°å€ï¼š[https://github.com/gusibi/yuque_webhook](https://github.com/gusibi/yuque_webhook)\n\n### ä½¿ç”¨æ–¹å¼\n\n1. åœ¨é£ä¹¦ç¾¤ä¸­æ·»åŠ è‡ªå®šä¹‰æœºå™¨äººï¼Œå¤åˆ¶webhook åœ°å€ï¼Œæ‹¿åˆ°å…¶ä¸­çš„ hook_id\n2. æ‰§è¡Œä»£ç build ä¸­ scf_build.sh è„šæœ¬ï¼Œå¾—åˆ° api.zip åŒ…\n3. åœ¨è…¾è®¯äº‘äº‘å‡½æ•°ä¸­åˆ›å»ºäº‘å‡½æ•°ï¼Œ\n    * é€‰æ‹©golang\n    * é€‰æ‹©æœ¬åœ°zip åŒ…\n    * é€‰æ‹©ä¸Šä¸€æ­¥ç”Ÿæˆçš„ api.zip\n    * è¶…æ—¶æ—¶é—´ä¸º3S\n    * åˆ›å»ºäº‘å‡½æ•°\n4. æ–°å»ºAPIç½‘å…³æœåŠ¡\n    * æ–°å»ºAPI\n    * è·¯å¾„ä¸º /api/webhook\n    * è¯·æ±‚æ–¹æ³•ä¸ºPOST\n    * å…é‰´æƒ\n    * åç«¯é…ç½®ï¼Œåç«¯ç±»å‹ä¸ºäº‘å‡½æ•°SCF\n    * é€‰æ‹©ä¸Šä¸€æ­¥åˆ›å»ºçš„äº‘å‡½æ•°\n    * è¶…æ—¶æ—¶é—´ä¸º3S\n    * å¯ç”¨å“åº”é›†æˆ\n    * å“åº”ç»“æœè¿”å›ç±»å‹ä¸ºJSON\n    * å®Œæˆé€‰æ‹©å‘å¸ƒ\n    * ä»ç½‘å…³åŸºç¡€é…ç½®ä¸­æ‹¿åˆ°å…¬ç½‘è®¿é—®åœ°å€ï¼Œhost\n5. æ‰“å¼€æƒ³è¦æ·»åŠ webhookçš„è¯­é›€çŸ¥è¯†åº“\n    * çŸ¥è¯†åº“è®¾ç½®ï¼Œå¼€å‘è€…ï¼Œæ·»åŠ webhookï¼Œå‘½åä¸ºé£ä¹¦æœºå™¨äºº\n    * URLä¸º host/api/webhookï¼ˆè¿™é‡Œhost ä¸ºä¸Šä¸€æ­¥å¾—åˆ°çš„hoståœ°å€ï¼ŒåŒ…å«80 æˆ–è€… 443)\n    \nDONE\n",
      "data": {
        "title": "ä½¿ç”¨è…¾è®¯äº‘ serverless éƒ¨ç½²è¯­é›€é£ä¹¦æœºå™¨äºº",
        "date": "2020-12-27 22:24:41",
        "tags": [
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": true
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "yuque_webhook_feishu"
    },
    {
      "content": "\n> å‘¨æœ«å°è¯•åšäº†é±¼é¦™è‚‰ä¸ï¼Œå£å‘³è¿˜ä¸é”™\n\n## ææ–™\n\nçŒªè‚‰ï¼ˆç˜¦è‚‰ï¼‰200gã€é’ç¬‹50gã€å¹²é»‘æœ¨è€³10ä¸ªã€èƒ¡èåœåŠæ ¹ï¼ˆ50gï¼‰ã€\nè‘±ä¸€æ®µï¼ˆ10cmï¼‰ã€å§œ10gã€è’œåŠå¤´ã€æœå¤©æ¤’3æ ¹ã€\nè±†ç“£é…±ã€æ–™é…’ã€ç”ŸæŠ½ã€ç›ã€ç³–ã€æ·€ç²‰\n\n## æ­¥éª¤\n\n1. æœ¨è€³ç”¨æ¸©æ°´æ³¡å¼€ï¼ˆç°åœ¨å¯ä»¥å…ˆå¤„ç†è‚‰ï¼‰\n2. ç˜¦è‚‰æ¸…æ°´æ´—å‡€åˆ‡ä¸ã€åŠ å…¥ç”ŸæŠ½3å‹ºï¼ˆ10gï¼‰ã€æ–™é…’2å‹ºï¼ˆ10gï¼‰ã€ç›ä¸€å°å‹ºï¼ˆ3gï¼‰ã€é¸¡ç²¾3gï¼Œè›‹æ¸…ï¼ˆä¹Ÿå¯ä»¥æ˜¯é¸¡è›‹ï¼‰ä¸€ä¸ª æœä¸€ä¸ªæ–¹å‘æ…æ‹Œä¸€åˆ†é’Ÿï¼Œç„¶ååŠ å…¥æ·€ç²‰ä¸€å‹ºï¼Œè…Œåˆ¶10åˆ†é’Ÿä»¥ä¸Š\n3. è’œåˆ‡æˆæ²«ï¼Œå§œåˆ‡æˆæ²«ã€è‘±åˆ‡æ²«\n4. èƒ¡èåœã€é’ç¬‹åˆ‡ä¸\n5. æ³¡å¼€çš„æœ¨è€³åˆ‡æˆå°å—\n6. å–å°ç¢—åŠ å…¥ç³–10gï¼ˆå–œæ¬¢ç”œå¯å¤šåŠ ï¼‰ã€é†‹10gã€ç”ŸæŠ½5gã€æ–™é…’5gã€ç›3gï¼ˆè±†ç“£é…±æ¯”è¾ƒå’¸ä¹Ÿå¯ä»¥ä¸åŠ ç›ï¼‰ã€æ·€ç²‰10g å‹¾å…‘æˆé…±æ–™å¤‡ç”¨ï¼ˆä¹Ÿå¯ä»¥åŠ å°‘é‡æ°´ï¼Œè¿™æ ·æ›´å®¹æ˜“æ…æ‹Œï¼‰\n7. å¤§ç«çƒ­é”…åŠ æ²¹ï¼Œæ”¾å…¥è…Œåˆ¶å¥½çš„è‚‰ä¸ï¼ˆå› ä¸ºè‚‰ä¸æœ‰æ·€ç²‰ï¼Œå»ºè®®ç”¨ä¸ç²˜é”…ï¼Œä¹Ÿå¯ä»¥å¤šåŠ æ²¹ï¼Œå°ç«ï¼‰ï¼Œå°†è‚‰ä¸ç‚’æˆç™½è‰²çš„è‚‰æ¡ç››å‡ºå¤‡ç”¨\n8. æ”¾å…¥èƒ¡èåœä¸ç¿»ç‚’ï¼ŒåŠ å…¥ä¸€å‹ºè±†ç“£é…±ï¼ˆå’¸ä¸è¦å¤ªå¤šï¼‰ï¼ŒåŠ å…¥æœ¨è€³ç¬‹ä¸ç»§ç»­ç¿»ç‚’\n9. åŠåˆ†é’ŸååŠ å…¥åˆšç‚’ä¸€åŠçš„è‚‰ä¸ï¼Œç¿»ç‚’2åˆ†é’Ÿï¼ˆæ—¶é—´å¯è‡ªå·±æ§åˆ¶ï¼Œæ³¨æ„æ§åˆ¶ç«å€™\n10. åŠ å…¥å‹¾å…‘å¥½çš„é…±æ–™ï¼Œç»§ç»­ç¿»ç‚’3åˆ†é’Ÿï¼Œç„¶åæ”¶æ±\n\n> åœ¨ç‚’çš„è¿‡ç¨‹ä¸­æ³¨æ„è¯•ä¸€ä¸‹å’¸æ·¡ï¼Œå¯é€‚é‡è°ƒæ•´\n> çŒªè‚‰æ¢æˆèŒ„å­å°±æ˜¯é±¼é¦™èŒ„å­ğŸ¤¡",
      "data": {
        "title": "é±¼é¦™è‚‰ä¸",
        "date": "2020-07-05 22:45:25",
        "tags": [
          "èœè°±"
        ],
        "published": true,
        "hideInList": false,
        "feature": "http://media.gusibi.mobi/8s1pRa4Le83ziXdaK3ldcjHzcxv3fxSwuZpq8nLAGrL3p3cTrMiBGoIbk8yyajy4",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "yu-xiang-rou-si"
    },
    {
      "content": "\n\n### ä»‹ç»\n\n\nVuePress æ˜¯ä¸€ä¸ªé™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼ŒåŒ…å«ç”±Vueé©±åŠ¨çš„ä¸»é¢˜ç³»ç»Ÿå’Œæ’ä»¶APIï¼ŒåŒæ—¶è¿˜åŒ…å«ä¸€ä¸ªä¸ºä¹¦å†™æŠ€æœ¯æ–‡æ¡£è€Œä¼˜åŒ–çš„é»˜è®¤ä¸»é¢˜ã€‚æ­¤ç¯‡æ–‡ç« åªä»‹ç»å¦‚ä½•ä½¿ç”¨VuePress æ­å»ºä¸ªäººåšå®¢çš„éƒ¨åˆ†ã€‚\n\n### å®‰è£…\n\n\n> å‰ç½®æ¡ä»¶ï¼šVuePress éœ€è¦ Node.js >= 8.6\n\n\n##### å®‰è£… vuepress\n\nVuePress å®‰è£…æ¯•ç«Ÿç®€å•ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç›´æ¥å®‰è£…ï¼š\n\n```shell\nyarn add -D vuepress # npm install -D vuepress\n```\n\n\n\n#### éªŒè¯å®‰è£…\n\n\n\nä¸ºäº†éªŒè¯VuePress çš„æ•ˆæœï¼Œé¦–å…ˆåˆ›å»ºä¸€ç¯‡æ–‡æ¡£\n\n\n```shell\nmkdir docs && echo '# Hello VuePress' > README.md\n```\n\n\nåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º `package.json` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n\n\n```json\n{\n  \"scripts\": {\n    \"dev\": \"vuepress dev docs\",\n    \"build\": \"vuepress build docs\"\n  }\n}\n```\n\n\n\nåœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡å™¨\n\n```shell\nvuepress dev .\n```\n\n\nVuePress ä¼šåœ¨ [http://localhost:8080](http://localhost:8080/) å¯åŠ¨ä¸€ä¸ªçƒ­é‡è½½çš„å¼€å‘æœåŠ¡å™¨ã€‚\n\nå¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå¯åœ¨æµè§ˆå™¨æ‰“å¼€[http://localhost:8080](http://localhost:8080/)ï¼Œé»˜è®¤åŠ è½½å†…å®¹ä¸º README.md ä¸­å†…å®¹ã€‚\n\n\n\n### VuePress ç›®å½•ç»“æ„\n\n\nVuePress éµå¾ª **â€œçº¦å®šä¼˜äºé…ç½®â€** çš„åŸåˆ™ï¼Œæ¨èçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n\n\n\n```shell\n.\nâ”œâ”€â”€ blog\nâ”‚   â”œâ”€â”€ .vuepress (å¯é€‰çš„)\nâ”‚   â”‚   â”œâ”€â”€ components (å¯é€‰çš„)\nâ”‚   â”‚   â”œâ”€â”€ theme (å¯é€‰çš„)\nâ”‚   â”‚   â”‚   â””â”€â”€ Layout.vue\nâ”‚   â”‚   â”œâ”€â”€ public (å¯é€‰çš„)\nâ”‚   â”‚   â”œâ”€â”€ styles (å¯é€‰çš„)\nâ”‚   â”‚   â”‚   â”œâ”€â”€ index.styl\nâ”‚   â”‚   â”‚   â””â”€â”€ palette.styl\nâ”‚   â”‚   â”œâ”€â”€ templates (å¯é€‰çš„, è°¨æ…é…ç½®)\nâ”‚   â”‚   â”‚   â”œâ”€â”€ dev.html\nâ”‚   â”‚   â”‚   â””â”€â”€ ssr.html\nâ”‚   â”‚   â”œâ”€â”€ config.js (å¯é€‰çš„)\nâ”‚   â”‚   â””â”€â”€ enhanceApp.js (å¯é€‰çš„)\nâ”‚   â”‚ \nâ”‚   â”œâ”€â”€ README.md\nâ”‚   â””â”€â”€_post\nâ”‚       â”œâ”€â”€ about.md\nâ”‚       â””â”€â”€ README.md \nâ”‚ \nâ””â”€â”€ package.json\n```\n\n\n\nè¿™é‡Œ`blog`ç›®å½•è¢«ç§°ä½œ `targetDir` ï¼Œç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ç›¸å¯¹äº `blog` ç›®å½•çš„ã€‚æ¯”å¦‚æ­¤ç›®å½•ä¸‹æ–‡ä»¶çš„è·¯ç”±åœ°å€å¦‚ä¸‹ï¼š\n\n\n\n| æ–‡ä»¶ç›¸å¯¹è·¯å¾„     | é¡µé¢è·¯ç”±åœ°å€      |\n| ---------------- | ----------------- |\n| /README.md       | /                 |\n| /_post/README.md | /_post/           |\n| /_post/about.md  | /_post/about.html |\n\n\n\n### åŸºæœ¬é…ç½®\n\n\n\nç°åœ¨ VuePress å·²ç»å¯ä»¥è¿è¡Œï¼Œç°åœ¨æ·»åŠ ä¸€äº›åŸºæœ¬çš„é…ç½®ã€‚é¦–å…ˆåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º `.vuepress` ç›®å½•ï¼ˆæ‰€æœ‰ VuePress ç›¸å…³çš„æ–‡ä»¶éƒ½æ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼‰ï¼Œç„¶ååœ¨ `.vuepress` ç›®å½•ä¸‹åˆ›å»º `config.js` æ–‡ä»¶ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨YAML (`.vuepress/config.yml`) æˆ–æ˜¯ TOML (`.vuepress/config.toml`) æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼‰ã€‚\n\n\n\næ·»åŠ ä»¥ä¸‹é…ç½®åˆ°config.jsï¼š\n\n\n\n```javascript\nmodule.exports = {\n  title: 'é¡¾æ–¯æ¯”',  // ç½‘ç«™çš„æ ‡é¢˜ï¼Œå®ƒå°†ä¼šè¢«ç”¨ä½œæ‰€æœ‰é¡µé¢æ ‡é¢˜çš„å‰ç¼€ã€‚\n  description: 'é¡¾æ–¯æ¯”çš„åšå®¢', // ç½‘ç«™çš„æè¿°ï¼Œå®ƒå°†ä¼šä»¥ <meta> æ ‡ç­¾æ¸²æŸ“åˆ°å½“å‰é¡µé¢çš„ HTML ä¸­ã€‚\n}\n```\n\n####  \n\nå…¶å®ƒè¯¦ç»†é…ç½®å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://vuepress.vuejs.org/zh/config/\n\n\n\n### ä¸»é¢˜\n\nå› ä¸ºæ˜¯ä½¿ç”¨ `VuePress` ä½œä¸ºé™æ€åšå®¢ä½¿ç”¨ï¼Œéœ€è¦æ›¿æ¢æ‰é»˜è®¤çš„ä¸»é¢˜ã€‚è¿™é‡Œä½¿ç”¨å®˜æ–¹ä¸»é¢˜ï¼š `@vuepress/theme-blog` ã€‚\n\n#### å®‰è£…\n\n\n```shell\nyarn add @vuepress/theme-blog -D\n# OR npm install @vuepress/theme-blog -D\n```\n\n\n#### ä½¿ç”¨&é…ç½®\n\n\nåœ¨config.js ä¸­æ·»åŠ ä¸»é¢˜ç›¸å…³é…ç½®ï¼š\n\n```javascript\n // .vuepress/config.js\nmodule.exports = {\n  title: 'é¡¾æ–¯æ¯”',\n  description: 'é¡¾æ–¯æ¯”çš„åšå®¢ gusibi goodspeed',\n  theme: '@vuepress/blog',\n  themeConfig: {\n     nav: [     // å¯¼èˆªæ¡ç›¸å…³é…ç½®\n            { text: 'é¦–é¡µ', link: '/' },\n            { text: 'æ ‡ç­¾', link: '/tag/'},\n            { text: 'å…³äº ', link: '/about/' },\n            { text: 'github ', link: 'https://github.com/gusibi/', target:'_blank' },\n        ],\n        /**\n       * Ref: https://vuepress-theme-blog.ulivz.com/config/#globalpagination\n       */\n        globalPagination: {\n          lengthPerPage: 10,\n        },\n\n        /**\n         * Ref: https://vuepress-theme-blog.ulivz.com/config/#sitemap\n         */\n        sitemap: {\n            hostname: 'http://blog.gusibi.mobi/'\n        },\n  }\n}\n```\n\n\n\n#### ç›®å½•\n\n\n\né»˜è®¤æƒ…æ³ä¸‹ï¼Œæ‰€æœ‰å†…å®¹éƒ½å¿…é¡»æ”¾åœ¨ `_posts` ç›®å½•å…§ï¼Œæ–‡ä»¶åä¸º`æ ‡é¢˜.md`ï¼Œä¾‹å¦‚`about.md`ã€‚\n\n```shell\nâ””â”€â”€ _posts\n    â”œâ”€â”€ ...\n    â””â”€â”€ about.md\n```\n\n\n\n\n\n#### åšå®¢å†…å®¹è®¾ç½®\n\n\n\nFront matter æ˜¯ç”¨äºæŒ‡å®šåšå®¢æ–‡ä»¶çš„å˜é‡ï¼Œå¿…é¡»æ”¾åœ¨åšå®¢æ–‡ä»¶çš„æœ€ä¸Šæ–¹ã€‚å¹¶ä¸”å¿…é¡»é‡‡ç”¨åœ¨ä¸‰ç‚¹åˆ’çº¿ä¹‹é—´ä¹¦å†™çš„æœ‰æ•ˆçš„ YAMLã€‚ è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ï¼š\n\n\n\n```yaml\n---\ntitle: Blogging Like a Hacker # åšå®¢æ ‡é¢˜\ndate: 2020-06-14              # åšå®¢å‘å¸ƒæ—¥æœŸ\ntags:                         # æ–‡ç« æ ‡ç­¾\n    - å‰ç«¯\n  - dart\n  - flutter\n  - vue\nsummary: è¿™é‡Œæ˜¯æ–‡ç« çš„æ‘˜è¦\n---\n```\n\n####  \n\nå…¶å®ƒå˜é‡ï¼šhttps://vuepress.vuejs.org/zh/guide/frontmatter.html\n\n\n\n##### URL\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œpath è·¯å¾„åˆ™ä¸ºæ–‡ä»¶ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œæ¯”å¦‚ï¼š\n\n```shell\nâ”œâ”€â”€ package.json\nâ””â”€â”€ source\n    â”œâ”€â”€ _post\n    â”‚   â””â”€â”€ intro-vuepress.md\n    â”œâ”€â”€ index.md\n    â””â”€â”€ tags.md\n```\n\n\n\né‚£ä¹ˆä½ å°±ä¼šè·å¾—ä»¥ä¸‹çš„å¯ç”¨é¡µé¢ï¼š\n\n```shell\n/source/\n/source/tags.html\n/source/_post/intro-vuepress.html\n```\n\n\n\næ¨èä½¿ç”¨ `permalink` æŒ‡å®šæ–‡ç« çš„æ°¸ä¹…é“¾æ¥ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€é…ç½®æ¥å‘æ‰€æœ‰é¡µé¢åº”ç”¨æ°¸ä¹…é“¾æ¥ï¼š\n\n```JavaScript\n// .vuepress/config.js\nmodule.exports = {\n  permalink: \"/:year/:month/:day/:slug\"\n};\n```\n\nå¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥åªä¸ºå•ç‹¬ä¸€ä¸ªé¡µé¢å»è®¾ç½®æ°¸ä¹…é“¾æ¥ã€‚è¿™ç§æ–¹å¼æ¯”å…¨å±€é…ç½®æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚\n\nğŸ“ **hello.md**:\n\n```yaml\n---\ntitle: Hello World\npermalink: /hello-world\n---\nHello!\n```\n\n\n\n##### å†…å®¹\n\n\n\nåšå®¢å†…å®¹æ ¼å¼ä¸º markdownï¼Œmarkdown è¯­æ³•å‚è€ƒï¼šhttps://www.markdownguide.org/\n\n### æ’ä»¶\n\n\n\n#### æœç´¢\n\n\n\n`VuePress` å†…ç½®æœç´¢ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® `themeConfig.search: false` æ¥ç¦ç”¨é»˜è®¤çš„æœç´¢æ¡†ï¼Œæˆ–æ˜¯é€šè¿‡ `themeConfig.searchMaxSuggestions` æ¥è°ƒæ•´é»˜è®¤æœç´¢æ¡†æ˜¾ç¤ºçš„æœç´¢ç»“æœæ•°é‡ï¼š\n\n\n\n```\nmodule.exports = {\n  themeConfig: {\n    search: false,\n    searchMaxSuggestions: 10\n  }\n}\n```\n\nä½ å¯ä»¥é€šè¿‡[åœ¨é¡µé¢çš„ frontmatter ä¸­è®¾ç½® `search`](https://vuepress.vuejs.org/zh/guide/frontmatter.html#search) æ¥å¯¹å•ç‹¬çš„é¡µé¢ç¦ç”¨å†…ç½®çš„æœç´¢æ¡†ï¼š\n\n```\n---\nsearch: false\n---\n```\n\n\n**âš ï¸æç¤º**\n\n**å†…ç½®æœç´¢åªä¼šä¸ºé¡µé¢çš„æ ‡é¢˜ã€****`h2`** **ã€** **`h3`** **ä»¥åŠ** **`tags`** **æ„å»ºæœç´¢ç´¢å¼•ã€‚ å¦‚æœä½ éœ€è¦å…¨æ–‡æœç´¢ï¼Œä½ å¯ä»¥ä½¿ç”¨** [**Algolia æœç´¢**](https://vuepress.vuejs.org/zh/theme/default-theme-config.html#algolia-æœç´¢)**ã€‚**\n\n\n#### google-analytics\n\ngoogle-analyticsæ˜¯è‘—åäº’è”ç½‘å…¬å¸Googleä¸ºç½‘ç«™æä¾›çš„æ•°æ®ç»Ÿè®¡æœåŠ¡ã€‚å¯ä»¥å¯¹ç›®æ ‡ç½‘ç«™è¿›è¡Œè®¿é—®æ•°æ®ç»Ÿè®¡å’Œåˆ†æï¼Œå¹¶æä¾›å¤šç§å‚æ•°ä¾›ç½‘ç«™æ‹¥æœ‰è€…ä½¿ç”¨ã€‚è¿™é‡Œæ¨èå®‰è£…ï¼š\n\n##### å®‰è£…\n\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…\n\n```\nyarn add -D @vuepress/plugin-google-analytics\n# OR npm install -D @vuepress/plugin-google-analytics\n```\n\n\n##### ä½¿ç”¨\n\nå°†ga é…ç½®æ·»åŠ åˆ°é…ç½®æ–‡ä»¶\n\n```JavaScript\nmodule.exports = {\n  plugins: [\n    [\n      '@vuepress/google-analytics',\n      {\n        'ga': '' // UA-00000000-0\n      }\n    ]\n  ]\n}\n```\n\n\næ›´å¤šé…ç½®å‚è€ƒæ–‡æ¡£ï¼šhttps://vuepress.vuejs.org/zh/theme/default-theme-config.html\n\n\n#### RSS\n\n\n`vuepress` åŒ…å«rss æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨é…ç½®ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹å¯ç”¨ï¼š\n\n```JavaScript\nmodule.exports = {\n    ...\n    themeConfig: {\n      ...\n      feed: {\n         canonical_base: 'http://blog.gusibi.mobi/',\n      },\n    },\n  };\n```\n\n\n\n### éƒ¨ç½²åˆ°Github\n\n\n1. åœ¨ docs/.vuepress/config.js ä¸­è®¾ç½®æ­£ç¡®çš„ baseã€‚\n\n\n> å¦‚æœä½ æ‰“ç®—å‘å¸ƒåˆ° https://.github.io/ï¼Œåˆ™å¯ä»¥çœç•¥è¿™ä¸€æ­¥ï¼Œå› ä¸º base é»˜è®¤å³æ˜¯ \"/\"ã€‚\n\n\n1. åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„ `deploy.sh` æ–‡ä»¶:\n\n\n```\n#!/usr/bin/env sh\n\n# ç¡®ä¿è„šæœ¬æŠ›å‡ºé‡åˆ°çš„é”™è¯¯\nset -e\n\n# ç”Ÿæˆé™æ€æ–‡ä»¶\nvuepress build --dest ./public\n\n# è¿›å…¥ç”Ÿæˆçš„æ–‡ä»¶å¤¹\ncd public\n\n# å¦‚æœæ˜¯å‘å¸ƒåˆ°è‡ªå®šä¹‰åŸŸå\n# echo 'blog.gusibi.mobi' > CNAME\n\ngit add -A\ngit commit -m 'deploy'\n\n# å‘å¸ƒåˆ° https://<USERNAME>.github.io\ngit push -f git@github.com:gusibi/gusibi.github.io.git master\n\n# å¦‚æœå‘å¸ƒåˆ° https://<USERNAME>.github.io/<REPO>\n# git push -f git@github.com:<USERNAME>/<REPO>.git master:gh-pages\n\ncd -\n```\n\n> ä¹Ÿä»¥ä½¿ç”¨github ci åœ¨æ¯æ¬¡æäº¤ä»£ç çš„æ—¶å€™è‡ªåŠ¨éƒ¨ç½²åˆ°github.ioï¼Œå…·ä½“æ­¥éª¤å¯ä»¥è‡ªè¡Œæœç´¢é…ç½®\n\n\n###  \n\n### å‚è€ƒé“¾æ¥\n\n\n1. Intro to VuePress 1.xï¼š https://ulivz.com/2019/06/09/intro-to-vuepress-1-x/\n2. é»˜è®¤ä¸»é¢˜é…ç½®ï¼š https://vuepress.vuejs.org/zh/theme/default-theme-config.html\n3. https://www.markdownguide.org/\n4. VuePress front matter é…ç½®ï¼š https://vuepress.vuejs.org/zh/guide/frontmatter.html\n5. VuePress é…ç½®ï¼š https://vuepress.vuejs.org/zh/config/\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/WDz3v4cU4LQq1oyKX-fYK1LxIThzZ1hK931ZaPRC8CdcB0t2oTYJciMDuAws70FY)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "ä½¿ç”¨VuePress æ­å»ºä¸ªäººåšå®¢",
        "date": "2020-06-14 07:48:04",
        "tags": [
          "æ•™ç¨‹",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "vuepress-build-blog-to-github"
    },
    {
      "content": "\n[[TOC]]\n\n## ç¥ˆç¥·å¼ç¼–ç¨‹\n\n### ç¥ˆç¥·å¼ç¼–ç¨‹\n\nå¦‚æœä»£ç ä¸­åŒ…å«ä»¥ä¸‹ä»£ç \n\n![](http://media.gusibi.mobi/hZPxabAhNvjs0RBsFX2UYcWceM6hASMsuiUtsNRI1zcC_cARLqu_flemSEpRdHT2)\n\næˆ–è€…ä¸Šçº¿åè¿›è¡Œè¿™ç§æ´»åŠ¨\n\n![](http://media.gusibi.mobi/vgTOaVcTBjWjIDs7hL3XA388F7gZvklpH5UjwqpuePotN3Q5NcHJ1PecTn50Um2m)\n\né‚£ä¹ˆè¿™ç§ç¼–ç¨‹æ–¹å¼å°±æ˜¯ç¥ˆç¥·å¼ç¼–ç¨‹ã€‚\n\n\nç”¨æµç¨‹å›¾è¡¨ç¤ºåŸºæœ¬å°±æ˜¯è¿™ä¸ªæ ·å­ã€‚\n\n![](http://media.gusibi.mobi/ZEkOQqFT-JnOR9YJ9FVhLEgptWS73yo2XYO19M_Yz0X1MZOhQtCjjLXA1XFiekCG)\n\nç¥ˆç¥·å¼ç¼–ç¨‹æœ‰ä»€ä¹ˆå±å®³å‘¢ï¼Ÿ\n\n1. ç´¯ï¼Œæ¯æ¬¡å†™å®Œä»£ç è¿˜éœ€è¦å†ç¥ˆç¥·\n2. ä¸å—æ§ï¼Œä»£ç è¿è¡Œç»“æœä¸»è¦çœ‹è¿æ°”ï¼Œå¤§ä»™å¿™çš„æ—¶å€™å¯èƒ½ä¿ä½‘ä¸äº†\n\nè§£å†³è¿™ä¸ªé—®é¢˜æœ‰å¥½å¤šç§æ–¹æ³•ï¼Œå•å…ƒæµ‹è¯•æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚\n\n## å•å…ƒæµ‹è¯•\n\n### ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•\n\n> å•å…ƒæµ‹è¯•æ˜¯ç”±å¼€å‘äººå‘˜ç¼–å†™çš„ï¼Œç”¨äºå¯¹è½¯ä»¶åŸºæœ¬å•å…ƒè¿›è¡Œæµ‹è¯•çš„å¯æ‰§è¡Œçš„ç¨‹åºã€‚\n> å•å…ƒï¼ˆunitï¼‰æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­æœ€å°çš„è¯¾æµ‹è¯•éƒ¨åˆ†ã€‚ï¼ˆæ¯”å¦‚ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç±»\n\ngoogle æŠŠæµ‹è¯•åˆ†æˆå°å‹æµ‹è¯•ã€ä¸­å‹æµ‹è¯•å’Œå¤§å‹æµ‹è¯•ã€‚å•å…ƒæµ‹è¯•åŸºæœ¬å’Œå°å‹æµ‹è¯•çš„ä½œç”¨ç±»ä¼¼ï¼Œä½†æ˜¯é€šå¸¸ä¹Ÿä¼šä½¿ç”¨mockæˆ–è€…stub çš„æ–¹å¼æ¨¡æ‹Ÿå¤–éƒ¨æœåŠ¡ã€‚\n\n![](http://media.gusibi.mobi/Wn7YW9mDHRpI_3DO2eVFdk1Xx-s_jw5iJogwT0G7ED2UFpXsCYaTqICzqButt02I)\n\n\nç†æƒ³æƒ…å†µä¸‹ï¼Œå•å…ƒæµ‹è¯•åº”è¯¥æ˜¯ç›¸äº’ç‹¬ç«‹ã€å¯è‡ªåŠ¨åŒ–è¿è¡Œçš„ã€‚\n\n**ç›®çš„ï¼š** é€šå¸¸ç”¨å•å…ƒæµ‹è¯•æ¥éªŒè¯ä»£ç é€»è¾‘æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å®Œæ•´å¯é çš„å•å…ƒæµ‹è¯•æ˜¯ä»£ç çš„`å®‰å…¨ç½‘`ï¼Œå¯ä»¥åœ¨ä»£ç ä¿®æ”¹æˆ–é‡æ„æ—¶éªŒè¯ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼Œæå‰å‘ç°ä»£ç é”™è¯¯ï¼Œå‡å°‘è°ƒè¯•æ—¶é—´ã€‚è®¾è®¡è‰¯å¥½çš„å•å…ƒæµ‹è¯•æŸäº›æƒ…å†µä¸‹å¯ä»¥æ¯”æ–‡æ¡£æ›´èƒ½ååº”å‡ºä»£ç çš„åŠŸèƒ½å’Œä½œç”¨ã€‚\n\nå•å…ƒæµ‹è¯•è¿™ä¹ˆå¤šä¼˜ç‚¹ä¸ºä»€ä¹ˆæœ‰äººä¸å–œæ¬¢å†™å•å…ƒæµ‹è¯•å‘¢ï¼Ÿ\n\n1. å•å…ƒæµ‹è¯•å¤ªè´¹æ—¶é—´äº†ï¼Œå¯¹äºç¼–å†™å•å…ƒæµ‹è¯•ä¸ç†Ÿç»ƒçš„æ–°æ‰‹æ¥è¯´ï¼Œç¼–å†™å•å…ƒæµ‹è¯•å¯èƒ½æ¯”å†™ä»£ç çš„è¿˜è´¹æ—¶é—´\n2. å•å…ƒæµ‹è¯•è¿è¡Œæ—¶é—´å¤ªé•¿ï¼ˆè¿™é€šå¸¸æ˜¯å•å…ƒæµ‹è¯•è®¾è®¡ä¸åˆç†æˆ–è€…ä»£ç å¯æµ‹è¯•æ€§è¾ƒå·®é€ æˆçš„\n3. ç¥–ä¼ ä»£ç ï¼Œçœ‹éƒ½çœ‹ä¸æ‡‚æ€ä¹ˆå†™å•å…ƒæµ‹è¯•ï¼ˆè¿™ä¸ªç¡®å®ä¼˜ç‚¹æ£˜æ‰‹ã€‚ã€‚å¯ä»¥è€ƒè™‘å…ˆç»™æ–°ä»£ç åŠ å•å…ƒæµ‹è¯•\n4. ä¸ä¼šå†™å•å…ƒæµ‹è¯•\n\nè¿™ç¯‡æ–‡ç« ä¸»è¦å…³æ³¨ç¬¬å››ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å†™å•å…ƒæµ‹è¯•ã€‚\n\n### å•å…ƒæµ‹è¯•çš„ç»“æ„\n\né¦–å…ˆçœ‹ä¸€ä¸‹å•å…ƒæµ‹è¯•çš„ç»“æ„ï¼Œä¸€ä¸ªå®Œæ•´çš„å•å…ƒæµ‹è¯•ä¸»è¦åŒ…æ‹¬**Arrange-Act-Assertï¼ˆ3Aï¼‰** ä¸‰éƒ¨åˆ†ã€‚\n\n* Arrange--å‡†å¤‡æ•°æ®\n* Act--è¿è¡Œä»£ç \n* Assert--åˆ¤æ–­ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ\n\næ¯”å¦‚æˆ‘ä»¬è¦ç»™ä¸‹é¢è¿™æ®µä»£ç ï¼ˆgolangï¼‰åŠ å•å…ƒæµ‹è¯•ï¼š\n\n```go\n\nfunc Add(x, y int) int {\n\treturn x + y\n}\n\n```\n\nå•å…ƒæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š\n\n```go\nimport \"testing\"\n\nfunc TestAdd(t *testing.T) {\n    // arrange å‡†å¤‡æ•°æ®\n\tx, y := 1, 2\n    // act   è¿è¡Œ\n\tgot := Add(x, y)\n    //assert  æ–­è¨€\n\tif got != 3 {\n\t\tt.Errorf(\"Add() = %v, want %v\", got, 3)\n\t}\n}\n```\n\n### å¦‚ä½•ç¼–å†™å¥½çš„å•å…ƒæµ‹è¯•\n\n> ä»€ä¹ˆæ ·çš„å•å…ƒæµ‹è¯•æ‰æ˜¯å¥½çš„å•å…ƒæµ‹è¯•å‘¢ï¼Ÿ\n\nå…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š\n\n\n```go\npackage ut\n\nimport (\n\t\"fmt\"\n\t\"strconv\"\n\t\"strings\"\n)\n\nfunc isNumber(num string) (int, error) {\n\tnum = strings.TrimSpace(num)\n\tn, err := strconv.Atoi(num)\n\treturn n, err\n}\n\nfunc multiply(x string, y int) string {\n    // å¦‚æœx å»é™¤å‰åçš„ç©ºæ ¼åæ˜¯æ•°å­—ï¼Œè¿”å› æ•°å­—çš„ä¹˜ç§¯\n    //     æ¯”å¦‚ x=\"2\" y=3 return \"6\"\n    // å¦‚æœx å»é™¤å‰åçš„ç©ºæ ¼åä¸æ˜¯æ•°å­—ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²çš„xçš„yå€ \n    //     æ¯”å¦‚ x=\"a\" y=2 return \"aa\"\n\tnum, err := isNumber(x)\n\tif err == nil {\n\t\treturn fmt.Sprintf(\"%d\", num*y)\n\t}\n\tresult := \"\"\n\tfor i := 0; i < y; i++ {\n\t\tresult = fmt.Sprintf(\"%s%s\", result, x)\n\t}\n\treturn result\n}\n```\n\næµ‹è¯•ä»£ç å¯èƒ½æ˜¯è¿™ä¸ªæ ·å­ã€‚\n\n```go\n\n// æµ‹è¯•æ–¹æ³•çš„åå­—ä¸ç›´è§‚ï¼Œå¹¶ä¸èƒ½çœ‹å‡ºå…·ä½“è¦æµ‹è¯•ä»€ä¹ˆ\nfunc Test_multiply(t *testing.T) {\n\ttype args struct {\n\t\tx string\n\t\ty int\n\t}\n    // ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ä¸­æœ‰å¤ªå¤šçš„æµ‹è¯•ç”¨ä¾‹\n\ttests := []struct {\n\t\tname string\n\t\targs args\n\t\twant string\n\t}{\n\t\t{\n\t\t\t\"return nil\",\n\t\t\targs{\n\t\t\t\t\"\",\n\t\t\t\t2,\n\t\t\t},\n\t\t\t\"\",\n\t\t},\n\t\t{\n\t\t\t\"return 2\",\n\t\t\targs{\n\t\t\t\t\"1\",\n\t\t\t\t2,\n\t\t\t},\n\t\t\t\"2\",\n\t\t},\n\t\t{// æµ‹è¯•æ•°æ®æœ‰ç‚¹å¥‡è‘©ï¼Œä¸ç›´è§‚\n\t\t\t\"return aaa\",\n\t\t\targs{\n\t\t\t\t\"aaaaaaaaaa\",\n\t\t\t\t6,\n\t\t\t},\n\t\t\t\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\n\t\t},\n\t}\n\tfor _, tt := range tests {\n\t\tt.Run(tt.name, func(t *testing.T) {\n\t\t\tif got := multiply(tt.args.x, tt.args.y); got != tt.want {\n               // æ•°æ®é”™è¯¯çš„æ—¶å€™æœ‰æ˜ç¡®æ ‡æ˜æµ‹è¯•æ•°æ®ï¼ŒæœŸæœ›ç»“æœå’Œå®é™…ç»“æœï¼Œè¿™ä¸€ç‚¹è¿˜æ˜¯æœ‰ç”¨çš„\n\t\t\t\tt.Errorf(\"multiply() = %v, want %v\", got, tt.want)\n\t\t\t}\n\t\t})\n\t}\n}\n\n```\n\nè¿™ä¸ªå•å…ƒæµ‹è¯•ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ\n\n1. ä»£ç æ¯”è¾ƒé•¿ï¼ˆè¿™é‡Œåªåˆ—å‡ºæ¥äº†ä¸‰ä¸ªç”¨ä¾‹ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰å®Œæ•´è¦†ç›–å…¨éƒ¨ç»“æœï¼‰\n2. æµ‹è¯•æ–¹æ³•å¦‚æœå‡ºé”™äº†å¹¶ä¸å®¹æ˜“å®šä½ä½ç½®(ä¸‰ä¸ªæµ‹è¯•æ•°æ®éƒ½åœ¨ä¸€ä¸ªæ–¹æ³•ï¼Œä»»ä½•ä¸€ä¸ªé”™è¯¯éƒ½ä¼šæŒ‡å‘åˆ°åŒä¸€ä¸ªä½ç½®\n3. æœ‰ä¸ªæµ‹è¯•çš„æ•°æ®æ¯”è¾ƒé•¿ï¼Œä¸å¤ªèƒ½ç›´è§‚åˆ¤æ–­æµ‹è¯•æ•°æ®æ˜¯å¦æ­£ç¡®\n4. è¾“å…¥å€¼å¹¶ä¸å®Œæ•´ï¼Œæ¯”å¦‚åŒ…å«ç©ºæ ¼çš„æ•°å­—å­—ç¬¦ä¸²\" 1\" ã€\" 1 \"ã€ \"1 \"å¹¶æ²¡æœ‰æµ‹è¯•ã€‚\n\n\nç»“åˆä¸Šé¢æˆ‘ä»¬å¯¹**å•å…ƒæµ‹è¯•ç›®çš„**çš„æè¿°ï¼Œ**ä¸€ä¸ªå¥½çš„å•å…ƒæµ‹è¯•åº”è¯¥æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶**ï¼š\n\n1. å•å…ƒæµ‹è¯•è¶Šç®€å•è¶Šå¥½ï¼Œä¸€ä¸ªå•å…ƒæµ‹è¯•åªåšä¸€ä»¶äº‹\n2. å¯¹é”™è¯¯æ˜“äºè¿½è¸ªï¼Œå¦‚æœæµ‹è¯•å¤±è´¥ï¼Œé”™è¯¯æç¤ºåº”è¯¥å®¹æ˜“å¸®æˆ‘æˆ‘ä»¬å®šä½é—®é¢˜\n3. æµ‹è¯•å‡½æ•°çš„å‘½åç¬¦åˆç‰¹å®šçš„è§„åˆ™ `Test_{è¢«æµ‹æ–¹æ³•}_{è¾“å…¥}_{æœŸæœ›è¾“å‡º}`\n4. æœ‰ç”¨çš„å¤±è´¥æ¶ˆæ¯\n5. è¾“å…¥ç®€å•ä¸”èƒ½å¤Ÿå®Œæ•´è¿ç”¨ä»£ç çš„è¾“å…¥(åŒ…å«è¾¹ç•Œå€¼ã€ç‰¹æ®Šæƒ…å†µ\n\næ¯”å¦‚ï¼Œä¸Šè¾¹çš„å•å…ƒæµ‹è¯•æˆ‘ä»¬æ”¹æˆè¿™æ ·ï¼š\n\n```go\n// æµ‹è¯•ç‰¹æ®Šå€¼ â€œç©ºå­—ç¬¦ä¸²â€\nfunc Test_multiply_empty_returnEmpty(t *testing.T) {\n    // ç”¨ä¾‹ç®€å•ï¼ŒåªåŒ…å«è¾“å…¥ã€æ‰§è¡Œå’Œåˆ¤æ–­ \n\tx, y, want := \"\", 1, \"\"\n\tgot := multiply(x, y)\n\tif got != want {\n       // æœ‰æ•ˆçš„å¤±è´¥æ¶ˆæ¯\n\t\tt.Errorf(\"multiply() = %v, want %v\", got, want)\n\t}\n}\n\n// æµ‹è¯•åŒ…å«ç©ºæ ¼çš„æ•°å­— è¾¹ç•Œå€¼\nfunc Test_multiply_numberWithSpace_returnNumber(t *testing.T) {\n\tx, y, want := \" 2\", 3, \"6\"\n\tgot := multiply(x, y)\n\tif got != want {\n\t\tt.Errorf(\"multiply() = %v, want %v\", got, want)\n\t}\n}\n// æµ‹è¯•æ­£å¸¸æ•°æ®\nfunc Test_multiply_number_returnNumber(t *testing.T) {\n\tx, y, want := \"2\", 3, \"6\"\n\tgot := multiply(x, y)\n\tif got != want {\n\t\tt.Errorf(\"multiply() = %v, want %v\", got, want)\n\t}\n}\n// æµ‹è¯•éæ•°å­—å­—ç¬¦ \nfunc Test_multiply_String_returnString(t *testing.T) {\n    // è¾“å…¥ç®€å•çš„å­—ç¬¦ä¸²å°±å¯ä»¥æµ‹è¯•ï¼Œæ²¡å¿…è¦ç”¨å¤ªå¥‡æ€ªæˆ–è€…å¤ªé•¿æˆ–è€…å¤ªå¤§çš„æ•°æ®æ•°æ®\n\tx, y, want := \"a\", 3, \"aaa\"\n\tgot := multiply(x, y)\n\tif got != want {\n\t\tt.Errorf(\"multiply() = %v, want %v\", got, want)\n\t}\n}\n// æµ‹è¯•ç©ºæ ¼ è¾¹ç•Œå€¼\nfunc Test_multiply_space_returnSpace(t *testing.T) {\n\tx, y, want := \" \", 3, \"   \"\n\tgot := multiply(x, y)\n\tif got != want {\n\t\tt.Errorf(\"multiply() = %v, want %v\", got, want)\n\t}\n}\n```\n\nå½“ç„¶è¿™ä¸ªæ•°æ®ä¹Ÿå¹¶ä¸å®Œæ•´ï¼Œè¿˜å¯ä»¥å†åŠ å…¥ï¼š\n\n* åŒ…å«ç©ºæ ¼çš„éæ•°å­—å­—ç¬¦\n* æ•°å­—å³ä¾§åŒ…å«ç©ºæ ¼çš„å­—ç¬¦ä¸²\n* æ•°å­—ä¸¤ä¾§éƒ½æœ‰ç©ºæ ¼çš„å­—ç¬¦ä¸²\n\næ—¢ç„¶å¥½çš„å•å…ƒæµ‹è¯•éœ€è¦èƒ½å®Œæ•´çš„æµ‹è¯•ä»£ç ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥ä¿è¯å•å…ƒæµ‹è¯•å¯ä»¥å®Œæ•´è¦†ç›–è¢«æµ‹ä»£ç å‘¢ï¼Ÿ\n\nåŸºäºä»£ç è·¯å¾„è¿›è¡Œåˆ†æç¼–å†™å•å…ƒæµ‹è¯•æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚\n\n#### å•å…ƒæµ‹è¯•è·¯å¾„\n\nè®¾è®¡æµ‹è¯•è·¯å¾„æ—¶å¯ä»¥ä½¿ç”¨æµç¨‹å›¾çš„æ–¹å¼æ¥åˆ†æï¼Œæ‹¿ä¸Šè¾¹`multiply`çš„ä¾‹å­è¿›è¡Œåˆ†æï¼Œè¿™æ®µä»£ç çš„è·¯å¾„å¦‚ä¸‹ï¼š\n\n![](http://media.gusibi.mobi/D-Ve2XrZs8zq4sRpVcRv4quYrcv0X2bVJHlcCUNoxZuoL6Cy3HIV4tsiYBUOorKA)\n\nå½“ç„¶ï¼Œæ¯ä¸ªè·¯å¾„çš„æµ‹è¯•æ•°æ®å¹¶ä¸æ˜¯åªæœ‰ä¸€ç§ï¼Œæ¯”å¦‚`xä¸ºå‰ååŒ…å«ç©ºæ ¼çš„æ•°å­—å­—ç¬¦ä¸²`è¿™ä¸ªè·¯å¾„ä¸­å°±åŒ…å«ä¸‰ç§æƒ…å†µï¼š\n\n* å·¦è¾¹æœ‰ç©ºæ ¼\n* å³è¾¹æœ‰ç©ºæ ¼\n* ä¸¤è¾¹éƒ½æœ‰ç©ºæ ¼\n\n#### å•å…ƒæµ‹è¯•æ•°æ®\n\nåˆç†çš„è®¾è®¡æµ‹è¯•æ•°æ®éå¸¸é‡è¦ï¼Œæµ‹è¯•é™¤äº†ç¬¦åˆä¸Šè¾¹è¯´çš„è¦ç®€å•ç›´è§‚ä»¥å¤–è¿˜è¦ç€é‡è€ƒè™‘è¾¹ç•Œå€¼ã€‚\n\nè®¾è®¡æµ‹è¯•æ•°æ®é€šå¸¸æ˜¯æŠŠå¯èƒ½çš„è¾“å…¥æ•°æ®åˆ†æˆå¤šä¸ªå­é›†ï¼Œç„¶åä»æ¯ä¸ªå­é›†ä¸­é€‰å–å…·æœ‰ä»£è¡¨æ€§çš„æ•°æ®ä½œä¸ºæµ‹è¯•ç”¨ä¾‹ã€‚\næ¯”å¦‚ä¸€æ®µä»£ç çš„ä½œç”¨æ˜¯è®¡ç®—ä¸ªç¨ï¼Œæˆ‘ä»¬å°±åº”è¯¥æŒ‰ç…§ä¸ªç¨ä¸åŒçš„ç­‰çº§æ¥è®¾è®¡æµ‹è¯•æ•°æ®ï¼Œæ¯”å¦‚ï¼š\n\n* å¹´æ”¶å…¥0-36000éƒ¨åˆ†\n* å¹´æ”¶å…¥36000-144000 éƒ¨åˆ†\n* å¹´æ”¶å…¥144000-300000éƒ¨åˆ†\n* å¹´æ”¶å…¥300000-420000éƒ¨åˆ†\n* ...\n\n\nç„¶ååœ¨è¿™ä¸ªå­é›†çš„åŸºç¡€ä¸Šåœ¨é’ˆå¯¹è¾¹ç•Œå€¼åšä¸€äº›æ£€æŸ¥ï¼Œæ¯”å¦‚36000ã€144000 ç­‰ã€‚\n\n### ç§æœ‰æ–¹æ³•å¦‚ä½•æµ‹è¯•\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœç§æœ‰æ–¹æ³•åœ¨å…¬æœ‰æ–¹æ³•ä¸­æœ‰è¢«è°ƒç”¨ï¼Œé€šè¿‡æµ‹è¯•å…¬æœ‰æ–¹æ³•å°±å·²ç»å¯ä»¥é—´æ¥æµ‹è¯•åˆ°ç§æœ‰æ–¹æ³•ã€‚\n\nä¹Ÿæœ‰äº›ç§æœ‰æ–¹æ³•å†™çš„ä¸åˆç†ï¼Œæ¯”å¦‚ç§æœ‰æ–¹æ³•æ²¡æœ‰è¢«ä½¿ç”¨æˆ–è€…ç§æœ‰æ–¹æ³•çš„åŠŸèƒ½å’Œç±»çš„ç›¸å…³æ€§ä¸å¤§ï¼Œè¿™ä¸ªæ—¶å€™å°±å»ºè®®æŠŠç§æœ‰æ–¹æ³•å•ç‹¬æå–æˆæ–°çš„å‡½æ•°æˆ–è€…ç±»æ¥æµ‹è¯•ã€‚\n\n### å¤–éƒ¨æœåŠ¡å¦‚ä½•æµ‹è¯•\n\nå½“ç„¶ç°å®ä¸–ç•Œä¸­çš„ä»£ç å¹¶ä¸ä¼šè¿™ä¹ˆç®€å•ï¼Œé€šå¸¸éƒ½ä¼šåŒ…å«å¤–éƒ¨è¯·æ±‚æˆ–è€…å¯¹äºå…¶å®ƒç±»çš„è°ƒç”¨ã€‚\nåœ¨ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ï¼Œå¯¹äºå¤–éƒ¨ä¾èµ–æˆ‘ä»¬é€šå¸¸ä½¿ç”¨Mockå’ŒStubçš„æ–¹å¼æ¥æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ã€‚\n\nMockå’ŒStub çš„åŒºåˆ«ï¼š\n\n![](http://media.gusibi.mobi/qS_I1IXOCN1KJSbqD0TucScwusxpXW6C2V9_dewdTniGhvvuw5e1MlaWR7mzew2k)\n\n* Mockæ˜¯åœ¨æµ‹è¯•ä»£ç ä¸­åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡ï¼Œæ¨¡æ‹Ÿè¢«æµ‹æ–¹æ³•çš„æ‰§è¡Œã€‚æµ‹è¯•ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡æ¥éªŒè¯ç»“æœæ˜¯å¦æ­£ç¡®\n\n![](http://media.gusibi.mobi/n8_BO2UKcDLlUQ6atxb7CaZ6ndGpuwA_ewjxj_QdCb9LuRLhDsC7UNWr4wLD2wTW)\n\n* Stubæ˜¯åœ¨æµ‹è¯•åŒ…ä¸­åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿæ–¹æ³•ï¼Œç”¨äºæ›¿æ¢è¢«æµ‹ä»£ç ä¸­çš„æ–¹æ³•ï¼Œæ–­è¨€é’ˆå¯¹è¢«æµ‹ç±»æ‰§è¡Œã€‚\n\nä¸‹é¢æ˜¯ä»£ç ç¤ºä¾‹ï¼š\n\n#### Mock\n\nå®é™…ä»£ç ï¼š\n\n```go\n//auth.go\n//å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¾èµ–httpè¯·æ±‚çš„é‰´æƒæ¥å£\ntype AuthService interface{    \n    Login(username string,password string) (token string,e error)   \n    Logout(token string) error\n}\n```\nMockä»£ç ï¼š\n```go\n//auth_test.go\ntype authService struct {}\nfunc (auth *authService) Login (username string,password string) (string,error){\n    return \"token\", nil\n}\nfunc (auth *authService) Logout(token string) error{    \n    return nil\n}\n\n```\n\nåœ¨æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨ authServiceå®ç°äº†AuthService æ¥å£ï¼Œè¿™æ ·æµ‹è¯•æ—¶å¯ä»¥æ¨¡æ‹Ÿå¤–éƒ¨çš„ç½‘ç»œçš„è¯·æ±‚ï¼Œè§£é™¤ä¾èµ–ã€‚\n\n\n> è¿™é‡Œä½¿ç”¨çš„æ˜¯golang ä»£ç ï¼Œgolang ä¸æ”¯æŒé‡è½½ï¼Œè¿™æ ·ä½¿ç”¨çš„é—®é¢˜æ˜¯ä¼šäº§ç”Ÿå¤§é‡é‡å¤çš„ä»£ç ã€‚\n> å¦‚æœæ˜¯pythonã€javaç­‰æ”¯æŒé‡è½½çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå¯ä»¥ç®€å•çš„ç»§æ‰¿çˆ¶ç±»ï¼Œåªé‡è½½åŒ…å«å¤–éƒ¨è¯·æ±‚çš„ä»£ç å°±å¯ä»¥å®ç°Mockçš„éœ€æ±‚ã€‚\n\n#### Stub\n\n\n```go\npackage ut\n\nfunc notifyUser(username string){\n\t// å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œå‘é€ç™»å½•æé†’é‚®ä»¶\n}\n\ntype AuthService struct{}\n\nfunc (auth *AuthService) Login(username string, password string) (string, error) {\n    notifyUser(username)\n\treturn \"token\", nil\n}\nfunc (auth *AuthService) Logout(token string) error {\n\treturn nil\n}\n```\n\n\nå¯¹äºè¿™æ®µä»£ç æƒ³è¦æµ‹è¯•å…¶å®æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œå› ä¸ºLogin ä¸­è°ƒç”¨äº†notifyUserï¼Œå¦‚æœæƒ³æµ‹è¯•è¿™æ®µä»£ç ï¼š\n* ä¸€ä¸ªæ–¹å¼æ˜¯ä½¿ç”¨Mockçš„å½¢å¼ï¼Œå®šä¹‰authService æ¥å£ï¼Œç„¶åå®ç°æ¥å£ TestAuthServiceï¼Œåœ¨ TestAuthService Loginä¸­ æ›¿æ¢æ‰notifyUserã€‚è¿™ç§åšæ³•æ”¹åŠ¨æ¯”è¾ƒå¤§ï¼ŒåŒæ—¶é‡å¤ä»£ç ä¹Ÿæ¯”è¾ƒå¤šï¼ˆå½“ç„¶å¦‚æœæ˜¯python javaç­‰æ”¯æŒé‡è½½çš„è¯­è¨€å¯ä»¥åªé‡è½½Loginæ¥å£å³å¯ã€‚\n* è¿˜æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯é‡æ„Loginæ–¹æ³•ï¼ŒæŠŠnotifyUser ä½œä¸ºå‚æ•°ä¼ å…¥å…¶ä¸­ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€åœ¨æµ‹è¯•ä»£ç ä¸­é‡æ–°å®šä¹‰notifyUserï¼Œç„¶åä½œä¸ºå‚æ•°ä¼ å…¥åˆ°Loginå³å¯æ¨¡æ‹Ÿå‘é€é‚®ä»¶æé†’çš„åŠŸèƒ½ã€‚\n\nç¬¬äºŒç§å°±æ˜¯stub çš„æ–¹å¼ã€‚\n\né€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæƒ³è¦ä»£ç å®¹æ˜“æµ‹è¯•ï¼Œä»£ç åœ¨è®¾è®¡æ—¶å°±åº”è¯¥è€ƒè™‘å¯æµ‹è¯•æ€§ã€‚\n\n### ç¼–å†™å¯æµ‹è¯•ä»£ç \n\n> Writing Testable Code ä¸­æåˆ°ä¸€ä¸ªéå¸¸å®ç”¨çš„è§‚ç‚¹ï¼šåœ¨å¼€å‘æ—¶ï¼Œå¤šæƒ³æƒ³å¦‚ä½•ä½¿å¾—è‡ªå·±çš„ä»£ç æ›´æ–¹ä¾¿å»æµ‹è¯•ã€‚å¦‚æœè€ƒè™‘åˆ°è¿™äº›ï¼Œé‚£ä¹ˆé€šå¸¸ä½ çš„ä»£ç è®¾è®¡ä¹Ÿä¸ä¼šå¤ªå·®ã€‚\n\nå¦‚æœä»£ç ä¸­å‡ºç°äº†ä»¥ä¸‹æƒ…å†µï¼Œé‚£ä¹ˆé€šå¸¸æ˜¯ä¸æ˜“äºæµ‹è¯•çš„ï¼š\n\n1. åœ¨æ„é€ å‡½æ•°æˆ–æˆå‘˜å˜é‡ä¸­å‡ºç°newå…³é”®å­—\n2. åœ¨æ„é€ å‡½æ•°æˆ–æˆå‘˜å˜é‡ä¸­ä½¿ç”¨staticæ–¹æ³•\n3. åœ¨æ„é€ å‡½æ•°ä¸­æœ‰é™¤äº†å­—æ®µèµ‹å€¼å¤–çš„å…¶å®ƒæ“ä½œ\n4. åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨æ¡ä»¶è¯­å¥æˆ–è€…å¾ªç¯\n5. åœ¨æ„é€ å‡½æ•°ä¸­æ²¡æœ‰ä½¿ç”¨builderæˆ–factoryæ–¹æ³•ï¼ŒäºŒåä½¿ç”¨object graphæ¥æ„é€ \n6. å¢åŠ æˆ–ä½¿ç”¨åˆå§‹åŒ–ä»£ç \n\nè¿™ç¯‡æ–‡ç« åœ°å€ä¸ºï¼šhttp://misko.hevery.com/attachments/Guide-Writing%20Testable%20Code.pdf æ¨èé˜…è¯»ã€‚\n\n> ä¹Ÿå¯ä»¥åœ¨å…¬å·å›å¤ ã€Œtestã€ è·å–pdf\n\n## æ€»ç»“\n\næ€»ç»“ä¸€ä¸‹å°±æ˜¯ç¼–å†™å¯æµ‹è¯•ä»£ç ï¼Œä½¿ç”¨é«˜è´¨é‡å•å…ƒæµ‹è¯•ï¼ˆå‘½åæ¸…æ™°ã€åŠŸèƒ½ç®€å•ã€è·¯å¾„å®Œæ•´ã€æ•°æ®å¯é ï¼‰ä¿è¯ä»£ç è´¨é‡ã€‚\n\n## å‚è€ƒæ–‡ç« \n\n* [æå®šGoå•å…ƒæµ‹è¯•ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€åŸç†](https://juejin.im/post/5ce93447e51d45775746b8b0)\n* [Guide Writing Testable Code](http://misko.hevery.com/attachments/Guide-Writing%20Testable%20Code.pdf)\n* [Selective Unit Testing â€“ Costs and Benefits](http://blog.stevensanderson.com/2009/11/04/selective-unit-testing-costs-and-benefits/)\n* [ç‰ˆæœ¬ä¸Šçº¿æ‹œå“ªä¸ªç¥ä»™æ¯”è¾ƒçµéªŒï¼Ÿ](https://www.zhihu.com/question/52985744)\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n",
      "data": {
        "title": "å­¦ä¹ å•å…ƒæµ‹è¯•ï¼Œå‘Šåˆ«ç¥ˆç¥·å¼ç¼–ç¨‹",
        "date": "2019-10-07 01:48:04",
        "tags": [
          "golang",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "unit-test"
    },
    {
      "content": "\n1. Docker ç»ˆç«¯UIï¼š [https://github.com/jesseduffield/lazydocker](htps://github.com/jesseduffield/lazydocker)\n\n![](http://media.gusibi.mobi/demo3.gif)\n\n2. å®æ•°æ®åº“å†…æ ¸æœˆæŠ¥ï¼š[http://mysql.taobao.org/monthly/](htp://mysql.taobao.org/monthly/)\n\næ¯”è¾ƒæ·±å…¥çš„æ•°æ®åº“æºç åˆ†æ\n\n3. æ‰‹æœºå·ç å½’å±åœ°æŸ¥è¯¢ï¼šhttps://apis-mp.gusibi.mobi/mobile/location?mobile=18512345678\n\nä½¿ç”¨serverlesséƒ¨ç½²ï¼Œæ— éœ€æœåŠ¡å™¨ã€‚æºç åœ°å€ï¼š[https://github.com/gusibi/oneplus/tree/master/mobile-attribution](https://github.com/gusibi/oneplus/tree/master/mobile-attribution)\n\n\n4. æ‰‹ç»˜é£æ ¼CSSï¼š[https://www.getpapercss.com/](https://www.getpapercss.com/)\n\n![6336b6d107a91081d7abb93525425bd6.png](evernotecid://49E50F6F-983A-4D9E-90FA-7763241410D1/appyinxiangcom/8460937/ENResource/p5740)\n![](http://media.gusibi.mobi/%E6%89%8B%E7%BB%98css.png)\n\n5. Image-to-Image Demoï¼š [https://affinelayer.com/pixsrv/](https://affinelayer.com/pixsrv/)\n\n6. å­¦éœ¸ç”¨å·¦è¾¹ï¼Œå­¦æ¸£ç”¨å³è¾¹ï¼š[https://www.plainlanguage.gov/guidelines/words/use-simple-words-phrases/](https://www.plainlanguage.gov/guidelines/words/use-simple-words-phrases/)\n\n> ç¾å›½æ”¿åºœçš„ä¸€ä¸ªç½‘é¡µï¼Œæœ‰å‡ ç™¾æ¡å•è¯å»ºè®®ï¼ŒæŒ‡å¯¼ä½ æ€ä¹ˆå†™å‡ºç®€å•çš„æ–‡ç« ï¼Œä¸è¦ç”¨å¤æ‚çš„å•è¯ã€‚\n\næ¯”å¦‚è¯´ï¼Œâ€œaå’Œbå¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨â€ï¼Œä¸è¦ç”¨ a and/or bï¼Œè€Œè¦ç”¨ a or b or bothã€‚\n\n7. å¾®è½¯ä¸Šçº¿äº†ä¸€å¥— Python æ•™ç¨‹[ã€ŠDevelop with Python on Windowsã€‹](https://docs.microsoft.com/zh-cn/windows/python/)\n\nå¾®è½¯ä¸Šçº¿äº†ä¸€å¥— Python æ•™ç¨‹ã€ŠDevelop with Python on Windowsã€‹ã€‚\n\n8. ç™¾åº¦ç½‘ç›˜ä¸‹è½½å™¨ï¼š[https://github.com/b3log/baidu-netdisk-downloaderx](https://github.com/b3log/baidu-netdisk-downloaderx)\n\n ä¸€æ¬¾å›¾å½¢ç•Œé¢çš„ç™¾åº¦ç½‘ç›˜ä¸é™é€Ÿä¸‹è½½å™¨ï¼Œæ”¯æŒ Windowsã€Linux å’Œ Macã€‚ \n\n\n## å‚è€ƒé“¾æ¥\n\n[1] ã€ŠDevelop with Python on Windowsã€‹: https://docs.microsoft.com/zh-cn/windows/python/\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "æ¯å‘¨åˆ†äº«ç¬¬4æœŸ",
        "date": "2019-08-04 10:05:15",
        "tags": [
          "æ¯å‘¨åˆ†äº«",
          "python",
          "æ•™ç¨‹",
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "weekly-04"
    },
    {
      "content": "\n* [ã€èµ„æ–™ã€‘å²ä¸Šæœ€å…¨çš„ç¼–ç¨‹å­¦ä¹ èµ„æ–™åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰](https://github.com/toutiaoio/weekly.manong.io)\n* [ã€èµ„æ–™ã€‘ä¸€å‘¨ GitHub å¼€æºé¡¹ç›®æ¨èï¼šé˜¿é‡Œã€è…¾è®¯ã€é™Œé™Œã€bilibiliâ€¦â€¦](https://mp.weixin.qq.com/s/eYn1buoKXOCNgRv2-coDmA)\n* [ã€èµ„æ–™ã€‘å¸¸ç”¨çš„ Go æ¡†æ¶ã€åº“å’Œè½¯ä»¶ä¸­æ–‡æ”¶å½•å¤§å…¨](https://juejin.im/post/5d14a319e51d4577407b1d77)\n* [ã€æ•™ç¨‹ã€‘é«˜æ€§èƒ½ Go ä»£ç å·¥åŠ](https://dave.cheney.net/high-performance-go-workshop/gopherchina-2019.html)ï¼ˆè‹±æ–‡ï¼‰\n* [ã€æ–‡ç« ã€‘æˆ‘ç”¨äº†10å¹´ ä»æ·±åœ³æµæ°´çº¿å‚å¦¹åšåˆ°çº½çº¦é«˜è–ªç¨‹åºå‘˜](https://mp.weixin.qq.com/s/tv6S0VmDtbdSW8-qKjERiA)\n* [ã€æ–‡ç« ã€‘2009å¹´æœ€çƒ­é—¨çš„ iPhone åº”ç”¨ç¨‹åº](https://www.fastcompany.com/90356079/whatever-happened-to-the-hottest-iphone-apps-of-2009)ï¼ˆè‹±æ–‡ï¼‰\n> è‹¹æœå…¬å¸çš„åº”ç”¨å•†åº—å³å°†æ»¡åå‘¨å¹´ï¼Œæœ¬æ–‡å›é¡¾äº†2009å¹´æœ€çƒ­é—¨çš„ä»˜è´¹åº”ç”¨å’Œå…è´¹åº”ç”¨\n* [ã€è¯­è¨€ã€‘vè¯­è¨€-è¯­æ³•ç»¼åˆäº†pythonå’Œgo](https://github.com/vlang/v)\n* [ã€å·¥å…·ã€‘weixin python sdk æ”¯æŒå°ç¨‹åºäº‘å¼€å‘](https://github.com/gusibi/python-weixin)\n* [ã€å·¥å…·ã€‘ç½‘ç«™æ”¶å½•äº†ä¼°å€¼è¾¾åˆ° 10 äº¿ç¾å…ƒçš„åˆ›ä¸šå…¬å¸ï¼Œå®æ—¶æ›´æ–°](https://dujiaoshou.io/)\n* [ã€å·¥å…·ã€‘ç®€æ´çš„ Mac å›¾åºŠå®¢æˆ·ç«¯ uPic](https://github.com/gee1k/uPic)\n\n### References\n\n[1] ã€èµ„æ–™ã€‘å²ä¸Šæœ€å…¨çš„ç¼–ç¨‹å­¦ä¹ èµ„æ–™åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰: https://github.com/toutiaoio/weekly.manong.io\n[2] ã€èµ„æ–™ã€‘å¸¸ç”¨çš„ Go æ¡†æ¶ã€åº“å’Œè½¯ä»¶ä¸­æ–‡æ”¶å½•å¤§å…¨: https://juejin.im/post/5d14a319e51d4577407b1d77\n[3] ã€æ•™ç¨‹ã€‘é«˜æ€§èƒ½ Go ä»£ç å·¥åŠ: https://dave.cheney.net/high-performance-go-workshop/gopherchina-2019.html\n[4] ã€æ–‡ç« ã€‘2009å¹´æœ€çƒ­é—¨çš„ iPhone åº”ç”¨ç¨‹åº: https://www.fastcompany.com/90356079/whatever-happened-to-the-hottest-iphone-apps-of-2009\n[5] ã€è¯­è¨€ã€‘vè¯­è¨€-è¯­æ³•ç»¼åˆäº†pythonå’Œgo: https://github.com/vlang/v\n[6] ã€å·¥å…·ã€‘weixin python sdk æ”¯æŒå°ç¨‹åºäº‘å¼€å‘: https://github.com/gusibi/python-weixin\n[7] ã€å·¥å…·ã€‘ç½‘ç«™æ”¶å½•äº†ä¼°å€¼è¾¾åˆ° 10 äº¿ç¾å…ƒçš„åˆ›ä¸šå…¬å¸ï¼Œå®æ—¶æ›´æ–°: https://dujiaoshou.io/\n[8] ã€å·¥å…·ã€‘ç®€æ´çš„ Mac å›¾åºŠå®¢æˆ·ç«¯ uPic: https://github.com/gee1k/uPic\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "æ¯å‘¨åˆ†äº«ç¬¬3æœŸ-å²ä¸Šæœ€å…¨çš„ç¼–ç¨‹å­¦ä¹ èµ„æ–™åˆé›†",
        "date": "2019-06-29 10:05:15",
        "tags": [
          "æ¯å‘¨åˆ†äº«",
          "python",
          "æ•™ç¨‹",
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "weekly-03"
    },
    {
      "content": "\n1 å®‡å®™æ¨¡æ‹Ÿå™¨ ï¼š[http://spaceengine.org](http://spaceengine.org)\n2 APIJSONï¼š[https://github.com/APIJSON/APIJSON](https://github.com/APIJSON/APIJSON)\n\n> APIJSONæ˜¯ä¸€ç§ä¸ºAPIè€Œç”Ÿçš„ JSONç½‘ç»œä¼ è¾“åè®® ä»¥åŠ åŸºäºè¿™å¥—åè®®å®ç°çš„ORMåº“ã€‚\n> åç«¯æ¥å£å’Œæ–‡æ¡£è‡ªåŠ¨åŒ–ï¼Œå‰ç«¯(å®¢æˆ·ç«¯) å®šåˆ¶è¿”å›JSONçš„æ•°æ®å’Œç»“æ„\n\n3 ã€æ–‡ç« ã€‘å°ç«ç®­å¯¹SpaceXæ˜Ÿé“¾è®¡åˆ’ä½è½¨å·¨å‹æ˜Ÿåº§çš„åˆ†æï¼š[https://mp.weixin.qq.com/s/NNmI_cqwo4ba0ViJ9O7f3Q](https://mp.weixin.qq.com/s/NNmI_cqwo4ba0ViJ9O7f3Q)\n> è¿™ç¯‡å¯¹SpaceX æ˜Ÿé“¾è®¡åˆ’ å¯è¡Œæ€§è¿›è¡Œäº†è¯¦ç»†çš„åˆ†æï¼Œå…±11575å­—ï¼Œ101å›¾ã€‚é¢„è®¡é˜…è¯»æ—¶é—´ï¼š1å°æ—¶15åˆ†é’Ÿ\n\n4 å¾®è½¯ä¸ Google å…±åŒå¼€è®¾çš„é‡å­ç®—æ³•è¯¾ç¨‹ï¼š[https://brilliant.org/courses/quantum-computing/](https://brilliant.org/courses/quantum-computing/)\n\n> é€šè¿‡æµè§ˆå™¨æ¨¡æ‹Ÿçš„é‡å­è®¡ç®—ç¯å¢ƒï¼Œå­¦ä¹ é‡å­ç®—æ³•\n\n5 ä¸€ä¸ªVPSæœç´¢å·¥å…·: [https://anothervps.com/vps/](https://anothervps.com/vps/)\n> å¯æ€œæˆ‘linode éƒ½ç”¨ä¸äº†äº†\n\n6 ä¸€äº›æœ‰è¶£çš„ç½‘ç«™ï¼š\n  * https://www.ctolib.com Githubå¼€æºé¡¹ç›®æ”¶é›†ç½‘ç«™\n  * http://www.nicetool.net å®ç”¨å·¥å…·æ¯”è¾ƒå¤š\n  * http://www.mvyxws.com/ ä»¥è§†é¢‘æ–¹å¼åˆ†äº«åŒ»å­¦çŸ¥è¯†çš„ç½‘ç«™\n  * https://www.tikitiki.cn è‡ªç”±çš„éŸ³ä¹ï¼Œèƒ½å¤Ÿè¯•å¬å¹¶ä¸‹è½½å…¨ç½‘éŸ³ä¹\n  * https://showmore.com/zh/ åœ¨çº¿å½•åˆ¶å±å¹•çš„å·¥å…·\n  * https://weibomiaopai.com è§†é¢‘ä¸‹è½½\n\n7 PySnooperï¼š[https://github.com/cool-RR/PySnooper](https://github.com/cool-RR/PySnooper)\n> python DeBugå·¥å…·\n\n8 pyechartsï¼š[https://github.com/pyecharts/pyecharts](https://github.com/pyecharts/pyecharts)\n> Echarts æ˜¯ä¸€ä¸ªç”±ç™¾åº¦å¼€æºçš„æ•°æ®å¯è§†åŒ–ï¼Œpycharts æ˜¯Echarts çš„pythonç‰ˆã€‚\n\n9 LeetCodeAnimationï¼š[https://github.com/MisterBooo/LeetCodeAnimation](https://github.com/MisterBooo/LeetCodeAnimation)\n> ç”¨åŠ¨ç”»çš„å½¢å¼å‘ˆç°è§£LeetCodeé¢˜ç›®çš„æ€è·¯\n\n10 ColorUIï¼š[https://www.color-ui.com/](https://www.color-ui.com/)\n> é²œäº®çš„é«˜é¥±å’Œè‰²å½©ï¼Œä¸“æ³¨è§†è§‰çš„å°ç¨‹åºç»„ä»¶åº“\n\n\niPhone Xæ€ä¹ˆå¼ºåˆ¶å…³æœºï¼Ÿ\n\niPhone Xå¼ºåˆ¶å…³æœºæœ‰ä¸‰æ­¥ï¼š\n1. æŒ‰ä¸‹éŸ³é‡+é”®ç„¶åæ¾å¼€ï¼›\n2. æŒ‰ä¸‹éŸ³é‡-é”®ç„¶åæ¾å¼€ï¼›\n3. ä¹‹åæŒ‰ä½ä¾§è¾¹æŒ‰é’®ï¼ˆå³ç”µæºé”®ï¼‰ç›´åˆ°iPhone Xé»‘å±ã€‚\n\n> å‡çº§äº†iOS13ï¼Œæ‰“ç”µè¯çš„æ—¶å€™å°±åœç•™åœ¨äº†é€šè¯ç•Œé¢ï¼Œå†ä¹Ÿé€€ä¸å‡ºå»äº†ã€‚ã€‚åªèƒ½ç”¨å¼ºåˆ¶å…³æœºçš„æ–¹å¼ã€‚\n> æ‰çŸ¥é“æ˜¯è¿™ä¹ˆä¸ªæ–¹å¼\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "æ¯å‘¨åˆ†äº«ç¬¬2æœŸ-å®‡å®™æ¨¡æ‹Ÿå™¨",
        "date": "2019-06-22 10:05:15",
        "tags": [
          "æ¯å‘¨åˆ†äº«",
          "python",
          "æ•™ç¨‹",
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "weekly-02"
    },
    {
      "content": "\nåœ¨stackoverflow çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œ[Redis strings vs Redis hashes to represent JSON: efficiency?](https://stackoverflow.com/questions/16375188/redis-strings-vs-redis-hashes-to-represent-json-efficiency)å†…å®¹å¦‚ä¸‹ï¼š\n\n> I want to store a JSON payload into redis. There's really 2 ways I can do this:\n>\n> 1. One using a simple string keys and values.\n>\n>    key:user, value:payload (the entire JSON blob which can be 100-200 KB)\n>\n>    SET user:1 payload\n>\n> 2. Using hashes\n> \n>     HSET user:1 username \"someone\"\n>     HSET user:1 location \"NY\"\n>     HSET user:1 bio \"STRING WITH OVER 100 lines\"\n> \n> Keep in mind that if I use a hash, the value length isn't predictable. They're not all short such as the bio example above.\n> Which is more memory efficient? Using string keys and values, or using a hash?\n\n### string å’Œ hash ç›´è§‚æµ‹è¯•\n\né¦–å…ˆæˆ‘ä»¬å…ˆæµ‹è¯•ç”¨æ•°æ®æµ‹è¯•ä¸€ä¸‹ï¼Œæµ‹è¯•æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\n\n\n\n```json\nvalues = {\n    \"name\": \"gs\",\n    \"age\": 1\n}\n```\n\n\n\nä½¿ç”¨for ç”Ÿæˆ10wä¸ªkeyï¼Œkeyçš„ç”Ÿæˆè§„åˆ™ä¸ºï¼š\n\n\n\n```python\nfor i in range(100000):\n    key = \"object:%d\" % i\n```\n\n\n\næŠŠæ•°æ®åˆ†åˆ«ä»¥hash å’Œ stringï¼ˆvalues ä½¿ç”¨ json encode ä¸ºstring ï¼‰çš„å½¢å¼å­˜å…¥redisã€‚\n\nç»“æœå¦‚ä¸‹ï¼š\n\n\n\n>  hash å ç”¨ 10.16M\n>\n> string å ç”¨ 10.15M\n\n\n\n**è¿™çœ‹èµ·æ¥å’Œæˆ‘ä»¬å°è±¡ä¸­hash å ç©ºé—´æ¯”è¾ƒå¤§çš„è§‚å¿µä¸å¤ªä¸€è‡´ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ**\n\nè¿™é‡Œæ˜¯å› ä¸ºRedis çš„hash å¯¹è±¡æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼š\n\n1. ziplistï¼ˆ2.6ä¹‹å‰æ˜¯zipmapï¼‰\n2. hashtable\n\nå½“å“ˆå¸Œå¯¹è±¡å¯ä»¥åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œ å“ˆå¸Œå¯¹è±¡ä½¿ç”¨ ziplist ç¼–ç ï¼š\n\n1. å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼çš„å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº 64 å­—èŠ‚ï¼›\n2. å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº 512 ä¸ªï¼›\n\nä¸èƒ½æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„å“ˆå¸Œå¯¹è±¡éœ€è¦ä½¿ç”¨ hashtable ç¼–ç ã€‚ä¸Šè¿°æµ‹è¯•æ•°æ®æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„æ˜¯ziplistæ¥å­˜å‚¨çš„æ•°æ®ï¼Œè€Œä¸æ˜¯hashtableã€‚\n\n\n\n> `æ³¨æ„`\n> è¿™ä¸¤ä¸ªæ¡ä»¶çš„ä¸Šé™å€¼æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œ å…·ä½“è¯·çœ‹é…ç½®æ–‡ä»¶ä¸­å…³äº hash-max-ziplist-value é€‰é¡¹å’Œ hash-max-ziplist-entries é€‰é¡¹çš„è¯´æ˜ã€‚\n>\n> hash-max-ziplist-entries for Redis >= 2.6\n> hash-max-ziplist-value for Redis >= 2.6\n\n\n\n#### ziplist\n\n**ziplist ç¼–ç çš„æ•°æ®åº•å±‚æ˜¯ä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ï¼Œç»“æ„å¦‚ä¸‹ï¼š**\n\n![ziplist](http://media.gusibi.mobi/Ir11LH8z_BiQW8eVl2OXaKERDyO5V5cXkx1OqNaeGWBuqo1Z6WZRss_YP98mnJuc)\n\n![ziplist åº•å±‚å®ç°](http://media.gusibi.mobi/EinQ3TgdfGywd8GtAk93ksSzJeZsf7cBSBxEMgtrt9SM2MAvQcLoxvuGeQSdFS7W)\n\n\n\nhash å¯¹è±¡ä½¿ç”¨ziplist ä¿å­˜æ—¶ï¼Œç¨‹åºä¼šå°†ä¿å­˜äº†é”®çš„ziplistèŠ‚ç‚¹æ¨å…¥åˆ°åˆ—è¡¨çš„è¡¨å°¾ï¼Œç„¶åå†å°†ä¿å­˜äº†å€¼çš„ziplistèŠ‚ç‚¹æ¨å…¥åˆ—è¡¨çš„è¡¨å°¾ã€‚\n\nä½¿ç”¨è¿™ç§æ–¹å¼ä¿å­˜æ—¶ï¼Œå¹¶ä¸éœ€è¦ç”³è¯·å¤šä½™çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸”æ¯ä¸ªKeyéƒ½è¦å­˜å‚¨ä¸€äº›å…³è”çš„ç³»ç»Ÿä¿¡æ¯ï¼ˆå¦‚è¿‡æœŸæ—¶é—´ã€LRUç­‰ï¼‰ï¼Œå› æ­¤å’ŒStringç±»å‹çš„Key/Valueç›¸æ¯”ï¼ŒHashç±»å‹æå¤§çš„å‡å°‘äº†Keyçš„æ•°é‡(å¤§éƒ¨åˆ†çš„Keyéƒ½ä»¥Hashå­—æ®µçš„å½¢å¼è¡¨ç¤ºå¹¶å­˜å‚¨äº†)ï¼Œä»è€Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†å­˜å‚¨ç©ºé—´çš„ä½¿ç”¨æ•ˆç‡ã€‚\n\nåœ¨è¿™ç¯‡[redis memory optimization](https://redis.io/topics/memory-optimization)å®˜æ–¹æ–‡ç« ä¸­ï¼Œä½œè€…å¼ºçƒˆæ¨èä½¿ç”¨hashå­˜å‚¨æ•°æ®\n\n\n\n> ### Use hashes when possible\n>\n>  Small hashes are encoded in a very small space, so you should try representing your data using hashes every time it is possible. For instance if you have objects representing users in a web application, instead of using different keys for name, surname, email, password, use a single hash with all the required fields.\n> \n>  But many times hashes contain just a few fields. When hashes are small we can instead just encode them in an O(N) data structure, like a linear array with length-prefixed key value pairs. Since we do this only when N is small, the amortized time for HGET and HSET commands is still O(1): the hash will be converted into a real hash table as soon as the number of elements it contains will grow too much (you can configure the limit in redis.conf).\n>\n>  This does not work well just from the point of view of time complexity, but also from the point of view of constant times, since a linear array of key value pairs happens to play very well with the CPU cache (it has a better cache locality than a hash table).\n\n\n\n#### hashtable\n\n `hashtable` ç¼–ç çš„å“ˆå¸Œå¯¹è±¡ä½¿ç”¨å­—å…¸ä½œä¸ºåº•å±‚å®ç°ï¼Œ å“ˆå¸Œå¯¹è±¡ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹éƒ½ä½¿ç”¨ä¸€ä¸ªå­—å…¸é”®å€¼å¯¹æ¥ä¿å­˜ï¼š\n\n- å­—å…¸çš„æ¯ä¸ªé”®éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œ å¯¹è±¡ä¸­ä¿å­˜äº†é”®å€¼å¯¹çš„é”®ï¼›\n- å­—å…¸çš„æ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œ å¯¹è±¡ä¸­ä¿å­˜äº†é”®å€¼å¯¹çš„å€¼ã€‚\n\n**hashtable ç¼–ç çš„å¯¹è±¡å¦‚ä¸‹æ‰€ç¤ºï¼š**\n\n![](http://media.gusibi.mobi/uxuYAXAcsW_18WeIiiwGNTbMqWbncG6Vd143kyizERZgYMmBggKd4EK_zkIva7AQ)\n\n### ç¬¬äºŒæ¬¡æµ‹è¯•\n\n\n\n```json\nvalues = {\n    \"name\": \"gs\",\n    \"age\": 1,\n    \"intro\": \"long..long..long..string\"\n}\n```\n\n\n\nç¬¬äºŒæ¬¡æµ‹è¯•æ–¹å¼å’Œç¬¬ä¸€æ¬¡ä¸€æ ·ï¼Œåªæ˜¯æŠŠæµ‹è¯•æ•°æ®ä¸­åŠ äº†ä¸€ä¸ªå¤§çš„å­—ç¬¦ä¸²ï¼Œä»¥ä¿è¯hash ä½¿ç”¨hashtable çš„æ–¹å¼å­˜å‚¨æ•°æ®\n\nç»“æœå¦‚ä¸‹ï¼š\n\n\n\n> hashtableï¼š 1.13G\n>\n> stringï¼š        1.13G\n\nåŸºæœ¬ä¸€æ ·ï¼Œè¿™é‡Œåº”è¯¥ä¸»è¦æ˜¯Hashç±»å‹æå¤§çš„å‡å°‘äº†Keyçš„æ•°é‡(å¤§éƒ¨åˆ†çš„Keyéƒ½ä»¥Hashå­—æ®µçš„å½¢å¼è¡¨ç¤ºå¹¶å­˜å‚¨äº†)ï¼Œä»è€Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†å­˜å‚¨ç©ºé—´çš„ä½¿ç”¨æ•ˆç‡ã€‚\n\n\n\n**NOTE:** è¯»å–å’Œå†™å…¥çš„é€Ÿåº¦åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«ä¸å¤§\n\n\n\nå›åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¯¹äºstring å’Œ hash è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ\n\næˆ‘æ¯”è¾ƒèµåŒä¸‹é¢è¿™ä¸ªç­”æ¡ˆï¼š\n\n![](http://media.gusibi.mobi/5v4pyfA4GAF4q-BnGujmFveL24N6uGWuhISE5RXYThGUtZlot_-H5OTymX4ANnNr)\n\nå…·ä½“ä½¿ç”¨å“ªç§æ•°æ®ç»“æ„ï¼Œå…¶å®æ˜¯éœ€è¦çœ‹ä½ è¦å­˜å‚¨çš„æ•°æ®ä»¥åŠä½¿ç”¨åœºæ™¯ã€‚\n\nå¦‚æœå­˜å‚¨çš„éƒ½æ˜¯æ¯”è¾ƒç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·æ•°æ®ç¼“å­˜ï¼Œæˆ–è€…ç»å¸¸éœ€è¦æ“ä½œæ•°æ®çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªï¼Œç‰¹åˆ«æ˜¯å¦‚æœä¸€ä¸ªæ•°æ®ä¸­å¦‚æœfiledæ¯”è¾ƒå¤šï¼Œä½†æ˜¯æ¯æ¬¡åªéœ€è¦ä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªæˆ–è€…å°‘æ•°çš„å‡ ä¸ªï¼Œä½¿ç”¨hashæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæä¾›äº†hget å’Œ hmgetï¼Œè€Œæ— éœ€å–å‡ºæ‰€æœ‰æ•°æ®å†åœ¨ä»£ç ä¸­å¤„ç†ã€‚\n\nåä¹‹ï¼Œå¦‚æœæ•°æ®å·®å¼‚è¾ƒå¤§ï¼Œæ“ä½œæ—¶å¸¸å¸¸éœ€è¦æŠŠæ‰€æœ‰æ•°æ®éƒ½è¯»å–å‡ºæ¥å†å¤„ç†ï¼Œä½¿ç”¨string æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚\n\n\n\n> å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å¬Redis çš„ï¼Œæ”¾å¿ƒçš„ä½¿ç”¨hash å§ã€‚\n\n\n\nè¿˜æœ‰ä¸€ç§åœºæ™¯ï¼šå¦‚æœä¸€ä¸ªhashä¸­æœ‰å¤§é‡çš„fieldï¼ˆæˆåƒä¸Šä¸‡ä¸ªï¼‰ï¼Œéœ€è¦è€ƒè™‘æ˜¯ä¸æ˜¯ä½¿ç”¨stringæ¥åˆ†å¼€å­˜å‚¨æ˜¯ä¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\n\n\n### References\n\n[1] Redis strings vs Redis hashes to represent JSON: efficiency?: https://stackoverflow.com/questions/16375188/redis-strings-vs-redis-hashes-to-represent-json-efficiency\n[2] redis memory optimization: https://redis.io/topics/memory-optimization\n[3] Redis è®¾è®¡ä¸å®ç°ï¼š http://redisbook.com/preview/object/hash.html\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n",
      "data": {
        "title": "Redis é€‰æ‹©hashè¿˜æ˜¯string å­˜å‚¨æ•°æ®ï¼Ÿ",
        "date": "2019-06-22 03:29:15",
        "tags": [
          "redis",
          "nosql",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "redis-string-or-hash-to-represent-json"
    },
    {
      "content": "\n**æ¯å‘¨åˆ†äº«ï¼Œåˆ†äº«çœ‹åˆ°çš„ä¸€äº›æœ‰æ„æ€çš„æ–‡ç« å’Œé¡¹ç›®**\n\n1 ä¸­å›½è¡¨æƒ…åŒ…å¤§é›†åˆ [https://zhaoolee.github.io/ChineseBQB/](https://zhaoolee.github.io/ChineseBQB/)\n\nè¡¨æƒ…åŒ…ç›®å½•(å…±æ”¶å½•2298å¼ è¡¨æƒ…åŒ…)Emoticon package directory (commonly included 2298 emoticon pack)\n\n2 è°·æ­Œäº§å“æ›¿ä»£å“\n\nä¸€æ‰¹è°·æ­Œäº§å“çš„æ›¿ä»£æ–¹æ¡ˆ\n\n[https://nomoregoogle.com/](https://nomoregoogle.com/)\n\n3 Redisä½œè€…ï¼šå¼€æºç»´æŠ¤è€…çš„æŒ£æ‰å’Œæ— å¥ˆ\n\nè‹±æ–‡ä½œè€…æ˜¯è‘—åå¼€æºé¡¹ç›® Redis çš„å¼€å‘è€… antirezã€‚æˆªè‡³ 2019-06-04 ä¸ºæ­¢ï¼ŒRedis é¡¹ç›®åœ¨ GitHub å°†è¿‘æœ‰ 37,000 Starï¼ŒFork æ•°è¾¾ 14000ã€‚\n\n[https://mp.weixin.qq.com/s/6C7-4Fp46rxfn0J34ebKyg](https://mp.weixin.qq.com/s/6C7-4Fp46rxfn0J34ebKyg)\n\n4 ä¸€ä¸ªåˆ†äº« GitHub ä¸Š æœ‰è¶£ã€å…¥é—¨çº§çš„å¼€æºé¡¹ç›®ç½‘ç«™\n\n[https://hellogithub.com](https://hellogithub.com)\n\n5 Saber - æ–°ä¸€ä»£é™æ€ç½‘ç«™ç”Ÿæˆç³»ç»Ÿ\n\n[https://saber.land](https://saber.land)\n\n6 star-history: å¸®åŠ©ç”¨æˆ·æŸ¥çœ‹ github é¡¹ç›® star æ•°ç›®çš„å†å²\n\nstar-history å¸®åŠ©ç”¨æˆ·æŸ¥çœ‹ github é¡¹ç›® star æ•°ç›®çš„å†å², åˆ¤æ–­é¡¹ç›®å‘å±•æƒ…å†µï¼Œé¡¹ç›®åœ°å€ï¼š[https://github.com/timqian/star-history](https://github.com/timqian/star-history)\n\n7 ä¸€ä¸ªåˆ†ç±»æ”¶é›† GitHub å¼€æºé¡¹ç›®çš„ç½‘ç«™ï¼Œå¹¶å¯¹é¡¹ç›®çš„çƒ­åº¦å’Œæ´»è·ƒåº¦è¿›è¡Œåˆ†æ\n\né¡¹ç›®åœ°å€ï¼š[https://www.ctolib.com/](https://www.ctolib.com/)\n\n8 git æäº¤ä¿¡æ¯è§„èŒƒæ£€æµ‹å·¥å…· git-commit-msg-linter\n\né¡¹ç›®åœ°å€ï¼š[https://www.npmjs.com/package/git-commit-msg-linter](https://www.npmjs.com/package/git-commit-msg-linter)\n\n9 ç¼–ç ä¸€æ—¶çˆ½ï¼Œé‡å†™ç«è‘¬åœºï¼Ÿè¿™äº›å…¬å¸éƒ½é‡å†™äº†è½¯ä»¶ï¼Œç»“å±€å´ä¸åŒã€‚\n\n> ç”Ÿå­˜ï¼Œè¿˜æ˜¯æ­»äº¡ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚é‡å†™ï¼Œè¿˜æ˜¯ä¸é‡å†™ï¼Œè¿™æ˜¯å¯¼è‡´ç”Ÿå­˜æˆ–æ­»äº¡çš„å¦ä¸€ä¸ªé—®é¢˜ã€‚\n\n[https://mp.weixin.qq.com/s/SqxPoIDPuvKlrlqZmubpXA](https://mp.weixin.qq.com/s/SqxPoIDPuvKlrlqZmubpXA)\n \n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "æ¯å‘¨åˆ†äº«ç¬¬1æœŸ-å¸¸ç”¨è¡¨æƒ…åŒ…æ”¶å½•",
        "date": "2019-06-07 10:05:15",
        "tags": [
          "æ¯å‘¨åˆ†äº«",
          "python",
          "æ•™ç¨‹",
          "å·¥å…·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "weekly-01"
    },
    {
      "content": "\n### json ç®€ä»‹\n\nJSON(JavaScript Object Notation) æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ æ˜“äºäººé˜…è¯»å’Œç¼–å†™ã€‚åŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚ **å®ƒåŸºäºJavaScript Programming Language, Standard ECMA-262 3rd Edition - December 1999çš„ä¸€ä¸ªå­é›†**ã€‚ JSONé‡‡ç”¨å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ–‡æœ¬æ ¼å¼ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼äºCè¯­è¨€å®¶æ—çš„ä¹ æƒ¯ï¼ˆåŒ…æ‹¬C, C++, C#, Java, JavaScript, Perl, Pythonç­‰ï¼‰ã€‚ è¿™äº›ç‰¹æ€§ä½¿JSONæˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚\n\nJSONæ”¯æŒä¸¤ç§æ•°æ®ç»“æ„å­˜åœ¨ï¼š\n\n* å¯¹è±¡ï¼ˆobjectï¼‰ï¼šä¸€ä¸ªå¯¹è±¡åŒ…å«ä¸€ç³»åˆ—éæ’åºçš„åç§°ï¼å€¼å¯¹(pair)ï¼Œä¸€ä¸ªå¯¹è±¡ä»¥{å¼€å§‹ï¼Œå¹¶ä»¥}ç»“æŸã€‚æ¯ä¸ªåç§°ï¼å€¼å¯¹ä¹‹é—´ä½¿ç”¨ **:** åˆ†å‰²ã€‚\n* æ•°ç»„ (array)ï¼šä¸€ä¸ªæ•°ç»„æ˜¯ä¸€ä¸ªå€¼(value)çš„é›†åˆï¼Œä¸€ä¸ªæ•°ç»„ä»¥ **[** å¼€å§‹ï¼Œå¹¶ä»¥]ç»“æŸã€‚æ•°ç»„æˆå‘˜ä¹‹é—´ä½¿ç”¨ **,** åˆ†å‰²ã€‚\nå…·ä½“çš„æ ¼å¼å¦‚ä¸‹ï¼š\n\n```json\n[value1, value2, value3]\n```\n\n* åç§°ï¼å€¼ï¼ˆpairï¼‰ï¼šåç§°å’Œå€¼ä¹‹é—´ä½¿ç”¨ **:** éš”å¼€ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n\n```json\n{name:value}\n```\n\n> åç§°å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼› \n> å€¼(value)å¿…é¡»æ˜¯å¯ä»¥æ˜¯å­—ç¬¦ä¸²(string)ï¼Œæ•°å€¼(number)ï¼Œå¯¹è±¡(object)ï¼Œæœ‰åºåˆ—è¡¨(array)ï¼Œæˆ–è€… falseï¼Œ nullï¼Œ true çš„å…¶ä¸­ä¸€ç§ã€‚\n\nJSONçš„æ ¼å¼æè¿°å¯ä»¥å‚è€ƒRFC 4627ã€‚\n\n\n### ä¸ºä»€ä¹ˆJSONä¸æ”¯æŒ int64 ç±»å‹ï¼Ÿ\n\né€šè¿‡ä¸Šé¢çš„ä»‹ç»æœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š\n\n1. JSON æ˜¯åŸºäº JavaScript Programming Language, Standard ECMA-262 3rd Edition - December 1999çš„ä¸€ä¸ªå­é›†\n2. JSON æ”¯æŒnumber ç±»å‹\n\nJavascriptçš„æ•°å­—å­˜å‚¨ä½¿ç”¨äº†IEEE 754ä¸­è§„å®šçš„åŒç²¾åº¦æµ®ç‚¹æ•°æ•°æ®ç±»å‹ï¼Œè€Œè¿™ä¸€æ•°æ®ç±»å‹èƒ½å¤Ÿå®‰å…¨å­˜å‚¨ -(2^53-1) åˆ° 2^53-1 ä¹‹é—´çš„æ•°å€¼ï¼ˆåŒ…å«è¾¹ç•Œå€¼ï¼‰ã€‚JSON æ˜¯Javascript çš„ä¸€ä¸ªå­é›†ï¼Œæ‰€ä»¥å®ƒä¹Ÿéµå®ˆè¿™ä¸ªè§„åˆ™ã€‚\n\nä»¥ä¸‹æ˜¯rfc7159çš„è¯´æ˜ï¼š\n\n> Note that when such software is used, numbers that are integers and\n   are in the range [-(2^53)+1, (2^53)-1] are interoperable in the\n   sense that implementations will agree exactly on their numeric\n   values.\n\n\n> è¿™ä¸¤ä¸ªè¾¹ç•Œå€¼å¯ä»¥é€šè¿‡ JavaScript çš„ Number.MAX_SAFE_INTEGER å’Œ Number.MIN_SAFE_INTEGER è·å–ã€‚\n\n![](http://media.gusibi.mobi/json1.png)\n\n> å®‰å…¨å­˜å‚¨çš„æ„æ€æ˜¯æŒ‡èƒ½å¤Ÿå‡†ç¡®åŒºåˆ†ä¸¤ä¸ªä¸ç›¸åŒçš„å€¼ï¼Œæ¯”å¦‚ï¼Œ253 - 1 æ˜¯ä¸€ä¸ªå®‰å…¨æ•´æ•°ï¼Œå®ƒèƒ½è¢«ç²¾ç¡®è¡¨ç¤ºï¼Œåœ¨ä»»ä½• IEEE-754 èˆå…¥æ¨¡å¼ï¼ˆrounding modeï¼‰ä¸‹ï¼Œæ²¡æœ‰å…¶ä»–æ•´æ•°èˆå…¥ç»“æœä¸ºè¯¥æ•´æ•°ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œ253 å°±ä¸æ˜¯ä¸€ä¸ªå®‰å…¨æ•´æ•°ï¼Œå®ƒèƒ½å¤Ÿä½¿ç”¨ IEEE-754 è¡¨ç¤ºï¼Œä½†æ˜¯ 253 + 1 ä¸èƒ½ä½¿ç”¨ IEEE-754 ç›´æ¥è¡¨ç¤ºï¼Œåœ¨å°±è¿‘èˆå…¥ï¼ˆround-to-nearestï¼‰å’Œå‘é›¶èˆå…¥ä¸­ï¼Œä¼šè¢«èˆå…¥ä¸º 253ã€‚\n> Number.MAX_SAFE_INTEGER + 1 === Number.MAX_SAFE_INTEGER + 2 å°†å¾—åˆ° trueçš„ç»“æœï¼Œè€Œè¿™åœ¨æ•°å­¦ä¸Šæ˜¯é”™è¯¯çš„ã€‚\n> åŒæ · 105308320612483198 === 105308320612483200 ç»“æœä¹Ÿæ˜¯true\n\nint64 ç±»å‹çš„æ•°å€¼èŒƒå›´æ˜¯ -(2^63-1) åˆ° 2^63-1ã€‚ä½¿ç”¨int64 ç±»å‹json å¯¹äºè¶…å‡ºèŒƒå›´çš„æ•°å­—ï¼Œä¼šå‡ºç°è§£æé”™è¯¯çš„æƒ…å†µã€‚\n\n![](http://media.gusibi.mobi/json2.png)\n\n\nä¸€ä¸ªå»ºè®®ï¼šå¯¹äºå¤§æ•°å­—æ¥è¯´ï¼Œä½¿ç”¨str æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚æˆ–è€…ç”¨ç±»ä¼¼è¿™æ ·çš„ç»“æ„ï¼š\n\n```json\n{\"int\": 105308320612483198, \"int_str\": \"105308320612483198\"}\n```\n\nåœ¨json ä¸­ä½¿ç”¨çš„æ—¶å€™ ä½¿ç”¨ int_str å±æ€§ã€‚\n\n### python å¯¹json çš„å¤„ç†\n\npython ä¸­ int ç±»å‹å€¼è¿œè¿œè¶…è¿‡IEEE 754 ä¸­å®šä¹‰çš„åŒç²¾åº¦å€¼çš„èŒƒå›´ï¼Œæ‰€ä»¥å¯¹äºåœ¨pythonä¸­ä½¿ç”¨çš„jsonæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ”¾å¿ƒä½¿ç”¨ int64 ç±»å‹ï¼ˆpythonä¸­çš„long ï¼‰ã€‚ä½†æ˜¯å¦‚æœåºåˆ—åŒ–åçš„æ•°æ®è¦è¢«å…¶å®ƒè¯­è¨€çš„è§£æå™¨ï¼ˆæ¯”å¦‚ï¼šJavaScriptçš„è§£æå™¨ï¼‰è§£æçš„æ—¶å€™ï¼Œå°±è¦å½“å¿ƒæ•°å€¼æ˜¯ä¸æ˜¯è¶…å‡ºäº†å®‰å…¨æ•°çš„èŒƒå›´ã€‚å¦‚æœè¶…å‡ºï¼Œè¿™é‡Œæ¨èä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹æ¥ä»£æ›¿æ•°å€¼ç±»å‹ã€‚\n\n\n\n\n\n## å‚è€ƒé“¾æ¥\n\n* [RFC7159](https://tools.ietf.org/html/rfc7159.html)\n* [ä»‹ç»JSON](http://www.json.org/json-zh.html)\n* [IEEE 754](https://zh.wikipedia.org/zh-hans/IEEE_754)\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "ä¸ºä»€ä¹ˆjson ä¸èƒ½ä½¿ç”¨ int64ç±»å‹",
        "date": "2019-06-03 13:14:10",
        "tags": [
          "å‰ç«¯",
          "JavaScript",
          "development"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "why-json-not-support-int64"
    },
    {
      "content": "\n> `é—®é¢˜ï¼š`æœ‰ä¸€ä¸ªç³–æœå…¬å¸éœ€è¦è®¾è®¡ä¸€ä¸ªç³–æœå”®å–æœºï¼Œæ§åˆ¶æµç¨‹å¦‚ä¸‹å›¾ï¼Œéœ€è¦æ€ä¹ˆå®ç°ï¼Ÿ\n\n![1b0d0134acf9ab9b2240066f847412f1.png](http://media.gusibi.mobi/5aI8Zy9kkfNI8jzRA8VYMGrFpaGx30W6zSA3ZZAWN6AX0TWWb0SvlbKdJeWJpslF)\n\nè¿™æ˜¯ä¸€ä¸ªçŠ¶æ€å›¾ï¼Œæ¯ä¸ªåœ†åœˆéƒ½æ˜¯ä¸€ç§çŠ¶æ€ã€‚å¾ˆæ˜æ˜¾ï¼Œæœ‰`æœ‰25åˆ†é’±`ã€ `æ²¡æœ‰25åˆ†é’±`ã€ `å”®å‡ºç³–æœ`ã€ `ç³–æœå”®ç½„`**å››ä¸ªçŠ¶æ€**ï¼ŒåŒæ—¶ä¹Ÿå¯¹åº”**å››ä¸ªåŠ¨ä½œ**ï¼š`æŠ•å…¥25åˆ†é’±`ï¼Œ`é€€å›25åˆ†é’±`ï¼Œ`è½¬åŠ¨æ›²æŸ„`å’Œ`å‘æ”¾ç³–æœ`ã€‚\n\né‚£å¦‚ä½•ä»çŠ¶æ€å›¾å¾—åˆ°çœŸæ­£çš„ä»£ç å‘¢ï¼Ÿ\n\nç®€å•ä»£ç å®ç°å¦‚ä¸‹ï¼š\n\n```python\n#! -*- coding: utf-8 -*-\n\nclass GumballMachine:\n\n    # æ‰¾å‡ºæ‰€æœ‰çŠ¶æ€ï¼Œå¹¶åˆ›å»ºå®ä¾‹å˜é‡æ¥æŒæœ‰å½“å‰çŠ¶æ€ï¼Œç„¶åå®šä¹‰çŠ¶æ€çš„å€¼\n    STATE_SOLD_OUT = 0\n    STATE_NO_QUARTER = 1\n    STATE_HAS_QUARTER = 2\n    STATE_SOLD = 3\n\n    state = STATE_SOLD_OUT\n\n    def __init__(self, count=0):\n        self.count = count\n        if count > 0:\n            self.state = self.STATE_NO_QUARTER\n\n    def __str__(self):\n        return \"Gumball machine current state: %s\" % self.state\n\n    def insert_quarter(self):\n        # æŠ•å…¥25åˆ†é’±\n        if self.state == self.STATE_HAS_QUARTER: # å¦‚æœå·²ç»æŠ•è¿‡\n            print(\"You can't insert another quarter\")\n        elif self.state == self.STATE_NO_QUARTER: # å¦‚æœæ²¡æœ‰æŠ•è¿‡\n            self.state = self.STATE_HAS_QUARTER\n            print(\"You inserted a quarter\")\n        elif self.state == self.STATE_SOLD_OUT: # å¦‚æœå·²ç»å”®ç½„\n            print(\"You can't insert a quarter, the machine is sold out\")\n        elif self.state == self.STATE_SOLD: # å¦‚æœåˆšåˆšä¹°äº†ç³–æœ\n            print(\"Please wait, we're already giving you a gumball\")\n\n    def eject_quarter(self):\n        # é€€å›25åˆ†\n        if self.state == self.STATE_HAS_QUARTER:\n            print(\"Quarter returned\")\n            self.state = self.STATE_NO_QUARTER\n        elif self.state == self.STATE_NO_QUARTER:\n            print(\"You haven't inserted a quarter\")\n        elif self.state == self.STATE_SOLD:\n            print(\"Sorry, you alread turned the crank\")\n        elif self.state == self.SOLD_OUT:\n            print(\"You can't eject, you haven't inserted\")\n\n    def turn_crank(self):\n        # è½¬åŠ¨æ›²æŸ„\n        if self.state == self.STATE_SOLD:\n            print(\"Turning twice doesn't get you another gumball\")\n        elif self.state == self.STATE_NO_QUARTER:\n            print(\"You turned but there's no quarter\")\n        elif self.state == self.STATE_SOLD_OUT:\n            print(\"You turned, but there are no gumballs\")\n        elif self.state == self.STATE_HAS_QUARTER:\n            print(\"You turned...\")\n            self.state = self.STATE_SOLD\n            self.dispense()\n    \n    def dispense(self):\n        # å‘æ”¾ç³–æœ\n        if self.state == self.STATE_SOLD:\n            print(\"A gumball comes rolling out the slot\")\n            self.count -= 1\n            if self.count == 0:\n                self.state = self.STATE_SOLD_OUT\n            else:\n                self.state = self.STATE_NO_QUARTER\n        elif self.state == self.STATE_NO_QUARTER:\n            print(\"You need to pay first\")\n        elif self.state == self.STATE_SOLD_OUT:\n            print(\"No gumball dispensed\")\n        elif self.state == self.STATE_HAS_QUARTER:\n            print(\"No gumball dispensed\")\n\n\nif __name__ == \"__main__\":\n    # ä»¥ä¸‹æ˜¯ä»£ç æµ‹è¯•\n    gumball_machine = GumballMachine(5) # è£…å…¥5 ä¸ªç³–æœ\n    print(gumball_machine)\n\n    gumball_machine.insert_quarter() # æŠ•å…¥25åˆ†é’±\n    gumball_machine.turn_crank() # è½¬åŠ¨æ›²æŸ„\n    print(gumball_machine)\n\n    gumball_machine.insert_quarter() #æŠ•å…¥25åˆ†é’±\n    gumball_machine.eject_quarter()  # é€€é’±\n    gumball_machine.turn_crank()     # è½¬åŠ¨æ›²æŸ„\n\n    print(gumball_machine)\n    \n    gumball_machine.insert_quarter() # æŠ•å…¥25åˆ†é’±\n    gumball_machine.turn_crank() # è½¬åŠ¨æ›²æŸ„ \n    gumball_machine.insert_quarter() # æŠ•å…¥25åˆ†é’± \n    gumball_machine.turn_crank()  # è½¬åŠ¨æ›²æŸ„\n    gumball_machine.eject_quarter() # é€€é’±\n\n    print(gumball_machine)\n```\n\nè¿™æ®µä»£ç æœ‰å‡ ä¸ªé—®é¢˜ï¼š\n\n1. æ²¡æœ‰éµå®ˆå¼€æ”¾-å…³é—­åŸåˆ™\n2. æ›´åƒæ˜¯é¢å‘è¿‡ç¨‹çš„è®¾è®¡\n3. çŠ¶æ€è½¬åŒ–è¢«åŸ‹è—åœ¨æ¡ä»¶è¯­å¥ä¸­\n4. æœªæ¥åŠ å…¥æ–°çš„éœ€æ±‚ï¼Œéœ€è¦æ”¹åŠ¨çš„è¾ƒå¤šï¼Œä¸æ˜“ç»´æŠ¤ï¼Œå¯èƒ½ä¼šå‡ºbug\n\n\nå¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿ\n\n> è€ƒè™‘**å°è£…å˜åŒ–**ï¼ŒæŠŠæ¯ä¸ªçŠ¶æ€çš„è¡Œä¸ºéƒ½æ”¾åœ¨å„è‡ªçš„ç±»ä¸­ï¼Œæ¯ä¸ªçŠ¶æ€åªè¦å®ç°è‡ªå·±çš„åŠ¨ä½œï¼Œç”¨åŠ å…¥æ–°ç±»çš„æ–¹å¼æ¥å®ç°æ–°çŠ¶æ€çš„åŠ å…¥ã€‚\n\n1. å®šä¹‰State çˆ¶ç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œç³–æœæœºçš„æ¯ä¸ªåŠ¨ä½œéƒ½æœ‰ä¸€ä¸ªåº”å¯¹çš„æ–¹æ³•\n2. ä¸ºæœºå™¨ä¸­çš„æ¯ä¸ªçŠ¶æ€å®ç°çŠ¶æ€ç±»ï¼Œè¿™äº›ç±»å°†è´Ÿè´£åœ¨å¯¹åº”çš„çŠ¶æ€ä¸‹è¿›è¡Œæœºå™¨çš„è¡Œä¸º\n3. æ‘†è„±æ—§çš„æ¡ä»¶ä»£ç ï¼Œå°†åŠ¨ä½œå§”æ‰˜åˆ°çŠ¶æ€ç±»\n\næ–°çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š\n\n```python\n#! -*- coding: utf-8 -*-\n\nclass State:\n    # å®šä¹‰stateåŸºç±»\n    def insert_quarter(self):\n        pass\n\n    def eject_quarter(self):\n        pass\n\n    def turn_crank(self):\n        pass\n\n    def dispense(self):\n        pass\n\n\nclass SoldOutState(State):\n    # ç»§æ‰¿State ç±»\n    def __init__(self, gumball_machine):\n        self.gumball_machine = gumball_machine\n\n    def __str__(self):\n        return \"sold_out\"\n\n    def insert_quarter(self):\n        print(\"You can't insert a quarter, the machine is sold out\")\n\n    def eject_quarter(self):\n        print(\"You can't eject, you haven't inserted a quarter yet\")\n\n    def turn_crank(self):\n        print(\"You turned, but ther are no gumballs\")\n\n    def dispense(self):\n        print(\"No gumball dispensed\")\n\n\nclass SoldState(State):\n    # ç»§æ‰¿State ç±»\n    def __init__(self, gumball_machine):\n        self.gumball_machine = gumball_machine\n\n    def __str__(self):\n        return \"sold\"\n\n    def insert_quarter(self):\n        print(\"Please wait, we're already giving you a gumball\")\n\n    def eject_quarter(self):\n        print(\"Sorry, you already turned the crank\")\n\n    def turn_crank(self):\n        print(\"Turning twice doesn't get you another gumball\")\n\n    def dispense(self):\n        self.gumball_machine.release_ball()\n        if gumball_machine.count > 0:\n            self.gumball_machine.state = self.gumball_machine.no_quarter_state\n        else:\n            print(\"Oops, out of gumballs!\")\n            self.gumball_machine.state = self.gumball_machine.soldout_state\n\n\nclass NoQuarterState(State):\n    # ç»§æ‰¿State ç±»\n    def __init__(self, gumball_machine):\n        self.gumball_machine = gumball_machine\n\n    def __str__(self):\n        return \"no_quarter\"\n\n    def insert_quarter(self):\n        # æŠ•å¸ å¹¶ä¸”æ”¹å˜çŠ¶æ€\n        print(\"You inserted a quarter\")\n        self.gumball_machine.state = self.gumball_machine.has_quarter_state\n\n    def eject_quarter(self):\n        print(\"You haven't insert a quarter\")\n\n    def turn_crank(self):\n        print(\"You turned, but there's no quarter\")\n\n    def dispense(self):\n        print(\"You need to pay first\")\n\n\nclass HasQuarterState(State):\n    # ç»§æ‰¿State ç±»\n    def __init__(self, gumball_machine):\n        self.gumball_machine = gumball_machine\n\n    def __str__(self):\n        return \"has_quarter\"\n\n    def insert_quarter(self):\n        print(\"You can't insert another quarter\")\n\n    def eject_quarter(self):\n        print(\"Quarter returned\")\n        self.gumball_machine.state = self.gumball_machine.no_quarter_state\n\n    def turn_crank(self):\n        print(\"You turned...\")\n        self.gumball_machine.state = self.gumball_machine.sold_state\n\n    def dispense(self):\n        print(\"No gumball dispensed\")\n\n\nclass GumballMachine:\n\n    def __init__(self, count=0):\n        self.count = count\n        # æ‰¾å‡ºæ‰€æœ‰çŠ¶æ€ï¼Œå¹¶åˆ›å»ºå®ä¾‹å˜é‡æ¥æŒæœ‰å½“å‰çŠ¶æ€ï¼Œç„¶åå®šä¹‰çŠ¶æ€çš„å€¼\n        self.soldout_state = SoldOutState(self)\n        self.no_quarter_state = NoQuarterState(self)\n        self.has_quarter_state = HasQuarterState(self)\n        self.sold_state = SoldState(self)\n        if count > 0:\n            self.state = self.no_quarter_state\n        else:\n            self.state = self.soldout_state\n\n    def __str__(self):\n        return \">>> Gumball machine current state: %s\" % self.state\n\n    def insert_quarter(self):\n        # æŠ•å…¥25åˆ†é’±\n        self.state.insert_quarter()\n\n    def eject_quarter(self):\n        # é€€å›25åˆ†\n        self.state.eject_quarter()\n        # print(\"state\", self.state, type(self.state))\n\n    def turn_crank(self):\n        # è½¬åŠ¨æ›²æŸ„\n        # print(\"state\", self.state, type(self.state))\n        self.state.turn_crank()\n\t    self.state.dispense()\n    \n    def release_ball(self):\n        # å‘æ”¾ç³–æœ\n        print(\"A gumball comes rolling out the slot...\")\n        if self.count > 0:\n            self.count -= 1\n        \n        \nif __name__ == \"__main__\":\n    # ä»¥ä¸‹æ˜¯ä»£ç æµ‹è¯•\n    gumball_machine = GumballMachine(5) # è£…å…¥5 ä¸ªç³–æœ\n    print(gumball_machine)\n\n    gumball_machine.insert_quarter() # æŠ•å…¥25åˆ†é’±\n    gumball_machine.turn_crank() # è½¬åŠ¨æ›²æŸ„\n    print(gumball_machine)\n\n    gumball_machine.insert_quarter() #æŠ•å…¥25åˆ†é’±\n    gumball_machine.eject_quarter()  # é€€é’±\n    gumball_machine.turn_crank()     # è½¬åŠ¨æ›²æŸ„\n\n    print(gumball_machine)\n    \n    gumball_machine.insert_quarter() # æŠ•å…¥25åˆ†é’±\n    gumball_machine.turn_crank() # è½¬åŠ¨æ›²æŸ„ \n    gumball_machine.insert_quarter() # æŠ•å…¥25åˆ†é’± \n    gumball_machine.turn_crank()  # è½¬åŠ¨æ›²æŸ„\n    gumball_machine.eject_quarter() # é€€é’±\n\n    print(gumball_machine)\n```\n\né‡æ„åçš„ä»£ç ç›¸å¯¹äºä¹‹å‰çš„ä»£ç åšäº†å“ªäº›äº‹æƒ…å‘¢ï¼Ÿ\n\n1. å°†æ¯ä¸ªçŠ¶æ€çš„è¡Œä¸ºå±€éƒ¨è¯åˆ°è‡ªå·±çš„ç±»ä¸­\n2. åˆ é™¤if è¯­å¥\n3. å°†`çŠ¶æ€ç±»`å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹ç³–æœå­£ç±»å¯¹`æ‰©å±•å¼€æ”¾`\n\nä¸‹å›¾æ˜¯åˆšåˆå§‹çŠ¶æ€å›¾ç¤ºï¼š\n\n![](http://media.gusibi.mobi/JR9i8dFfJU6cVB2NGvZh0BtL8IwXfODdcURvHOl-VI_L805iSpbq3p0heRCN5BIm)\n\nä¸Šé¢é‡æ„éƒ¨åˆ†ä»£ç ä½¿ç”¨çš„å°±æ˜¯çŠ¶æ€æ¨¡å¼ï¼š\n\n### å®šä¹‰\n\n> `çŠ¶æ€æ¨¡å¼`: çŠ¶æ€æ¨¡å¼å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚\n\nçŠ¶æ€æ¨¡å¼çš„ç±»å›¾å¦‚ä¸‹ï¼š\n\n![](http://media.gusibi.mobi/_UOHaXfAO3xSgJJws_AoNGSDKWxCz6sD-N3xKvcY1hq_ZttIir68g9Ql295f8vED)\n\n> çŠ¶æ€æ¨¡å¼æ˜¯å°†å¤šä¸ªè¡Œä¸ºå°è£…åœ¨çŠ¶æ€å¯¹è±¡ä¸­ï¼Œ context çš„è¡Œä¸ºéšæ—¶å¯å§”æ‰˜åˆ°å…¶ä¸­ä¸€ä¸ªçŠ¶æ€ä¸­ã€‚å½“å‰çŠ¶æ€åœ¨ä¸åŒçš„çŠ¶æ€å¯¹è±¡ä¸­æ”¹å˜ï¼Œä»¥åæ˜ å‡ºcontext å†…éƒ¨çš„çŠ¶æ€ï¼Œcontext çš„è¡Œä¸ºä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚\n\n\n\n### æ‰©å±•\n\n> å¦‚æœï¼Œç°åœ¨è¦åœ¨è¿™å››ä¸ªçŠ¶æ€çš„åŸºç¡€ä¸Šå†åŠ ä¸€ä¸ªçŠ¶æ€ï¼ˆè´­ä¹°ç³–æœåï¼Œæœ‰10%çš„æ¦‚ç‡å†å¾—ä¸€ä¸ªï¼‰ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ\n\n\n```python\n# æ·»åŠ WinnerState ç±»ï¼Œåªæœ‰dispense æ–¹æ³•ä¸åŒï¼Œå¯ä»¥ä»SoldState ç±»ç»§æ‰¿\nclass WinnerState(SoldState):\n    \n    def __str__(self):\n        return \"winner\"\n\n    def dispense(self):\n        print(\"You're a WINNER! You get two gumballs for your quarter\")\n        self.gumball_machine.release_ball()\n        if gumball_machine.count == 0:\n            self.gumball_machine.state = self.gumball_machine.soldout_state\n        else:\n            self.gumball_machine.release_ball()\n            if gumball_machine.count > 0:\n                self.gumball_machine.state = self.gumball_machine.no_quarter_state\n            else:\n                print(\"Oops, out of gumballs!\")\n                self.gumball_machine.state = self.gumball_machine.soldout_state\n\n# ä¿®æ”¹turn_crank æ–¹æ³•\nclass HasQuarterState(State):\n    ...\n    def turn_crank(self):\n        print(\"You turned...\")\n        winner = random.randint(0, 9)\n        if winner == 4 and self.gumball_machine.count > 1: # å¦‚æœåº“å­˜å¤§äº 1 å¹¶ä¸”éšæœºæ•°ç­‰äº4ï¼ˆå¯ä»¥æ˜¯0åˆ°9ä»»æ„å€¼ï¼‰\n            self.gumball_machine.state = self.gumball_machine.winner_state\n        else:\n            self.gumball_machine.state = self.gumball_machine.sold_state\n\n\n# åœ¨ GumballMachine ä¸­åˆå§‹åŒ–\nclass GumballMachine:\n\n    def __init__(self, count=0):\n        self.count = count\n        # æ‰¾å‡ºæ‰€æœ‰çŠ¶æ€ï¼Œå¹¶åˆ›å»ºå®ä¾‹å˜é‡æ¥æŒæœ‰å½“å‰çŠ¶æ€ï¼Œç„¶åå®šä¹‰çŠ¶æ€çš„å€¼\n        ...\n        self.winner_state = WinnerState(self)\n        ...\n```\n\n### æ€»ç»“\n\n1. çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡ç»™äºˆå†…éƒ¨çŠ¶æ€è€Œæ‹¥æœ‰ä¸åŒçš„è¡Œä¸º\n2. çŠ¶æ€æ¨¡å¼ç”¨ç±»ä»£è¡¨çŠ¶æ€\n3. Context ä¼šå°†è¡Œä¸ºå§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡\n4. é€šè¿‡å°†æ¯çŠ¶æ€å°è£…è¿›ä¸€ä¸ªç±»ï¼ŒæŠŠæ”¹å˜å±€éƒ¨åŒ–\n5. çŠ¶æ€è£…æ¬¢å¯ä»¥ç”±State ç±»æˆ–Context ç±»æ§åˆ¶\n6. ä½¿ç”¨çŠ¶æ€æ¨¡å¼ä¼šå¢åŠ ç±»çš„æ•°ç›®\n7. çŠ¶æ€ç±»å¯ä»¥è¢«å¤šä¸ªContext å®ä¾‹å…±äº«\n\n------\n\n> æœ¬æ–‡ä¾‹å­æ¥è‡ªã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ã€‚\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![](http://media.gusibi.mobi/ah0mqMXMtdJb9Yj03suu-NGEyVRxyEuOIT5bXSv7ip5aqtHkiRjTTl8SMRMv3Qp5)\n",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-çŠ¶æ€æ¨¡å¼",
        "date": "2018-12-31 04:59:39",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-state-pattern"
    },
    {
      "content": "\né¦–å…ˆå…ˆä»‹ç»ä¸€ä¸‹å’–å•¡å’ŒèŒ¶çš„å†²æ³¡æ–¹æ³•ï¼š\n\n**èŒ¶**\n\n```\n1. æŠŠæ°´ç…®æ²¸\n2. ç”¨æ²¸æ°´æµ¸æ³¡èŒ¶å¶\n3. æŠŠèŒ¶æ”¾åˆ°æ¯å­é‡Œ\n```\n\n**å’–å•¡**\n\n```\n1. æŠŠæ°´ç…®æ²¸\n2. ç”¨æ²¸æ°´å†²æ³¡å’–å•¡\n3. æŠŠå’–å•¡å€’è¿›æ¯å­\n4. åŠ ç³–å’Œç‰›å¥¶\n```\n\nç”¨pythonä»£ç å®ç°å†²æ³¡æ–¹æ³•å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š\n\n```python\n# èŒ¶çš„åˆ¶ä½œæ–¹æ³•\nclass Tea:\n\n    def prepare_recipe(self):\n        # åœ¨ä¸‹è¾¹å®ç°å…·ä½“æ­¥éª¤\n        self.boil_water()\n        self.brew_tea_bag()\n        self.pour_in_cup()\n        \n    def boil_water(self):\n        print(\"Boiling water\")\n        \n    def brew_tea_bag(self):\n        print(\"Steeping the tea\")\n        \n    def pour_in_cup(self):\n        print(\"Pouring into cup\")\n```\n\n```python\n# å’–å•¡çš„åˆ¶ä½œæ–¹æ³•\nclass Coffee:\n\n    def prepare_recipe(self):\n        # åœ¨ä¸‹è¾¹å®ç°å…·ä½“æ­¥éª¤\n        self.boil_water()\n        self.brew_coffee_grinds()\n        self.pour_in_cup()\n        self.add_sugar_and_milk()\n        \n    def boil_water(self):\n        print(\"Boiling water\")\n        \n    def brew_coffee_grinds(self):\n        print(\"Dripping Coffee through filter\")\n        \n    def pour_in_cup(self):\n        print(\"Pouring into cup\")\n        \n    def add_sugar_and_milk(self):\n        print(\"Adding Sugar and Milk\")\n```\n\nä»”ç»†çœ‹ä¸Šè¾¹ä¸¤ç«¯ä»£ç ä¼šå‘ç°ï¼ŒèŒ¶å’Œå’–å•¡çš„å®ç°æ–¹å¼åŸºæœ¬ç±»ä¼¼ï¼Œéƒ½æœ‰`prepare_recipe`ï¼Œ`boil_water`ï¼Œ`pour_in_cup` è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚\n\n> `é—®é¢˜ï¼š`å¦‚ä½•é‡æ–°è®¾è®¡è¿™ä¸¤ä¸ªç±»æ¥è®©ä»£ç æ›´ç®€æ´å‘¢ï¼Ÿ\n\né¦–å…ˆçœ‹ä¸€ä¸‹ä¸¤ä¸ªç±»çš„ç±»å›¾ï¼š\n\n![2bd637fbc0532bd0bafbf861005fabd3.png](http://media.gusibi.mobi/jom4jOc8uWezDNwLSyqUYcOF5pXzLTh4ztvglMCIajscrtcrp3T5eyH7YnOgZbwD)\n\n1. æ¯ä¸ªç±»ä¸­éƒ½æœ‰ `prepare_recipe() boil_water() pour_in_cup()`æ–¹æ³•ã€‚\n2. æ¯ä¸ªç±»ä¸­`prepare_recipe()`æ–¹æ³•çš„å®ç°éƒ½ä¸ä¸€æ ·ã€‚\n\n\nç°åœ¨æŠŠ`prepare_recipe() boil_water() pour_in_cup()`ä¸‰ä¸ªæ–¹æ³•æŠ½å–å‡ºæ¥åšæˆä¸€ä¸ªçˆ¶ç±»`CoffeineBeverage()`ï¼Œ`Tea` å’Œ `Coffee` éƒ½ç»§è‡ª`CoffeineBeverage()`ã€‚\n\n\n![ce3e56409c313d4ce42e9878f3b5c8f4.png](http://media.gusibi.mobi/GTzGMHTGpxLF8o69DDykX4MCpkoy2Xf-uuGFWOIgARmWqv9xLnP5g74QKmgYf95d)\n\n> å› ä¸ºæ¯ä¸ªç±»ä¸­`prepare_recipe()`å®ç°çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œæ‰€ä»¥`Tea` å’Œ `Coffee` ç±»éƒ½åˆ†åˆ«å®ç°äº† `prepare_recipe()`ã€‚\n> `é—®é¢˜`: é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•å°†`prepare_recipe()`ä¹ŸæŠ½è±¡åŒ–ï¼Ÿ\n\n\n\nå¯¹æ¯” `Tea` å’Œ `Coffee` çš„`prepare_recipe()` æ–¹æ³•ä¼šå‘ç°ï¼Œä»–ä»¬ä¹‹é—´çš„å·®å¼‚ä¸»è¦æ˜¯ï¼š\n\n```python\n\ndef prepare_recipe(self):\n    # ç›¸åŒéƒ¨åˆ†éšè—\n    # self.boil_water()\n    self.brew_tea_bag()  # å·®å¼‚1\n    #self.pour_in_cup()\n        \ndef prepare_recipe(self):\n    # ç›¸åŒéƒ¨åˆ†éšè—\n    # self.boil_water()\n    self.brew_coffee_grinds() # å·®å¼‚1\n    # self.pour_in_cup()\n    self.add_sugar_and_milk() # å·®å¼‚2\n\n```\n\nè¿™é‡Œçš„å®ç°æ€è·¯æ˜¯ï¼Œå°†ä¸¤å¤„å·®å¼‚åˆ†åˆ«ç”¨æ–°çš„æ–¹æ³•åä»£æ›¿ï¼Œæ›¿æ¢åç»“æœå¦‚ä¸‹ï¼š\n\n```python\n\ndef prepare_recipe(self):\n    # æ–°çš„å®ç°æ–¹æ³•\n    self.boil_water()\n    self.brew() # å·®å¼‚1 ä½¿ç”¨brew ä»£æ›¿ brew_tea_bag å’Œ brew_coffee_grinds\n    self.pour_in_cup()\n    self.add_condiments() # å·®å¼‚2 Tea ä¸éœ€è¦æ­¤æ–¹æ³•ï¼Œå¯ä»¥ç”¨ç©ºçš„å®ç°ä»£æ›¿\n\n```\n\næ–°çš„ç±»å›¾å¦‚ä¸‹ï¼š\n\n![bff9cea3d8f8226b6a9bb29c1deb8d88.png](http://media.gusibi.mobi/Fqusr6qE_RUIHrwJIoNIvR64HEE8LSNWndLIz3gmtNXNqdGw0nJ12GR9-l4SvD7T)\n\nç°åœ¨ï¼Œç±» `Tea` å’Œ `Coffee` åªéœ€è¦å®ç°å…·ä½“çš„ `brew()`å’Œ `add_condiments()` æ–¹æ³•å³å¯ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š\n\n```python\n\nclass CoffeineBeverage:\n\n    def prepare_recipe(self):\n        # æ–°çš„å®ç°æ–¹æ³•\n        self.boil_water()\n        self.brew() \n        self.pour_in_cup()\n        self.add_condiments()\n        \n    def boil_water(self):\n        print(\"Boiling water\")\n        \n    def brew(self):\n        # éœ€è¦åœ¨å­ç±»å®ç°\n        raise NotImplementedError\n        \n    def pour_in_cup(self):\n        print(\"Pouring into cup\")\n        \n    def add_condiments(self):\n        # è¿™é‡Œå…¶å®æ˜¯ä¸ªé’©å­æ–¹æ³•ï¼Œå­ç±»å¯ä»¥è§†æƒ…å†µé€‰æ‹©æ˜¯å¦è¦†ç›–\n        # é’©å­æ–¹æ³•æ˜¯ä¸€ä¸ªå¯é€‰æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è®©é’©å­æ–¹æ³•ä½œä¸ºæŸäº›æ¡ä»¶è§¦å‘åçš„åŠ¨ä½œ\n        pass\n\n# èŒ¶çš„åˆ¶ä½œæ–¹æ³•\nclass Tea(CoffeineBeverage):\n        \n    def brew(self):\n        # çˆ¶ç±»ä¸­å£°æ˜äº† raise NotImplementedErrorï¼Œè¿™é‡Œå¿…é¡»è¦å®ç°æ­¤æ–¹æ³•\n        print(\"Steeping the tea\")\n        \n    # Tea ä¸éœ€è¦ add_condiments æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦å®ç°\n\n# å’–å•¡çš„åˆ¶ä½œæ–¹æ³•\nclass Coffee(CoffeineBeverage):\n        \n    def brew(self):\n        # çˆ¶ç±»ä¸­å£°æ˜äº† raise NotImplementedErrorï¼Œè¿™é‡Œå¿…é¡»è¦å®ç°æ­¤æ–¹æ³•\n        print(\"Dripping Coffee through filter\")\n        \n    def add_condiments(self):\n        print(\"Adding Sugar and Milk\")\n```\n\n### æ¨¡æ¿æ–¹æ³•\n\n\nä¸Šè¿°æŠ½è±¡è¿‡ç¨‹ä½¿ç”¨çš„å°±æ˜¯æ¨¡æ¿æ–¹æ³•ã€‚æ¨¡æ¿æ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„æ­¥éª¤ï¼Œå¹¶ä¸”å…è®¸å­ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å®ç°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`prepare_recipe` å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚\n\n> `å®šä¹‰ï¼š`æ¨¡æ¿æ–¹æ³•ç‰§å¸ˆåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤ã€‚\n\n#### ä¼˜ç‚¹\n\n1. ä½¿ç”¨æ¨¡æ¿æ–¹æ³•å¯ä»¥å°†ä»£ç çš„å¤ç”¨æœ€å¤§åŒ–\n2. å­ç±»åªéœ€è¦å®ç°è‡ªå·±çš„æ–¹æ³•ï¼Œå°†ç®—æ³•å’Œå®ç°çš„è€¦åˆé™ä½ã€‚\n\n\n#### å¥½è±ååŸåˆ™\n\næ¨¡æ¿æ–¹æ³•ä½¿ç”¨åˆ°äº†ä¸€ä¸ªåŸåˆ™ï¼Œ`å¥½è±ååŸåˆ™`ã€‚\n\n> `å¥½è±ååŸåˆ™`ï¼Œåˆ«è°ƒç”¨æˆ‘ï¼Œæˆ‘ä¼šè°ƒç”¨ä½ ã€‚\n\n![å¥½è±ååŸåˆ™](http://media.gusibi.mobi/F62XbVcTYD9i-4swfqL5_sgS8SYXCfyB_2h2pEJq2BIZ8LikiEF2Yulq3HIxvISz)\nåœ¨è¿™ä¸ªåŸåˆ™ä¹‹ä¸‹ï¼Œå…è®¸ä½å±‚ç»„ä»¶å°†è‡ªå·±æŒ‚é’©åˆ°ç³»ç»Ÿä¸Šï¼Œä½†æ˜¯ç”±é«˜å±‚ç»„ä»¶æ¥å†³å®šä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™äº›ä½å±‚ç»„ä»¶ã€‚\n\nåœ¨ä¸Šè¾¹çš„ä¾‹å­ä¸­ï¼ŒCoffeineBeverage æ˜¯é«˜å±‚ç»„ä»¶ï¼ŒCoffeeå’ŒTea æ˜¯ä½å±‚ç»„ä»¶ï¼Œä»–ä»¬ä¸ä¼šä¹‹é—´è°ƒç”¨æŠ½è±¡ç±»ï¼ˆCoffeineBeverageï¼‰ã€‚\n\n\n### ä¸€ä¸ªä¾‹å­ğŸŒ°\n\nPython ç¬¬ä¸‰æ–¹è¡¨å•éªŒè¯åŒ… wtforms çš„è¡¨å•éªŒè¯éƒ¨åˆ†å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚Field ç±»ä¸­`validate`æ–¹æ³•å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨ `pre_validate`ï¼Œ `_run_validation_chain`ï¼Œ`post_validate`æ–¹æ³•æ¥éªŒè¯è¡¨å•ï¼Œè¿™äº›æ–¹æ³•ä¹Ÿéƒ½å¯ä»¥åœ¨å­ç±»ä¸­é‡æ–°å®ç°ã€‚å…·ä½“å®ç°å¯ä»¥å‚è€ƒä»¥ä¸‹æºç ã€‚\n\næºç åœ°å€ï¼š[https://github.com/wtforms/wtforms/blob/master/src/wtforms/fields/core.py](https://github.com/wtforms/wtforms/blob/master/src/wtforms/fields/core.py#L225)\n\n## å‚è€ƒé“¾æ¥\n* [https://github.com/wtforms/wtforms/blob/master/src/wtforms/fields/core.py](https://github.com/wtforms/wtforms/blob/master/src/wtforms/fields/core.py#L225)\n\n------\n> æœ¬æ–‡ä¾‹å­æ¥è‡ªã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![](http://media.gusibi.mobi/ah0mqMXMtdJb9Yj03suu-NGEyVRxyEuOIT5bXSv7ip5aqtHkiRjTTl8SMRMv3Qp5)\n",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼",
        "date": "2018-12-02 09:23:56",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-template-pattern"
    },
    {
      "content": "\nä¸Šä¸€ç¯‡[ã€Špythonè®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼ã€‹](https://mp.weixin.qq.com/s/69j6WbV_NoSumRuLj_gGug)ä»‹ç»äº†å¦‚ä½•å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªç¬¦åˆæœŸæœ›çš„æ¥å£ã€‚è¿™ä¸€ç¯‡å°†è¦ä»‹ç»éœ€è¦ä¸€ä¸ªä¸ºäº†ç®€åŒ–æ¥å£è€Œæ”¹å˜æ¥å£çš„æ–°æ¨¡å¼-å¤–è§‚æ¨¡å¼ï¼ˆFacade-Patternï¼‰ã€‚\n\n### é—®é¢˜\n\n> `é—®é¢˜`ï¼šå¦‚æœä½ ç»„è£…äº†ä¸€å¥—å®¶åº­å½±é™¢ï¼Œå†…å«æ’­æ”¾å™¨ã€æŠ•å½±æœºã€è‡ªåŠ¨å±å¹•ã€ç«‹ä½“å£°éŸ³å“ã€çˆ†ç±³èŠ±æœºç­‰ã€‚å¦‚ä½•è®¾è®¡ä¸€ä¸ªé¥æ§å™¨ï¼Œå¯ä»¥ç®€å•çš„æ“ä½œè¿™ä¸ªç³»ç»Ÿä¸­çš„å„ä¸ªç»„ä»¶å‘¢ï¼Ÿ\n\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹æœ€ç¬¨æ–¹å¼è§‚èµç”µå½±çš„æ­¥éª¤ï¼š\n\n1. æ‰“å¼€çˆ†ç±³èŠ±æœº\n2. å¼€å§‹çˆ†ç±³èŠ±\n3. å°†ç¯å…‰è°ƒæš—\n4. æ”¾ä¸‹å±å¹•\n5. æ‰“å¼€æŠ•å½±ä»ª\n6. å°†æŠ•å½±æœºçš„è¾“å…¥åˆ‡æ¢åˆ°æ’­æ”¾å™¨\n7. å°†æŠ•å½±åŠè®¾ç½®åœ¨å®½å±æ¨¡å¼\n8. æ‰“å¼€åŠŸæ”¾\n9. å°†åŠŸæ”¾çš„è¾“å…¥è®¾ç½®ä¸ºæ’­æ”¾å™¨\n10. å°†æ”»é˜²è®¾ç½®ä¸ºç¯ç»•ç«‹ä½“å£°\n11. å°†æ”»é˜²éŸ³é‡è°ƒåˆ°é€‚ä¸­\n12. æ‰“å¼€æ’­æ”¾å™¨\n13. æ’­æ”¾ç”µå½±\n\nå†™æˆç±»å’Œæ–¹æ³•çš„è°ƒç”¨å¤§æ¦‚æ˜¯ä»¥ä¸‹çš„æ ·å­ï¼š\n\n\n```python\n\n# æ‰“å¼€çˆ†ç±³èŠ±æœºï¼Œå¼€å§‹çˆ†ç±³èŠ±\npoper.on()\npoper.pop()\n# ç¯å…‰è°ƒæš—\nlights.dim(10)\n\n# æ”¾ä¸‹å±å¹•\nscreen.down()\n\n# æ‰“å¼€æŠ•å½±ä»ªï¼Œè®¾ç½®ä¸ºå®½å±æ¨¡å¼\nprojector.on()\nprojector.setInput(dvd)\nprojector.wideScreenMode()\n\n# æ‰“å¼€åŠŸæ”¾ è®¾ç½®ä¸ºDVD è°ƒæ•´æˆç¯ç»•ç«‹ä½“å£°æ¨¡å¼ï¼ŒéŸ³é‡è°ƒåˆ°5\namp.on()\namp.setDvd(dvd)\namp.setSurroundSound()\namp.setVolume(5)\n\n# æ‰“å¼€dvd æ’­æ”¾å™¨\ndvd.on()\ndvd.play(movie)\n```\n\nå¯ä»¥çœ‹åˆ°ä»£ç ä¸­æ¶‰åŠåˆ°6ä¸ªä¸åŒçš„ç±»ï¼Œè€Œä¸”ç”µå½±çœ‹å®Œåè¿˜éœ€è¦å›é€€ï¼Œä¸€åˆ‡éƒ½è¦å†åç€é‡æ¥ä¸€éã€‚æ€æ ·ç®€åŒ–ä¸€ä¸‹æ“ä½œå‘¢ï¼Ÿ\nç°åœ¨ï¼Œå¤–è§‚æ¨¡å¼å°±å¯ä»¥å¤§å±•èº«æ‰‹äº†ã€‚\n> ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡å®ç°ä¸€ä¸ªæä¾›æ›´åˆç†çš„æ¥å£çš„å¤–è§‚ç±»ï¼Œå°†å­ç³»ç»Ÿå˜å¾—æ›´å®¹æ˜“ä½¿ç”¨ã€‚å½“ç„¶ï¼ŒåŸæ¥çš„æ¥å£è¿˜åœ¨ã€‚\n\n### è§£å†³æ–¹æ³•\n\n**å…ˆæ¥çœ‹ä¸€ä¸‹å¤–è§‚æ¨¡å¼å¦‚ä½•è¿ä½œ**\n\n![å¤–è§‚æ¨¡å¼ç±»å›¾](http://media.gusibi.mobi/gqxnhAKcJZ7wYLGuWwls8NkjFUsAqou-lwHvR7I9Jrhk5sXtQv6xAqhqMnbO2ITW)\n\n1. è¿™é‡Œä¸ºå®¶åº­å½±é™¢ç³»ç»Ÿåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¤–è§‚ç±»`HomeTheaterFacade`ï¼Œè¿™ä¸ªç±»æš´éœ²å‡ºæ¥å‡ ä¸ªç®€å•çš„æ–¹æ³•ï¼Œæ¯”å¦‚`watchMovie`ï¼Œ`endMovie`ã€‚\n2. è¿™ä¸ªå¤–è§‚ç±»å°†å®¶åº­å½±é™¢çš„å¤šä¸ªç»„ä»¶çœ‹ä½œä¸€ä¸ªå­ç³»ç»Ÿï¼Œé€šè¿‡è°ƒç”¨è¿™ä¸ªå­ç³»ç»Ÿæ¥å®ç°`watchMovie`æ–¹æ³•ã€‚\n3. å¤–è§‚åªæä¾›äº†ä¸€ä¸ªæ›´ç›´æ¥çš„æ“ä½œæ–¹å¼ï¼Œå¹¶æ²¡æœ‰å°†åŸæ¥çš„å­ç³»ç»Ÿéš”ç¦»ï¼Œå­ç³»ç»Ÿçš„åŠŸèƒ½è¿˜å¯ä»¥ä½¿ç”¨\n\n\n> `æ³¨æ„ï¼š`\n> 1. å¯ä»¥æœ‰å¤šä¸ªå¤–è§‚\n> 2. å¤–è§‚æä¾›ç®€åŒ–çš„æ¥å£ï¼Œä½†ä¸éš”ç¦»å­ç³»ç»Ÿ\n> 3. å¤–è§‚å°†å®ç°ä»å­ç³»ç»Ÿä¸­è§£è€¦ï¼Œæ¯”å¦‚ï¼šç°åœ¨æœ‰ä¸ªå­ç³»ç»Ÿçš„ç»„ä»¶éœ€è¦å‡çº§æ¢ä»£ï¼Œåªéœ€è¦æŠŠå¤–è§‚ä»£ç åšç›¸åº”çš„ä¿®æ”¹å°±å¯ä»¥å®ç°\n> 4. å¤–è§‚å’Œé€‚é…å™¨éƒ½å¯ä»¥åŒ…è£…å¤šä¸ªç±»ï¼Œä½†æ˜¯`å¤–è§‚çš„æ„å›¾æ—¶ç®€åŒ–æ¥å£çš„è°ƒç”¨`ï¼Œè€Œ`é€‚é…å™¨çš„æ„å›¾æ˜¯å°†æ¥å£è½¬æ¢æˆä¸åŒçš„æ¥å£`ã€‚\n\n\n### ç¤ºä¾‹\n\n```python\n\nclass HomeTheaterFacade(object):\n\n    #å…ˆå£°æ˜éœ€è¦ç”¨çš„å­ç»„ä»¶\n    amp = Amplifier()\n    tuner = Tuner()\n    dvd = DvdPlayer()\n    cd = CdPlayer()\n    projector = Projector()\n    lights = TheaterLights()\n    screen = Screen()\n    popper = PopcornPopper()\n    \n    def watchMovie(self, movie):\n        # watchMovie å°†ä¹‹å‰éœ€è¦æ‰‹åŠ¨å¤„ç†çš„ä»»åŠ¡æ‰¹é‡å¤„ç†\n        print(\"Get ready to watch a movie...\")\n        # æ‰“å¼€çˆ†ç±³èŠ±æœºï¼Œå¼€å§‹çˆ†ç±³èŠ±\n        self.poper.on()\n        self.poper.pop()\n        # ç¯å…‰è°ƒæš—\n        self.lights.dim(10)\n\n        # æ”¾ä¸‹å±å¹•\n        self.screen.down()\n\n        # æ‰“å¼€æŠ•å½±ä»ªï¼Œè®¾ç½®ä¸ºå®½å±æ¨¡å¼\n        self.projector.on()\n        self.projector.setInput(dvd)\n        self.projector.wideScreenMode()\n\n        # æ‰“å¼€åŠŸæ”¾ è®¾ç½®ä¸ºDVD è°ƒæ•´æˆç¯ç»•ç«‹ä½“å£°æ¨¡å¼ï¼ŒéŸ³é‡è°ƒåˆ°5\n        self.amp.on()\n        self.amp.setDvd(dvd)\n        self.amp.setSurroundSound()\n        self.amp.setVolume(5)\n\n        # æ‰“å¼€dvd æ’­æ”¾å™¨\n        self.dvd.on()\n        self.dvd.play(movie)\n    \n    def endMovie(self):\n        # endMovie è´Ÿè´£å…³é—­ä¸€åˆ‡ï¼Œç”±å­ç³»ç»Ÿä¸­çš„ç»„ä»¶å®Œæˆ\n        print(\"Shutting movie theater down...\")\n        self.popper.off()\n        self.lights.on()\n        self.screen.up()\n        self.projector.off()\n        self.amp.off()\n        self.dvd.stop()\n        self.dvd.eject()\n        self.dvd.off()\n```\n\n##### ä»£ç ä½¿ç”¨\n\n```python\ndef main():\n    home_theater = HomeTheaterFacade() # å®ä¾‹åŒ–å¤–è§‚\n    home_theater.watchMovice() # ä½¿ç”¨ç®€åŒ–æ–¹æ³•å¼€å¯ å…³é—­ç”µå½±ÃŸ\n    home_theater.endMovice()\n```\n### å®šä¹‰\n\n> `å®šä¹‰ï¼š`å¤–è§‚æ¨¡å¼æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ã€‚å¤–è§‚å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚\n\n![å¤–è§‚æ¨¡å¼ç±»å›¾](http://media.gusibi.mobi/LTw5Md09LS2JDhLP5TKFay5jNCGUK93PgDVhpB3clEv-8RzKOfyOFCvLlIzn4D0V)\n\nä»ç±»å›¾ä¹Ÿå¯ä»¥äº†è§£åˆ°ï¼Œå¤–è§‚æ¨¡å¼çš„ä¸»è¦æ„å›¾æ˜¯æä¾›ä¸€ä¸ªæ›´ç®€å•æ˜“ç”¨çš„æ¥å£ã€‚\n\n\n#### æœ€å°‘çŸ¥è¯†åŸåˆ™ï¼ˆleast Knowledgeï¼‰\n\n`æœ€å°‘çŸ¥è¯†åŸåˆ™`çš„æ„æ€æ˜¯å‡å°‘å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œåªå’Œå‡ ä¸ªç‰¹å®šçš„å¯¹è±¡äº¤äº’ã€‚\n> è¿™ä¸ªåŸåˆ™æ˜¯å¸Œæœ›åœ¨è®¾è®¡ä¸­ï¼Œä¸è¦è€¦åˆå¤ªå¤šçš„ç±»ï¼Œä»¥å…ä¿®æ”¹ç³»ç»Ÿæ—¶ï¼Œä¼šå½±å“åˆ°å…¶å®ƒéƒ¨åˆ†ã€‚\n\næ¯”å¦‚ï¼šå¦‚æœæƒ³ä»DVDæ’­æ”¾å™¨è·å–éŸ³å“çš„éŸ³é‡ï¼Œå¯ä»¥åœ¨Dvdæ’­æ”¾å™¨ä¸­åŠ å…¥ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥åƒéŸ³å“è¯·æ±‚å½“å‰éŸ³é‡ï¼Œè€Œä¸æ˜¯å…ˆè¿”å›éŸ³å“å¯¹è±¡ï¼Œå†ä»éŸ³å“å¯¹è±¡è¿”å›éŸ³é‡ã€‚\n\n```python\n# ä¸å¥½çš„å®è·µ\ndef get_volume():\n    tuner = dvd.tuner()\n    return tuner.get_volume\n    \n\n# å¥½çš„å®è·µ\ndef get_volume():\n    # è¿™é‡Œè¦ç»™dvd å¯¹è±¡åŠ ä¸€ä¸ªget_volumeæ–¹æ³•\n    return dvd.get_volume\n```\n\n> `ç¼ºç‚¹ï¼š`è™½ç„¶è¿™ä¸ªåŸåˆ™å‡å°‘äº†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–ï¼Œä½†æ˜¯ä¹Ÿä¼šå¯¼è‡´æ›´å¤šçš„åŒ…è£…è¢«åˆ¶é€ å‡ºæ¥ï¼ˆæ¯”å¦‚ä¸Šè¾¹ä¾‹å­ä¸­ï¼Œå°±éœ€è¦ç»™`dvd åŠ ä¸€ä¸ª get_volume`æ–¹æ³•ï¼‰ï¼Œè¿™ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿæ›´å¤æ‚ã€‚\n\nå†å›é¡¾ä¸€ä¸‹å¤–è§‚æ¨¡å¼çš„ä¾‹å­ï¼Œä¼šå‘ç°å¤–è§‚æ¨¡å¼ç¬¦åˆ`æœ€å°‘çŸ¥è¯†åŸåˆ™`ï¼Œå®¢æˆ·ç«¯åªæœ‰`HomeTheaterFacade`è¿™ä¸€ä¸ªäº¤äº’å¯¹è±¡ã€‚å®ƒçš„å­˜åœ¨è®©ç³»ç»Ÿè°ƒç”¨å˜çš„æ›´ç®€å•ï¼Œå¹¶ä¸”å¦‚æœéœ€è¦å­ç³»ç»Ÿæœ‰æ¨¡å—éœ€è¦å‡çº§ï¼Œåªéœ€è¦ä¿®æ”¹`HomeTheaterFacade`è¿™ä¸ªç±»å°±å¯ä»¥å®Œæˆå‡çº§ã€‚\n\n------\n\n> æœ¬æ–‡ä¾‹å­æ¥è‡ªã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ã€‚\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![](http://media.gusibi.mobi/ah0mqMXMtdJb9Yj03suu-NGEyVRxyEuOIT5bXSv7ip5aqtHkiRjTTl8SMRMv3Qp5)\n",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-å¤–è§‚æ¨¡å¼",
        "date": "2018-11-25 09:23:56",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-facade-pattern"
    },
    {
      "content": "\n> `é—®é¢˜`ï¼šå‡è®¾æœ‰ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿï¼Œä½ å¸Œæœ›å®ƒèƒ½åœ¨ä¸æ”¹å˜ç°æœ‰ä»£ç çš„å‰æä¸‹å’Œä¸€ä¸ªæ–°çš„å‚å•†ç±»åº“æ­é…ä½¿ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªæ–°å‚å•†æ‰€è®¾è®¡å‡ºæ¥çš„æ¥å£ä¸åŒäºæ—§å‚å•†çš„æ¥å£\n\n![](http://media.gusibi.mobi/ggjMjkbHdiBnU8YUY0iNQe3I9XXxZ_OYE0o7uI2Gxw8CXzOP1_WyHjcVrbXiDvcc)\n\n**è¿™ä¸ªé—®é¢˜å’Œä¸‹å›¾çš„é—®é¢˜ç±»ä¼¼**\n\n![](http://media.gusibi.mobi/TWyhF3_0rCaiR4WVmmmVQN05VLUR0pVgbHL28bV4ce2Kim_i74yFICJDqEnoVi2L)\n\nç¾å›½æ ‡å‡†çš„æ’å¤´ğŸ”Œæ— æ³•åœ¨æ¬§æ´²æ ‡å‡†çš„æ’åº§ä¸Šä½¿ç”¨ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\n> æ·»åŠ ä¸€ä¸ªæ’å¤´é€‚é…å™¨ï¼Œé€‚é…å™¨çš„ä½œç”¨æ˜¯å°†æ¬§å¼æ’å¤´è½¬æ¢æˆç¾å¼æ’åº§ï¼Œä»¥ä¾¿äºè®©ç¾å¼æ’å¤´å¯ä»¥ä½¿ç”¨ã€‚\n\n### è§£å†³æ–¹æ¡ˆ\n\næ‰€ä»¥ï¼Œé¢å¯¹ä¸€ä¸ªæœ‰å…¨æ–°æ¥å£çš„ç±»åº“è€Œåˆä¸èƒ½æ”¹å˜ç°æœ‰ä»£ç æ—¶ï¼Œæœ€å…ˆæƒ³åˆ°çš„åšæ³•æ˜¯ï¼Œåœ¨è¿™ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´æ·»åŠ ä¸€ä¸ªé€‚é…å™¨ã€‚\n\n![](http://media.gusibi.mobi/VxXkkbIoWmKptVX2qSd_WNGrO2KdVgnrmMpe_sPdhuMk6xeVqLnJd3TN2qTY7k1q)\n\n### ç®€å•çš„ä¾‹å­\n\n> æœ‰ä¸€ä¸ªç³»ç»Ÿï¼Œéœ€è¦ä¸€ä¸ªé¸­å­ğŸ¦†å¯¹è±¡ï¼Œä½†æ˜¯ç°åœ¨åªæœ‰ä¸€ä¸ªç«é¸¡ğŸ¦ƒå¯¹è±¡ã€‚é¸­å­å’Œç«é¸¡å¯¹è±¡çš„åŠŸèƒ½ç®€å•æè¿°å¦‚ä¸‹ï¼š\n\n```python\n\n# é¸­å­çš„ç®€å•æè¿°\nclass Duck:\n    def quack(self):\n        # ä¼šå‘±å‘±å«\n        print(\"Quack\")\n    \n    def fly(self):\n        # é£çš„èƒ½åŠ›\n        print(\"I'm flying\")\n        \n# ç«é¸¡çš„ç®€å•æè¿°\nclass Turkey:\n    def gobble(self):\n        # ä¸ä¼šå‘±å‘±å«ï¼Œåªä¼šå’¯å’¯å«\n        print(\"Gobble gobble\")\n    \n    def fly(self):\n        # é£çš„èƒ½åŠ› ä½†æ˜¯é£ä¸è¿œ\n        print(\"I'm flying a short distance\")\n    \n```\n\nå› ä¸ºç°åœ¨æ²¡æœ‰é¸­å­å¯¹è±¡ï¼Œåªèƒ½é‚£ç«é¸¡å¯¹è±¡å†’å……ã€‚ç”±äºé¸­å­å¯¹è±¡å’Œç«é¸¡å¯¹è±¡åŠŸèƒ½ä¸åŒï¼Œä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨ï¼Œç°åœ¨å°±éœ€è¦ä½¿ç”¨é€‚é…å™¨æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼š\n\n```python\nclass TurkeyAdapter(Duck):\n    turkey = Turkey()  # è¿™é‡Œå®é™…ä½¿ç”¨çš„æ˜¯ç«é¸¡å¯¹è±¡\n    \n    # å®ç°é¸­å­å¯¹è±¡æ‹¥æœ‰çš„quackæ–¹æ³•\n    def quack(self):\n        self.turkey.gobble()\n    \n    def fly(self):\n        # å‡è®¾ç«é¸¡æ¯”é¸­å­é£çš„çŸ­ï¼Œä¸ºäº†æ¨¡æ‹Ÿé¸­å­çš„åŠ¨ä½œï¼Œå¤šé£å‡ æ¬¡\n        for i in range(5):\n            turkey.fly()\n```\n\næ¥ä¸‹æ¥è°ƒç”¨å°±å¯ä»¥åƒä½¿ç”¨é¸­å­å¯¹è±¡ä¸€æ ·ä½¿ç”¨ç«é¸¡é€‚é…åçš„å¯¹è±¡ã€‚\n\n```python\n# test\n\nduck = Duck()\nduck.quack()\nduck.fly()\n\nturkey_adapter = Duck()\nturkey_adapter.quack()\nturkey_adapter.fly()\n```\n\n**ç°åœ¨å†æ¥çœ‹ä¸€ä¸‹é€‚é…å™¨ä½¿ç”¨çš„è¿‡ç¨‹ï¼š**\n\n![](http://media.gusibi.mobi/Y5ID_UHcjlr0row8knQGM5vb8KNtRSlH_-6k-SrVOgvbAsE-iH7kweMC-mgvIGnM)\n\n1. å®¢æˆ·é€šè¿‡è¢«é€‚é…è€…å®ç°çš„æ¥å£è°ƒç”¨é€‚é…å™¨\n2. é€‚é…å™¨å°†è¯·æ±‚è½¬æ¢ä¸ºè¢«é€‚é…è€…å¯ä»¥å“åº”çš„è¯·æ±‚\n3. è¢«é€‚é…è€…å“åº”ï¼ŒæŠŠç»“æœè¿”å›ç»™é€‚é…å™¨ï¼Œç„¶åé€‚é…å™¨å†å°†ç»“æœå“åº”ç»™å®¢æˆ·ã€‚\n\né€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹é€‚é…å™¨æ¨¡å¼çš„æ­£å¼å®šä¹‰\n\n### å®šä¹‰\n\n> `é€‚é…å™¨æ¨¡å¼ï¼š`å°†ä¸€ä¸ªç±»çš„æ¥å£ï¼Œè½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨è®©åŸæœ¬æ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œã€‚\n\n#### ä¼˜ç‚¹\n\n* å¯ä»¥é€šè¿‡åˆ›å»ºé€‚é…å™¨è¿›è¡Œæ¥å£è½¬æ¢ï¼Œè®©ä¸å…¼å®¹çš„æ¥å£å…¼å®¹ï¼Œè®©å®¢æˆ·ä»å®ç°çš„æ¥å£çš„è§£è€¦ã€‚\n* ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œä»¥ä¿®æ”¹çš„æ¥å£åŒ…è£…è¢«é€‚é…è€…\n* è¢«é€‚é…çš„å­ç±»å¯ä»¥æ­é…ç€é€‚é…å™¨ä½¿ç”¨\n* æ»¡è¶³å¼€æ”¾/å°é—­åŸåˆ™ï¼ˆopen/close principleï¼‰\n\n> `å¼€æ”¾/å°é—­åŸåˆ™`æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ï¼Œå£°æ˜ä¸€ä¸ªè½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œå¯¹ä¿®æ”¹æ˜¯å…³é—­çš„ã€‚\n\n\n\n### çœŸå®ä¸–ç•Œä¸­çš„é€‚é…å™¨\n\n* xmltodict å¯ä»¥å°† xml è½¬æ¢ä¸º json\n* grpc ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§é€‚é…å™¨ï¼Œæä¾›äº†è·¨è¯­è¨€è°ƒç”¨èƒ½åŠ›\n* sqlalchemy å¯ä»¥åœ¨ä¸æ”¹å˜ä»£ç çš„æƒ…å†µä¸‹å¯¹æ¥å¤šç§æ•°æ®åº“\n\n\n> æœ¬æ–‡ä¾‹å­æ¥è‡ªã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ã€‚\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼",
        "date": "2018-11-03 13:23:56",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-adapter-pattern"
    },
    {
      "content": "\n>  Solidityæ˜¯ä»¥å¤ªåŠçš„ä¸»è¦ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€ç§é™æ€ç±»å‹çš„ JavaScript-esque è¯­è¨€ï¼Œæ˜¯é¢å‘åˆçº¦çš„ã€ä¸ºå®ç°æ™ºèƒ½åˆçº¦è€Œåˆ›å»ºçš„é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œè®¾è®¡çš„ç›®çš„æ˜¯èƒ½åœ¨ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ä¸Šè¿è¡Œã€‚\n>  \n>  `æœ¬æ–‡åŸºäºCryptoZombiesï¼Œæ•™ç¨‹åœ°å€ä¸ºï¼šhttps://cryptozombies.io/zh/lesson/2`\n\n\n### åœ°å€ï¼ˆaddressï¼‰\n\nä»¥å¤ªåŠåŒºå—é“¾ç”± account (è´¦æˆ·)ç»„æˆï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦æˆ·ã€‚ä¸€ä¸ªå¸æˆ·çš„ä½™é¢æ˜¯ä»¥å¤ª ï¼ˆåœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šä½¿ç”¨çš„å¸ç§ï¼‰ï¼Œä½ å¯ä»¥å’Œå…¶ä»–å¸æˆ·ä¹‹é—´æ”¯ä»˜å’Œæ¥å—ä»¥å¤ªå¸ï¼Œå°±åƒä½ çš„é“¶è¡Œå¸æˆ·å¯ä»¥ç”µæ±‡èµ„é‡‘åˆ°å…¶ä»–é“¶è¡Œå¸æˆ·ä¸€æ ·ã€‚\n\næ¯ä¸ªå¸æˆ·éƒ½æœ‰ä¸€ä¸ªâ€œåœ°å€â€ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦å·ã€‚è¿™æ˜¯è´¦æˆ·å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå®ƒçœ‹èµ·æ¥é•¿è¿™æ ·ï¼š\n\n```\n0x0cE446255506E92DF41614C46F1d6df9Cc969183\n```\n\n> è¿™æ˜¯ CryptoZombies å›¢é˜Ÿçš„åœ°å€ï¼Œä¸ºäº†è¡¨ç¤ºæ”¯æŒCryptoZombiesï¼Œå¯ä»¥èµèµä¸€äº›ä»¥å¤ªå¸ï¼\n\n\n`address`ï¼šåœ°å€ç±»å‹å­˜å‚¨ä¸€ä¸ª 20 å­—èŠ‚çš„å€¼ï¼ˆä»¥å¤ªåŠåœ°å€çš„å¤§å°ï¼‰ã€‚ åœ°å€ç±»å‹ä¹Ÿæœ‰æˆå‘˜å˜é‡ï¼Œå¹¶ä½œä¸ºæ‰€æœ‰åˆçº¦çš„åŸºç¡€ã€‚\n\n\n> `address` ç±»å‹æ˜¯ä¸€ä¸ª160ä½çš„å€¼ï¼Œä¸”ä¸å…è®¸ä»»ä½•ç®—æ•°æ“ä½œã€‚è¿™ç§ç±»å‹é€‚åˆå­˜å‚¨åˆçº¦åœ°å€æˆ–å¤–éƒ¨äººå‘˜çš„å¯†é’¥å¯¹ã€‚\n\n\n\n\n### æ˜ å°„ï¼ˆmappingï¼‰\n\n>  Mappings å’Œ[å“ˆå¸Œè¡¨](https://en.wikipedia.org/wiki/Hash_table)ç±»ä¼¼ï¼Œå®ƒä¼šæ‰§è¡Œè™šæ‹Ÿåˆå§‹åŒ–ï¼Œä»¥ä½¿æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„é”®éƒ½æ˜ å°„åˆ°ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºä¸ºå…¨é›¶çš„å€¼ã€‚\n\næ˜ å°„æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š\n\n```javascript\n//å¯¹äºé‡‘èåº”ç”¨ç¨‹åºï¼Œå°†ç”¨æˆ·çš„ä½™é¢ä¿å­˜åœ¨ä¸€ä¸ª uintç±»å‹çš„å˜é‡ä¸­ï¼š\nmapping (address => uint) public accountBalance;\n//æˆ–è€…å¯ä»¥ç”¨æ¥é€šè¿‡userId å­˜å‚¨/æŸ¥æ‰¾çš„ç”¨æˆ·å\nmapping (uint => string) userIdToName;\n```\n\næ˜ å°„æœ¬è´¨ä¸Šæ˜¯å­˜å‚¨å’ŒæŸ¥æ‰¾æ•°æ®æ‰€ç”¨çš„é”®-å€¼å¯¹ã€‚åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ª addressï¼Œå€¼æ˜¯ä¸€ä¸ª uintï¼Œåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ªuintï¼Œå€¼æ˜¯ä¸€ä¸ª stringã€‚\n\n> æ˜ å°„ç±»å‹åœ¨å£°æ˜æ—¶çš„å½¢å¼ä¸º mapping(_KeyType => _ValueType)ã€‚ å…¶ä¸­ _KeyType å¯ä»¥æ˜¯é™¤äº†æ˜ å°„ã€å˜é•¿æ•°ç»„ã€åˆçº¦ã€æšä¸¾ä»¥åŠç»“æ„ä½“ä»¥å¤–çš„å‡ ä¹æ‰€æœ‰ç±»å‹ã€‚ _ValueType å¯ä»¥æ˜¯åŒ…æ‹¬æ˜ å°„ç±»å‹åœ¨å†…çš„ä»»ä½•ç±»å‹ã€‚\n\nå¯¹æ˜ å°„çš„å–å€¼æ“ä½œå¦‚ä¸‹ï¼š\n\n```javascript\nuserIdToName[12]\n// å¦‚æœé”®12 ä¸åœ¨ æ˜ å°„ä¸­ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯0\n```\n\n\n> æ˜ å°„ä¸­ï¼Œå®é™…ä¸Šå¹¶ä¸å­˜å‚¨ keyï¼Œè€Œæ˜¯å­˜å‚¨å®ƒçš„ keccak256 å“ˆå¸Œå€¼ï¼Œä»è€Œä¾¿äºæŸ¥è¯¢å®é™…çš„å€¼ã€‚æ‰€ä»¥**æ˜ å°„æ˜¯æ²¡æœ‰é•¿åº¦çš„ï¼Œä¹Ÿæ²¡æœ‰ key çš„é›†åˆæˆ– value çš„é›†åˆçš„æ¦‚å¿µã€‚**ï¼Œä½ ä¸èƒ½åƒæ“ä½œ`python`å­—å…¸é‚£åº”è¯¥è·å–åˆ°å½“å‰ Mappings çš„æ‰€æœ‰é”®æˆ–è€…å€¼ã€‚\n\n\n### ç‰¹æ®Šå˜é‡\n\nåœ¨ Solidity ä¸­ï¼Œåœ¨å…¨å±€å‘½åç©ºé—´ä¸­å·²ç»å­˜åœ¨äº†ï¼ˆé¢„è®¾äº†ï¼‰ä¸€äº›ç‰¹æ®Šçš„å˜é‡å’Œå‡½æ•°ï¼Œä»–ä»¬ä¸»è¦ç”¨æ¥æä¾›å…³äºåŒºå—é“¾çš„ä¿¡æ¯æˆ–ä¸€äº›é€šç”¨çš„å·¥å…·å‡½æ•°ã€‚\n\n#### msg.sender\n\n msg.senderæŒ‡çš„æ˜¯å½“å‰è°ƒç”¨è€…ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ addressã€‚\n\n> æ³¨æ„ï¼šåœ¨ Solidity ä¸­ï¼ŒåŠŸèƒ½æ‰§è¡Œå§‹ç»ˆéœ€è¦ä»å¤–éƒ¨è°ƒç”¨è€…å¼€å§‹ã€‚ ä¸€ä¸ªåˆçº¦åªä¼šåœ¨åŒºå—é“¾ä¸Šä»€ä¹ˆä¹Ÿä¸åšï¼Œé™¤éæœ‰äººè°ƒç”¨å…¶ä¸­çš„å‡½æ•°ã€‚æ‰€ä»¥å¯¹äºæ¯ä¸€ä¸ª**å¤–éƒ¨å‡½æ•°**è°ƒç”¨ï¼ŒåŒ…æ‹¬ msg.sender å’Œ msg.value åœ¨å†…æ‰€æœ‰ msg æˆå‘˜çš„å€¼éƒ½ä¼šå˜åŒ–ã€‚è¿™é‡ŒåŒ…æ‹¬å¯¹åº“å‡½æ•°çš„è°ƒç”¨ã€‚\n\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨ msg.sender æ¥æ›´æ–° mapping çš„ä¾‹å­ï¼š\n\n```javascript\nmapping (address => uint) favoriteNumber;\n\nfunction setMyNumber(uint _myNumber) public {\n  // æ›´æ–°æˆ‘ä»¬çš„ `favoriteNumber` æ˜ å°„æ¥å°† `_myNumber`å­˜å‚¨åœ¨ `msg.sender`åä¸‹\n  favoriteNumber[msg.sender] = _myNumber;\n  // å­˜å‚¨æ•°æ®è‡³æ˜ å°„çš„æ–¹æ³•å’Œå°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ç›¸ä¼¼\n}\n\nfunction whatIsMyNumber() public view returns (uint) {\n  // æ‹¿åˆ°å­˜å‚¨åœ¨è°ƒç”¨è€…åœ°å€åä¸‹çš„å€¼\n  // è‹¥è°ƒç”¨è€…è¿˜æ²¡è°ƒç”¨ setMyNumberï¼Œ åˆ™å€¼ä¸º `0`\n  return favoriteNumber[msg.sender];\n}\n```\n\nåœ¨è¿™ä¸ªå°å°çš„ä¾‹å­ä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ setMyNumber åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å­˜ä¸‹ä¸€ä¸ª uint å¹¶ä¸”ä¸ä»–ä»¬çš„åœ°å€ç›¸ç»‘å®šã€‚ ç„¶åï¼Œä»–ä»¬è°ƒç”¨ whatIsMyNumber å°±ä¼šè¿”å›ä»–ä»¬å­˜å‚¨çš„ uintã€‚\n\nä½¿ç”¨ msg.sender å¾ˆå®‰å…¨ï¼Œå› ä¸ºå®ƒå…·æœ‰ä»¥å¤ªåŠåŒºå—é“¾çš„å®‰å…¨ä¿éšœ â€”â€” é™¤éçªƒå–ä¸ä»¥å¤ªåŠåœ°å€ç›¸å…³è”çš„ç§é’¥ï¼Œå¦åˆ™æ˜¯æ²¡æœ‰åŠæ³•ä¿®æ”¹å…¶ä»–äººçš„æ•°æ®çš„ã€‚\n\nä»¥ä¸‹æ˜¯å…¶å®ƒçš„ä¸€äº›ç‰¹æ®Šå˜é‡ã€‚\n\n#### åŒºå—å’Œäº¤æ˜“å±æ€§\n\n- block.blockhash(uint blockNumber) returns (bytes32)ï¼šæŒ‡å®šåŒºå—çš„åŒºå—å“ˆå¸Œâ€”â€”ä»…å¯ç”¨äºæœ€æ–°çš„ 256 ä¸ªåŒºå—ä¸”ä¸åŒ…æ‹¬å½“å‰åŒºå—ï¼›è€Œ blocks ä» 0.4.22 ç‰ˆæœ¬å¼€å§‹å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œç”± blockhash(uint blockNumber) ä»£æ›¿\n- block.coinbase (address): æŒ–å‡ºå½“å‰åŒºå—çš„çŸ¿å·¥åœ°å€\n- block.difficulty (uint): å½“å‰åŒºå—éš¾åº¦\n- block.gaslimit (uint): å½“å‰åŒºå— gas é™é¢\n- block.number (uint): å½“å‰åŒºå—å·\n- block.timestamp (uint): è‡ª unix epoch èµ·å§‹å½“å‰åŒºå—ä»¥ç§’è®¡çš„æ—¶é—´æˆ³\n- gasleft() returns (uint256)ï¼šå‰©ä½™çš„ gas\n- msg.data (bytes): å®Œæ•´çš„ calldata\n- msg.gas (uint): å‰©ä½™ gas - è‡ª 0.4.21 ç‰ˆæœ¬å¼€å§‹å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œç”± gesleft() ä»£æ›¿\n- msg.sender (address): æ¶ˆæ¯å‘é€è€…ï¼ˆå½“å‰è°ƒç”¨ï¼‰\n- msg.sig (bytes4): calldata çš„å‰ 4 å­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°æ ‡è¯†ç¬¦ï¼‰\n- msg.value (uint): éšæ¶ˆæ¯å‘é€çš„ wei çš„æ•°é‡\n- now (uint): ç›®å‰åŒºå—æ—¶é—´æˆ³ï¼ˆblock.timestampï¼‰\n- tx.gasprice (uint): äº¤æ˜“çš„ gas ä»·æ ¼\n- tx.origin (address): äº¤æ˜“å‘èµ·è€…ï¼ˆå®Œå…¨çš„è°ƒç”¨é“¾ï¼‰\n\n\n### é”™è¯¯å¤„ç†\n\nSolidity ä½¿ç”¨çŠ¶æ€æ¢å¤å¼‚å¸¸æ¥å¤„ç†é”™è¯¯ã€‚è¿™ç§å¼‚å¸¸å°†æ’¤æ¶ˆå¯¹å½“å‰è°ƒç”¨ï¼ˆåŠå…¶æ‰€æœ‰å­è°ƒç”¨ï¼‰ä¸­çš„çŠ¶æ€æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ï¼Œå¹¶ä¸”è¿˜å‘è°ƒç”¨è€…æ ‡è®°é”™è¯¯ã€‚ \n\nå‡½æ•° `assert` å’Œ `require` å¯ç”¨äºæ£€æŸ¥æ¡ä»¶å¹¶åœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚\n\n* assert å‡½æ•°åªèƒ½ç”¨äºæµ‹è¯•å†…éƒ¨é”™è¯¯ï¼Œå¹¶æ£€æŸ¥éå˜é‡ã€‚ \n* require å‡½æ•°ç”¨äºç¡®è®¤æ¡ä»¶æœ‰æ•ˆæ€§ï¼Œä¾‹å¦‚è¾“å…¥å˜é‡ï¼Œæˆ–åˆçº¦çŠ¶æ€å˜é‡æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œæˆ–éªŒè¯å¤–éƒ¨åˆçº¦è°ƒç”¨è¿”å›çš„å€¼ã€‚\n\nè¿™é‡Œä¸»è¦ä»‹ç» `require`\n\nrequireä½¿å¾—å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“ä¸æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æŠ›å‡ºé”™è¯¯ï¼Œå¹¶åœæ­¢æ‰§è¡Œï¼š\n\n```javascript\nfunction sayHiToVitalik(string _name) public returns (string) {\n  // æ¯”è¾ƒ _name æ˜¯å¦ç­‰äº \"Vitalik\". å¦‚æœä¸æˆç«‹ï¼ŒæŠ›å‡ºå¼‚å¸¸å¹¶ç»ˆæ­¢ç¨‹åº\n  // (æ•²é»‘æ¿: Solidity å¹¶ä¸æ”¯æŒåŸç”Ÿçš„å­—ç¬¦ä¸²æ¯”è¾ƒ, æˆ‘ä»¬åªèƒ½é€šè¿‡æ¯”è¾ƒ\n  // ä¸¤å­—ç¬¦ä¸²çš„ keccak256 å“ˆå¸Œå€¼æ¥è¿›è¡Œåˆ¤æ–­)\n  require(keccak256(_name) == keccak256(\"Vitalik\"));\n  // å¦‚æœè¿”å› true, è¿è¡Œå¦‚ä¸‹è¯­å¥\n  return \"Hi!\";\n}\n```\n\nå¦‚æœä½ è¿™æ ·è°ƒç”¨å‡½æ•° `sayHiToVitalik(\"Vitalik\")` ,å®ƒä¼šè¿”å›â€œHiï¼â€ã€‚è€Œå¦‚æœè°ƒç”¨çš„æ—¶å€™ä½¿ç”¨äº†å…¶ä»–å‚æ•°ï¼Œå®ƒåˆ™ä¼šæŠ›å‡ºé”™è¯¯å¹¶åœæ­¢æ‰§è¡Œã€‚\n\nå› æ­¤ï¼Œåœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ä¹‹å‰ï¼Œç”¨ require éªŒè¯å‰ç½®æ¡ä»¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚\n\n> æ³¨æ„ï¼šåœ¨ Solidity ä¸­ï¼Œå…³é”®è¯æ”¾ç½®çš„é¡ºåºå¹¶ä¸é‡è¦\n\n```javascript\n// ä»¥ä¸‹ä¸¤ä¸ªè¯­å¥ç­‰æ•ˆ\nrequire(keccak256(_name) == keccak256(\"Vitalik\"));\nrequire(keccak256(\"Vitalik\") == keccak256(_name));\n```\n\n### å¤–/å†…éƒ¨å‡½æ•°\n\né™¤ public å’Œ private å±æ€§ä¹‹å¤–ï¼ŒSolidity è¿˜ä½¿ç”¨äº†å¦å¤–ä¸¤ä¸ªæè¿°å‡½æ•°å¯è§æ€§çš„ä¿®é¥°è¯ï¼šinternalï¼ˆå†…éƒ¨ï¼‰ å’Œ externalï¼ˆå¤–éƒ¨ï¼‰ã€‚\n\n`internal` å’Œ `private` ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œå¦‚æœæŸä¸ªåˆçº¦ç»§æ‰¿è‡ªå…¶çˆ¶åˆçº¦ï¼Œè¿™ä¸ªåˆçº¦å³å¯ä»¥è®¿é—®çˆ¶åˆçº¦ä¸­å®šä¹‰çš„`â€œå†…éƒ¨(internal)â€å‡½æ•°`ã€‚\n\n`external` ä¸`public` ç±»ä¼¼ï¼Œåªä¸è¿‡`external`å‡½æ•°åªèƒ½åœ¨åˆçº¦ä¹‹å¤–è°ƒç”¨ - å®ƒä»¬ä¸èƒ½è¢«åˆçº¦å†…çš„å…¶ä»–å‡½æ•°è°ƒç”¨ã€‚\n\nå£°æ˜å‡½æ•° internal æˆ– external ç±»å‹çš„è¯­æ³•ï¼Œä¸å£°æ˜ private å’Œ publicç±» å‹ç›¸åŒï¼š\n\n```javascript\ncontract Sandwich {\n  uint private sandwichesEaten = 0;\n\n  function eat() internal {\n    sandwichesEaten++;\n  }\n}\n\ncontract BLT is Sandwich {\n  uint private baconSandwichesEaten = 0;\n\n  function eatWithBacon() public returns (string) {\n    baconSandwichesEaten++;\n    // å› ä¸ºeat() æ˜¯internal çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨è¿™é‡Œè°ƒç”¨\n    eat();\n  }\n}\n```\n\nSolidity æœ‰ä¸¤ç§å‡½æ•°è°ƒç”¨ï¼ˆå†…éƒ¨è°ƒç”¨ä¸ä¼šäº§ç”Ÿå®é™…çš„ EVM è°ƒç”¨æˆ–ç§°ä¸º`æ¶ˆæ¯è°ƒç”¨`ï¼Œè€Œå¤–éƒ¨è°ƒç”¨åˆ™ä¼šäº§ç”Ÿä¸€ä¸ª EVM è°ƒç”¨ï¼‰ï¼Œ å‡½æ•°å’ŒçŠ¶æ€å˜é‡æœ‰å››ç§å¯è§æ€§ç±»å‹ã€‚ å‡½æ•°å¯ä»¥æŒ‡å®šä¸º external ï¼Œpublic ï¼Œinternal æˆ–è€… privateï¼Œé»˜è®¤æƒ…å†µä¸‹å‡½æ•°ç±»å‹ä¸º publicã€‚ å¯¹äºçŠ¶æ€å˜é‡ï¼Œä¸èƒ½è®¾ç½®ä¸º external ï¼Œé»˜è®¤æ˜¯ internal ã€‚\n\n* `external ï¼š`\nå¤–éƒ¨å‡½æ•°ä½œä¸ºåˆçº¦æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»å…¶ä»–åˆçº¦å’Œäº¤æ˜“ä¸­è°ƒç”¨ã€‚ ä¸€ä¸ªå¤–éƒ¨å‡½æ•° f ä¸èƒ½ä»å†…éƒ¨è°ƒç”¨ï¼ˆå³ f ä¸èµ·ä½œç”¨ï¼Œä½† this.f() å¯ä»¥ï¼‰ã€‚ å½“æ”¶åˆ°å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œå¤–éƒ¨å‡½æ•°æœ‰æ—¶å€™ä¼šæ›´æœ‰æ•ˆç‡ã€‚\n\n* `public ï¼š`\npublic å‡½æ•°æ˜¯åˆçº¦æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨å†…éƒ¨æˆ–é€šè¿‡æ¶ˆæ¯è°ƒç”¨ã€‚å¯¹äºå…¬å…±çŠ¶æ€å˜é‡ï¼Œ ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª getter å‡½æ•°ã€‚\n\n* `internal ï¼š`\nè¿™äº›å‡½æ•°å’ŒçŠ¶æ€å˜é‡åªèƒ½æ˜¯å†…éƒ¨è®¿é—®ï¼ˆå³ä»å½“å‰åˆçº¦å†…éƒ¨æˆ–ä»å®ƒæ´¾ç”Ÿçš„åˆçº¦è®¿é—®ï¼‰ï¼Œä¸ä½¿ç”¨ this è°ƒç”¨ã€‚\n\n* `private ï¼š`\nprivate å‡½æ•°å’ŒçŠ¶æ€å˜é‡ä»…åœ¨å½“å‰å®šä¹‰å®ƒä»¬çš„åˆçº¦ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æ´¾ç”Ÿåˆçº¦ä½¿ç”¨ã€‚\n\n> åˆçº¦ä¸­çš„æ‰€æœ‰å†…å®¹å¯¹å¤–éƒ¨è§‚å¯Ÿè€…éƒ½æ˜¯å¯è§çš„ã€‚è®¾ç½®ä¸€äº› private ç±»å‹åªèƒ½é˜»æ­¢å…¶ä»–åˆçº¦è®¿é—®å’Œä¿®æ”¹è¿™äº›ä¿¡æ¯ï¼Œ ä½†æ˜¯å¯¹äºåŒºå—é“¾å¤–çš„æ•´ä¸ªä¸–ç•Œå®ƒä»ç„¶æ˜¯å¯è§çš„ã€‚\n\n\nå¯è§æ€§æ ‡è¯†ç¬¦çš„å®šä¹‰ä½ç½®ï¼Œå¯¹äºçŠ¶æ€å˜é‡æ¥è¯´æ˜¯åœ¨ç±»å‹åé¢ï¼Œå¯¹äºå‡½æ•°æ˜¯åœ¨å‚æ•°åˆ—è¡¨å’Œè¿”å›å…³é”®å­—ä¸­é—´ã€‚\n\n```javascript\npragma solidity ^0.4.16;\n\ncontract C {\n    // å¯¹äºå‡½æ•°æ˜¯åœ¨å‚æ•°åˆ—è¡¨å’Œè¿”å›å…³é”®å­—ä¸­é—´ã€‚\n    function f(uint a) private pure returns (uint b) { return a + 1; }\n    function setData(uint a) internal { data = a; }\n    uint public data;  // å¯¹äºçŠ¶æ€å˜é‡æ¥è¯´æ˜¯åœ¨ç±»å‹åé¢\n}\n```\n\n### å‡½æ•°å¤šå€¼è¿”å›\n\nå’Œ python ç±»ä¼¼ï¼ŒSolidity å‡½æ•°æ”¯æŒå¤šå€¼è¿”å›ï¼Œæ¯”å¦‚ï¼š\n\n```javascript\n\nfunction multipleReturns() internal returns(uint a, uint b, uint c) {\n  return (1, 2, 3);\n}\n\nfunction processMultipleReturns() external {\n  uint a;\n  uint b;\n  uint c;\n  // è¿™æ ·æ¥åšæ‰¹é‡èµ‹å€¼:\n  (a, b, c) = multipleReturns();\n}\n\n// æˆ–è€…å¦‚æœæˆ‘ä»¬åªæƒ³è¿”å›å…¶ä¸­ä¸€ä¸ªå˜é‡:\nfunction getLastReturnValue() external {\n  uint c;\n  // å¯ä»¥å¯¹å…¶ä»–å­—æ®µç•™ç©º:\n  (,,c) = multipleReturns();\n}\n\n```\n\n> è¿™é‡Œç•™ç©ºå­—æ®µä½¿ç”¨`,`çš„æ–¹å¼å¤ªä¸ç›´è§‚äº†ï¼Œè¿˜ä¸å¦‚ python/go ä½¿ç”¨ä¸‹åˆ’çº¿`_`ä»£æ›¿æ— ç”¨å­—æ®µã€‚\n\n\n### Storageä¸Memory\n\nåœ¨ Solidity ä¸­ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥å­˜å‚¨å˜é‡ â€”â€” storage æˆ– memoryã€‚\n\nStorage å˜é‡æ˜¯æŒ‡æ°¸ä¹…å­˜å‚¨åœ¨åŒºå—é“¾ä¸­çš„å˜é‡ã€‚ Memory å˜é‡åˆ™æ˜¯ä¸´æ—¶çš„ï¼Œå½“å¤–éƒ¨å‡½æ•°å¯¹æŸåˆçº¦è°ƒç”¨å®Œæˆæ—¶ï¼Œå†…å­˜å‹å˜é‡å³è¢«ç§»é™¤ã€‚ ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆå­˜å‚¨åœ¨ä½ ç”µè„‘çš„ç¡¬ç›˜æˆ–æ˜¯RAMä¸­æ•°æ®çš„å…³ç³»ã€‚\n\n> storage å’Œ memory æ”¾åˆ°çŠ¶æ€å˜é‡åå‰è¾¹ï¼Œåœ¨ç±»å‹åè¾¹ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n> `å˜é‡ç±»å‹ <storage|memory> å˜é‡å`\n\nå¤§å¤šæ•°æ—¶å€™éƒ½ç”¨ä¸åˆ°è¿™äº›å…³é”®å­—ï¼Œé»˜è®¤æƒ…å†µä¸‹ Solidity ä¼šè‡ªåŠ¨å¤„ç†å®ƒä»¬ã€‚ çŠ¶æ€å˜é‡ï¼ˆåœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„å˜é‡ï¼‰é»˜è®¤ä¸ºâ€œå­˜å‚¨â€å½¢å¼ï¼Œå¹¶æ°¸ä¹…å†™å…¥åŒºå—é“¾ï¼›è€Œåœ¨å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯â€œå†…å­˜â€å‹çš„ï¼Œå®ƒä»¬å‡½æ•°è°ƒç”¨ç»“æŸåæ¶ˆå¤±ã€‚\n\nç„¶è€Œä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ‰‹åŠ¨å£°æ˜å­˜å‚¨ç±»å‹ï¼Œä¸»è¦ç”¨äºå¤„ç†å‡½æ•°å†…çš„ `ç»“æ„ä½“` å’Œ `æ•°ç»„` æ—¶ï¼š\n\n```javascript\ncontract SandwichFactory {\n  struct Sandwich {\n    string name;\n    string status;\n  }\n\n  Sandwich[] sandwiches;\n\n  function eatSandwich(uint _index) public {\n    // Sandwich mySandwich = sandwiches[_index];\n\n    // ^ çœ‹ä¸Šå»å¾ˆç›´æ¥ï¼Œä¸è¿‡ Solidity å°†ä¼šç»™å‡ºè­¦å‘Š\n    // å‘Šè¯‰ä½ åº”è¯¥æ˜ç¡®åœ¨è¿™é‡Œå®šä¹‰ `storage` æˆ–è€… `memory`ã€‚\n\n    // æ‰€ä»¥ä½ åº”è¯¥æ˜ç¡®å®šä¹‰ `storage`:\n    Sandwich storage mySandwich = sandwiches[_index];\n    // ...è¿™æ · `mySandwich` æ˜¯æŒ‡å‘ `sandwiches[_index]`çš„æŒ‡é’ˆ\n    // åœ¨å­˜å‚¨é‡Œï¼Œå¦å¤–...\n    mySandwich.status = \"Eaten!\";\n    // ...è¿™å°†æ°¸ä¹…æŠŠ `sandwiches[_index]` å˜ä¸ºåŒºå—é“¾ä¸Šçš„å­˜å‚¨\n\n    // å¦‚æœä½ åªæƒ³è¦ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯ä»¥ä½¿ç”¨`memory`:\n    Sandwich memory anotherSandwich = sandwiches[_index + 1];\n    // ...è¿™æ · `anotherSandwich` å°±ä»…ä»…æ˜¯ä¸€ä¸ªå†…å­˜é‡Œçš„å‰¯æœ¬äº†\n    // å¦å¤–\n    anotherSandwich.status = \"Eaten!\";\n    // ...å°†ä»…ä»…ä¿®æ”¹ä¸´æ—¶å˜é‡ï¼Œå¯¹ `sandwiches[_index + 1]` æ²¡æœ‰ä»»ä½•å½±å“\n    // ä¸è¿‡ä½ å¯ä»¥è¿™æ ·åš:\n    sandwiches[_index + 1] = anotherSandwich;\n    // ...å¦‚æœä½ æƒ³æŠŠå‰¯æœ¬çš„æ”¹åŠ¨ä¿å­˜å›åŒºå—é“¾å­˜å‚¨\n  }\n}\n```\n\nå¦‚æœä½ è¿˜æ²¡æœ‰å®Œå…¨ç†è§£ç©¶ç«Ÿåº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒ â€”â€” åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰ä½ ä½•æ—¶ä½¿ç”¨ storage æˆ–æ˜¯ memoryï¼Œå¹¶ä¸”å½“ä½ ä¸å¾—ä¸ä½¿ç”¨åˆ°è¿™äº›å…³é”®å­—çš„æ—¶å€™ï¼ŒSolidity ç¼–è¯‘å™¨ä¹Ÿå‘è­¦ç¤ºæé†’ä½ çš„ã€‚\n\nç°åœ¨ï¼Œåªè¦çŸ¥é“åœ¨æŸäº›åœºåˆä¸‹ä¹Ÿéœ€è¦ä½ æ˜¾å¼åœ°å£°æ˜ storage æˆ– memoryå°±å¤Ÿäº†ï¼\n\n\n\n### ç»§æ‰¿\n\n\nSolidity çš„ç»§æ‰¿å’Œ Python çš„ç»§æ‰¿ç›¸ä¼¼ï¼Œæ”¯æŒå¤šé‡ç»§æ‰¿ã€‚\nçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\n\n```javascript\ncontract Doge {\n  function catchphrase() public returns (string) {\n    return \"So Wow CryptoDoge\";\n  }\n}\n\ncontract BabyDoge is Doge {\n  function anotherCatchphrase() public returns (string) {\n    return \"Such Moon BabyDoge\";\n  }\n}\n\n// å¯ä»¥å¤šé‡ç»§æ‰¿ã€‚è¯·æ³¨æ„ï¼ŒDoge ä¹Ÿæ˜¯ BabyDoge çš„åŸºç±»ï¼Œ\n// ä½†åªæœ‰ä¸€ä¸ª Doge å®ä¾‹ï¼ˆå°±åƒ C++ ä¸­çš„è™šæ‹Ÿç»§æ‰¿ï¼‰ã€‚\ncontract BlackBabyDoge is Doge, BabyDoge {\n  function color() public returns (string) {\n    return \"Black\";\n  }\n}\n\n```\n\n`BabyDoge` ä» `Doge` é‚£é‡Œ `inheritsï¼ˆç»§æ‰¿)`è¿‡æ¥ã€‚ è¿™æ„å‘³ç€å½“ç¼–è¯‘å’Œéƒ¨ç½²äº† `BabyDoge`ï¼Œå®ƒå°†å¯ä»¥è®¿é—® catchphrase() å’Œ anotherCatchphrase()å’Œå…¶ä»–æˆ‘ä»¬åœ¨ Doge ä¸­å®šä¹‰çš„å…¶ä»–å…¬å…±å‡½æ•°ï¼ˆprivate å‡½æ•°ä¸å¯è®¿é—®ï¼‰ã€‚\n\nSolidityä½¿ç”¨ is ä»å¦ä¸€ä¸ªåˆçº¦æ´¾ç”Ÿã€‚æ´¾ç”Ÿåˆçº¦å¯ä»¥è®¿é—®æ‰€æœ‰éç§æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬å†…éƒ¨å‡½æ•°å’ŒçŠ¶æ€å˜é‡ï¼Œä½†æ— æ³•é€šè¿‡ `this` æ¥å¤–éƒ¨è®¿é—®ã€‚\n\n#### åŸºç±»æ„é€ å‡½æ•°çš„å‚æ•°\n\næ´¾ç”Ÿåˆçº¦éœ€è¦æä¾›åŸºç±»æ„é€ å‡½æ•°éœ€è¦çš„æ‰€æœ‰å‚æ•°ã€‚è¿™å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®Œæˆ:\n\n```javascript\npragma solidity ^0.4.0;\n\ncontract Base {\n    uint x;\n    // è¿™æ˜¯æ³¨å†Œ Base å’Œè®¾ç½®åç§°çš„æ„é€ å‡½æ•°ã€‚\n    function Base(uint _x) public { x = _x; }\n}\n\ncontract Derived is Base(7) {\n    function Derived(uint _y) Base(_y * _y) public {\n    }\n}\n\ncontract Derived1 is Base {\n    function Derived1(uint _y) Base(_y * _y) public {\n    }\n}\n```\nä¸€ç§æ–¹æ³•ç›´æ¥åœ¨ç»§æ‰¿åˆ—è¡¨ä¸­è°ƒç”¨åŸºç±»æ„é€ å‡½æ•°ï¼ˆ`is Base(7)`ï¼‰ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯åƒ `ä¿®é¥°å™¨ modifier` ä½¿ç”¨æ–¹æ³•ä¸€æ ·ï¼Œ ä½œä¸ºæ´¾ç”Ÿåˆçº¦æ„é€ å‡½æ•°å®šä¹‰å¤´çš„ä¸€éƒ¨åˆ†ï¼Œï¼ˆ`Base(_y * _y)`)ã€‚ å¦‚æœæ„é€ å‡½æ•°å‚æ•°æ˜¯å¸¸é‡å¹¶ä¸”å®šä¹‰æˆ–æè¿°äº†åˆçº¦çš„è¡Œä¸ºï¼Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•æ¯”è¾ƒæ–¹ä¾¿ã€‚ å¦‚æœåŸºç±»æ„é€ å‡½æ•°çš„å‚æ•°ä¾èµ–äºæ´¾ç”Ÿåˆçº¦ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ã€‚ å¦‚æœåƒè¿™ä¸ªç®€å•çš„ä¾‹å­ä¸€æ ·ï¼Œä¸¤ä¸ªåœ°æ–¹éƒ½ç”¨åˆ°äº†ï¼Œä¼˜å…ˆä½¿ç”¨ ä¿®é¥°å™¨modifier é£æ ¼çš„å‚æ•°ã€‚\n\n### æŠ½è±¡åˆçº¦\n\nåˆçº¦å‡½æ•°å¯ä»¥ç¼ºå°‘å®ç°ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼ˆè¯·æ³¨æ„å‡½æ•°å£°æ˜å¤´ç”± **;** ç»“å°¾ï¼‰:\n\n```javascript\npragma solidity ^0.4.0;\n\ncontract Feline {\n    function utterance() public returns (bytes32);\n}\n```\nè¿™äº›åˆçº¦æ— æ³•æˆåŠŸç¼–è¯‘ï¼ˆå³ä½¿å®ƒä»¬é™¤äº†æœªå®ç°çš„å‡½æ•°è¿˜åŒ…å«å…¶ä»–å·²ç»å®ç°äº†çš„å‡½æ•°ï¼‰ï¼Œä½†ä»–ä»¬å¯ä»¥ç”¨ä½œåŸºç±»åˆçº¦:\n\n```javascript\npragma solidity ^0.4.0;\n\ncontract Feline {\n    function utterance() public returns (bytes32);\n}\n\ncontract Cat is Feline {\n    function utterance() public returns (bytes32) { return \"miaow\"; }\n}\n```\nå¦‚æœåˆçº¦ç»§æ‰¿è‡ªæŠ½è±¡åˆçº¦ï¼Œå¹¶ä¸”æ²¡æœ‰é€šè¿‡é‡å†™æ¥å®ç°æ‰€æœ‰æœªå®ç°çš„å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«å°±æ˜¯æŠ½è±¡çš„ã€‚\n\n### æ¥å£ï¼ˆInterfaceï¼‰\n\næ¥å£ç±»ä¼¼äºæŠ½è±¡åˆçº¦ï¼Œä½†æ˜¯å®ƒä»¬ä¸èƒ½å®ç°ä»»ä½•å‡½æ•°ã€‚è¿˜æœ‰è¿›ä¸€æ­¥çš„é™åˆ¶ï¼š\n\n* æ— æ³•ç»§æ‰¿å…¶ä»–åˆçº¦æˆ–æ¥å£ã€‚\n* æ— æ³•å®šä¹‰æ„é€ å‡½æ•°ã€‚\n* æ— æ³•å®šä¹‰å˜é‡ã€‚\n* æ— æ³•å®šä¹‰ç»“æ„ä½“\n* æ— æ³•å®šä¹‰æšä¸¾ã€‚\n\né¦–å…ˆï¼Œçœ‹ä¸€ä¸‹ä¸€ä¸ªinterfaceçš„ä¾‹å­ï¼š\n\n```javascript\n\ncontract NumberInterface {\n  function getNum(address _myAddress) public view returns (uint);\n}\n```\n\nè¯·æ³¨æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹è™½ç„¶çœ‹èµ·æ¥åƒåœ¨å®šä¹‰ä¸€ä¸ªåˆçº¦ï¼Œä½†å…¶å®å†…é‡Œä¸åŒï¼š\n\n* é¦–å…ˆï¼Œåªå£°æ˜äº†è¦ä¸ä¹‹äº¤äº’çš„å‡½æ•° â€”â€” åœ¨æœ¬ä¾‹ä¸­ä¸º getNum â€”â€” åœ¨å…¶ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°ä»»ä½•å…¶ä»–çš„å‡½æ•°æˆ–çŠ¶æ€å˜é‡ã€‚\n* å…¶æ¬¡ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨å¤§æ‹¬å·ï¼ˆ{ å’Œ }ï¼‰å®šä¹‰å‡½æ•°ä½“ï¼Œå•å•ç”¨åˆ†å·ï¼ˆ`;`ï¼‰ç»“æŸäº†å‡½æ•°å£°æ˜ã€‚è¿™ä½¿å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªåˆçº¦æ¡†æ¶ã€‚\n\nç¼–è¯‘å™¨å°±æ˜¯é è¿™äº›ç‰¹å¾è®¤å‡ºå®ƒæ˜¯ä¸€ä¸ªæ¥å£çš„ã€‚\n\n> å°±åƒç»§æ‰¿å…¶ä»–åˆçº¦ä¸€æ ·ï¼Œåˆçº¦å¯ä»¥ç»§æ‰¿æ¥å£ã€‚\n\nå¯ä»¥åœ¨åˆçº¦ä¸­è¿™æ ·ä½¿ç”¨æ¥å£ï¼š\n\n```javascript\ncontract MyContract {\n  address NumberInterfaceAddress = 0xab38...;\n  // ^ è¿™æ˜¯FavoriteNumberåˆçº¦åœ¨ä»¥å¤ªåŠä¸Šçš„åœ°å€\n  NumberInterface numberContract = NumberInterface(NumberInterfaceAddress);\n  // ç°åœ¨å˜é‡ `numberContract` æŒ‡å‘å¦ä¸€ä¸ªåˆçº¦å¯¹è±¡\n\n  function someFunction() public {\n    // ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨åœ¨é‚£ä¸ªåˆçº¦ä¸­å£°æ˜çš„ `getNum`å‡½æ•°:\n    uint num = numberContract.getNum(msg.sender);\n    // ...åœ¨è¿™å„¿ä½¿ç”¨ `num`å˜é‡åšäº›ä»€ä¹ˆ\n  }\n}\n```\n\né€šè¿‡è¿™ç§æ–¹å¼ï¼Œåªè¦å°†åˆçº¦çš„å¯è§æ€§è®¾ç½®ä¸º`public`(å…¬å…±)æˆ–`external`(å¤–éƒ¨)ï¼Œå®ƒä»¬å°±å¯ä»¥ä¸ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„ä»»ä½•å…¶ä»–åˆçº¦è¿›è¡Œäº¤äº’ã€‚\n\n\n### ä¸å…¶ä»–åˆçº¦çš„äº¤äº’\n\nå¦‚æœä¸€ä¸ªåˆçº¦éœ€è¦å’ŒåŒºå—é“¾ä¸Šçš„å…¶ä»–çš„åˆçº¦ä¼šè¯ï¼Œåˆ™éœ€å…ˆå®šä¹‰ä¸€ä¸ª interface (æ¥å£)ã€‚\n\nå…ˆä¸¾ä¸€ä¸ªç®€å•çš„æ —å­ã€‚ å‡è®¾åœ¨åŒºå—é“¾ä¸Šæœ‰è¿™ä¹ˆä¸€ä¸ªåˆçº¦ï¼š\n\n```javascript\ncontract LuckyNumber {\n  mapping(address => uint) numbers;\n\n  function setNum(uint _num) public {\n    numbers[msg.sender] = _num;\n  }\n\n  function getNum(address _myAddress) public view returns (uint) {\n    return numbers[_myAddress];\n  }\n}\n```\n\nè¿™æ˜¯ä¸ªå¾ˆç®€å•çš„åˆçº¦ï¼Œå¯ä»¥ç”¨å®ƒå­˜å‚¨è‡ªå·±çš„å¹¸è¿å·ç ï¼Œå¹¶å°†å…¶ä¸è°ƒç”¨è€…çš„ä»¥å¤ªåŠåœ°å€å…³è”ã€‚ è¿™æ ·å…¶ä»–äººå°±å¯ä»¥é€šè¿‡åœ°å€æŸ¥æ‰¾å¹¸è¿å·ç äº†ã€‚\n\nç°åœ¨å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨åˆçº¦ï¼Œä½¿ç”¨ getNum å‡½æ•°å¯è¯»å–å…¶ä¸­çš„æ•°æ®ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ LuckyNumber åˆçº¦çš„ interface ï¼š\n\n```javascript\n\ncontract NumberInterface {\n  function getNum(address _myAddress) public view returns (uint);\n}\n```\n\nä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œåˆçº¦å°±çŸ¥é“å…¶ä»–åˆçº¦çš„å‡½æ•°æ˜¯æ€æ ·çš„ï¼Œåº”è¯¥å¦‚ä½•è°ƒç”¨ï¼Œä»¥åŠå¯æœŸå¾…ä»€ä¹ˆç±»å‹çš„è¿”å›å€¼ã€‚\n\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œä¼šç”¨åˆ°ä¸Šè¾¹çš„çŸ¥è¯†ç‚¹ï¼š\n\n```javascript\npragma solidity ^0.4.19;\n\ncontract ZombieFactory {\n\n    event NewZombie(uint zombieId, string name, uint dna);\n\n    uint dnaDigits = 16;\n    uint dnaModulus = 10 ** dnaDigits;\n\n    struct Zombie {\n        string name;\n        uint dna;\n    }\n\n    Zombie[] public zombies;\n\n    // åˆ›å»ºä¸€ä¸ªå«åš zombieToOwner çš„æ˜ å°„ã€‚å…¶é”®æ˜¯ä¸€ä¸ªuintï¼Œå€¼ä¸º addressã€‚æ˜ å°„å±æ€§ä¸ºpublic\n    mapping (uint => address) public zombieToOwner;\n    // åˆ›å»ºä¸€ä¸ªåä¸º ownerZombieCount çš„æ˜ å°„ï¼Œå…¶ä¸­é”®æ˜¯ addressï¼Œå€¼æ˜¯ uint\n    mapping (address => uint) ownerZombieCount;\n\n    function _createZombie(string _name, uint _dna) private {\n        uint id = zombies.push(Zombie(_name, _dna)) - 1;\n        zombieToOwner[id] = msg.sender;\n        ownerZombieCount[msg.sender]++;\n        NewZombie(id, _name, _dna);\n    }\n\n    function _generateRandomDna(string _str) private view returns (uint) {\n        uint rand = uint(keccak256(_str));\n        return rand % dnaModulus;\n    }\n\n    function createRandomZombie(string _name) public {\n        // æˆ‘ä»¬ä½¿ç”¨äº† require æ¥ç¡®ä¿è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨æ¯ä¸ªç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨å®ƒçš„æ—¶å€™æ‰§è¡Œï¼Œç”¨ä»¥åˆ›å»ºåˆå§‹åƒµå°¸\n        require(ownerZombieCount[msg.sender] == 0);\n        uint randDna = _generateRandomDna(_name);\n        _createZombie(_name, randDna);\n    }\n\n}\n\n// CryptoKitties åˆçº¦æä¾›äº†getKitty å‡½æ•°ï¼Œå®ƒè¿”å›æ‰€æœ‰çš„åŠ å¯†çŒ«çš„æ•°æ®ï¼ŒåŒ…æ‹¬å®ƒçš„â€œåŸºå› â€ï¼ˆåƒµå°¸æ¸¸æˆè¦ç”¨å®ƒç”Ÿæˆæ–°çš„åƒµå°¸ï¼‰ã€‚\n// ä¸€ä¸ªè·å– kitty çš„æ¥å£\ncontract KittyInterface {\n  \n  // åœ¨interfaceé‡Œå®šä¹‰äº† getKitty å‡½æ•° åœ¨ returns è¯­å¥ä¹‹åç”¨åˆ†å·\n  function getKitty(uint256 _id) external view returns (\n    bool isGestating,\n    bool isReady,\n    uint256 cooldownIndex,\n    uint256 nextActionAt,\n    uint256 siringWithId,\n    uint256 birthTime,\n    uint256 matronId,\n    uint256 sireId,\n    uint256 generation,\n    uint256 genes\n  );\n}\n\n//ZombieFeedingç»§æ‰¿è‡ª `ZombieFactory åˆçº¦\ncontract ZombieFeeding is ZombieFactory {\n  \n  // CryptoKitties åˆçº¦çš„åœ°å€\n  address ckAddress = 0x06012c8cf97BEaD5deAe237070F9587f8E7A266d;\n  // åˆ›å»ºä¸€ä¸ªåä¸º kittyContract çš„ KittyInterfaceï¼Œå¹¶ç”¨ ckAddress ä¸ºå®ƒåˆå§‹åŒ– \n  KittyInterface kittyContract = KittyInterface(ckAddress);\n  \n  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) public {\n      // ç¡®ä¿å¯¹è‡ªå·±åƒµå°¸çš„æ‰€æœ‰æƒ\n      require(msg.sender == zombieToOwner[_zombieId]);\n      // å£°æ˜ä¸€ä¸ªåä¸º myZombie æ•°æ®ç±»å‹ä¸ºZombieçš„ storage ç±»å‹æœ¬åœ°å˜é‡\n      Zombie storage myZombie = zombies[_zombieId];\n      _targetDna = _targetDna % dnaModulus;\n      uint newDna = (myZombie.dna + _targetDna) / 2;\n      // Add an if statement here\n      if (keccak256(_species) == keccak256(\"kitty\")){\n          newDna = newDna - newDnaï¼…100 + 99;\n      }\n      _createZombie(\"NoName\", newDna);\n  }\n  \n  function feedOnKitty(uint _zombieId, uint _kittyId) public {\n    uint kittyDna;\n    // å¤šå€¼è¿”å›ï¼Œè¿™é‡Œåªéœ€è¦æœ€åä¸€ä¸ªå€¼\n    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);\n    feedAndMultiply(_zombieId, kittyDna, \"kitty\");\n  }\n}\n\n```\n\n> è¿™æ®µä»£ç çœ‹èµ·æ¥å†…å®¹æœ‰ç‚¹å¤šï¼Œå¯ä»¥æ‹†åˆ†ä¸€ä¸‹ï¼ŒæŠŠ `ZombieFactory`ä»£ç æå–åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶`zombiefactory.sol`ï¼Œç°åœ¨å°±å¯ä»¥ä½¿ç”¨ import è¯­å¥æ¥å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶çš„ä»£ç ã€‚\n\n### import\n\nåœ¨ Solidity ä¸­ï¼Œå½“ä½ æœ‰å¤šä¸ªæ–‡ä»¶å¹¶ä¸”æƒ³æŠŠä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ import è¯­å¥ï¼š\n\n```javascript\n\nimport \"./someothercontract.sol\";\n\ncontract newContract is SomeOtherContract {\n\n}\n```\n\nè¿™æ ·å½“æˆ‘ä»¬åœ¨åˆçº¦ï¼ˆcontractï¼‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º someothercontract.sol çš„æ–‡ä»¶ï¼ˆ ./ å°±æ˜¯åŒä¸€ç›®å½•çš„æ„æ€ï¼‰ï¼Œå®ƒå°±ä¼šè¢«ç¼–è¯‘å™¨å¯¼å…¥ã€‚\n\n> è¿™ä¸€ç‚¹å’Œ go ç±»ä¼¼ï¼Œåœ¨åŒä¸€ç›®å½•ä¸‹æ–‡ä»¶ä¸­çš„å†…å®¹å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸ç”¨ä½¿ç”¨ **xxx.name** çš„å½¢å¼ã€‚\n\n\n### æµ‹è¯•è°ƒç”¨\n\n\nç¼–è¯‘å’Œéƒ¨ç½² ZombieFeedingï¼Œå°±å¯ä»¥å°†è¿™ä¸ªåˆçº¦éƒ¨ç½²åˆ°ä»¥å¤ªåŠäº†ã€‚æœ€ç»ˆå®Œæˆçš„è¿™ä¸ªåˆçº¦ç»§æ‰¿è‡ª ZombieFactoryï¼Œå› æ­¤å®ƒå¯ä»¥è®¿é—®è‡ªå·±å’Œçˆ¶è¾ˆåˆçº¦ä¸­çš„æ‰€æœ‰ public æ–¹æ³•ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä¸ZombieFeedingåˆçº¦è¿›è¡Œäº¤äº’çš„ä¾‹å­ï¼Œ è¿™ä¸ªä¾‹å­ä½¿ç”¨äº† JavaScript å’Œ web3.jsï¼š\n\n```javascript\nvar abi = /* abi generated by the compiler */\nvar ZombieFeedingContract = web3.eth.contract(abi)\nvar contractAddress = /* our contract address on Ethereum after deploying */\nvar ZombieFeeding = ZombieFeedingContract.at(contractAddress)\n\n// å‡è®¾æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„åƒµå°¸IDå’Œè¦æ”»å‡»çš„çŒ«å’ªID\nlet zombieId = 1;\nlet kittyId = 1;\n\n// è¦æ‹¿åˆ°çŒ«å’ªçš„DNAï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å®ƒçš„APIã€‚è¿™äº›æ•°æ®ä¿å­˜åœ¨å®ƒä»¬çš„æœåŠ¡å™¨ä¸Šè€Œä¸æ˜¯åŒºå—é“¾ä¸Šã€‚\n// å¦‚æœä¸€åˆ‡éƒ½åœ¨åŒºå—é“¾ä¸Šï¼Œæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒå®ƒä»¬çš„æœåŠ¡å™¨æŒ‚äº†ï¼Œæˆ–è€…å®ƒä»¬ä¿®æ”¹äº†APIï¼Œ\n// æˆ–è€…å› ä¸ºä¸å–œæ¬¢æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆè€Œå°æ€äº†æˆ‘ä»¬\nlet apiUrl = \"https://api.cryptokitties.co/kitties/\" + kittyId\n$.get(apiUrl, function(data) {\n  let imgUrl = data.image_url\n  // ä¸€äº›æ˜¾ç¤ºå›¾ç‰‡çš„ä»£ç \n})\n\n// å½“ç”¨æˆ·ç‚¹å‡»ä¸€åªçŒ«å’ªçš„æ—¶å€™:\n$(\".kittyImage\").click(function(e) {\n  // è°ƒç”¨æˆ‘ä»¬åˆçº¦çš„ `feedOnKitty` å‡½æ•°\n  ZombieFeeding.feedOnKitty(zombieId, kittyId)\n})\n\n// ä¾¦å¬æ¥è‡ªæˆ‘ä»¬åˆçº¦çš„æ–°åƒµå°¸äº‹ä»¶å¥½æ¥å¤„ç†\nZombieFactory.NewZombie(function(error, result) {\n  if (error) return\n  // è¿™ä¸ªå‡½æ•°ç”¨æ¥æ˜¾ç¤ºåƒµå°¸:\n  generateZombie(result.zombieId, result.name, result.dna)\n})\n```\n\n### å‚è€ƒé“¾æ¥\n\n- [Solidity æ–‡æ¡£ï¼šhttps://solidity-cn.readthedocs.io/zh/develop/index.html](https://solidity-cn.readthedocs.io/zh/develop/index.html)\n- [cryptozombie-lessons2 åƒµå°¸æ”»å‡»äººç±»ï¼šhttps://cryptozombies.io/zh/lesson/2](https://cryptozombies.io/zh/lesson/2)\n- [Solidity ç®€æ˜“æ•™ç¨‹](https://mp.weixin.qq.com/s/1MaIc7uNqBMx-_eO4WGQgA)\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![](http://media.gusibi.mobi/ah0mqMXMtdJb9Yj03suu-NGEyVRxyEuOIT5bXSv7ip5aqtHkiRjTTl8SMRMv3Qp5)\n",
      "data": {
        "title": "Solidity ç®€æ˜“æ•™ç¨‹0x001",
        "date": "2018-10-22 13:36:53",
        "tags": [
          "åŒºå—é“¾",
          "ä»¥å¤ªåŠ",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "solidity-sample-guide-0x001"
    },
    {
      "content": "\nSQLAlchemy in ç©ºåˆ—è¡¨é—®é¢˜\n\n### é—®é¢˜åœºæ™¯\n\næœ‰model `Account`ï¼ŒSQLAlchemy æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\n\n```python\nquery = Account.query.filter(Account.id.in_(account_ids)).order_by(Account.date_created.desc())\n```\n\nè¿™é‡Œ account_ids å¦‚æœä¸ºç©ºï¼Œæ‰§è¡ŒæŸ¥è¯¢ä¼šæœ‰å¦‚ä¸‹è­¦å‘Šï¼š\n\n```bash\n/usr/local/lib/python2.7/site-packages/sqlalchemy/sql/default_comparator.py:35: SAWarning: The IN-predicate on \"account.id\" was invoked with an empty sequence. This results in a contradiction, which nonetheless can be expensive to evaluate.  Consider alternative strategies for improved performance.\n  return o[0](self, self.expr, op, *(other + o[1:]), **kwargs)\n```\n\n> è¿™é‡Œçš„æ„æ€æ˜¯ä½¿ç”¨ä¸€ä¸ªç©ºçš„åˆ—è¡¨ä¼šèŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œéœ€è¦ä¼˜åŒ–ä»¥æé«˜æ€§èƒ½ã€‚\n\n**ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªæç¤ºå‘¢ï¼Ÿä¸€ä¸ªç©ºåˆ—è¡¨ä¸ºä»€ä¹ˆä¼šå½±å“æ€§èƒ½å‘¢ï¼Ÿ**\n\né¦–å…ˆæ‰“å° query å¯å¾—åˆ°å¦‚ä¸‹ sql è¯­å¥ï¼š\n\n```sql\nSELECT *   // å­—æ®µä½¿ç”¨ â€œ*â€ ä»£æ›¿\nFROM account\nWHERE account.id != account.id ORDER BY account.date_created DESC\n```\n\nä¼šå‘ç°ç”Ÿæˆçš„è¯­å¥ä¸­è¿‡æ»¤æ¡ä»¶æ˜¯ `WHERE account.id != account.id`ï¼Œä½¿ç”¨ `PostgreSQL Explain ANALYZE å‘½ä»¤`ï¼Œ\n\n* EXPLAINï¼šæ˜¾ç¤ºPostgreSQLè®¡åˆ’ç¨‹åºä¸ºæä¾›çš„è¯­å¥ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ã€‚\n* ANALYZEï¼šæ”¶é›†æœ‰å…³æ•°æ®åº“ä¸­è¡¨çš„å†…å®¹çš„ç»Ÿè®¡ä¿¡æ¯ã€‚\n\nåˆ†ææŸ¥è¯¢æˆæœ¬ç»“æœå¦‚ä¸‹ï¼š\n\n```bash\npostgres=> EXPLAIN ANALYZE SELECT *\nFROM account\nWHERE account.id != account.id ORDER BY account.date_created DESC;\n                                    QUERY PLAN\n----------------------------------------------------------------------------------\n Sort  (cost=797159.14..808338.40 rows=4471702 width=29) (actual time=574.002..574.002 rows=0 loops=1)\n   Sort Key: date_created DESC\n   Sort Method: quicksort  Memory: 25kB\n   ->  Seq Scan on account  (cost=0.00..89223.16 rows=4471702 width=29) (actual time=573.991..573.991 rows=0 loops=1)\n         Filter: (id <> id)\n         Rows Removed by Filter: 4494173\n Planning time: 0.162 ms\n Execution time: 574.052 ms\n(8 rows)\n```\n\nå…ˆçœ‹Postgresqlæä¾›çš„è¯­å¥ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œé€šè¿‡ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶è¿”å›å€¼ä¸ºç©ºï¼Œä½†æ˜¯æŸ¥è¯¢æˆæœ¬å´è¿˜æ˜¯ç‰¹åˆ«é«˜ï¼Œæ‰§è¡Œè®¡åˆ’éƒ¨åˆ†å‡ ä¹æ‰€æœ‰çš„æ—¶é—´éƒ½è€—è´¹åœ¨æ’åºä¸Šï¼Œä½†æ˜¯å’Œæ‰§è¡Œæ—¶é—´ç›¸æ¯”ï¼ŒæŸ¥è¯¢è®¡åˆ’çš„æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ï¼ˆç»“æœæ˜¯å…ˆéå†å…¨è¡¨ï¼ŒæŸ¥å‡ºæ‰€æœ‰æ•°æ®ï¼Œç„¶åå†ä½¿ç”¨ `Filter: (id <> id)` æŠŠæ‰€æœ‰æ•°æ®è¿‡æ»¤ã€‚ï¼‰\n\næŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæœ‰ä¸¤ç§æŸ¥è¯¢æ–¹æ¡ˆï¼š\n\n1. å¦‚æœ account_ids ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç©ºåˆ—è¡¨ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼ŒæŸ¥è¯¢è¯­å¥å˜ä¸ºï¼š\n\n```python\nif account_ids:\n    query = Account.query.filter(Account.id.in_(account_ids)).order_by(Account.date_created.desc())\n```\n\n2. å¦‚æœ account_ids ä¸ºç©ºï¼Œé‚£ä¹ˆè¿‡æ»¤æ–¹å¼ï¼ŒæŸ¥è¯¢è¯­å¥å˜ä¸ºï¼š\n\n```python\nquery = Account.query\nif account_ids:\n    query = query.filter(Account.id.in_(account_ids))\nelse:\n    query = query.filter(False)\n    \nquery = query.order_by(Account.date_created.desc())\n```\n\nå¦‚æœ account_ids ä¸ºç©ºï¼Œæ­¤æ—¶ç”Ÿæˆçš„ SQL è¯­å¥ç»“æœä¸ºï¼š\n\n```sql\nSELECT *\nFROM account\nWHERE 0 = 1 ORDER BY account.date_created DESC\n```\n\nåˆ†æç»“æœä¸ºï¼š\n\n```sql\npostgres=> EXPLAIN ANALYZE SELECT *\nFROM account\nWHERE 0 = 1 ORDER BY account.date_created DESC;\n                                            QUERY PLAN\n---------------------------------------------------------------------------------------------------\n Sort  (cost=77987.74..77987.75 rows=1 width=29) (actual time=0.011..0.011 rows=0 loops=1)\n   Sort Key: date_created DESC\n   Sort Method: quicksort  Memory: 25kB\n   ->  Result  (cost=0.00..77987.73 rows=1 width=29) (actual time=0.001..0.001 rows=0 loops=1)\n         One-Time Filter: false\n         ->  Seq Scan on account  (cost=0.00..77987.73 rows=1 width=29) (never executed)\n Planning time: 0.197 ms\n Execution time: 0.061 ms\n(8 rows)\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥è¯¢è®¡åˆ’å’Œæ‰§è¡Œæ—¶é—´éƒ½æœ‰å¤§å¹…æé«˜ã€‚\n\n\n#### ä¸€ä¸ªæµ‹è¯•\n\n> å¦‚æœåªæ˜¯å»æ‰æ–¹æ¡ˆ1æ’åºï¼ŒæŸ¥çœ‹ä¸€ä¸‹åˆ†æç»“æœ\n\nä½¿ç”¨ `PostgreSQL Explain ANALYZE å‘½ä»¤`åˆ†ææŸ¥è¯¢æˆæœ¬ç»“æœå¦‚ä¸‹ï¼š\n\n```sh\npostgres=> EXPLAIN ANALYZE SELECT *\nFROM account\nWHERE account.id != account.id;\n                                 QUERY PLAN\n----------------------------------------------------------------------------\n Seq Scan on account  (cost=0.00..89223.16 rows=4471702 width=29) (actual time=550.999..550.999 rows=0 loops=1)\n   Filter: (id <> id)\n   Rows Removed by Filter: 4494173\n Planning time: 0.134 ms\n Execution time: 551.041 ms\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ—¶é—´å’Œæœ‰æ’åºæ—¶å·®åˆ«ä¸å¤§ã€‚\n\n### å¦‚ä½•è®¡ç®—æŸ¥è¯¢æˆæœ¬\n\næ‰§è¡Œä¸€ä¸ªåˆ†æï¼Œç»“æœå¦‚ä¸‹ï¼š\n\n```sql\npostgres=> explain select * from account where date_created ='2016-04-07 18:51:30.371495+08';\n                                      QUERY PLAN\n--------------------------------------------------------------------------------------\n Seq Scan on account  (cost=0.00..127716.33 rows=1 width=211)\n   Filter: (date_created = '2016-04-07 18:51:30.371495+08'::timestamp with time zone)\n(2 rows)\n```\nEXPLAINå¼•ç”¨çš„æ•°æ®æ˜¯ï¼š\n\n 1. 0.00 é¢„è®¡çš„å¯åŠ¨å¼€é”€(åœ¨è¾“å‡ºæ‰«æå¼€å§‹ä¹‹å‰æ¶ˆè€—çš„æ—¶é—´ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªæ’åºèŠ‚ç‚¹é‡Œåšæ’ç»­çš„æ—¶é—´)ã€‚\n 2. 127716.33 é¢„è®¡çš„æ€»å¼€é”€ã€‚\n 3. 1 é¢„è®¡çš„è¯¥è§„åˆ’èŠ‚ç‚¹è¾“å‡ºçš„è¡Œæ•°ã€‚\n 4. 211 é¢„è®¡çš„è¯¥è§„åˆ’èŠ‚ç‚¹çš„è¡Œå¹³å‡å®½åº¦(å•ä½ï¼šå­—èŠ‚)ã€‚ \n\nè¿™é‡Œå¼€é”€(cost)çš„è®¡ç®—å•ä½æ˜¯ç£ç›˜é¡µé¢çš„å­˜å–æ•°é‡ï¼Œå¦‚1.0å°†è¡¨ç¤ºä¸€æ¬¡é¡ºåºçš„ç£ç›˜é¡µé¢è¯»å–ã€‚å…¶ä¸­ä¸Šå±‚èŠ‚ç‚¹çš„å¼€é”€å°†åŒ…æ‹¬å…¶æ‰€æœ‰å­èŠ‚ç‚¹çš„å¼€é”€ã€‚è¿™é‡Œçš„è¾“å‡ºè¡Œæ•°(rows)å¹¶ä¸æ˜¯è§„åˆ’èŠ‚ç‚¹å¤„ç†/æ‰«æçš„è¡Œæ•°ï¼Œé€šå¸¸ä¼šæ›´å°‘ä¸€äº›ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œé¡¶å±‚çš„è¡Œé¢„è®¡æ•°é‡ä¼šæ›´æ¥è¿‘äºæŸ¥è¯¢å®é™…è¿”å›çš„è¡Œæ•°ã€‚\nè¿™é‡Œè¡¨ç¤ºçš„å°±æ˜¯åœ¨åªæœ‰å• CPU å†…æ ¸çš„æƒ…å†µä¸‹ï¼Œè¯„ä¼°æˆæœ¬æ˜¯127716.33;\n\n#### è®¡ç®—æˆæœ¬ï¼ŒPostgresql é¦–å…ˆçœ‹è¡¨çš„å­—èŠ‚æ•°å¤§å°\n\nè¿™é‡Œ account è¡¨çš„å¤§å°ä¸ºï¼š\n\n```sql\npostgres=> select pg_relation_size('account');\n\npg_relation_size\n------------------\n        737673216\n(1 row)\n```\n\n#### æŸ¥çœ‹å—çš„å¤§å°\n\nPostgresql ä¼šä¸ºæ¯ä¸ªè¦ä¸€æ¬¡è¯»å–çš„å¿«æ·»åŠ æˆæœ¬ç‚¹ï¼Œä½¿ç”¨ `show block_size`æŸ¥çœ‹å—çš„å¤§å°ï¼š\n\n```sql\npostgres=> show block_size;\n\nblock_size\n------------\n 8192\n(1 row)\n```\n\n#### è®¡ç®—å—çš„ä¸ªæ•°\n\n\nå¯ä»¥çœ‹åˆ°æ¯ä¸ªå—çš„å¤§å°ä¸º8kbï¼Œé‚£ä¹ˆå¯ä»¥è®¡ç®—ä»è¡¨ä»è¯»å–çš„é¡ºåºå—æˆæœ¬å€¼ä¸ºï¼š\n\n```\nblocks = pg_relation_size/block_size = 90048\n```\n\n`90048` æ˜¯account è¡¨æ‰€å ç”¨å—çš„æ•°é‡ã€‚\n\n\n#### æŸ¥çœ‹æ¯ä¸ªå—éœ€è¦çš„æˆæœ¬\n\n```sql\npostgres=> show seq_page_cost;\n seq_page_cost\n---------------\n 1\n(1 row)\n```\n\nè¿™é‡Œçš„æ„æ€æ˜¯ Postgresql ä¸ºæ¯ä¸ªå—åˆ†é…ä¸€ä¸ªæˆæœ¬ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„æŸ¥è¯¢éœ€è¦ä»90048ä¸ªæˆæœ¬ç‚¹ã€‚\n\n#### å¤„ç†æ¯æ¡æ•°æ® cpu æ‰€éœ€æ—¶é—´\n\n* cpu_tuple_costï¼šå¤„ç†æ¯æ¡è®°å½•çš„CPUå¼€é”€ï¼ˆtupleï¼šå…³ç³»ä¸­çš„ä¸€è¡Œè®°å½•ï¼‰\n* cpu_operator_costï¼šæ“ä½œç¬¦æˆ–å‡½æ•°å¸¦æ¥çš„CPUå¼€é”€ã€‚\n\n```sql\npostgres=> show cpu_operator_cost;\n cpu_operator_cost\n-------------------\n 0.0025\n(1 row)\n\npostgres=> show cpu_tuple_cost;\n cpu_tuple_cost\n----------------\n 0.01\n(1 row)\n```\n\n#### è®¡ç®—\n\ncost è®¡ç®—å…¬å¼ä¸ºï¼š\n\n> cost = ç£ç›˜å—ä¸ªæ•° * å—æˆæœ¬ï¼ˆ1ï¼‰ + è¡Œæ•° * cpu_tuple_costï¼ˆç³»ç»Ÿå‚æ•°å€¼ï¼‰+ è¡Œæ•° * cpu_operator_cost\n\nç°åœ¨ç”¨æ‰€æœ‰å€¼æ¥è®¡ç®—explain è¯­å¥ä¸­å¾—åˆ°çš„å€¼ï¼š\n\n```python\nnumber_of_records = 3013466  # account è¡¨ count\n\nblock_size = 8192  # block size in bytes\n\npg_relation_size=737673216\n\nblocks = pg_relation_size/block_size = 90048\n\nseq_page_cost = 1\ncpu_tuple_cost = 0.01\ncpu_operator_cost = 0.0025\n\ncost = blocks * seq_page_cost + number_of_records * cpu_tuple_cost + number_of_records * cpu_operator_cost\n```\n\n#### å¦‚ä½•é™ä½æŸ¥è¯¢æˆæœ¬ï¼Ÿ\n\nç›´æ¥å›ç­”ï¼Œä½¿ç”¨ç´¢å¼•ã€‚\n\n```sql\npostgres=> explain select * from account where id=20039;\n                                       QUERY PLAN\n----------------------------------------------------------------------------------------\n Index Scan using account_pkey on account  (cost=0.43..8.45 rows=1 width=211)\n   Index Cond: (id = 20039)\n(2 rows)\n```\n\né€šè¿‡è¿™ä¸ªæŸ¥è¯¢å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨æœ‰ç´¢å¼•çš„å­—æ®µæŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢æˆæœ¬æ˜¾è‘—é™ä½ã€‚\n\n> ç´¢å¼•æ‰«æçš„è®¡ç®—æ¯”é¡ºåºæ‰«æçš„è®¡ç®—è¦å¤æ‚ä¸€äº›ã€‚å®ƒç”±ä¸¤ä¸ªé˜¶æ®µç»„æˆã€‚\nPostgreSQLä¼šè€ƒè™‘random_page_costå’Œcpu_index_tuple_cost å˜é‡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŸºäºç´¢å¼•æ ‘çš„é«˜åº¦çš„å€¼ã€‚\n\n### å‚è€ƒé“¾æ¥\n\n* [sqlalchemy-and-empty-in-clause](https://stackoverflow.com/questions/23523147/sqlalchemy-and-empty-in-clause)\n* [PostgreSQLæŸ¥è¯¢æ€§èƒ½åˆ†æå’Œä¼˜åŒ–](https://www.linuxidc.com/Linux/2017-07/145768.htm)\n* [PostgreSQLå­¦ä¹ æ‰‹å†Œ(æ€§èƒ½æå‡æŠ€å·§)](http://www.cnblogs.com/stephen-liu74/archive/2011/12/25/2301064.html)\n* [PostgreSQL æŸ¥è¯¢æˆæœ¬æ¨¡å‹](https://mp.weixin.qq.com/s/iBbVfmrTCxINlrbBS9u1Qw)\n* [PostgreSQL æŸ¥è¯¢è®¡åˆ’æ—¶é—´çš„è®¡ç®—è¯¦è§£](https://blog.csdn.net/luojinbai/article/details/43085383)\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![](http://media.gusibi.mobi/ah0mqMXMtdJb9Yj03suu-NGEyVRxyEuOIT5bXSv7ip5aqtHkiRjTTl8SMRMv3Qp5)\n",
      "data": {
        "title": "SQLAlchemy in ç©ºåˆ—è¡¨é—®é¢˜åˆ†æ",
        "date": "2018-10-04 13:36:53",
        "tags": [
          "åç«¯",
          "python",
          "development"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "sqlalchemy_in_empty_list_analyze"
    },
    {
      "content": "\n>  Solidityæ˜¯ä»¥å¤ªåŠçš„ä¸»è¦ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€ç§é™æ€ç±»å‹çš„ JavaScript-esque è¯­è¨€ï¼Œæ˜¯é¢å‘åˆçº¦çš„ã€ä¸ºå®ç°æ™ºèƒ½åˆçº¦è€Œåˆ›å»ºçš„é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œè®¾è®¡çš„ç›®çš„æ˜¯èƒ½åœ¨ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ä¸Šè¿è¡Œã€‚\n>  \n>  æœ¬æ–‡åŸºäºCryptoZombiesï¼Œæ•™ç¨‹åœ°å€ä¸ºï¼šhttps://cryptozombies.io/zh/\n\n\n###  åˆçº¦\n\n\nSolidity çš„ä»£ç éƒ½åŒ…è£¹åœ¨**åˆçº¦**é‡Œé¢. ä¸€ä»½`åˆçº¦`å°±æ˜¯ä»¥å¤ªåº”å¸åº”ç”¨çš„åŸºæœ¬æ¨¡å—ï¼Œ æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°éƒ½å±äºä¸€ä»½åˆçº¦, å®ƒæ˜¯ä½ æ‰€æœ‰åº”ç”¨çš„èµ·ç‚¹.\n\nä¸€ä»½åä¸º `HelloWorld` çš„ç©ºåˆçº¦å¦‚ä¸‹:\n\n```javascript\ncontract HelloWorld {\n\n}\n```\n\n\n#### hello world\n\né¦–å…ˆçœ‹ä¸€ä¸ªç®€å•çš„æ™ºèƒ½åˆçº¦ã€‚\n\n```javascript\npragma solidity ^0.4.0;\n\ncontract SimpleStorage {\n    uint storedData; // å£°æ˜ä¸€ä¸ªç±»å‹ä¸º uint (256ä½æ— ç¬¦å·æ•´æ•°ï¼‰çš„çŠ¶æ€å˜é‡ï¼Œå«åš storedData\n\n    function set(uint x) public {\n        storedData = x; // çŠ¶æ€å˜é‡å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦ä½¿ç”¨ this. æˆ–è€… self. è¿™æ ·çš„å‰ç¼€\n    }\n\n    function get() public view returns (uint) {\n        return storedData;\n    }\n}\n```\n\n\n\n\næ‰€æœ‰çš„ Solidity æºç éƒ½å¿…é¡»å† ä»¥ \"version pragma\" â€” æ ‡æ˜ Solidity ç¼–è¯‘å™¨çš„ç‰ˆæœ¬. ä»¥é¿å…å°†æ¥æ–°çš„ç¼–è¯‘å™¨å¯èƒ½ç ´åä½ çš„ä»£ç ã€‚\n\nä¾‹å¦‚: `pragma solidity ^0.4.0;` (å½“å‰ Solidity çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 0.4.0).\n\n> å…³é”®å­— `pragma` çš„å«ä¹‰æ˜¯ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œpragmasï¼ˆç¼–è¯‘æŒ‡ä»¤ï¼‰æ˜¯å‘ŠçŸ¥ç¼–è¯‘å™¨å¦‚ä½•å¤„ç†æºä»£ç çš„æŒ‡ä»¤çš„ï¼ˆä¾‹å¦‚ï¼Œ [pragma once](https://en.wikipedia.org/wiki/Pragma_once) ï¼‰ã€‚\n\n\n\nSolidityä¸­åˆçº¦çš„å«ä¹‰å°±æ˜¯ä¸€ç»„ä»£ç ï¼ˆå®ƒçš„ *å‡½æ•°* )å’Œæ•°æ®ï¼ˆå®ƒçš„ *çŠ¶æ€* ï¼‰ï¼Œå®ƒä»¬ä½äºä»¥å¤ªåŠåŒºå—é“¾çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šã€‚\n\nè¯¥åˆçº¦èƒ½å®Œæˆçš„äº‹æƒ…å¹¶ä¸å¤šï¼šå®ƒèƒ½å…è®¸ä»»ä½•äººåœ¨åˆçº¦ä¸­å­˜å‚¨ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°å­—å¯ä»¥è¢«ä¸–ç•Œä¸Šä»»ä½•äººè®¿é—®ï¼Œä¸”æ²¡æœ‰å¯è¡Œçš„åŠæ³•é˜»æ­¢ä½ å‘å¸ƒè¿™ä¸ªæ•°å­—ã€‚å½“ç„¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥å†æ¬¡è°ƒç”¨ `set` ï¼Œä¼ å…¥ä¸åŒçš„å€¼ï¼Œè¦†ç›–ä½ çš„æ•°å­—ï¼Œä½†æ˜¯è¿™ä¸ªæ•°å­—ä»ä¼šè¢«å­˜å‚¨åœ¨åŒºå—é“¾çš„å†å²è®°å½•ä¸­ã€‚\n\n\n\n> Solidity è¯­å¥ä»¥åˆ†å·ï¼ˆ**;**ï¼‰ç»“å°¾\n\n\n\n### çŠ¶æ€å˜é‡\n\n**çŠ¶æ€å˜é‡**æ˜¯è¢«æ°¸ä¹…åœ°ä¿å­˜åœ¨åˆçº¦ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬è¢«å†™å…¥ä»¥å¤ªå¸åŒºå—é“¾ä¸­ï¼Œæƒ³è±¡æˆå†™å…¥ä¸€ä¸ªæ•°æ®åº“ã€‚\n\n\n\n```javascript\ncontract HelloWorld {\n   // è¿™ä¸ªæ— ç¬¦å·æ•´æ•°å°†ä¼šæ°¸ä¹…çš„è¢«ä¿å­˜åœ¨åŒºå—é“¾ä¸­\n   uint myUnsignedInteger = 100;\n}\n```\n\n\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰ `myUnsignedInteger` ä¸º `uint` ç±»å‹ï¼Œå¹¶èµ‹å€¼100ã€‚\n\n> `uint` æ— ç¬¦å·æ•°æ®ç±»å‹ï¼Œ æŒ‡**å…¶å€¼ä¸èƒ½æ˜¯è´Ÿæ•°**ï¼Œå¯¹äºæœ‰ç¬¦å·çš„æ•´æ•°å­˜åœ¨åä¸º `int` çš„æ•°æ®ç±»å‹ã€‚\n>\n> Solidityä¸­ï¼Œ `uint` å®é™…ä¸Šæ˜¯ `uint256`ä»£åè¯ï¼Œ ä¸€ä¸ª256ä½çš„æ— ç¬¦å·æ•´æ•°ã€‚\n\n\n\nç¨‹åºæœ‰æ—¶éœ€è¦å¯¹ä¸åŒç±»å‹çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œå› ä¸º Solidity æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œå¯¹ä¸åŒç±»å‹çš„æ•°æ®è¿›è¡Œè¿ç®—ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ¯”å¦‚ï¼š\n\n```go\nuint8 a = 5;\nuint b = 6;\n// å°†ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸º a * b è¿”å› uint, è€Œä¸æ˜¯ uint8:\nuint8 c = a * b;\n```\n\n`a * b` è¿”å›ç±»å‹æ˜¯ `uint`, ä½†æ˜¯å½“æˆ‘ä»¬å°è¯•ç”¨ `uint8` ç±»å‹æ¥æ”¶æ—¶, å°±ä¼šé€ æˆæ½œåœ¨çš„é”™è¯¯ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦æ˜¾å¼çš„è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢ï¼š\n\n```go\n// æˆ‘ä»¬éœ€è¦å°† b è½¬æ¢ä¸º uint8:\nuint8 c = a * uint8(b);\n```\n\n\n\n> æŠŠå®ƒçš„æ•°æ®ç±»å‹è½¬æ¢ä¸º `uint8`, å°±å¯ä»¥äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šå‡ºé”™ã€‚\n\n\n\nSolidity æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ï¼š\n\n* stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå­—ç¬¦ä¸²ç”¨äºä¿å­˜ä»»æ„é•¿åº¦çš„ UTF-8 ç¼–ç æ•°æ®\n* fixedArrayï¼ˆé™æ€æ•°ç»„ï¼‰ï¼šå›ºå®šé•¿åº¦çš„æ•°ç»„\n* dynamicArrayï¼ˆåŠ¨æ€æ•°ç»„ï¼‰ï¼šé•¿åº¦ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å…ƒç´ çš„æ•°ç»„\n* enumï¼ˆæšä¸¾ï¼‰\n* mapping\n* ç­‰\n\n\n\n### æ•°å­¦è¿ç®—\n\n\n\nåœ¨ Solidity ä¸­ï¼Œæ•°å­¦è¿ç®—å¾ˆç›´è§‚æ˜äº†ï¼Œä¸å…¶å®ƒç¨‹åºè®¾è®¡è¯­è¨€ç›¸åŒ:\n\n- åŠ æ³•: `x + y`\n- å‡æ³•: `x - y`,\n- ä¹˜æ³•: `x * y`\n- é™¤æ³•: `x / y`\n- å–æ¨¡ / æ±‚ä½™: `x % y` *(ä¾‹å¦‚, 13 % 5 ä½™ 3, å› ä¸º13é™¤ä»¥5ï¼Œä½™3)*\n- ä¹˜æ–¹: `x ** y`\n\n\n\n### ç»“æ„ä½“\n\n\n\nSolidity æä¾›äº† `ç»“æ„ä½“`ï¼Œç”¨æ¥è¡¨ç¤ºæ›´å¤æ‚çš„æ•°æ®ç±»å‹ã€‚\n\n\n\n```c\nstruct Person {\n  uint age;\n  string name;\n}\n```\n\nç»“æ„ä½“å…è®¸ä½ ç”Ÿæˆä¸€ä¸ªæ›´å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå®ƒæœ‰å¤šä¸ªå±æ€§ã€‚\n\nåˆ›å»ºç»“æ„ä½“æ–¹å¼ä¸ºï¼š\n\n\n\n```go\n// åˆ›å»ºä¸€ä¸ªæ–°çš„Person:\nPerson satoshi = Person(172, \"Satoshi\");\n```\n\n\n\n### æ•°ç»„\n\nSolidity æä¾›ä¸¤ç§ç±»å‹çš„æ•°ç»„ï¼š`é™æ€æ•°ç»„`å’Œ`åŠ¨æ€æ•°ç»„`ã€‚\n\n\n\n```go\n// å›ºå®šé•¿åº¦ä¸º2çš„é™æ€æ•°ç»„:\nuint[2] fixedArray;\n// å›ºå®šé•¿åº¦ä¸º5çš„stringç±»å‹çš„é™æ€æ•°ç»„:\nstring[5] stringArray;\n// åŠ¨æ€æ•°ç»„ï¼Œé•¿åº¦ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å…ƒç´ :\nuint[] dynamicArray;\n```\n\nä½¿ç”¨ push å‡½æ•°å‘æ•°ç»„ä¸­æ·»åŠ å€¼ï¼š\n\n```javascript\nfixedArray.push[123] \nfixedArray.push[234]\n// fixedArray å€¼ä¸º [123, 234]\n```\n\n> `array.push()` åœ¨æ•°ç»„çš„ **å°¾éƒ¨** åŠ å…¥æ–°å…ƒç´  ï¼Œæ‰€ä»¥å…ƒç´ åœ¨æ•°ç»„ä¸­çš„é¡ºåºå°±æ˜¯æ·»åŠ çš„é¡ºåº\n> `array.push()` ä¼šè¿”å›æ•°ç»„çš„é•¿åº¦ã€‚\n\n\nSolidity æ•°ç»„æ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”å¦‚ç»“æ„ä½“ï¼š\n\n\n```c\nstruct Person {\n  uint age;\n  string name;\n}\n\nPerson[] people; // dynamic Array, we can keep adding to it\n```\n\n\n\nç»“æ„ä½“ç±»å‹çš„æ•°ç»„æ·»åŠ å€¼çš„æ–¹å¼ä¸ºï¼š\n\n```c\npeople.push(Person(16, \"Vitalik\"));\n// ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼Œæ¨èä½¿ç”¨ä¸Šè¿°ä¸€è¡Œç®€æ´çš„æ–¹å¼\n\nPerson satoshi = Person(172, \"Satoshi\");\npeople.push(satoshi);\n```\n\n\n\n#### å…¬å…±æ•°ç»„\n\n\n\nä¹Ÿå¯ä»¥ä½¿ç”¨`public`å®šä¹‰å…¬å…±æ•°ç»„ï¼ŒSolidity ä¼šè‡ªåŠ¨åˆ›å»º`getter`æ–¹æ³•ã€‚è¯­æ³•å¦‚ä¸‹ï¼š\n\n```c\nstruct Person {\n  uint age;\n  string name;\n}\n\nPerson[] public people; // dynamic Array, we can keep adding to it\n```\n\n\n\n> å…¬å…±æ•°ç»„æ”¯æŒå…¶å®ƒçš„åˆçº¦è¯»å–æ•°æ®ï¼ˆä½†ä¸èƒ½å†™å…¥æ•°æ®ï¼‰ï¼Œæ‰€ä»¥è¿™åœ¨åˆçº¦ä¸­æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ä¿å­˜å…¬å…±æ•°æ®çš„æ¨¡å¼ã€‚ï¼ˆæœ‰ç‚¹åƒå…¨å±€å˜é‡ï¼Œæ‰€æœ‰åˆçº¦å…±äº«åŒä¸€ä¸ªâ€œå†…å­˜ç©ºé—´â€œï¼Œå‰å®³äº†ï¼ï¼‰\n\n\n\n### å‡½æ•°\n\n\n\nSolidity ä¸­ï¼Œå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\n\n```javascript\nfunction eatHamburgers(string _name, uint _amount) {\n\n}\n```\n\n\n\n> `Solidity`  ä¹ æƒ¯ä¸Šå‡½æ•°é‡Œçš„å˜é‡éƒ½æ˜¯ä»¥(**_**)å¼€å¤´ (ä½†ä¸æ˜¯ç¡¬æ€§è§„å®š) ä»¥åŒºåˆ«å…¨å±€å˜é‡ã€‚\n\n\n\nè¿™æ˜¯ä¸€ä¸ªåä¸º `eatHamburgers` çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª `string`ç±»å‹çš„ å’Œ ä¸€ä¸ª `uint`ç±»å‹çš„ã€‚ç°åœ¨å‡½æ•°å†…éƒ¨è¿˜æ˜¯ç©ºçš„ã€‚\n\nå‡½æ•°è°ƒç”¨å¦‚ä¸‹ï¼š\n\n\n\n```go\neatHamburgers(\"vitalik\", 100);\n```\n\n\n\n#### ç§æœ‰/å…¬å…±å‡½æ•°\n\n\n\nSolidity å‡½æ•°åˆ†ä¸ºç§æœ‰å‡½æ•°å’Œå…±æœ‰å‡½æ•°ã€‚\n\n> Solidity å®šä¹‰çš„å‡½æ•°çš„å±æ€§é»˜è®¤ä¸º`å…¬å…±`ã€‚ è¿™å°±æ„å‘³ç€ä»»ä½•ä¸€æ–¹ (æˆ–å…¶å®ƒåˆçº¦) éƒ½å¯ä»¥è°ƒç”¨ä½ åˆçº¦é‡Œçš„å‡½æ•°ã€‚\n\n\n\næ˜¾ç„¶ï¼Œä¸æ˜¯ä»€ä¹ˆæ—¶å€™éƒ½éœ€è¦è¿™æ ·ï¼Œè€Œä¸”è¿™æ ·çš„åˆçº¦æ˜“äºå—åˆ°æ”»å‡»ã€‚æ‰€ä»¥å°†è‡ªå·±çš„å‡½æ•°å®šä¹‰ä¸º`ç§æœ‰`æ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œåªæœ‰å½“ä½ éœ€è¦å¤–éƒ¨ä¸–ç•Œè°ƒç”¨å®ƒæ—¶æ‰å°†å®ƒè®¾ç½®ä¸º`å…¬å…±`ã€‚\n>\n> å¯ä»¥æŠŠæ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¾å¼çš„å£°æ˜ `public`å’Œ`private`æ¥è§„é¿è¿™ä¸ªé—®é¢˜ã€‚\n\n\n\nå®šä¹‰ç§æœ‰å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨å‡½æ•°å‚æ•°åæ·»åŠ  `private`å…³é”®å­—å³å¯ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n\n\n```go\nuint[] numbers;\n\nfunction _addToArray(uint _number) private {\n  numbers.push(_number);\n}\n```\n\n\n\nè¿™æ„å‘³ç€åªæœ‰æˆ‘ä»¬åˆçº¦ä¸­çš„å…¶å®ƒå‡½æ•°æ‰èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç»™ `numbers`æ•°ç»„æ·»åŠ æ–°æˆå‘˜ã€‚\n\n> å’Œå‡½æ•°çš„å‚æ•°ç±»ä¼¼ï¼Œç§æœ‰å‡½æ•°çš„åå­—ç”¨(`_`)èµ·å§‹ã€‚\n\n\n\n> `æ³¨æ„ï¼š`åœ¨æ™ºèƒ½åˆçº¦ä¸­ä½ æ‰€ç”¨çš„ä¸€åˆ‡éƒ½æ˜¯å…¬å¼€å¯è§çš„ï¼Œå³ä¾¿æ˜¯å±€éƒ¨å˜é‡å’Œè¢«æ ‡è®°æˆ `private` çš„çŠ¶æ€å˜é‡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n\n\n\n#### è¿”å›å€¼\n\nå’Œå…¶å®ƒè¯­è¨€ä¸€æ ·ï¼ŒSolidity å‡½æ•°ä¹Ÿæœ‰è¿”å›å€¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n\n\n```go\nstring greeting = \"What's up dog\";\n\nfunction sayHello() public returns (string) {\n  return greeting;\n}\n```\n\n\n\nè¿”å›å€¼ä½¿ç”¨ `returns`å…³é”®å­—æ ‡æ³¨ã€‚ï¼ˆå·²ç»æ˜¯éå¸¸å¥‡æ€ªçš„å†™æ³•äº†ã€‚ã€‚ï¼‰\n\n\n\n#### ä¿®é¥°ç¬¦\n\n\n\n##### view\n\n> `constant` æ˜¯ `view` çš„åˆ«å\n\n\n\n```go\nstring greeting = \"What's up dog\";\n\nfunction sayHello() public returns (string) {\n  return greeting;\n}\n```\n\n\n\nåƒ `sayHello` å‡½æ•°è¿™ç§å®é™…ä¸Šæ²¡æœ‰æ”¹å˜åˆçº¦ä¸­æ•°æ®å†…å®¹çš„æƒ…å†µï¼Œå¯ä»¥æŠŠå‡½æ•°å®šä¹‰ä¸º`view`ï¼Œè¿™æ„å‘³ç€æ­¤å‡½æ•°åªè¯»ä¸ä¿®æ”¹æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å£°æ˜æ–¹å¼ï¼š\n\n\n\n```javascript\nfunction sayHello() public view returns (string) {}\n```\n\nå¯ä»¥å°†å‡½æ•°å£°æ˜ä¸º `view` ç±»å‹ï¼Œè¿™ç§æƒ…å†µä¸‹è¦ä¿è¯ä¸ä¿®æ”¹çŠ¶æ€ã€‚\n\nä¸‹é¢çš„è¯­å¥è¢«è®¤ä¸ºæ˜¯ä¿®æ”¹çŠ¶æ€ï¼š\n\n1. ä¿®æ”¹çŠ¶æ€å˜é‡ã€‚\n2. [äº§ç”Ÿäº‹ä»¶](https://solidity-cn.readthedocs.io/zh/develop/contracts.html#events)ã€‚\n3. [åˆ›å»ºå…¶å®ƒåˆçº¦](https://solidity-cn.readthedocs.io/zh/develop/control-structures.html#creating-contracts)ã€‚\n4. ä½¿ç”¨ `selfdestruct`ã€‚\n5. é€šè¿‡è°ƒç”¨å‘é€ä»¥å¤ªå¸ã€‚\n6. è°ƒç”¨ä»»ä½•æ²¡æœ‰æ ‡è®°ä¸º `view` æˆ–è€… `pure` çš„å‡½æ•°ã€‚\n7. ä½¿ç”¨ä½çº§è°ƒç”¨ã€‚\n8. ä½¿ç”¨åŒ…å«ç‰¹å®šæ“ä½œç çš„å†…è”æ±‡ç¼–ã€‚\n\n\n\n##### pure\n\npure æ¯” view æ›´è½»é‡ï¼Œä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦ä¿®é¥°çš„å‡½æ•°ç”šè‡³éƒ½ä¸ä¼šè¯»å–åˆçº¦ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š\n\n```javascript\nfunction _multiply(uint a, uint b) private pure returns (uint) { return a * b; }\n```\n\nè¿™ä¸ªå‡½æ•°æ²¡æœ‰è¯»å–åº”ç”¨é‡Œçš„çŠ¶æ€ï¼Œå®ƒçš„è¿”å›å€¼åªå’Œå®ƒè¾“å…¥çš„å‚æ•°ç›¸å…³ã€‚\n\n\n\n>  Solidity ç¼–è¾‘å™¨ä¼šç»™å‡ºæç¤ºï¼Œæé†’ä½ ä½¿ç”¨ pure/viewä¿®é¥°ç¬¦ã€‚\n\n\n\nå‡½æ•°å¯ä»¥å£°æ˜ä¸º `pure` ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰¿è¯ºä¸è¯»å–æˆ–ä¿®æ”¹çŠ¶æ€ã€‚\n\né™¤äº†ä¸Šé¢è§£é‡Šçš„çŠ¶æ€ä¿®æ”¹è¯­å¥åˆ—è¡¨ä¹‹å¤–ï¼Œä»¥ä¸‹è¢«è®¤ä¸ºæ˜¯ä»çŠ¶æ€ä¸­è¯»å–ï¼š\n\n1. è¯»å–çŠ¶æ€å˜é‡ã€‚\n2. è®¿é—® `this.balance` æˆ–è€… `<address>.balance`ã€‚\n3. è®¿é—® `block`ï¼Œ`tx`ï¼Œ `msg` ä¸­ä»»æ„æˆå‘˜ ï¼ˆé™¤ `msg.sig` å’Œ `msg.data` ä¹‹å¤–ï¼‰ã€‚\n4. è°ƒç”¨ä»»ä½•æœªæ ‡è®°ä¸º `pure` çš„å‡½æ•°ã€‚\n5. ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”æ±‡ç¼–ã€‚\n\n\n\n##### payable\n\n\n\npayable å…³é”®å­—ç”¨æ¥è¯´æ˜ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥æ¥å—ä»¥å¤ªå¸ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå…³é”®å­—ï¼Œå‡½æ•°ä¼šè‡ªåŠ¨æ‹’ç»æ‰€æœ‰å‘é€ç»™å®ƒçš„ä»¥å¤ªå¸ã€‚   \n\n\n\n### äº‹ä»¶\n\n**äº‹ä»¶** æ˜¯åˆçº¦å’ŒåŒºå—é“¾é€šè®¯çš„ä¸€ç§æœºåˆ¶ã€‚ä½ çš„å‰ç«¯åº”ç”¨â€œç›‘å¬â€æŸäº›äº‹ä»¶ï¼Œå¹¶åšå‡ºååº”ã€‚ä¾‹å¦‚ï¼š\n\n\n\n```javascript\n// è¿™é‡Œå»ºç«‹äº‹ä»¶\nevent IntegersAdded(uint x, uint y, uint result);\n\nfunction add(uint _x, uint _y) public {\n  uint result = _x + _y;\n  //è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥app\n  IntegersAdded(_x, _y, result);\n  return result;\n}\n```\n\n\n\nç”¨æˆ·ç•Œé¢ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼‰å¯ä»¥ç›‘å¬åŒºå—é“¾ä¸Šæ­£åœ¨å‘é€çš„äº‹ä»¶ï¼Œè€Œä¸ä¼šèŠ±è´¹å¤ªå¤šæˆæœ¬ã€‚ä¸€æ—¦å®ƒè¢«å‘å‡ºï¼Œç›‘å¬è¯¥äº‹ä»¶çš„listeneréƒ½å°†æ”¶åˆ°é€šçŸ¥ã€‚è€Œæ‰€æœ‰çš„äº‹ä»¶éƒ½åŒ…å«äº† `from` ï¼Œ `to` å’Œ `amount` ä¸‰ä¸ªå‚æ•°ï¼Œå¯æ–¹ä¾¿è¿½è¸ªäº‹åŠ¡ã€‚ ä¸ºäº†ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼ˆjavascript å®ç°ï¼‰ï¼š\n\n\n\n```javascript\nvar abi = /* abi ç”±ç¼–è¯‘å™¨äº§ç”Ÿ */;\nvar ClientReceipt = web3.eth.contract(abi);\nvar clientReceipt = ClientReceipt.at(\"0x1234...ab67\" /* åœ°å€ */);\n\nvar event = clientReceipt.IntegersAdded();\n\n// ç›‘è§†å˜åŒ–\nevent.watch(function(error, result){\n    // ç»“æœåŒ…æ‹¬å¯¹ `Deposit` çš„è°ƒç”¨å‚æ•°åœ¨å†…çš„å„ç§ä¿¡æ¯ã€‚\n    if (!error)\n        console.log(result);\n});\n\n// æˆ–è€…é€šè¿‡å›è°ƒç«‹å³å¼€å§‹è§‚å¯Ÿ\nvar event = clientReceipt.IntegersAdded(function(error, result) {\n    if (!error)\n        console.log(result);\n});\n```\n\n\n\n\n\n### ä»£ç ç¤ºä¾‹\n\nä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼š\n\n\n```javascript\npragma solidity ^0.4.19;\n\ncontract ZombieFactory {\n\n    // å»ºç«‹äº‹ä»¶\n    event NewZombie(uint zombieId, string name, uint dna);\n\n    uint dnaDigits = 16;  // å®šä¹‰çŠ¶æ€å˜é‡\n    uint dnaModulus = 10 ** dnaDigits;\n\n    struct Zombie {  // å®šä¹‰ç»“æ„ä½“\n        string name;\n        uint dna;\n    }\n\n    Zombie[] public zombies;  // å®šä¹‰åŠ¨æ€æ•°ç»„\n\n    // åˆ›å»ºç§æœ‰å‡½æ•°ï¼Œç§æœ‰å‡½æ•°å‘½åä½¿ç”¨ _ å‰ç¼€\n    function _createZombie(string _name, uint _dna) private {\n        // å‡½æ•°å‚æ•°å‘½å ä½¿ç”¨ _ ä½œä¸ºå‰ç¼€\n        // arrays.push() å°†å…ƒç´ åŠ å…¥åˆ°æ•°ç»„å°¾éƒ¨ï¼Œå¹¶ä¸”è¿”å›æ•°ç»„çš„é•¿åº¦\n        uint id = zombies.push(Zombie(_name, _dna)) - 1;\n        // è§¦å‘äº‹ä»¶\n        NewZombie(id, _name, _dna);\n    }\n\n    // view ä¸ºå‡½æ•°ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºæ­¤å‡½æ•°ä¸éœ€è¦æ›´æ–°æˆ–åˆ›å»ºçŠ¶æ€å˜é‡\n    // pure è¡¨ç¤ºå‡½æ•°ä¸éœ€è¦ä½¿ç”¨çŠ¶æ€å˜é‡\n    function _generateRandomDna(string _str) private view returns (uint) {\n        // ä½¿ç”¨ keccak256 åˆ›å»ºä¸€ä¸ªä¼ªéšæœºæ•°\n        uint rand = uint(keccak256(_str));\n        return rand % dnaModulus;\n    }\n\n    function createRandomZombie(string _name) public {\n        uint randDna = _generateRandomDna(_name);\n        _createZombie(_name, randDna);\n    }\n\n}\n\n```\n\n> Ethereum å†…éƒ¨æœ‰ä¸€ä¸ªæ•£åˆ—å‡½æ•°keccak256ï¼Œå®ƒç”¨äº†SHA3ç‰ˆæœ¬ã€‚ä¸€ä¸ªæ•£åˆ—å‡½æ•°åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª256ä½çš„16è¿›åˆ¶æ•°å­—ã€‚\n> åœ¨æ™ºèƒ½åˆçº¦ä¸­ä½¿ç”¨éšæœºæ•°å¾ˆéš¾ä¿è¯èŠ‚ç‚¹ä¸ä½œå¼Šï¼Œ è¿™æ˜¯å› ä¸ºæ™ºèƒ½åˆçº¦ä¸­çš„éšæœºæ•°ä¸€èˆ¬è¦ä¾èµ–è®¡ç®—èŠ‚ç‚¹çš„æœ¬åœ°æ—¶é—´å¾—åˆ°ï¼Œ è€Œæœ¬åœ°æ—¶é—´æ˜¯å¯ä»¥è¢«æ¶æ„èŠ‚ç‚¹ä¼ªé€ çš„ï¼Œå› æ­¤è¿™ç§æ–¹æ³•å¹¶ä¸å®‰å…¨ã€‚ é€šè¡Œçš„åšæ³•æ˜¯é‡‡ç”¨ é“¾å¤–off-chain çš„ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæ¯”å¦‚ Oraclize æ¥è·å–éšæœºæ•°ï¼‰ã€‚\n\n\n### å‚è€ƒé“¾æ¥\n\n- [Solidity æ–‡æ¡£: https://solidity-cn.readthedocs.io/zh/develop/index.html](https://solidity-cn.readthedocs.io/zh/develop/index.html)\n- [cryptozombie-lessons: https://cryptozombies.io/zh/](https://cryptozombies.io/zh/)\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![](http://media.gusibi.mobi/ah0mqMXMtdJb9Yj03suu-NGEyVRxyEuOIT5bXSv7ip5aqtHkiRjTTl8SMRMv3Qp5?)\n",
      "data": {
        "title": "Solidity ç®€æ˜“æ•™ç¨‹",
        "date": "2018-09-04 13:36:53",
        "tags": [
          "åŒºå—é“¾",
          "ä»¥å¤ªåŠ",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "solidity-simple-guide"
    },
    {
      "content": "\næœ€è¿‘æœ‰æ–‡å­—è½¬å›¾ç‰‡çš„éœ€æ±‚ï¼Œä½†æ˜¯ä¸å¤ªæƒ³ä¸‹è½½ APPï¼Œå°±ä½¿ç”¨ Python **Pillow** å®ç°äº†ä¸€ä¸ªï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n\n![æ–‡å­—è½¬å›¾ç‰‡æ­¥éª¤](http://note.gusibi.mobi/oRWAws7M4TDPnm7I8nt6Rp9dbAO8_1531017842.png)\n\n\n\nPIL æä¾›äº† `PIL.ImageDraw.ImageDraw.text` æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿çš„æŠŠæ–‡å­—å†™åˆ°å›¾ç‰‡ä¸Šï¼Œç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n\n\n```python\nfrom PIL import Image, ImageDraw, ImageFont\n# get an image\nbase = Image.open('Pillow/Tests/images/hopper.png').convert('RGBA')\n\n# make a blank image for the text, initialized to transparent text color\ntxt = Image.new('RGBA', base.size, (255,255,255,0))\n\n# get a font\nfnt = ImageFont.truetype('Pillow/Tests/fonts/FreeMono.ttf', 40)\n# get a drawing context\nd = ImageDraw.Draw(txt)\n\n# draw text, half opacity\nd.text((10,10), \"Hello\", font=fnt, fill=(255,255,255,128))\n# draw text, full opacity\nd.text((10,60), \"World\", font=fnt, fill=(255,255,255,255))\n\nout = Image.alpha_composite(base, txt)\n\nout.show()\n```\n\n\n\n> ä¸ºä»€ä¹ˆè¦è®¡ç®—æ–‡å­—çš„å®½é«˜å‘¢ï¼ŸæŠŠæ–‡å­—ç›´æ¥å†™åˆ°èƒŒæ™¯å›¾ä¸å¯ä»¥ä¹ˆï¼Ÿ\n\n\n\n**Pillow** `PIL.ImageDraw.ImageDraw.text`å†™æ–‡å­—æ˜¯æŒ‰æ¢è¡Œç¬¦`\\n`æ¢è¡Œçš„ï¼Œå¦‚æœä¸ªå­—ç¬¦ä¸²ç‰¹åˆ«é•¿ï¼Œæ–‡å­—éƒ¨åˆ†å°±ä¼šè¶…å‡ºèƒŒæ™¯å›¾çš„å®½åº¦ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦å…ˆæŠŠæ–‡æœ¬æŒ‰å›ºå®šçš„å®½åº¦è®¡ç®—å‡ºé«˜åº¦ã€‚\n\n\n\nåƒå›¾ä¸Šå†™çš„è¿™æ ·ï¼Œæ–‡å­—è½¬å›¾ç‰‡åˆ†ä¸‰æ­¥ï¼š\n\n1. è®¡ç®—æ–‡å­—å®½é«˜\n2. ç”Ÿæˆå“åº”å°ºå¯¸èƒŒæ™¯å›¾\n3. æŠŠæ–‡å­—å†™åˆ°å›¾ç‰‡ä¸Š\n\n\n\n### è®¡ç®—æ–‡å­—å®½é«˜\n\n\n\nè¿™é‡ŒèƒŒæ™¯å›¾å®½åº¦æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æ–‡å­—çš„å®½å¯ä»¥ä¸ç”¨è®¡ç®—ã€‚`PIL.ImageDraw.ImageDraw.text` æ˜¯é€šè¿‡`\\n`æ¥æ¢è¡Œçš„ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦åœ¨æ–‡å­—åˆé€‚çš„ä½ç½®åŠ ä¸Š`\\n`å°±å¯ä»¥äº†ã€‚\n\nç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯ `textwrap` æ–¹æ³•ï¼Œtextwrap å¯ä»¥å®ç°é€šè¿‡è°ƒæ•´æ¢è¡Œç¬¦çš„ä½ç½®æ¥æ ¼å¼åŒ–æ–‡æœ¬ã€‚ä½† textwrap è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å®ƒæ˜¯æ ¹æ®å­—ç¬¦é•¿åº¦æ¥åˆ†éš”çš„ï¼Œä½†æ–‡æœ¬ä¸­çš„å­—ç¬¦å¹¶ä¸æ˜¯ç­‰å®½çš„ï¼Œé€šè¿‡`textwrap`æ ¼å¼åŒ–åçš„æ–‡å­—å†™åˆ°å›¾ç‰‡ä¸Šæ•ˆæœå¯èƒ½æ˜¯è¿™æ ·çš„ï¼š\n\n![ä½¿ç”¨ textwrap æ ¼å¼åŒ–åæ–‡å­—æ•ˆæœ](http://media.gusibi.mobi/5eyQdzV0RMDigRT1sqQIsxJ6MdhEgaEUEM05yThoGXQmVQAaYiildNJ0N2dDAYep)\n\n\n\n> ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒæ•´å­—ä½“å¤§å°ï¼Œæ¯ä¸€è¡Œçš„é•¿åº¦éƒ½è¿˜éœ€è¦å†é‡æ–°è°ƒæ•´ã€‚\n\n\n\nä¸ºäº†ä¿è¯æ¯ä¸€è¡Œå®½åº¦å°½å¯èƒ½çš„ä¸€è‡´ï¼Œè¿™é‡Œä½¿ç”¨ `PIL.ImageDraw.ImageDraw.textsize` è·å–å­—ç¬¦å®½é«˜ï¼Œç„¶åæŒ‰çº¦å®šå®½åº¦æŠŠé•¿æ–‡æœ¬åˆ†éš”æˆæ–‡æœ¬åˆ—è¡¨ï¼Œç„¶åæŠŠåˆ—è¡¨æ¯è¡Œæ–‡å­—å†™åˆ°å›¾ç‰‡ä¸Šã€‚\n\n\n\n```python\ndef get_paragraph(text, note_width):\n    # æŠŠæ¯æ®µæ–‡å­—æŒ‰çº¦å®šå®½åº¦åˆ†éš”æˆå‡ è¡Œ\n    txt = Image.new('RGBA', (100, 100), (255, 255, 255, 0))\n    # get a drawing context\n    draw = ImageDraw.Draw(txt)\n    paragraph, sum_width = '', 0\n    line_numbers, line_height = 1, 0\n    for char in text:\n        w, h = draw.textsize(char, font)\n        sum_width += w\n        if sum_width > note_width:\n            line_numbers += 1\n            sum_width = 0\n            paragraph += '\\n'\n        paragraph += char\n        line_height = max(h, line_height)\n    if not paragraph.endswith('\\n'):\n        paragraph += '\\n'\n    return paragraph, line_height, line_numbers\n\n\ndef split_text(text):\n    # å°†æ–‡æœ¬æŒ‰è§„å®šå®½åº¦åˆ†ç»„\n    max_line_height, total_lines = 0, 0\n    paragraphs = []\n    for t in text.split('\\n'):\n        # å…ˆæŒ‰ \\n æŠŠæ–‡æœ¬åˆ†æ®µ\n        paragraph, line_height, line_numbers = get_paragraph(t)\n        max_line_height = max(line_height, max_line_height)\n        total_lines += line_numbers\n        paragraphs.append((paragraph, line_numbers))\n    line_height = max_line_height\n    total_height = total_lines * line_height\n    # è¿™é‡Œè¿”å›åˆ†å¥½çš„æ®µï¼Œæ–‡æœ¬æ€»é«˜åº¦ä»¥åŠè¡Œé«˜\n    return paragraphs, total_height, line_height\n```\n\n\n\nè¿™æ˜¯æŒ‰å­—ç¬¦å®½åº¦åˆ†éš”æ–‡æœ¬å†™åˆ°å›¾ç‰‡çš„æ•ˆæœï¼š\n\n\n\n![è®¡ç®—å­—ç¬¦å®½åº¦åæ ¼å¼åŒ–æ•ˆæœ](http://media.gusibi.mobi/c6HsAdeihOmRnO5WtppOXWOmiiyB3rh5AW82fmUDEg35EjKzt-o5yGWQcJWQaSCq)\n\n\n\n> ç”±äºæ–‡æœ¬é•¿åº¦ä¸å›ºå®šï¼Œç”Ÿæˆå¾—åˆ°çš„æ–‡æœ¬é«˜åº¦ä¹Ÿä¸å›ºå®šï¼ŒèƒŒæ™¯å›¾æˆ‘ä»¬ä¹Ÿéœ€è¦åŠ¨æ€ç”Ÿæˆ\n\n\n\n### æ ¹æ®æ–‡æœ¬é«˜åº¦ç”ŸæˆèƒŒæ™¯å›¾\n\n\n\n![ä¾¿ç­¾å›¾ç‰‡](http://media.gusibi.mobi/OjG3S1KAtlLVG7NYgnaabCQzCLwzSGlVaeSinqc0tzXZNQuzZHAD9ZLRBb8zsL0v)\n\n\n\né€šè¿‡å›¾ç‰‡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¤´éƒ¨å’Œå°¾éƒ¨æ˜¯å›ºå®šçš„ï¼Œå˜åŒ–çš„æ˜¯æ–‡å­—éƒ¨åˆ†ï¼Œé‚£ä¹ˆèƒŒæ™¯å›¾ç‰‡çš„é«˜åº¦è®¡ç®—å…¬å¼ä¸º\n\n\n\n> èƒŒæ™¯å›¾ç‰‡é«˜åº¦=å¤´éƒ¨é«˜åº¦+å°¾éƒ¨é«˜åº¦+æ–‡æœ¬é«˜åº¦\n\nå®ç°ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nNOTE_HEADER_IMG = path.normpath(path.join(\n    path.dirname(__file__), 'note_header_660.png'))\nNOTE_BODY_IMG = path.normpath(path.join(\n    path.dirname(__file__), 'note_body_660.png'))\nNOTE_FOOTER_IMG = path.normpath(path.join(\n    path.dirname(__file__), 'note_footer_660.png'))\nNOTE_WIDTH = 660\nNOTE_TEXT_WIDTH = 460\nbody_height = NOTE_BODY_HEIGHT = 206\nheader_height = NOTE_HEADER_HEIGHT = 89\nfooter_height = NOTE_FOOTER_HEIGHT = 145\nfont = ImageFont.truetype(NOTE_OTF, 24)\n\n\n\ndef get_images(note_height):\n    numbers = note_height // body_height + 1\n    images = [(NOTE_HEADER_IMG, header_height)]\n    images.extend([(NOTE_BODY_IMG, body_height)] * numbers)\n    images.append((NOTE_FOOTER_IMG, footer_height))\n    return images\n\n\ndef make_backgroud():\n    # å°†å›¾ç‰‡æ‹¼æ¥åˆ°ä¸€èµ·\n    images = get_images()\n    total_height = sum([height for _, height in images])\n    # æœ€ç»ˆæ‹¼æ¥å®Œæˆåçš„å›¾ç‰‡\n    backgroud = Image.new('RGB', (body_width, total_height))\n    left, right = 0, 0\n    background_img = '/tmp/%s_backgroud.png' % total_height\n    # åˆ¤æ–­èƒŒæ™¯å›¾æ˜¯å¦å­˜åœ¨\n    if path.exists(background_img):\n        return background_img\n    for image_file, height in images:\n        image = Image.open(image_file)\n        # (0, left, self.body_width, right+height)\n        # åˆ†åˆ«ä¸º å·¦ä¸Šè§’åæ ‡ 0, left\n        # å³ä¸‹è§’åæ ‡ self.body_width, right+height\n        backgroud.paste(image, (0, left, body_width, right+height))\n        left += height  # ä»ä¸Šå¾€ä¸‹æ‹¼æ¥ï¼Œå·¦ä¸Šè§’çš„çºµåæ ‡é€’å¢\n        right += height  # å·¦ä¸‹è§’çš„çºµåæ ‡ä¹Ÿé€’å¢\n    backgroud.save(background_img, quality=85)\n    return background_img\n```\n\n\n\n### å°†æ–‡å­—å†™åˆ°å›¾ç‰‡\n\n\n\nç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†èƒŒæ™¯å›¾ä»¥åŠåˆ†éš”å¥½çš„æ–‡æœ¬ï¼Œå°±å¯ä»¥ç›´æ¥å°†æ–‡æœ¬å†™åˆ°å›¾ç‰‡ä¸Šäº†\n\n\n\n```python\ndef draw_text(paragraphs, height):\n    background_img = make_backgroud()\n    note_img = Image.open(background_img).convert(\"RGBA\")\n    draw = ImageDraw.Draw(note_img)\n    # æ–‡å­—å¼€å§‹ä½ç½®åæ ‡ï¼Œéœ€è¦æ ¹æ®èƒŒæ™¯å›¾çš„å¤§å°åšè°ƒæ•´\n    x, y = 80, 100\n    for paragraph, line_numbers in paragraphs:\n        for line in paragraph.split('\\n')[:-1]:\n            draw.text((x, y), line, fill=(110, 99, 87), font=font)\n            y += line_height\n        # draw.text((x, y), paragraph, fill=(110, 99, 87), font=font)\n        # y += self.line_height * line_numbers\n    note_img.save(filename, \"png\", quality=1, optimize=True)\n    return filename\n```\n\n\n\nå®Œæ•´ç‰ˆä»£ç è¯·æŸ¥çœ‹ [https://github.com/gusibi/momo/blob/master/momo/note.py][https://github.com/gusibi/momo/blob/master/momo/note.py]\n\n\n\næ‰§è¡Œåæ•ˆæœå¦‚å›¾ï¼š\n\n\n\n![](http://note.gusibi.mobi/oRWAws7M4TDPnm7I8nt6Rp9dbAO8_1531033396.png)\n\n\n\n### é‡åˆ°çš„é—®é¢˜\n\n\n\nä¸ºäº†èƒ½æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘æŠŠè¿™ä¸ªåšæˆäº†å…¬å·çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç„¶åé‡åˆ°äº†ä¸€ä¸ªä¸¥é‡é—®é¢˜ï¼Œ**å¤ªæ…¢äº†ï¼**\n\n\n\nä½¿ç”¨ `line_profiler` åˆ†æå¯ä»¥å‘ç°ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ¶ˆè€—åœ¨äº†å›¾ç‰‡ä¿å­˜è¿™ä¸€æ­¥ï¼Œ\n\n```python\nnote_img.save(filename, \"png\", quality=1, optimize=True)\n```\n\n\n\n> æ€§èƒ½åˆ†æå·¥å…·ä¹Ÿä¼šå ç”¨æ—¶é—´ï¼Œæµ‹è¯•å®Œæˆåéœ€è¦å…³é—­åˆ†æ\n\n\n\nè§£å†³è¿™ä¸ªé—®é¢˜å¯èƒ½çš„æ–¹æ³•ï¼š\n\n1. å‡å°èƒŒæ™¯å›¾ç‰‡å¤§å°\n2. å‡å°å­—ä½“å¤§å°\n\n\n\né€šè¿‡æµ‹è¯•ï¼Œå‘ç°æŠŠèƒŒæ™¯å›¾å®½åº¦ä»990å‡åˆ°660ï¼Œå­—ä½“å¤§å°ä»40px è°ƒæ•´åˆ°24pxï¼Œç”Ÿæˆçš„å›¾ç‰‡å¤§å°ä½“ç§¯ç¼©å°äº†æ¥è¿‘1å€ï¼Œç”Ÿæˆé€Ÿåº¦ä¹Ÿæ¯”åŸæ¥å¿«äº†2/5ã€‚\n\n\n\n> ç›¸åŒä»£ç ï¼Œç›¸åŒæ–‡æœ¬ï¼Œä½¿ç”¨ python3 åªç”¨äº†2.3sï¼Œè€Œ Python2 ç”¨æ—¶å´æ˜¯5.3 sï¼Œè¿˜ä»æ¥æ²¡åœ¨å…¶å®ƒåŠŸèƒ½ä¸Šé‡åˆ°è¿‡ Python2 å’Œ Python3 æœ‰è¿™ä¹ˆå¤§çš„å·®åˆ«ã€‚\n>\n> > å…·ä½“å·®å¼‚å¯ä»¥ä½¿ç”¨æºç æµ‹è¯•ä¸€ä¸‹\n\n\n\n#### è¿˜æ˜¯æœ‰é—®é¢˜\n\nä¼˜åŒ–å®Œå›¾ç‰‡ç”Ÿæˆé€Ÿåº¦åï¼Œå‘ç°åœ¨é•¿æ–‡æœ¬çŠ¶æ€ä¸‹ï¼Œå…¬å·è¿˜æ˜¯ä¼šè¶…æ—¶æŠ¥é”™ã€‚ç»è¿‡æ£€æŸ¥å‘ç°æ˜¯å›¾ç‰‡ä¸Šä¼ åˆ°å…¬ä¼—å¹³å°å¤ªæ…¢äº†ï¼ˆæœåŠ¡å™¨åªæœ‰1M å¸¦å®½ï¼Œæ²¡æœ‰åŠæ³•.ï¼‰ã€‚\n\n\n\n> è§£å†³æ–¹æ³•ï¼ŒæŠŠå›¾ç‰‡ä¸Šä¼ åˆ°è…¾è®¯äº‘ï¼ˆæ–‡ä»¶ä¸Šä¼ ä½¿ç”¨çš„æ˜¯å†…ç½‘å¸¦å®½ï¼Œä¸å—é™åˆ¶ï¼‰ï¼Œè¿”å›å›¾ç‰‡ urlã€‚\n\n\n\n![](http://media.gusibi.mobi/QoT4slWjqm_MtC910mPpJqhzlRmEpz75vGh1T4Oip_Zj3FrHIeQtZxi2imzLE1ex)\n\n## å‚è€ƒé“¾æ¥\n\n\n------\n\n\n***æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Python ç”Ÿæˆä¾¿ç­¾å›¾ç‰‡",
        "date": "2018-07-08 07:04:52",
        "tags": [
          "python",
          "tutorial",
          "weixin",
          "å…¬ä¼—å·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python_text_to_image"
    },
    {
      "content": "\n## UNIX è¿›ç¨‹\n\n### ç³»ç»Ÿè°ƒç”¨\n\nUnix ç³»ç»Ÿæ˜¯ç”±ç”¨æˆ·ç©ºé—´ï¼ˆuserlandï¼‰å’Œå†…æ ¸ç»„æˆã€‚Unix å†…æ ¸ä½äºè®¡ç®—æœºç¡¬ä»¶ä¹‹ä¸Šï¼Œæ˜¯ä¸ç¡¬ä»¶äº¤äº’çš„ä¸­ä»‹ã€‚è¿™äº›äº¤äº’åŒ…æ‹¬é€šè¿‡é—®å·ç³»ç»Ÿè¿›ç¨‹è¯»/å†™ã€åœ¨ç½‘ç»œä¸Šå‘é€æ•°æ®ã€åˆ†é…å†…å­˜ï¼Œä»¥åŠé€šè¿‡æ‰¬å£°å™¨æ’­æ”¾éŸ³é¢‘ã€‚è¿™äº›éƒ½æ˜¯ç”¨æˆ·åº”ç”¨ç¨‹åºæ‰€ä¸èƒ½æ¶‰åŠçš„ï¼Œåªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆã€‚\n\n> `ç³»ç»Ÿè°ƒç”¨`ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´æ­å»ºäº†æ¡¥æ¢ã€‚è§„å®šäº†ç¨‹åºå’Œè®¡ç®—æœºç¡¬ä»¶ç›´æ¥æ‰€å…è®¸å‘ç”Ÿçš„ä¸€åˆ‡äº¤äº’ã€‚\n\nè¿›ç¨‹æ˜¯ Unix ç³»ç»Ÿçš„åŸºçŸ³ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½æ˜¯åœ¨è¿›ç¨‹ä¸­è¿è¡Œã€‚\n\nunix ä¸­çš„è¿›ç¨‹åˆ›å»ºæ˜¯é€šè¿‡å†…æ ¸ç³»ç»Ÿè°ƒç”¨ fork() å®ç°çš„ã€‚å½“ä¸€ä¸ªè¿›ç¨‹äº§ç”Ÿä¸€ä¸ª fork è¯·æ±‚æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹åŠŸèƒ½ï¼š\n\n1. ä¸ºæ–°è¿›ç¨‹åœ¨è¿›ç¨‹è¡¨ä¸­åˆ†é…ä¸€ä¸ªç©ºé¡¹\n2. ä¸ºå­è¿›ç¨‹èµ‹ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹æ ‡è¯†ç¬¦\n3. ä¸ºä¸€ä¸ªçˆ¶è¿›ç¨‹ä¸Šä¸‹æ–‡çš„é€»è¾‘å‰¯æœ¬ï¼Œä¸åŒ…æ‹¬å…±äº«å†…å­˜åŒº\n4. å¢åŠ çˆ¶è¿›ç¨‹æ‹¥æœ‰çš„æ‰€æœ‰æ–‡ä»¶çš„è®¡æ•°å™¨ï¼Œä»¥è¡¨ç¤ºæœ‰ä¸€ä¸ªå¦å¤–çš„è¿›ç¨‹ç°åœ¨ä¹Ÿç”¨æˆ·è¿™äº›æ–‡ä»¶ã€‚\n5. æŠŠå­è¿›ç¨‹ç½®ä¸ºå°±ç»ªæ€\n6. å‘çˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹çš„è¿›ç¨‹å·ï¼›å¯¹å­è¿›ç¨‹è¿”å›0ã€‚\n\næ‰€æœ‰è¿™äº›æ“ä½œéƒ½åœ¨çˆ¶è¿›ç¨‹çš„å†…æ ¸æ€ä¸‹å®Œæˆã€‚\n\n### è¿›ç¨‹çš†æœ‰æ ‡è¯†\n\nåœ¨ç³»ç»Ÿä¸­è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œç§°ä¸º pidã€‚\n\n> pid å¹¶ä¸ä¼ è¾¾å…³äºè¿›ç¨‹æœ¬èº«çš„ä»»ä½•ä¿¡æ¯ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªæ•°å­—æ ‡è¯†\n\nåœ¨ python ä¸­æŸ¥çœ‹å½“å‰è¿›ç¨‹ pid å¯ä»¥ä½¿ç”¨ `getpid()` æ–¹æ³•ã€‚\n\n```python\n>>> import os\n\n>>> print os.getpid()\n26164\n```\n\n> åœ¨å®é™…åº”ç”¨ä¸­ï¼Œpid å¯ä»¥åŠ å…¥éƒ½æ—¥å¿—ä¿¡æ¯ä¸­ï¼Œè¿™æ ·å½“å¤šä¸ªè¿›ç¨‹å‘åŒä¸€ä¸ªæ–‡ä»¶å†™å…¥æ—¥å¿—çš„æ—¶å€™ï¼Œå°±å¯ä»¥çŸ¥é“å“ªä¸€è¡Œæ˜¯ç”±å“ªä¸ªè¿›ç¨‹å†™å…¥çš„ã€‚\n\n### è¿›ç¨‹çš†æœ‰çˆ¶\n\nç³»ç»Ÿä¸­è¿è¡Œçš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰å¯¹åº”çš„çˆ¶è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½çŸ¥é“å®ƒçˆ¶è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼ˆppidï¼‰ã€‚\n\nåœ¨ python ä¸­æŸ¥çœ‹å½“å‰è¿›ç¨‹ pid å¯ä»¥ä½¿ç”¨ `getppid()` æ–¹æ³•ã€‚\n\n```python\n>>> import os\n\n>>> print os.getpid()\n26164\n>>> print os.getppid()\n26125\n```\n\n### è¿›ç¨‹çš†æœ‰æ–‡ä»¶æè¿°ç¬¦\n\nåœ¨ Unix ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ã€‚\n\n![ä¸€åˆ‡çš†æ–‡ä»¶](<http://media.gusibi.mobi/7_BEou-9LxGREQm2CyB18Oeb93T8Pp_shyshaDgE5teiRCA48OatdxhJWq8J07wF>)\n\næ— è®ºä½•æ—¶åœ¨è¿›ç¨‹ä¸­æ‰“å¼€ä¸€ä¸ªèµ„æºï¼Œä½ éƒ½ä¼šè·å¾—ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç¼–å·ï¼ˆfile description numberï¼‰ã€‚æ–‡ä»¶æè¿°ç¬¦å¹¶ä¸ä¼šåœ¨æ— å…³è¿›ç¨‹ä¹‹é—´å…±äº«ï¼Œå®ƒåªå­˜åœ¨äºå…¶æ‰€å±çš„è¿›ç¨‹ä¹‹ä¸­ã€‚\n\n```python\n#! -*- coding: utf-8 -*-\n\nimport os\n\np = open('test.txt', 'wb')\nprint(p.name, p.fileno())\n\np1 = open('test1.txt', 'wb')\nprint(p1.name, p1.fileno())\n\np.close()\n\np2 = open('test2.txt', 'wb')\nprint(p2.name, p2.fileno())\n\nprint(p.name, p.fileno())\n```\n\n\nè¾“å‡ºï¼š\n\n```shell\ntest.txt 3\ntest1.txt 4\ntest2.txt 3\nTraceback (most recent call last):\n  File \"/Users/gs/Desktop/fdn.py\", line 16, in <module>\n    print(p.name, p.fileno())\nValueError: I/O operation on closed file\n```\n\n\n> è¿›ç¨‹æ‰“å¼€æ‰€æœ‰èµ„æºéƒ½ä¼šè·å¾—ä¸€ä¸ªç”¨äºæ ‡è¯†çš„å”¯ä¸€æ•°å­—ã€‚\n>\n> æ‰“å¼€å¤šä¸ªèµ„æºæ‰€åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦ç¼–å·æ˜¯å°šæœªä½¿ç”¨çš„æœ€å°çš„æ•°å€¼ã€‚\n>\n> èµ„æºä¸€æ—¦å…³é—­ï¼Œå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ç¼–å·å°±ä¼šé‡Šæ”¾åˆèƒ½ç»§ç»­ä½¿ç”¨äº†ã€‚\n>\n> æ–‡ä»¶æè¿°ç¬¦åªæ˜¯ç”¨æ¥è·Ÿè¸ªæ‰“å¼€çš„èµ„æºï¼Œå·²ç»å…³é—­çš„èµ„æºæ˜¯æ²¡æœ‰æ–‡ä»¶æè¿°ç¬¦çš„ã€‚\n\næ ‡å‡†æµ\n\næ¯ä¸ª Unix è¿›ç¨‹éƒ½æœ‰ä¸‰ä¸ªæ‰“å¼€çš„èµ„æºï¼Œå®ƒä»¬æ˜¯æ ‡å‡†è¾“å…¥ï¼ˆSTDINï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆSTDOUTï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆSTDERRï¼‰ã€‚\n\n* STDIN æä¾›äº†ä¸€ç§ä»é”®ç›˜æˆ–ç®¡é“ä¸­è¯»å–è¾“å…¥çš„é€šç”¨æ–¹æ³•\n* STDOUT å’Œ STDERR æä¾›äº†ä¸€ç§å‘æ˜¾ç¤ºå™¨ã€æ–‡ä»¶æˆ–æ‰“å°æœºç­‰è¾“å‡ºå†™å…¥å†…å®¹çš„é€šç”¨æ–¹æ³•ã€‚\n* STDINã€STDOUTã€STDERR ä¹Ÿæ˜¯æ–‡ä»¶\n\n```python\nimport sys\n\nprint(sys.stdin.fileno())\nprint(sys.stdout.fileno())\nprint(sys.stderr.fileno())\n```\n\nè¾“å‡ºï¼š\n\n```shell\n0\n1\n2\n```\n\n### è¿›ç¨‹çš†æœ‰èµ„æºé™åˆ¶\n\n> æ–‡ä»¶æè¿°ç¬¦ä»£è¡¨å·²æ‰“å¼€çš„èµ„æºï¼Œå½“èµ„æºæ²¡æœ‰è¢«å…³é—­çš„æ—¶å€™ï¼Œæ–‡ä»¶æè¿°ç¬¦ç¼–å·ä¼šä¸€ç›´é€’å¢ï¼Œé‚£ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šå°‘ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘¢ï¼Ÿ\n\nå¯ä»¥ä½¿ç”¨`getrlimit`æ‰¾å‡ºé™åˆ¶ï¼š\n\n```python\nimport resource\n\nprint(resource.getrlimit(resource.RLIMIT_NOFILE))\n```\n\nè¾“å‡ºï¼š\n\n```shell\n(10496, 9223372036854775807)\n```\n\n\n\nå¯ä»¥çœ‹åˆ°è¾“å‡ºçš„ç»“æœæ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œé‡Œè¾¹æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ–‡ä»¶æè¿°ç¬¦çš„è½¯é™åˆ¶ï¼Œç¬¬äºŒä¸ªæ˜¯æ–‡ä»¶æè¿°ç¬¦çš„ç¡¬é™åˆ¶ã€‚\n\n> `è½¯é™åˆ¶`ï¼šè½¯é™åˆ¶å…¶å®ä¸ç®—é™åˆ¶ï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥ä¿®æ”¹è¿™ä¸ªå€¼ã€‚è¶…å‡ºè¿™ä¸ªå€¼åä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\n>\n> `ç¡¬é™åˆ¶`: ç¡¬é™åˆ¶åªæœ‰è¶…çº§ç”¨æˆ·æ‰èƒ½ä¿®æ”¹ï¼Œä½†æ˜¯ç¡¬é™åˆ¶å…¶å®æ˜¯ä¸€ä¸ªæ— é™å¤§çš„æ•°å­—ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯æ²¡æœ‰é™åˆ¶ã€‚\n\n`getrlimit`è¿˜å¯ä»¥æŸ¥è¯¢å…¶å®ƒé™åˆ¶ï¼Œæ¯”å¦‚ï¼š\n\n* `RLIMIT_NPROC`  ç”¨æˆ·å¯æ‹¥æœ‰çš„æœ€å¤§è¿›ç¨‹æ•°\n* `RLIMIT_FSIZE` è¿›ç¨‹å¯åˆ›å»ºçš„æœ€å¤§æ–‡ä»¶ã€‚å¦‚æœè¿›ç¨‹è¯•å›¾è¶…å‡ºè¿™ä¸€é™åˆ¶æ—¶ï¼Œæ ¸å¿ƒä¼šç»™å…¶å‘é€SIGXFSZä¿¡å·ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ç»ˆæ­¢è¿›ç¨‹çš„æ‰§è¡Œã€‚\n\nè¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ [Recource æ–‡æ¡£](https://docs.python.org/2/library/resource.html)\n\nå¯ä»¥ä½¿ç”¨ `setrlimit`æ¥ä¿®æ”¹è½¯é™åˆ¶ï¼š\n\n```python\nimport resource\n\nprint(resource.getrlimit(resource.RLIMIT_NOFILE))\nresource.setrlimit(resource.RLIMIT_NOFILE, (2048, resource.RLIM_INFINITY))\nprint(resource.getrlimit(resource.RLIMIT_NOFILE))\n```\n\nè¾“å‡ºï¼š\n\n```shell\n(10496, 9223372036854775807)\n(2048, 9223372036854775807)\n```\n\n> `ç¡¬é™åˆ¶`çš„å¤§å°ä¸å»ºè®®ä¿®æ”¹ï¼Œå› ä¸ºå®ƒæ˜¯ä¸å¯é€†çš„ã€‚\n\npython ä¸­å¦‚æœè¶…å‡ºäº†è½¯é™åˆ¶ï¼Œä¼šæŠ›å‡º OSErrorï¼š\n\n```python\nimport resource\n\nresource.setrlimit(resource.RLIMIT_NOFILE, (3, resource.RLIM_INFINITY))\nprint(resource.getrlimit(resource.RLIMIT_NOFILE))\n\np = open('test.txt', 'wb')\nprint(p.name, p.fileno())\n```\n\nè¾“å‡ºï¼š\n\n```python\n(3, 9223372036854775807)\nTraceback (most recent call last):\n  File \"/Users/gs/Desktop/fdn.py\", line 30, in <module>\nOSError: [Errno 24] Too many open files: 'test.txt'\n```\n\n> å¤šæ•°ç¨‹åºæ˜¯ä¸éœ€è¦ä¿®æ”¹ç³»ç»Ÿèµ„æºé™åˆ¶çš„ï¼Œä½†å¯¹ä¸€äº›ç‰¹æ®Šå·¥å…·ï¼Œè¿™æ˜¯å¿…é¡»çš„æ­¥éª¤ã€‚\n>\n> æ¯”å¦‚å‹æµ‹å·¥å…· httperfï¼šå¦‚æœæˆ‘ä»¬ä½¿ç”¨å‘½ä»¤ httperf â€”hog â€”server www â€”num-conn 5000 è¿™æ ·çš„å‘½ä»¤ï¼Œå°±éœ€è¦ httperf åˆ›å»º5000ä¸ªå¹¶å‘è¿æ¥ï¼Œå¦‚æœè¿™é‡Œè¶…å‡ºäº†è½¯é™åˆ¶ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n>\n> æ‰€ä»¥åœ¨å‹æµ‹ä¹‹å‰httperféœ€è¦å…ˆè°ƒé«˜è½¯é™åˆ¶ã€‚\n\n### è¿›ç¨‹çš†æœ‰é€€å‡ºç \n\nå½“è¿›ç¨‹ç»“æŸæ—¶ï¼Œéƒ½ä¼šç•™ä¸‹æ•°å­—ï¼ˆ0-255ï¼‰é€€å‡ºç ï¼Œæ“ä½œç³»ç»Ÿæ ¹æ®é€€å‡ºç å¯ä»¥çŸ¥é“è¿›ç¨‹æ˜¯å¦è¿è¡Œæ­£å¸¸ã€‚\n\n>  é€€å‡ºç 0è¢«è®¤ä¸ºæ˜¯é¡ºåˆ©ç»“æŸï¼Œå…¶ä»–é€€å‡ºç è¡¨ç¤ºå‡ºç°äº†é”™è¯¯\n\npython ä½¿ç”¨ os.exit() æ¥é€€å‡ºè¿›ç¨‹\n\n\n```python\n#! -*- coding: utf-8 -*-\n\nimport sys\n\nsys.exit() # è¿™å°†ä½¿è¿›ç¨‹æºå¸¦çŠ¶æ€ç 0é€€å‡º\n\ntry:\n    sys.exit(2)\nexcept SystemExit as e:\n    print('error', e)  # è¿™é‡Œå°†æ‰“å° exit ä¸­çš„å‚æ•° 2\n```\n\n\n\n> `sys.exit()` ä¼šå¼•å‘ä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœå¼‚å¸¸æ²¡æœ‰è¢«æ•è·ï¼Œé‚£ä¹ˆ python è§£é‡Šå™¨å°†ä¼šé€€å‡ºã€‚å¦‚æœæœ‰æ•è·æ­¤å¼‚å¸¸ä»£ç ï¼Œé‚£ä¹ˆä»£ç ç»§ç»­æ‰§è¡Œã€‚\n\n\n\n```python\n#! -*- coding: utf-8 -*-\nimport sys\nimport atexit\n\ndef test():\n    print(\"hello exit\")\n\natexit.register(test)\n\nsys.exit() # ä¹Ÿå¯ä»¥æ˜¯ raise\n```\n\n\n\n> å½“ exit è¢«è°ƒç”¨æ—¶ï¼Œåœ¨è¿›ç¨‹ç»“æŸä¹‹å‰ï¼Œpython ä¼šè°ƒç”¨ atexit æ‰€å®šä¹‰çš„è¯­å¥ã€‚\n\n\n\n### è¿›ç¨‹çš†å¯è¡ç”Ÿ\n\nè¡ç”Ÿæ˜¯ Unix ç¼–ç¨‹ä¸­æœ€å¼ºå¤§çš„æ¦‚å¿µä¹‹ä¸€ã€‚fork ç³»ç»Ÿè°ƒç”¨å…è®¸å…è®¸ä¸­çš„è¿›ç¨‹ä»¥ç¼–ç¨‹çš„å½¢å¼åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚è¿™ä¸ªæ–°è¿›ç¨‹å’ŒåŸå§‹è¿›ç¨‹ä¸€æ¨¡ä¸€æ ·ã€‚\n\n> è¿›è¡Œè¡ç”Ÿæ—¶ï¼Œè°ƒç”¨ fork çš„è¿›ç¨‹è¢«ç§°ä¸º`çˆ¶è¿›ç¨‹`ï¼Œæ–°åˆ›å»ºçš„è¿›ç¨‹è¢«ç§°ä¸º`å­è¿›ç¨‹`ã€‚\n>\n> å­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹å¤„ç»§æ‰¿äº†å…¶æ‰€å ç”¨å†…å­˜ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œä»¥åŠæ‰€æœ‰å±äºçˆ¶è¿›ç¨‹çš„å·²æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚\n\n* å­è¿›ç¨‹æ‹¥æœ‰è‡ªå·±å”¯ä¸€çš„ pid\n* å­è¿›ç¨‹çš„ppid å°±æ˜¯è°ƒç”¨ fork çš„è¿›ç¨‹çš„ pid\n* fork è°ƒç”¨æ—¶ï¼Œå­è¿›ç¨‹ä»çˆ¶è¿›ç¨‹å¤„ç»§æ‰¿äº†æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿè·å¾—äº†çˆ¶è¿›ç¨‹æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦ç¼–å·ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªè¿›ç¨‹å°±å¯ä»¥å…±äº«æ‰“å¼€çš„æ–‡ä»¶ã€å¥—æ¥å­—ç­‰ã€‚\n* å­è¿›ç¨‹ç»§æ‰¿äº†çˆ¶è¿›ç¨‹å†…å­˜ä¸­æ‰€æœ‰çš„æ•°æ®\n* å­è¿›ç¨‹å¯ä»¥éšæ„æ›´æ”¹å…¶å†…å­˜å†…å®¹çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå¯¹çˆ¶è¿›ç¨‹é€ æˆå½±å“ã€‚\n\n\n\n```python\n#! -*- coding: utf-8 -*-\n\nimport os, sys\n\nprint('current pid:', os.getpid())\npid = os.fork()\n\nprint('pid', pid)\n\nif pid == 0:\n    print('I am child process (%s) and my parent is %s.' % (os.getpid(), os.getppid())) \nelse:\n    print('I (%s) just created a child process (%s).' % (os.getpid(), pid))\n```\n\nè¾“å‡ºï¼š\n\n```python\ncurrent pid: 9316\npid 9317\nI (9316) just created a child process (9317).\npid 0\nI am child process (9317) and my parent is 9316.\n```\n\n> `fork()`å‡½æ•°æ˜¯ python çš„å†…å»ºå‡½æ•°ï¼Œå­è¿›ç¨‹æ‹¥æœ‰è¿”å›0ï¼Œè€Œçˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹çš„ IDã€‚\n>\n> æ‰€ä»¥è¿™æ®µä»£ç ä¸­ï¼Œif è¯­å¥ç”±å­è¿›ç¨‹æ‰§è¡Œï¼Œè€Œ else è¯­å¥ç”±çˆ¶è¿›ç¨‹æ‰§è¡Œã€‚\n\n\nè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼š\n\nç”±äº fork çš„æ—¶å€™åˆ›å»ºäº†ä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹ä¸€æ¨¡ä¸€æ ·çš„å­è¿›ç¨‹ï¼Œå®ƒåŒ…å«äº†çˆ¶è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„ä¸€åˆ‡å†…å®¹ã€‚å¦‚æœï¼Œçˆ¶è¿›ç¨‹å ç”¨å†…å­˜ç‰¹åˆ«å¤§æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\n\n> Unix é‡‡ç”¨çš„æ˜¯å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼ŒCoWï¼‰çš„æ–¹æ³•ï¼Œæ‰€ä»¥ fork çš„æ—¶å€™çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ˜¯å…±äº«å†…å­˜ä¸­æ•°æ®çš„ï¼Œç›´åˆ°å®ƒä»¬ä¸­çš„ä¸€ä¸ªéœ€è¦å¯¹æ•°æ®è¿›ç¨‹ä¿®æ”¹ï¼Œæ‰ä¼šè¿›è¡Œå†…å­˜å¤åˆ¶ï¼Œä½¿å¾—ä¸¤ä¸ªè¿›ç¨‹ä¿æŒé€‚å½“çš„éš”ç¦»ã€‚\n\n\n\n### å­¤å„¿è¿›ç¨‹\n\n> å½“é€šè¿‡ç»ˆç«¯å¯åŠ¨å•ä¸ªè¿›ç¨‹æ—¶ï¼Œé€šå¸¸åªæœ‰è¿™ä¸ªè¿›ç¨‹å‘ STDOUT å†™å…¥ï¼Œä»é”®ç›˜è·å–è¾“å…¥æˆ–è€…ä¾¦å¬ Ctrl+C å·²å¾…é€€å‡ºã€‚\n>\n> ä½†æ˜¯ï¼Œå¦‚æœè¿›ç¨‹è¡ç”Ÿå‡ºäº†å­è¿›ç¨‹ï¼Œå½“ä½ æŒ‰ä¸‹ Ctrl+C çš„æ—¶å€™ï¼Œå“ªä¸€ä¸ªè¿›ç¨‹åº”è¯¥é€€å‡ºå‘¢ï¼Ÿæ˜¯å…¨éƒ¨é€€å‡ºè¿˜æ˜¯åªæœ‰çˆ¶è¿›ç¨‹é€€å‡ºï¼Ÿ\n\n\n\n```python\n#! -*- coding: utf-8 -*-\nimport time\nimport os, sys\n\nprint('current pid:', os.getpid())\npid = os.fork()\nprint('pid', pid)\n\nif pid == 0:\n    for i in range(5):\n        time.sleep(1)\n        print(\"I'm an orphan!\")\nelse:\n    sys.exit('Parent process died...')\n```\n\næ‰§è¡Œä»£ç ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š\n\n![](<http://media.gusibi.mobi/kiV8luPm0vIwOTZRnYTlUyVD4zjBKHa03kBjjFeBJHGSUmIVt8ZXZ70JzvpILfhm>)\n\n\n\né€šè¿‡æ‰“å°ç»“æœä¼šå‘ç°ï¼Œè¿è¡Œç¨‹åºçˆ¶è¿›ç¨‹ç»“æŸåï¼Œç«‹åˆ»æ”¾å›åˆ°ç»ˆç«¯å‘½ä»¤æç¤ºç¬¦ä¸‹ï¼Œæ­¤æ—¶ç»ˆç«¯è¢«å­è¿›ç¨‹è¾“å‡ºåˆ° STDOUT çš„å†…å®¹é‡å†™äº†ã€‚\n\n> çˆ¶è¿›ç¨‹ç»“æŸåï¼Œå­è¿›ç¨‹å¹¶ä¸å¥½é€€å‡ºï¼Œè¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œã€‚\n>\n> è¿™ç§æ“ä½œé€‚ç”¨äºå¸Œæœ›å­è¿›ç¨‹å¼‚æ­¥çš„å¤„ç†å…¶ä»–äº‹åŠ¡ï¼Œè€Œçˆ¶è¿›ç¨‹æŒ‰åŸè®¡åˆ’è¿è¡Œçš„åœºæ™¯ã€‚\n\n### è¿›ç¨‹çš†å¯å¾…\n\nå¦‚æœæƒ³ç›‘æ§å­è¿›ç¨‹çš„åŠ¨å‘ï¼Œåº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ\n\nPython æä¾›äº† `os.wait()` æ–¹æ³•ã€‚\n\n```python\n#! -*- coding: utf-8 -*-\nimport time\nimport os, sys\nfrom subprocess import Popen\n\nprint('current pid:', os.getpid())\npid = os.fork()\nprint('pid', pid)\n\nif pid == 0:\n    for i in range(5):\n        time.sleep(1)\n        print(\"I'm an orphan!\")\nelse:\n    os.wait()\n    sys.exit('Parent process died...')\n```\n\nè¾“å‡ºå¦‚ä¸‹ï¼š\n\n![](<http://media.gusibi.mobi/W8LmJ8a_SIDIQlOHElCueUTd5v8T8eu6yQTd8x9uHCxcLHyh29mvwJZqk98VkFE0>)\n\nè¿™ä¸€æ¬¡ï¼Œæ‰€æœ‰è¾“å‡ºéƒ½æ‰“å°å‡ºæ¥ä¹‹åï¼Œæ§åˆ¶æ‰è¿”å›ç»™ç»ˆç«¯ã€‚\n\né‚£ä¹ˆï¼Œos.wait() åšäº†ä»€ä¹ˆå‘¢â“\n\n> os.wait() æ˜¯ä¸€ä¸ªé˜»å¡è°ƒç”¨ï¼Œè¯¥è°ƒç”¨ä½¿å¾—çˆ¶è¿›ç¨‹ä¸€ç›´ç­‰åˆ°å®ƒçš„å­è¿›ç¨‹é€€å‡ºä¹‹åæ‰ç»§ç»­æ‰§è¡Œã€‚\n>\n> è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å« pid å’Œé€€å‡ºç ã€‚\n\n\n### åƒµå°¸è¿›ç¨‹\n\n### è¿›ç¨‹çš†å¯è·å¾—ä¿¡å·\n\n### è¿›ç¨‹çš†å¯é€šä¿¡\n\n### å®ˆæŠ¤è¿›ç¨‹\n\n## å‚è€ƒé“¾æ¥\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\næƒ³äº†è§£ä»¥ä¸‹å†…å®¹å¯ä»¥åœ¨å…¬å·è¾“å…¥ç›¸åº”å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š `å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n| å…³æ³¨ |èµèµ |\n|---|---|\n|![](http://media.gusibi.mobi/kel2L88yf9YXZYecLIn0LPZPSXc7zJfHyGUz5biWsZrGh7xF2JONZT93dgClGdMn)|![](http://media.gusibi.mobi/VFjjmZ7cgkIkpieAFHYXcLVBB8f9snm2vAzc0GyLjSmCzok8mL3vqLNMzYVvrDha)|\n",
      "data": {
        "title": "ã€Šç†è§£ unix è¿›ç¨‹ã€‹ç¬”è®°-1",
        "date": "2018-03-25 15:25:53",
        "tags": [
          "è¿›ç¨‹",
          "å¹¶å‘",
          "è¯»ä¹¦ç¬”è®°",
          "åç«¯"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "understand-unix-process-1"
    },
    {
      "content": "\n> è¿™æ˜¯`æ“ä½œç³»ç»Ÿè¿›ç¨‹`ç³»åˆ—æ–‡ç« ç¬¬ä¸‰ç¯‡-æ“ä½œç³»ç»Ÿçº¿ç¨‹æè¿°\n> æ–‡ç« æ˜¯ã€Šæ“ä½œç³»ç»Ÿ-ç²¾é«“ä¸è®¾è®¡åŸç†ã€‹å­¦ä¹ ç¬”è®°\n\n## çº¿ç¨‹ï¼ˆthreadï¼‰\n\n### ä»€ä¹ˆæ˜¯çº¿ç¨‹\n\n**çº¿ç¨‹**æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚å®ƒè¢«åŒ…å«åœ¨[è¿›ç¨‹](http://mp.weixin.qq.com/s/s_um6t-mORit4SDHvEYgpQ)ä¹‹ä¸­ï¼Œæ˜¯[è¿›ç¨‹](http://mp.weixin.qq.com/s/s_um6t-mORit4SDHvEYgpQ)ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯[è¿›ç¨‹](http://mp.weixin.qq.com/s/s_um6t-mORit4SDHvEYgpQ)ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚\n\nå…³äºè¿›ç¨‹çš„ä¸¤ä¸ªæ¦‚å¿µï¼š\n\n* èµ„æºæ‰€æœ‰æƒï¼šä¸€ä¸ªè¿›ç¨‹åŒ…æ‹¬ä¸€ä¸ªå­˜æ”¾è¿›ç¨‹æ˜ åƒçš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆè¿›ç¨‹æ˜ åƒæ˜¯ç¨‹åºã€æ•°æ®ã€æ ˆå’Œè¿›ç¨‹æ§åˆ¶å—ä¸­å®šä¹‰çš„å±æ€§çš„é›†åˆï¼‰ã€‚ä¸€ä¸ªè¿›ç¨‹æ€»æ˜¯æ‹¥æœ‰å¯¹èµ„æºçš„æ§åˆ¶æˆ–æ‰€æœ‰æƒï¼Œè¿™äº›èµ„æºåŒ…æ‹¬å†…å­˜ã€I/O é€šé“ï¼ŒI/O è®¾å¤‡å’Œæ–‡ä»¶ã€‚\n* è°ƒåº¦/æ‰§è¡Œï¼šä¸€ä¸ªè¿›ç¨‹æ²¿ç€é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªç¨‹åºçš„ä¸€æ¡æ‰§è¡Œè·¯å¾„æ‰§è¡Œï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹å¯èƒ½ä¸å…¶ä»–è¿›ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹äº¤æ›¿æ‰§è¡Œã€‚ä¸€ä¸ªè¿›ç¨‹å…·æœ‰ä¸€ä¸ªæ‰§è¡ŒçŠ¶æ€å’Œä¸€ä¸ªåˆ†ç‰‡çš„ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå¯è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦å’Œåˆ†é…çš„å®ä½“ã€‚\n\nè¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ç‹¬ç«‹çš„ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ç‹¬ç«‹çš„å¤„ç†ã€‚\n\n> ç°ä»£æ“ä½œç³»ç»Ÿé€šå¸¸æŠŠåˆ†æ´¾å•ä½ç§°ä¸ºçº¿ç¨‹ï¼ˆæˆ–è½»é‡çº§è¿›ç¨‹ï¼‰ï¼Œæ‹¥æœ‰èµ„æºæ‰€æœ‰æƒçš„å•ä½ç§°ä¸ºè¿›ç¨‹ã€‚\n\n\n### å¤šçº¿ç¨‹\n\nå¤šçº¿ç¨‹æ˜¯æŒ‡æ“ä½œç³»ç»Ÿåœ¨å•ä¸ªè¿›ç¨‹å†…æ”¯æŒå¤šä¸ªå¹¶å‘æ‰§è¡Œè·¯å¾„çš„èƒ½åŠ›ã€‚æ¯ä¸ªè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œçš„æ–¹æ³•ç§°ä¸ºå•çº¿ç¨‹æ–¹æ³•ã€‚è¿›ç¨‹æ”¯æŒå¤šä¸ªçº¿ç¨‹çš„æƒ…å†µè¢«ç§°ä½œå¤šçº¿ç¨‹ã€‚\n\nåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿›ç¨‹è¢«å®šä¹‰æˆèµ„æºåˆ†é…çš„å•ä½å’Œä¸€ä¸ªè¢«ä¿æŠ¤çš„å•ä½ï¼Œä¸è¿›ç¨‹ç›¸å…³è”çš„æœ‰ï¼š\n\n* å­˜æ”¾è¿›ç¨‹æ˜ åƒçš„è™šæ‹Ÿåœ°å€ç©ºé—´\n* å—ä¿æŠ¤çš„å¯¹å¤„ç†å™¨ã€å…¶ä»–è¿›ç¨‹ã€æ–‡ä»¶å’Œ I/O èµ„æºçš„è®¿é—®\n\nåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ï¼š\n\n* çº¿ç¨‹çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆè¿è¡Œï¼Œå°±ç»ªï¼‰\n* åœ¨æœªè¿è¡Œæ—¶ä¿å­˜çš„çº¿ç¨‹ä¸Šä¸‹æ–‡\n* ä¸€ä¸ªæ‰§è¡Œæ ˆ\n* ç”¨äºæ¯ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡çš„é™æ€å­˜å‚¨ç©ºé—´\n* ä¸è¿›ç¨‹å†…çš„å…¶ä»–çº¿ç¨‹å…±äº«çš„å¯¹è¿›ç¨‹çš„å†…å­˜å’Œèµ„æºçš„è®¿é—®\n\n\n### è¿›ç¨‹ VS çº¿ç¨‹\n\n\nä¸‹å›¾è¯´æ˜äº†è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼š\n\n![çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«](<http://media.gusibi.mobi/0KDXx7b4LkTyhJrxat45HK22Hsoz4OQrb_MKZCdsZH9DvqiPlajrDtLd1S_QtHMn>)\n\nåœ¨å•çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œè¿›ç¨‹çš„æ ‡å‡ºåŒ…æ‹¬ä»–çš„è¿›ç¨‹æ§åˆ¶å—å’Œç”¨æˆ·åœ°å€ç©ºé—´ï¼Œä»¥åŠåœ¨è¿›ç¨‹æ‰§è¡Œä¸­ç®¡ç†è°ƒç”¨/è¿”å› è¡Œä¸ºçš„ç”¨æˆ·æ ˆå’Œå†…æ ¸æ ˆã€‚å½“è¿›ç¨‹è¢«æ§åˆ¶æ—¶ï¼Œå¤„ç†å™¨å¯„å­˜å™¨è¢«è¯¥è¿›ç¨‹é”æ§åˆ¶ï¼›å½“è¿›ç¨‹ä¸è¿è¡Œæ—¶ï¼Œè¿™äº›å¤„ç†å™¨å¯„å­˜å™¨çš„å†…å®¹è¢«ä¿å­˜ã€‚\n\nåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿›ç¨‹ä»ç„¶åªæœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„è¿›ç¨‹æ§åˆ¶å—å’Œç”¨æˆ·åœ°å€ç©ºé—´ã€‚ä½†æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ ˆï¼Œè¿˜æœ‰ç‹¬ç«‹çš„æ§åˆ¶å—ç”¨äºåŒ…å«å¯„å­˜å™¨å€¼ã€ä¼˜å…ˆçº§å’Œå…¶ä»–ä¸çº¿ç¨‹ç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ã€‚\n\n> è¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„çŠ¶æ€å’Œèµ„æºï¼Œå®ƒä»¬é©»ç•™åœ¨åŒä¸€å—åœ°å€ç©ºé—´ä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®åˆ°ç›¸åŒçš„æ•°æ®ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æ”¹å˜äº†å†…å­˜ä¸­çš„ä¸€ä¸ªæ•°æ®é¡¹æ—¶ï¼Œå…¶ä»–çº¿ç¨‹åœ¨è®¿é—®è¿™ä¸€æ•°æ®é¡¹æ—¶èƒ½å¤Ÿçœ‹åˆ°å˜åŒ–åçš„ç»“æœã€‚\n\n### çº¿ç¨‹çš„ä¼˜ç‚¹\n\n1. åœ¨ä¸€ä¸ªå·²æœ‰çš„è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¯”åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹æ‰€éœ€æ—¶é—´è¦å°‘çš„å¤šã€‚\n2. ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹æ¯”ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹èŠ±è´¹çš„æ—¶é—´å°‘\n3. åŒä¸€ä¸ªè¿›ç¨‹å†…çº¿ç¨‹é—´åˆ‡æ¢æ¯”è¿›ç¨‹é—´åˆ‡æ¢èŠ±è´¹çš„æ—¶é—´è¦å°‘ã€‚\n4. çº¿ç¨‹æé«˜äº†ä¸åŒçš„æ‰§è¡Œç¨‹åºé—´é€šä¿¡çš„æ•ˆç‡ã€‚ï¼ˆå¤§å¤šæ•°æ“ä½œç³»ç»Ÿä¸­ï¼Œç‹¬ç«‹è¿›ç¨‹é—´çš„é€šä¿¡éœ€è¦å†…æ ¸çš„ä»‹å…¥ï¼Œç”±äºåŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹å…±äº«å†…å­˜å’Œæ–‡ä»¶ï¼Œå®ƒä»¬é—´çš„é€šä¿¡æ— éœ€è°ƒç”¨å†…æ ¸ï¼‰\n\n### çº¿ç¨‹çŠ¶æ€\n\nå’Œè¿›ç¨‹ä¸€æ ·ï¼Œçº¿ç¨‹çš„å…³é”®çŠ¶æ€æœ‰è¿è¡Œæ€ã€å°±ç»ªæ€å’Œé˜»å¡æ€ã€‚æŒ‚èµ·æ˜¯è¿›ç¨‹çº§åˆ«çš„æ¦‚å¿µï¼Œä¸€ä¸ªè¿›ç¨‹è¢«æ¢å‡ºï¼Œå®ƒçš„æ‰€æœ‰çº¿ç¨‹éƒ½è¢«æ¢å‡ºã€‚\n\næœ‰4ä¸ªä¸çº¿ç¨‹çŠ¶æ€æ”¹å˜ç›¸å…³çš„æ“ä½œï¼š\n\n* æ´¾ç”Ÿï¼šå½“æ´¾ç”Ÿä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼ŒåŒæ—¶ä¹Ÿä¸ºæ”¹è¿›ç¨‹æ´¾ç”Ÿå‡ºä¸€ä¸ªçº¿ç¨‹ã€‚è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­æ´¾ç”Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ–°çš„çº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆç©ºé—´ï¼Œä¸”è¢«æ”¾ç½®åœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚\n* é˜»å¡ï¼šå½“çº¿ç¨‹éœ€è¦ç­‰å¾…ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œå°†è¢«é˜»å¡ï¼Œæ­¤æ—¶å¤„ç†å™¨è½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªå°±ç»ªçº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯åŒä¸€è¿›ç¨‹ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸åŒè¿›ç¨‹ï¼‰\n* è§£é™¤é˜»å¡ï¼šå½“é˜»å¡ä¸€ä¸ªçº¿ç¨‹çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè¯¥çº¿ç¨‹è¢«è½¬ç§»åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­\n* ç»“æŸï¼šå½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆæ—¶ï¼Œå…¶å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆéƒ½è¢«é‡Šæ”¾ã€‚\n\n### ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹\n\nçº¿ç¨‹çš„å®ç°å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š`ç”¨æˆ·çº§çº¿ç¨‹ï¼ˆUser-Level Thread ULTï¼‰`å’Œ`å†…æ ¸çº§çº¿ç¨‹ï¼ˆKernel-Level Thread KLTï¼‰`ã€‚\n\n![ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹](<http://media.gusibi.mobi/gaApT9BLo5q0kZG1iOaC5yllVRMtR74cnYNxvAKy-jBDVm122aizcvSB2-ZyxCIp>)\n\n\nåœ¨ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹ä½¿ç”¨æ—¶ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§æ¨¡å¼ï¼š\n\n![ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹](<http://media.gusibi.mobi/gx5Ssn4Taoq-BDMJ0Dty58lVtdWhc5AHnF-3yssLGRzJl2k7HZa-sgq9PP3xAKGA>)\n\n**åœ¨ä¸€ä¸ªçº¯ç²¹çš„ç”¨æˆ·çº§çº¿ç¨‹ç¨‹åºä¸­ï¼Œæœ‰å…³çº¿ç¨‹ç®¡ç†çš„æ‰€æœ‰å·¥ä½œéƒ½ç”±åº”ç”¨ç¨‹åºå®Œæˆï¼Œå†…æ ¸æ„è¯†ä¸åˆ°çº¿ç¨‹çš„å­˜åœ¨ã€‚**\n\nä½¿ç”¨ç”¨æˆ·çº§çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š\n\n1. çº¿ç¨‹åˆ‡æ¢ä¸éœ€è¦å†…æ ¸æ€ç‰¹æƒï¼Œå› æ­¤ï¼Œè¿›ç¨‹ä¸éœ€è¦ä¸ºäº†çº¿ç¨‹ç®¡ç†è€Œåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™èŠ‚çœäº†ä¸¤æ¬¡çŠ¶æ€è½¬æ¢ï¼ˆä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€ï¼Œå†ä»å†…æ ¸æ€è¿”å›ç”¨æˆ·æ€ï¼‰çš„å¼€é”€ã€‚\n2. è°ƒåº¦å¯ä»¥æ˜¯ç”¨æˆ·ç¨‹åºç›¸å…³çš„ã€‚ï¼ˆå¯ä»¥ä¸ºç‰¹å®šçš„åº”ç”¨ä½¿ç”¨ç‰¹å®šçš„è°ƒåº¦ç®—æ³•ï¼‰\n3. ç”¨æˆ·çº§çº¿ç¨‹å¯ä»¥åœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸­è¿è¡Œï¼Œä¸éœ€è¦å¯¹åº•å±‚å†…æ ¸è¿›è¡Œä¿®æ”¹ä»¥æ”¯æŒç”¨æˆ·çº§çº¿ç¨‹ã€‚\n\nä½¿ç”¨ç”¨æˆ·çº§çº¿ç¨‹çš„ç¼ºç‚¹ï¼š\n\n1. è®¸å¤šç³»ç»Ÿè°ƒç”¨ä¼šè¢«é˜»å¡ã€‚å› æ­¤å½“ç”¨æˆ·çº§çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¸ä»…è¿™ä¸ªçº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œè¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚\n2. ä¸èƒ½ä½¿ç”¨å¤šä¸ªå¤„ç†å™¨ã€‚å†…æ ¸ä¸€æ¬¡åªæŠŠä¸€ä¸ªè¿›ç¨‹åˆ†é…ç»™ä¸€ä¸ªå¤„ç†å™¨ï¼Œå› æ­¤ä¸€ä¸ªè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œã€‚\n\n> è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜æœ‰ä¸¤ç§æ–¹å¼ï¼š\n>\n> 1. ä½¿ç”¨å¤šè¿›ç¨‹ä»£æ›¿å¤šçº¿ç¨‹ï¼Œä½†è¿™æ ·æ¶ˆé™¤äº†å¤šçº¿ç¨‹çš„ä¼˜åŠ¿\n> 2. ä½¿ç”¨ jacketing æŠ€æœ¯ã€‚æŠŠä¸€ä¸ªäº§ç”Ÿé˜»å¡çš„ç³»ç»Ÿè°ƒç”¨è½¬æ¢æˆä¸€ä¸ªéé˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ã€‚\n\n\n\nåœ¨ä¸€ä¸ªçº¯ç²¹çš„å†…åˆè¾‘çº¿ç¨‹ç¨‹åºä¸­ï¼Œæœ‰å…³çº¿ç¨‹ç®¡ç†çš„æ‰€æœ‰å·¥ä½œéƒ½ç”±å†…æ ¸å®Œæˆã€‚å†…æ ¸ä¸ºè¿›ç¨‹åŠå…¶å†…éƒ¨çš„æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚è°ƒåº¦ç”±å†…æ ¸åŸºäºçº¿ç¨‹å®Œæˆã€‚\n\n> ä½¿ç”¨å†…æ ¸çº§çº¿ç¨‹å®¢æœäº†ç”¨æˆ·çº§çº¿ç¨‹çš„ä¸¤ä¸ªåŸºæœ¬ç¼ºé™·ã€‚é¦–å…ˆå†…æ ¸å¯ä»¥æŠŠåŒä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹è°ƒåº¦åˆ°å¤šä¸ªå¤„ç†å™¨ï¼›å…¶æ¬¡ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹è¢«é˜»å¡ï¼Œå†…æ ¸å¯ä»¥è°ƒåº¦åŒä¸€ä¸ªè¿›ç¨‹çš„å¦ä¸€ä¸ªçº¿ç¨‹ã€‚\n>\n> ä¸»è¦ç¼ºç‚¹æ˜¯ï¼šæŠŠæ§åˆ¶ä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€åˆ°åŒä¸€ä¸ªè¿›ç¨‹å†…çš„å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯ï¼Œéœ€è¦å†…æ ¸çš„çŠ¶æ€åˆ‡æ¢ã€‚\n\n\n![çº¿ç¨‹å’Œè¿›ç¨‹çš„æ‰§è¡Œæ—¶é—´](<http://media.gusibi.mobi/iD4lEh-rtxW0iN5EzdzLYtyQr4LZlcFDiMOo06JLNuhC69DKDMjXgGRldy6ELJvV>)\n\næŸäº›æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ç§ç»„åˆçš„ç”¨æˆ·çº§/å†…æ ¸çº§çº¿ç¨‹è®¾æ–½ã€‚åœ¨ç»„åˆçš„ç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹åˆ›å»ºå®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®Œæˆï¼Œçº¿ç¨‹çš„è°ƒåº¦å’ŒåŒæ­¥ä¹Ÿæ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹è¢«æ˜ å°„åˆ°ä¸€äº›ï¼ˆå°äºæˆ–ç­‰äºç”¨æˆ·çº§çº¿ç¨‹çš„æ•°ç›®ï¼‰å†…æ ¸çº§çº¿ç¨‹ä¸Šã€‚å¼€å‘è€…å¯ä»¥ä¸ºç‰¹å®šçš„åº”ç”¨ç¨‹åºå’Œå¤„ç†å™¨è°ƒèŠ‚å†…æ ¸çº§çº¿ç¨‹çš„æ•°ç›®ï¼Œä»¥è¾¾åˆ°æœ€ä½³ç»“æœã€‚\n\n### Linux çš„è¿›ç¨‹å’Œçº¿ç¨‹ç®¡ç†\n\nLinuxä¸­çš„è¿›ç¨‹æˆ–ä»»åŠ¡ç”±ä¸€ä¸ª `task_struct`æ•°æ®ç»“æ„è¡¨ç¤ºï¼Œè¿™ä¸ªæ•°æ®ç»“æ„åŒ…å«äº†ä»¥ä¸‹ä¿¡æ¯ï¼š\n\n*  çŠ¶æ€ï¼šè¿›ç¨‹çš„æ‰§è¡ŒçŠ¶æ€\n* è°ƒåº¦ä¿¡æ¯ï¼šLinux è°ƒåº¦è¿›ç¨‹æ‰€éœ€çš„ä¿¡æ¯\n* æ ‡è¯†ç¬¦\n* è¿›ç¨‹é—´é€šä¿¡ï¼šLinux æ”¯æŒ UNIX SVR4ä¸­çš„ IPC æœºåˆ¶ã€‚\n* æ—¶é—´å’Œè®¡æ—¶å™¨ï¼šåŒ…æ‹¬è¿›ç¨‹åˆ›å»ºçš„æ—¶åˆ»å’Œè¿›ç¨‹æ‰€æ¶ˆè€—çš„å¤„ç†å™¨æ—¶é—´æ€»é‡\n* æ–‡ä»¶ç³»ç»Ÿï¼šåŒ…æ‹¬æŒ‡å‘è¢«è¯¥è¿›ç¨‹æ‰“å¼€çš„ä»»ä½•æ–‡ä»¶çš„æŒ‡é’ˆå’ŒæŒ‡å‘è¯¥è¿›ç¨‹å½“å‰å’Œæ ¹ç›®å½•çš„æŒ‡é’ˆã€‚\n* åœ°å€ç©ºé—´ï¼šå®šä¹‰åˆ†é…ç»™è¯¥è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´\n* å¤„ç†å™¨ä¸“ç”¨ä¸Šä¸‹æ–‡ï¼šæ„æˆæ”¹è¿›ç¨‹ä¸Šä¸‹æ–‡çš„å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯\n* åœæ­¢ï¼šè¿›ç¨‹è¢«ç»ˆæ­¢ï¼Œå¹¶ä¸”åªèƒ½ç”±æ¥è‡ªå¦ä¸€ä¸ªè¿›ç¨‹çš„ä¸»åŠ¨åŠ¨ä½œæ¢å¤\n* åƒµæ­»ï¼šè¿›ç¨‹å·²è¢«ç»ˆæ­¢ï¼Œä½†ç”±äºæŸäº›åŸå› ï¼Œåœ¨è¿›ç¨‹è¡¨ä¸­ä»ç„¶æœ‰å®ƒçš„ä»»åŠ¡ç»“æ„\n\nLinux æä¾›ä¸€ç§ä¸åŒºåˆ†è¿›ç¨‹å’Œçº¿ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨æˆ·çº§çº¿ç¨‹è¢«æ˜ å°„åˆ°å†…æ ¸çº§è¿›ç¨‹ä¸Šã€‚ç»„æˆä¸€ä¸ªç”¨æˆ·çº§è¿›ç¨‹çš„å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹è¢«æ˜ å°„åˆ°å…±äº«åŒä¸€ç»„ ID çš„å¤šä¸ª Linux å†…æ ¸çº§è¿›ç¨‹ä¸Šã€‚è¿™ä½¿å¾—è¿™äº›è¿›ç¨‹å¯ä»¥å…±äº«æ–‡ä»¶å’Œå†…å­˜ç­‰èµ„æºï¼Œä½¿å¾—åŒä¸€ç»„ä¸­çš„è¿›ç¨‹è°ƒåº¦åˆ‡æ¢æ˜¯ä¸éœ€è¦åˆ‡æ¢ä¸Šä¸‹æ–‡ã€‚\n\nåœ¨ Linux ä¸­é€šè¿‡å¤åˆ¶å½“å‰è¿›ç¨‹çš„å±æ€§å¯åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚æ–°è¿›ç¨‹è¢«å…‹éš†å‡ºæ¥ï¼Œä½¿å¾—å®ƒå¯ä»¥å…±äº«èµ„æºã€‚å½“ä¸¤ä¸ªè¿›ç¨‹å…±äº«ç›¸åŒè™šæ‹Ÿå†…å­˜æ—¶ï¼Œå®ƒä»¬å¯ä»¥è¢«å½“åšæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹ã€‚å› æ­¤ Linux ä¸­è¿›ç¨‹å’Œçº¿ç¨‹æ²¡æœ‰åŒºåˆ«ã€‚\n\n\n## å‚è€ƒé“¾æ¥\n\n* ã€Šæ“ä½œç³»ç»Ÿ-ç²¾é«“ä¸è®¾è®¡åŸç†ã€‹\n* [Threads and Concurrency](https://applied-programming.github.io/Operating-Systems-Notes/3-Threads-and-Concurrency/)\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\næƒ³äº†è§£ä»¥ä¸‹å†…å®¹å¯ä»¥åœ¨å…¬å·è¾“å…¥ç›¸åº”å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š `å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n| å…³æ³¨ |èµèµ |\n|---|---|\n|![](http://media.gusibi.mobi/kel2L88yf9YXZYecLIn0LPZPSXc7zJfHyGUz5biWsZrGh7xF2JONZT93dgClGdMn)|![](http://media.gusibi.mobi/VFjjmZ7cgkIkpieAFHYXcLVBB8f9snm2vAzc0GyLjSmCzok8mL3vqLNMzYVvrDha)|\n",
      "data": {
        "title": "æ“ä½œç³»ç»Ÿçº¿ç¨‹æè¿°",
        "date": "2018-03-24 04:25:53",
        "tags": [
          "è¿›ç¨‹",
          "å¹¶å‘",
          "è¯»ä¹¦ç¬”è®°",
          "åç«¯"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "system-process-3"
    },
    {
      "content": "\n> è¿™æ˜¯`æ“ä½œç³»ç»Ÿè¿›ç¨‹`ç³»åˆ—æ–‡ç« ç¬¬äºŒç¯‡-æ“ä½œç³»ç»Ÿè¿›ç¨‹æè¿°\n\n## è¿›ç¨‹\n\n### ä»€ä¹ˆæ˜¯è¿›ç¨‹\n\nåœ¨ç»™è¿›ç¨‹ä¸‹å®šä¹‰å‰ï¼Œå…ˆè€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š\n\n1. ä¸€ä¸ªè®¡ç®—æœºå¹³å°åŒ…æ‹¬ä¸€ç»„ç¡¬ä»¶èµ„æºï¼šæ¯”å¦‚å¤„ç†å™¨ã€å†…å­˜ã€I/O æ¨¡å—ã€å®šæ—¶å™¨å’Œç£ç›˜é©±åŠ¨å™¨ç­‰ã€‚\n2. è®¡ç®—æœºç¨‹åºæ˜¯ä¸ºæ‰§è¡ŒæŸäº›ä»»åŠ¡è€Œå¼€å‘çš„ã€‚å…¸å‹æƒ…å†µä¸‹ï¼Œå®ƒä»¬æ¥å—å¤–æ¥çš„è¾“å…¥ï¼Œåšä¸€äº›å¤„ç†åï¼Œè¾“å‡ºç»“æœã€‚\n3. ç›´æ¥æ ¹æ®ç»™å®šçš„ç¡¬ä»¶å¹³å°å†™åº”ç”¨ç¨‹åºæ•ˆç‡æ˜¯ä½ä¸‹çš„\n4. å¼€å‘æ“ä½œç³»ç»Ÿæ˜¯ä¸ºäº†ç»™åº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªæ–¹ä¾¿ã€å®‰å…¨å’Œä¸€ç›´çš„æ¥å£ã€‚æ“ä½œç³»ç»Ÿæ˜¯è®¡ç®—æœºç¡¬ä»¶å’Œåº”ç”¨ç¨‹åºç›´æ¥çš„ä¸€å±‚è½¯ä»¶ï¼Œå¯¹åº”ç”¨ç¨‹åºå’Œå·¥å…·æä¾›äº†æ”¯æŒã€‚\n5. å¯ä»¥æŠŠæ“ä½œç³»ç»Ÿæƒ³è±¡ä¸ºèµ„æºçš„ç»Ÿä¸€æŠ½è±¡è¡¨ç¤ºï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºè¯·æ±‚å’Œè®¿é—®ã€‚èµ„æºåŒ…æ‹¬å†…å­˜ã€ç½‘ç»œæ¥å£å’Œæ–‡ä»¶ç³»ç»Ÿç­‰ã€‚\n\næœ‰äº†ä¸Šè¿°æ¦‚å¿µï¼Œç°åœ¨å°±å¯ä»¥è®¨è®ºæ“ä½œç³»ç»Ÿæ€æ ·ä»¥ä¸€ä¸ªæœ‰åºçš„æ–¹å¼ç®¡ç†åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼Œä»¥è¾¾åˆ°ä»¥ä¸‹ç›®çš„ï¼š\n\n* èµ„æºå¯¹å¤šä¸ªåº”ç”¨ç¨‹åºæ˜¯å¯ç”¨çš„\n* ç‰©ç†å¤„ç†å™¨åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºé—´åˆ‡æ¢ä»¥ä¿è¯æ‰€æœ‰ç¨‹åºéƒ½åœ¨æ‰§è¡Œä¸­\n* å¤„ç†å™¨å’Œ I/O è®¾å¤‡èƒ½å¾—åˆ°å……åˆ†çš„åˆ©ç”¨\n\nç°ä»£æ“ä½œç³»ç»Ÿé‡‡ç”¨çš„æ–¹æ³•éƒ½æ˜¯`ä¾æ®å¯¹åº”äºä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å­˜åœ¨çš„åº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä¸€ç§æ¨¡å‹`ã€‚\n\nå…³äºè¿›ç¨‹æœ‰å¾ˆå¤šå®šä¹‰ï¼š\n\n- ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åº\n- è®¡ç®—æœºä¸­æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ä¸ªå®ä¾‹\n- å¯ä»¥åˆ†é…ç»™å¤„ç†å™¨å¹¶ç”±å¤„ç†å™¨æ‰§è¡Œçš„ä¸€ä¸ªå®ä½“\n- ç”±å•ä¸€çš„é¡ºåºçš„æ‰§è¡Œçº¿ç¨‹ã€ä¸€ä¸ªå½“å‰çŠ¶æ€å’Œä¸€ç»„ç›¸å…³çš„ç³»ç»Ÿèµ„æºæ‰€æè¿°çš„æ´»åŠ¨å•å…ƒ\n\n### è¿›ç¨‹çŠ¶æ€\n\nä¸€ä¸ªè¢«æ‰§è¡Œçš„ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€ä¸ªè¿›ç¨‹æˆ–ä»»åŠ¡ï¼Œå¹¶ä¸”æ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œã€‚\n\nç®€å•æ¥è¯´ï¼Œç¨‹åºåªæœ‰ä¸¤ç§çŠ¶æ€ï¼š`è¿è¡Œæ€`ã€`æœªè¿è¡Œæ€`ã€‚\n\n![ä¸¤çŠ¶æ€è¿›ç¨‹æ¨¡å‹](<http://media.gusibi.mobi/OskbbEAvy2Pml-DAIPGNsq73iTnGmEoG61GC1jFK2S7grZpYiIZxN5rYXw1NvA_3>)\n\n* å½“æ“ä½œç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œå®ƒå°†è¯¥è¿›ç¨‹ä»¥æœªè¿è¡Œæ€åŠ å…¥åˆ°ç³»ç»Ÿä¸­ï¼Œæ“ä½œç³»ç»ŸçŸ¥é“è¿›ç¨‹çš„å­˜åœ¨ï¼Œå¹¶ç­‰å¾…æ‰§è¡Œæœºä¼šã€‚\n* å½“å‰è¿è¡Œçš„è¿›ç¨‹ä¸æ—¶ä¸­æ–­ï¼Œæ“ä½œç³»ç»Ÿçš„åˆ†æ´¾å™¨å°†é€‰æ‹©ä¸€ä¸ªæ–°è¿›ç¨‹è¿è¡Œã€‚\n* å‰ä¸€ä¸ªè¿›ç¨‹ä»è¿è¡Œæ€è½¬æ¢åˆ°æœªè¿è¡Œæ€ï¼Œå¦ä¸€ä¸ªä»æœªè¿è¡Œæ€è½¬æ¢åˆ°è¿è¡Œæ€ã€‚\n\nåŒæ—¶ï¼Œæœªè¿è¡Œçš„è¿›ç¨‹éœ€ä¿æŒåœ¨æŸç§ç±»å‹çš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶ç­‰å¾…å®ƒä»¬çš„æ‰§è¡Œæ—¶æœºã€‚\n\nä¸Šå›¾ä¸­çš„æ’é˜Ÿå›¾å¯ä»¥æè¿°åˆ†æ´¾å™¨çš„è¡Œä¸ºï¼šè¢«ä¸­æ–­çš„è¿›ç¨‹è½¬ç§»åˆ°ç­‰å¾…è¿›ç¨‹é˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…ï¼Œå¦‚æœè¿›ç¨‹ä»¥åŠç»“æŸæˆ–å–æ¶ˆï¼Œåˆ™è¢«é”€æ¯ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œåˆ†æ´¾å™¨å‡ä»é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œã€‚\n\né€šè¿‡è¿™ä¸ªæ¨¡å‹ï¼Œå¯ä»¥çœ‹å‡ºæ“ä½œç³»ç»Ÿéœ€è¦ç”¨æŸç§æ–¹å¼æ¥è¡¨ç¤ºæ¯ä¸ªè¿›ç¨‹ï¼Œä½¿å¾—æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè·Ÿè¸ªå®ƒï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æœ‰ä¸€äº›ä¸è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„çŠ¶æ€å’Œä½ç½®ï¼Œå³`è¿›ç¨‹æ§åˆ¶å—`ã€‚\n\n### è¿›ç¨‹æ§åˆ¶å—\n\nè¿›ç¨‹åœ¨ä»»æ„æ—¶é—´éƒ½å¯ä»¥å”¯ä¸€åœ°è¢«è¡¨å¾ä¸ºä»¥ä¸‹å…ƒç´ ï¼š\n\n![ç®€åŒ–çš„è¿›ç¨‹æ§åˆ¶å—](<http://media.gusibi.mobi/Nra2ykMZsSS2HqGQjASJUXZ7krpqAhCZPSVKc7_G6CUH_kusdOcZpLL2BddET7oJ>)\n\n* æ ‡è¯†ç¬¦ï¼šå­˜å‚¨åœ¨è¿›ç¨‹æ§åˆ¶å—ä¸­çš„æ•°å­—æ ‡è¯†ç¬¦ï¼ŒåŒ…æ‹¬ï¼ˆæ¬¡è¿›ç¨‹çš„æ ‡è¯†ç¬¦-è¿›ç¨‹ IDï¼Œçˆ¶è¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œç”¨æˆ·æ ‡è¯†ç¬¦-ç”¨æˆ· IDï¼‰\n* çŠ¶æ€ï¼šè¿›ç¨‹çŠ¶æ€ï¼ˆå¦‚è¿è¡Œæ€ï¼Œå°±ç»ªæ€ï¼Œç­‰å¾…æ€ç­‰ï¼‰\n* ä¼˜å…ˆçº§ï¼šç”¨äºæè¿°è¿›ç¨‹è°ƒåº¦ä¼˜å…ˆçº§çš„ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸã€‚\n* ç¨‹åºè®¡æ•°å™¨ï¼šç¨‹åºä¸­å³å°†è¢«æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€\n* å†…å­˜æŒ‡é’ˆï¼šåŒ…æ‹¬ç¨‹åºä»£ç å’Œè¿›ç¨‹ç›¸å…³æ•°æ®çš„æŒ‡é’ˆï¼Œè¿˜æœ‰å’Œå…¶ä»–è¿›ç¨‹å…±äº«å†…å­˜å—çš„æŒ‡é’ˆ\n* ä¸Šä¸‹æ–‡æ•°æ®ï¼šè¿›ç¨‹æ‰§è¡Œæ—¶å¤„ç†å™¨çš„å¯„å­˜å™¨çš„æ•°æ®\n* I/O çŠ¶æ€ä¿¡æ¯ï¼šåŒ…æ‹¬æ˜¾ç¤ºçš„ I/O è¯·æ±‚ã€åˆ†é…ç»™è¿›ç¨‹çš„ I/O è®¾å¤‡å’Œè¢«è¿›ç¨‹ä½¿ç”¨çš„æ–‡ä»¶åˆ—è¡¨ç­‰\n* è®°è´¦ä¿¡æ¯ï¼šå¯èƒ½åŒ…æ‹¬å¤„ç†å™¨æ—¶é—´æ€»å’Œã€ä½¿ç”¨çš„æ—¶é’Ÿæ•°æ€»å’Œã€æ—¶é—´é™åˆ¶ã€è®°è´¦å·ç­‰ã€‚\n\nè¿™äº›ä¿¡æ¯è¢«å­˜æ”¾åœ¨ä¸€ä¸ªå«`è¿›ç¨‹æ§åˆ¶å—`çš„æ•°æ®ç»“æ„ä¸­ï¼Œå®ƒç”±æ“ä½œç³»ç»Ÿåˆ›å»ºå’Œç®¡ç†ã€‚è¿›ç¨‹æ§åˆ¶å—æ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•ä¸€ä¸ªè¿›ç¨‹åªè¦è¿›ç¨‹åˆ›å»ºäº†å®ƒå°±ä¸€å®šæœ‰ä¸€ä¸ªè·Ÿå®ƒç›¸å¯¹åº”çš„è¿›ç¨‹æ§åˆ¶å—ï¼Œè¿›ç¨‹ç»“æŸäº†è¿›ç¨‹æ§åˆ¶å—å°±ä¼šè¢«æ“ä½œç³»ç»Ÿå›æ”¶ï¼Œè¿›ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹å¯¹è¿›ç¨‹çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡è¿›ç¨‹æ§åˆ¶å—æ¥å®ç°çš„ã€‚\n\n#### è¿›ç¨‹åˆ›å»ºå’Œç»ˆæ­¢\n\nè¿›ç¨‹é™¤è¿è¡Œå’Œæœªè¿è¡Œå¤–ï¼Œåœ¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåˆ›å»ºå’Œç»ˆæ­¢éƒ½æ˜¯ä¸å¯é¿å…çš„ã€‚\n\n##### è¿›ç¨‹åˆ›å»º\n\né€šå¸¸æœ‰4ä¸ªäº‹ä»¶ä¼šå¯¼è‡´åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼š\n\n1. æ–°çš„æ‰¹é‡ä½œä¸š\n2. äº¤äº’ç™»å½•ã€‚ç»ˆç«¯ç”¨æˆ·ç™»å½•åˆ°ç³»ç»Ÿ\n3. æ“ä½œç³»ç»Ÿå› ä¸ºæä¾›ä¸€é¡¹æœåŠ¡è€Œåˆ›å»ºã€‚æ“ä½œç³»ç»Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œä»£è¡¨ç”¨æˆ·ç¨‹åºæ‰§è¡Œä¸€ä¸ªåŠŸèƒ½ï¼Œä½¿ç”¨æˆ·æ— éœ€ç­‰å¾…ã€‚\n4. ç”±ç°æœ‰è¿›ç¨‹æ´¾ç”Ÿã€‚åŸºäºæ¨¡å—åŒ–çš„è€ƒè™‘ï¼Œæˆ–è€…ä¸ºäº†å¼€å‘å¹¶è¡Œæ€§ï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥æŒ‡ç¤ºåˆ›å»ºå¤šä¸ªè¿›ç¨‹ã€‚\n\n>  å½“ä¸€ä¸ªè¿›ç¨‹æ´¾ç”Ÿå¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå‰ä¸€ä¸ªç§°ä¸ºçˆ¶è¿›ç¨‹ï¼Œè¢«æ´¾ç”Ÿçš„è¢«ç§°ä¸ºå­è¿›ç¨‹ã€‚\n\nä¸€æ—¦æ“ä½œç³»ç»Ÿå†³å®šåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œå®ƒå°±ä¼šæŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š\n\n1. ç»™æ–°è¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹æ ‡è¯†ç¬¦ã€‚\n2. ç»™è¿›ç¨‹åˆ†é…ç©ºé—´ã€‚\n3. åˆå§‹åŒ–è¿›ç¨‹æ§åˆ¶å—ã€‚\n4. è®¾ç½®æ­£ç¡®çš„è¿æ¥ã€‚ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ“ä½œç³»ç»ŸæŠŠæ¯ä¸ªè°ƒåº¦é˜Ÿåˆ—éƒ½ä¿å­˜æˆé“¾è¡¨ï¼Œåˆ™æ–°è¿›ç¨‹å¿…é¡»æ”¾ç½®åœ¨å°±ç»ªæˆ–å°±ç»ª/æŒ‚èµ·é“¾è¡¨ä¸­ï¼‰ã€‚\n5. åˆ›å»ºæˆ–æ‰©å……å…¶ä»–æ•°æ®ç»“æ„ã€‚\n\n##### è¿›ç¨‹ç»ˆæ­¢\n\næœ‰å¾ˆå¤šäº‹ä»¶å¯ä»¥å¯¼è‡´è¿›ç¨‹ç»ˆæ­¢ï¼Œæ¯”å¦‚ï¼š\n\n1. è¿›ç¨‹å®Œæˆ\n2. è¿›ç¨‹è¶…æ—¶ã€‚è¿›ç¨‹è¿è¡Œæ—¶é—´è¶…è¿‡è§„å®šçš„æ—¶é™\n3. æ— å¯ç”¨å†…å­˜\n4. I/O å¤±è´¥\n5. ç®—æœ¯é”™è¯¯\n6. æ— æ•ˆæŒ‡ä»¤\n7. çˆ¶è¿›ç¨‹ç»ˆæ­¢\n8. çˆ¶è¿›ç¨‹è¯·æ±‚\n   ã€‚ã€‚ã€‚\n\n#### äº”çŠ¶æ€æ¨¡å‹\n\nç³»ç»Ÿä¸­è¿˜å­˜åœ¨ç€ä¸€äº›å¤„äºéè¿è¡ŒçŠ¶æ€ä½†å·²ç»å°±ç»ªç­‰å¾…æ‰§è¡Œçš„è¿›ç¨‹ï¼Œè€Œä¸”è¿˜å­˜åœ¨å¦ä¸€äº›å¤„äºé˜»å¡çŠ¶æ€ç­‰å¾… I/O æ“ä½œç»“æŸçš„è¿›ç¨‹ã€‚\n\nè¿™æ—¶ï¼Œ`å°±ç»ªæ€(ready)`å’Œ`é˜»å¡æ€(blocked)`å‡ºç°äº†ï¼Œä¸¤çŠ¶æ€æ¨¡å‹å‡çº§ä¸ºäº†5çŠ¶æ€æ¨¡å‹ï¼Œ5ä¸ªçŠ¶æ€å¦‚ä¸‹ï¼š\n\n![äº”çŠ¶æ€è¿›ç¨‹æ¨¡å‹](<http://media.gusibi.mobi/TaAMUjZ0MfiJF65CMJc6Z-q5vVlGvMYOAz5UBsfIOTF_HplbJuYKEc2pyfZj9wwJ>)\n\n\n* è¿è¡Œæ€ï¼šè¯¥è¿›ç¨‹æ­£åœ¨æ‰§è¡Œ\n* å°±ç»ªæ€ï¼šè¿›ç¨‹åšå¥½äº†å‡†å¤‡ï¼Œç­‰å¾…å¤„ç†å™¨è°ƒåº¦\n* é˜»å¡/ç­‰å¾…æ€ï¼šè¿›ç¨‹åœ¨æŸäº›äº‹ä»¶å‘ç”Ÿå‰ä¸èƒ½æ‰§è¡Œï¼Œæ¯”å¦‚ I/O æ“ä½œå®Œæˆ\n* æ–°å»ºæ€ï¼šåˆšåˆšåˆ›å»ºçš„è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿè¿˜æ²¡æœ‰æŠŠå®ƒåŠ å…¥åˆ°å¯æ‰§è¡Œè¿›ç¨‹ç»„ä¸­ã€‚é€šå¸¸æ˜¯è¿›ç¨‹æ§åˆ¶å—å·²ç»åˆ›å»ºä½†è¿˜æ²¡æœ‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚\n* é€€å‡ºæ€ï¼šæ“ä½œç³»ç»Ÿä»å¯æ‰§è¡Œè¿›ç¨‹ç»„ä¸­é‡Šæ”¾å‡ºçš„è¿›ç¨‹ï¼Œæˆ–è€…æ˜¯å› ä¸ºå®ƒè‡ªèº«åœæ­¢äº†ï¼Œæˆ–è€…æ˜¯å› ä¸ºæŸç§åŸå› è¢«å–æ¶ˆã€‚\n\n\n> `æ–°å»º-å°±ç»ª`: æ“ä½œç³»ç»Ÿå‡†å¤‡å¥½å†æ¥çº³ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼ŒæŠŠä¸€ä¸ªè¿›ç¨‹ä»æ–°å»ºæ€è½¬æ¢åˆ°å°±ç»ªæ€ã€‚å¤§å¤šæ•°ç³»ç»ŸåŸºäºå¿ƒæœ‰çš„è¿›ç¨‹æ•°æˆ–åˆ†é…ç»™ç°æœ‰è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜æ•°é‡è®¾ç½®ä¸€äº›é™åˆ¶ï¼Œä»¥ç¡®ä¿ä¸ä¼šå› ä¸ºæ´»è·ƒè¿›ç¨‹æ•°é‡è¿‡å¤šè€Œå¯¼è‡´ç³»ç»Ÿçš„æ€§èƒ½ä¸‹é™ã€‚\n>\n> `å°±ç»ª-é€€å‡º`: åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ç»ˆæ­¢ä¸€ä¸ªå­è¿›ç¨‹ã€‚å¦‚æœä¸€ä¸ªçˆ¶è¿›ç¨‹ç»ˆæ­¢ï¼Œä¸è¯¥çˆ¶è¿›ç¨‹ç›¸å…³çš„æ‰€æœ‰å­è¿›ç¨‹éƒ½å°†è¢«ç»ˆæ­¢ã€‚\n\n#### æŒ‚èµ·\n\n> `å°±ç»ªæ€ã€è¿è¡Œæ€å’Œé˜»å¡æ€`æä¾›äº†ä¸€ç§ä¸ºè¿›ç¨‹è¡Œä¸ºå»ºç«‹æ¨¡å‹çš„ç³»ç»Ÿæ–¹æ³•ï¼Œä½†æœ‰ä¸ªé—®é¢˜éœ€è¦è€ƒè™‘ï¼šæ¯ä¸ªè¢«æ‰§è¡Œçš„è¿›ç¨‹å¿…é¡»å®Œå…¨è½½å…¥å†…å­˜ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹åœ¨ç­‰å¾… I/O æ“ä½œæ—¶ï¼Œå¤„ç†å™¨å¯ä»¥è½¬ç§»åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œä½† I/O æ´»åŠ¨æ¯”CPU è®¡ç®—é€Ÿåº¦æ…¢å¾ˆå¤šï¼Œå› æ­¤å¤§å¤šæ•°æƒ…å†µä¸‹å¤„ç†å™¨åœ¨å¤šæ•°æ—¶å€™éƒ½æ˜¯ç©ºé—²çš„ã€‚ä½†æ˜¯å¦‚æœå†…å­˜ä¸­éƒ½æ˜¯é˜»å¡æ€çš„è¿›ç¨‹æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\n* ä¸€ç§åŠæ³•å°±æ˜¯æ‰©å……å†…å­˜å·²é€‚åº”æ›´å¤šçš„è¿›ç¨‹\n* å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æŠŠè¿›ç¨‹ä¸­çš„æŸä¸ªå†…å­˜çš„ä¸€éƒ¨åˆ†æˆ–è€…å…¨éƒ¨ç§»åˆ°ç£ç›˜ä¸­ã€‚å½“å†…å­˜ä¸­æ²¡æœ‰å¤„äºå°±ç»ªæ€çš„è¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±æŠŠè¢«é˜»å¡çš„è¿›ç¨‹æ¢å‡ºåˆ°ç£ç›˜ä¸­çš„`æŒ‚èµ·é˜Ÿåˆ—`ï¼Œè¿™æ˜¯æš‚æ—¶ä¿å­˜ä»å†…å­˜ä¸­è¢«é©±é€å‡ºçš„è¿›ç¨‹é˜Ÿåˆ—ï¼Œæˆ–è€…è¯´æ˜¯è¢«æŒ‚èµ·çš„è¿›ç¨‹é˜Ÿåˆ—ã€‚æ“ä½œç³»ç»Ÿåœ¨æ­¤ä¹‹åå–å‡ºæŒ‚èµ·é˜Ÿåˆ—ä¸­çš„å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ–è€…æ¥å—ä¸€ä¸ªæ–°è¿›ç¨‹çš„è¯·æ±‚ï¼Œå°†å…¶çº³å…¥å†…å­˜è¿è¡Œã€‚\n\n\n![æœ‰æŒ‚èµ·æ€çš„è¿›ç¨‹çŠ¶æ€è½¬æ¢å›¾](<http://media.gusibi.mobi/RERwAhivDCla0-LTO6wylcXfaA0WFJTFS1oDvMIh9EkzsNrTbRVqu9rWuS9fUmMf>)\n\n\n> è¿™é‡Œæœ‰ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µï¼šè¿›ç¨‹æ˜¯å¦åœ¨ç­‰å¾…ä¸€ä¸ªäº‹ä»¶ï¼ˆé˜»å¡ä¸å¦ï¼‰ä»¥åŠè¿›ç¨‹æ˜¯å¦å·²ç»è¢«æ¢å‡ºå†…å­˜ï¼ˆæŒ‚èµ·ä¸å¦ï¼‰ã€‚è¿™é‡Œéœ€è¦4ä¸ªçŠ¶æ€ï¼š\n\n* `å°±ç»ªæ€`ï¼šè¿›ç¨‹åœ¨å†…å­˜ä¸­å¹¶å¯ä»¥æ‰§è¡Œ\n* `é˜»å¡æ€`ï¼šè¿›ç¨‹åœ¨å†…å­˜ä¸­å¹¶ç­‰å¾…ä¸€ä¸ªäº‹ä»¶\n* `é˜»å¡/æŒ‚èµ·æ€`ï¼šè¿›ç¨‹åœ¨å¤–å­˜ä¸­å¹¶ç­‰å¾…ä¸€ä¸ªäº‹ä»¶\n* `å°±ç»ª/æŒ‚èµ·æ€`ï¼šè¿›ç¨‹åœ¨å¤–å­˜ä¸­ï¼Œä½†æ˜¯åªè¦è¢«è½½å…¥å†…å­˜å°±å¯ä»¥æ‰§è¡Œ\n\nç°åœ¨çŠ¶æ€è½¬æ¢å¦‚ä¸‹ï¼š\n\n> `é˜»å¡`-`é˜»å¡/æŒ‚èµ·`ï¼šå¦‚æœæ²¡æœ‰å°±ç»ªè¿›ç¨‹ï¼Œåˆ™è‡³å°‘ä¸€ä¸ªé˜»å¡è¿›ç¨‹è¢«æ¢å‡ºï¼Œä¸ºå¦ä¸€ä¸ªæ²¡æœ‰é˜»å¡çš„è¿›ç¨‹è®©å‡ºç©ºé—´\n\n> `é˜»å¡/æŒ‚èµ·`-`å°±ç»ª/æŒ‚èµ·`ï¼šå¦‚æœç­‰å¾…äº‹ä»¶å‘ç”Ÿäº†ï¼Œæ¯”å¦‚ I/O ä¸å†é˜»å¡ï¼Œåˆ™å¤„äºé˜»å¡/æŒ‚èµ· çŠ¶æ€çš„è¿›ç¨‹å¯ä»¥è½¬æ¢åˆ° å°±ç»ª/æŒ‚èµ·çŠ¶æ€ã€‚\n\n> `é˜»å¡/æŒ‚èµ·`-`é˜»å¡`ï¼šæ¯”å¦‚ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢äº†ï¼Œé‡Šæ”¾äº†ä¸€äº›å†…å­˜ç©ºé—´ï¼Œé˜»å¡/æŒ‚èµ·é˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªè¿›ç¨‹æ¯” å°±ç»ª/æŒ‚èµ·é˜Ÿåˆ—ä¸­çš„ä»»ä½•ä»»ä½•è¿›ç¨‹çš„ä¼˜å…ˆçº§éƒ½è¦é«˜ï¼Œå¹¶ä¸”æ“ä½œç³»ç»Ÿæœ‰ç†ç”±ç›¸ä¿¡é˜»å¡è¿›ç¨‹çš„æ—¶é—´å¾ˆå¿«å°±ä¼šå‘ç”Ÿï¼Œè¿™æ—¶ï¼ŒæŠŠé˜»å¡è¿›ç¨‹è€Œä¸æ˜¯å°±ç»ªè¿›ç¨‹è°ƒå…¥å†…å­˜æ˜¯åˆç†çš„ã€‚\n\n### è¿›ç¨‹æ§åˆ¶\n\nå¤§å¤šæ•°å¤„ç†å™¨è‡³å°‘æ”¯æŒä¸¤ç§æ‰§è¡Œæ¨¡å¼ï¼ŒæŸäº›æŒ‡ä»¤åªèƒ½åœ¨ç‰¹æƒæ€ä¸‹è¿è¡Œï¼ŒåŒ…æ‹¬è¯»å–æˆ–æ”¹å˜è¯¸å¦‚ç¨‹åºçŠ¶æ€ä¹‹ç±»æ§åˆ¶å¯„å­˜å™¨çš„æŒ‡ä»¤ï¼ŒåŸå§‹ I/O æŒ‡ä»¤å’Œä¸å†…å­˜ç®¡ç†ç›¸å…³çš„æŒ‡ä»¤ã€‚å¦å¤–æœ‰éƒ¨åˆ†å†…å­˜åŒºåŸŸä»…åœ¨ç‰¹æƒæ€ä¸‹å¯ä»¥è¢«è®¿é—®åˆ°ã€‚\n\n> `ç‰¹æƒæ€`ï¼šç‰¹æƒæ€å¯ç§°åšç³»ç»Ÿæ€ã€æ§åˆ¶æ€æˆ–å†…æ ¸æ€ï¼Œå†…æ ¸æ€æŒ‡çš„æ˜¯æ“ä½œç³»ç»Ÿçš„å†…æ ¸ã€‚\n> `ç”¨æˆ·æ€`ï¼šç”¨æˆ·ç¨‹åºå¸¸åœ¨è¯¥æ¨¡å¼ä¸‹è¿è¡Œ\n\nä¸¤ç§æ¨¡å¼å¯ä»¥ä¿æŠ¤æ“ä½œç³»ç»Ÿå’Œé‡è¦çš„æ“ä½œç³»ç»Ÿè¡¨ä¸å—ç”¨æˆ·ç¨‹åºçš„å¹²æ¶‰ã€‚\n\næ“ä½œç³»ç»Ÿå†…æ ¸çš„å…¸å‹åŠŸèƒ½ï¼š\n\n![æ“ä½œç³»ç»Ÿå†…æ ¸çš„å…¸å‹åŠŸèƒ½](http://media.gusibi.mobi/icSKmpD5WmGdRg1YaqotICAvgAbhxbK7fAzcXE1nhVSzua6LhvbeZJGpQdXiKqX-)\n\n#### è¿›ç¨‹åˆ‡æ¢\n\nä»è¡¨é¢çœ‹ï¼Œè¿›ç¨‹åˆ‡æ¢éå¸¸ç®€å•ã€‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œæ“ä½œç³»ç»Ÿä¸­æ–­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œç„¶åæŒ‡å®šå¦ä¸€ä¸ªè¿›ç¨‹ä¸ºè¿è¡Œæ€ï¼Œå¹¶æŠŠæ§åˆ¶æƒäº¤ç»™è¿™ä¸ªè¿›ç¨‹ã€‚ä½†æ˜¯ç°åœ¨ä¼šæœ‰å‡ ä¸ªé—®é¢˜ï¼š\n\n* ä»€ä¹ˆäº‹ä»¶è§¦å‘è¿›ç¨‹åˆ‡æ¢\n* æ¨¡å¼åˆ‡æ¢å’Œè¿›ç¨‹åˆ‡æ¢çš„åŒºåˆ«\n* è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿè¦åšå“ªäº›å·¥ä½œ\n\n`ä½•æ—¶åˆ‡æ¢è¿›ç¨‹`ï¼Ÿ\n\nè¿›ç¨‹åˆ‡æ¢å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä»å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­è·å¾—æ§åˆ¶æƒçš„ä»»ä½•æ—¶åˆ»å‘ç”Ÿã€‚ä»¥ä¸‹æ˜¯å¯èƒ½æŠŠæ§åˆ¶æƒäº¤ç»™æ“ä½œç³»ç»Ÿçš„äº‹ä»¶ï¼š\n\n![è¿›ç¨‹æ‰§è¡Œçš„ä¸­æ–­æœºåˆ¶](http://media.gusibi.mobi/Jb4HJnGGvdlYgSmF1goSBFTo2sHE8atDcPaO3yw54AHs39xw8PxXiKrpnKZ7frtn)\n\n ç³»ç»Ÿä¸­æ–­é€šå¸¸åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯`ä¸­æ–­`ï¼Œå¦ä¸€ç§æ˜¯`é™·é˜±`ã€‚\n`ä¸­æ–­`ä¸å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ— å…³çš„æŸç§ç±»å‹çš„å¤–éƒ¨äº‹ä»¶ç›¸å…³ï¼Œæ¯”å¦‚ I/O æ“ä½œï¼›`é™·é˜±`ä¸å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹é”äº§ç”Ÿçš„é”™è¯¯æˆ–å¼‚å¸¸æ¡ä»¶ç›¸å…³ï¼Œæ¯”å¦‚éæ³•çš„æ–‡ä»¶è®¿é—®ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä¸­æ–­äº‹ä»¶ï¼š\n\n> * `æ—¶é’Ÿä¸­æ–­`ï¼šæ“ä½œç³»ç»Ÿç¡®è®¤å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„æ‰§è¡Œæ—¶é—´å·²ç»è¶…è¿‡äº†æœ€å¤§å…è®¸æ—¶é—´æ®µï¼ˆæ—¶é—´ç‰‡ï¼šå³è¿›ç¨‹åœ¨è¢«ä¸­æ–­å‰å¯ä»¥æ‰§è¡Œçš„æœ€å¤§æ—¶é—´æ®µï¼‰ï¼Œè¿›ç¨‹å¿…é¡»åˆ‡æ¢åˆ°å°±ç»ªæ€ï¼Œè°ƒå…¥å¦ä¸€ä¸ªè¿›ç¨‹ã€‚\n> * `I/O ä¸­æ–­`ï¼šè¿›ç¨‹ç­‰å¾… I/O æ´»åŠ¨ã€‚\n> * `å†…å­˜å¤±æ•ˆ`ï¼šå¤„ç†å™¨è®¿é—®ä¸€ä¸ªè™šæ‹Ÿå†…å­˜åœ°å€ï¼Œä¸”æ¬¡åœ°å€å•å…ƒä¸åœ¨å†…å­˜ä¸­ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä»å¤–å­˜ä¸­æŠŠåŒ…å«è¿™ä¸ªå¼•ç”¨çš„å†…å­˜å—è°ƒå…¥å†…å­˜ä¸­ã€‚åœ¨å‘å‡ºè°ƒå…¥å†…å­˜å—çš„ I/O è¯·æ±‚ä¹‹åï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæ‰§è¡Œä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢ï¼Œä»¥æ¢å¤å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œï¼Œå‘ç”Ÿå†…å­˜å¤±æ•ˆçš„è¿›ç¨‹è¢«ç½®ä¸ºé˜»å¡æ€ï¼Œå½“å‰çš„å—è°ƒå…¥å†…å­˜ä¸­æ—¶ï¼Œè¯¥è¿›ç¨‹è¢«ç½®ä¸ºå°±ç»ªæ€ã€‚\n\nå¯¹äº`é™·é˜±`,æ“ä½œç³»ç»Ÿé¦–å…ˆç¡®è®¤é”™è¯¯æˆ–è€…å¼‚å¸¸æ˜¯å¦æ˜¯è‡´å‘½çš„ã€‚å¦‚æœæ˜¯ï¼Œå½“å‰è¿›ç¨‹è¢«è½¬æ¢åˆ°é€€å‡ºæ€ï¼›å¦‚æœä¸æ˜¯ï¼Œæ“ä½œç³»ç»Ÿçš„åŠ¨ä½œå–å†³äºé”™è¯¯çš„ç§ç±»å’Œæ“ä½œç³»ç»Ÿçš„è®¾è®¡ï¼ˆæœ‰å¯èƒ½æ˜¯è§†å›¾æ¢å¤æˆ–é€šçŸ¥ç”¨æˆ·ï¼‰ã€‚\næ“ä½œç³»ç»Ÿä¹Ÿå¯èƒ½è¢«æ¥è‡ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„`ç³»ç»Ÿè°ƒç”¨`æ¿€æ´»ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶ï¼Œé€šå¸¸ï¼Œä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ä¼šå¯¼è‡´æŠŠå½“å‰è¿›ç¨‹ç½®ä¸ºé˜»å¡æ€\n\n##### ç³»ç»Ÿè°ƒç”¨\n\nUnix ç³»ç»Ÿæ˜¯ç”±ç”¨æˆ·ç©ºé—´ï¼ˆuserlandï¼‰å’Œå†…æ ¸ç»„æˆã€‚Unix å†…æ ¸ä½äºè®¡ç®—æœºç¡¬ä»¶ä¹‹ä¸Šï¼Œæ˜¯ä¸æ‘‡ç¯®å—äº¤äº’çš„ä¸­ä»‹ã€‚è¿™äº›äº¤äº’åŒ…æ‹¬é€šè¿‡é—®å·ç³»ç»Ÿè¿›ç¨‹è¯»/å†™ã€åœ¨ç½‘ç»œä¸Šå‘é€æ•°æ®ã€åˆ†é…å†…å­˜ï¼Œä»¥åŠé€šè¿‡æ‰¬å£°å™¨æ’­æ”¾éŸ³é¢‘ã€‚è¿™äº›éƒ½æ˜¯ç”¨æˆ·åº”ç”¨ç¨‹åºæ‰€ä¸èƒ½æ¶‰åŠçš„ï¼Œåªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆã€‚\n\n> `ç³»ç»Ÿè°ƒç”¨`ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´æ­å»ºäº†æ¡¥æ¢ã€‚è§„å®šäº†ç¨‹åºå’Œè®¡ç®—æœºç¡¬ä»¶ç›´æ¥æ‰€å…è®¸å‘ç”Ÿçš„ä¸€åˆ‡äº¤äº’ã€‚\n\næ¨¡å¼åˆ‡æ¢å’Œè¿›ç¨‹åˆ‡æ¢æ˜¯ä¸åŒçš„ã€‚å‘ç”Ÿæ¨¡å¼åˆ‡æ¢å¯ä»¥ä¸æ”¹å˜æ­£å¤„äºè¿è¡Œæ€çš„è¿›ç¨‹çš„çŠ¶æ€ï¼Œè€Œè¿›ç¨‹è¢«è½¬æ¢åˆ°å¦ä¸€ä¸ªçŠ¶æ€æ“ä½œç³»ç»Ÿå¿…é¡»ä½¿å…¶ç¯å¢ƒäº§ç”Ÿå®è´¨æ€§çš„å˜åŒ–ã€‚\n\nè¿›ç¨‹åˆ‡æ¢æ­¥éª¤å¦‚ä¸‹ï¼š\n1. ä¿å­˜å¤„ç†å™¨ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨\n2. æ›´æ–°å½“å‰å¤„äºè¿è¡Œæ€è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—\n3. å°†è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—ç§»åˆ°ç›¸åº”çš„é˜Ÿåˆ—ï¼ˆå°±ç»ªã€æŒ‚èµ·ç­‰ï¼‰\n4. é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œ\n5. æ›´æ–°æ‰€é€‰æ‹©è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—ï¼ŒåŒ…æ‹¬å°†è¿›ç¨‹çš„çŠ¶æ€å˜ä¸ºè¿è¡Œæ€\n6. æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„\n7. æ¢å¤å¤„ç†å™¨åœ¨è¢«é€‰æ‹©çš„è¿›ç¨‹æœ€è¿‘ä¸€æ¬¡åˆ‡æ¢å‡ºè¿è¡Œæ€æ—¶çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚\n\nä¸‹ä¸€ç¯‡å°†ä»‹ç» Unix è¿›ç¨‹\n\n## å‚è€ƒ\n\nã€Šæ“ä½œç³»ç»Ÿ-ç²¾é«“ä¸è®¾è®¡åŸç†ã€‹\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\næƒ³äº†è§£ä»¥ä¸‹å†…å®¹å¯ä»¥åœ¨å…¬å·è¾“å…¥ç›¸åº”å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š `å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n| å…³æ³¨ |èµèµ |\n|---|---|\n|![](http://media.gusibi.mobi/kel2L88yf9YXZYecLIn0LPZPSXc7zJfHyGUz5biWsZrGh7xF2JONZT93dgClGdMn)|![](http://media.gusibi.mobi/VFjjmZ7cgkIkpieAFHYXcLVBB8f9snm2vAzc0GyLjSmCzok8mL3vqLNMzYVvrDha)|\n",
      "data": {
        "title": "æ“ä½œç³»ç»Ÿè¿›ç¨‹æè¿°",
        "date": "2018-03-20 15:25:53",
        "tags": [
          "è¿›ç¨‹",
          "å¹¶å‘",
          "è¯»ä¹¦ç¬”è®°",
          "åç«¯"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "system-process-2"
    },
    {
      "content": "\n> è¿™æ˜¯`æ“ä½œç³»ç»Ÿè¿›ç¨‹`ç³»åˆ—æ–‡ç« ç¬¬ä¸€ç¯‡-æ“ä½œç³»ç»Ÿå‘å±•å’Œè¿›ç¨‹ç®€ä»‹\n\n### æ“ä½œç³»ç»Ÿçš„å‘å±•\n\n#### ä¸²è¡Œå¤„ç†\n\nå¯¹äºæ—©æœŸè®¡ç®—æœºï¼ˆ20ä¸–çºª40å¹´ä»£åæœŸåˆ°20ä¸–çºª50å¹´ä»£ä¸­æœŸï¼‰ï¼Œå› ä¸ºæ²¡æœ‰æ“ä½œç³»ç»Ÿï¼Œç¨‹åºå‘˜éƒ½æ˜¯ç›´æ¥ä¸è®¡ç®—æœºç¡¬ä»¶æ‰“äº¤é“ã€‚è¿™äº›æœºå™¨éƒ½åœ¨ä¸€ä¸ªæ§åˆ¶å°ä¸Šè¿è¡Œï¼Œæ§åˆ¶å°åŒ…æ‹¬æ˜¾ç¤ºç¯ã€è§¦å‘å™¨ã€æŸç§ç±»å‹çš„è¾“å…¥è®¾å¤‡å’Œæ‰“å°æœºã€‚ç”¨æœºå™¨ä»£ç ç¼–å†™çš„ç¨‹åºé€šè¿‡è¾“å…¥è®¾å¤‡è½½å…¥è®¡ç®—æœºã€‚å¦‚æœç¨‹åºå› é”™è¯¯åœæ­¢ï¼Œé”™è¯¯åŸå› ç”±æŒ‡ç¤ºç¯åªæ˜¯ã€‚å¦‚æœç¨‹åºè¿è¡Œç»“æŸï¼Œç»“æœå°†å‡ºç°åœ¨æ‰“å°æœºä¸­ã€‚\n\n*æ—©æœŸç³»ç»Ÿä¸»è¦æœ‰ä¸¤ä¸ªé—®é¢˜*ï¼š\n\n- è°ƒåº¦ï¼š å¤§å¤šæ•°è®¾å¤‡ä½¿ç”¨ä¸€ä¸ªç¡¬æ‹·è´çš„ç™»è®°è¡¨é¢„å®šæ—¶é—´ã€‚å¦‚æœç”¨æˆ·é¢„å®šäº†ä¸€ä¸ªå°æ—¶ï¼ŒåŠå°æ—¶å°±è¿è¡Œç»“æŸï¼Œè®¡ç®—æœºå°†é—²ç½®30åˆ†é’Ÿï¼Œè€Œå¦‚æœæ²¡æœ‰åœ¨ä¸€ä¸ªå°æ—¶å†…è¿è¡Œç»“æŸï¼Œç¨‹åºä¹Ÿä¼šè¢«å¼ºåˆ¶åœæ­¢ã€‚\n- å‡†å¤‡æ—¶é—´ï¼šä¸€ä¸ªç¨‹åºç§°ä¸ºä¸€ä¸ªä½œä¸šï¼Œè¿è¡Œä¸€ä¸ªç¨‹åºå¯èƒ½éœ€è¦å¾€å†…å­˜ä¸­åŠ è½½ç¼–è¯‘å™¨å’Œç¨‹åºè¯­è¨€ï¼Œä¿å­˜ç¼–è¯‘ç¨‹åºï¼ŒåŠ è½½ç›®æ ‡ç¨‹åºå’Œå…¬ç”¨å‡½æ•°å˜é“¾æ¥åœ¨ä¸€èµ·ã€‚æ¯ä¸€æ­¥éƒ½å¯èƒ½éœ€è¦å®‰è£…æ‹†å¸ç¡¬ä»¶ï¼Œå¦‚æœè¿™äº›æ­¥éª¤å‡ºç°é”™è¯¯ï¼Œåªèƒ½é‡æ–°å¼€å§‹ï¼Œä¼šå ç”¨å¤ªå¤šæ—¶é—´ã€‚\n\nè¿™ç§æ¨¡å¼ç§°ä¸ºä¸²è¡Œå¤„ç†ï¼Œç”¨æˆ·å¿…é¡»é¡ºåºè®¿é—®è®¡ç®—æœºã€‚\n\n#### ç®€å•æ‰¹å¤„ç†ç³»ç»Ÿ\n\næ—©æœŸè®¡ç®—æœºéå¸¸è´µï¼Œè°ƒåº¦å’Œå‡†å¤‡åˆéå¸¸æµªè´¹æ—¶é—´å’Œèµ„æºï¼Œä¸ºäº†æœ€å¤§é™åº¦çš„åˆ©ç”¨å¤„ç†å™¨ï¼Œå½“æ—¶çš„ç ”ç©¶äººå‘˜å¼€å‘äº†æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿã€‚\n\nç¬¬ä¸€ä¸ªæ‰¹å¤„ç†æ“ä½œç³»ç»Ÿï¼ˆä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼‰æ˜¯20ä¸–çºª50å¹´ä»£ä¸­æœŸç”± General Motors å¼€å‘çš„ï¼Œç”¨åœ¨ IBM 701ä¸Šã€‚\n\nç®€å•æ‰¹å¤„ç†æ–¹æ¡ˆçš„ä¸­å¿ƒæ€æƒ³æ˜¯ä½¿ç”¨ä¸€ä¸ªç§°ä½œ`ç›‘æ§ç¨‹åº`çš„è½¯ä»¶ã€‚é€šè¿‡ä½¿ç”¨è¿™ç±»æ“ä½œç³»ç»Ÿï¼Œç”¨æˆ·ä¸å†ç›´æ¥è®¿é—®æœºå™¨ï¼Œç›¸åï¼Œç”¨æˆ·æŠŠå¡ç‰‡æˆ–ç£å¸¦ä¸­çš„ä½œä¸šæäº¤ç»™è®¡ç®—æœºç®¡ç†å‘˜ï¼Œç”±ä»–æŠŠè¿™äº›ä½œä¸šæŒ‰é¡ºåºç»„ç»‡æˆä¸€æ‰¹ï¼Œå¹¶å°†æ•´ä¸ªæ‰¹ä½œä¸šæ”¾åœ¨è¾“å…¥è®¾å¤‡ä¸Šï¼Œä¾›ç›‘æ§ç¨‹åºä½¿ç”¨ã€‚æ¯ä¸ªç¨‹åºå®Œæˆæ‰¹å¤„ç†åè¿”å›åˆ°ç›‘æ§ç¨‹åºï¼ŒåŒäº‹ç›‘æ§ç¨‹åºè‡ªåŠ¨åŠ è½½ä¸‹ä¸€ä¸ªç¨‹åºã€‚\n\næˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªè§’åº¦åˆ†æè¿™ä¸ªæ–¹æ¡ˆæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š\n\n`ç›‘æ§ç¨‹åºè§’åº¦ï¼š` ç›‘æ§ç¨‹åºä¸ºäº†èƒ½ä¸€ç›´æ§åˆ¶äº‹ä»¶çš„é¡ºåºï¼Œéœ€è¦æ€»æ˜¯å¤„äºå†…å­˜ä¸­å¹¶ä¸”å¯ä»¥æ‰§è¡Œã€‚ç›‘æ§ç¨‹åºæ¯æ¬¡ä»è¾“å…¥è®¾å¤‡ä¸­è¯»å–ä¸€ä¸ªä½œä¸šï¼Œè¯»å…¥åï¼Œå½“å‰ä½œä¸šè¢«æ”¾ç½®åœ¨ç”¨æˆ·ç¨‹åºåŒºåŸŸï¼Œå¹¶æŠŠæ§åˆ¶æƒäº¤ç»™è¿™ä¸ªä½œä¸šã€‚ä½œä¸šå®Œæˆåï¼Œæ§åˆ¶æƒäº¤è¿˜ç»™ç›‘æ§ç¨‹åºï¼Œç›‘æ§ç¨‹åºå†è¯»å…¥ä¸‹ä¸€ä¸ªä½œä¸šã€‚\n\n`å¤„ç†å™¨è§’åº¦:` ä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œå¤„ç†å™¨æ‰§è¡Œå†…å­˜ä¸­å­˜å‚¨çš„ç›‘æ§ç¨‹åºçš„æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤è¯»å…¥ä¸‹ä¸€ä¸ªä½œä¸šå¹¶å­˜å‚¨åˆ°å†…å­˜ä¸­çš„å¦ä¸€ä¸ªéƒ¨åˆ†ã€‚ä¸€æ—¦å·²ç»è¯»å…¥ä¸€ä¸ªä½œä¸šï¼Œå¤„ç†å™¨å°†ä¼šé‡åˆ°ç›‘æ§ç¨‹åºçš„åˆ†æ”¯æŒ‡ä»¤ï¼Œåˆ†æ”¯æŒ‡ä»¤æŒ‡å¯¼å¤„ç†å™¨åœ¨ç”¨æˆ·ç¨‹åºå¼€å§‹å¤„ç»§ç»­æ‰§è¡Œã€‚å¤„ç†å™¨ç»§è€Œæ‰§è¡Œç”¨æˆ·ç¨‹åºç›´åˆ°æ‰§è¡Œç»“æŸæˆ–è€…é‡åˆ°é”™è¯¯ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå¤„ç†å™¨éƒ½å°†ä»ç›‘æ§ç¨‹åºè¯»å…¥ä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚\n\n> `æ§åˆ¶æƒäº¤ç»™ä½œä¸š`ä»…ä»…æ„å‘³ç€å¤„ç†å™¨å½“å‰å–å’Œæ‰§è¡Œçš„éƒ½æ˜¯ç”¨æˆ·ç¨‹åºä¸­çš„æŒ‡ä»¤ï¼Œè€Œ`æ§åˆ¶æƒäº¤ç»™ç›‘æ§ç¨‹åº`çš„æ„æ€æ˜¯å¤„ç†å™¨å½“å‰ä»ç›‘æ§ç¨‹åºä¸­å–æŒ‡ä»¤å¹¶ä¸”æ‰§è¡ŒæŒ‡ä»¤ã€‚\n\nç›‘æ§ç¨‹åºæˆ–è€…æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„è®¡ç®—æœºç¨‹åºã€‚å®ƒä¾èµ–äºå¤„ç†å™¨å¯ä»¥ä»å†…å­˜çš„ä¸åŒéƒ¨åˆ†å–æŒ‡ä»¤çš„èƒ½åŠ›ï¼Œä»¥äº¤æ›¿çš„è·å–æˆ–é‡Šæ”¾æ§åˆ¶æƒã€‚æ­¤å¤–ï¼Œè¿˜è¦è€ƒè™‘å…¶ä»–ç¡¬ä»¶åŠŸèƒ½ï¼š\n\n* å†…å­˜ä¿æŠ¤ï¼šå½“ç”¨æˆ·ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œä¸èƒ½æ”¹å˜åŒ…å«ç›‘æ§ç¨‹åºçš„å†…å­˜åŒºåŸŸ\n* å®šæ—¶å™¨ï¼šç”¨æˆ·é˜²æ­¢ä¸€ä¸ªä½œä¸šç‹¬å ç³»ç»Ÿã€‚ä½œä¸šå¼€å§‹æ—¶ï¼Œè®¾ç½®å®šæ—¶å™¨ï¼Œæ—¶é—´åˆ°ï¼Œç”¨æˆ·ç¨‹åºå°†è¢«åœæ­¢\n* ç‰¹æƒæŒ‡å®šï¼šæŸäº›æŒ‡ä»¤è®¾è®¡æˆç‰¹æƒæŒ‡ä»¤ï¼Œåªèƒ½ç”±ç›‘æ§ç¨‹åºæ‰§è¡Œã€‚\n* ä¸­æ–­ï¼šæ—©æœŸçš„è®¡ç®—æœºæ¨¡å‹æ²¡æœ‰ä¸­æ–­èƒ½åŠ›ã€‚è¿™ä¸ªç‰¹å¾ä½¿å¾—æ“ä½œç³»ç»Ÿåœ¨è®©ç”¨æˆ·ç¨‹åºæ”¾å¼ƒæ§åˆ¶æƒæˆ–ä»ç”¨æˆ·ç¨‹åºè·å¾—æ§åˆ¶æƒæ—¶å…·æœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚\n\n#### å¤šé“ç¨‹åºè®¾è®¡æ‰¹å¤„ç†ï¼ˆå¤šä»»åŠ¡å¤„ç†ï¼‰ç³»ç»Ÿ\n\nè™½ç„¶ç®€å•çš„æ‰¹å¤„ç†ç³»ç»Ÿå¯ä»¥æä¾›è‡ªåŠ¨ä½œä¸šåºåˆ—ï¼Œä½†ç”±äº I/O è®¾å¤‡å¤„ç†é€Ÿåº¦ç›¸å¯¹äºå¤„ç†å™¨é€Ÿåº¦å¤ªæ…¢ï¼Œå¤„ç†å™¨ä»ç„¶ç»å¸¸ç©ºé—²ã€‚è¿™ä¸ªæ—¶å€™å¤šé“ç¨‹åºè®¾è®¡/å¤šä»»åŠ¡å¤„ç†æ–¹æ¡ˆå°±è¢«æäº†å‡ºæ¥ã€‚\n\nå®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šåŸºäºå†…å­˜ç©ºé—´å¯ä»¥ä¿å­˜æ“ä½œç³»ç»Ÿå’Œä¸€ä¸ªç”¨æˆ·ç¨‹åºï¼Œå‡è®¾å†…å­˜ç©ºé—´å®¹å¾—ä¸‹æ“ä½œç³»ç»Ÿå’Œä¸¤ä¸ªç”¨æˆ·ç¨‹åºï¼Œé‚£ä¹ˆå½“ä¸€ä¸ªä½œä¸šéœ€è¦ç­‰å¾… I/O æ—¶ï¼Œå¤„ç†å™¨å¯ä»¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå¯èƒ½å¹¶ä¸åœ¨ç­‰å¾… I/O çš„ä½œä¸šã€‚è¿›ä¸€æ­¥è¿˜å¯ä»¥æ‰©å±•å­˜å‚¨å™¨ä»¥ä¿å­˜ä¸‰ä¸ªã€å››ä¸ªæˆ–æ›´å¤šçš„ç¨‹åºï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚\n\n![å¤šé“ç¨‹åºè®¾è®¡å®ä¾‹](<http://media.gusibi.mobi/knNY5bDB-SP5Vn1eOwq1QOBnC6F8SfwZD1ZIw94D_Gs4JXBKidmXYsgnHNpvjUOu>)\n\nå¤šé“ç¨‹åºæ“ä½œç³»ç»Ÿæ¯”å•ä¸ªç¨‹åºæˆ–å•é“ç¨‹åºç³»ç»Ÿç›¸å¯¹è¦å¤æ‚ä¸€äº›ã€‚å¯¹å‡†å¤‡è¿è¡Œçš„å¤šä¸ªä½œä¸šï¼Œå®ƒä»¬å¿…é¡»ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™å°±éœ€è¦å†…å­˜ç®¡ç†ã€‚æ­¤å¤–ï¼Œå¦‚æœå¤šä¸ªä½œä¸šéƒ½å‡†å¤‡è¿è¡Œï¼Œå¤„ç†å™¨è¿˜å¿…é¡»å†³å®šè¿è¡Œå“ªä¸€ä¸ªï¼Œè¿™éœ€è¦æŸç§è°ƒåº¦ç®—æ³•ã€‚\n\nå¤šé“ç¨‹åºè®¾è®¡æ˜¯ä¸ºäº†è®©å¤„ç†å™¨å’Œ I/O è®¾å¤‡åŒæ—¶ä¿æŒå¿™çŠ¶æ€ï¼Œä»¥å®ç°æœ€å¤§æ•ˆç‡ã€‚å…¶å…³é”®æœºåˆ¶æ˜¯ï¼šåœ¨å“åº”è¡¨ç¤º I/O äº‹åŠ¡ç»“æŸçš„ä¿¡å·æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯¹å†…å­˜ä¸­é©»ç•™çš„ä¸åŒç¨‹åºè¿›è¡Œå¤„ç†å™¨åˆ‡æ¢ã€‚\n\n#### åˆ†æ—¶ç³»ç»Ÿ\n\né€šè¿‡ä½¿ç”¨å¤šé“ç¨‹åºè®¾è®¡ï¼Œå¯ä»¥ä½¿æ‰¹å¤„ç†æ›´åŠ æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹è®¸å¤šä½œä¸šæ¥è¯´ï¼Œéœ€è¦æä¾›ä¸€ä¸ªäº¤äº’æ¨¡å¼ï¼Œä»¥ä½¿ç”¨æˆ·å¯ä»¥å’Œè®¡ç®—æœºäº¤äº’ã€‚\n\nå› ä¸ºå½“æ—¶çš„è®¡ç®—æœºç‰¹åˆ«æ˜‚è´µä¸”å·¨å¤§ï¼Œæ™®é€šç”¨æˆ·ä¹Ÿä¹°ä¸èµ·ï¼Œåˆ†æ—¶æ“ä½œç³»ç»Ÿåº”è¿è€Œç”Ÿã€‚\n\nå’Œå¤šé“ç¨‹åºè®¾è®¡å…è®¸å¤„ç†å™¨åŒæ—¶å¤„ç†å¤šä¸ªæ‰¹ä½œä¸šä¸€æ ·ï¼Œå®ƒè¿˜å¯ä»¥ç”¨äºå¤„ç†å¤šä¸ªäº¤äº’ä½œä¸šã€‚\n\n> å¤šä¸ªç”¨æˆ·åˆ†äº«å¤„ç†å™¨çš„æ—¶é—´ï¼Œå› è€Œè¯¥æŠ€æœ¯æˆä¸ºåˆ†æ—¶ã€‚\n\nåˆ†æ—¶ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªç”¨æˆ·å¯ä»¥é€šè¿‡ç»ˆç«¯åŒæ—¶è®¿é—®ç³»ç»Ÿï¼Œç”±æ“ä½œç³»ç»Ÿæ§åˆ¶æ¯ä¸ªç”¨æˆ·ç¨‹åºä»¥å¾ˆçŸ­çš„æ—¶é—´ä¸ºå•ä½äº¤æ›¿æ‰§è¡Œã€‚\n\n> å¦‚æœæœ‰ n ä¸ªç”¨æˆ·åŒæ—¶è¯·æ±‚æœåŠ¡ï¼Œè‹¥ä¸è®¡ç®—æ“ä½œç³»ç»Ÿçš„å¼€é”€ï¼Œæ¯ä¸ªç”¨æˆ·å¹³å‡åªèƒ½å¾—åˆ°1/n è®¡ç®—æœºçš„æœ‰æ•ˆé€Ÿåº¦ï¼Œä½†ç”±äºäººçš„ååº”æ—¶é—´ç›¸å¯¹è®¡ç®—æœºæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„æ“ä½œç³»ç»Ÿï¼Œå…¶å“åº”æ—¶é—´å¯ä»¥æ¥è¿‘äºè®¡ç®—æœºçš„æ—¶é—´ã€‚\n\næ‰¹å¤„ç†å¤šé“ç¨‹åºè®¾è®¡å’Œåˆ†æ—¶çš„æ¯”è¾ƒ\n\n| é¡¹ç›®           | æ‰¹å¤„ç†å¤šé“ç¨‹åºè®¾è®¡         | åˆ†æ—¶             |\n| -------------- | -------------------------- | ---------------- |\n| ä¸»è¦ç›®æ ‡       | å……åˆ†ä½¿ç”¨å¤„ç†å™¨             | å‡å°å“åº”æ—¶é—´     |\n| æ“ä½œç³»ç»ŸæŒ‡ä»¤æº | ä½œä¸šæä¾›çš„ä½œä¸šæ§åˆ¶è¯­è¨€å‘½ä»¤ | ä»ç»ˆç«¯é”®å…¥çš„å‘½ä»¤ |\n\n> ç¬¬ä¸€ä¸ªåˆ†æ—¶æ“ä½œç³»ç»Ÿæ˜¯ç”±éº»çœç†å·¥å­¦é™¢å¼€å‘çš„å…¼å®¹åˆ†æ—¶ç³»ç»Ÿï¼ˆCTSSï¼‰ã€‚ç³»ç»Ÿè¿è¡Œåœ¨ä¸€å°å†…å­˜ä¸º32000ä¸ª36ä½å­—çš„æœºå™¨ä¸Šï¼Œå¸¸é©»ç¨‹åºå ç”¨äº†5000ä¸ªã€‚å½“æ§åˆ¶æƒè¢«åˆ†é…ç»™ä¸€ä¸ªäº¤äº’ç”¨æˆ·æ—¶ï¼Œæ”¹ç”¨æˆ·çš„ç¨‹åºå’Œæ•°æ®è¢«è½½å…¥åˆ°å†…å­˜å‰©ä½™çš„27000ä¸ªå­—çš„ç©ºé—´ä¸­ã€‚ç¨‹åºé€šå¸¸åœ¨ç¬¬5000ä¸ªå­—å•å…ƒå¤„å¼€å§‹è¢«è½½å…¥ï¼Œç³»ç»Ÿæ—¶é’Ÿä»¥å¤§çº¦æ²¡0.2ç§’ä¸€ä¸ªçš„é€Ÿåº¦äº§ç”Ÿä¸­æ–­ï¼Œåœ¨æ¯ä¸ªä¸­æ–­å¤„ï¼Œæ“ä½œç³»ç»Ÿæ¢å¤æ§åˆ¶æƒï¼Œå¹¶å°†å¤„ç†å™¨åˆ†é…ç»™ä¸‹ä¸€ä¸ªç”¨æˆ·ã€‚å› æ­¤ï¼Œåœ¨å›ºå®šçš„æ—¶é—´é—´éš”å†…ï¼Œå½“å‰ç”¨æˆ·è¢«å‰¥å¤ºï¼Œå¦ä¸€ä¸ªç”¨æˆ·è¢«è½½å…¥ã€‚è¿™é¡¹æŠ€æœ¯ç§°ä¸º`æ—¶é—´ç‰‡`æŠ€æœ¯ã€‚\n\næ“ä½œç³»ç»Ÿæ˜¯æœ€å¤æ‚çš„è½¯ä»¶ä¹‹ä¸€ï¼Œæ“ä½œç³»ç»Ÿå¼€å‘ä¸­æœ‰5ä¸ªé‡è¦çš„ç†è®ºè¿›å±•ï¼š`è¿›ç¨‹`ã€`å†…å­˜ç®¡ç†`ã€`ä¿¡æ¯ä¿æŠ¤å’Œå®‰å…¨`ã€è°ƒåº¦å’Œèµ„æºç®¡ç†ã€ç³»ç»Ÿç»“æ„ã€‚\n\n### è¿›ç¨‹\n\nè¿›ç¨‹çš„æ¦‚å¿µæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ï¼Œè¿™ä¸ªå±äºæœ€æ—©åœ¨20ä¸–çºª60å¹´ä»£è¢«æå‡ºã€‚\n\nå…³äºè¿›ç¨‹æœ‰å¾ˆå¤šå®šä¹‰ï¼š\n\n* ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åº\n* è®¡ç®—æœºä¸­æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ä¸ªå®ä¾‹\n* å¯ä»¥åˆ†é…ç»™å¤„ç†å™¨å¹¶ç”±å¤„ç†å™¨æ‰§è¡Œçš„ä¸€ä¸ªå®ä½“\n* ç”±å•ä¸€çš„é¡ºåºçš„æ‰§è¡Œçº¿ç¨‹ã€ä¸€ä¸ªå½“å‰çŠ¶æ€å’Œä¸€ç»„ç›¸å…³çš„ç³»ç»Ÿèµ„æºæ‰€æè¿°çš„æ´»åŠ¨å•å…ƒ\n\nç³»ç»Ÿç¨‹åºå‘˜åœ¨å¼€å‘æ—©æœŸçš„å¤šé“ç¨‹åºï¼ˆå¤šä»»åŠ¡ï¼‰å’Œå¤šç”¨æˆ·äº¤äº’ç³»ç»Ÿæ—¶ï¼ˆåˆ†æ—¶ï¼‰ä½¿ç”¨çš„ä¸»è¦å·¥å…·æ˜¯ä¸­æ–­ã€‚ä¸€ä¸ªå·²å®šä¹‰äº‹ä»¶çš„å‘ç”Ÿå¯ä»¥æš‚åœä»»ä½•ä½œä¸šçš„æ´»åŠ¨ã€‚å¤„ç†å™¨ä¿ç•™æŸäº›ä¸Šä¸‹æ–‡ï¼ˆå¦‚ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨ï¼‰ï¼Œç„¶åè·³è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åºä¸­ï¼Œå¤„ç†ä¸­æ–­ï¼Œç„¶åæ¢å¤ç”¨æˆ·è¢«ä¸­æ–­ä½œä¸šæˆ–å…¶ä»–ä½œä¸šçš„å¤„ç†ã€‚\n\nè®¾è®¡å‡ºä¸€ä¸ªèƒ½å¤Ÿåè°ƒå„ç§ä¸åŒæ´»åŠ¨çš„ç³»ç»Ÿè½¯ä»¶éå¸¸å›°éš¾ï¼Œä¹Ÿå®¹æ˜“å‡ºé”™ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œäº§ç”Ÿè¿™ç±»é”™è¯¯åˆ4ä¸ªä¸»è¦åŸå› ï¼š\n\n1. ä¸æ­£ç¡®çš„åŒæ­¥ï¼šå¸¸å¸¸ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œä¸€ä¸ªä¾‹ç¨‹å¿…é¡»æŒ‚èµ·ï¼Œç­‰å¾…ç³»ç»Ÿä¸­å…¶ä»–åœ°æ–¹çš„æŸä¸€äº‹ä»¶ã€‚\n2. å¤±è´¥çš„äº’æ–¥ï¼šå¸¸å¸¸å‡ºç°å¤šä¸ªç”¨æˆ·æˆ–ç¨‹åºè¯•å›¾åŒæ—¶ä½¿ç”¨ä¸€ä¸ªå…±äº«èµ„æºçš„æƒ…å†µã€‚ï¼ˆä¾‹å¦‚ä¸¤ä¸ªç”¨æˆ·åŒæ—¶è¯•å›¾ç¼–è¾‘æ–‡ä»¶ï¼‰\n3. ä¸æ­£ç¡®çš„ç¨‹åºæ“ä½œï¼šä¸€ä¸ªç‰¹å®šçš„ç¨‹åºç»“æœåªä¾èµ–ä¸è¯¥ç¨‹åºçš„è¾“å…¥ï¼Œè€Œå¹¶ä¸ä¾èµ–äºå…±äº«ç³»ç»Ÿä¸­å…¶ä»–ç¨‹åºçš„æ´»åŠ¨ã€‚ä½†å½“ç¨‹åºå…±äº«å†…å­˜å¹¶ä¸”å¤„ç†å™¨æ§åˆ¶å®ƒä»¬äº¤é”™æ‰§è¡Œæ—¶ï¼Œå®ƒä»¬å¯èƒ½ä¼šå› ä¸ºé‡å†™ç›¸åŒçš„å†…å­˜åŒºåŸŸè€Œå‘ç”Ÿä¸å¯é¢„æµ‹çš„ç›¸äº’å¹²æ‰°\n4. æ­»é”ï¼šå¾ˆå¯èƒ½ä¸¤ä¸ªæˆ–å¤šä¸ªç¨‹åºç›¸äº’æŒ‚èµ·ç­‰å¾…ã€‚ï¼ˆå•è¿›ç¨‹ web åº”ç”¨ä¸­ç›¸äº’è°ƒç”¨ï¼‰\n\nè§£å†³è¿™äº›é—®é¢˜éœ€è¦ä¸€ç§ç³»ç»Ÿçº§çš„æ–¹æ³•ç›‘æ§å¤„ç†å™¨ä¸­ä¸åŒç¨‹åºçš„æ‰§è¡Œã€‚è¿›ç¨‹çš„æ¦‚å¿µä¸ºæ­¤æä¾›äº†åŸºç¡€ã€‚è¿›ç¨‹å¯ä»¥çœ‹åšæ˜¯ç”±3éƒ¨åˆ†ç»„æˆçš„ï¼š\n\n* ä¸€æ®µå¯æ‰§è¡Œçš„ç¨‹åº\n* ç¨‹åºæ‰€éœ€çš„ç›¸å…³æ•°æ®ï¼ˆå˜é‡ã€å·¥ä½œç©ºé—´ã€ç¼“å†²åŒºï¼‰\n* ç¨‹åºçš„æ‰§è¡Œä¸Šä¸‹æ–‡\n\næœ€åä¸€éƒ¨åˆ†æ˜¯æ ¹æœ¬ã€‚æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆexecution contextï¼‰åˆç§°åšè¿›ç¨‹çŠ¶æ€ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥ç®¡ç†å’Œæ§åˆ¶è¿›ç¨‹æ‰€éœ€çš„å†…éƒ¨æ•°æ®ã€‚\n\n> è¿™ç§å†…éƒ¨ä¿¡æ¯å’Œè¿›ç¨‹æ˜¯åˆ†å¼€çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¿¡æ¯ä¸å…è®¸è¢«è¿›ç¨‹ä¹‹é—´è®¿é—®ã€‚\n\nä¸Šä¸‹æ–‡åŒ…æ‹¬æ“ä½œç³»ç»Ÿç®¡ç†è¿›ç¨‹ä»¥åŠå¤„ç†å™¨æ­£ç¡®æ‰§è¡Œè¿›ç¨‹æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚åŒ…æ‹¬äº†å„ç§å¤„ç†å™¨å¯„å­˜å™¨çš„å†…å®¹ï¼Œæ±ç¨‹åºè®¡æ•°å™¨å’Œæ•°æ®å¯„å­˜å™¨ã€‚å®ƒè¿˜åŒ…æ‹¬æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹ä¼˜å…ˆçº§ä»¥åŠè¿›ç¨‹æ˜¯å¦åœ¨ç­‰å¾…ç‰¹å®š I/O äº‹ä»¶çš„å®Œæˆã€‚\n\næ“ä½œç³»ç»Ÿä¼šç»™æ¯ä¸ªè¿›ç¨‹ï¼ˆåŒ…å«ç¨‹åºã€æ•°æ®å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼‰åˆ†é…ä¸€å—å­˜å‚¨å™¨åŒºåŸŸï¼Œå¹¶åœ¨ç”±æ“ä½œç³»ç»Ÿå»ºç«‹å’Œç»´æŠ¤çš„è¿›ç¨‹è¡¨ä¸­è¿›è¡Œè®°å½•ã€‚è¿›ç¨‹è¡¨åŒ…å«è®°å½•æ¯ä¸ªè¿›ç¨‹çš„è¡¨é¡¹ï¼Œè¡¨é¡¹å†…å®¹åŒ…æ‹¬æŒ‡å‘åŒ…å«è¿›ç¨‹çš„å­˜å‚¨å—åœ°å€çš„æŒ‡é’ˆï¼Œè¿˜åŒ…æ‹¬è¯¥è¿›ç¨‹çš„éƒ¨åˆ†æˆ–å…¨éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚\n\n* è¿›ç¨‹ç´¢å¼•å¯„å­˜å™¨åŒ…å«å½“å‰æ­£åœ¨æ§åˆ¶å¤„ç†å™¨çš„è¿›ç¨‹åœ¨è¿›ç¨‹è¡¨ä¸­çš„ç´¢å¼•ã€‚\n* ç¨‹åºè®¡æ•°å™¨æŒ‡å‘è¯¥è¿›ç¨‹ä¸­ä¸‹ä¸€æ¡å¾…æ‰§è¡Œçš„æŒ‡ä»¤ã€‚\n* åŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨å®šä¹‰äº†è¯¥è¿›ç¨‹æ‰€å çš„å­˜å‚¨å™¨åŒºåŸŸï¼šåŸºå€å¯„å­˜å™¨ä¸­ä¿å­˜äº†è¯¥å­˜å‚¨åŒºåŸŸçš„å¼€å§‹åœ°å€ï¼Œç•Œé™å¯„å­˜å™¨ä¸­ä¿å­˜äº†è¯¥åŒºåŸŸçš„å¤§å°ã€‚\n\n> ç¨‹åºè®¡æ•°å™¨å’Œæ‰€æœ‰çš„æ•°æ®å¼•ç”¨ç›¸å¯¹äºåŸºå€å¯„å­˜å™¨è¢«è§£é‡Šï¼Œå¹¶ä¸”ä¸èƒ½è¶…è¿‡ç•Œé™å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œè¿™å°±å¯ä»¥ä¿æŠ¤å†…éƒ¨è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å¹²æ¶‰ã€‚\n\nä¸‹å›¾æ˜¯ä¸€ç§è¿›ç¨‹ç®¡ç†çš„æ–¹æ³•ï¼š\n\n![å…¸å‹çš„è¿›ç¨‹å®ç°æ–¹æ³•](<http://media.gusibi.mobi/v4Sj3T22rYA1gqBWodb7F0cYZf2tf4tt7ISgv4sNnSjEw_j2vw1D6l01uvE-TKOG>)\n\nåœ¨ä¸Šå›¾ä¸­ï¼Œè¿›ç¨‹ç´¢å¼•å¯„å­˜å™¨è¡¨æ˜è¿›ç¨‹ B æ­£åœ¨æ‰§è¡Œã€‚ä»¥å‰æ‰§è¡Œçš„è¿›ç¨‹è¢«ä¸´æ—¶ä¸­æ–­ï¼Œåœ¨ A ä¸­æ–­çš„åŒæ—¶ï¼Œæ‰€æœ‰å¯„å­˜å™¨çš„å†…å®¹è¢«è®°å½•åœ¨å®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œä»¥åæ“ä½œç³»ç»Ÿå°±å¯ä»¥æ‰§è¡Œè¿›ç¨‹åˆ‡æ¢ï¼Œæ¢å¤è¿›ç¨‹ A çš„æ‰§è¡Œã€‚è¿›ç¨‹åˆ‡æ¢è¿‡ç¨‹åŒ…æ‹¬ä¿å­˜ B çš„ä¸Šä¸‹æ–‡å’Œæ¢å¤ A çš„ä¸Šä¸‹æ–‡ã€‚å½“åœ¨ç¨‹åºè®¡æ•°å™¨ä¸­è½½å…¥æŒ‡å‘ A çš„ç¨‹åºåŒºåŸŸçš„å€¼æ—¶ï¼Œè¿›ç¨‹ A è‡ªåŠ¨æ¢å¤æ‰§è¡Œã€‚\n\n> è¿›ç¨‹æ˜¯è¢«å½“åšæ•°æ®ç»“æ„æ¥å®ç°çš„ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ˜¯æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ˜¯ç­‰å¾…æ‰§è¡Œã€‚ä»»ä½•æ—¶å€™æ•´ä¸ªè¿›ç¨‹çŠ¶æ€éƒ½åŒ…å«åœ¨å®ƒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ã€‚\n\nè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»äº†æ“ä½œç³»ç»Ÿçš„å‘å±•ï¼Œä¸‹ç¯‡ä¸»è¦ä»‹ç»è¿›ç¨‹çš„æ¦‚å¿µä»¥åŠå·¥ä½œåŸç†ã€‚\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\næƒ³äº†è§£ä»¥ä¸‹å†…å®¹å¯ä»¥åœ¨å…¬å·è¾“å…¥ç›¸åº”å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š `å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n| å…³æ³¨ |èµèµ |\n|---|---|\n|![](http://media.gusibi.mobi/kel2L88yf9YXZYecLIn0LPZPSXc7zJfHyGUz5biWsZrGh7xF2JONZT93dgClGdMn)|![](http://media.gusibi.mobi/VFjjmZ7cgkIkpieAFHYXcLVBB8f9snm2vAzc0GyLjSmCzok8mL3vqLNMzYVvrDha)|\n\n",
      "data": {
        "title": "æ“ä½œç³»ç»Ÿå‘å±•å’Œè¿›ç¨‹ç®€ä»‹",
        "date": "2018-03-07 15:25:53",
        "tags": [
          "è¿›ç¨‹",
          "å¹¶å‘",
          "è¯»ä¹¦ç¬”è®°",
          "åç«¯"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "system-process-1"
    },
    {
      "content": "\n\n### å‘½ä»¤æ¨¡å¼\n\n\n> `é¢˜ç›®ï¼š` ç°åœ¨è¦åšä¸€ä¸ªæ™ºèƒ½å®¶å±…æ§åˆ¶é¥æ§å™¨ï¼ŒåŠŸèƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![æ™ºèƒ½å®¶å±…é¥æ§å™¨](<http://media.gusibi.mobi/UPqlqNDZ-vRoQN65O3JhR8egeJyz2zIVfbPRV7V47ZhMsWp0aT6awTJoplv_XQbw>)\n\n\n> ä¸‹å›¾æ˜¯å®¶ç”µå‚å•†æä¾›çš„ç±»ï¼Œæ¥å£å„æœ‰å·®å¼‚ï¼Œå¹¶ä¸”ä»¥åè¿™ç§ç±»å¯èƒ½ä¼šè¶Šæ¥è¶Šå¤šã€‚\n\n![å®¶ç”µå‚å•†ç±»](<http://media.gusibi.mobi/vcUsidbuki8NvnE6GIQ4V-UtyVMw5I3B1C3GkIceIETTGiMuYdTYnD2NSFaJOzTn>)\n\n\n\nè§‚å¯Ÿå‚å•†æä¾›çš„ç±»ï¼Œä½ ä¼šå‘ç°ï¼Œå¥½å¤šç±»æä¾›äº† on()ã€off() æ–¹æ³•ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–¹æ³•åƒ dim()ã€setTemperature()ã€setVolumn()ã€setDirection()ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œä¹‹åè¿˜ä¼šæœ‰æ›´å¤šçš„å‚å•†ç±»ï¼Œæ¯ä¸ªç±»è¿˜ä¼šæœ‰å„å¼å„æ ·çš„æ–¹æ³•ã€‚\n\nå¦‚æœæˆ‘ä»¬æŠŠè¿™äº›ç±»éƒ½ç”¨åˆ°é¥æ§å™¨ä»£ç ä¸­ï¼Œä»£ç å°±ä¼šå¤šä¸€å¤§å †çš„ if è¯­å¥ï¼Œä¾‹å¦‚ \n\n```python\nif slot1 == Light:\n    light.on()\nelif slot1 == Hottub:\n    hottob.jetsOn()\n```\n\nå¹¶ä¸”æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ¯æ¬¡æœ‰æ–°çš„å‚å•†ç±»åŠ è¿›æ¥ï¼Œé¥æ§å™¨çš„ä»£ç éƒ½è¦åšç›¸åº”çš„æ”¹åŠ¨ã€‚\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦æŠŠ`åŠ¨ä½œçš„è¯·æ±‚è€…ï¼ˆé¥æ§å™¨ï¼‰`ä»`åŠ¨ä½œçš„æ‰§è¡Œè€…ï¼ˆå‚å•†ç±»ï¼‰`å¯¹è±¡ä¸­è§£è€¦ã€‚\n\n\n\n>  å¦‚ä½•å®ç°è§£è€¦å‘¢ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨`å‘½ä»¤å¯¹è±¡`ã€‚åˆ©ç”¨å‘½ä»¤å¯¹è±¡ï¼ŒæŠŠè¯·æ±‚ï¼ˆæ¯”å¦‚æ‰“å¼€ç”µç¯ï¼‰å°è£…æˆä¸€ä¸ªç‰¹å®šå¯¹è±¡ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯¹æ¯ä¸ªæŒ‰é’®éƒ½å­˜å‚¨ä¸€ä¸ªå‘½ä»¤å¯¹è±¡ï¼Œé‚£ä¹ˆå½“æŒ‰é’®æŒ‰ä¸‹çš„æ—¶å€™ï¼Œå°±å¯ä»¥è¯·æ±‚å‘½ä»¤å¯¹è±¡åšç›¸å…³çš„å·¥ä½œã€‚æ­¤æ—¶ï¼Œé¥æ§å™¨å¹¶ä¸éœ€è¦çŸ¥é“å·¥ä½œçš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œåªè¦æœ‰ä¸ªå‘½ä»¤å¯¹è±¡èƒ½å’Œæ­£ç¡®çš„å¯¹è±¡æ²Ÿé€šï¼ŒæŠŠäº‹æƒ…åšå¥½å°±å¯ä»¥äº†ã€‚\n\n\n\nä¸‹é¢æˆ‘ä»¬æ‹¿é¤å…ç‚¹é¤çš„æ“ä½œæ¥ä»‹ç»ä¸‹å‘½ä»¤æ¨¡å¼ã€‚\n\n\n\né¤å…é€šå¸¸æ˜¯è¿™æ ·å·¥ä½œçš„ï¼š\n\n1. é¡¾å®¢ç‚¹é¤ï¼ŒæŠŠè®¢å•äº¤ç»™æœåŠ¡å‘˜\n2. æœåŠ¡å‘˜æ‹¿äº†è®¢å•ï¼ŒæŠŠè®¢å•äº¤ç»™å¨å¸ˆã€‚\n3. å¨å¸ˆæ‹¿åˆ°è®¢å•åæ ¹æ®è®¢å•å‡†å¤‡é¤ç‚¹ã€‚\n\n![](<http://media.gusibi.mobi/yzFfIqvBPf9WmHIashy3smiDYBsJbsr-pT5d7I9JnFVoLLron_ZVyXhot3-VufIT>)\n\nè¿™é‡Œæˆ‘ä»¬æŠŠè®¢å•æƒ³è±¡æˆä¸€ä¸ªç”¨æ¥è¯·æ±‚å‡†å¤‡é¤ç‚¹çš„å¯¹è±¡ï¼Œ\n\n* å’Œä¸€èˆ¬å¯¹è±¡ä¸€æ ·ï¼Œè®¢å•å¯¹è±¡å¯ä»¥è¢«ä¼ é€’ï¼šä»æœåŠ¡å‘˜ä¼ é€’åˆ°è®¢å•æŸœå°ï¼Œè®¢å•çš„æ¥å£åªåŒ…å«ä¸€ä¸ªæ–¹æ³• orderUp()ã€‚è¿™ä¸ªæ–¹æ³•å°è£…äº†å‡†å¤‡é¤ç‚¹æ‰€éœ€çš„åŠ¨ä½œã€‚\n* æœåŠ¡å‘˜çš„å·¥ä½œå°±æ˜¯æ¥å—è®¢å•ï¼Œç„¶åè°ƒç”¨è®¢å•çš„ orderUp() æ–¹æ³•ï¼Œå¥¹ä¸éœ€è¦çŸ¥é“è®¢å•å†…å®¹æ˜¯ä»€ä¹ˆã€‚\n* å¨å¸ˆæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»–çŸ¥é“å¦‚ä½•å‡†å¤‡å‡†å¤‡é¤ç‚¹ï¼Œæ˜¯ä»»åŠ¡çœŸæ­£çš„æ‰§è¡Œè€…ã€‚\n\n\n\n> å¦‚æœæˆ‘ä»¬æŠŠé¤å…æƒ³è±¡æˆOO è®¾è®¡æ¨¡å¼çš„ä¸€ç§æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹å…è®¸å°†â€å‘å‡ºè¯·æ±‚çš„å¯¹è±¡â€œå’Œâ€æ¥å—ä¸æ‰§è¡Œè¿™äº›è¯·æ±‚çš„å¯¹è±¡â€œåˆ†éš”å¼€æ¥ã€‚æ¯”å¦‚å¯¹äºé¥æ§å™¨ APIï¼Œæˆ‘ä»¬è¦åˆ†éš”å¼€â€å‘å‡ºè¯·æ±‚çš„æŒ‰é’®ä»£ç â€œå’Œâ€æ‰§è¡Œè¯·æ±‚çš„å‚å•†ç‰¹å®šå¯¹è±¡â€ã€‚\n\n\n\n`å›åˆ°å‘½ä»¤æ¨¡å¼`æˆ‘ä»¬æŠŠé¤å…çš„å·¥ä½œæµç¨‹å›¾è½¬æ¢ä¸ºå‘½ä»¤æ¨¡å¼çš„æµç¨‹å›¾ï¼šè¿™é‡Œ client å¯¹åº”ä¸Šä¸€å¼ å›¾çš„é¡¾å®¢ï¼Œcommand å¯¹åº”è®¢å•ï¼ŒInvoker å¯¹åº”æœåŠ¡å‘˜ï¼ŒReceiver å¯¹åº”çš„æ˜¯å¨å¸ˆã€‚\n\n\n\n![](http://media.gusibi.mobi/xnRDNC6NqVbMnXzD66vzgCAICcb3tKcXDGyBDxZuERwAwI0TnUQACv6MhFEezDAO)\n\n\n\n\n\n## å‘½ä»¤æ¨¡å¼\n\n\n\nå…ˆæ¥çœ‹ä¸‹å‘½ä»¤æ¨¡å¼çš„å®šä¹‰ï¼š\n\n> `å‘½ä»¤æ¨¡å¼`å°†â€è¯·æ±‚â€œå°è£…æˆå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è¯·æ±‚ã€é˜Ÿåˆ—æˆ–è€…æ—¥å¿—æ¥å‚æ•°åŒ–å…¶ä»–å¯¹è±¡ã€‚å‘½ä»¤æ¨¡å¼ä¹Ÿæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚\n\né€šè¿‡ä¸Šè¾¹çš„å®šä¹‰æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå‘½ä»¤å¯¹è±¡é€šè¿‡åœ¨ç‰¹å®šæ¥æ”¶è€…ä¸Šç»‘å®šä¸€ç»„åŠ¨ä½œæ¥å°è£…ä¸€ä¸ªè¯·æ±‚ã€‚è¦è¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œå‘½ä»¤å¯¹è±¡å°†åŠ¨ä½œå’Œæ¥æ”¶è€…åŒ…è¿›å¯¹è±¡ä¸­ã€‚è¿™ä¸ªå¯¹è±¡åªæš´éœ²ä¸€ä¸ª execute() æ–¹æ³•ï¼Œå½“æ­¤æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ¥æ”¶è€…å°±ä¼šè¿›è¡Œè¿™äº›åŠ¨ä½œã€‚\n\nå‘½ä»¤æ¨¡å¼ç±»å›¾å¦‚ä¸‹ï¼š\n\n![å‘½ä»¤æ¨¡å¼ç±»å›¾](<http://media.gusibi.mobi/BehmMRbLQ_w7RbvRD7q0DIu78jUvQ07v9zSVqFp79D8COVe6VL2UxtZjgw_C10fr>)\n\n\n\n> å›åˆ°é¥æ§å™¨çš„è®¾è®¡ï¼šæˆ‘ä»¬æ‰“ç®—å°†é¥æ§å™¨çš„æ¯ä¸ªæ’æ§½ï¼Œå¯¹åº”åˆ°ä¸€ä¸ªå‘½ä»¤ï¼Œè¿™æ ·å°±è®©é¥æ§å™¨å˜æˆäº†`è°ƒç”¨è€…`ã€‚å½“æŒ‰ä¸‹æŒ‰é’®ï¼Œç›¸åº”å‘½ä»¤å¯¹è±¡çš„ execute() æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œå…¶ç»“æœå°±æ˜¯æ¥æ”¶è€…(ä¾‹å¦‚ï¼šç”µç¯ã€é£æ‰‡ã€éŸ³å“)çš„åŠ¨ä½œè¢«è°ƒç”¨ã€‚\n\n\n\n![](<http://media.gusibi.mobi/ddLNmiEJXUuiKe7rChshd-mPX-ycVAJGYFw3MLv8M24D_A0pOSGfDwBWPxK5ZMgT>)\n\n\n\nå‘½ä»¤æ¨¡å¼è¿˜æ”¯æŒæ’¤é”€ï¼Œè¯¥å‘½ä»¤æä¾›å’Œ execute() æ–¹æ³•ç›¸åçš„ undo() æ–¹æ³•ã€‚ä¸ç®¡ execute() åšäº†ä»€ä¹ˆï¼Œundo() éƒ½ä¼šå€’è½¬è¿‡æ¥ã€‚\n\n\n\n## ä»£ç å®ç°\n\n\n\n### é¥æ§å™¨çš„å®ç°\n\n\n\n```python\nclass RemoteControl(object):\n\n    def __init__(self):\n        # é¥æ§å™¨è¦å¤„ç†7ä¸ªå¼€ä¸å…³çš„å‘½ä»¤\n        self.on_commands = [NoCommand() for i in range(7)] \n        self.off_commands = [NoCommand() for i in range(7)]\n        self.undo_command = None  # å°†å‰ä¸€ä¸ªå‘½ä»¤è®°å½•åœ¨è¿™é‡Œ\n\n    def set_command(self, slot, on_command, off_command):\n        # é¢„å…ˆç»™æ¯ä¸ªæ’æ§½è®¾ç½®ä¸€ä¸ªç©ºå‘½ä»¤çš„å‘½ä»¤\n        # set_command å‘½ä»¤å¿…é¡»è¦æœ‰ä¸‰ä¸ªå‚æ•°(æ’æ§½çš„ä½ç½®ã€å¼€çš„å‘½ä»¤ã€å…³çš„å‘½ä»¤)\n        self.on_commands[slot] = on_command\n        self.off_commands[slot] = off_command\n\n    def on_button_was_pressed(self, slot):\n        command = self.on_commands[slot]\n        command.execute()\n        self.undo_command = command\n        \n    # å½“æŒ‰ä¸‹å¼€æˆ–å…³çš„æŒ‰é’®ï¼Œç¡¬ä»¶å°±ä¼šè´Ÿè´£è°ƒç”¨å¯¹åº”çš„æ–¹æ³•\n    def off_button_was_pressed(self, slot):\n        command = self.off_commands[slot]\n        command.execute()\n        self.undo_command = command\n\n    def undo_button_was_pressed(self):\n        self.undo_command.undo()\n\n    def __str__(self):\n        # è¿™é‡Œè´Ÿè´£æ‰“å°æ¯ä¸ªæ’æ§½å’Œå®ƒå¯¹åº”çš„å‘½ä»¤\n        for i in range(7):\n            print('[slot %d] %s %s' % (i,\n                                       self.on_commands[i].__class__.__name__,\n                                       self.off_commands[i].__class__.__name__))\n        return ''\n\n```\n\n\n\n### å‘½ä»¤çš„å®ç°\n\n\n\nè¿™é‡Œå®ç°ä¸€ä¸ªåŸºç±»ï¼Œè¿™ä¸ªåŸºç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œexecute å’Œ undoï¼Œå‘½ä»¤å°è£…äº†æŸä¸ªç‰¹å®šå‚å•†ç±»çš„ä¸€ç»„åŠ¨ä½œï¼Œé¥æ§å™¨å¯ä»¥é€šè¿‡è°ƒç”¨ execute() æ–¹æ³•ï¼Œæ‰§è¡Œè¿™äº›åŠ¨ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ undo() æ–¹æ³•æ’¤é”€è¿™äº›åŠ¨ä½œï¼š\n\n```python\nclass Command(object):\n\n    def execute(self):\n        # æ¯ä¸ªéœ€è¦å­ç±»å®ç°çš„æ–¹æ³•éƒ½ä¼šæŠ›å‡ºNotImplementedError\n        # è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªç±»å°±æ˜¯çœŸæ­£çš„æŠ½è±¡åŸºç±»\n        raise NotImplementedError()\n\n    def undo(self):\n        raise NotImplementedError()\n\n\n# åœ¨é¥æ§å™¨ä¸­ï¼Œæˆ‘ä»¬ä¸æƒ³æ¯æ¬¡éƒ½æ£€æŸ¥æ˜¯å¦æŸä¸ªæ’æ§½éƒ½åŠ è½½äº†å‘½ä»¤ï¼Œ\n# æ‰€ä»¥æˆ‘ä»¬ç»™æ¯ä¸ªæ’æ§½é¢„å…ˆè®¾å®šä¸€ä¸ªNoCommand å¯¹è±¡\n# æ‰€ä»¥æ²¡æœ‰è¢«æ˜ç¡®æŒ‡å®šå‘½ä»¤çš„æ’æ§½ï¼Œå…¶å‘½ä»¤å°†æ˜¯é»˜è®¤çš„ NoCommand å¯¹è±¡\nclass NoCommand(Command):\n\n    def execute(self):\n        print('Command Not Found')\n\n    def undo(self):\n        print('Command Not Found')\n```\n\n\n\nä»¥ä¸‹æ˜¯ç”µç¯ç±»ï¼Œåˆ©ç”¨ Command åŸºç±»ï¼Œæ¯ä¸ªåŠ¨ä½œéƒ½è¢«å®ç°æˆä¸€ä¸ªç®€å•çš„å‘½ä»¤å¯¹è±¡ã€‚å‘½ä»¤å¯¹è±¡æŒæœ‰å¯¹ä¸€ä¸ªå‚å•†ç±»çš„å®ä¾‹çš„å¼•ç”¨ï¼Œå¹¶å®ç°äº†ä¸€ä¸ª execute()ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨å‚å•†ç±»å®ç°çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œå®Œæˆç‰¹å®šçš„è¡Œä¸ºï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ä¸¤ä¸ªç±»ï¼Œåˆ†åˆ«æ‰“å¼€ç”µç¯ä¸å…³é—­ç”µç¯ã€‚\n\n```python\nclass Light(object):\n\n    def __init__(self, name):\n        # å› ä¸ºç”µç¯åŒ…æ‹¬ living room light å’Œ kitchen light\n        self.name = name\n\n    def on(self):\n        print('%s Light is On' % self.name)\n\n    def off(self):\n        print('%s Light is Off' % self.name)\n\n\n# ç”µç¯æ‰“å¼€çš„å¼€å…³ç±»\nclass LightOnCommand(Command):\n\n    def __init__(self, light):\n        self.light = light\n\n    def execute(self):\n        self.light.on()\n\n    def undo(self):\n        # undo æ˜¯å…³é—­ç”µç¯\n        self.light.off()\n\n        \nclass LightOffCommand(Command):\n\n    def __init__(self, light):\n        self.light = light\n\n    def execute(self):\n        self.light.off()\n\n    def undo(self):\n        self.light.on()\n```\n\n\n\næ‰§è¡Œä»£ç ï¼Œè¿™é‡Œåˆ›å»ºå¤šä¸ªå‘½ä»¤å¯¹è±¡ï¼Œç„¶åå°†å…¶åŠ è½½åˆ°é¥æ§å™¨çš„æ’æ§½ä¸­ã€‚æ¯ä¸ªå‘½ä»¤å¯¹è±¡éƒ½å°è£…äº†æŸä¸ªå®¶ç”µè‡ªåŠ¨åŒ–çš„ä¸€é¡¹è¯·æ±‚ï¼š\n\n```python\ndef remote_control_test():\n    remote = RemoteControl()\n\n    living_room_light = Light('Living Room')\n    kitchen_light = Light('Kitchen')\n\n    living_room_light_on = LightOnCommand(living_room_light)\n    living_room_light_off = LightOffCommand(living_room_light)\n    kitchen_light_on = LightOnCommand(kitchen_light)\n    kitchen_light_off = LightOffCommand(kitchen_light)\n\n    remote.set_command(0, living_room_light_on, living_room_light_off)\n    remote.set_command(1, kitchen_light_on, kitchen_light_off)\n\n    print(remote)\n\n    remote.on_button_was_pressed(0)\n    remote.off_button_was_pressed(0)\n    remote.undo_button_was_pressed()\n    remote.on_button_was_pressed(1)\n    remote.off_button_was_pressed(1)\n    remote.undo_button_was_pressed()\n```\n\næ‰§è¡Œåè¾“å‡ºä¸ºï¼š\n\n```bash\n[slot 0] LightOnCommand LightOffCommand\n[slot 1] LightOnCommand LightOffCommand\n[slot 2] NoCommand NoCommand\n[slot 3] NoCommand NoCommand\n[slot 4] NoCommand NoCommand\n[slot 5] NoCommand NoCommand\n[slot 6] NoCommand NoCommand\n\nLiving Room Light is On\nLiving Room Light is Off\nLiving Room Light is On\nKitchen Light is On\nKitchen Light is Off\nKitchen Light is On\n```\n\n\n\n## é›†åˆå¤šä¸ªå‘½ä»¤\n\n\n\né€šå¸¸ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›èƒ½æœ‰ä¸€ä¸ªå¼€å…³ä¸€é”®æ‰“å¼€æ‰€æœ‰çš„ç¯ï¼Œç„¶åä¹Ÿå¯ä»¥ä¸€é”®å…³é—­æ‰€æœ‰çš„ç¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `MacroCommand`:\n\n\n\n```python\nclass MacroCommand(Command):\n\n    def __init__(self, commands):\n        # é¦–å…ˆåˆ›å»ºä¸€ä¸ª commands çš„ listï¼Œè¿™é‡Œå¯ä»¥å­˜æ”¾å¤šä¸ªå‘½ä»¤\n        self.commands = commands\n\n    def execute(self):\n        # æ‰§è¡Œæ—¶ï¼Œä¾æ¬¡æ‰§è¡Œå¤šä¸ªå¼€å…³\n        for command in self.commands:\n            command.execute()\n\n    def undo(self):\n        # æ’¤é”€æ—¶ï¼Œç»™æ‰€æœ‰å‘½ä»¤æ‰§è¡Œ undo æ“ä½œ\n        for command in self.commands:\n            command.undo()\n```\n\n\n\næµ‹è¯•å¼€å…³é›†åˆï¼š\n\n\n\n```python\ndef remote_control_test():\n    remote = RemoteControl()\n    \n    living_room_light = Light('Living Room')\n    kitchen_light = Light('Kitchen')\n    garage_door = GarageDoor()\n\n    living_room_light_on = LightOnCommand(living_room_light)\n    living_room_light_off = LightOffCommand(living_room_light)\n    kitchen_light_on = LightOnCommand(kitchen_light)\n    kitchen_light_off = LightOffCommand(kitchen_light)\n\n    garage_door_open = GarageDoorOpenCommand(garage_door)\n    garage_door_close = GarageDoorCloseCommand(garage_door)\n    \n    # æµ‹è¯•å¼€å…³é›†åˆ\n    party_on_macro = MacroCommand([living_room_light_on, kitchen_light_on])\n    party_off_macro = MacroCommand([living_room_light_off, kitchen_light_off])\n    remote.set_command(3, party_on_macro, party_off_macro)\n    print('--pushing macro on--')\n    remote.on_button_was_pressed(3)\n    print('--pushing macro off--')\n    remote.off_button_was_pressed(3)\n    print('--push macro undo--')\n    remote.undo_button_was_pressed()\n```\n\n\n\nå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥è®°å½•å‘½ä»¤çš„è®°å½•ï¼Œå®ç°å¤šå±‚æ¬¡çš„æ’¤é”€æ“ä½œã€‚\n\n\n\n## å‘½ä»¤æ¨¡å¼çš„ç”¨é€”\n\n\n\n### 1. é˜Ÿåˆ—è¯·æ±‚\n\nå‘½ä»¤å¯ä»¥å°†è¿ç®—å—æ‰“åŒ…ï¼ˆä¸€ä¸ªæ¥æ”¶è€…å’Œä¸€ç»„åŠ¨ä½œï¼‰ï¼Œç„¶åå°†å®ƒä¼ æ¥ä¼ å»ï¼Œå°±åƒæ˜¯ä¸€èˆ¬çš„å¯¹è±¡ä¸€æ ·ã€‚å³ä½¿åœ¨å‘½ä»¤å¯¹è±¡è¢«åˆ›å»ºè®¸ä¹…ä»¥åï¼Œè¿ç®—ä¾ç„¶å¯ä»¥è¢«è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›ç‰¹æ€§è¡ç”Ÿä¸€äº›åº”ç”¨ï¼Œä¾‹å¦‚ï¼šæ—¥ç¨‹å®‰æ’ã€çº¿ç¨‹æ± ã€å·¥ä½œé˜Ÿåˆ—ç­‰ã€‚\n\n> `æƒ³è±¡ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—:`ä½ åœ¨æŸä¸€ç«¯æ·»åŠ å‘½ä»¤ï¼Œç„¶ååœ¨å¦ä¸€ç«¯åˆ™æ˜¯çº¿ç¨‹ã€‚çº¿ç¨‹è¿›è¡Œä¸‹é¢çš„åŠ¨ä½œï¼šä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªå‘½ä»¤ï¼Œè°ƒç”¨å®ƒçš„ execute() æ–¹æ³•ï¼Œç­‰å¾…è¿™ä¸ªè°ƒç”¨å®Œæˆï¼Œç„¶åå°†æ¬¡å‘½ä»¤å¯¹è±¡ä¸¢å¼ƒï¼Œå†å–ä¸‹ä¸€ä¸ªå‘½ä»¤\n\næ­¤æ—¶çš„å·¥ä½œé˜Ÿåˆ—å’Œè®¡ç®—çš„å¯¹è±¡ä¹‹é—´æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œæ­¤åˆ»çº¿ç¨‹å¯èƒ½è¿›è¡Œçš„æ˜¯éŸ³é¢‘è½¬ç ï¼Œä¸‹ä¸€ä¸ªå‘½ä»¤å¯èƒ½å°±å˜æˆäº†ç”¨æˆ·è¯„åˆ†è®¡ç®—ã€‚\n\n\n\n### 2.  æ—¥å¿—è¯·æ±‚\n\n\n\næŸäº›åº”ç”¨éœ€è¦æˆ‘ä»¬å°†æ‰€æœ‰çš„åŠ¨ä½œéƒ½è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œå¹¶èƒ½åœ¨ç³»ç»Ÿæ­»æœºä¹‹åï¼Œé‡æ–°è°ƒç”¨è¿™äº›åŠ¨ä½œæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚é€šè¿‡æ–°å¢ä¸¤ä¸ªæ–¹æ³•ï¼ˆstore()ã€load()ï¼‰ï¼Œå‘½ä»¤æ¨¡å¼èƒ½å¤Ÿæ”¯æŒè¿™ä¸€ç‚¹ã€‚è¿™äº›æ•°æ®æœ€å¥½æ˜¯æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚\n\n\n\n> `è¦æ€ä¹ˆåšå‘¢?` å½“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå°†å†å²è®°å½•å­˜å‚¨åˆ°ç£ç›˜ï¼Œä¸€æ—¦ç³»ç»Ÿæ­»æœºï¼Œæˆ‘ä»¬å°±å°†å‘½ä»¤å¯¹è±¡é‡æ–°åŠ è½½ï¼Œå¹¶æˆæ‰¹çš„ä¾æ¬¡è°ƒç”¨è¿™äº›å¯¹è±¡çš„ execute() æ–¹æ³•ã€‚\n\n\n\næ¯”å¦‚å¯¹äºexcelï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦å®ç°çš„é”™è¯¯æ¢å¤æ–¹å¼æ˜¯å°†ç”µå­è¡¨æ ¼çš„æ“ä½œè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ç”µå­è¡¨æ ¼ä¸€æœ‰å˜åŒ–å°±è®°å½•æ•´ä¸ªç”µå­è¡¨æ ¼ã€‚æ•°æ®åº“çš„äº‹åŠ¡ï¼ˆtransactionï¼‰ä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸ªæŠ€å·§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ•´ç¾¤æ“ä½œå¿…é¡»å…¨éƒ¨è¿›è¡Œå®Œæˆï¼Œæˆ–è€…æ²¡æœ‰ä»»ä½•æ“ä½œã€‚\n\n\n\n## å‚è€ƒé“¾æ¥\n\n[å‘½ä»¤æ¨¡å¼å®Œæ•´ä»£ç -https://gist.github.com/gusibi/e66134218fdecff59e5690298d657c26](https://gist.github.com/gusibi/e66134218fdecff59e5690298d657c26)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-å‘½ä»¤æ¨¡å¼",
        "date": "2018-01-09 15:16:56",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-command"
    },
    {
      "content": "\n>  è¿™ä¸€ç¯‡æ˜¯`ã€Šæµç•…çš„ pythonã€‹`è¯»ä¹¦ç¬”è®°ã€‚ä¸»è¦ä»‹ç»ï¼š\n> * å¸¸è§çš„å­—å…¸æ–¹æ³•\n> * å¦‚ä½•å¤„ç†æŸ¥ä¸åˆ°çš„é”®\n> * æ ‡å‡†åº“ä¸­ dict ç±»å‹çš„å˜ç§\n> * æ•£åˆ—è¡¨çš„å·¥ä½œåŸç†\n\n## æ³›æ˜ å°„ç±»å‹\n\ncollections.abc æ¨¡å—ä¸­æœ‰ Mapping å’Œ MutableMapping è¿™ä¸¤ä¸ªæŠ½è±¡åŸºç±»ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯ä¸º dict å’Œå…¶ä»–ç±»ä¼¼çš„ç±»å‹å®šä¹‰å½¢å¼æ¥å£ã€‚\n\n![](http://media.gusibi.mobi/VP8Xn1-MImX7FFIVi1kyiBms-WIPy5ccIXinstWWn0bL8knd7vbCOK-9RpPwNaQN)\n\næ ‡å‡†åº“é‡Œæ‰€æœ‰æ˜ å°„ç±»å‹éƒ½æ˜¯åˆ©ç”¨ dict æ¥å®ç°çš„ï¼Œå®ƒä»¬æœ‰ä¸ªå…±åŒçš„é™åˆ¶ï¼Œå³åªæœ‰å¯æ•£åˆ—çš„æ•°æ®ç±»å‹æ‰èƒ½ç”¨åšè¿™äº›æ˜ å°„é‡Œçš„é”®ã€‚\n\n> `é—®é¢˜ï¼š` ä»€ä¹ˆæ˜¯å¯æ•£åˆ—çš„æ•°æ®ç±»å‹ï¼Ÿ\n\nåœ¨ python è¯æ±‡è¡¨ï¼ˆ[https://docs.python.org/3/glossary.html#term-hashable](https://docs.python.org/3/glossary.html#term-hashable)ï¼‰ä¸­ï¼Œå…³äºå¯æ•£åˆ—ç±»å‹çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š\n> å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯å¯æ•£åˆ—çš„ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ƒçš„æ•£åˆ—å€¼æ˜¯ä¸å˜çš„ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡éœ€è¦å®ç° `__hash__()` æ–¹æ³•ã€‚å¦å¤–å¯æ•£åˆ—å¯¹è±¡è¿˜è¦æœ‰ `__eq__()` æ–¹æ³•ï¼Œè¿™æ ·æ‰èƒ½è·Ÿå…¶ä»–é”®åšæ¯”è¾ƒã€‚å¦‚æœä¸¤ä¸ªå¯æ•£åˆ—å¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ•£åˆ—åªä¸€å®šæ˜¯ä¸€æ ·çš„\n\næ ¹æ®è¿™ä¸ªå®šä¹‰ï¼ŒåŸå­ä¸å¯å˜ç±»å‹ï¼ˆstrï¼Œbyteså’Œæ•°å€¼ç±»å‹ï¼‰éƒ½æ˜¯å¯æ•£åˆ—ç±»å‹ï¼Œfrozenset ä¹Ÿæ˜¯å¯æ•£åˆ—çš„ï¼ˆå› ä¸ºæ ¹æ®å…¶å®šä¹‰ï¼Œfrozenset é‡Œåªèƒ½å®¹çº³å¯æ•£åˆ—ç±»å‹ï¼‰ï¼Œå¦‚æœå…ƒç»„å†…éƒ½æ˜¯å¯æ•£åˆ—ç±»å‹çš„è¯ï¼Œå…ƒç»„ä¹Ÿæ˜¯å¯æ•£åˆ—çš„ï¼ˆå…ƒç»„è™½ç„¶æ˜¯ä¸å¯å˜ç±»å‹ï¼Œä½†å¦‚æœå®ƒé‡Œé¢çš„å…ƒç´ æ˜¯å¯å˜ç±»å‹ï¼Œè¿™ç§å…ƒç»„ä¹Ÿä¸èƒ½è¢«è®¤ä¸ºæ˜¯ä¸å¯å˜çš„ï¼‰ã€‚\n\n> ä¸€èˆ¬æ¥è®²ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹çš„å¯¹è±¡éƒ½æ˜¯å¯æ•£åˆ—çš„ï¼Œæ•£åˆ—å€¼å°±æ˜¯å®ƒä»¬çš„ id() å‡½æ•°çš„è¿”å›å€¼ï¼Œæ‰€ä»¥è¿™äº›å¯¹è±¡åœ¨æ¯”è¾ƒçš„æ—¶å€™éƒ½æ˜¯ä¸ç›¸ç­‰çš„ã€‚ï¼ˆå¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº† __eq__ æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ–¹æ³•ä¸­ç”¨åˆ°äº†è¿™ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€çš„è¯ï¼Œé‚£ä¹ˆåªæœ‰å½“æ‰€æœ‰è¿™äº›å†…éƒ¨çŠ¶æ€éƒ½æ˜¯ä¸å¯å˜çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå¯¹è±¡æ‰æ˜¯å¯æ•£åˆ—çš„ã€‚ï¼‰\n\næ ¹æ®è¿™äº›å®šä¹‰ï¼Œå­—å…¸æä¾›äº†å¾ˆå¤šç§æ„é€ æ–¹æ³•ï¼Œ[https://docs.python.org/3/library/stdtypes.html#mapping-types-dict](https://docs.python.org/3/library/stdtypes.html#mapping-types-dict) è¿™ä¸ªé¡µé¢æœ‰ä¸ªä¾‹å­æ¥è¯´æ˜åˆ›å»ºå­—å…¸çš„ä¸åŒæ–¹å¼ã€‚\n\n```python\n>>> a = dict(one=1, two=2, three=3)\n>>> b = {'one': 1, 'two': 2, 'three': 3}\n>>> c = dict(zip(['one', 'two', 'three'], [1, 2, 3]))\n>>> d = dict([('two', 2), ('one', 1), ('three', 3)])\n>>> e = dict({'three': 3, 'one': 1, 'two': 2})\n>>> a == b == c == d == e\nTrue\n```\n\né™¤äº†è¿™äº›æ–¹æ³•ä»¥å¤–ï¼Œè¿˜å¯ä»¥ç”¨å­—å…¸æ¨å¯¼çš„æ–¹å¼æ¥å»ºé€ æ–° dictã€‚\n\n### å­—å…¸æ¨å¯¼\n\nè‡ª Python2.7 ä»¥æ¥ï¼Œåˆ—è¡¨æ¨å¯¼å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼çš„æ¦‚å¿µå°±ç§»æ¤åˆ°äº†å­—å…¸ä¸Šï¼Œä»è€Œæœ‰äº†å­—å…¸æ¨å¯¼ã€‚å­—å…¸æ¨å¯¼ï¼ˆdictcompï¼‰å¯ä»¥ä»ä»»ä½•ä»¥é”®å€¼å¯¹ä½œä¸ºå…ƒç´ çš„å¯è¿­ä»£å¯¹è±¡ä¸­æ„å»ºå‡ºå­—å…¸ã€‚\n\næ¯”å¦‚ï¼š\n\n```python\n>>> data = [(1, 'a'), (2, 'b'), (3, 'c')]\n>>> data_dict = {num: letter for num, letter in data}\n>>> data_dict\n{1: 'a', 2: 'b', 3: 'c'}\n```\n\n### å¸¸è§çš„æ˜ å°„æ–¹æ³•\n\nä¸‹è¡¨ä¸ºæˆ‘ä»¬å±•ç¤ºäº† dictã€defaultdict å’Œ OrderedDict çš„å¸¸è§æ–¹æ³•ï¼ˆåä¸¤ç§æ˜¯ dict çš„å˜ç§ï¼Œä½äº collectionsæ¨¡å—å†…ï¼‰ã€‚\n\n![](http://media.gusibi.mobi/Ofx-MtfIphm8ceCJlP3tMi5IwYMuLT8DUem1ANIjR2n2NwYFZ6JFTIJJntdaZFNF)\n\n* default_factory å¹¶ä¸æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒçš„å€¼ defaultdict åˆå§‹åŒ–çš„æ—¶å€™ç”±ç”¨æˆ·è®¾å®šã€‚\n* OrderedDict.popitem() ä¼šç§»é™¤å­—å…¸æœ€å…ˆæ’å…¥çš„å…ƒç´ ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼›å¯é€‰å‚æ•° last å¦‚æœå€¼ä¸ºçœŸï¼Œåˆ™ä¼šç§»é™¤æœ€åæ’å…¥çš„å…ƒç´ ï¼ˆåè¿›å…ˆå‡ºï¼‰ã€‚\n\n* ç”¨ setdefault å¤„ç†æ‰¾ä¸åˆ°çš„é”®\nå½“å­—å…¸ d[k] ä¸èƒ½æ‰¾åˆ°æ­£ç¡®çš„é”®çš„æ—¶å€™ï¼ŒPython ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹³æ—¶æˆ‘ä»¬éƒ½ä½¿ç”¨`d.get(k, default)` æ¥ä»£æ›¿ d[k]ï¼Œç»™æ‰¾ä¸åˆ°çš„é”®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ•ˆç‡æ›´é«˜çš„ `setdefault` \n\n```python\nmy_dict.setdefault(key, []).append(new_value)\n# ç­‰åŒäº\nif key not in my_dict:\n    my_dict[key] = []\nmy_dict[key].append(new_value)\n```\nè¿™ä¸¤æ®µä»£ç çš„æ•ˆæœä¸€æ ·ï¼Œåªä¸è¿‡ï¼Œåè€…è‡³å°‘è¦è¿›è¡Œä¸¤æ¬¡é”®æŸ¥è¯¢ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±æ˜¯ä¸‰æ¬¡ï¼Œè€Œç”¨ `setdefault` åªéœ€ä¸€æ¬¡å°±å¯ä»¥å®Œæˆæ•´ä¸ªæ“ä½œã€‚\n\né‚£ä¹ˆï¼Œæˆ‘ä»¬å–å€¼çš„æ—¶å€™ï¼Œè¯¥å¦‚ä½•å¤„ç†æ‰¾ä¸åˆ°çš„é”®å‘¢ï¼Ÿ\n\n### æ˜ å°„çš„å¼¹æ€§æŸ¥è¯¢\n\n> æœ‰æ—¶å€™ï¼Œå°±ç®—æŸä¸ªé”®åœ¨æ˜ å°„é‡Œä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨é€šè¿‡è¿™ä¸ªé”®è¯»å–å€¼çš„æ—¶å€™èƒ½å¾—åˆ°ä¸€ä¸ªé»˜è®¤å€¼ã€‚æœ‰ä¸¤ä¸ªé€”å¾„èƒ½å¸®æˆ‘ä»¬è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œ`ä¸€ä¸ªæ˜¯é€šè¿‡ defaultdict` è¿™ä¸ªç±»å‹è€Œä¸æ˜¯æ™®é€šçš„ dictï¼Œ`å¦ä¸€ä¸ªæ˜¯ç»™è‡ªå·±å®šä¹‰ä¸€ä¸ª dict` çš„å­ç±»ï¼Œç„¶ååœ¨å­ç±»ä¸­å®ç° `__missing__` æ–¹æ³•ã€‚\n\n#### defaultdictï¼šå¤„ç†æ‰¾ä¸åˆ°çš„é”®çš„ä¸€ä¸ªé€‰æ‹©\n\né¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ defaultdict ï¼š\n\n```python\nimport collections\n\nindex = collections.defaultdict(list)\nindex[new_key].append(new_value)\n```\n\nè¿™é‡Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªå­—å…¸ indexï¼Œå¦‚æœé”® `new_key` åœ¨ index ä¸­ä¸å­˜åœ¨ï¼Œè¡¨è¾¾å¼ `index[new_key]` ä¼šæŒ‰ä»¥ä¸‹æ­¥éª¤æ¥æ“ä½œï¼š\n\n1. è°ƒç”¨ list() æ¥å»ºç«‹ä¸€ä¸ªæ–°çš„åˆ—è¡¨\n2. æŠŠè¿™ä¸ªæ–°åˆ—è¡¨ä½œä¸ºå€¼ï¼Œ'new_key' ä½œä¸ºå®ƒçš„é”®ï¼Œæ”¾å…¥ index ä¸­\n3. è¿”å›è¿™ä¸ªåˆ—è¡¨çš„å¼•ç”¨ã€‚\n\nè€Œè¿™ä¸ªç”¨æ¥ç”Ÿæˆé»˜è®¤å€¼çš„å¯è°ƒç”¨å¯¹è±¡å­˜æ”¾åœ¨åä¸º `default_factory` çš„å®ä¾‹å±æ€§ä¸­ã€‚\n\n> defaultdict ä¸­çš„ default_factory åªä¼šåœ¨ __getitem__ é‡Œè°ƒç”¨ï¼Œåœ¨å…¶ä»–æ–¹æ³•ä¸­ä¸ä¼šå‘ç”Ÿä½œç”¨ã€‚æ¯”å¦‚ index[k] è¿™ä¸ªè¡¨è¾¾å¼ä¼šè°ƒç”¨ default_factory åˆ›é€ çš„æŸä¸ªé»˜è®¤å€¼ï¼Œè€Œ index.get(k) åˆ™ä¼šè¿”å› Noneã€‚ï¼ˆè¿™æ˜¯å› ä¸ºç‰¹æ®Šæ–¹æ³• __missing__ ä¼šåœ¨ defaultdict é‡åˆ°æ‰¾ä¸åˆ°çš„é”®çš„æ—¶å€™è°ƒç”¨ default_factoryï¼Œå®é™…ä¸Šï¼Œè¿™ä¸ªç‰¹æ€§æ‰€æœ‰æ˜ å°„æ–¹æ³•éƒ½å¯ä»¥æ”¯æŒï¼‰ã€‚\n\n#### ç‰¹æ®Šæ–¹æ³• __missing__\n\næ‰€æœ‰æ˜ å°„åœ¨å¤„ç†æ‰¾ä¸åˆ°çš„é”®çš„æ—¶å€™ï¼Œéƒ½ä¼šç‰µæ‰¯åˆ° __missing__ æ–¹æ³•ã€‚ä½†åŸºç±» dict å¹¶æ²¡æœ‰æä¾› è¿™ä¸ªæ–¹æ³•ã€‚ä¸è¿‡ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç±»ç»§æ‰¿äº† dict ï¼Œç„¶åè¿™ä¸ªç»§æ‰¿ç±»æä¾›äº† __missing__ æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨ __getitem__ ç¢°åˆ°æ‰¾ä¸åˆ°é”®çš„æ—¶å€™ï¼ŒPython ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒï¼Œè€Œä¸æ˜¯æŠ›å‡ºä¸€ä¸ª KeyError å¼‚å¸¸ã€‚\n\n> `__missing__` æ–¹æ³•åªä¼šè¢« `__getitem__` è°ƒç”¨ã€‚æä¾› __missing__ æ–¹æ³•å¯¹ get æˆ–è€… __contains__(in è¿ç®—ç¬¦ä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•)è¿™äº›æ–¹æ³•çš„æ˜¯æœ‰æ²¡æœ‰å½±å“ã€‚\n\nä¸‹é¢è¿™æ®µä»£ç å®ç°äº† StrKeyDict0 ç±»ï¼ŒStrKeyDict0 ç±»åœ¨æŸ¥è¯¢çš„æ—¶å€™æŠŠéå­—ç¬¦ä¸²çš„é”®è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚\n\n```python\nclass StrKeyDict0(dict): # ç»§æ‰¿ dict\n    def __missing__(self, key):\n        if isinstance(key, str):\n            # å¦‚æœæ‰¾ä¸åˆ°çš„é”®æœ¬èº«å°±æ˜¯å­—ç¬¦ä¸²ï¼ŒæŠ›å‡º KeyError    \n            raise KeyError(key)\n        # å¦‚æœæ‰¾ä¸åˆ°çš„é”®ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè½¬åŒ–ä¸ºå­—ç¬¦ä¸²å†æ‰¾ä¸€æ¬¡\n        return self[str(key)]\n    def get(self, key, default=None):\n        # get æ–¹æ³•æŠŠæŸ¥æ‰¾å·¥ä½œç”¨ self[key] çš„å½¢å¼å§”æ‰˜ç»™ __getitem__ï¼Œè¿™æ ·åœ¨å®£å¸ƒæŸ¥æ‰¾å¤±è´¥é’±ï¼Œè¿˜èƒ½é€šè¿‡ __missing__ å†ç»™é”®ä¸€ä¸ªæœºä¼š\n        try:\n            return self[key]\n        except KeyError:\n            # å¦‚æœæŠ›å‡º KeyError  è¯´æ˜ __missing__ ä¹Ÿå¤±è´¥äº†ï¼Œäºæ˜¯è¿”å› default    \n            return default\n    def __contains__(self, key):\n        # å…ˆæŒ‰ä¼ å…¥çš„é”®æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰å†æŠŠé”®è½¬ä¸ºå­—ç¬¦ä¸²å†æ‰¾ä¸€æ¬¡\n        return key in self.keys() or str(key) in self.keys()\n```\n\n__contains__ æ–¹æ³•å­˜åœ¨æ˜¯ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œå› ä¸º k in d è¿™ä¸ªæ“ä½œä¼šè°ƒç”¨å®ƒï¼Œä½†æˆ‘ä»¬ä» dict ç»§æ‰¿åˆ°çš„ __contains__ æ–¹æ³•ä¸ä¼šåœ¨æ‰¾ä¸åˆ°é”®çš„æ—¶å€™ç”¨ __missing__ æ–¹æ³•ã€‚\n\n> my_dict.keys() åœ¨ Python3 ä¸­è¿”å›å€¼æ˜¯ä¸€ä¸ª \"è§†å›¾\",\"è§†å›¾\"å°±åƒæ˜¯ä¸€ä¸ªé›†åˆï¼Œè€Œä¸”å’Œå­—å…¸ä¸€æ ·é€Ÿåº¦å¾ˆå¿«ã€‚ä½†åœ¨ Python2ä¸­ï¼Œmy_dict.keys() è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ æ‰€ä»¥ k in my_dict.keys() æ“ä½œåœ¨ python3ä¸­é€Ÿåº¦å¾ˆå¿«ï¼Œä½†åœ¨ python2 ä¸­ï¼Œå¤„ç†æ•ˆç‡å¹¶ä¸é«˜ã€‚\n\n>å¦‚æœè¦è‡ªå®šä¹‰ä¸€ä¸ªæ˜ å°„ç±»å‹ï¼Œåˆé€‚çš„ç­–ç•¥æ˜¯ç»§æ‰¿ `collections.UserDict` ç±»ã€‚è¿™ä¸ªç±»å°±æ˜¯æŠŠæ ‡å‡† dict ç”¨ python åˆå®ç°äº†ä¸€éï¼ŒUserDict æ˜¯è®©ç”¨æˆ·ç»§æ‰¿å†™å­ç±»çš„ï¼Œæ”¹è¿›åçš„ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport collections\n\nclass StrKeyDict(collections.UserDict):\n    \n    def __missing__(self, key):\n        if isinstance(key, str):\n            raise KeyError(key)\n        return self[str(key)]\n        \n    def __contains__(self, key):\n        # è¿™é‡Œå¯ä»¥æ”¾å¿ƒå‡è®¾æ‰€æœ‰å·²ç»å­˜å‚¨çš„é”®éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚å› æ­¤åªè¦åœ¨ self.data ä¸ŠæŸ¥è¯¢å°±å¥½äº†\n        return str(key) in self.data\n        \n    def __setitem__(self, key, item):\n        # è¿™ä¸ªæ–¹æ³•ä¼šæŠŠæ‰€æœ‰çš„é”®éƒ½è½¬åŒ–æˆå­—ç¬¦ä¸²ã€‚\n        self.data[str(key)] = item\n```\n\nå› ä¸º UserDict ç»§æ‰¿çš„æ˜¯ MutableMappingï¼Œæ‰€ä»¥ StrKeyDict é‡Œå‰©ä¸‹çš„é‚£äº›æ˜ å°„ç±»å‹éƒ½æ˜¯ä» UserDictã€MutableMapping å’Œ Mapping è¿™äº›è¶…ç±»ç»§æ‰¿è€Œæ¥çš„ã€‚\n\nMapping ä¸­æä¾›äº† get æ–¹æ³•ï¼Œå’Œæˆ‘ä»¬åœ¨ StrKeyDict0 ä¸­å®šä¹‰çš„ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œä¸éœ€è¦å®šä¹‰ get æ–¹æ³•ã€‚\n\n## å­—å…¸çš„å˜ç§\n\nåœ¨ collections æ¨¡å—ä¸­ï¼Œé™¤äº† defaultdict ä¹‹å¤–è¿˜æœ‰å…¶ä»–çš„æ˜ å°„ç±»å‹ã€‚\n\n* collections.OrderedDict\n* collections.ChainMap\n* collections.Counter\n\n## ä¸å¯å˜çš„æ˜ å°„ç±»å‹\n\n> `é—®é¢˜ï¼š`æ ‡å‡†åº“ä¸­æ‰€æœ‰çš„æ˜ å°„ç±»å‹éƒ½æ˜¯å¯å˜çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªä¸å¯å˜çš„æ˜ å°„ç±»å‹è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ\n\nä» Python3.3 å¼€å§‹ types æ¨¡å—ä¸­å¼•å…¥äº†ä¸€ä¸ªå°è£…ç±»åå« `MappingProxyType`ã€‚å¦‚æœç»™è¿™ä¸ªç±»ä¸€ä¸ªæ˜ å°„ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåªè¯»çš„æ˜ å°„è§†å›¾ï¼ˆå¦‚æœåŸæ˜ å°„åšäº†æ”¹åŠ¨ï¼Œè¿™ä¸ªè§†å›¾çš„ç»“æœé¡µä¼šç›¸åº”çš„æ”¹å˜ï¼‰ã€‚ä¾‹å¦‚\n\n```python\n>>> from types import MappingProxy Type\n>>> d = {1: 'A'}\n>>> d_proxy = MappingProxyType(d)\n>>> d_proxy\nmappingproxy({1: 'A'})\n>>> d_proxy[1]\n'A'\n>>> d_proxy[2] = 'x'\nTraceback(most recent call last):\n    File \"<stdin\", line 1, in <module>\nTypeError: 'MappingProxy' object does not support item assignment\n>>> d[2] = 'B'\n>>> d_proxy[2]  # d_proxy æ˜¯åŠ¨æ€çš„ï¼Œd çš„æ”¹åŠ¨ä¼šåé¦ˆåˆ°å®ƒä¸Šè¾¹\n'B'\n```\n\n## å­—å…¸ä¸­çš„æ•£åˆ—è¡¨\n\næ•£åˆ—è¡¨å…¶å®æ˜¯ä¸€ä¸ªç¨€ç–æ•°ç»„ï¼ˆæ€»æœ‰ç©ºç™½å…ƒç´ çš„æ•°ç»„å«ç¨€ç–æ•°ç»„ï¼‰ï¼Œåœ¨ dict çš„æ•£åˆ—è¡¨ä¸­ï¼Œæ¯ä¸ªé”®å€¼éƒ½å ç”¨ä¸€ä¸ªè¡¨å…ƒï¼Œæ¯ä¸ªè¡¨å…ƒéƒ½æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œ`ä¸€ä¸ªæ˜¯å¯¹é”®çš„å¼•ç”¨ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹å€¼çš„å¼•ç”¨`ã€‚å› ä¸ºæ‰€æœ‰è¡¨å…ƒçš„å¤§å°ä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡`åç§»é‡æ¥è¯»å–æŸä¸ªè¡¨å…ƒ`ã€‚\npython ä¼šè®¾æ³•ä¿è¯å¤§æ¦‚æœ‰1/3 çš„è¡¨å…ƒæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥åœ¨å¿«è¦è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼ŒåŸæœ‰çš„æ•£åˆ—è¡¨ä¼šè¢«å¤åˆ¶åˆ°ä¸€ä¸ªæ›´å¤§çš„ç©ºé—´ã€‚\n\n å¦‚æœè¦æŠŠä¸€ä¸ªå¯¹è±¡æ”¾å…¥æ•£åˆ—è¡¨ï¼Œé‚£ä¹ˆé¦–å…ˆè¦è®¡ç®—è¿™ä¸ªå…ƒç´ çš„æ•£åˆ—å€¼ã€‚\nPythonå†…ç½®çš„ hash() æ–¹æ³•å¯ä»¥ç”¨äºè®¡ç®—æ‰€æœ‰çš„å†…ç½®ç±»å‹å¯¹è±¡ã€‚\n\n> å¦‚æœä¸¤ä¸ªå¯¹è±¡åœ¨æ¯”è¾ƒçš„æ—¶å€™æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ•£åˆ—å€¼ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚ä¾‹å¦‚ 1==1.0 é‚£ä¹ˆï¼Œhash(1) == hash(1.0)\n\n### æ•£åˆ—è¡¨ç®—æ³•\n\nä¸ºäº†è·å– my_dict[search_key] çš„å€¼ï¼ŒPython ä¼šé¦–å…ˆè°ƒç”¨ hash(search_key) æ¥è®¡ç®— search_key çš„æ•£åˆ—å€¼ï¼ŒæŠŠè¿™ä¸ªå€¼çš„æœ€ä½å‡ ä½å½“åšåç§»é‡åœ¨æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾å…ƒã€‚`è‹¥è¡¨å…ƒä¸ºç©ºï¼ŒæŠ›å‡º KeyError å¼‚å¸¸ã€‚è‹¥ä¸ä¸ºç©ºï¼Œåˆ™è¡¨å…ƒä¼šæœ‰ä¸€å¯¹ found_key:found_value`ã€‚\nè¿™æ—¶éœ€è¦æ ¡éªŒ search_key == found_keyï¼Œå¦‚æœç›¸ç­‰ï¼Œè¿”å› found_valueã€‚\nå¦‚æœä¸åŒ¹é…ï¼ˆæ•£åˆ—å†²çªï¼‰ï¼Œå†åœ¨æ•£åˆ—è¡¨ä¸­å†å–å‡ ä½ï¼Œç„¶åå¤„ç†ä¸€ä¸‹ï¼Œç”¨å¤„ç†åçš„ç»“æœå½“åšç´¢å¼•å†æ‰¾è¡¨å…ƒã€‚ ç„¶åé‡å¤ä¸Šé¢çš„æ­¥éª¤ã€‚\n\nå–å€¼æµç¨‹å›¾å¦‚ä¸‹ï¼š\n\n![å­—å…¸å–å€¼æµç¨‹å›¾](http://media.gusibi.mobi/oppfxsnS5Fx_KOpd054J2yer_K_wee7WphoUzDN6z8H_R5rtONXr6x3Bb2J3tcBd)\n\næ·»åŠ æ–°å€¼å’Œä¸Šè¿°çš„æµç¨‹åŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡å¯¹äºå‰è€…ï¼Œåœ¨å‘ç°ç©ºè¡¨å…ƒçš„æ—¶å€™ä¼šæ”¾å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œè€Œå¯¹äºåè€…ï¼Œåœ¨æ‰¾åˆ°ç›¸åº”è¡¨å…ƒåï¼ŒåŸè¡¨é‡Œçš„å€¼å¯¹è±¡ä¼šè¢«æ›¿æ¢æˆæ–°å€¼ã€‚\n\n> å¦å¤–ï¼Œåœ¨æ’å…¥æ–°å€¼æ˜¯ï¼ŒPython å¯èƒ½ä¼šæŒ‰ç…§æ•£åˆ—è¡¨çš„æ‹¥æŒ¤ç¨‹åº¦æ¥å†³å®šæ˜¯å¦é‡æ–°åˆ†é…å†…å­˜ä¸ºå®ƒæ‰©å®¹ï¼Œ`å¦‚æœå¢åŠ äº†æ•£åˆ—è¡¨çš„å¤§å°ï¼Œé‚£æ•£åˆ—å€¼æ‰€å çš„ä½æ•°å’Œç”¨ä½œç´¢å¼•çš„ä½æ•°éƒ½ä¼šéšä¹‹å¢åŠ `\n\n### å­—å…¸çš„ä¼˜åŠ¿å’Œé™åˆ¶\n\n#### 1ã€é”®å¿…é¡»æ˜¯å¯æ•£åˆ—çš„\n\nå¯æ•£åˆ—å¯¹è±¡è¦æ±‚å¦‚ä¸‹ï¼š\n\n* æ”¯æŒ hash å‡½æ•°ï¼Œå¹¶ä¸”é€šè¿‡__hash__() æ–¹æ³•æ‰€å¾—çš„æ•£åˆ—å€¼ä¸å˜\n* æ”¯æŒé€šè¿‡ __eq__() æ–¹æ³•æ£€æµ‹ç›¸ç­‰æ€§\n* è‹¥ a == b ä¸ºçœŸï¼Œ åˆ™ hash(a) == hash(b) ä¹Ÿä¸ºçœŸ\n\n#### 2ã€å­—å…¸å¼€é”€å·¨å¤§\n\nå› ä¸ºå­—å…¸ä½¿ç”¨äº†æ•£åˆ—è¡¨ï¼Œè€Œæ•£åˆ—è¡¨åˆå¿…é¡»æ˜¯ç¨€ç–çš„ï¼Œè¿™å¯¼è‡´å®ƒåœ¨ç©ºé—´ä¸Šæ•ˆç‡ä½ä¸‹ã€‚\n\n#### 3ã€é”®æŸ¥è¯¢å¾ˆå¿«\n\ndict çš„å®ç°æ˜¯å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´ï¼šå­—å…¸ç±»å‹ç”±ç€å·¨å¤§çš„å†…å­˜å¼€é”€ï¼Œä½†æä¾›äº†æ— è§†æ•°æ®é‡å¤§å°çš„å¿«é€Ÿè®¿é—®ã€‚\n\n#### 4ã€é”®çš„æ¬¡åºå†³å®šäºæ·»åŠ é¡ºåº\n\nå½“å¾€ dict é‡Œæ·»åŠ æ–°é”®è€Œåˆå‘ç”Ÿæ•£åˆ—å†²çªæ—¶ï¼Œæ–°å»ºå¯èƒ½ä¼šè¢«å®‰æ’å­˜æ”¾åœ¨å¦ä¸€ä¸ªä½ç½®ã€‚\n\n#### 5ã€å¾€å­—å…¸é‡Œæ·»åŠ æ–°é”®å¯èƒ½ä¼šæ”¹å˜å·²æœ‰é”®çš„é¡ºåº\n\næ— è®ºä½•æ—¶å‘å­—å…¸ä¸­æ·»åŠ æ–°çš„é”®ï¼ŒPython è§£é‡Šå™¨éƒ½å¯èƒ½åšå‡ºä¸ºå­—å…¸æ‰©å®¹çš„å†³å®šã€‚æ‰©å®¹å¯¼è‡´çš„ç»“æœå°±æ˜¯è¦æ–°å»ºä¸€ä¸ªæ›´å¤§çš„æ•£åˆ—è¡¨ï¼Œå¹¶æŠŠåŸæœ‰çš„é”®æ·»åŠ åˆ°æ–°çš„æ•£åˆ—è¡¨ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‘ç”Ÿæ–°çš„æ•£åˆ—å†²çªï¼Œå¯¼è‡´æ–°æ•£åˆ—è¡¨ä¸­æ¬¡åºå‘ç”Ÿå˜åŒ–ã€‚\nå› æ­¤ï¼Œä¸è¦å¯¹å­—å…¸åŒæ—¶è¿›è¡Œè¿­ä»£å’Œä¿®æ”¹ã€‚\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»äº†ï¼š\n* å¸¸è§çš„å­—å…¸æ–¹æ³•\n* å¦‚ä½•å¤„ç†æŸ¥ä¸åˆ°çš„é”®\n* æ ‡å‡†åº“ä¸­ dict ç±»å‹çš„å˜ç§\n* æ•£åˆ—è¡¨çš„å·¥ä½œåŸç†\n* æ•£åˆ—è¡¨å¸¦æ¥çš„æ½œåœ¨å½±å“\n\n## å‚è€ƒé“¾æ¥\n\n* [https://docs.python.org/3/glossary.html#term-hashable](https://docs.python.org/3/glossary.html#term-hashable)\n* [https://docs.python.org/3/library/stdtypes.html#mapping-types-dict](https://docs.python.org/3/library/stdtypes.html#mapping-types-dict)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "Python å­—å…¸",
        "date": "2017-12-03 15:05:27",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-data-structures-dict"
    },
    {
      "content": "\n##\n\n### \n\n## å‚è€ƒé“¾æ¥\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "categories": [
          "xxx",
          "xxxx"
        ],
        "date": "2017-12-03 03:15:38",
        "description": "description",
        "author": "goodspeed",
        "permalink": "/post/url-path",
        "tags": [
          "xx",
          "xxxx"
        ],
        "title": "title",
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-data-structures-set"
    },
    {
      "content": "\n> `é—®é¢˜ï¼š`ç°ä»£åŒ–çš„å·§å…‹åŠ›å·¥å‚å…·å¤‡è®¡ç®—æœºæ§åˆ¶çš„å·§å…‹åŠ›é”…ç‚‰ã€‚é”…ç‚‰åšçš„äº‹æƒ…å°±æ˜¯æŠŠå·§å…‹åŠ›å’Œç‰›å¥¶èåœ¨ä¸€èµ·ï¼Œç„¶åé€åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œä»¥åˆ¶æˆå·§å…‹åŠ›æ£’ã€‚ä¸‹è¾¹æ˜¯ä¸€ä¸ªå·§å…‹åŠ›å…¬å¸é”…ç‚‰æ§åˆ¶å™¨çš„ä»£ç ï¼Œä»”ç»†è§‚å¯Ÿä¸€ä¸‹ï¼Œè¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\n```python\nclass ChocolateBoiler(object):\n\n    def __init__(self):\n        self.empty = True\n        self.boiled = False\n\n    def fill(self):\n        # å‘é”…ç‚‰å¡«å……å·§å…‹åŠ›å’Œç‰›å¥¶æ··åˆç‰©\n        # åœ¨é”…ç‚‰å†…å¡«å……åŸæ–™æ—¶ï¼Œé”…ç‚‰å¿…é¡»æ˜¯ç©ºçš„ã€‚\n        # ä¸€æ—¦å¡«å…¥åŸæ–™ï¼Œå°±è¦æŠŠempty å’Œ boiled æ ‡å¿—è®¾ç½®å¥½\n        if self.empty:\n            self.empty = False\n            self.boiled = False\n\n    def drain(self):\n        # æ’å‡ºç…®æ²¸çš„å·§å…‹åŠ›å’Œç‰›å¥¶\n        # é”…ç‚‰æ’å‡ºæ—¶ï¼Œå¿…é¡»æ˜¯æ»¡çš„ä¸”ç…®æ²¸çš„ã€‚\n        # æ’å‡ºå®Œæ¯•empty è®¾ç½®ä¸º true\n        if not self.empty and self.boiled:\n            self.empty = True\n\n    def boil(self):\n        # å°†é¢…å†…ç‰©ç…®æ²¸\n        # ç…®æ··åˆç‰©æ—¶ï¼Œé”…ç‚‰å†…å¿…é¡»æ˜¯æ»¡çš„ä¸”æ²¡æœ‰ç…®æ²¸è¿‡\n        # ä¸€æ—¦ç…®æ²¸ï¼Œå°±æŠŠ boiled è®¾ç½®ä¸º true\n        if not self.empty and not self.boiled:\n            self.boiled = True\n```\n\nä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œä»–ä»¬åŠ å…¥äº†å¤šç§åˆ¤æ–­ï¼Œä»¥é˜²æ­¢ä¸å¥½çš„äº‹æƒ…å‘ç”Ÿã€‚å¦‚æœåŒæ—¶å­˜åœ¨ä¸¤ä¸ª`ChocolateBoiler`å®ä¾‹ï¼Œé‚£è¿™ä¹ˆå¤šåˆ¤æ–­å²‚ä¸æ˜¯å¤±å»ä½œç”¨äº†ã€‚é‚£æˆ‘ä»¬æ”¹å¦‚ä½•å®ç°è¿™ä¸ªéœ€æ±‚å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯ï¼Œæˆ‘ä»¬è¦å…ˆåˆ¤æ–­å®ä¾‹æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±ä¸å†åˆ›å»ºã€‚\n\n```python\n_chocolate_boiler_instance = None  # å£°æ˜å®ä¾‹\n\ndef chocolate_boiler():\n    global _chocolate_boiler_instance  # ä½¿ç”¨å…¨å±€å˜é‡\n\n    if _chocolate_boiler_instance is not None: # åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›\n        return _chocolate_boiler_instance\n    else:\n        # å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„\n        _chocolate_boiler_instance = ChocolateBoiler()\n        return _chocolate_boiler_instance\n```\n\nç°åœ¨æˆ‘ä»¬éœ€è¦è·å– `ChocolateBoiler` å®ä¾‹çš„æ—¶å€™åªéœ€è¦è°ƒç”¨ chocolate_boiler æ–¹æ³•è·å–å®ä¾‹å³å¯ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ª `ChocolateBoiler`å®ä¾‹ã€‚\n\nè¿™ç§ä¿è¯ `ChocolateBoiler`ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹çš„æ¨¡å¼ï¼Œå°±æ˜¯`å•ä¾‹æ¨¡å¼`ã€‚\n\n## å•ä¾‹æ¨¡å¼\n### å®šä¹‰\n\n> `å•ä¾‹æ¨¡å¼ï¼š`ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚\n\n* ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨å•ä¾‹æ¨¡å¼è¦æŠŠæŸä¸ªç±»è®¾è®¡æˆè‡ªå·±ç®¡ç†çš„ä¸€ä¸ªå•ç‹¬å®ä¾‹ï¼ŒåŒæ—¶ä¹Ÿé¿å…å…¶ä»–ç±»å†è‡ªè¡Œäº§ç”Ÿå®ä¾‹ã€‚å¹¶ä¸”åªå…è®¸é€šè¿‡å•ä¾‹ç±»è·å–å•ä¾‹çš„å®ä¾‹ã€‚\n* æˆ‘ä»¬ä¹Ÿæä¾›å¯¹è¿™ä¸ªå®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ï¼šå½“ä½ éœ€è¦å®ä¾‹æ—¶ï¼Œåƒç±»æŸ¥è¯¢ï¼Œå®ƒä¼šè¿”å›å•ä¸ªå®ä¾‹ã€‚\n\n### å®ç°\n\npython å®ç°å•ä¾‹æ¨¡å¼æœ‰å¤šç§æ–¹æ¡ˆï¼š\n#### ä½¿ç”¨ metaclass\n\nã€Špython cookbookã€‹æä¾›äº†éå¸¸æ˜“ç”¨çš„ `Singleton` ç±»ï¼Œåªè¦ç»§æ‰¿å®ƒï¼Œå°±ä¼šæˆä¸ºå•ä¾‹ã€‚\n\n```python\n# python 3 ä»£ç å®ç°\nclass Singleton(type):\n\n    def __init__(self, *args, **kwargs):\n        self.__instance = None\n        super().__init__(*args, **kwargs)\n\n    def __call__(self, *args, **kwargs):\n        if self.__instance is None:\n            # å¦‚æœ __instance ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„å®ä¾‹\n            self.__instance = super().__call__(*args, **kwargs)\n            return self.__instance\n        else:\n            # å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›\n            return self.__instance\n\n\nclass Spam(metaclass=Singleton):\n\n    def __init__(self):\n        print('Creating Spam')\n\na = Spam()\nb = Spam()\n\nprint(a is b)  # è¿™é‡Œè¾“å‡ºä¸º True\n```\n\nå…ƒç±»ï¼ˆmetaclassï¼‰å¯ä»¥æ§åˆ¶ç±»çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå®ƒä¸»è¦åšä¸‰ä»¶äº‹ï¼š\n\n* æ‹¦æˆªç±»çš„åˆ›å»º\n* ä¿®æ”¹ç±»çš„å®šä¹‰\n* è¿”å›ä¿®æ”¹åçš„ç±»\n\nä¾‹å­ä¸­æˆ‘ä»¬æ„é€ äº†ä¸€ä¸ªSingletonå…ƒç±»ï¼Œå¹¶ä½¿ç”¨__call__æ–¹æ³•ä½¿å…¶èƒ½å¤Ÿæ¨¡æ‹Ÿå‡½æ•°çš„è¡Œä¸ºã€‚æ„é€ ç±» Spam æ—¶ï¼Œå°†å…¶å…ƒç±»è®¾ä¸ºSingletonï¼Œé‚£ä¹ˆåˆ›å»ºç±»å¯¹è±¡ Spam æ—¶ï¼Œè¡Œä¸ºå‘ç”Ÿå¦‚ä¸‹ï¼š\n\nSpam = Singleton(name,bases,class_dict)ï¼ŒSpam å…¶å®ä¸ºSingletonç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚\n\nåˆ›å»º Spam çš„å®ä¾‹æ—¶ï¼ŒSpam()=Singleton(name,bases,class_dict)()=Singleton(name,bases,class_dict).__call__()ï¼Œè¿™æ ·å°±å°† Spam çš„æ‰€æœ‰å®ä¾‹éƒ½æŒ‡å‘äº† Spam çš„å±æ€§ __instanceä¸Šã€‚\n\n#### ä½¿ç”¨ __new__\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ __new__ æ¥æ§åˆ¶å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹:\n\n```python\nclass Singleton(object):\n\n    __instance = None\n\n    def __new__(cls, *args, **kw):\n        if not cls.__instance:\n            cls.__instance = super().__new__(cls, *args, **kw)\n        return cls.__instance\n\nclass Foo(Singleton):\n    a = 1\n\none = Foo()\ntwo = Foo()\nassert one == two\nassert one is two\nassert id(one) == id(two)\n```\n\né€šè¿‡ __new__ æ–¹æ³•ï¼Œå°†ç±»çš„å®ä¾‹åœ¨åˆ›å»ºçš„æ—¶å€™ç»‘å®šåˆ°ç±»å±æ€§ __instance ä¸Šã€‚å¦‚æœcls.__instance ä¸ºNoneï¼Œè¯´æ˜ç±»è¿˜æœªå®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–å¹¶å°†å®ä¾‹ç»‘å®šåˆ°cls.__instance ä»¥åæ¯æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™éƒ½è¿”å›ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–åˆ›å»ºçš„å®ä¾‹ã€‚æ³¨æ„ä»Singletonæ´¾ç”Ÿå­ç±»çš„æ—¶å€™ï¼Œä¸è¦é‡è½½__new__ã€‚\n\n#### ä½¿ç”¨è£…é¥°å™¨\n\n```python\nimport functools\n\ndef singleton(cls):\n    ''' Use class as singleton. '''\n    # é¦–å…ˆå°† __new__ æ–¹æ³•èµ‹å€¼ç»™ __new_original__\n    cls.__new_original__ = cls.__new__\n\n    @functools.wraps(cls.__new__)\n    def singleton_new(cls, *args, **kw):\n        # å°è¯•ä» __dict__ å– __it__\n        it =  cls.__dict__.get('__it__')\n        if it is not None: # å¦‚æœæœ‰å€¼ï¼Œè¯´æ˜å®ä¾‹å·²ç»åˆ›å»ºï¼Œè¿”å›å®ä¾‹\n            return it\n        # å¦‚æœå®ä¾‹ä¸å­˜åœ¨ï¼Œä½¿ç”¨ __new_original__ åˆ›å»ºå®ä¾‹ï¼Œå¹¶å°†å®ä¾‹èµ‹å€¼ç»™ __it__\n        cls.__it__ = it = cls.__new_original__(cls, *args, **kw)\n        it.__init_original__(*args, **kw)\n        return it\n    # class å°†åŸæœ‰__new__ æ–¹æ³•ç”¨ singleton_new æ›¿æ¢\n    cls.__new__ = singleton_new\n    cls.__init_original__ = cls.__init__\n    cls.__init__ = object.__init__\n\n    return cls\n\n#\n# ä½¿ç”¨ç¤ºä¾‹\n#\n@singleton\nclass Foo:\n    def __new__(cls):\n        cls.x = 10\n        return object.__new__(cls)\n\n    def __init__(self):\n        assert self.x == 10\n        self.x = 15\n\n\nassert Foo().x == 15\nFoo().x = 20\nassert Foo().x == 20\n```\n\nè¿™ç§æ–¹æ³•çš„å†…éƒ¨å®ç°å’Œä½¿ç”¨ `__new__` ç±»ä¼¼ï¼š\n\n* é¦–å…ˆï¼Œå°† __new__ æ–¹æ³•èµ‹å€¼ç»™ __new_original__ï¼ŒåŸæœ‰ __new__ æ–¹æ³•ç”¨ singleton_new æ›¿æ¢ï¼Œå®šä¹‰  __init_original__ å¹¶å°† cls.__init__ èµ‹å€¼ç»™ __init_original__\n* åœ¨ singleton_new æ–¹æ³•å†…éƒ¨ï¼Œå°è¯•ä» __dict__ å– __it__ï¼ˆå®ä¾‹ï¼‰\n* å¦‚æœå®ä¾‹ä¸å­˜åœ¨ï¼Œä½¿ç”¨ __new_original__ åˆ›å»ºå®ä¾‹ï¼Œå¹¶å°†å®ä¾‹èµ‹å€¼ç»™ __it__ï¼Œç„¶åè¿”å›å®ä¾‹\n\n#### æœ€ç®€å•çš„æ–¹å¼\n\nå°†åå­—singletonç»‘å®šåˆ°å®ä¾‹ä¸Šï¼Œsingletonå°±æ˜¯å®ƒè‡ªå·±ç±»çš„å”¯ä¸€å¯¹è±¡äº†ã€‚\n\n```python\nclass singleton(object):\n    pass\nsingleton = singleton()\n```\n\n[https://github.com/gusibi/Metis/blob/master/apis/v1/schemas.py#L107](https://github.com/gusibi/Metis/blob/master/apis/v1/schemas.py#L107) ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ï¼Œç”¨æ¥è·å–å…¨å±€çš„ request\n\n> Python çš„æ¨¡å—å°±æ˜¯å¤©ç„¶çš„å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºæ¨¡å—åœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ—¶ï¼Œä¼šç”Ÿæˆ .pyc æ–‡ä»¶ï¼Œå½“ç¬¬äºŒæ¬¡å¯¼å…¥æ—¶ï¼Œå°±ä¼šç›´æ¥åŠ è½½ .pyc æ–‡ä»¶ï¼Œè€Œä¸ä¼šå†æ¬¡æ‰§è¡Œæ¨¡å—ä»£ç ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€æŠŠç›¸å…³çš„å‡½æ•°å’Œæ•°æ®å®šä¹‰åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå°±å¯ä»¥è·å¾—ä¸€ä¸ªå•ä¾‹å¯¹è±¡äº†ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [Creating a singleton in Python](https://stackoverflow.com/questions/6760685/creating-a-singleton-in-python#)\n* [Pythonå•ä¾‹æ¨¡å¼](https://www.cnblogs.com/linxiyue/p/3902256.html)\n* [Why is __init__() always called after __new__()?](https://stackoverflow.com/questions/674304/why-is-init-always-called-after-new)\n------\n\n\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\næ¬¢è¿å…³æ³¨(April_Louisa) | è¯·æˆ‘å–èŠ¬è¾¾\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼",
        "date": "2017-11-26 04:59:39",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-singleton"
    },
    {
      "content": "\n> `é—®é¢˜ï¼š`åœ¨ä¸Šä¸€ç¯‡[pythonè®¾è®¡æ¨¡å¼ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼](https://mp.weixin.qq.com/s/mdulFWnTUiNvitNb2A5ZOQ)ä¸­ï¼Œæˆ‘ä»¬å°è¯•ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼è§„èŒƒåŒ–äº† Pizza åŸææ–™çš„ä¾›åº”ä»¥åŠ Pizza çš„åˆ›å»ºã€‚ä½†æ˜¯æˆ‘ä»¬å¿½ç•¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ¯ç§ Pizza çš„çƒ˜ç„™æ—¶é—´ä¾èµ–äºç”Ÿé¢å›¢çš„åšåº¦å’Œä½¿ç”¨çš„é…æ–™ï¼Œå®ƒä»¬æ‰€éœ€çš„æ—¶é—´æ˜¯ä¸ä¸€æ ·çš„ã€‚é‚£è¿™æ—¶æˆ‘ä»¬æ”¹å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ\n\nPizza çš„åˆ¶ä½œæµç¨‹åŒ…æ‹¬ï¼šå‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’ã€‚è¿™äº›æœ‰ç‰¹å®šçš„é¡ºåºï¼Œä¸èƒ½é”™ä¹±ã€‚\n\nä¸ºäº†ä¿è¯ ç”Ÿäº§ Pizza çš„æ­¥éª¤ä¸ä¼šå‡ºé”™ï¼Œæˆ‘ä»¬æ‰“ç®—æŒ‡æ´¾ä¸€ä¸ªåˆ›å»ºè€…ï¼Œåˆ›å»ºè€…ç”¨äºæ§åˆ¶ Pizza çš„åˆ¶ä½œæµç¨‹ã€‚\n\n\n## åˆ›å»º Pizza åˆ›å»ºè€…\n\né¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Pizza\n\n```python\nclass Pizza:\n\n    def __init__(self, name):\n        self.name = name\n        self.dough = None\n        self.sauce = None\n        self.toppings = []\n\n    def prepare_dough(self, dough):\n        self.dough = dough\n        print(self.dough)\n        print('preparing the {} dough of your {}...'.format(self.dough, self))\n        time.sleep(STEP_DELAY)\n        print('Done with the {} dough'.format(self.dough))\n\n    def __str__(self):\n        return self.name\n```\n\nç„¶åæˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªåˆ›å»ºè€…ï¼š\n\n```python\nclass PizzaBuilder(object):\n\n    name = None\n\n    def __init__(self):\n        self.progress = PIZZA_PROGRESS\n        self.baking_time = 5\n\n    def prepare_dough(self):\n        raise NotImplementedError()\n\n    def add_sauce(self):\n        raise NotImplementedError()\n\n    def add_topping(self):\n        raise NotImplementedError()\n\n    def bake(self):\n        raise NotImplementedError()\n\n    def cut(self):\n        raise NotImplementedError()\n\n    def box(self):\n        raise NotImplementedError()\n\n    @property\n    def pizza(self):\n        return Pizza(self.name)\n\n```\n\n### åˆ›å»ºå…·ä½“å»ºé€ è€…\n\n\n```python\nclass NYStyleCheeseBuilder(PizzaBuilder):\n\n    name = 'NY Style Sauce and Cheese Pizza'\n\n    def prepare_dough(self):\n        self.progress = PIZZA_PROGRESS[0]\n        self.pizza.prepare_dough('thin')\n\n    def add_sauce(self):\n        print('adding the tomato sauce to your pizza..')\n        self.pizza.sauce = 'tomato'\n        time.sleep(STEP_DELAY)\n        print('done with the tomato sauce')\n\n    def add_topping(self):\n        print('adding the topping (grated reggiano cheese) to your pizza')\n        self.pizza.toppings.append([\"Grated\", \"Reggiano\", \"Cheese\"])\n        time.sleep(STEP_DELAY)\n        print('done with the topping (grated reggiano cheese)')\n\n    def bake(self):\n        self.progress = PIZZA_PROGRESS[1]\n        print('baking your pizza for {} seconds'.format(self.baking_time))\n        time.sleep(self.baking_time)\n\n    def cut(self):\n        self.progress = PIZZA_PROGRESS[2]\n        print(\"Cutting the pizza into diagonal slices\")\n\n    def box(self):\n        self.progress = PIZZA_PROGRESS[3]\n        print(\"Place pizza in official PizzaStore box\")\n```\n\n\n### åˆ›å»ºæŒ‡æŒ¥è€…\n\n```python\nclass Waiter:\n    # æŒ‡æŒ¥è€…\n\n    def __init__(self):\n        self.builder = None\n\n    def construct_pizza(self, builder):\n        self.builder = builder\n        #  ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª pizzaï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’\n        [step() for step in (builder.prepare_dough, builder.add_sauce,\n                             builder.add_topping, builder.bake,\n                             builder.cut, builder.box)]\n\n    @property\n    def pizza(self):\n        return self.builder.pizza\n```\n\nå®Œæ•´ä»£ç å‚è€ƒï¼š[python-design-patter-builder](https://gist.github.com/gusibi/8f84ec29e6b9d42ad2de224dc731a6bf)\n\nä»è¿™ä¸ªä¾‹å­æˆ‘å¯ä»¥çœ‹å‡ºï¼Œå»ºé€ è€…æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š\n\n* Builderï¼šæŠ½è±¡å»ºé€ è€…(Builder)ï¼ˆå¼•å…¥æŠ½è±¡å»ºé€ è€…çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†å°†å»ºé€ çš„å…·ä½“è¿‡ç¨‹äº¤ä¸å®ƒçš„å­ç±»æ¥å®ç°ã€‚è¿™æ ·æ›´å®¹æ˜“æ‰©å±•ã€‚ä¸€èˆ¬è‡³å°‘ä¼šæœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥å»ºé€ äº§å“ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥è¿”å›äº§å“ã€‚ï¼‰\n* ConcreteBuilderï¼šå…·ä½“å»ºé€ è€…(CommonBuilderã€SuperBuilder)ï¼ˆå®ç°æŠ½è±¡ç±»çš„æ‰€æœ‰æœªå®ç°çš„æ–¹æ³•ï¼Œå…·ä½“æ¥è¯´ä¸€èˆ¬æ˜¯ä¸¤é¡¹ä»»åŠ¡ï¼šç»„å»ºäº§å“ï¼›è¿”å›ç»„å»ºå¥½çš„äº§å“ã€‚ï¼‰\n* Directorï¼šæŒ‡æŒ¥è€…(Director)ï¼ˆè´Ÿè´£è°ƒç”¨é€‚å½“çš„å»ºé€ è€…æ¥ç»„å»ºäº§å“ï¼ŒæŒ‡æŒ¥è€…ç±»ä¸€èˆ¬ä¸ä¸äº§å“ç±»å‘ç”Ÿä¾èµ–å…³ç³»ï¼Œä¸æŒ‡æŒ¥è€…ç±»ç›´æ¥äº¤äº’çš„æ˜¯å»ºé€ è€…ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæŒ‡æŒ¥è€…ç±»è¢«ç”¨æ¥å°è£…ç¨‹åºä¸­æ˜“å˜çš„éƒ¨åˆ†ã€‚ï¼‰\n* Productï¼šäº§å“è§’è‰²(Role)\n\n## å»ºé€ è€…æ¨¡å¼\n\né€ è€…æ¨¡å¼(Builder Pattern)ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œæ¯ä¸ªäº§å“çš„å»ºé€ ä¼šéµå¾ªåŒæ ·çš„æµç¨‹ï¼Œä¸è¿‡æµç¨‹å†…çš„æ¯ä¸€ä¸ªæ­¥éª¤éƒ½ä¸å°½ç›¸åŒã€‚\n\n> å»ºé€ è€…æ¨¡å¼åˆå¯ä»¥ç§°ä¸ºç”Ÿæˆå™¨æ¨¡å¼ã€‚\n\n![å»ºé€ è€…æ¨¡å¼ç±»å›¾](http://media.gusibi.mobi/XYQwmOYBhmsCsm3_Tg9UDoZD50j-X6CS9_ywASYrKXUKBhx5Qokk9Y7w3B9EDWbc)\n\n\n### å»ºé€ è€…æ¨¡å¼åœ¨è½¯ä»¶ä¸­çš„åº”ç”¨\n\n* django-widgyæ˜¯ä¸€ä¸ª Djangoçš„ç¬¬ä¸‰æ–¹æ ‘ç¼–è¾‘å™¨æ‰©å±•ï¼Œå¯ç”¨ä½œå†…å®¹ç®¡ç†ç³»ç»Ÿ(Content Management Systemï¼ŒCMS)ã€‚å®ƒåŒ…å«ä¸€ä¸ªç½‘é¡µæ„å»ºå™¨ï¼Œç”¨æ¥åˆ›å»ºå…·æœ‰ä¸åŒå¸ƒå±€çš„HTMLé¡µé¢ã€‚\n\n* django-query-builderæ˜¯å¦ä¸€ä¸ªåŸºäºå»ºé€ è€…æ¨¡å¼çš„Djangoç¬¬ä¸‰æ–¹æ‰©å±•åº“ï¼Œè¯¥æ‰©å±•åº“å¯ç”¨äºåŠ¨æ€ åœ°æ„å»ºSQLæŸ¥è¯¢ã€‚ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ä¸€ä¸ªæŸ¥è¯¢çš„æ–¹æ–¹é¢é¢ï¼Œå¹¶èƒ½åˆ›å»ºä¸åŒç§ç±»çš„æŸ¥è¯¢ï¼Œä»ç®€ å•çš„åˆ°éå¸¸å¤æ‚çš„éƒ½å¯ä»¥\n\n\n## å»ºé€ è€…æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„åŒºåˆ«\n\nçœ‹ä¸Šè¾¹è¿™ä¸ªä¾‹å­ï¼Œä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆæ˜æ˜å¯ä»¥ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œè¦æ¢æˆå»ºé€ è€…æ¨¡å¼å‘¢ï¼Ÿ\n\né€šè¿‡ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå»ºé€ è€…æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼Œå»ºé€ è€…æ¨¡å¼å¤šäº†ä¸€ä¸ªæŒ‡æŒ¥è€…çš„è§’è‰²ã€‚`å»ºé€ è€…è´Ÿè´£åˆ›å»ºå¤æ‚å¯¹è±¡çš„å„ä¸ªç»„æˆéƒ¨åˆ†ã€‚è€ŒæŒ‡æŒ¥è€…ä½¿ç”¨ä¸€ä¸ªå»ºé€ è€…å®ä¾‹æ§åˆ¶å»ºé€ çš„è¿‡ç¨‹`ã€‚\n\n`ä¸å·¥å‚æ¨¡å¼ç›¸æ¯”ï¼Œå»ºé€ è€…æ¨¡å¼ä¸€èˆ¬ç”¨æ¥åˆ›å»ºæ›´ä¸ºå¤æ‚çš„å¯¹è±¡`ï¼Œå› ä¸ºå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹æ›´ä¸ºå¤æ‚ï¼Œå› æ­¤å°†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ç‹¬ç«‹å‡ºæ¥ç»„æˆä¸€ä¸ªæ–°çš„ç±»â€”â€”æŒ‡æŒ¥è€…ç±»ã€‚\n\nå»ºé€ è€…æ¨¡å¼é€šå¸¸ç”¨äºè¡¥å……å·¥å‚æ¨¡å¼çš„ä¸è¶³ï¼Œå°¤å…¶æ˜¯åœ¨å¦‚ä¸‹åœºæ™¯ä¸­ï¼š\n\n* è¦æ±‚ä¸€ä¸ªå¯¹è±¡æœ‰ä¸åŒçš„è¡¨ç°ï¼Œå¹¶ä¸”å¸Œæœ›å°†å¯¹è±¡çš„æ„é€ ä¸è¡¨ç°è§£è€¦\n* è¦æ±‚åœ¨æŸä¸ªæ—¶é—´ç‚¹åˆ›å»ºå¯¹è±¡ï¼Œä½†åœ¨ç¨åçš„æ—¶é—´ç‚¹å†è®¿é—®\n\n\n## å‚è€ƒé“¾æ¥\n\n\n* [è®²æ•…äº‹ï¼Œå­¦ï¼ˆJavaï¼‰è®¾è®¡æ¨¡å¼â€”å»ºé€ è€…æ¨¡å¼](http://www.importnew.com/6841.html)\n* [è®¾è®¡æ¨¡å¼ï¼ˆä¹ï¼‰â€”â€”å»ºé€ è€…æ¨¡å¼](http://www.hollischuang.com/archives/1477)\n* [23ç§è®¾è®¡æ¨¡å¼ï¼ˆ4ï¼‰ï¼šå»ºé€ è€…æ¨¡å¼](http://blog.csdn.net/zhengzhb/article/details/7375966)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼",
        "date": "2017-11-12 13:16:56",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-builder"
    },
    {
      "content": "\n> `é—®é¢˜ï¼š`åœ¨ä¸Šä¸€ç¯‡ [pythonè®¾è®¡æ¨¡å¼ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼](https://mp.weixin.qq.com/s/3HtKVCzPOmuk5uFpfoBsqA)æˆ‘ä»¬å°è¯•ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºäº†æŠ«è¨åº—ï¼Œç°åœ¨ä¸ºäº†ä¿è¯æŠ«è¨åŠ ç›Ÿåº—ä¹Ÿèƒ½æœ‰è‰¯å¥½çš„å£°èª‰ï¼Œæˆ‘ä»¬éœ€è¦`ç»Ÿä¸€åŸææ–™`ï¼Œè¿™ä¸ªè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ\n\nä¸ºäº†ç¡®ä¿æ¯å®¶åŠ ç›Ÿåº—éƒ½æ˜¯ç”¨é«˜è´¨é‡çš„åŸææ–™ï¼Œæˆ‘ä»¬æ‰“ç®—å»ºé€ ä¸€åŠ åŸææ–™å·¥å‚ï¼Œå¹¶å°†åŸææ–™è¿é€åˆ°å„ä¸ªåŠ ç›Ÿåº—ã€‚`æ¯ä¸ªåŠ ç›Ÿåº—ä¼šå¯¹åŸææ–™æœ‰ä¸åŒçš„éœ€æ±‚`ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸Šä¸Šä¸€ç¯‡ä»‹ç»çš„å·¥å‚æ–¹æ³•æ¨¡å¼äº†ã€‚\n\n1. é¦–å…ˆï¼Œå»ºé€ åŸæ–™å·¥å‚\n2. ç„¶åå»ºé€ åŒºåŸŸçš„åŸæ–™å·¥å‚ï¼ˆç»§æ‰¿è‡ªåŸæ–™å·¥å‚ï¼‰\n3. åœ¨åŒºåŸŸçš„åŸæ–™å·¥å‚ä¸­å®ç°åŸæ–™çš„åˆ›å»ºæ–¹æ³•ã€‚\n4. å°†åŸæ–™å·¥å‚ç»„åˆèµ·æ¥ï¼ŒåŠ å…¥åˆ° PizzaStoreï¼ˆä¸Šä¸€ç¯‡ä¸­ç”±å·¥å‚æ–¹æ³•å®ç°ï¼‰ä»£ç ä¸­ã€‚\n\næŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºåŸæ–™å·¥å‚\n\n## åˆ›å»ºåŸæ–™å·¥å‚\n\nåˆ›å»ºåŸæ–™å·¥å‚çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š\n\n```python\n# åŸæ–™\nclass FreshClams:\n\n    def __str__(self):\n        return 'Fresh Clams'\n\nclass MarinaraSauce:\n\n    def __str__(self):\n        return \"Marinara Sauce\"\n\nclass ThickCrustDough:\n\n    def __str__(self):\n        return \"Thick Crust Dough\"\n\nclass ReggianoCheese:\n\n    def __str__(self):\n        return \"Reggiano Cheese\"\n\nclass SlicedPepperoni:\n\n    def __str__(self):\n        return \"Sliced Pepperoni\"\n\nclass Garlic:\n\n    def __str__(self):\n        return \"Garlic\"\n\nclass Onion:\n\n    def __str__(self):\n        return \"Onion\"\n\nclass RedPepper:\n\n    def __str__(self):\n        return \"Red Pepper\"\n\n# æŠ«è¨åº—åŸæ–™å·¥å‚\nclass PizzaIngredientFactory:\n\n    '''\n    å®šä¹‰åŸæ–™å·¥å‚\n    '''\n\n    def create_dough(self):\n        raise NotImplementedError()\n\n    def create_sauce(self):\n        raise NotImplementedError()\n\n    def create_cheese(self):\n        raise NotImplementedError()\n\n    def create_pepperoni(self):\n        raise NotImplementedError()\n\n    def create_clam(self):\n        raise NotImplementedError()\n\n    def create_veggies(self):\n        raise NotImplementedError()\n```\n\nåœ¨è¿™ä¸ªå·¥å‚ä¸­ï¼Œæ¯ä¸ªåŸæ–™éƒ½æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼ŒåŸæ–™çš„å®ç°éœ€è¦åœ¨å…·ä½“çš„åŸæ–™å·¥å‚ä¸­å®ç°ã€‚\nè¿™é‡Œæ¯ä¸ªåŸæ–™æ–¹æ³•æ²¡æœ‰åšä»»ä½•å·¥ä½œï¼Œåªæ˜¯æŠ›å‡ºäº†`NotImplementedError` è¿™æ ·åšæ˜¯ä¸ºäº†å¼ºåˆ¶å­ç±»é‡æ–°å®ç°ç›¸åº”çš„æ–¹æ³•ï¼Œå¦‚æœä¸é‡æ–°å®ç°ç”¨åˆ°æ—¶å°±ä¼šæŠ›å‡º NotImplementedErrorã€‚\n\n> å½“ç„¶ä¹Ÿå¯ä»¥æŠŠ PizzaIngredientFactory çš„ metaclass è®¾ç½®æˆ abc.ABCMeta è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªç±»å°±æ˜¯çœŸæ­£çš„æŠ½è±¡åŸºç±»ã€‚\n\n### åˆ›å»ºçº½çº¦åŸæ–™å·¥å‚\n\n```python\nclass NYPizzaIngredientFactory(PizzaIngredientFactory):\n    def create_dough(self):\n        print(\"Tossing %s\" % ThickCrustDough())\n        return ThickCrustDough()\n\n    def create_sauce(self):\n        print(\"Adding %s...\" % MarinaraSauce())\n        return MarinaraSauce()\n\n    def create_cheese(self):\n        print(\"Adding %s...\" % ReggianoCheese())\n        return ReggianoCheese()\n\n    def create_pepperoni(self):\n        print(\"Adding %s...\" % SlicedPepperoni())\n        return SlicedPepperoni()\n\n    def create_clam(self):\n        print(\"Adding %s...\" % FreshClams())\n        return FreshClams()\n\n    def create_veggies(self):\n        # è”¬èœå¯èƒ½æœ‰å¤šç§ï¼Œè¿™é‡Œä½¿ç”¨åˆ—è¡¨\n        veggies = [Garlic(), Onion(), RedPepper()]\n        for veggie in veggies:\n            print(\"  %s\" % veggie)\n        return veggies\n```\n\nå¯¹äºåŸæ–™å®¶æ—çš„æ¯ä¸€ç§åŸæ–™ï¼Œæˆ‘ä»¬éƒ½æä¾›äº†åŸæ–™çš„çº½çº¦ç‰ˆæœ¬ã€‚\n\n### é‡åš Pizza ç±»\n\n```python\nclass Pizza:\n    \n    name = None\n    dough = None\n    sauce = None\n    cheese = None\n    veggies = []\n    pepperoni = None\n    clam = None\n\n    def prepare(self):\n        raise NotImplementedError()\n\n    def bake(self):\n        print(\"Bake for 25 minutes at 350\")\n\n    def cut(self):\n        print(\"Cutting the pizza into diagonal slices\")\n\n    def box(self):\n        print(\"Place pizza in official PizzaStore box\")\n\n    def __str__(self):\n        return self.name\n```\n\nä¸Šè¿°ä»£ç å’Œå·¥å‚æ–¹æ³•çš„ä»£ç ç›¸æ¯”ï¼Œåªæ˜¯æŠŠ `prepare()` æ–¹æ³•æŠ½è±¡å‡ºæ¥ï¼Œéœ€è¦ç›¸åº”çš„ å…·ä½“çš„ pizza ç±»æ¥å®ç° `prepare()`ã€‚\n\n### å®ç° èŠåŠ å“¥èŠå£«æŠ«è¨\n\n```python\nclass NYStyleCheesePizza(Pizza):\n\n    def prepare(self):\n        dough = self.ingredient_factory.create_dough()\n        sauce = self.ingredient_factory.create_sauce()\n        cheese = self.ingredient_factory.create_cheese()\n        clam = self.ingredient_factory.create_clam()\n        veggies = self.ingredient_factory.create_veggies()\n```\n\nä»ä¸Šè¿°ä»£ç å¯ä»¥å‘ç°ï¼ŒPizza çš„åŸæ–™ä¹Ÿæ˜¯ä»åŸæ–™å·¥å‚ç›´æ¥è·å–ï¼Œç°åœ¨æˆ‘ä»¬æ§åˆ¶äº†åŸæ–™ã€‚\n\n> ç°åœ¨ï¼ŒPizza ç±»ä¸éœ€è¦å…³å¿ƒåŸæ–™ï¼Œåªéœ€è¦è´Ÿè´£åˆ¶ä½œ pizza å°±å¥½ã€‚Pizza å’ŒåŸæ–™è¢«è§£è€¦ã€‚\n\n### é‡æ–°å®ç° PizzaStore\n\n```python\nclass PizzaStore:\n    \n    # éœ€è¦å£°æ˜åŸæ–™å·¥å‚\n    ingredient_factory = None\n\n    def create_pizza(self, pizza_type):\n        # æ¯ä¸ªéœ€è¦å­ç±»å®ç°çš„æ–¹æ³•éƒ½ä¼šæŠ›å‡ºNotImplementedError\n        # æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ PizzaStore çš„ metaclass è®¾ç½®æˆ abc.ABCMeta\n        # è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªç±»å°±æ˜¯çœŸæ­£çš„æŠ½è±¡åŸºç±»\n        raise NotImplementedError()\n\n    def order_pizza(self, pizza_type):  # ç°åœ¨æŠŠ pizza çš„ç±»å‹ä¼ å…¥ order_pizza()\n\n        pizza = self.create_pizza(pizza_type)\n\n        #  ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª pizzaï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’\n        pizza.prepare()\n        pizza.bake()\n        pizza.cut()\n        pizza.box()\n        return pizza\n\nclass NYStylePizzStore(PizzaStore):\n    \n    # å°†éœ€è¦ç”¨åˆ°çš„åŸæ–™å·¥å‚èµ‹å€¼ç»™å˜é‡ ingredient_factory\n    ingredient_factory = NYPizzaIngredientFactory()\n\n    def create_pizza(self, pizza_type):\n        # æ ¹æ® pizza ç±»å‹ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–æ­£ç¡®çš„å…·ä½“ç±»ï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ pizza å®ä¾‹å˜é‡\n        if pizza_type == 'cheese':\n            pizza = NYStyleCheesePizza('NY Style Sauce and Cheese Pizza',\n                                       self.ingredient_factory)\n        elif pizza_type == 'clam':\n            pizza = NYStyleClamPizza('NY Style Clam Pizza',\n                                     self.ingredient_factory)\n        return pizza\n```\n\né€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åšäº†ä»¥ä¸‹å·¥ä½œï¼š\n1. å¼•å…¥äº†æ–°ç±»å‹çš„å·¥å‚ï¼ˆæŠ½è±¡å·¥å‚ï¼‰æ¥åˆ›å»ºåŸæ–™å®¶æ—\n2. é€šè¿‡æŠ½è±¡å·¥å‚æä¾›çš„æ¥å£ï¼Œæˆ‘ä»¬åˆ›å»ºäº†åŸæ–™å®¶æ—ã€‚\n3. æˆ‘ä»¬çš„åŸæ–™ä»£ç ä»å®é™…çš„ Pizza å·¥å‚ä¸­æˆåŠŸè§£è€¦ï¼Œå¯ä»¥åº”ç”¨åˆ°ä¸åŒåœ°æ–¹ï¼Œå“åº”çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„æ›¿æ¢åŸæ–™å·¥å‚æ¥ç”Ÿäº§ä¸åŒçš„ pizzaã€‚\n\n### æ¥çœ‹ä¸‹ä¸‹å•çš„ä»£ç \n\n```python\ndef main():\n    nystore = NYStylePizzStore()\n    pizza = nystore.order_pizza('cheese')\n    print('*' * 10)\n    print(\"goodspeed ordered a %s\" % pizza)\n    print('*' * 10)\n```\nå’Œå·¥å‚æ–¹æ³•çš„ä»£ç ç›¸æ¯”ï¼Œæ²¡æœ‰ä»»ä½•æ”¹å˜ã€‚\n\n`[æºç å‚è€ƒpython-design-patter-abstract-factory.py](https://gist.github.com/gusibi/5e0797f5458678322486f999ca87a180)`\n\n## æŠ½è±¡å·¥å‚æ¨¡å¼\n\n> `æŠ½è±¡å·¥å‚æ¨¡å¼`æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œä¸éœ€è¦æŒ‡å®šå…·ä½“ç±»ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠ½è±¡å·¥å‚å…è®¸å®¢æˆ·ä½¿ç”¨æŠ½è±¡çš„æ¥å£æ¥åˆ›å»ºä¸€ç»„ç›¸å…³çš„äº§å“ï¼Œè€Œä¸éœ€è¦çŸ¥é“å®é™…äº§å‡ºçš„å…·ä½“äº§å“æ˜¯ä»€ä¹ˆï¼Œè¿™æ ·ä¾èµ–ï¼Œå®¢æˆ·å°±ä»å…·ä½“äº§å“ä¸­è¢«è§£è€¦ã€‚\n\næ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼ŒæŠ½è±¡å·¥å‚æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„å·¥å‚æ–¹æ³•ï¼Œæ¯ä¸ªå·¥å‚æ–¹æ³•å„å¸å…¶èŒï¼Œè´Ÿè´£ç”Ÿäº§ä¸åŒç§ç±»çš„å¯¹è±¡ã€‚\n\næˆ‘ä»¬æ¥çœ‹ä¸‹ æŠ½è±¡å·¥å‚æ¨¡å¼ çš„ç±»å›¾ï¼š\n\n![æŠ½è±¡å·¥å‚æ¨¡å¼ç±»å›¾](http://media.gusibi.mobi/WXTX-aCeU8DaFhBXBHy1D8pqiLDUJggw-XqCGgYTmigQOdi8dly0Z-ujsJVgq7T5)\n\næŠ½è±¡å·¥å‚åœ¨ django_factory ä¸­åº”ç”¨æ¯”è¾ƒå¤šï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸‹æºç ã€‚\n\n## æŠ½è±¡å·¥å‚æ¨¡å¼ å’Œ å·¥å‚æ–¹æ³•æ¨¡å¼ çš„æ¯”è¾ƒ\n\næŠ½è±¡å·¥å‚æ¨¡å¼ å’Œ å·¥å‚æ–¹æ³•æ¨¡å¼ éƒ½æ˜¯è´Ÿè´£åˆ›å»ºå¯¹è±¡ï¼Œä½† \n\n* `å·¥å‚æ–¹æ³•æ¨¡å¼ä½¿ç”¨çš„æ˜¯ç»§æ‰¿`\n* `æŠ½è±¡å·¥å‚æ¨¡å¼ä½¿ç”¨çš„æ˜¯å¯¹è±¡çš„ç»„åˆ`\n\nè¿™ä¹Ÿå°±æ„å‘³ç€åˆ©ç”¨`å·¥å‚æ–¹æ³•`åˆ›å»ºå¯¹è±¡éœ€è¦æ‰©å±•ä¸€ä¸ªç±»ï¼Œå¹¶è¦†ç›–å®ƒçš„å·¥å‚æ–¹æ³•ï¼ˆè´Ÿè´£å°†å®¢æˆ·ä»å…·ä½“ç±»ä¸­è§£è€¦ï¼‰ã€‚\n`æŠ½è±¡å·¥å‚`æä¾›ä¸€ä¸ªç”¨æ¥åˆ›å»ºäº§å“å®¶æ—çš„æŠ½è±¡ç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„å­ç±»å®šä¹‰äº†äº§å“è¢«äº§ç”Ÿçš„æ–¹æ³•ã€‚è¦æƒ³ä½¿ç”¨è¿™ä¸ªå·¥å‚ï¼ˆ`NYPizzaIngredientFactory`ï¼‰ï¼Œå¿…é¡»å…ˆå®ä¾‹åŒ–å®ƒï¼ˆ`ingredient_factory = NYPizzaIngredientFactory()`ï¼‰ï¼Œç„¶åå°†å®ƒä¼ å…¥ä¸€äº›é’ˆå¯¹æŠ½è±¡ç±»å‹æ‰€å†™çš„ä»£ç ä¸­ï¼ˆä¹Ÿåšåˆ°äº†å°†å®¢æˆ·ä»å…·ä½“äº§å“ä¸­è§£è€¦ï¼‰ï¼ŒåŒæ—¶è¿˜æŠŠä¸€ç¾¤ç›¸å…³çš„äº§å“é›†åˆèµ·æ¥ã€‚\n\n#### å·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¦‚ä½•é€‰æ‹©\n\nå¼€å§‹çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå› ä¸ºä»–å¾ˆç®€å•ï¼ˆåªéœ€è¦ç»§æ‰¿ï¼Œå¹¶å®ç°å·¥å‚æ–¹æ³•å³å¯ï¼‰ã€‚å¦‚æœåæ¥å‘ç°åº”ç”¨éœ€è¦ç”¨åˆ°å¤šä¸ªå·¥å‚æ–¹æ³•ï¼Œé‚£ä¹ˆæ˜¯æ—¶å€™ä½¿ç”¨`æŠ½è±¡å·¥å‚æ¨¡å¼`äº†ï¼Œå®ƒå¯ä»¥æŠŠç›¸å…³çš„å·¥å‚æ–¹æ³•ç»„åˆèµ·æ¥ã€‚\n\n### æŠ½è±¡å·¥å‚æ¨¡å¼ä¼˜ç‚¹å’Œç¼ºç‚¹\n\n#### ä¼˜ç‚¹\n\n* å¯ä»¥å°†å®¢æˆ·ä»å…·ä½“äº§å“ä¸­è§£è€¦\n* æŠ½è±¡å·¥å‚å¯ä»¥è®©å¯¹è±¡åˆ›å»ºæ›´å®¹æ˜“è¢«è¿½è¸ª\n* åŒæ—¶å°†å¯¹è±¡åˆ›å»ºä¸ä½¿ç”¨è§£è€¦\n* ä¹Ÿå¯ä»¥ä¼˜åŒ–å†…å­˜å ç”¨æå‡åº”ç”¨æ€§èƒ½\n\n#### ç¼ºç‚¹\n\nå› ä¸ºæŠ½è±¡å·¥å‚æ˜¯å°†ä¸€ç»„ç›¸å…³çš„äº§å“é›†åˆèµ·æ¥ï¼Œå¦‚æœéœ€è¦æ‰©å±•è¿™ç»„äº§å“ï¼Œå°±éœ€è¦`æ”¹å˜æ¥å£`ï¼Œè€Œæ”¹å˜æ¥å£åˆ™æ„å‘³ç€éœ€è¦æ”¹å˜`æ¯ä¸ªå­ç±»çš„æ¥å£`\n\n\n## å‚è€ƒé“¾æ¥\n\n* [pythonè®¾è®¡æ¨¡å¼ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼](https://mp.weixin.qq.com/s/3HtKVCzPOmuk5uFpfoBsqA)\n* [python-design-patter-abstract-factory.py https://gist.github.com/gusibi/5e0797f5458678322486f999ca87a180](https://gist.github.com/gusibi/5e0797f5458678322486f999ca87a180)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-æŠ½è±¡å·¥å‚æ¨¡å¼",
        "date": "2017-10-28 13:23:56",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-abstract-factory"
    },
    {
      "content": "\næœ€è¿‘åšå°ç¨‹åºæœåŠ¡å™¨çš„é…ç½®ï¼Œè¿™ä¸€ç¯‡æ˜¯æœåŠ¡å™¨é…ç½®çš„è®°å½•ï¼Œæ–¹ä¾¿ä»¥åå®‰è£…é…ç½®ã€‚\n\n## è´­ä¹°æœåŠ¡å™¨\n\nä¹‹æ‰€ä»¥é€‰è…¾è®¯äº‘çš„åŸå› å¾ˆç®€å•ï¼Œé‚£å°±æ˜¯ä¾¿å®œï¼Œ`é€‰ç”¨æˆéƒ½åŒº`ï¼Œæœ€ä½é…ç½®æ¯æœˆåªéœ€29ï¿¥ã€‚\nåœ¨ [è…¾è®¯äº‘](https://cloud.tencent.com) å®˜ç½‘æ³¨å†Œç™»å½•å°±å¯ä»¥ç›´æ¥è´­ä¹°æœåŠ¡å™¨äº†ã€‚\næœåŠ¡å™¨ç³»ç»Ÿæˆ‘é€‰æ‹©çš„æ˜¯ ubuntuã€‚\n\n## æœåŠ¡å™¨é…ç½®\n\nå¯åŠ¨æœåŠ¡åä½¿ç”¨æ–°ç”¨æˆ·ï¼ˆæ­¤æ­¥éª¤ä¸æ˜¯å¿…é¡»ï¼‰ã€‚\n\n### æ–°å»ºç”¨æˆ·\n\né¦–å…ˆç¡®è®¤ä½¿ç”¨çš„æ˜¯ root ç”¨æˆ·ç™»å½•å¦‚æœä¸æ˜¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢\n\n```bash\nsudo su\n```\nä½¿ç”¨ `adduser` å‘½ä»¤åˆ›å»ºç”¨æˆ·\n```bash\nadduser username # usernameæ›¿æ¢ä¸ºä½ è‡ªå·±çš„ç”¨æˆ·å\n```\n\næ¥ä¸‹æ¥çš„æ­¥éª¤ä¼šè®©ä½ è¾“å…¥å¯†ç å’Œä¸ªäººä¿¡æ¯ï¼Œè‡ªå·±è®¾ç½®å°±å¥½ã€‚\n\nä½¿ç”¨`usermod` å‘½ä»¤å°†æ–°å»ºçš„ç”¨æˆ·æ·»åŠ åˆ° `sudo` ç»„ã€‚\n\n```go\nusermod -aG sudo username\n```\n\n### å…³é—­sshå¯†ç ç™»å½•ä½¿ç”¨å¯†é’¥ç™»å½•\n\n#### å®‰è£…openssh\n\nå› ä¸ºæ˜¯æ–°ç³»ç»Ÿï¼Œå…ˆæ‰§è¡Œä¸€ä¸‹ apt-get update\n\n```bash\nsudo apt-get update\nsudo apt-get install openssh-server\n```\n\n#### å¯åŠ¨sshæœåŠ¡\n\nå¯ä»¥é€šè¿‡sudo suå‘½ä»¤æ¥ä¸´æ—¶åˆ‡æ¢åˆ°rootæƒé™(ä¸æ˜¯æ‰€æœ‰çš„è´¦å·éƒ½å¯ä»¥åˆ‡æ¢åˆ°rootæƒé™,åªæœ‰åœ¨/etc/sudoersæ–‡ä»¶ä¸­ç¬¦åˆè§„åˆ™çš„ç”¨æˆ·èƒ½åˆ‡æ¢rootèº«ä»½)\n\n```bash\nsudo su\n/etc/init.d/ssh start\n```\n\n#### ä½¿ç”¨å¯†é’¥ç™»å½•\n\n* æœåŠ¡å™¨ç«¯ç”Ÿæˆå¯†é’¥å¯¹ï¼š\n\n```bash\ncd /home/gs # æ‰“å¼€æ–°å»ºçš„ç”¨æˆ·ç›®å½•\nmkdir .ssh\ncd .ssh\nssh-keygen -b 2048 -t rsa\n```\n\n> ssh-keygençš„åŸºæœ¬ç”¨æ³•ï¼š\n-båé¢æ˜¯æŒ‡å®šåŠ å¯†åçš„å­—ç¬¦ä¸²é•¿åº¦\n-tåé¢æ˜¯æŒ‡å®šåŠ å¯†ç®—æ³•ï¼Œå¸¸ç”¨çš„åŠ å¯†ç®—æ³•æœ‰rsa,dsaç­‰\n\né»˜è®¤ç”Ÿæˆçš„æ–‡ä»¶å¦‚ä¸‹ï¼š\n\n``` bash\nid_rsa.pub  # å…¬é’¥æ–‡ä»¶\nid_rsa      # ç§é’¥æ–‡ä»¶\n```\n\n* æ–°å»º authorized_keys æ–‡ä»¶\n\nå°†æœ¬åœ°æœºå™¨çš„ id_rsa.pub æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ° authorized_keys æ–‡ä»¶\n\n* æµ‹è¯•ä½¿ç”¨å…¬é’¥æ˜¯å¦å¯ä»¥ç™»å½•\n\n```bash\nssh name@host  # name æ˜¯æœºå™¨çš„ç”¨æˆ·å host æ˜¯æœºå™¨çš„åœ°å€\n```\n\n#### å…³é—­sshå¯†ç ç™»å½•\n\nç¡®è®¤å¯ä»¥é€šè¿‡ç§é’¥è¿›è¡Œç™»å½•åï¼Œå…³é—­sshå¯†ç ç™»å½•ã€‚\n\n```bash\nsudo su\nvim /etc/ssh/sshd_config\n```\n\nå°† PasswordAuthentication yesä¿®æ”¹æˆPasswordAuthentication no\n\né‡å¯ç³»ç»Ÿ\n\n```bash\nsudo su\nreboot\n```\n\n## æ­å»ºå¼€å‘ç¯å¢ƒ\n\n### å®‰è£… zsh\n\nåœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸‹é¢å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š\n\n```bash\nsudo apt-get install zsh\n```\n\nè¾“å…¥ä¸‹é¢å‘½ä»¤è¿›è¡Œæ›¿æ¢zshæ›¿æ¢ä¸ºä½ çš„é»˜è®¤shellï¼š\n\n```bash\nchsh -s /bin/zsh\n```\n\né‡å¯ç»ˆç«¯ä½¿ç”¨ zsh\n\n### å®‰è£…oh-my-zsh\n\n* é€šè¿‡curlå®‰è£…\n\n```bash\ncurl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh\n```\n\n* é€šè¿‡wgetå®‰è£…\n\n```bash\nwget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O - | sh\n```\n\n### å®‰è£… pip\n\n```bash\nsudo apt-get install python-pip  # å®‰è£… pip\npip install --upgrade pip\nsudo apt-get install python3-pip  # å®‰è£… pip3\npip3 install --upgrade pip\n```\n\n### å®‰è£… virtualenv\n\nå› ä¸ºæˆ‘ä½¿ç”¨ python3 ä½œä¸ºå¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ `pip3`\n```bash\nsudo pip3 install virtualenv\nsudo pip3 install virtualenvwrapper\n```\n\nåœ¨ .zshrc æ·»åŠ ä»¥ä¸‹å†…å®¹\n```bash\nexport VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3\nexport WORKON_HOME=$HOME/.virtualenvs\nsource /usr/local/bin/virtualenvwrapper.sh\n```\nç„¶åæ‰§è¡Œå‘½ä»¤ï¼š\n\n```bash\nsource .zshrc\n```\n\nç°åœ¨å¯ä»¥è¾“å…¥ `workon` æµ‹è¯• virtualenvwrapper æ˜¯å¦å·²ç»å®‰è£…æˆåŠŸã€‚\n\n#### åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ\n\n```bash\nmkvirtualenv py3 -p python3  # -p å‚æ•°æŒ‡å®š python ç‰ˆæœ¬\n```\n\næµ‹è¯•è™šæ‹Ÿç¯å¢ƒ\n\n```bash\nworkon py3\n```\n\n### å®‰è£… ipython\n\né¦–å…ˆè¿›å…¥ py3 è™šæ‹Ÿç¯å¢ƒ\n\n```bash\nworkon py3\n```\nä½¿ç”¨ pip å®‰è£… ipython\n\n```bash\npip install ipython # å®‰è£… ipython \n```\n### é…ç½® vim\n\n python vim é…ç½®ä½¿ç”¨çš„æ˜¯ [py-vim](https://github.com/gusibi/py-vim)\n\néœ€è¦å…ˆå®‰è£… ctagså’Œ cmake\n\n```bash\nsudo apt-get install ctags\nsudo apt-get install cmake\n```\n\nç„¶åå°† py-vim clone åˆ°æœåŠ¡å™¨\n\n```bash\ngit clone https://github.com/gusibi/py-vim\ncd py-vim\nsh setup.sh \n```\n\n## ä½¿ç”¨ Caddy é…ç½® https\n\n> Caddyæ˜¯ä¸€ç§æ–°çš„WebæœåŠ¡å™¨ï¼Œç”± go ç¼–å†™ï¼Œé»˜è®¤ä½¿ç”¨ https åè®®ã€‚caddy é…ç½®ç®€å•ï¼Œå®¹æ˜“ä¸Šæ‰‹ã€‚\n\n### å®‰è£… caddy äºŒè¿›åˆ¶æ–‡ä»¶\n\nCaddyé¡¹ç›®æä¾›äº†ä¸€ä¸ªå®‰è£…è„šæœ¬ï¼Œå¯ä»¥æ£€ç´¢å’Œå®‰è£…CaddyæœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç›´æ¥å®‰è£…ï¼š\n\n```bash\ncurl -s https://getcaddy.com | bash\n```\n\nåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œè„šæœ¬å°†ä½¿ç”¨sudoè·å–ç®¡ç†æƒé™ï¼Œä»¥ä¾¿å°†Caddyæ–‡ä»¶æ”¾åœ¨ç³»ç»ŸèŒƒå›´çš„ç›®å½•ä¸­ï¼Œå› æ­¤å¯èƒ½ä¼šæç¤ºæ‚¨è¾“å…¥å¯†ç ã€‚\n\n### é…ç½® caddy å¿…è¦çš„ç›®å½•\n\nCaddyçš„è‡ªåŠ¨TLSæ”¯æŒå’Œunitæ–‡ä»¶éœ€è¦ç‰¹å®šçš„ç›®å½•å’Œæ–‡ä»¶æƒé™ã€‚ æˆ‘ä»¬å°†åœ¨è¿™ä¸€æ­¥ä¸­åˆ›å»ºå®ƒä»¬ã€‚\n\né¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œè¯¥ç›®å½•å°†å®¹çº³ä¸»è¦çš„é…ç½®æ–‡ä»¶Caddyfile ã€‚\n\n```bash\n# åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œè¯¥ç›®å½•å°†å®¹çº³ä¸»è¦çš„é…ç½®æ–‡ä»¶Caddyfile\nsudo mkdir /etc/caddy\n# å°†æ­¤ç›®å½•çš„æ‰€æœ‰è€…æ›´æ”¹ä¸ºrootç”¨æˆ·åŠå…¶ç»„åˆ°www-data ï¼Œä»¥ä¾¿Caddyå¯ä»¥è¯»å–å®ƒ\nsudo chown -R root:www-data /etc/caddy\n# åˆ›å»ºä¸€ä¸ªç©ºçš„Caddyfile\nsudo touch /etc/caddy/Caddyfile\n# åœ¨/etc/sslåˆ›å»ºå¦ä¸€ä¸ªç›®å½•ç”¨æ¥å­˜å‚¨è‡ªåŠ¨è·å¾—çš„SSLç§é’¥å’Œè¯ä¹¦\nsudo mkdir /etc/ssl/caddy\n# å°†æ­¤ç›®å½•çš„æ‰€æœ‰è€…æ›´æ”¹ä¸ºrootç”¨æˆ·åŠå…¶ç»„åˆ°www-data\nsudo chown -R www-data:root /etc/ssl/caddy\n# ç¡®ä¿æ²¡æœ‰äººå¯ä»¥é€šè¿‡åˆ é™¤å…¶ä»–äººçš„æ‰€æœ‰è®¿é—®æƒé™æ¥è¯»å–è¿™äº›æ–‡ä»¶ã€‚\nsudo chmod 0770 /etc/ssl/caddy\n# åˆ›å»ºçš„æœ€ç»ˆç›®å½•æ˜¯ç½‘ç«™çš„å‘å¸ƒç›®å½•\nsudo mkdir /var/www\n# è¯¥ç›®å½•åº”ç”±www-dataå®Œå…¨æ‹¥æœ‰ã€‚\nsudo chown www-data:www-data /var/www\n# åˆ›å»ºæ—¥å¿—ç›®å½•\nsudo mkdir /var/log/caddy\n# å°†æ­¤ç›®å½•çš„æ‰€æœ‰è€…æ›´æ”¹ä¸ºrootç”¨æˆ·åŠå…¶ç»„åˆ°www-data\nsudo chown -R www-data:root /var/log/caddy\n```\n\n### å°† caddy é…ç½®ä¸ºç³»ç»ŸæœåŠ¡\n\nä»å®˜æ–¹çš„Caddyå­˜å‚¨åº“ä¸‹è½½æ–‡ä»¶ã€‚ curlå‘½ä»¤çš„é™„åŠ -oå‚æ•°ä¼šå°†è¯¥æ–‡ä»¶ä¿å­˜åœ¨/etc/systemd/system/ç›®å½•ä¸­ï¼Œå¹¶ä½¿å…¶å¯¹systemdå¯è§ã€‚\n\n```bash\nsudo curl -s https://raw.githubusercontent.com/mholt/caddy/master/dist/init/linux-systemd/caddy.service -o /etc/systemd/system/caddy.service\n```\n\nreload ç³»ç»ŸæœåŠ¡\n\n```bash\nsudo systemctl daemon-reload\n```\nå°†caddy è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨\n```bash\nsudo systemctl enable caddy.service\n```\næ£€æŸ¥ caddy æœåŠ¡æ˜¯å¦å·²æ­£å¼åŠ è½½\n```bash\nsudo systemctl status caddy.service\n```\n\n### å…è®¸HTTPå’ŒHTTPSè¿æ¥\n\nCaddyä½¿ç”¨HTTPå’ŒHTTPSåè®®æä¾›ç½‘ç«™ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…è®¸è®¿é—®ç›¸åº”çš„ç«¯å£ï¼Œä»¥ä¾¿ä½¿ç½‘è·¯å¯ä»¥ä»ç½‘è·¯è·å–\n\n```bash\nsudo ufw allow http\nsudo ufw allow https\n```\n\nç°åœ¨ä¿®æ”¹caddy é…ç½® /etc/caddy/Caddyfile\n\n```bash\nhttps://your.domain {  # å¯ç”¨ https\n    gzip\n    log /var/log/caddy/access.log  # æŒ‡å®šæ—¥å¿—ç›®å½•\n    proxy / http://127.0.0.1:8888 {\n        header_upstream Host {host}\n        header_upstream X-Real-IP {remote}\n        header_upstream X-Forwarded-For {remote}\n        header_upstream X-Forwarded-Proto {scheme}\n    }\n}\n```\n\nä¿å­˜æ–‡ä»¶ï¼Œå¯åŠ¨ caddy\n\n```bash\nsudo systemctl start caddy    # å¯åŠ¨ caddy\nsudo systemctl restart caddy  # é‡å¯ caddy\nsudo systemctl stop caddy     # å…³é—­ caddy\n```\n\nç°åœ¨å¯åŠ¨æœåŠ¡ï¼Œè®¿é—® `https://your.domain` åº”è¯¥å°±èƒ½çœ‹åˆ°æ•°æ®ã€‚\næ—¥å¿—æ–‡ä»¶åœ¨ `/var/log/caddy/` ç›®å½•ä¸‹ã€‚\n\n## æ€»ç»“\n\nå°ç¨‹åºå¼€å‘éœ€è¦ httpsï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† caddy ä½œä¸º web æœåŠ¡å™¨ã€‚æœåŠ¡å™¨é…ç½®å¥½åå¯ä»¥ç›´æ¥å­˜å‚¨ä¸ºé•œåƒï¼Œä»¥åå¯ä»¥ç›´æ¥ä»é•œåƒå¼€å¯æœåŠ¡ï¼Œå°±ä¸å†éœ€è¦é…ç½®ç¯å¢ƒã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [How To Create a Sudo User on Ubuntu ](https://www.digitalocean.com/community/tutorials/how-to-create-a-sudo-user-on-ubuntu-quickstart)\n* [zshå®‰è£…å’Œé…ç½®](http://blog.csdn.net/ii1245712564/article/details/45843657)\n* [virtualenvwrapper](https://virtualenvwrapper.readthedocs.io/en/latest/)\n* [py-vim](https://github.com/gusibi/py-vim)\n* [Install MongoDB Community Edition on Ubuntu](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/)\n* [ä½¿ç”¨ Caddy æ›¿ä»£ Nginxï¼Œå…¨ç«™å‡çº§ httpsï¼Œé…ç½®æ›´åŠ ç®€å•](https://zhuanlan.zhihu.com/p/26839519)\n* [how-to-host-a-website-with-caddy-on-ubuntu-16-04](https://www.digitalocean.com/community/tutorials/how-to-host-a-website-with-caddy-on-ubuntu-16-04)\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "ä½¿ç”¨è…¾è®¯äº‘é…ç½®å°ç¨‹åºPythonå¼€å‘ç¯å¢ƒ",
        "date": "2017-10-21 14:11:35",
        "tags": [
          "development",
          "å°ç¨‹åº",
          "åç«¯",
          "tutorial"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "wxapp-server-config"
    },
    {
      "content": "\n> `é¢˜ç›®`ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ª pizza åº—ï¼ŒåŠŸèƒ½åŒ…æ‹¬`ä¸‹è®¢å•`ã€`åš pizza`ï¼Œä½ çš„ä»£ç ä¼šå¦‚ä½•å†™å‘¢ï¼Ÿ\n\n```python\ndef order_pizza():\n    pizza = Pizza()\n    pizza.prepare()\n    pizza.bake()\n    pizza.cut()\n    pizza.box()\n    return pizza\n```\n\nä½†æ˜¯ç°åœ¨ä½ é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä½ çš„ pizza åº—éœ€è¦æ›´å¤šçš„ pizzaï¼Œæ‰€ä»¥ç°åœ¨ä½ éœ€è¦å¢åŠ ä¸€äº›ä»£ç ï¼Œæ¥å†³å®šé€‚åˆçš„ pizza ç±»å‹ï¼Œç„¶åå†åˆ¶é€ è¿™ä¸ª pizzaï¼š\n\n```python\ndef order_pizza(pizza_type):  # ç°åœ¨æŠŠ pizza çš„ç±»å‹ä¼ å…¥ order_pizza()\n\n    # æ ¹æ® pizza ç±»å‹ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–æ­£ç¡®çš„å…·ä½“ç±»ï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ pizza å®ä¾‹å˜é‡\n    if pizza_type == 'cheese':\n        pizza = CheesePizza()\n    elif pizza_type == 'greek':\n        pizza = GreekPizza()\n    elif pizza_type == 'pepperoni':\n        pizza = PepperoniPizza()\n    # ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª pizzaï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’\n    pizza.prepare()\n    pizza.bake()\n    pizza.cut()\n    pizza.box()\n    return pizza\n```\n\nä½†æ˜¯ç»è¿‡å‡ å¤©çš„å®è·µï¼Œä½ å‘ç°é¡¾å®¢å–œæ¬¢ç‚¹çš„ ClamPizzaã€Veggie Pizza è€Œ Greek pizza å¹¶æ²¡æœ‰ä»€ä¹ˆäººå–œæ¬¢ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä¿®æ”¹ä»£ç ï¼š\n\n```python\ndef order_pizza(pizza_type):  # ç°åœ¨æŠŠ pizza çš„ç±»å‹ä¼ å…¥ order_pizza()\n\n    # æ ¹æ® pizza ç±»å‹ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–æ­£ç¡®çš„å…·ä½“ç±»ï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ pizza å®ä¾‹å˜é‡\n    if pizza_type == 'cheese':\n        pizza = CheesePizza()\n    # elif pizza_type == 'greek':  # greek pizza ä¸å†å‡ºç°åœ¨èœå•\n    #     pizza = GreekPizza()\n    elif pizza_type == 'pepperoni':\n        pizza = PepperoniPizza()\n    # æ–°åŠ äº† clam pizza å’Œ veggie pizza\n    elif pizza_type == 'clam':\n        pizza = ClamPizza()\n    elif pizza_type == 'veggie':\n        pizza = VeggiePizza()\n\n    #  ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª pizzaï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’\n    pizza.prepare()\n    pizza.bake()\n    pizza.cut()\n    pizza.box()\n    return pizza\n```\n\nç°åœ¨ä½ å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œ order_pizza() æ˜¯åœ¨å†…éƒ¨å®ä¾‹åŒ–äº†å…·ä½“çš„ `Pizza ç±»`ï¼Œå¹¶ä¸”ï¼Œorder_pizza() ä¹Ÿæ²¡æœ‰å¯¹ä¿®æ”¹å…³é—­ï¼Œä»¥è‡³äºæ¯æ¬¡æœ‰äº†æ–°çš„ pizza åŠ å…¥éƒ½è¦ä¿®æ”¹ order_pizza() çš„ä»£ç ã€‚è¿™æ—¶ä¸€ä¸ªæ¯”è¾ƒå¥½çš„åŠæ³•æ˜¯æŠŠåˆ›å»º Pizza å¯¹è±¡æ˜¯æŠ½è±¡å‡ºæ¥ï¼Œä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š\n\n```python\n# æŠŠåˆ›å»ºå¯¹è±¡çš„ä»£ç ä» order_pizza æ–¹æ³•ä¸­æŠ½ç¦»\ndef create_pizza(pizza_type):\n    # æ ¹æ® pizza ç±»å‹ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–æ­£ç¡®çš„å…·ä½“ç±»ï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ pizza å®ä¾‹å˜é‡\n    if pizza_type == 'cheese':\n        pizza = CheesePizza()\n    elif pizza_type == 'pepperoni':\n        pizza = PepperoniPizza()\n    elif pizza_type == 'clam':\n        pizza = ClamPizza()\n    elif pizza_type == 'veggie':\n        pizza = VeggiePizza()\n    return pizza\n\ndef order_pizza(pizza_type):  # ç°åœ¨æŠŠ pizza çš„ç±»å‹ä¼ å…¥ order_pizza()\n    # è¿™é‡Œä½¿ç”¨ create_pizza() æ–¹æ³•åˆ›å»º pizza ç±»\n    pizza = create_pizza(pizza_type)\n\n    #  ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª pizzaï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’\n    pizza.prepare()\n    pizza.bake()\n    pizza.cut()\n    pizza.box()\n    return pizza\n```\n\n## ç®€å•å·¥å‚æ¨¡å¼\n\næˆ‘ä»¬æŠŠåˆ›å»º pizza å¯¹è±¡çš„ä»£ç æå–åˆ°ä¸€ä¸ªæ–°çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ–°çš„æ–¹æ³•å«åš`å·¥å‚`ã€‚\n\n> `å·¥å‚`å¤„ç†åˆ›å»ºå¯¹è±¡çš„ç»†èŠ‚ï¼Œä¸€æ—¦æœ‰äº†`create_pizza`ï¼Œ`order_pizza()` å°±æˆäº†æ­¤å¯¹è±¡çš„å®¢æˆ·ã€‚å½“éœ€è¦ pizza æ—¶ï¼Œåªéœ€è¦å‘Šè¯‰å·¥å‚éœ€è¦ä»€ä¹ˆç±»å‹çš„ pizzaï¼Œè®©å®ƒåšä¸€ä¸ªå³å¯ã€‚\n\nç°åœ¨ order_pizza() æ–¹æ³•åªå…³å¿ƒä»å·¥å‚å¾—åˆ°ä¸€ä¸ª pizzaï¼Œè¿™ä¸ª pizza å®ç°äº† Pizza çš„æ¥å£ï¼Œæ‰€ä»¥å®ƒå¯ä»¥è°ƒç”¨ `prepare()ï¼ˆå‡†å¤‡ï¼‰`ã€`bake()ï¼ˆçƒ˜çƒ¤ï¼‰`ã€`cut()ï¼ˆåˆ‡ç‰‡ï¼‰`ã€`box()ï¼ˆè£…ç›’ï¼‰`\n\n> `é—®ï¼š`ç°åœ¨ä½ å¯èƒ½ä¼šé—®ï¼Œè¿™æ®µä»£ç çœ‹ä¸Šå»æ›´å¤æ‚äº†ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„äº†å‘¢ï¼Ÿçœ‹ä¸Šå»åªæ˜¯æŠŠé—®é¢˜æ¬åˆ°å¦ä¸€ä¸ªå¯¹è±¡äº†ã€‚\n`ç­”ï¼š` ç°åœ¨çœ‹æ¥ï¼Œorder_pizza åªæ˜¯`create_pizza` çš„ä¸€ä¸ªå®¢æˆ·ï¼Œå…¶å®ƒå®¢æˆ·ï¼ˆæ¯”å¦‚pizza åº—èœå• PizzaShopMenuï¼‰ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å‚æ¥å–å¾— pizzaã€‚æŠŠåˆ›å»º pizza çš„ä»£ç åŒ…è£…è¿›ä¸€ä¸ªç±»ï¼Œå½“ä»¥åå®ç°ä¿®æ”¹æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹è¿™ä¸ªéƒ¨åˆ†ä»£ç å³å¯ã€‚\n\nè¿™é‡Œæˆ‘ä»¬çš„å·¥å‚`create_order()` æ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œåˆ©ç”¨æ–¹æ³•å®šä¹‰ä¸€ä¸ªç®€å•å·¥å‚çš„æ–¹æ³•é€šå¸¸è¢«ç§°ä¸º`ç®€å•å·¥å‚æ¨¡å¼`ï¼ˆ`ç®€å•å·¥å‚`æ›´åƒæ˜¯ä¸€ä¸­ç¼–ç¨‹ä¹ æƒ¯è€Œä¸æ˜¯è®¾è®¡æ¨¡å¼ï¼‰ã€‚\n\n### é‡åš PizzaStore ç±»\n\nä¸Šè¾¹çš„ä»£ç ä¸­ï¼Œ`order_pizza` æ˜¯å®¢æˆ·ä»£ç ï¼Œä½†æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„ pizza åº—æœ‰æ›´å¥½çš„æ‰©å±•æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æŠŠå®¢æˆ·ä»£ç åšä¸€ä¸‹ä¿®æ”¹ï¼š\n\n```python\nclass SimplePizzaFactory:\n\n    def create_pizza(self, pizza_type):\n        ...\n        return pizza\n\nclass PizzaStore:\n    def order_pizza(self, pizza_type):  # ç°åœ¨æŠŠ pizza çš„ç±»å‹ä¼ å…¥ order_pizza()\n        factory = SimplePizzaFactory()\n        pizza = factory.create_pizza(pizza_type)\n        ...\n        return pizza\n    \n    # ä¸‹è¾¹æ˜¯å…¶ä»–å¯èƒ½ç”¨åˆ°çš„æ–¹æ³•\n```\n\nè¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ªæ–¹æ³•ï¼ˆcreate_pizzaï¼‰ä½¿ç”¨ç±»ï¼ˆSimplePizzaFactoryï¼‰å°è£…äº†èµ·æ¥ï¼Œç›®çš„æ˜¯ä½¿å·¥å‚å¯ä»¥`é€šè¿‡ç»§æ‰¿æ¥æ”¹å˜åˆ›å»ºæ–¹æ³•çš„è¡Œä¸º`ï¼Œå¹¶ä¸”è¿™æ ·åšï¼Œä¹Ÿå¯ä»¥æé«˜å·¥å‚æ–¹æ³•çš„æ‰©å±•æ€§ã€‚\n\nç°åœ¨æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬ pizza åº—çš„ç±»å›¾ï¼š\n\n![pizzaåº—ç±»å›¾](http://media.gusibi.mobi/6DtG1bIO_WXNiv0cdjgTA6UP7rze9-4XY7jKkrrwA43Gtx5eHEwkKNGqvQtWs8NM)\n\n### ç®€å•å·¥å‚æ¨¡å¼çš„å±€é™\n\n#### ç¼ºç‚¹\n\n* ç”±äºå·¥å‚ç±»é›†ä¸­äº†æ‰€æœ‰äº§å“åˆ›å»ºé€»è¾‘ï¼Œè¿åäº†é«˜å†…èšè´£ä»»åˆ†é…åŸåˆ™ï¼Œä¸€æ—¦ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæ•´ä¸ªç³»ç»Ÿéƒ½è¦å—åˆ°å½±å“ã€‚\n* ç³»ç»Ÿæ‰©å±•å›°éš¾ï¼Œä¸€æ—¦æ·»åŠ æ–°äº§å“å°±ä¸å¾—ä¸ä¿®æ”¹å·¥å‚é€»è¾‘ï¼Œåœ¨äº§å“ç±»å‹è¾ƒå¤šæ—¶ï¼Œæœ‰å¯èƒ½é€ æˆå·¥å‚é€»è¾‘è¿‡äºå¤æ‚ï¼Œä¸åˆ©äºç³»ç»Ÿçš„æ‰©å±•å’Œç»´æŠ¤ã€‚\n\n#### ä½¿ç”¨åœºæ™¯\n\n* å·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡è¾ƒå°‘\n* å®¢æˆ·åªçŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼ˆé€»è¾‘ï¼‰ä¸å…³å¿ƒï¼›å®¢æˆ·ç«¯æ—¢ä¸éœ€è¦å…³å¿ƒåˆ›å»ºç»†èŠ‚ï¼Œç”šè‡³è¿ç±»åéƒ½ä¸éœ€è¦è®°ä½ï¼Œåªéœ€è¦çŸ¥é“ç±»å‹æ‰€å¯¹åº”çš„å‚æ•°ã€‚\n\nä¸ºäº†çªç ´è¿™äº›å±€é™ï¼Œæˆ‘ä»¬æ¥ç€çœ‹ä¸€ä¸‹`å·¥å‚æ–¹æ³•æ¨¡å¼`\n\n## å·¥å‚æ–¹æ³•æ¨¡å¼\n\n> ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œæˆ‘ä»¬åˆ›å»º pizza åº—åï¼Œç°åœ¨æœ‰äººæƒ³è¦åŠ ç›Ÿï¼Œä½†æˆ‘ä»¬è¿˜æƒ³è¦æ§åˆ¶ä¸€ä¸‹ pizza çš„åˆ¶ä½œæµç¨‹ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ\n\né¦–å…ˆï¼Œè¦ç»™ pizza åº—ä½¿ç”¨æ¡†æ¶ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯æŠŠ`create_pizza()`æ–¹æ³•æ”¾å›åˆ°`PizzaStore`ç±»ä¸­ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨æ¯ä¸ªå­ç±»ä¸­å€’è¦å®ç°ä¸€æ¬¡ã€‚ç°åœ¨ `PizzaStore`ä»£ç ä¸ºï¼š\n\n```python\nclass PizzaStore:\n\n    def create_pizza(self, pizza_type):\n        # æ¯ä¸ªéœ€è¦å­ç±»å®ç°çš„æ–¹æ³•éƒ½ä¼šæŠ›å‡ºNotImplementedError\n        # æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ PizzaStore çš„ metaclass è®¾ç½®æˆ abc.ABCMeta\n        # è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªç±»å°±æ˜¯çœŸæ­£çš„æŠ½è±¡åŸºç±»\n        raise NotImplementedError()\n\n    def order_pizza(self, pizza_type):  # ç°åœ¨æŠŠ pizza çš„ç±»å‹ä¼ å…¥ order_pizza()\n\n        pizza = self.create_pizza(pizza_type)\n\n        #  ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª pizzaï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’\n        pizza.prepare()\n        pizza.bake()\n        pizza.cut()\n        pizza.box()\n        return pizza\n```\nè¿™æ ·æˆ‘ä»¬å°±å£°æ˜äº†ä¸€ä¸ªå·¥å‚æ–¹æ³•ã€‚è¿™ä¸ªå·¥å‚æ–¹æ³•ç”¨æ¥å¤„ç†å¯¹è±¡çš„åˆ›å»ºï¼Œå¹¶å°†è¿™ä¸ªåˆ›å»ºè¡Œä¸ºå°è£…åœ¨å­ç±»ä¸­ï¼Œè¿™æ ·å®¢æˆ·ç¨‹åºä¸­å…³äºçˆ¶ç±»çš„ä»£ç å°±å’Œå­ç±»çš„å¯¹è±¡åˆ›å»ºä»£ç è§£è€¦æˆåŠŸã€‚\n\næˆ‘ä»¬å°† create_pizza æ”¾å› PizzaStore çš„ç›®çš„æ˜¯è®©ç»§æ‰¿æ­¤æ–¹æ³•çš„å­ç±»è´Ÿè´£å®šä¹‰è‡ªå·±çš„`create_pizza()` æ–¹æ³•ã€‚ç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹PizzaStore çš„å­ç±»ç¤ºæ„å›¾ï¼š\n\n![](http://media.gusibi.mobi/tca7Q3e78ijKMLm2vfUvrvR5FiVLM7rBvv6DZ402NsxAkgcUc8xEPsjCvnZALnxK)\n\nè¿™é‡Œ `NYStlyePizzaStore` å’Œ `ChicagoStylePizzaStore` éœ€è¦åˆ†åˆ«å®šä¹‰è‡ªå·±çš„ `create_pizza` æ–¹æ³•ã€‚\n\nç°åœ¨æ¥çœ‹ä¸‹å®Œæ•´ä»£ç ï¼š\n\n```python\n#! -*- coding: utf-8 -*-\n\nclass Pizza:\n\n    name = None\n    dough = None\n    sauce = None\n    toppings = []\n\n    def prepare(self):\n        print(\"Preparing %s\" % self.name)\n        print(\"Tossing dough...\")\n        print(\"Adding sauce...\")\n        print(\"Adding toppings: \")\n        for topping in self.toppings:\n            print(\"  %s\" % topping)\n\n    def bake(self):\n        print(\"Bake for 25 minutes at 350\")\n\n    def cut(self):\n        print(\"Cutting the pizza into diagonal slices\")\n\n    def box(self):\n        print(\"Place pizza in official PizzaStore box\")\n\n    def __str__(self):\n        return self.name\n\n\nclass NYStyleCheesePizza(Pizza):\n\n    name = \"NY Style Sauce and Cheese Pizza\"\n    dough = \"Thin Crust Dough\"\n    sauce = \"Marinara Sauce\"\n    toppings = [\"Grated\", \"Reggiano\", \"Cheese\"]\n\n\nclass ChicagoStyleCheesePizza(Pizza):\n\n    name = \"Chicago Style Deep Dish Cheese Pizza\"\n    dough = \"Extra Thick Crust Dough\"\n    sauce = \"Plum Tomato Sauce\"\n    toppings = [\"Shredded\", \"Mozzarella\", \"Cheese\"]\n\n    def cut(self):\n        print(\"Cutting the pizza into square slices\")\n\n\nclass PizzaStore:\n    def create_pizza(self, pizza_type):\n        # æ¯ä¸ªéœ€è¦å­ç±»å®ç°çš„æ–¹æ³•éƒ½ä¼šæŠ›å‡ºNotImplementedError\n        # æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ PizzaStore çš„ metaclass è®¾ç½®æˆ abc.ABCMeta\n        # è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªç±»å°±æ˜¯çœŸæ­£çš„æŠ½è±¡åŸºç±»\n        raise NotImplementedError()\n\n    def order_pizza(self, pizza_type):  # ç°åœ¨æŠŠ pizza çš„ç±»å‹ä¼ å…¥ order_pizza()\n\n        pizza = self.create_pizza(pizza_type)\n\n        #  ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª pizzaï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼ˆæ“€é¢çš®ã€åŠ ä½æ–™ï¼‰ï¼Œç„¶åçƒ˜çƒ¤ã€åˆ‡ç‰‡ã€è£…ç›’\n        pizza.prepare()\n        pizza.bake()\n        pizza.cut()\n        pizza.box()\n        return pizza\n\nclass NYStylePizzStore(PizzaStore):\n    def create_pizza(self, pizza_type):\n        # æ ¹æ® pizza ç±»å‹ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–æ­£ç¡®çš„å…·ä½“ç±»ï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ pizza å®ä¾‹å˜é‡\n        if pizza_type == 'cheese':\n            pizza = NYStyleCheesePizza()\n        return pizza\n\n\nclass ChicagoStylePizzaStore(PizzaStore):\n    def create_pizza(self, pizza_type):\n        # æ ¹æ® pizza ç±»å‹ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–æ­£ç¡®çš„å…·ä½“ç±»ï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ pizza å®ä¾‹å˜é‡\n        if pizza_type == 'cheese':\n            pizza = ChicagoStyleCheesePizza()\n        return pizza\n\n\ndef main():\n    nystore = NYStylePizzStore()\n    pizza = nystore.order_pizza('cheese')\n    print(\"goodspeed ordered a %s\" % pizza)\n\n    print(\"*\" * 100)\n    chicago_store = ChicagoStylePizzaStore()\n    pizza = chicago_store.order_pizza('cheese')\n    print(\"goodspeed ordered a %s\" % pizza)\n\n\nif __name__ == '__main__':\n    main()\n```\nè¿™é‡Œå·¥å‚æ–¹æ³• create_pizza() ç›´æ¥æŠ›å‡ºäº†`NotImplementedError`ï¼Œè¿™æ ·åšäº‹ä¸ºäº†å¼ºåˆ¶å­ç±»é‡æ–°å®ç° create_pizza() æ–¹æ³•ï¼Œå¦‚æœä¸é‡æ–°å®ç°å°±ä¼šæŠ›å‡º`NotImplementedError`ã€‚\nå½“ç„¶ä¹Ÿå¯ä»¥æŠŠ PizzaStore çš„ `metaclass` è®¾ç½®æˆ `abc.ABCMeta` è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªç±»å°±æ˜¯çœŸæ­£çš„æŠ½è±¡åŸºç±»ã€‚\n\nç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹å·¥å‚æ–¹æ³•æ¨¡å¼çš„ç±»å›¾ï¼š\n\n![å·¥å‚æ–¹æ³•æ¨¡å¼ç±»å›¾](http://media.gusibi.mobi/X2xyI6pQ3sXdU_Y3Z_CH-qN6zP62jnvQDstKTz8AJL50FS8xhOazvO2RmRhsHH6X)\n\näº§å“ç±»å’Œåˆ›å»ºè€…ç±»å…¶å®æ˜¯å¹³è¡Œçš„ç±»çš„å±‚çº§å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š\n\n![](http://media.gusibi.mobi/LYoRbaaHRx4HhBho1wzNWB9LKxiVfCBJd-WxEkhfKo-9JJUjnFdIJxyEVuJKnhwP)\n\n### å·¥å‚æ–¹æ³•æ¨¡å¼å®šä¹‰\n\né€šè¿‡ä¸Šæ–‡çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å·¥å‚æ–¹æ³•æ¨¡å¼å¤§æ¦‚çš„å®šä¹‰ï¼š\n\n> åœ¨`å·¥å‚æ–¹æ³•æ¨¡å¼`ä¸­ï¼Œå·¥å‚çˆ¶ç±»è´Ÿè´£å®šä¹‰åˆ›å»ºäº§å“å¯¹è±¡çš„å…¬å…±æ¥å£ï¼Œè€Œå·¥å‚å­ç±»åˆ™è´Ÿè´£ç”Ÿæˆå…·ä½“çš„äº§å“å¯¹è±¡ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å°†äº§å“ç±»çš„å®ä¾‹åŒ–æ“ä½œå»¶è¿Ÿåˆ°å·¥å‚å­ç±»ä¸­å®Œæˆï¼Œå³é€šè¿‡å·¥å‚å­ç±»æ¥ç¡®å®šç©¶ç«Ÿåº”è¯¥å®ä¾‹åŒ–å“ªä¸€ä¸ªå…·ä½“äº§å“ç±»ã€‚\n\nå·¥å‚æ–¹æ³•æ¨¡å¼èƒ½å¤Ÿå°è£…å…·ä½“ç±»å‹çš„å®ä¾‹åŒ–ï¼ŒæŠ½è±¡çš„ Creator æä¾›äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„`å·¥å‚æ–¹æ³•`ã€‚åœ¨æŠ½è±¡çš„ Creator ä¸­ï¼Œä»»ä½•å…¶ä»–å®ç°çš„æ–¹æ³•ï¼Œéƒ½å¯èƒ½ä½¿ç”¨åˆ°è¿™ä¸ªæ–¹æ³•é”åˆ¶é€ å‡ºæ¥çš„äº§å“ï¼Œä½†åªæœ‰å­ç±»çœŸæ­£å®ç°è¿™ä¸ªå·¥å‚æ–¹æ³•å¹¶åˆ›å»ºäº§å“ã€‚\n\nä¸‹å›¾æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼åŸç†ç±»å›¾ï¼š\n\n![å·¥å‚æ–¹æ³•æ¨¡å¼ç±»å›¾](http://media.gusibi.mobi/jRO23-NdrmQi6ffAX-rpa2rzVSrlIIgzqQbKcSNa96Nshk8bCXFR2_jozUgCoHNa)\n\n\n### å·¥å‚æ–¹æ³•æ¨¡å¼ä¼˜ç‚¹\n\n* å·¥å‚æ–¹æ³•é›†ä¸­çš„åœ¨ä¸€ä¸ªåœ°æ–¹åˆ›å»ºå¯¹è±¡ï¼Œä½¿å¯¹è±¡çš„è·Ÿè¸ªå˜å¾—æ›´å®¹æ˜“ã€‚\n* å·¥å‚æ–¹æ³•æ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†äº§å“çš„å®ç°ä»`ä½¿ç”¨`ä¸­`è§£è€¦`ã€‚å¦‚æœå¢åŠ äº§å“æˆ–è€…æ”¹å˜äº§å“çš„å®ç°ï¼ŒCreator å¹¶ä¸ä¼šæ”¶åˆ°å½±å“ã€‚\n* ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯åœ¨ç³»ç»Ÿä¸­åŠ å…¥æ–°äº§å“æ—¶ï¼Œæ— é¡»ä¿®æ”¹æŠ½è±¡å·¥å‚å’ŒæŠ½è±¡äº§å“æä¾›çš„æ¥å£ï¼Œæ— é¡»ä¿®æ”¹å®¢æˆ·ç«¯ï¼Œä¹Ÿæ— é¡»ä¿®æ”¹å…¶ä»–çš„å…·ä½“å·¥å‚å’Œå…·ä½“äº§å“ï¼Œè€Œåªè¦æ·»åŠ ä¸€ä¸ªå…·ä½“å·¥å‚å’Œå…·ä½“äº§å“å°±å¯ä»¥äº†ã€‚è¿™æ ·ï¼Œç³»ç»Ÿçš„å¯æ‰©å±•æ€§ä¹Ÿå°±å˜å¾—éå¸¸å¥½ï¼Œå®Œå…¨ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚\n\n> å·¥å‚æ–¹æ³•å¯ä»¥åœ¨å¿…è¦æ—¶åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œä»è€Œæé«˜æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ç‡ã€‚è‹¥ç›´æ¥å®ä¾‹åŒ–ç±»æ¥åˆ›å»ºå¯¹è±¡ï¼Œé‚£ä¹ˆæ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡å°±éœ€è¦åˆ†é…é¢å¤–çš„å†…å­˜ã€‚\n\n## `ç®€å•å·¥å‚`å’Œ`å·¥å‚æ–¹æ³•`ä¹‹é—´çš„å·®å¼‚\n\n> ç®€å•å·¥å‚æŠŠå…¨éƒ¨çš„äº‹æƒ…åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†å®Œäº†ï¼ˆcreate_pizzaï¼‰ï¼Œè€Œå·¥å‚æ–¹æ³•æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ¡†æ¶ï¼Œè®©å­ç±»å»å†³å®šå¦‚ä½•å®ç°ã€‚æ¯”å¦‚åœ¨å·¥å‚æ–¹æ³•ä¸­ï¼Œorder_pizza() æ–¹æ³•æä¾›äº†ä¸€èˆ¬çš„æ¡†æ¶ç”¨æ¥åˆ›å»º pizzaï¼Œorder_pizza() æ–¹æ³•ä¾èµ–å·¥å‚æ–¹æ³•åˆ›å»ºå…·ä½“ç±»ï¼Œå¹¶åˆ¶é€ å‡ºå®é™…çš„ pizzaã€‚è€Œåˆ¶é€ ä»€ä¹ˆæ ·çš„ pizza æ˜¯é€šè¿‡ç»§æ‰¿ PizzaStoreæ¥å®ç°çš„ã€‚  ä½† `ç®€å•å·¥å‚` åªæ˜¯æŠŠå¯¹è±¡å°è£…èµ·æ¥ï¼Œå¹¶ä¸å…·å¤‡å·¥å‚æ–¹æ³•çš„å¼¹æ€§ã€‚\n\n\n## python åº”ç”¨ä¸­ä½¿ç”¨å·¥å‚æ¨¡å¼çš„ä¾‹å­\n\nDjango çš„ forms æ¨¡å—ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼æ¥åˆ›å»ºè¡¨å•å­—æ®µã€‚WTForm ä¹Ÿä½¿ç”¨åˆ°äº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚sqlalchemy ä¸­ä¸åŒæ•°æ®åº“è¿æ¥éƒ¨åˆ†ä¹Ÿç”¨åˆ°äº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚\n\n## æ€»ç»“\n\nå·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å®šä¹‰ä¸€ä¸ªç”¨æ¥åˆ›å»ºå¯¹è±¡çš„å…¬å…±æ¥å£ï¼Œç”±å·¥å‚è€Œä¸æ˜¯å®¢æˆ·æ¥å†³å®šéœ€è¦è¢«å®ä¾‹åŒ–çš„ç±»ï¼Œå®ƒé€šå¸¸åœ¨æ„é€ ç³»ç»Ÿæ•´ä½“æ¡†æ¶æ—¶è¢«ç”¨åˆ°ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼çœ‹ä¸Šå»ä¼¼ä¹æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å†…æ¶µå´æå…¶æ·±åˆ»ï¼ŒæŠ½è±¡ã€å°è£…ã€ç»§æ‰¿ã€å§”æ‰˜ã€å¤šæ€ç­‰é¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„ç†è®ºéƒ½å¾—åˆ°äº†å¾ˆå¥½çš„ä½“ç°ï¼Œåº”ç”¨èŒƒå›´éå¸¸å¹¿æ³›ã€‚\n\n## å‚è€ƒ\n\n* ã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹\n* ã€Šç²¾é€š python è®¾è®¡æ¨¡å¼ã€‹\n* ã€ŠPython ç¼–ç¨‹å®æˆ˜ã€‹\n* [Pythonè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹ä¸‰: åˆ›å»ºå‹Factory Methodæ¨¡å¼](https://www.ibm.com/developerworks/cn/linux/l-pypt/part3/index.html)\n\n------\n\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\næ¬¢è¿å…³æ³¨(April_Louisa) | è¯·æˆ‘å–èŠ¬è¾¾\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n",
      "data": {
        "title": "pythonè®¾è®¡æ¨¡å¼-å·¥å‚æ–¹æ³•æ¨¡å¼",
        "date": "2017-10-15 05:23:56",
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-factory-method"
    },
    {
      "content": "\n> `é¢˜ç›®`ï¼šç°åœ¨ä½ æœ‰ä¸€ä¸ªæ•°å­—ï¼Œé»˜è®¤æ ¼å¼åŒ–ç¨‹åºæ˜¯ä»¥åè¿›åˆ¶æ ¼å¼å±•ç¤ºæ­¤æ•°å€¼ï¼Œä½†éœ€è¦æä¾›ä¸€ä¸ªåŠŸèƒ½ï¼Œè¿™ä¸ªç¨‹åºè¦æ”¯æŒæ·»åŠ /æ³¨å†Œæ›´å¤šçš„æ ¼å¼åŒ–ç¨‹åºï¼ˆæ¯”å¦‚ï¼šæ·»åŠ ä¸€ä¸ªåå…­è¿›åˆ¶æ ¼å¼åŒ–ç¨‹åºå’Œä¸€ä¸ªäºŒè¿›åˆ¶æ ¼å¼åŒ–ç¨‹åºï¼‰ã€‚æ¯æ¬¡æ•°å€¼æ›´æ–°æ—¶ï¼Œå·²æ³¨å†Œçš„ç¨‹åºå°±ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå¹¶æ˜¾ç¤ºæ›´æ–°åçš„å€¼ã€‚\n\næˆ‘ä»¬çœ‹ä¸‹éœ€æ±‚ï¼š\n\n1. NumberFormatter æœ‰ä¸€ä¸ª number å±æ€§\n2. å½“ number å€¼ä¿®æ”¹æ—¶ï¼Œç›¸å…³çš„æ ¼å¼åŒ–æ–¹å¼å±•ç¤ºç»“æœè¦æ”¹å˜\n3. æ­¤ç³»ç»Ÿå¿…é¡»å¯æ‰©å±•å·²é€‚åº”å…¶ä»–æ ¼å¼åŒ–æ–¹å¼çš„ä½¿ç”¨ã€‚\n\nä¸€ä¸ªé”™è¯¯çš„å®ç°å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š\n\n```python\nclass NumberFormatter(object):\n    def __init__(self, number):\n        self.number = number\n        \n    def show_data(self):\n        self.default_formatter()\n        self.hex_formatter()\n        self.binary_formatter()\n        \n    def default_formatter(self):\n        pass\n        \n    def hex_formatter(self):\n        pass\n        \n    def binary_formatter(self):\n        pass\n```\n\næˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š\n\n```python\nnumber = NumberFormatter(10)\nnumber.show_data()\n```\n\nä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š`è¿™ç§é’ˆå¯¹å®ç°çš„ç¼–ç¨‹ä¼šå¯¼è‡´æˆ‘ä»¬åœ¨å¢åŠ æˆ–è€…åˆ é™¤éœ€è¦æ ¼å¼åŒ–æ–¹å¼æ—¶å¿…é¡»ä¿®æ”¹ä»£ç ã€‚`æ¯”å¦‚æˆ‘ä»¬ç°åœ¨ä¸å†éœ€è¦åå…­è¿›åˆ¶æ•°å­—æ ¼å¼çš„æ˜¾ç¤ºï¼Œå°±éœ€è¦æŠŠ `hex_formatter` ç›¸å…³çš„ä»£ç åˆ é™¤æˆ–è€…æ³¨é‡Šæ‰ã€‚\n\nè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¯ä»¥ç”¨åˆ°æˆ‘ä»¬è¿™æ¬¡è¦ä»‹ç»çš„`è§‚å¯Ÿè€…æ¨¡å¼`äº†ã€‚\n\n## ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼\n\n### è®¤è¯†è§‚å¯Ÿè€…æ¨¡å¼\n\næˆ‘ä»¬å…ˆçœ‹çœ‹æŠ¥çº¸å’Œæ‚å¿—çš„è®¢é˜…æ˜¯æ€ä¹ˆå›äº‹ï¼š\n\n1. æŠ¥ç¤¾çš„ä¸šåŠ¡å°±æ˜¯å‡ºç‰ˆæŠ¥çº¸\n2. å‘æŸå®¶æŠ¥ç¤¾è®¢é˜…æŠ¥çº¸ï¼Œåªè¦ä»–ä»¬æœ‰æ–°æŠ¥çº¸ï¼Œå°±ä¼šç»™ä½ é€æ¥ï¼Œåªè¦ä½ æ˜¯ä»–ä»¬çš„è®¢æˆ·ï¼Œä½ å°±ä¼šä¸€ç›´å—åˆ°æ–°æŠ¥çº¸ã€‚\n3. å½“ä½ ä¸å†æƒ³çœ‹çš„æ—¶å€™ï¼Œå–æ¶ˆè®¢é˜…ï¼Œä»–ä»¬å°±ä¸ä¼šåœ¨é€æ–°æŠ¥çº¸ç»™ä½ \n4. åªè¦æŠ¥ç¤¾è¿˜åœ¨è¿è¥ï¼Œå°±ä¼šä¸€ç›´æœ‰äººå‘ä»–ä»¬è®¢é˜…æŠ¥çº¸æˆ–å–æ¶ˆè®¢é˜…ã€‚\n\næˆ‘ä»¬ç”¨å›¾è¡¨ç¤ºä¸€ä¸‹ï¼Œè¿™é‡Œ`å‡ºç‰ˆè€…` æ”¹ç§°ä¸º`ä¸»é¢˜(Subject)`ï¼Œ`è®¢é˜…è€…`æ”¹ç§°ä¸º`è§‚å¯Ÿè€…(Observer)`ï¼š\n\n`1.` å¼€å§‹çš„æ—¶å€™ï¼Œé¸­å­å¯¹è±¡ä¸æ˜¯è§‚å¯Ÿè€…\n![](http://media.gusibi.mobi/FfEgRxfZ2c7lzOINxR1JJ9uarNvN0AjO15HBfKxEBoVdr4GANZIFjFmAwq6L9fM-)\n`2.` é¸­å­å¯¹è±¡è¿‡æ¥å‘Šè¯‰ä¸»é¢˜ï¼Œå®ƒæƒ³å½“ä¸€ä¸ªè§‚å¯Ÿè€…ï¼ˆé¸­å­å…¶å®æƒ³è¯´çš„æ˜¯ï¼šæˆ‘å¯¹ä½ çš„æ•°æ®æ”¹å˜æ„Ÿå…´è¶£ï¼Œä¸€æœ‰å˜åŒ–è¯·é€šçŸ¥æˆ‘ï¼‰\n![](http://media.gusibi.mobi/2KE6cyN1-K24iLlk-l_WWxjAC894wqhqDWMrfk780kRArv1QQMD7AU66WabDnHZ4)\n`3.` é¸­å­å¯¹è±¡å·²ç»æ˜¯è§‚å¯Ÿè€…äº†ï¼ˆé¸­å­é™å€™é€šçŸ¥ï¼Œä¸€æ—¦æ¥åˆ°é€šçŸ¥ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªæ•´æ•°ï¼‰ã€‚\n![](http://media.gusibi.mobi/si9qkWv1-wgocRkh8v1gXPbZJlfqpJCsYqXZaQX-8WnY-DbTHGqv_eVLGyy3yfab)\n`4.` ä¸»é¢˜æœ‰äº†æ–°çš„æ•°æ®ï¼ˆç°åœ¨é¸­å­å’Œå…¶ä»–æ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šå—åˆ°é€šçŸ¥ï¼š`ä¸»é¢˜å·²ç»æ”¹å˜`ï¼‰\n![](http://media.gusibi.mobi/9HhHmLzCUctRb46Te5j1A3OUosE-1f_qp37gC7pLJfQI-OFdxpFgosEfIjV9K8I4)\n`5.` è€é¼ å¯¹è±¡è¦æ±‚ä»è§‚å¯Ÿè€…ä¸­æŠŠè‡ªå·±é™¤åï¼ˆè€é¼ å·²ç»è§‚å¯Ÿæ¬¡ä¸»é¢˜å¤ªä¹…ï¼Œå†³å®šä¸å†å½“è§‚å¯Ÿè€…äº†ï¼‰ã€‚\n![](http://media.gusibi.mobi/3crIE4jTaaDE3bUWrp3tHL0jb2cKI0pQhaZeJPKh0HTYl_lY7D30uTeaybry0bRZ)\n`6.` è€é¼ ç¦»å¼€äº†ï¼ˆä¸»é¢˜çŸ¥é“è€é¼ çš„è¯·æ±‚åï¼ŒæŠŠå®ƒä»è§‚å¯Ÿè€…ä¸­ç§»é™¤äº†ï¼‰ã€‚\n![](http://media.gusibi.mobi/lnPq4IXxYH1fZURcPK2SiLXXbndcgA3f31F9UZ6BSi9QyWO5ZrkswwZ-cxI9_xL5)\n`7.` ä¸»é¢˜æœ‰äº†ä¸€ä¸ªæ–°çš„æ•´æ•°ï¼ˆé™¤äº†è€é¼ ä¹‹å¤–ï¼Œæ¯ä¸ªè§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå¦‚æœè€é¼ åˆæƒ³å½“è§‚å¯Ÿè€…äº†ï¼Œå®ƒè¿˜å¯ä»¥å†å›æ¥ï¼‰\n![](http://media.gusibi.mobi/_PeyLBIegB7aBqh7oLad5fUs8l1ANeqEEd1zEBkcrY02cN768EIDD33rL75YopbU)\n\n### å®šä¹‰è§‚å¯Ÿè€…æ¨¡å¼\n\nå½“ä½ è¯•å›¾å‹¾å‹’è§‚å¯Ÿè€…æ¨¡å¼æ—¶ï¼Œå¯ä»¥åˆ©ç”¨æŠ¥çº¸è®¢é˜…æœåŠ¡ï¼Œä»¥åŠå‡ºç‰ˆè¿™å’Œè®¢é˜…è€…æ¯”ä½ è¿™ä¸€åˆ‡ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼é€šå¸¸è¢«å®šä¹‰ä¸ºï¼š\n\n>`è§‚å¯Ÿè€…æ¨¡å¼`å®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€æ˜¯ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–è€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚\n\næˆ‘ä»¬å’Œä¹‹å‰çš„ä¾‹å­åšä¸ªå¯¹æ¯”ï¼š\n\n![](http://media.gusibi.mobi/5ictzh2edjji9GITg0JJXtR9bLqEmPN6XDytKrevXzKKdhtpLbZLRFElxRR3GOo3)\n\nä¸»é¢˜å’Œè§‚å¯Ÿè€…å®šä¹‰äº†ä¸€å¯¹å¤šçš„å…³ç³»ã€‚è§‚å¯Ÿè€…ä¾èµ–äºæ­¤ä¸»é¢˜ï¼Œåªè¦ä¸»é¢˜çŠ¶æ€ä¸€æœ‰å˜åŒ–ï¼Œè§‚å¯Ÿè€…å°±ä¼šè¢«é€šçŸ¥ã€‚æ ¹æ®é€šçŸ¥çš„é£æ ¼ï¼Œè§‚å¯Ÿè€…å¯èƒ½å› æ­¤æ–°å€¼è€Œæ›´æ–°ã€‚\n\n`ç°åœ¨ä½ å¯èƒ½æœ‰ç–‘é—®ï¼Œè¿™å’Œä¸€å¯¹å¤šçš„å…³ç³»æœ‰ä½•å…³è”ï¼Ÿ`\n\n> åˆ©ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä¸»é¢˜æ˜¯å…·æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿™äº›çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰`ä¸€ä¸ª`å…·æœ‰çŠ¶æ€çš„ä¸»é¢˜ã€‚å¦ä¸€æ–¹é¢ï¼Œè§‚å¯Ÿè€…ä½¿ç”¨è¿™äº›çŠ¶æ€ï¼Œè™½ç„¶è¿™äº›çŠ¶æ€ä¸å±äºä»–ä»¬ã€‚æœ‰è®¸å¤šè§‚å¯Ÿè€…ï¼Œä¾èµ–ä¸»é¢˜å‘Šè¯‰ä»–ä»¬çŠ¶æ€ä½•æ—¶æ”¹å˜äº†ã€‚è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªå…³ç³»ï¼š`ä¸€ä¸ªä¸»é¢˜å¯¹å¤šä¸ªè§‚å¯Ÿè€…çš„å…³ç³»`ã€‚\n\n`è§‚å¯Ÿè€…å’Œä¸»é¢˜ä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ`\n\n> ä¸»é¢˜æ˜¯çœŸæ­£æ‹¥æœ‰æ•°æ®çš„äººï¼Œè§‚å¯Ÿè€…æ˜¯ä¸»é¢˜çš„ä¾èµ–è€…ï¼Œåœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–°ï¼Œè¿™æ ·æ¯”èµ·è®©è®¸å¤šå¯¹è±¡æ§åˆ¶åŒä¸€ä»½æ•°æ®æ¥ï¼Œå¯ä»¥å¾—åˆ°æ›´å¹²å‡€çš„ OO è®¾è®¡ã€‚\n\n### è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨æ¡ˆä¾‹\n\nè§‚å¯Ÿè€…æ¨¡å¼åœ¨å®é™…åº”ç”¨ä¸­æœ‰è®¸å¤šçš„æ¡ˆä¾‹ï¼Œæ¯”å¦‚ä¿¡æ¯çš„èšåˆã€‚æ— è®ºæ ¼å¼ä¸º RSSã€Atom è¿˜æ˜¯å…¶å®ƒï¼Œæ€æƒ³å¤šäº‹ä¸€æ ·çš„ï¼šä½ è¿½éšæŸä¸ªä¿¡æ¯æºï¼Œå½“å®ƒæ¯æ¬¡æ›´æ–°æ—¶ï¼Œä½ éƒ½ä¼šæ”¶åˆ°å…³äºæ›´æ–°çš„é€šçŸ¥ã€‚\näº‹ä»¶é©±åŠ¨ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„ä¾‹å­ã€‚åœ¨è¿™ç§ç³»ç»Ÿä¸­ï¼Œç›‘å¬è€…è¢«ç”¨äºç›‘å¬ç‰¹å®šçš„äº‹ä»¶ã€‚ç›‘å¬è€…çš„äº‹ä»¶è¢«åˆ›å»ºå‡ºæ¥æ—¶å°±ä¼šè§¦å‘å®ƒä»¬ã€‚è¿™ä¸ªäº‹ä»¶å¯ä»¥ä½¿é”®å…¥æŸä¸ªç‰¹å®šçš„é”®ã€ç§»åŠ¨é¼ æ ‡æˆ–è€…å…¶ä»–ã€‚äº‹ä»¶æ‰®æ¼”å‘å¸ƒè€…çš„è§’è‰²ï¼Œç›‘å¬è€…åˆ™æ‰®æ¼”è§‚å¯Ÿè€…çš„è§’è‰²ã€‚\n\n## Python å®ç°\n\nç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ°æ–‡ç« å¼€å§‹çš„é‚£ä¸ªé—®é¢˜ã€‚\n\nè¿™é‡Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªåŸºç±» Publisherï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤åŠé€šçŸ¥è§‚å¯Ÿè€…è¿™äº›å…¬ç”¨åŠŸèƒ½ã€‚DefaultFormatter ç±»ç»§æ‰¿è‡ª Publisherï¼Œå¹¶æ·»åŠ æ ¼å¼åŒ–ç¨‹åºç‰¹å®šçš„åŠŸèƒ½ã€‚\n\n![æ–‡ç« å¼€å¤´é—®é¢˜çš„ç±»å›¾](http://media.gusibi.mobi/pRyxskK89xODXjfsCdPVnnPiJhyP2iyYmYHryZb3taKTnpZxtZZ8TINFsCroP0Y_)\n\nPublisher çš„ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport itertools\n\n'''\nè§‚å¯Ÿè€…æ¨¡å¼å®ç°\n'''\n\nclass Publisher:\n\n    def __init__(self):\n        self.observers = set()\n\n    def add(self, observer, *observers):\n        for observer in itertools.chain((observer, ), observers):\n            self.observers.add(observer)\n            observer.update(self)\n        else:\n            print('Failed to add: {}'.format(observer))\n\n    def remove(self, observer):\n        try:\n            self.observers.discard(observer)\n        except ValueError:\n            print('Failed to remove: {}'.format(observer))\n\n    def notify(self):\n        [observer.update(self) for observer in self.observers]\n```\n\nç°åœ¨ï¼Œæ‰“ç®—ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„æ¨¡å‹æˆ–ç±»éƒ½åº”è¯¥ç»§æ‰¿ Publisher ç±»ã€‚è¯¥ç±»ç”¨ set æ¥ä¿å­˜è§‚å¯Ÿè€…å¯¹è±¡ã€‚å½“ç”¨æˆ·å‘ Publisher æ³¨å†Œæ–°çš„è§‚å¯Ÿè€…å¯¹è±¡æ—¶ï¼Œè§‚å¯Ÿè€…çš„ update() æ–¹æ³•ä¼šæ‰§è¡Œï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿç”¨æ¨¡å‹å½“å‰çš„çŠ¶æ€åˆå§‹åŒ–è‡ªå·±ã€‚æ¨¡å‹çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåº”è¯¥è°ƒç”¨ç»§æ‰¿è€Œæ¥çš„ notify() æ–¹æ³•ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œæ¯ä¸ªè§‚å¯Ÿè€…å¯¹è±¡çš„ update() æ–¹æ³•ï¼Œä»¥ç¡®ä¿ä»–ä»¬éƒ½èƒ½åæ˜ å‡ºæ¨¡å‹çš„æœ€æ–°çŠ¶æ€ã€‚\n\n> `add()` æ–¹æ³•çš„å†™æ³•å€¼å¾—æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ”¯æŒå¯ä»¥æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨äº†`itertools.chain()` æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„  `iterable`ï¼Œå¹¶è¿”å›å•ä¸ª`iterable`ã€‚éå†è¿™ä¸ª iterableï¼Œä¹Ÿå°±ç›¸å½“äºä¾æ¬¡éå†å‚æ•°é‡Œçš„é‚£äº› iterableã€‚\n\næ¥ä¸‹æ¥æ˜¯ `DefaultFomatter` ç±»ã€‚`__init__()` åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è°ƒç”¨åŸºç±»çš„`__init__()` æ–¹æ³•ï¼Œå› ä¸ºè¿™åœ¨ Python ä¸­æ²¡æ³•è‡ªåŠ¨å®Œæˆã€‚`DefaultFormatter` å®ä¾‹æœ‰è‡ªå·±çš„åå­—ï¼Œè¿™æ ·ä¾¿äºæˆ‘ä»¬è·Ÿè¸ªå…¶çŠ¶æ€ã€‚å¯¹äº`_data` å˜é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åç§°æ”¹ç¼–æ¥å£°æ˜ä¸èƒ½ç›´æ¥è®¿é—®è¯¥å˜é‡ã€‚`DefaultFormatter` æŠŠ`_data` å˜é‡ç”¨ä½œä¸€ä¸ªæ•´æ•°ï¼Œé»˜è®¤å€¼ä¸º0ã€‚\n\n```python\nclass DefaultFormatter(Publisher):\n\n    def __init__(self, name):\n        Publisher.__init__(self)\n        self.name = name\n        self._data = 0\n\n    def __str__(self):\n        return \"{}: '{}' has data = {}\".format(type(self).__name__, self.name, self._data)\n\n    @property\n    def data(self):\n        return self._data\n\n    @data.setter\n    def data(self, new_value):\n        try:\n            self._data = int(new_value)\n        except ValueError as e:\n            print('Error: {}'.format(e))\n        else:\n            self.notify()\n```\n\n* `__str__()` æ–¹æ³•è¿”å›å…³äºå‘å¸ƒè€…åç§°å’Œ `_data` å€¼çš„ä¿¡æ¯ã€‚type(self).__name æ˜¯ä¸€ç§è·å–ç±»åçš„æ–¹ä¾¿æŠ€å·§ï¼Œé¿å…ç¡¬ç¼–ç ç±»åã€‚ï¼ˆä¸è¿‡è¿™ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§ï¼‰\n\n* `data()` æ–¹æ³•æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªä½¿ç”¨äº† `@property` è£…é¥°å™¨æ¥æä¾›_data å˜é‡çš„è¯»è®¿é—®æ–¹å¼ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½ä½¿ç”¨ `object.data` æ¥ä»£æ›¿ `object._data`ã€‚ç¬¬äºŒä¸ª data() æ–¹æ³•ä½¿ç”¨äº†`@setter` è£…é¥°å™¨ï¼Œæ”¹è£…é¥°å™¨ä¼šåœ¨æ¯æ¬¡ä½¿ç”¨èµ‹å€¼æ“ä½œç¬¦(=)ä¸º`_data` å˜é‡èµ‹å€¼æ—¶è¢«è°ƒç”¨ã€‚è¯¥æ–¹æ³•ä¹Ÿä¼šå°è¯•æŠŠæ–°å€¼å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œå¹¶åœ¨è½¬æ¢å¤±è´¥æ—¶å¤„ç†å¼‚å¸¸ã€‚\n\næ¥ä¸‹æ¥æ˜¯æ·»åŠ è§‚å¯Ÿè€…ã€‚`HexFormatter` å’Œ `BinaryFormatter` åŠŸèƒ½åŸºæœ¬ç›¸ä¼¼ã€‚å”¯ä¸€çš„ä¸åŒåœ¨äºå¦‚ä½•æ ¼å¼åŒ–ä»å‘å¸ƒè€…é‚£è·å–åˆ°çš„æ•°æ®å€¼ï¼Œå³åå…­è¿›åˆ¶å’ŒäºŒè¿›åˆ¶æ ¼å¼åŒ–ã€‚\n\n```python\nclass HexFormatter:\n\n    def update(self, publisher):\n        print(\"{}: '{}' has now hex data= {}\".format(type(self).__name__,\n                                                     publisher.name, hex(publisher.data)))\n\nclass BinaryFormatter:\n\n    def update(self, publisher):\n        print(\"{}: '{}' has now bin data= {}\".format(type(self).__name__,\n                                                     publisher.name, bin(publisher.data)))\n```\n\næ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ ä¸€ä¸‹æµ‹è¯•æ•°æ®ï¼Œè¿è¡Œä»£ç è§‚å¯Ÿä¸€ä¸‹ç»“æœï¼š\n\n```python\ndef main():\n    df = DefaultFormatter('test1')\n    print(df)\n\n    print()\n    hf = HexFormatter()\n    df.add(hf)\n    df.data = 3\n    print(df)\n\n    print()\n    bf = BinaryFormatter()\n    df.add(bf)\n    df.data = 21\n    print(df)\n\n    print()\n    df.remove(hf)\n    df.data = 40\n    print(df)\n\n    print()\n    df.remove(hf)\n    df.add(bf)\n\n    df.data = 'hello'\n    print(df)\n\n    print()\n    df.data = 4.2\n    print(df)\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\nå®Œæ•´ä»£ç å‚è€ƒï¼š[https://gist.github.com/gusibi/93a000c79f3d943dd58dcd39c4b547f1](https://gist.github.com/gusibi/93a000c79f3d943dd58dcd39c4b547f1)\n\nè¿è¡Œä»£ç ï¼š\n\n```shell\npython observer.py    \n## output\nDefaultFormatter: 'test1' has data = 0\n\nHexFormatter: 'test1' has now hex data= 0x0\nFailed to add: <__main__.HexFormatter object at 0x10277da20>\nHexFormatter: 'test1' has now hex data= 0x3\nDefaultFormatter: 'test1' has data = 3\n\nBinaryFormatter: 'test1' has now bin data= 0b11\nFailed to add: <__main__.BinaryFormatter object at 0x10277da90>\nBinaryFormatter: 'test1' has now bin data= 0b10101\nHexFormatter: 'test1' has now hex data= 0x15\nDefaultFormatter: 'test1' has data = 21\n\nBinaryFormatter: 'test1' has now bin data= 0b101000\nDefaultFormatter: 'test1' has data = 40\n\nBinaryFormatter: 'test1' has now bin data= 0b101000\nFailed to add: <__main__.BinaryFormatter object at 0x10277da90>\nError: invalid literal for int() with base 10: 'hello'\nDefaultFormatter: 'test1' has data = 40\n\nBinaryFormatter: 'test1' has now bin data= 0b100\nDefaultFormatter: 'test1' has data = 4\n\n```\n\nåœ¨è¾“å‡ºä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæ·»åŠ é¢å¤–çš„è§‚å¯Ÿè€…ï¼Œå°±ä¼šå‡ºç°æ›´å¤šçš„è¾“å‡ºï¼›ä¸€ä¸ªè§‚å¯Ÿè€…è¢«åˆ é™¤åå°±ä¸å†è¢«é€šçŸ¥åˆ°ã€‚\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡æˆ‘ä»¬ä»‹ç»äº†è§‚å¯Ÿè€…æ¨¡å¼çš„åŸç†ä»¥åŠ Python ä»£ç çš„å®ç°ã€‚åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å¹¿æ³›çš„è¿ç”¨äº GUI ç¼–ç¨‹ï¼Œè€Œä¸”åœ¨ä»¿çœŸåŠæœåŠ¡å™¨ç­‰å…¶ä»–æ—¶é—´å¤„ç†æ¶æ„ä¸­ä¹Ÿèƒ½ç”¨åˆ°ï¼Œæ¯”å¦‚ï¼š`æ•°æ®åº“è§¦å‘å™¨`ã€`Django çš„ä¿¡å·ç³»ç»Ÿ`ã€`Qt GUI åº”ç”¨ç¨‹åºæ¡†æ¶çš„ä¿¡å·ï¼ˆsignalï¼‰ä¸æ§½ï¼ˆslotï¼‰æœºæ™º`ä»¥åŠ`WebSocket`çš„è®¸å¤šç”¨ä¾‹ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [The 10 Minute Guide to the Observer Pattern in Pythonï¼šhttp://www.giantflyingsaucer.com/blog/?p=5117](http://www.giantflyingsaucer.com/blog/?p=5117)\n* [Observerï¼šhttp://python-3-patterns-idioms-test.readthedocs.io/en/latest/Observer.html](http://python-3-patterns-idioms-test.readthedocs.io/en/latest/Observer.html)\n\n\n------\n\n\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\næ¬¢è¿å…³æ³¨(April_Louisa) | è¯·æˆ‘å–èŠ¬è¾¾\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n",
      "data": {
        "date": "2017-09-24 14:29:39",
        "description": "python è§‚å¯Ÿè€…æ¨¡å¼",
        "author": "goodspeed",
        "permalink": "/post/python-design-pattern-observer",
        "categories": [
          "development",
          "python",
          "è®¾è®¡æ¨¡å¼"
        ],
        "tags": [
          "python",
          "è¯»ä¹¦ç¬”è®°",
          "è®¾è®¡æ¨¡å¼"
        ],
        "title": "pythonè®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼",
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-observer"
    },
    {
      "content": "\n> è¿™ç¯‡ redis å­¦ä¹ ç¬”è®°ä¸»è¦ä»‹ç» redis çš„æ•°æ®ç»“æ„å’Œæ•°æ®ç±»å‹ï¼Œå¹¶è®¨è®ºæ•°æ®ç»“æ„çš„é€‰æ‹©ä»¥åŠåº”ç”¨åœºæ™¯çš„ä¼˜åŒ–ã€‚\n\n### redis æ˜¯ä»€ä¹ˆ\n\n> Redisæ˜¯ä¸€ç§é¢å‘â€œé”®/å€¼â€å¯¹ç±»å‹æ•°æ®çš„åˆ†å¸ƒå¼NoSQLæ•°æ®åº“ç³»ç»Ÿï¼Œç‰¹ç‚¹æ˜¯é«˜æ€§èƒ½ï¼ŒæŒä¹…å­˜å‚¨ï¼Œé€‚åº”é«˜å¹¶å‘çš„åº”ç”¨åœºæ™¯ã€‚\n\n### Redis æ•°æ®ç»“æ„\n\n* åŠ¨æ€å­—ç¬¦ä¸² (Sds)\n* åŒç«¯åˆ—è¡¨   (LINKEDLIST)\n* å­—å…¸      \n* è·³è·ƒè¡¨    (SKIPLIST)\n* æ•´æ•°é›†åˆ  (INTSET)\n* å‹ç¼©åˆ—è¡¨  (ZIPLIST)\n\nHUGOMORE42\n\n#### [åŠ¨æ€å­—ç¬¦ä¸²](http://origin.redisbook.com/internal-datastruct/sds.html)\n\nSds (Simple Dynamic String,ç®€å•åŠ¨æ€å­—ç¬¦ä¸²)æ˜¯ Redis åº•å±‚æ‰€ä½¿ç”¨çš„å­—ç¬¦ä¸²è¡¨ç¤º,å®ƒè¢«ç”¨ åœ¨å‡ ä¹æ‰€æœ‰çš„ Redis æ¨¡å—ä¸­\n\nRedis æ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®åº“(key-value DB),æ•°æ®åº“çš„å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€é›†åˆã€åˆ—è¡¨ç­‰å¤šç§ç±» å‹çš„å¯¹è±¡,è€Œæ•°æ®åº“çš„é”®åˆ™æ€»æ˜¯å­—ç¬¦ä¸²å¯¹è±¡\n\nåœ¨ Redis ä¸­, ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡é™¤äº†å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²å€¼ä¹‹å¤–,è¿˜å¯ä»¥ä¿å­˜ long ç±»å‹çš„å€¼å½“å­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²æ—¶,å®ƒåŒ…å«çš„æ‰æ˜¯ sds å€¼,å¦åˆ™çš„è¯,å®ƒå°± æ˜¯ä¸€ä¸ª long ç±»å‹çš„å€¼\n\n##### åŠ¨æ€å­—ç¬¦ä¸²ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨:\n\n1. å®ç°å­—ç¬¦ä¸²å¯¹è±¡(StringObject)\n2. åœ¨ Redis ç¨‹åºå†…éƒ¨ç”¨ä½œ char * ç±»å‹çš„æ›¿ä»£å“\n\n\n#### [åŒç«¯åˆ—è¡¨] (http://origin.redisbook.com/internal-datastruct/adlist.html)\n\nåŒç«¯é“¾è¡¨è¿˜æ˜¯ Redis åˆ—è¡¨ç±»å‹çš„åº•å±‚å®ç°ä¹‹ä¸€ï¼Œå½“å¯¹åˆ—è¡¨ç±»å‹çš„é”®è¿›è¡Œæ“ä½œâ€”â€”æ¯”å¦‚æ‰§è¡Œ RPUSH ã€LPOP æˆ– LLEN ç­‰å‘½ä»¤æ—¶,ç¨‹åºåœ¨åº•å±‚æ“ä½œçš„å¯èƒ½å°±æ˜¯åŒç«¯é“¾è¡¨\n\n##### åŒç«¯é“¾è¡¨ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨:\n\n* ä½œä¸º Redis åˆ—è¡¨ç±»å‹çš„åº•å±‚å®ç°ä¹‹ä¸€;\n* ä½œä¸ºé€šç”¨æ•°æ®ç»“æ„,è¢«å…¶ä»–åŠŸèƒ½æ¨¡å—æ‰€ä½¿ç”¨;\n\n#### [å­—å…¸](http://origin.redisbook.com/internal-datastruct/dict.html)\n\nå­—å…¸(dictionary),åˆåæ˜ å°„(map)æˆ–å…³è”æ•°ç»„(associative array), å®ƒæ˜¯ä¸€ç§æŠ½è±¡æ•°æ®ç»“ æ„,ç”±ä¸€é›†é”®å€¼å¯¹(key-value pairs)ç»„æˆ,å„ä¸ªé”®å€¼å¯¹çš„é”®å„ä¸ç›¸åŒ,ç¨‹åºå¯ä»¥å°†æ–°çš„é”®å€¼å¯¹ æ·»åŠ åˆ°å­—å…¸ä¸­,æˆ–è€…åŸºäºé”®è¿›è¡ŒæŸ¥æ‰¾ã€æ›´æ–°æˆ–åˆ é™¤ç­‰æ“ä½œ\n\n##### å­—å…¸çš„åº”ç”¨\n\n1. å®ç°æ•°æ®åº“é”®ç©ºé—´(key space);\n2. ç”¨ä½œ Hash ç±»å‹é”®çš„å…¶ä¸­ä¸€ç§åº•å±‚å®ç°;\n\n> Redis æ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®åº“,æ•°æ®åº“ä¸­çš„é”®å€¼å¯¹å°±ç”±å­—å…¸ä¿å­˜:æ¯ä¸ªæ•°æ®åº“éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å¯¹åº”çš„å­—å…¸,è¿™ä¸ªå­—å…¸è¢«ç§°ä¹‹ä¸ºé”®ç©ºé—´(key space)ã€‚\n\nRedis çš„ Hash ç±»å‹é”®ä½¿ç”¨**å­—å…¸å’Œå‹ç¼©åˆ—è¡¨**ä¸¤ç§æ•°æ®ç»“æ„ä½œä¸ºåº•å±‚å®ç°\n\n#### [è·³è·ƒè¡¨](http://origin.redisbook.com/internal-datastruct/skiplist.html)\n\nè·³è·ƒè¡¨(skiplist)æ˜¯ä¸€ç§éšæœºåŒ–çš„æ•°æ®,ç”± William Pugh åœ¨è®ºæ–‡ã€ŠSkip lists: a probabilistic alternative to balanced treesã€‹ä¸­æå‡º,è¿™ç§æ•°æ®ç»“æ„ä»¥æœ‰åºçš„æ–¹å¼åœ¨å±‚æ¬¡åŒ–çš„é“¾è¡¨ä¸­ä¿å­˜å…ƒç´ ,å®ƒçš„æ•ˆç‡å¯ä»¥å’Œå¹³è¡¡æ ‘åª²ç¾â€”â€”æŸ¥æ‰¾ã€åˆ é™¤ã€æ·»åŠ ç­‰æ“ä½œéƒ½å¯ä»¥åœ¨å¯¹æ•°æœŸæœ›æ—¶é—´ä¸‹å®Œæˆ, å¹¶ä¸”æ¯”èµ·å¹³è¡¡æ ‘æ¥è¯´,è·³è·ƒè¡¨çš„å®ç°è¦ç®€å•ç›´è§‚å¾—å¤š\n\nå’Œå­—å…¸ã€é“¾è¡¨æˆ–è€…å­—ç¬¦ä¸²è¿™å‡ ç§åœ¨ Redis ä¸­å¤§é‡ä½¿ç”¨çš„æ•°æ®ç»“æ„ä¸åŒ,è·³è·ƒè¡¨åœ¨ Redis çš„å”¯ä¸€ä½œç”¨,å°±æ˜¯å®ç°æœ‰åºé›†æ•°æ®ç±»å‹\nè·³è·ƒè¡¨å°†æŒ‡å‘æœ‰åºé›†çš„ score å€¼å’Œ member åŸŸçš„æŒ‡é’ˆä½œä¸ºå…ƒç´ ,å¹¶ä»¥ score å€¼ä¸ºç´¢å¼•,å¯¹æœ‰åºé›†å…ƒç´ è¿›è¡Œæ’åºã€‚\n\n\n#### [æ•´æ•°é›†åˆ](http://origin.redisbook.com/compress-datastruct/intset.html)\n\næ•´æ•°é›†åˆ(intset)ç”¨äºæœ‰åºã€æ— é‡å¤åœ°ä¿å­˜å¤šä¸ªæ•´æ•°å€¼,å®ƒä¼šæ ¹æ®å…ƒç´ çš„å€¼,è‡ªåŠ¨é€‰æ‹©è¯¥ç”¨ä»€ä¹ˆé•¿åº¦çš„æ•´æ•°ç±»å‹æ¥ä¿å­˜å…ƒç´ \n\nIntset æ˜¯é›†åˆé”®çš„åº•å±‚å®ç°ä¹‹ä¸€,å¦‚æœä¸€ä¸ªé›†åˆ:\n1. åªä¿å­˜ç€æ•´æ•°å…ƒç´ ;\n2. å…ƒç´ çš„æ•°é‡ä¸å¤š;\né‚£ä¹ˆ Redis å°±ä¼šä½¿ç”¨ intset æ¥ä¿å­˜é›†åˆå…ƒç´ ã€‚\n\n#### [å‹ç¼©åˆ—è¡¨](http://origin.redisbook.com/compress-datastruct/ziplist.html)\n\nZiplist æ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„å†…å­˜å—æ„æˆçš„åˆ—è¡¨,ä¸€ä¸ª ziplist å¯ä»¥åŒ…å«å¤šä¸ªèŠ‚ç‚¹(entry),æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ªé•¿åº¦å—é™çš„å­—ç¬¦æ•°ç»„(ä¸ä»¥ \\0 ç»“å°¾çš„ char æ•°ç»„)æˆ–è€…æ•´æ•°\n\n### Redis æ•°æ®ç±»å‹\n\n#### [RedisObject](http://origin.redisbook.com/datatype/object.html#redisobject-redis)\n\nredisObject æ˜¯ Redis ç±»å‹ç³»ç»Ÿçš„æ ¸å¿ƒ,æ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®ã€å€¼,ä»¥åŠ Redis æœ¬èº«å¤„ç†çš„å‚æ•°,éƒ½è¡¨ç¤ºä¸ºè¿™ç§æ•°æ®ç±»å‹\n\nredisObject çš„å®šä¹‰ä½äº redis.h :\n\n```c\n/*\n* Redis å¯¹è±¡\n*/\ntypedef struct redisObject {\n    // ç±»å‹\n    unsigned type:4;\n    // å¯¹é½ä½\n    unsigned notused:2;\n    // ç¼–ç æ–¹å¼\n    unsigned encoding:4;\n    // LRU æ—¶é—´(ç›¸å¯¹äº server.lruclock)\n    unsigned lru:22;\n    // å¼•ç”¨è®¡æ•°\n    int refcount;\n    // æŒ‡å‘å¯¹è±¡çš„å€¼\n    void *ptr;\n} robj;\n```\n\ntype ã€encoding å’Œ ptr æ˜¯æœ€é‡è¦çš„ä¸‰ä¸ªå±æ€§ã€‚\n\ntype è®°å½•äº†å¯¹è±¡æ‰€ä¿å­˜çš„å€¼çš„ç±»å‹,å®ƒçš„å€¼å¯èƒ½æ˜¯ä»¥ä¸‹å¸¸é‡çš„å…¶ä¸­ä¸€ä¸ª\n\n```c\n/*\n* å¯¹è±¡ç±»å‹\n*/\n#define REDIS_STRING 0 // å­—ç¬¦ä¸²\n#define REDIS_LIST 1   // åˆ—è¡¨\n#define REDIS_SET 2    // é›†åˆ\n#define REDIS_ZSET 3   // æœ‰åºé›†\n#define REDIS_HASH 4   // å“ˆå¸Œè¡¨\n```\n\nencoding è®°å½•äº†å¯¹è±¡æ‰€ä¿å­˜çš„å€¼çš„ç¼–ç ,å®ƒçš„å€¼å¯èƒ½æ˜¯ä»¥ä¸‹å¸¸é‡çš„å…¶ä¸­ä¸€ä¸ª\n\n```c\n/*\n* å¯¹è±¡ç¼–ç \n*/\n#define REDIS_ENCODING_RAW 0    // ç¼–ç ä¸ºå­—ç¬¦ä¸²\n#define REDIS_ENCODING_INT 1    // ç¼–ç ä¸ºæ•´æ•°\n#define REDIS_ENCODING_HT 2     // ç¼–ç ä¸ºå“ˆå¸Œè¡¨\n#define REDIS_ENCODING_ZIPMAP 3 // ç¼–ç ä¸º zipmap(2.6 åä¸å†ä½¿ç”¨)\n#define REDIS_ENCODING_LINKEDLIST 4 // ç¼–ç ä¸ºåŒç«¯é“¾è¡¨\n#define REDIS_ENCODING_ZIPLIST 5    // ç¼–ç ä¸ºå‹ç¼©åˆ—è¡¨\n#define REDIS_ENCODING_INTSET 6     // ç¼–ç ä¸ºæ•´æ•°é›†åˆ\n#define REDIS_ENCODING_SKIPLIST 7    // ç¼–ç ä¸ºè·³è·ƒè¡¨\n```\n\nptr æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,æŒ‡å‘å®é™…ä¿å­˜å€¼çš„æ•°æ®ç»“æ„,è¿™ä¸ªæ•°æ®ç»“æ„ç”± type å±æ€§å’Œ encoding å±æ€§å†³å®šã€‚\n\nå½“æ‰§è¡Œä¸€ä¸ªå¤„ç†æ•°æ®ç±»å‹çš„å‘½ä»¤æ—¶,Redis æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:\n\n1. æ ¹æ®ç»™å®škey,åœ¨æ•°æ®åº“å­—å…¸ä¸­æŸ¥æ‰¾å’Œå®ƒåƒå¯¹åº”çš„redisObject,å¦‚æœæ²¡æ‰¾åˆ°,å°±è¿”å› NULL ã€‚\n2. æ£€æŸ¥redisObjectçš„typeå±æ€§å’Œæ‰§è¡Œå‘½ä»¤æ‰€éœ€çš„ç±»å‹æ˜¯å¦ç›¸ç¬¦,å¦‚æœä¸ç›¸ç¬¦,è¿”å›ç±» å‹é”™è¯¯ã€‚\n3. æ ¹æ®redisObjectçš„encodingå±æ€§æ‰€æŒ‡å®šçš„ç¼–ç ,é€‰æ‹©åˆé€‚çš„æ“ä½œå‡½æ•°æ¥å¤„ç†åº•å±‚çš„ æ•°æ®ç»“æ„ã€‚\n4. è¿”å›æ•°æ®ç»“æ„çš„æ“ä½œç»“æœä½œä¸ºå‘½ä»¤çš„è¿”å›å€¼ã€‚\n\n\n#### [å­—ç¬¦ä¸²](http://redisdoc.com/string/index.html)\n\nREDIS_STRING (å­—ç¬¦ä¸²)æ˜¯ Redis ä½¿ç”¨å¾—æœ€ä¸ºå¹¿æ³›çš„æ•°æ®ç±»å‹,å®ƒé™¤äº†æ˜¯ SET ã€GET ç­‰å‘½ä»¤ çš„æ“ä½œå¯¹è±¡ä¹‹å¤–,æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®,ä»¥åŠæ‰§è¡Œå‘½ä»¤æ—¶æä¾›ç»™ Redis çš„å‚æ•°,éƒ½æ˜¯ç”¨è¿™ç§ç±»å‹ ä¿å­˜çš„ã€‚\n\nå­—ç¬¦ä¸²ç±»å‹åˆ†åˆ«ä½¿ç”¨ REDIS_ENCODING_INT å’Œ REDIS_ENCODING_RAW ä¸¤ç§ç¼–ç \n\n> åªæœ‰èƒ½è¡¨ç¤ºä¸º long ç±»å‹çš„å€¼,æ‰ä¼šä»¥æ•´æ•°çš„å½¢å¼ä¿å­˜,å…¶ä»–ç±»å‹ çš„æ•´æ•°ã€å°æ•°å’Œå­—ç¬¦ä¸²,éƒ½æ˜¯ç”¨ sdshdr ç»“æ„æ¥ä¿å­˜\n\n#### [å“ˆå¸Œè¡¨](http://redisdoc.com/hash/index.html)\n\nREDIS_HASH (å“ˆå¸Œè¡¨)æ˜¯HSET ã€HLEN ç­‰å‘½ä»¤çš„æ“ä½œå¯¹è±¡\n\nå®ƒä½¿ç”¨ REDIS_ENCODING_ZIPLISTå’ŒREDIS_ENCODING_HT ä¸¤ç§ç¼–ç æ–¹å¼\n\nRedis ä¸­æ¯ä¸ªhashå¯ä»¥å­˜å‚¨232-1é”®å€¼å¯¹ï¼ˆ40å¤šäº¿ï¼‰\n\n#### [åˆ—è¡¨](http://redisdoc.com/list/index.html)\n\nREDIS_LIST(åˆ—è¡¨)æ˜¯LPUSH ã€LRANGEç­‰å‘½ä»¤çš„æ“ä½œå¯¹è±¡\n\nå®ƒä½¿ç”¨ REDIS_ENCODING_ZIPLISTå’ŒREDIS_ENCODING_LINKEDLIST è¿™ä¸¤ç§æ–¹å¼ç¼–ç \n\nä¸€ä¸ªåˆ—è¡¨æœ€å¤šå¯ä»¥åŒ…å«232-1 ä¸ªå…ƒç´ (4294967295, æ¯ä¸ªåˆ—è¡¨è¶…è¿‡40äº¿ä¸ªå…ƒç´ )ã€‚\n\n#### [é›†åˆ](http://redisdoc.com/set/index.html)\n\nREDIS_SET (é›†åˆ) æ˜¯ SADD ã€ SRANDMEMBER ç­‰å‘½ä»¤çš„æ“ä½œå¯¹è±¡\n\nå®ƒä½¿ç”¨ REDIS_ENCODING_INTSET å’Œ REDIS_ENCODING_HT ä¸¤ç§æ–¹å¼ç¼–ç \n\nRedis ä¸­é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚\n\né›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°ä¸º 232 - 1 (4294967295, æ¯ä¸ªé›†åˆå¯å­˜å‚¨40å¤šäº¿ä¸ªæˆå‘˜)\n\n#### [æœ‰åºé›†](http://redisdoc.com/sorted_set/index.html)\n\nREDIS_ZSET (æœ‰åºé›†)æ˜¯ZADD ã€ZCOUNT ç­‰å‘½ä»¤çš„æ“ä½œå¯¹è±¡\n\nå®ƒä½¿ç”¨ REDIS_ENCODING_ZIPLISTå’ŒREDIS_ENCODING_SKIPLIST ä¸¤ç§æ–¹å¼ç¼–ç \n\nä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚\n\næœ‰åºé›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚\n\né›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚ é›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°ä¸º 232 - 1 (4294967295, æ¯ä¸ªé›†åˆå¯å­˜å‚¨40å¤šäº¿ä¸ªæˆå‘˜)\n\n#### Rediså„ç§æ•°æ®ç±»å‹_ä»¥åŠå®ƒä»¬çš„ç¼–ç æ–¹å¼\n\n![Rediså„ç§æ•°æ®ç±»å‹_ä»¥åŠå®ƒä»¬çš„ç¼–ç æ–¹å¼](http://hangjia.qiniudn.com/Fj2h6yEVRaDHEshO9OC5mVzm9Sht)\n\n### è¿‡æœŸæ—¶é—´\n\nåœ¨æ•°æ®åº“ä¸­,æ‰€æœ‰é”®çš„è¿‡æœŸæ—¶é—´éƒ½è¢«ä¿å­˜åœ¨ redisDb ç»“æ„çš„ expires å­—å…¸é‡Œ:\n\n```c\ntypedef struct redisDb {\n\t// ...\n\tdict *expires;\n\t// ...\n} redisDb;\n```\n\nexpires å­—å…¸çš„é”®æ˜¯ä¸€ä¸ªæŒ‡å‘ dict å­—å…¸(é”®ç©ºé—´)é‡ŒæŸä¸ªé”®çš„æŒ‡é’ˆ,è€Œå­—å…¸çš„å€¼åˆ™æ˜¯é”®æ‰€æŒ‡ å‘çš„æ•°æ®åº“é”®çš„åˆ°æœŸæ—¶é—´,è¿™ä¸ªå€¼ä»¥ long long ç±»å‹è¡¨ç¤º\n\n#### è¿‡æœŸæ—¶é—´è®¾ç½®\n\nRedis æœ‰å››ä¸ªå‘½ä»¤å¯ä»¥è®¾ç½®é”®çš„ç”Ÿå­˜æ—¶é—´(å¯ä»¥å­˜æ´»å¤šä¹…)å’Œè¿‡æœŸæ—¶é—´(ä»€ä¹ˆæ—¶å€™åˆ°æœŸ):\n\n* EXPIRE ä»¥ç§’ä¸ºå•ä½è®¾ç½®é”®çš„ç”Ÿå­˜æ—¶é—´;\n* PEXPIRE ä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®é”®çš„ç”Ÿå­˜æ—¶é—´;\n* EXPIREAT ä»¥ç§’ä¸ºå•ä½,è®¾ç½®é”®çš„è¿‡æœŸ UNIX æ—¶é—´æˆ³;\n* PEXPIREAT ä»¥æ¯«ç§’ä¸ºå•ä½,è®¾ç½®é”®çš„è¿‡æœŸ UNIX æ—¶é—´æˆ³ã€‚\n\n> è™½ç„¶æœ‰é‚£ä¹ˆå¤šç§ä¸åŒå•ä½å’Œä¸åŒå½¢å¼çš„è®¾ç½®æ–¹å¼,ä½†æ˜¯ expires å­—å…¸çš„å€¼åªä¿å­˜â€œä»¥æ¯«ç§’ä¸ºå•ä½çš„è¿‡æœŸ UNIX æ—¶é—´æˆ³â€ ,è¿™å°±æ˜¯è¯´,é€šè¿‡è¿›è¡Œè½¬æ¢,æ‰€æœ‰å‘½ä»¤çš„æ•ˆæœæœ€åéƒ½å’Œ PEXPIREAT å‘½ä»¤çš„æ•ˆæœä¸€æ ·ã€‚\n\n**å¦‚æœä¸€ä¸ªé”®æ˜¯è¿‡æœŸçš„,é‚£å®ƒä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ é™¤?**\n\nä¸‹è¾¹æ˜¯å‚è€ƒç­”æ¡ˆ\n\n1. å®šæ—¶åˆ é™¤:åœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´æ—¶,åˆ›å»ºä¸€ä¸ªå®šæ—¶äº‹ä»¶,å½“è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶,ç”±äº‹ä»¶å¤„ç† å™¨è‡ªåŠ¨æ‰§è¡Œé”®çš„åˆ é™¤æ“ä½œã€‚\n2. æƒ°æ€§åˆ é™¤:æ”¾ä»»é”®è¿‡æœŸä¸ç®¡,ä½†æ˜¯åœ¨æ¯æ¬¡ä» dict å­—å…¸ä¸­å–å‡ºé”®å€¼æ—¶,è¦æ£€æŸ¥é”®æ˜¯å¦è¿‡ æœŸ,å¦‚æœè¿‡æœŸçš„è¯,å°±åˆ é™¤å®ƒ,å¹¶è¿”å›ç©º;å¦‚æœæ²¡è¿‡æœŸ,å°±è¿”å›é”®å€¼ã€‚\n3. å®šæœŸåˆ é™¤:æ¯éš”ä¸€æ®µæ—¶é—´,å¯¹expireså­—å…¸è¿›è¡Œæ£€æŸ¥,åˆ é™¤é‡Œé¢çš„è¿‡æœŸé”®\n\nRedis ä½¿ç”¨çš„è¿‡æœŸé”®åˆ é™¤ç­–ç•¥æ˜¯æƒ°æ€§åˆ é™¤åŠ ä¸Šå®šæœŸåˆ é™¤\n\n### åº”ç”¨åœºæ™¯\n\n* ç¼“å­˜\n* é˜Ÿåˆ—\n* éœ€è¦ç²¾å‡†è®¾å®šè¿‡æœŸæ—¶é—´çš„åº”ç”¨\n\n> æ¯”å¦‚ä½ å¯ä»¥æŠŠä¸Šé¢è¯´åˆ°çš„sorted setçš„scoreå€¼è®¾ç½®æˆè¿‡æœŸæ—¶é—´çš„æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€å•åœ°é€šè¿‡è¿‡æœŸæ—¶é—´æ’åºï¼Œå®šæ—¶æ¸…é™¤è¿‡æœŸæ•°æ®äº†ï¼Œä¸ä»…æ˜¯æ¸…é™¤Redisä¸­çš„è¿‡æœŸæ•°æ®ï¼Œä½ å®Œå…¨å¯ä»¥æŠŠRedisé‡Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å½“æˆæ˜¯å¯¹æ•°æ®åº“ä¸­æ•°æ®çš„ç´¢å¼•ï¼Œç”¨Redisæ¥æ‰¾å‡ºå“ªäº›æ•°æ®éœ€è¦è¿‡æœŸåˆ é™¤ï¼Œç„¶åå†ç²¾å‡†åœ°ä»æ•°æ®åº“ä¸­åˆ é™¤ç›¸åº”çš„è®°å½•\n\n* æ’è¡Œæ¦œåº”ç”¨ï¼Œå–TOP Næ“ä½œ\n> è¿™ä¸ªéœ€æ±‚ä¸ä¸Šé¢éœ€æ±‚çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå‰é¢æ“ä½œä»¥æ—¶é—´ä¸ºæƒé‡ï¼Œè¿™ä¸ªæ˜¯ä»¥æŸä¸ªæ¡ä»¶ä¸ºæƒé‡ï¼Œæ¯”å¦‚æŒ‰é¡¶çš„æ¬¡æ•°æ’åºï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„sorted setå‡ºé©¬äº†ï¼Œå°†ä½ è¦æ’åºçš„å€¼è®¾ç½®æˆsorted setçš„scoreï¼Œå°†å…·ä½“çš„æ•°æ®è®¾ç½®æˆç›¸åº”çš„valueï¼Œæ¯æ¬¡åªéœ€è¦æ‰§è¡Œä¸€æ¡ZADDå‘½ä»¤å³å¯\n\n* ç»Ÿè®¡é¡µé¢è®¿é—®æ¬¡æ•°\n\n> ä½¿ç”¨ incr å‘½ä»¤ å®šæ—¶ä½¿ç”¨ getset å‘½ä»¤ è¯»å–æ•°æ® å¹¶è®¾ç½®æ–°çš„å€¼ 0\n\n* ä½¿ç”¨set è®¾ç½®æ ‡ç­¾\n\nä¾‹å¦‚å‡è®¾æˆ‘ä»¬çš„è¯é¢˜D 1000è¢«åŠ äº†ä¸‰ä¸ªæ ‡ç­¾tag 1,2,5å’Œ77ï¼Œå°±å¯ä»¥è®¾ç½®ä¸‹é¢ä¸¤ä¸ªé›†åˆï¼š\n\n```shell\n$ redis-cli sadd topics:1000:tags 1\n(integer) 1\n$ redis-cli sadd topics:1000:tags 2\n(integer) 1\n$ redis-cli sadd topics:1000:tags 5\n(integer) 1\n$ redis-cli sadd topics:1000:tags 77\n(integer) 1\n$ redis-cli sadd tag:1:objects 1000\n(integer) 1\n$ redis-cli sadd tag:2:objects 1000\n(integer) 1\n$ redis-cli sadd tag:5:objects 1000\n(integer) 1\n$ redis-cli sadd tag:77:objects 1000\n(integer) 1\n```\n\nè¦è·å–ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ ‡ç­¾ï¼š\n\n```bash\n$ redis-cli smembers topics:1000:tags\n1. 5\n2. 1\n3. 77\n4. 2\n```\n\nè·å¾—ä¸€ä»½åŒæ—¶æ‹¥æœ‰æ ‡ç­¾1, 2,10å’Œ27çš„å¯¹è±¡åˆ—è¡¨ã€‚\nè¿™å¯ä»¥ç”¨SINTERå‘½ä»¤æ¥åšï¼Œä»–å¯ä»¥åœ¨ä¸åŒé›†åˆä¹‹é—´å–å‡ºäº¤é›†\n\n\n### å†…å­˜ä¼˜åŒ–\n\n`é—®é¢˜`:  Instagramçš„ç…§ç‰‡æ•°é‡å·²ç»è¾¾åˆ°3äº¿ï¼Œè€Œåœ¨Instagramé‡Œï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ¯ä¸€å¼ ç…§ç‰‡çš„ä½œè€…æ˜¯è°ï¼Œä¸‹é¢å°±æ˜¯Instagramå›¢é˜Ÿå¦‚ä½•ä½¿ç”¨Redisæ¥è§£å†³è¿™ä¸ªé—®é¢˜å¹¶è¿›è¡Œå†…å­˜ä¼˜åŒ–çš„ã€‚\n\nå…·ä½“æ–¹æ³•ï¼Œå‚è€ƒä¸‹è¾¹è¿™ç¯‡æ–‡ç« ï¼š[èŠ‚çº¦å†…å­˜ï¼šInstagramçš„Rediså®è·µ](http://blog.nosqlfan.com/html/3379.html)ã€‚\n\n\n#### å‚è€ƒé“¾æ¥\n\n* [Redis æ–‡æ¡£ï¼šhttp://redisdoc.com/index.html](http://redisdoc.com/index.html)\n* [Redis è®¾è®¡ä¸å®è·µï¼šhttp://origin.redisbook.com/](http://origin.redisbook.com/)\n* [Redis æ•°æ®ç»“æ„ä½¿ç”¨åœºæ™¯ï¼šhttp://get.jobdeer.com/523.get](http://get.jobdeer.com/523.get)\n* [Redisä½œè€…è°ˆRedisåº”ç”¨åœºæ™¯ï¼šhttp://blog.nosqlfan.com/html/2235.html](http://blog.nosqlfan.com/html/2235.html)\n* [ä¸€æ¬¡ä½¿ç”¨ Redis ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½çš„å®è·µï¼šhttp://www.restran.net/2015/02/17/redis-practice/](http://www.restran.net/2015/02/17/redis-practice/)\n* [èŠ‚çº¦å†…å­˜ï¼šInstagramçš„Rediså®è·µï¼šhttp://blog.nosqlfan.com/html/3379.html](http://blog.nosqlfan.com/html/3379.html)\n\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\næ¬¢è¿å…³æ³¨(April_Louisa) | è¯·æˆ‘å–èŠ¬è¾¾\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)",
      "data": {
        "title": "Redis å­¦ä¹ ç¬”è®°",
        "date": "2017-09-17 14:41:51",
        "tags": [
          "redis",
          "nosql",
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "redis-note"
    },
    {
      "content": "\n> è¿™ä¸€ç¯‡æ˜¯`ã€Šæµç•…çš„ pythonã€‹`è¯»ä¹¦ç¬”è®°ã€‚ä¸»è¦ä»‹ç»å…ƒç»„ã€åˆ†ç‰‡ã€åºåˆ—èµ‹å€¼ä»¥åŠå¼•ç”¨äº†å¤§å¸ˆ Edsger W.Dijkstra`ä¸ºä»€ä¹ˆåºåˆ—ä»0å¼€å§‹è®¡æ•°`çš„è§£é‡Šã€‚\n\n## å…ƒç»„\n\nåœ¨æœ‰äº›python çš„ä»‹ç»ä¸­ï¼Œå…ƒç»„è¢«ç§°ä¸º`ä¸å¯å˜åˆ—è¡¨`ï¼Œè¿™å…¶å®æ˜¯ä¸å‡†ç¡®çš„ï¼Œæ²¡æœ‰å®Œå…¨æ¦‚æ‹¬å…ƒç»„çš„ç‰¹ç‚¹ã€‚å…ƒç»„é™¤äº†ç”¨ä½œä¸å¯å˜åˆ—è¡¨ï¼Œè¿˜å¯ä»¥ç”¨äº`æ²¡æœ‰å­—æ®µåçš„è®°å½•`ã€‚\n\n### å…ƒç»„å’Œè®°å½•\n\nå…ƒç»„å…¶å®æ˜¯å¯¹æ•°æ®çš„è®°å½•ï¼šå…ƒç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å­˜æ”¾äº†è®°å½•ä¸­ä¸€ä¸ªå­—æ®µçš„æ•°æ®ï¼Œå¤–åŠ è¿™ä¸ªæ•°æ®çš„ä½ç½®ã€‚\n\nå¦‚æœæŠŠå…ƒç»„å½“ä½œä¸€äº›å­—æ®µçš„é›†åˆï¼Œæ•°é‡å’Œä½ç½®ä¿¡æ¯ä¼šå˜å¾—éå¸¸é‡è¦ã€‚æ¯”å¦‚ä»¥ä¸‹å‡ æ¡ç”¨å…ƒç»„è¡¨ç¤ºçš„è®°å½•ï¼š\n\n```python\n >>> lax_coordinates = (33.9425, -118.408056) # æ´›æ‰çŸ¶å›½é™…æœºåœºçš„ç»çº¬åº¦\n # ä¸œäº¬çš„ä¸€äº›ä¿¡æ¯ï¼šå¸‚åã€å¹´ä»½ã€äººå£ã€äººå£å˜åŒ–å’Œé¢ç§¯\n >>> city, year, pop, chg, area = ('Tokyo', 2003, 32450, 0.66, 8014)\n```\n\nä»¥ä¸Šè¿™ä¸¤ä¸ªå…ƒç»„æ¯ä¸ªä½ç½®éƒ½å¯¹åº”ä¸€ä¸ªæ•°æ®è®°å½•ã€‚\n\n### å…ƒç»„æ‹†åŒ…\n\n```python\n>>> city, year, pop, chg, area = ('Tokyo', 2003, 32450, 0.66, 8014)\n```\n\nè¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠå…ƒç»„çš„æ•°æ®ç”¨ä¸€æ¡è¯­å¥åˆ†åˆ«èµ‹å€¼ç»™ city, year, pop, chg, areaï¼Œè¿™å°±æ˜¯å…ƒç»„æ‹†åŒ…çš„ä¸€ä¸ªå…·ä½“åº”ç”¨ã€‚\n\n> å…ƒç»„æ‹†åŒ…å¯ä»¥åº”ç”¨åˆ°ä»»ä½•å¯è¿­ä»£å¯¹è±¡ä¸Šï¼Œä½†æ˜¯è¢«è¿­ä»£çš„å¯¹è±¡çª„çš„å…ƒç´ çš„æ•°é‡å¿…é¡»è·Ÿæ¥å—è¿™äº›å…ƒç´ çš„å…ƒç»„çš„ç©ºæ¡£æ•°ä¸€è‡´ã€‚\n\næ¯”å¦‚ï¼š\n\n```python\n>>> lax_coordinates = (33.9425, -118.408056)\n>>> latitude, longitude = lax_coordinates\n>>> latitude\n33.9425\n>>> longitude\n-118.408056\n```\n\nè¿˜å¯ä»¥ç”¨ `*` è¿ç®—ç¬¦æŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æ‹†å¼€ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼š\n\n```python\n>>> divmod(20, 8)\n(2, 4)\n>>> t = (20, 8)\n>>> divmode(*t)\n(2, 4)\n>>> quotient, remainder = divmode(*t)\n>>> quotient, remainder\n(2, 4)\n```\n\nåœ¨è¿›è¡Œæ‹†åŒ…æ˜¯ï¼Œæˆ‘ä»¬å¯èƒ½å¯¹å…ƒç»„çš„æŸäº›å€¼å¹¶ä¸æ„Ÿå…´è¶£ï¼Œè¿™æ—¶å¯ä»¥ç”¨ `_` å ä½ç¬¦å¤„ç†ã€‚æ¯”å¦‚ï¼š\n\n```python\n>>> divmode(20, 8)\n(2, 4)\n>>> _, remainder = divmode(20, 8)  # è¿™é‡Œæˆ‘ä»¬åªå…³å¿ƒç¬¬äºŒä¸ªå€¼\n>>> remainder\n4\n```\n\nåœ¨å¤„ç†å‡½æ•°å‚æ•°æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨`*args` æ¥è¡¨ç¤ºä¸ç¡®å®šæ•°é‡çš„å‚æ•°ã€‚åœ¨`python3`ä¸­ï¼Œè¿™ä¸ªæ¦‚å¿µè¢«æ‰©å±•åˆ°äº†å¹³è¡Œèµ‹å€¼ä¸­ï¼š\n\n```python\n# python 3 ä»£ç ç¤ºä¾‹\n>>> a, b, *rest = range(5)\n>> a, b, rest\n(0, 1, [2, 3, 4])\n# * å‰ç¼€åªèƒ½ç”¨åœ¨ä¸€ä¸ªå˜é‡åå‰ï¼Œè¿™ä¸ªå˜é‡å¯ä»¥åœ¨å…¶ä»–ä½ç½®\n>>> a, *rest, c, d = range(5) \n>> a, rest, c, d\n(0, [1, 2], 3, 4)\n>>> a, b, *rest = range(2)\n>> a, b, rest\n(0, 1, [])\n```\nå…ƒç»„ä¹Ÿæ”¯æŒåµŒå¥—æ‹†åŒ…ï¼Œæ¯”å¦‚ï¼š\n\n```python\n>>> l = (1, 2, 3, (4, 5))\n>>> a, b, c, (d, e) = l\n>>> d\n4\n>>> 5\n4\n```\n\n### å…·åå…ƒç»„\n\nå…ƒç»„ä½œä¸ºè®°å½•é™¤äº†ä½ç½®ä»¥å¤–è¿˜å°‘ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯æ— æ³•ç»™å­—æ®µå‘½åï¼Œ`namedtuple`è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n\nnamedtuple ä½¿ç”¨æ–¹å¼å®ä¾‹ï¼š\n\n```python\n>>> from collecitons import namedtuple\n>>> city = namedtuple('City', 'name country population coordinates')\n>>> tokyo = City('Tokyo', 'JP', 36.933, (35.689722, 139.691667))\n>>> tokyo.population  # å¯ä»¥ä½¿ç”¨å­—æ®µåè·å–å­—æ®µä¿¡æ¯\n36.933\n>>> tokyo[1] # ä¹Ÿå¯ä»¥ä½¿ç”¨ä½ç½®è·å–å­—æ®µä¿¡æ¯\n'JP'\n>>> City._fields # _fields å±æ€§æ˜¯ä¸€ä¸ªåŒ…å«è¿™ä¸ªç±»æ‰€æœ‰å­—æ®µåçš„å…ƒç»„ \n('name', 'country', 'population', 'coordinates')\n>>> tokyo_data = ('Tokyo', 'JP', 36.933, (35.689722, 139.691667))\n>>> tokyo = City._make(tokyo_data) # _make() æ–¹æ³•æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ç”Ÿæˆè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œå’Œ City(*tokyo_data) ä½œç”¨ä¸€è‡´\n>>>  tokyo._asdict() # _asdict() æŠŠå…·åå…ƒç»„ä»¥ collections.OrderedDict çš„å½¢å¼å‘ˆç°\nOrderedDict([('name', 'Tokyo'), ('country', 'JP'), ('population', 36.933), ('coordinates', (35.689722, 139.691667))])\n```\n> `collections.namedtuple` æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ„å»ºä¸€ä¸ªå¸¦å­—æ®µåçš„å…ƒç»„å’Œä¸€ä¸ªæœ‰åå­—çš„ç±»ã€‚\n> `namedtuple` æ„å»ºçš„ç±»çš„å®ä¾‹é”æ¶ˆè€—çš„å†…å­˜å’Œå…ƒç»„æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºå­—æ®µåéƒ½è¢«å­˜æ”¾åœ¨å¯¹åº”çš„ç±»é‡Œã€‚è¿™ä¸ªå®ä¾‹å’Œæ™®é€šçš„å¯¹è±¡å®ä¾‹ç›¸æ¯”ä¹Ÿæ›´å°ä¸€äº›ï¼Œå› ä¸º åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼ŒPython ä¸éœ€è¦ç”¨ `__dict__` æ¥å­˜æ”¾è¿™äº›å®ä¾‹çš„å±æ€§\n\n## åˆ‡ç‰‡\n\nPython ä¸­åˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²éƒ½æ”¯æŒåˆ‡ç‰‡æ“ä½œã€‚\n\nåœ¨åˆ‡ç‰‡å’ŒåŒºé—´æ“ä½œé‡Œä¸åŒ…å«åŒºé—´èŒƒå›´çš„æœ€åä¸€ä¸ªå…ƒç´ æ˜¯ Python çš„é£æ ¼ã€‚è¿™æ ·åšçš„å¥½å¤„å¦‚ä¸‹ï¼š\n* å½“åªæœ‰æœ€åä¸€ä¸ªä½ç½®ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿçœ‹å‡ºåˆ‡ç‰‡å’ŒåŒºé—´é‡Œæœ‰å‡ ä¸ªå…ƒç´ ï¼šrange(3) å’Œ mylist[:3] éƒ½åªè¿”å›ä¸‰ä¸ªå…ƒç´ \n* å½“æ°”è´¨ä½ç½®å¯è§æ—¶ï¼Œå¯ä»¥å¿«é€Ÿè®¡ç®—å‡ºåˆ‡ç‰‡å’ŒåŒºé—´çš„é•¿åº¦ï¼Œç”¨åä¸€ä¸ªæ•°å‡å»ç¬¬ä¸€ä¸ªä¸‹æ ‡ï¼ˆstop-startï¼‰å³å¯ã€‚\n* è¿™æ ·è¿˜å¯ä»¥è®©æˆ‘ä»¬åˆ©ç”¨ä»»æ„ä¸€ä¸ªä¸‹æ ‡æ¥æŠŠåºåˆ—åˆ†å‰²æˆä¸é‡å¤çš„ä¸¤éƒ¨åˆ†ï¼Œåªè¦å†™æˆ mylist[:x] å’Œ mylist[x:] å°±å¯ä»¥ã€‚\n\nåˆ‡ç‰‡é™¤äº†å¼€å§‹å’Œç»“æŸçš„ä¸‹æ ‡ä¹‹å¤–è¿˜å¯ä»¥æœ‰ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ¯”å¦‚ï¼š`s[a:b:c]`ï¼Œè¿™é‡Œ c è¡¨ç¤ºå–å€¼çš„é—´éš”ï¼Œc è¿˜å¯ä»¥ä¸ºè´Ÿå€¼ï¼Œè´Ÿå€¼æ„å‘³ç€åå‘å–å€¼ã€‚\n\n```python\n>>> s = 'bicycle'\n>>> s[::3]\n'bye'\n>>> s[::-1]\n'elcycib'\n>>> s[::2]\n'eccb'\n```\n\na:b:c è¿™ç§ç”¨æ³•åªèƒ½ä½œä¸ºç´¢å¼•æˆ–è€…ä¸‹æ ‡åœ¨[] ä¸­è¿”å›ä¸€ä¸ªåˆ‡ç‰‡å¯¹è±¡ï¼šslice(a, b, c)ã€‚å¯¹ seq[start:stop:step] è¿›è¡Œæ±‚å€¼çš„æ—¶å€™ï¼ŒPython ä¼šè°ƒç”¨ seq.__getitem__(slice(start:stop:step)]ã€‚\n\n### ç»™åˆ‡ç‰‡èµ‹å€¼\n\nå¦‚æœæŠŠåˆ‡ç‰‡æ”¾åœ¨èµ‹å€¼è¯­å¥çš„å·¦è¾¹ï¼Œæˆ–è€…æŠŠå®ƒä½œä¸º del æ“ä½œçš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹åºåˆ—è¿›è¡Œå«æ¥ã€åˆ‡é™¤æˆ–ä¿®æ”¹æ“ä½œï¼Œæ¯”å¦‚ï¼š\n\n```python\n>>> l = list(range(10))\n>>> l\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n>>> l[2:5] = [20, 30]\n>>> l\n[0, 1, 20, 30, 5, 6, 7, 8, 9]\n>>> del l[5:7]\n[0, 1, 20, 30, 5, 8, 9]\n>>> l[3::2] = [11, 22]\n>>> l\n[0, 1, 20, 11, 5, 22, 9]\n>>> l[2:5] = 100\nTraceback (most recent call last):\n      file \"<stdin>\", line 1 in <moduld>\nTypeError: can only assign an iterable\n```\n\n> å¦‚æœèµ‹å€¼çš„å¯¹è±¡æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œé‚£ä¹ˆèµ‹å€¼è¯­å¥çš„å³ä¾§å¿…é¡»æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚\n\n### ç»™åˆ‡ç‰‡å‘½å\n\nå¦‚æœä»£ç ä¸­å·²ç»å‡ºç°äº†å¤§é‡çš„æ— æ³•ç›´è§†çš„ç¡¬ç¼–ç åˆ‡ç‰‡ä¸‹æ ‡ï¼Œå¯ä»¥ä½¿ç”¨ç»™åˆ‡ç‰‡å‘½åçš„æ–¹å¼æ¸…ç†ä»£ç ã€‚æ¯”å¦‚ä½ æœ‰ä¸€æ®µä»£ç è¦ä»ä¸€ä¸ªè®°å½•å­—ç¬¦ä¸²ä¸­å‡ ä¸ªå›ºå®šä½ç½®æå–å‡ºç‰¹å®šçš„æ•°æ®å­—æ®µ  æ¯”å¦‚æ–‡ä»¶æˆ–ç±»ä¼¼æ ¼å¼ :\n\n```python\n### 01234567890123456789012345678901234567890123456789012345678901234\nrecord = '............100....513.25........'\ncost = int(record[20:23]) * float(record[31:37])\n# è¿™æ—¶ï¼Œå¯ä»¥å…ˆç»™åˆ‡ç‰‡å‘½å,ä»¥é¿å…å¤§é‡æ— æ³•ç†è§£çš„ç¡¬ç¼–ç ä¸‹æ ‡ï¼Œä½¿ä»£ç å¯è¯»æ€§æ›´å¼º\nSHARES= slice(20, 23)\nPRICE = slice(31, 37)\ncost = int(record[SHARES]) * float(record[PRICE])\n```\n\nslice() å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ª`åˆ‡ç‰‡å¯¹è±¡`ï¼Œå¯ä»¥è¢«ç”¨åœ¨ä»»ä½•åˆ‡ç‰‡å…è®¸ä½¿ç”¨çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼š\n\n```python\n>>> items = [0, 1, 2, 3, 4, 5, 6]\n>>> a = slice(2, 4)\n>>> items[2:4]\n[2, 3]\n>>> items[a]\n[2, 3]\n>>> items[a] = [10, 11]\n>>> items\n[0, 1, 10, 11, 4, 5, 6]\n```\nå¦‚æœä½ æœ‰ä¸€ä¸ªåˆ‡ç‰‡å¯¹è±¡ aï¼Œè¿˜å¯ä»¥è°ƒç”¨ a.start, a.stop, a.step æ¥è·å–æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š\n\n```python\n>>> a = slice(5, 50, 2)\n>>> a.start\n5\n>>> a.step\n2\n```\n\n## æ‰©å±•é˜…è¯» ä¸ºä»€ä¹ˆä¸‹æ ‡è¦ä»0å¼€å§‹\n\nPython é‡Œçš„èŒƒå›´ï¼ˆrangeï¼‰å’Œåˆ‡ç‰‡éƒ½ä¸ä¼šåæ‚”ç¬¬äºŒä¸ªä¸‹æ ‡æ‰€æŒ‡çš„å…ƒç´ ï¼Œè®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„å¤§å¸ˆ Edsger W.Dijkstra åœ¨ä¸€ä¸ªå¾ˆçŸ­çš„å¤‡å¿˜å½• [Why numbering should start at zero](http://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html) é‡Œå¯¹è¿™ä¸€æƒ¯ä¾‹åšäº†è¯´æ˜ã€‚ä»¥ä¸‹æ˜¯éƒ¨åˆ†å…³é”®è¯´æ˜ï¼š\n\nä¸ºäº†è¡¨ç¤ºå‡ºè‡ªç„¶æ•°çš„å­åºåˆ—ï¼Œ2, 3, ... , 12ï¼Œä¸ä½¿ç”¨çœç•¥è®°å·é‚£ä¸‰ä¸ªç‚¹å·ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©4ç§çº¦å®šæ–¹å¼ï¼š\n\n* a) 2 â‰¤ i < 13\n* b) 1 < i â‰¤ 12\n* c) 2 â‰¤ i â‰¤ 12\n* d) 1 < i < 13\n\næ˜¯å¦æœ‰ä»€ä¹ˆç†ç”±ï¼Œä½¿é€‰æ‹©å…¶ä¸­ä¸€ç§çº¦å®šæ¯”å…¶å®ƒçº¦å®šè¦å¥½å‘¢ï¼Ÿæ˜¯çš„ï¼Œç¡®å®æœ‰ç†ç”±ã€‚å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œa) å’Œ b)æœ‰ä¸ªä¼˜ç‚¹ï¼Œ`ä¸Šä¸‹è¾¹ç•Œçš„ç›¸å‡å¾—åˆ°çš„å·®ï¼Œæ­£å¥½ç­‰äºå­åºåˆ—çš„é•¿åº¦`ã€‚å¦å¤–ï¼Œä½œä¸ºæ¨è®ºï¼Œä¸‹é¢è§‚å¯Ÿä¹Ÿæˆç«‹ï¼šåœ¨ a)ï¼Œb)ä¸­ï¼Œ`å‡å¦‚ä¸¤ä¸ªå­åºåˆ—ç›¸é‚»çš„è¯ï¼Œå…¶ä¸­ä¸€ä¸ªåºåˆ—çš„ä¸Šç•Œï¼Œå°±ç­‰äºå¦ä¸€ä¸ªåºåˆ—çš„ä¸‹ç•Œ`ã€‚ä½†ä¸Šé¢è§‚å¯Ÿï¼Œå¹¶ä¸èƒ½è®©æˆ‘ä»¬ä»a), b)ä¸¤è€…ä¸­é€‰å‡ºæ›´å¥½çš„ä¸€ä¸ªã€‚è®©æˆ‘ä»¬é‡æ–°å¼€å§‹åˆ†æã€‚\n\nä¸€å®šå­˜åœ¨æœ€å°çš„è‡ªç„¶æ•°ã€‚å‡å¦‚åƒb)å’Œd)é‚£æ ·ï¼Œå­åºåˆ—å¹¶ä¸åŒ…æ‹¬ä¸‹ç•Œï¼Œé‚£ä¹ˆå½“å­åºåˆ—ä»æœ€å°çš„è‡ªç„¶æ•°å¼€å§‹ç®—èµ·çš„æ—¶å€™ï¼Œä¼šä½¿å¾—ä¸‹ç•Œè¿›å…¥éè‡ªç„¶æ•°çš„åŒºåŸŸã€‚è¿™å°±æ¯”è¾ƒä¸‘é™‹äº†ã€‚æ‰€ä»¥å¯¹äºä¸‹ç•Œæ¥è¯´ï¼Œæˆ‘ä»¬æ›´åº”è¯¥é‡‡ç”¨â‰¤ï¼Œæ­£å¦‚a)æˆ–c)é‚£æ ·ã€‚\nç°åœ¨è€ƒè™‘ï¼Œå‡å¦‚å­åºåˆ—åŒ…æ‹¬ä¸Šç•Œï¼Œé‚£ä¹ˆå½“å­åºåˆ—ä»æœ€å°çš„è‡ªç„¶æ•°å¼€å§‹ç®—èµ·ï¼Œå¹¶ä¸”åºåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œä¸Šç•Œä¹Ÿä¼šè¿›å…¥éè‡ªç„¶æ•°çš„åŒºåŸŸã€‚è¿™ä¹Ÿæ˜¯ä¸‘é™‹çš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºä¸Šç•Œï¼Œæˆ‘ä»¬æ›´åº”è¯¥é‡‡ç”¨ <, æ­£å¦‚a)æˆ–b)é‚£æ ·ã€‚å› æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œçº¦å®ša)æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\n\n> * æ¯”å¦‚è¦è¡¨ç¤º `0, 1, 2, 3` å¦‚æœç”¨ b) d) çš„æ–¹å¼ï¼Œä¸‹ç•Œå°±è¦è¡¨ç¤ºæˆ `-1 < i`\n> * å¦‚æœä¸€ä¸ªç©ºåºåˆ—ç”¨ c) å…¶å®æ˜¯æ— æ³•è¡¨ç¤ºçš„,ç”¨ a) åˆ™å¯ä»¥è¡¨ç¤ºæˆ 0 â‰¤ i < 0\n\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»å…ƒç»„ã€åˆ†ç‰‡ã€åºåˆ—èµ‹å€¼ä»¥åŠå¯¹`ä¸ºä»€ä¹ˆåºåˆ—ä»0å¼€å§‹è®¡æ•°`åšäº†æ‘˜å½•ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [Why numbering should start at zero](http://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html)\n* [Why numbering should start at zero: http://www.cs.utexas.edu/users/EWD/ewd08xx/EWD831.PDF](http://www.cs.utexas.edu/users/EWD/ewd08xx/EWD831.PDF)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "Python å…ƒç»„å’Œåˆ†ç‰‡",
        "date": "2017-09-10 06:05:27",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-data-structures-tuple-and-slice"
    },
    {
      "content": "\n> è¿™ä¸€ç¯‡æ˜¯`ã€Šæµç•…çš„ pythonã€‹`è¯»ä¹¦ç¬”è®°ã€‚ä¸»è¦ä»‹ç»åˆ—è¡¨ã€åˆ—è¡¨æ¨å¯¼æœ‰å…³çš„è¯é¢˜ï¼Œæœ€åæ¼”ç¤ºå¦‚ä½•ç”¨åˆ—è¡¨å®ç°ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚\n\n## Python å†…ç½®åºåˆ—ç±»å‹\n\nPython æ ‡å‡†åº“ç”¨ C å®ç°äº†ä¸°å¯Œçš„åºåˆ—ç±»å‹ï¼š\n\n#### å®¹å™¨åºåˆ—ï¼š\n\nlistã€tuple å’Œ collections.deque è¿™äº›åºåˆ—èƒ½å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®ã€‚\n\n#### æ‰å¹³åºåˆ—ï¼š\n\nstrã€bytesã€bytearrayã€memoryview å’Œ array.arrayï¼Œè¿™ç±»åºåˆ—åªèƒ½å®¹çº³ä¸€ç§ç±»å‹ã€‚\n\n> å®¹å™¨åºåˆ—å­˜æ”¾çš„æ˜¯å®ƒä»¬æ‰€åŒ…å«çš„ä»»æ„ç±»å‹çš„å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œæ‰å¹³åºåˆ—é‡Œå­˜æ”¾çš„æ˜¯å€¼è€Œä¸æ˜¯å¼•ç”¨ï¼ˆä¹Ÿå¯ä»¥è¯´æ‰å¹³åºåˆ—å…¶å®å­˜æ”¾çš„æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼‰ã€‚\n\nå¦‚æœæŒ‰åºåˆ—æ˜¯å¦å¯è¢«ä¿®æ”¹æ¥åˆ†ç±»ï¼Œåºåˆ—åˆ†ä¸º`å¯å˜åºåˆ—` å’Œ `ä¸å¯å˜åºåˆ—`:\n\n#### å¯å˜åºåˆ—\n\nlistã€bytearrayã€array.arrayã€collections.deque å’Œ memoryviewã€‚\n\n#### ä¸å¯å˜åºåˆ—\n\ntupleã€strå’Œ bytesã€‚\n\nä¸‹å›¾æ˜¾ç¤ºäº†å¯å˜åºåˆ—ï¼ˆMutableSequenceï¼‰å’Œä¸å¯å˜åºåˆ—ï¼ˆsequenceï¼‰çš„å·®å¼‚ï¼š\n\n![å¯å˜åºåˆ—(MutableSequence)å’Œä¸å¯å˜åºåˆ—ï¼ˆsequenceï¼‰çš„å·®å¼‚](http://media.gusibi.mobi/Wlrr9jXCMsTupf03pVmVSkCb4ObKTI8g7QWycfjJS80UJ7tHptjZsHLLCz3evCZM)\n\nä»è¿™ä¸ªå›¾å¯ä»¥çœ‹å‡ºï¼Œå¯å˜åºåˆ—ä»ä¸å¯å˜åºåˆ—é‚£é‡Œç»§æ‰¿äº†ä¸€äº›æ–¹æ³•ã€‚\n\n## åˆ—è¡¨æ¨å¯¼å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼\n\nåˆ—è¡¨ï¼ˆlistï¼‰æ˜¯ Python ä¸­æœ€åŸºç¡€çš„åºåˆ—ç±»å‹ã€‚list æ˜¯ä¸€ä¸ªå¯å˜åºåˆ—ï¼Œå¹¶ä¸”èƒ½åŒæ—¶å­˜æ”¾ä¸åŒç±»å‹çš„å…ƒç´ ã€‚\nåˆ—è¡¨çš„åŸºç¡€ç”¨æ³•è¿™é‡Œå°±ä¸å†ä»‹ç»äº†ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹åˆ—è¡¨æ¨å¯¼ã€‚\n\n### åˆ—è¡¨æ¨å¯¼å’Œå¯è¯»æ€§\n\nåˆ—è¡¨æ¨å¯¼æ˜¯æ„å»ºåˆ—è¡¨çš„å¿«æ·æ–¹å¼ï¼Œå¹¶ä¸”æœ‰æ›´å¥½çš„å¯è¯»æ€§ã€‚\nå…ˆçœ‹ä¸‹é¢ä¸¤æ®µä»£ç ï¼š\n\n`#1. æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å˜æˆ unicode ç ä½çš„åˆ—è¡¨`\n\n```python\n>>> symbols = '$&@#%^&*'\n>>> codes = []\n>>> for symbol in symbols:\n        codes.append(ord(symbol))\n\n>>> codes\n[36, 38, 64, 35, 37, 94, 38, 42]\n```\n\n`#2. æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å˜æˆ unicode ç ä½çš„åˆ—è¡¨ ä½¿ç”¨åˆ—è¡¨æ¨å¯¼`\n\n```python\n>>> symbols = '$&@#%^&*'\n>>> codes = [ord(s) for s in symbols]\n>>> codes\n[36, 38, 64, 35, 37, 94, 38, 42]\n```\n\nå¯¹æ¯”å‘ç°ï¼Œå¦‚æœç†è§£åˆ—è¡¨æ¨å¯¼çš„è¯ï¼Œç¬¬äºŒæ®µä»£ç æ¯”ç¬¬ä¸€æ®µæ›´ç®€æ´å¯è¯»æ€§ä¹Ÿæ›´å¥½ã€‚\nå½“ç„¶ï¼Œåˆ—è¡¨æ¨å¯¼ä¹Ÿä¸åº”è¯¥è¢«æ»¥ç”¨ï¼Œé€šå¸¸çš„åŸåˆ™æ˜¯`åªç”¨åˆ—è¡¨æ¨å¯¼æ¥åˆ›å»ºæ–°çš„åˆ—è¡¨ï¼Œå¹¶ä¸”å°½é‡ä¿æŒç®€çŸ­ã€‚`\nå¦‚æœåˆ—è¡¨æ¨å¯¼è¶…è¿‡ä¸¤è¡Œï¼Œå°±åº”è¯¥è€ƒè™‘è¦ä¸è¦ä½¿ç”¨ `for` å¾ªç¯é‡å†™äº†ã€‚\n\n#### NOTE \n\n> åœ¨ Python2 ä¸­åˆ—è¡¨æ¨å¯¼æœ‰å˜é‡æ³„éœ²çš„é—®é¢˜\n\n`#Python2 çš„ä¾‹å­`\n```python\n>>> x = 'my precious'\n>>> dummy = [x for x in 'ABC']\n>>> x\n'C'\n```\n\nè¿™é‡Œ x åŸæ¥çš„å€¼è¢«å–ä»£äº†ï¼Œå˜æˆäº†åˆ—è¡¨æ¨å¯¼ä¸­çš„æœ€åä¸€ä¸ªå€¼ï¼Œéœ€è¦é¿å…è¿™ä¸ªé—®é¢˜ã€‚å¥½æ¶ˆæ¯æ˜¯ Python3è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n\n`#Python3 çš„ä¾‹å­`\n```python\n>>> x = 'ABC'\n>>> dummy = [ord(x) for x in x]\n>>> x \n'ABC'\n>>> dummy\n[65, 66, 67]\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œ x åŸæœ‰çš„å€¼è¢«ä¿ç•™äº†ï¼Œåˆ—è¡¨æ¨å¯¼ä¹Ÿåˆ›å»ºäº†æ­£ç¡®çš„åˆ—è¡¨ã€‚\n\n### ç¬›å¡å°”ç§¯\n\nåˆ—è¡¨æ¨å¯¼è¿˜å¯ä»¥ç”Ÿæˆä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„å¯è¿­ä»£ç±»å‹çš„ç¬›å¡å°”ç§¯ã€‚\n\n> ç¬›å¡å°”ç§¯æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨é‡Œçš„å…ƒç´ æ˜¯ç”±è¾“å…¥çš„å¯è¿­ä»£ç±»å‹çš„å…ƒç´ å¯¹æ„æˆçš„å…ƒç»„ï¼Œå› æ­¤ç¬›å¡å°”ç§¯åˆ—è¡¨çš„é•¿åº¦ç­‰äºè¾“å…¥å˜é‡çš„é•¿åº¦çš„æˆç»©ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n\n![ç¬›å¡å°”ç§¯](http://media.gusibi.mobi/Ug5fo3x6f2sM4pGOavCxHcmMpLbEnw6sCyZ6_9HMMHSbbrKQXahYQDsZC1bhxpp2)\n\n`# ä½¿ç”¨åˆ—è¡¨æ¨å¯¼è®¡ç®—ç¬›å¡å°”ç§¯ä»£ç å¦‚ä¸‹`\n```python\n>>> suits = ['spades', 'diamonds', 'clubs', 'hearts']\n>>> nums = ['A', 'K', 'Q']\n>>> cards = [(num, suit) for num in nums for suit in suits]\n>>> cards\n[('A', 'spades'),\n ('A', 'diamonds'),\n ('A', 'clubs'),\n ('A', 'hearts'),\n ('K', 'spades'),\n ('K', 'diamonds'),\n ('K', 'clubs'),\n ('K', 'hearts'),\n ('Q', 'spades'),\n ('Q', 'diamonds'),\n ('Q', 'clubs'),\n ('Q', 'hearts')]\n```\nè¿™é‡Œå¾—åˆ°çš„ç»“æœæ˜¯å…ˆæŒ‰æ•°å­—æ’åˆ—ï¼Œå†æŒ‰å›¾æ¡ˆæ’åˆ—ã€‚å¦‚æœæƒ³å…ˆæŒ‰å›¾æ¡ˆæ’åˆ—å†æŒ‰æ•°å­—æ’åˆ—ï¼Œåªéœ€è¦è°ƒæ•´ for ä»å¥çš„å…ˆåé¡ºåºã€‚\n\n### è¿‡æ»¤åºåˆ—å…ƒç´ \n\n> `é—®é¢˜`ï¼šä½ æœ‰ä¸€ä¸ªæ•°æ®åºåˆ—ï¼Œæƒ³åˆ©ç”¨ä¸€äº›è§„åˆ™ä»ä¸­æå–å‡ºéœ€è¦çš„å€¼æˆ–è€…æ˜¯ç¼©çŸ­åºåˆ—\n\næœ€ç®€å•çš„è¿‡æ»¤åºåˆ—å…ƒç´ çš„æ–¹æ³•æ˜¯ä½¿ç”¨åˆ—è¡¨æ¨å¯¼ã€‚æ¯”å¦‚ï¼š\n\n```python\n>>> mylist = [1, 4, -5, 10, -7, 2, 3, -1]\n>>> [n for n in mylist if n >0]\n[1, 4, 10, 2, 3]\n```\n\nä½¿ç”¨åˆ—è¡¨æ¨å¯¼çš„ä¸€ä¸ªæ½œåœ¨ç¼ºé™·å°±æ˜¯è‹¥å¹²è¾“å…¥éå¸¸å¤§çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªéå¸¸å¤§çš„ç»“æœé›†ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿­ä»£äº§ç”Ÿè¿‡æ»¤å…ƒç´ æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚\n\n### ç”Ÿæˆå™¨è¡¨è¾¾å¼\n\nç”Ÿæˆå™¨è¡¨è¾¾å¼éµå®ˆäº†è¿­ä»£å™¨åè®®ï¼Œå¯ä»¥é€ä¸ªäº§å‡ºå…ƒç´ ï¼Œè€Œä¸æ˜¯å…ˆå»ºç«‹ä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨ï¼Œç„¶åå†æŠŠè¿™ä¸ªåˆ—è¡¨ä¼ é€’åˆ°æŸä¸ªæ„é€ å‡½æ•°é‡Œã€‚\n\n> ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„è¯­æ³•è·Ÿåˆ—è¡¨æ¨å¯¼å·®ä¸å¤šï¼Œåªéœ€è¦æŠŠæ–¹æ‹¬å·æ¢æˆåœ†æ‹¬å·ã€‚\n\n`# ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼åˆ›å»ºåˆ—è¡¨`\n```python\n>>> pos = (n for n in mylist if n > 0)\n>>> pos\n<generator object <genexpr> at 0x1006a0eb0>\n>>> for x in pos:\n... print(x) \n...\n1\n4\n10 \n2 \n3\n```\n\n*å¦‚æœç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å”¯ä¸€çš„å‚æ•°ï¼Œé‚£ä¹ˆä¸éœ€è¦é¢å¤–å†ç”¨æ‹¬å·æŠŠå®ƒå›´èµ·æ¥ã€‚ä¾‹å¦‚ï¼š*\n\n```python\ntuple(n for n in mylist)\n```\n\n*å¦‚æœç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œæ­¤æ—¶æ‹¬å·æ˜¯å¿…é¡»çš„ã€‚æ¯”å¦‚ï¼š*\n\n```python\n>>> import array\n>>> array.array('list', (n for n in mylist))\narray('list', [1, 4, 10, 2, 3])\n```\n\n## å®ç°ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—\n\n### é—®é¢˜\n\næ€ä¹ˆå®ç°ä¸€ä¸ªæŒ‰ä¼˜å…ˆçº§æ’åºçš„é˜Ÿåˆ—ï¼Ÿå¹¶åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸Šæ¯æ¬¡ pop æ“ä½œæ€»æ˜¯è¿”å›ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸ªå…ƒç´ \n\n### è§£å†³æ–¹æ³•\n\n> åˆ©ç”¨ `heapq` æ¨¡å—\n\n`heapq` æ˜¯ python çš„å†…ç½®æ¨¡å—ï¼Œæºç ä½äº Lib/heapq.py ï¼Œè¯¥æ¨¡å—æä¾›äº†åŸºäºå †çš„ä¼˜å…ˆæ’åºç®—æ³•ã€‚\n\n> å †çš„é€»è¾‘ç»“æ„å°±æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œå¹¶ä¸”äºŒå‰æ ‘ä¸­çˆ¶èŠ‚ç‚¹çš„å€¼å°äºç­‰äºè¯¥èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹çš„å€¼ã€‚è¿™ç§å®ç°å¯ä»¥ä½¿ç”¨ heap[k] <= heap[2k+1] å¹¶ä¸” heap[k] <= heap[2k+2] ï¼ˆå…¶ä¸­ k ä¸ºç´¢å¼•ï¼Œä» 0 å¼€å§‹è®¡æ•°ï¼‰çš„å½¢å¼ä½“ç°ï¼Œå¯¹äºå †æ¥è¯´ï¼Œæœ€å°å…ƒç´ å³ä¸ºæ ¹å…ƒç´  heap[0]ã€‚\n\nå¯ä»¥é€šè¿‡ list å¯¹ heap è¿›è¡Œåˆå§‹åŒ–ï¼Œæˆ–è€…é€šè¿‡ api ä¸­çš„ heapify å°†å·²çŸ¥çš„ list è½¬åŒ–ä¸º heap å¯¹è±¡ã€‚\n\nheapq æä¾›çš„ä¸€äº›æ–¹æ³•å¦‚ä¸‹ï¼š\n\n* heap = [] #åˆ›å»ºäº†ä¸€ä¸ªç©ºå † \n* heapq.heappush(heap, item)ï¼šå‘ heap ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ \n* heapq.heappop(heap)ï¼šè¿”å› root èŠ‚ç‚¹ï¼Œå³ heap ä¸­æœ€å°çš„å…ƒç´ \n* heapq.heappushpop(heap, item)ï¼šå‘ heap ä¸­åŠ å…¥ item å…ƒç´ ï¼Œå¹¶è¿”å› heap ä¸­æœ€å°å…ƒç´ \n* heapq.heapify(x)\n* heapq.nlargest(n, iterable, key=None)ï¼šè¿”å›å¯æšä¸¾å¯¹è±¡ä¸­çš„ n ä¸ªæœ€å¤§å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªç»“æœé›† listï¼Œkey ä¸ºå¯¹è¯¥ç»“æœé›†çš„æ“ä½œ\n* heapq.nsmallest(n, iterable, key=None)ï¼šåŒä¸Šç›¸å\n\nå®ç°å¦‚ä¸‹ï¼š\n```python\nimport heapq\nclass PriorityQueue: \n    def __init__(self):\n        self._queue = []\n        self._index = 0\n        \n    def push(self, item, priority):\n        heapq.heappush(self._queue, (-priority, self._index, item)) \n        self._index += 1\n        \n    def pop(self):\n        return heapq.heappop(self._queue)[-1]\n```\n\nä¸‹é¢æ˜¯å®ƒçš„ä½¿ç”¨æ–¹æ³•ï¼š\n\n```python\n>>> class Item:\n        def __init__(self, name):\n            self.name = name\n        def __repr__(self):\n            return 'Item({!r})'.format(self.name)\n            \n>>> q = PriorityQueue()\n>>> q.push(Item('foo'), 1)\n>>> q.push(Item('bar'), 5)\n>>> q.push(Item('spam'), 4)\n>>> q.push(Item('grok'), 1)\n>>> q.pop()\nItem('bar') \n>>> q.pop() \nItem('spam') \n>>> q.pop() \nItem('foo') \n>>> q.pop() \nItem('grok')\n```\n\né€šè¿‡æ‰§è¡Œç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç¬¬ä¸€ä¸ª pop() æ“ä½œè¿”å›ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚ä¸¤ä¸ªä¼˜å…ˆçº§ç›¸åŒçš„å…ƒç´ ï¼ˆfoo å’Œ grokï¼‰ï¼Œpop æ“ä½œæŒ‰ç…§å®ƒä»¬è¢«æ’å…¥åˆ°é˜Ÿåˆ—çš„é¡ºåºè¿”å›ã€‚\n\nå‡½æ•° heapq.heappush() å’Œ heapq.heappop() åˆ†åˆ«åœ¨é˜Ÿåˆ— queue ä¸Šæ’å…¥å’Œåˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”é˜Ÿåˆ— queue ä¿è¯ ç¬¬ä¸€ä¸ªå…ƒç´ æ‹¥æœ‰æœ€å°ä¼˜å…ˆçº§ã€‚ heappop() å‡½æ•°æ€»æ˜¯è¿”å› *`æœ€å°çš„`* çš„å…ƒç´ ï¼Œè¿™å°±æ˜¯ä¿è¯é˜Ÿåˆ— pop æ“ä½œè¿”å›æ­£ç¡®å…ƒç´ çš„å…³é”®ã€‚å¦å¤–ï¼Œç”±äº push å’Œ pop æ“ä½œ`æ—¶é—´å¤æ‚åº¦ä¸º O(log N)ï¼Œå…¶ä¸­ N æ˜¯å †çš„å¤§å°`ï¼Œå› æ­¤å°±ç®—æ˜¯ N å¾ˆå¤§çš„æ—¶å€™å®ƒä»¬ è¿è¡Œé€Ÿåº¦ä¹Ÿä¾æ—§å¾ˆå¿«ã€‚\n*`åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œé˜Ÿåˆ—åŒ…å«äº†ä¸€ä¸ª (-priority, index, item) çš„å…ƒç»„ã€‚ä¼˜å…ˆçº§ä¸ºè´Ÿ æ•°çš„ç›®çš„æ˜¯ä½¿å¾—å…ƒç´ æŒ‰ç…§ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æ’åºã€‚è¿™ä¸ªè·Ÿæ™®é€šçš„æŒ‰ä¼˜å…ˆçº§ä»ä½åˆ°é«˜æ’åºçš„å †æ’åºæ°å·§ç›¸åã€‚`*\nindex å˜é‡çš„ä½œç”¨æ˜¯ä¿è¯åŒç­‰ä¼˜å…ˆçº§å…ƒç´ çš„æ­£ç¡®æ’åºã€‚é€šè¿‡ä¿å­˜ä¸€ä¸ªä¸æ–­å¢åŠ çš„ index ä¸‹æ ‡å˜é‡ï¼Œå¯ä»¥ç¡®ä¿å…ƒç´ æŒ‰ç…§å®ƒä»¬æ’å…¥çš„é¡ºåºæ’åºã€‚è€Œä¸”ï¼Œ index å˜é‡ä¹Ÿåœ¨ç›¸ åŒä¼˜å…ˆçº§å…ƒç´ æ¯”è¾ƒçš„æ—¶å€™èµ·åˆ°é‡è¦ä½œç”¨ã€‚\n\nå®ç°ä¸Šè¾¹æ’åºçš„å…³é”®æ˜¯ å…ƒç»„æ˜¯æ”¯æŒæ¯”è¾ƒçš„ï¼š\n\n```python\n>>> a = (1, Item('foo')) \n>>> b = (5, Item('bar')) \n>>> a < b\nTrue\n>>> c = (1, Item('grok'))\n>>> a < c\nTraceback (most recent call last):\nFile \"<stdin>\", line 1, in <module> \nTypeError: unorderable types: Item() < Item()\n```\n\nå½“ç¬¬ä¸€ä¸ªå€¼å¤§å°ç›¸ç­‰æ—¶ï¼Œç”±äº`Item` å¹¶ä¸æ”¯æŒæ¯”è¾ƒä¼šæŠ›å‡º `TypeError`ã€‚ä¸ºäº†é¿å…ä¸Šè¿°é”™è¯¯ï¼Œæˆ‘ä»¬å¼•å…¥äº†`index`ï¼ˆä¸å¯èƒ½ç”¨ä¸¤ä¸ªå…ƒç´ æœ‰ç›¸åŒçš„ index å€¼ï¼‰ï¼Œ å˜é‡ç»„æˆäº†(priority, index, item) ä¸‰å…ƒç»„ã€‚ç°åœ¨å†æ¯”è¾ƒå°±ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜äº†ï¼š\n\n```python\n>>> a = (1, 0, Item('foo')) \n>>> b = (5, 1, Item('bar')) \n>>> c = (1, 2, Item('grok')) \n>>> a < b\nTrue\n>>> a < c \nTrue\n```\n\n> ä¸»è¦ä»‹ç»åˆ—è¡¨ã€åˆ—è¡¨æ¨å¯¼æœ‰å…³çš„è¯é¢˜ï¼Œæœ€åæ¼”ç¤ºå¦‚ä½•ç”¨`heapq`å’Œ`åˆ—è¡¨`å®ç°ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ä¸‹ä¸€ç¯‡ä»‹ç»`å…ƒç»„`\n\n## å‚è€ƒé“¾æ¥\n\n* [Heap queue algorithm](https://docs.python.org/2/library/heapq.html)\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n",
      "data": {
        "title": "Python åˆ—è¡¨æ¨å¯¼åŠä¼˜å…ˆçº§é˜Ÿåˆ—çš„å®ç°",
        "date": "2017-09-03 06:05:27",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-data-structures-an-array-of-sequences"
    },
    {
      "content": "\n> è£…é¥°å™¨æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œå…¶å‚æ•°æ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼ˆè¢«è£…é¥°çš„å‡½æ•°ï¼‰ã€‚\n\n## è£…é¥°å™¨åŸºç¡€çŸ¥è¯†\n\né¦–å…ˆçœ‹ä¸€ä¸‹è¿™æ®µä»£ç \n\n```python\ndef deco(fn):\n    print \"I am %s!\" % fn.__name__\n\n@deco\ndef func():\n    pass\n\n# output\nI am func!\n\n# æ²¡æœ‰æ‰§è¡Œfunc å‡½æ•° ä½†æ˜¯ deco è¢«æ‰§è¡Œäº†\n```\n\nHUGOMORE42\n\nåœ¨ç”¨æŸä¸ª@decoratoræ¥ä¿®é¥°æŸä¸ªå‡½æ•°funcæ—¶\n\n```python\n@decorator\ndef func():\n    pass\n\n```\nå…¶è§£é‡Šå™¨ä¼šè§£é‡Šæˆä¸‹é¢è¿™æ ·çš„è¯­å¥ï¼š\n\n`func = decorator(func)`\n\n> å…¶å®å°±æ˜¯æŠŠä¸€ä¸ªå‡½æ•°å½“å‚æ•°ä¼ åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œç„¶åå†å›è°ƒï¼Œä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯è£…é¥°å™¨å¿…é¡»è¿”å›ä¸€ä¸ªå‡½æ•°ç»™func\n\nè£…é¥°å™¨çš„ä¸€å¤§ç‰¹æ€§æ˜¯ï¼Œèƒ½æŠŠè¢«è£…é¥°çš„å‡½æ•°æ›¿æ¢æˆå…¶ä»–å‡½æ•°ã€‚ç¬¬äºŒå¤§ç‰¹æ€§æ˜¯ï¼Œè£…é¥°å™¨åœ¨åŠ è½½æ¨¡å—æ—¶ç«‹å³æ‰§è¡Œã€‚\n\n### è£…é¥°å™¨ä½•æ—¶æ‰§è¡Œ\n\nè£…é¥°å™¨çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯ï¼Œå®ƒä»¬åœ¨è¢«è£…é¥°çš„å‡½æ•°å®šä¹‰åç«‹å³è¿è¡Œã€‚è¿™é€šå¸¸åœ¨å¯¼å…¥æ˜¯ï¼ˆpython åŠ è½½æ¨¡å—æ—¶ï¼‰ã€‚\n\nçœ‹ä¸‹ä¸‹é¢çš„ç¤ºä¾‹ï¼š\n\n```python\nregistry = []  # registry ä¿å­˜è¢«@register è£…é¥°çš„å‡½æ•°çš„å¼•ç”¨\n\ndef register(func):  # register çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°\n    print('running register(%s)' % func)  # æ‰“å°è¢«è£…é¥°çš„å‡½æ•°\n    registry.append(func)  # æŠŠ func å­˜å…¥ `registery`\n    return func  # è¿”å› funcï¼šå¿…é¡»è¿”å›å‡½æ•°ï¼Œè¿™é‡Œè¿”å›çš„å‡½æ•°ä¸é€šè¿‡å‚æ•°ä¼ å…¥çš„ä¸€æ ·\n\n@register  # `f1` å’Œ `f2`è¢« `@register` è£…é¥°\ndef f1():\n    print('running f1()')\n\n@register\ndef f2():\n    print('running f2()')\n\ndef f3():  # <7>\n    print('running f3()')\n\ndef main():  # main æ‰“å° `registry`ï¼Œç„¶åè°ƒç”¨ f1()ã€f2()å’Œ f3()\n    print('running main()')\n    print('registry ->', registry)\n    f1()\n    f2()\n    f3()\n\nif __name__=='__main__':\n    main()  # <9>\n```\n\nè¿è¡Œä»£ç ç»“æœå¦‚ä¸‹ï¼š\n\n```python\nrunning register(<function f1 at 0x1023fb378>)\nrunning register(<function f2 at 0x1023fb400>)\nrunning main()\nregistry -> [<function f1 at 0x1023fb378>, <function f2 at 0x1023fb400>]\nrunning f1()\nrunning f2()\nrunning f3()\n```\n\nä»ç»“æœå¯ä»¥å‘ç°`register` åœ¨æ¨¡å—ä¸­å…¶ä»–å‡½æ•°ä¹‹å‰è¿è¡Œäº†ä¸¤æ¬¡ã€‚è°ƒç”¨ register æ—¶ï¼Œä¼ ç»™å®ƒçš„å‚æ•°æ˜¯è¢«è£…é¥°çš„å‡½æ•°ï¼ˆä¾‹å¦‚<function f1 at 0x1023fb378>ï¼‰ã€‚\n\nçœ‹å®Œä¸Šè¾¹çš„ç¤ºä¾‹æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°è¢«è£…é¥°å™¨è£…é¥°åä¼šå˜æˆè£…é¥°å™¨å‡½æ•°çš„ä¸€ä¸ªå‚æ•°ï¼Œé‚£è¿™æ—¶å°±ä¸å¾—ä¸è¯´å˜é‡çš„ä½œç”¨åŸŸäº†ã€‚\n\n## å˜é‡ä½œç”¨åŸŸ\n\n\nå…ˆçœ‹ä¸‹ä¸‹è¾¹è¿™æ®µä»£ç ï¼š\n\n```python\ndef f1(a):\n    print(locals())\n    print(a)\n    print(b)\n    \n    \nf1(3)\n# output\n{'a': 3}\n3\nTraceback(most recent call last):\n    File \"<stdin>\", line 1, in <module>\n    File \"<stdin>\", line 3, in f1\nNameError: global name 'b' is not defined\n```\n\nè¿™é‡Œçš„é”™è¯¯æ˜¯å› ä¸ºå…¨å±€å˜é‡ `b` æ²¡æœ‰å®šä¹‰ï¼Œå¦‚æœæˆ‘ä»¬å…ˆåœ¨å‡½æ•°å¤–éƒ¨ç»™ b èµ‹å€¼ï¼Œå†è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°±ä¸ä¼šæŠ¥é”™äº†ã€‚\n\n> å‡½æ•°è¿è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼ˆå‘½åç©ºé—´ï¼‰ã€‚å‡½æ•°çš„å‘½åç©ºé—´éšç€å‡½æ•°è°ƒç”¨å¼€å§‹è€Œå¼€å§‹ï¼Œç»“æŸè€Œé”€æ¯ã€‚\n> è¿™ä¸ªä¾‹å­ä¸­ f1 çš„å‘½åç©ºé—´ä¸­åªæœ‰ {'a': 3}ï¼Œæ‰€ä»¥ `b` ä¼šè¢«è®¤ä¸ºæ˜¯å…¨å±€å˜é‡ã€‚\n\nå†çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n\n```python\nb = 6\ndef f2(a):\n    print(a)\n    print(globals())\n    print(locals())\n    print(b)\n    b = 9\n    \nf2(3)\n# output\n3\n{\n    '__name__': '__main__',\n    '__doc__': None, \n    '__package__': None, \n    '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x10c7f2dd8>, \n    '__spec__': None, \n    '__annotations__': {}, \n    '__builtins__': <module 'builtins' (built-in)>, \n    '__file__': '~/var_local.py', \n    '__cached__': None, \n    'b': 6, \n    'f2': <function f2 at 0x10c7e7598>\n}\n{'a': 3}\n3\nTraceback(most recent call last):\n    File \"<stdin>\", line 1, in <module>\n    File \"<stdin>\", line 3, in f1\nUnboundLocalError: local variable 'b' referenced before assignment\n```\n\nè¿™ä¸ªä¾‹å­å’Œä¸Šä¸€ä¸ªä¾‹å­ä¸åŒæ˜¯ï¼Œæˆ‘ç°åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰äº†å…¨å±€å˜é‡`b`ï¼Œä½†æ˜¯æ‰§è¡Œ`f2` è¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰æ‰“å°6ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nè¿™æ˜¯å› ä¸ºæ‰§è¡Œå‡½æ•°æ—¶ Python ä¼šå°è¯•ä»å±€éƒ¨å˜é‡ä¸­è·å– `b`ï¼Œå‡½æ•°å¯¹äºå·²ç»å¼•ç”¨ä½†æœªèµ‹å€¼çš„å˜é‡å¹¶ä¸ä¼šè‡ªåŠ¨å£°æ˜ä¸ºå±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥è§£é‡Šå™¨å‘ç°åè¾¹çš„èµ‹å€¼ä¹‹å‰æœ‰å¼•ç”¨å°±ä¼šæŠ›å‡º `UnboundLocalError` é”™è¯¯ã€‚\n\n> Python ä¸è¦æ±‚å£°æ˜å˜é‡ï¼Œä½†æ˜¯å‡å®šåœ¨å‡½æ•°å®šä¹‰ä½“ä¸­èµ‹å€¼çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ã€‚\n\nå¦‚æœè¦è®©è§£é‡Šå™¨æŠŠ`b`å½“åšå…¨å±€å˜é‡ï¼Œè¦ä½¿ç”¨`global`å£°æ˜ï¼š\n\n```python\nb = 6\ndef f3(a):\n    global b\n    print(a)\n    print(b)\n    b = 9\n    \nf2(3)\n# output\n3\n6\n```\n\n## é—­åŒ…\n\n> `é—­åŒ…`æ˜¯ä¸€ç§å‡½æ•°ï¼Œå®ƒä¼šä¿ç•™å®šä¹‰å‡½æ•°æ—¶å­˜åœ¨çš„è‡ªç”±å˜é‡çš„ç»‘å®šï¼Œè¿™æ ·è°ƒç”¨å‡½æ•°æ—¶ï¼Œè™½ç„¶å®šä¹‰ä½œç”¨åŸŸä¸å¯ç”¨ï¼Œä½†ä»èƒ½ä½¿ç”¨é‚£äº›ç»‘å®šã€‚\n\nä»‹ç»é—­åŒ…å‰å…ˆè¦è¯´æ˜ä¸€ä¸‹ Python çš„å‡½æ•°å‚æ•°\n\n### å‡½æ•°çš„ä¸¤ç§å‚æ•°\n\nå‡½æ•°æœ‰ä¸¤ç§å‚æ•°\n\n1. ä½ç½®å‚æ•°\n2. å‘½åå‚æ•°\n\n```python\ndef foo(x, y=0):\n\treturn x - y\n```\n\n### python ä¸­ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡\n\nå‡½æ•°å’Œpythonä¸­å…¶ä»–ä¸€æ ·éƒ½æ˜¯å¯¹è±¡\n\n```python\nIn [7]: class A(object):\n   ...:     pass\n\n\nIn [8]: A\nOut[8]: __main__.A\nIn [9]: type(A)\nOut[9]: type\nIn [10]: def foo():\n   ....:     pass\n\n\nIn [11]: type(foo)\nOut[11]: function\n\nIn [12]: A.__class__\nOut[12]: type\n\nIn [13]: foo.__class__\nOut[13]: function\n\nIn [14]: a = 1\nIn [15]: a.__class__\nOut[15]: int\n\n# ç±» æ˜¯å¯¹è±¡\nIn [16]: issubclass(A.__class__, object)\nOut[16]: True\n\n# å˜é‡ æ˜¯å¯¹è±¡\nIn [17]: issubclass(a.__class__, object)\nOut[17]: True\n\n# å‡½æ•° æ˜¯å¯¹è±¡\nIn [18]: issubclass(foo.__class__, object)\nOut[18]: True\n```\n\næ‰€ä»¥å‡½æ•°ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶å®ƒå‡½æ•°ï¼Œä¹Ÿå¯ä»¥è¢«å½“åšè¿”å›å€¼è¿”å›\n\n```python\ndef add(x, y):\n\treturn x + y\n\ndef apply(func):\n\treturn func\n\n>> a = apply(add)\n>> type(a)\n<type 'function'>\n\n>> a(1, 2)\n>> 3\n```\n\n### é—­åŒ…çš„ä½¿ç”¨\n\nå…ˆæ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼šå‡è®¾æœ‰ä¸ªåä¸º avg çš„å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®¡ç®—ä¸æ–­å¢åŠ çš„ç³»åˆ—å€¼çš„å‡å€¼ï¼›\nå®ƒæ˜¯è¿™ä¹ˆä½¿ç”¨çš„ï¼š\n\n```python\n>>> avg(10)\n10\n>>> avg(11)\n10.5\n>>> avg(12)\n11\n```\n\né‚£ä¹ˆæˆ‘ä»¬è€ƒè™‘ä¸‹ï¼Œavg ä»ä½•è€Œæ¥ï¼Œå®ƒåˆåœ¨å“ªé‡Œä¿å­˜å†å²å€¼å‘¢ï¼Œè¿™ä¸ªç”¨é—­åŒ…å¦‚ä½•å®ç°å‘¢ï¼Ÿ\nä¸‹è¾¹çš„ä»£ç æ˜¯é—­åŒ…çš„å®ç°ï¼š\n\n```python\ndef make_averager():\n    series = []\n\n    def averager(new_value):\n        series.append(new_value)\n        total = sum(series)\n        return total/len(series)\n\n    return averager\n```\n\nè°ƒç”¨  `make_averager` æ—¶ï¼Œè¿”å›ä¸€ä¸ª averager å‡½æ•°å¯¹è±¡ã€‚æ¯æ¬¡è°ƒç”¨ averager æ—¶ï¼Œå®ƒéƒ½ä¼šæŠŠå‚æ•°æ·»åŠ åˆ°ç³»åˆ—å€¼ä¸­ï¼Œç„¶åè®¡ç®—å½“å‰å¹³å‡å€¼ã€‚\n\n```python\navg = make_averager()\n\n>>> avg(10)\n10\n>>> avg(11)\n10.5\n>>> avg(12)\n11\n```\n\n> `series` æ˜¯`make_averager` å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œå› ä¸ºé‚£ä¸ªå‡½æ•°çš„å®šä¹‰ä½“ä¸­åˆå§‹åŒ–äº†`series: series=[]`ã€‚ä½†åœ¨`averager` å‡½æ•°ä¸­ï¼Œ`series` æ˜¯è‡ªç”±å˜é‡ï¼ˆæŒ‡æœªåœ¨æœ¬åœ°ä½œç”¨åŸŸä¸­ç»‘å®šçš„å˜é‡ï¼‰ã€‚\n\n![å˜é‡ç¤ºæ„å›¾](http://media.gusibi.mobi/wNM0i84JsmsgldhxUjV1TP1M43awUXzWTWU8YY7goHgKOjrZCW8l5qxeo6bYSY46)\n> `averager` çš„é—­åŒ…å»¶ä¼¸åˆ°é‚£ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸä¹‹å¤–ï¼ŒåŒ…å«è‡ªç”±å˜é‡`series`çš„ç»‘å®šã€‚\n\n* avg å°±æ˜¯ä¸€ä¸ªé—­åŒ…\n* ä¹Ÿå¯ä»¥è¯´ make_averager æŒ‡å‘ä¸€ä¸ªé—­åŒ…\n* æˆ–è€…è¯´ make_averager æ˜¯é—­åŒ…çš„å·¥å‚å‡½æ•°\n\n> é—­åŒ…å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå†…å±‚å‡½æ•°(averager)ï¼Œç”±ä¸€ä¸ªå˜é‡æŒ‡ä»£ï¼Œè€Œè¿™ä¸ªå˜é‡ç›¸å¯¹äºå¤–å±‚åŒ…å«å®ƒçš„å‡½æ•°è€Œè¨€ï¼Œæ˜¯æœ¬åœ°å˜é‡\n> åµŒå¥—å®šä¹‰åœ¨éå…¨å±€ä½œç”¨åŸŸé‡Œé¢çš„å‡½æ•°èƒ½å¤Ÿè®°ä½å®ƒåœ¨è¢«å®šä¹‰çš„æ—¶å€™å®ƒæ‰€å¤„çš„å°é—­å‘½åç©ºé—´\n\n> `é—­åŒ…` åªæ˜¯åœ¨å½¢å¼å’Œè¡¨ç°ä¸Šåƒå‡½æ•°ï¼Œä½†å®é™…ä¸Šä¸æ˜¯å‡½æ•°ã€‚å‡½æ•°æ˜¯ä¸€äº›å¯æ‰§è¡Œçš„ä»£ç ï¼Œè¿™äº›ä»£ç åœ¨å‡½æ•°è¢«å®šä¹‰åå°±ç¡®å®šäº†ï¼Œä¸ä¼šåœ¨æ‰§è¡Œæ—¶å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥ä¸€ä¸ªå‡½æ•°åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚é—­åŒ…åœ¨è¿è¡Œæ—¶å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œä¸åŒçš„å¼•ç”¨ç¯å¢ƒå’Œç›¸åŒçš„å‡½æ•°ç»„åˆå¯ä»¥äº§ç”Ÿä¸åŒçš„å®ä¾‹ã€‚\n\n## è£…é¥°å™¨\n\n### å®ç°ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨\n\nå¯¹ä¸€ä¸ªå·²æœ‰çš„æ¨¡å—åšä¸€äº›â€œä¿®é¥°å·¥ä½œâ€ï¼Œæ‰€è°“ä¿®é¥°å·¥ä½œå°±æ˜¯æƒ³ç»™ç°æœ‰çš„æ¨¡å—åŠ ä¸Šä¸€äº›å°è£…é¥°ï¼ˆä¸€äº›å°åŠŸèƒ½ï¼Œè¿™äº›å°åŠŸèƒ½å¯èƒ½å¥½å¤šæ¨¡å—éƒ½ä¼šç”¨åˆ°ï¼‰ï¼Œä½†åˆä¸è®©è¿™ä¸ªå°è£…é¥°ï¼ˆå°åŠŸèƒ½ï¼‰ä¾µå…¥åˆ°åŸæœ‰çš„æ¨¡å—ä¸­çš„ä»£ç é‡Œå»\n\n```python\ndef my_decorator(func):\n    def wrapper():\n        print \"Before the function runs\"\n        func() # è¿™è¡Œä»£ç å¯ç”¨ï¼Œæ˜¯å› ä¸º wrapper çš„é—­åŒ…ä¸­åŒ…å«è‡ªç”±å˜é‡ func\n        print \"After the function runs\"\n    return wrapper\n\ndef my_func():\n    print \"I am a stand alone function\"\n\n\n>> my_func()\n\n# output\nI am a stand alone function\n\n# ç„¶åï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè£…é¥°è¿™ä¸ªå‡½æ•°\n# å°†å‡½æ•°ä¼ é€’ç»™è£…é¥°å™¨ï¼Œè£…é¥°å™¨å°†åŠ¨æ€åœ°å°†å…¶åŒ…è£…åœ¨ä»»ä½•æƒ³æ‰§è¡Œçš„ä»£ç ä¸­ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°\n\n>> my_func = my_decorator(my_func)\n>> my_func()\n#output\nBefore the function runs\nI am a stand alone function\nAfter the function runs\n\n# ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™\n\n@ my_decorator\ndef my_func():\n    print \"I am a stand alone function\"\n\n>> my_func()\n#output\nBefore the function runs\nI am a stand alone function\nAfter the function runs\n```\n\nè£…é¥°å™¨æ˜¯è®¾è®¡æ¨¡å¼ä¸­[è£…é¥°å™¨æ¨¡å¼](https://zh.wikipedia.org/wiki/%E4%BF%AE%E9%A5%B0%E6%A8%A1%E5%BC%8F)ï¼ˆ[è‹±æ–‡ç‰ˆ](https://en.wikipedia.org/wiki/Decorator_pattern)ï¼‰çš„pythonå®ç°ã€‚\n\n### å¤šä¸ªè£…é¥°å™¨\n\n**è£…é¥°å™¨å¯ä»¥åµŒå¥—ä½¿ç”¨**\n\n```python\ndef bread(func):\n    def wrapper():\n        print \"</''''''\\>\"\n        func()\n        print \"<\\______/>\"\n    return wrapper\n\ndef ingredients(func):\n    def wrapper():\n        print \"#tomatoes#\"\n        func()\n        print \"~salad~\"\n    return wrapper\n\ndef sandwich(food=\"--ham--\"):\n    print food\n\n#### outputs:\n```\n\n### åµŒå¥—ä¸¤ä¸ªè£…é¥°å™¨\n\n```python\n>> sandwich = bread(ingredients(sandwich))\n>> sandwich()\n\n#### outputs\n</''''''\\>\n #tomatoes#\n --ham--\n ~salad~\n<\\______/>\n```\n\næ›´ç®€å•çš„å†™æ³•\n\n```python\n@bread\n@ingredients\ndef sandwich(food=\"--ham--\"):\n    print food\n\n```\n\n**è£…é¥°å™¨çš„é¡ºåºæ˜¯å¾ˆé‡è¦çš„**\n\nå¦‚æœæˆ‘ä»¬æ¢ä¸‹é¡ºåºå°±ä¼šå‘ç°ï¼Œä¸‰æ˜æ²»å˜æˆäº†æŠ«è¨ã€‚ã€‚\n\n```python\n@ingredients\n@bread\ndef sandwich(food=\"--ham--\"):\n    print food\n\n# outputs:\n    \n #tomatoes#\n </' ' ' ' ' '\\>\n   --ham--\n <\\______/>\n ~salad~\n```\n\n\n### Decorator çš„å·¥ä½œåŸç†\n\né¦–å…ˆçœ‹ä¸€ä¸‹è¿™æ®µä»£ç \n\n```python\ndef deco(fn):\n    print \"I am %s!\" % fn.__name__\n\n@deco\ndef func():\n    pass\n\n# output\nI am func!\n\n# æ²¡æœ‰æ‰§è¡Œfunc å‡½æ•° ä½†æ˜¯ deco è¢«æ‰§è¡Œäº†\n```\n\nåœ¨ç”¨æŸä¸ª@decoratoræ¥ä¿®é¥°æŸä¸ªå‡½æ•°funcæ—¶\n\n```python\n@decorator\ndef func():\n    pass\n\n```\nå…¶è§£é‡Šå™¨ä¼šè§£é‡Šæˆä¸‹é¢è¿™æ ·çš„è¯­å¥ï¼š\n\n`func = decorator(func)`\n\n> å…¶å®å°±æ˜¯æŠŠä¸€ä¸ªå‡½æ•°å½“å‚æ•°ä¼ åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œç„¶åå†å›è°ƒ\n> ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯è£…é¥°å™¨å¿…é¡»è¿”å›ä¸€ä¸ªå‡½æ•°ç»™func\n\nå›åˆ°åˆšæ‰çš„ä¾‹å­\n\n```python\n\ndef my_decorator(func):\n    def wrapper():\n        print \"Before the function runs\"\n        func()\n        print \"After the function runs\"\n    return wrapper\n\ndef my_func():\n    print \"I am a stand alone function\"\n\n>> my_func = my_decorator(my_func)\n>> my_func()\n#output\nBefore the function runs\nI am a stand alone function\nAfter the function runs\n\n```\n\nmy_decorator(my_func)è¿”å›äº†wrapper()å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œmy_funcå…¶å®å˜æˆäº†wrapperçš„ä¸€ä¸ªå˜é‡ï¼Œè€Œåé¢çš„my_func()æ‰§è¡Œå…¶å®å˜æˆäº†wrapper()\n\n\næ¯”å¦‚ï¼šå¤šä¸ªdecorator\n```python\n@decorator_one\n@decorator_two\ndef func():\n    pass\n```\nç›¸å½“äºï¼š\n\n```python\nfunc = decorator_one(decorator_two(func))\n```\næ¯”å¦‚ï¼šå¸¦å‚æ•°çš„decoratorï¼š\n\n```python\n@decorator(arg1, arg2)\ndef func():\n    pass\n# ç›¸å½“äºï¼š\n\nfunc = decorator(arg1,arg2)(func)\n```\n\n\n### å¸¦å‚æ•°çš„è£…é¥°å™¨\n\né¦–å…ˆçœ‹ä¸€ä¸‹ï¼Œ å¦‚æœè¢«è£…é¥°çš„æ–¹æ³•æœ‰å‚æ•°\n\n```python\ndef a_decorator(method_to_decorate):\n    def wrapper(self, x):\n        x -= 3\n        print 'x is %s' % x\n        method_to_decorate(self, x)\n    return wrapper\n\n\nclass A(object):\n\n    def __init__(self):\n        self.b = 42\n\n    @a_decorator\n    def number(self, x):\n        print \"b is %s\" % (self.b + x)\n\n\na = A()\na.number(-3)\n\n# output\nx is -6\nb is 36\n```\n\né€šå¸¸æˆ‘ä»¬éƒ½ä½¿ç”¨æ›´åŠ é€šç”¨çš„è£…é¥°å™¨ï¼Œå¯ä»¥ä½œç”¨åœ¨ä»»ä½•å‡½æ•°æˆ–å¯¹è±¡æ–¹æ³•ä¸Šï¼Œè€Œä¸å¿…å…³å¿ƒå…¶å‚æ•°ä½¿ç”¨\n\n```python\ndef a_decorator(method_to_decorate):\n    def wrapper(*args, **kwargs):\n        print '****** args ******'\n        print args\n        print kwargs\n        method_to_decorate(*args, **kwargs)\n    return wrapper\n\n@a_decorator\ndef func():\n    pass\n\nfunc()\n#output\n****** args ******\n()\n{}\n\n@a_decorator\ndef func_with_args(a, b=0):\n    pass\n    return a + b\n\nfunc_with_args(1, b=2)\n\n#output\n****** args ******\n(1,)\n{'b': 2}\n\n```\n\nä¸Šè¾¹çš„ç¤ºä¾‹æ˜¯å¸¦å‚æ•°çš„è¢«è£…é¥°å‡½æ•°\n\nç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹å‘è£…é¥°å™¨æœ¬èº«ä¼ é€’å‚æ•°\n\n\n### å‘è£…é¥°å™¨æœ¬èº«ä¼ é€’å‚æ•°\n\n**è£…é¥°å™¨å¿…é¡»ä½¿ç”¨å‡½æ•°ä½œä¸ºå‚æ•°**ï¼Œä½ ä¸èƒ½ç›´æ¥ä¼ é€’å‚æ•°ç»™è£…é¥°å™¨æœ¬èº«\nå¦‚æœæƒ³ä¼ é€’å‚æ•°ç»™è£…é¥°å™¨ï¼Œå¯ä»¥ **å£°æ˜ä¸€ä¸ªç”¨äºåˆ›å»ºè£…é¥°å™¨çš„å‡½æ•°**\n\n```python\n# æˆ‘æ˜¯ä¸€ä¸ªåˆ›å»ºè£…é¥°å™¨çš„å‡½æ•°\ndef decorator_maker():\n    print \"I make decorators!\"\n\n    def my_decorator(func):\n        print \"I am a decorator!\"\n\n        def wrapped():\n            print \"I am the wrapper around the decorated function. \"\n            return func()\n\n        print \"As the decorator, I return the wrapped function.\"\n        return wrapped\n\n    print \"As a decorator maker, I return a decorator\"\n    return my_decorator\n\n# decorator_maker()è¿”å›çš„æ˜¯ä¸€ä¸ªè£…é¥°å™¨\nnew_deco = decorator_maker()\n\n#outputs\nI make decorators!\nAs a decorator maker, I return a decorator\n\n# ä½¿ç”¨è£…é¥°å™¨\ndef decorated_function():\n    print \"I am the decorated function\"\n\ndecorated_function = new_deco(decorated_function)   \ndecorated_function()\n\n# outputs\nI make decorators!\nAs a decorator maker, I return a decorator\nI am a decorator!\nAs the decorator, I return the wrapped function.\nI am the wrapper around the decorated function.\nI am the decorated  function\n\n```\n**ä½¿ç”¨@ä¿®é¥°**\n\n```python\ndecorated_function = new_deco(decorated_function)\n\n# ç­‰ä»·äºä¸‹é¢çš„æ–¹æ³•\n\n@new_deco\ndef func():\n    print \"I am the decorated function\"\n\n\n@decorator_maker()\ndef func():\n    print \"I am the decorated function\"\n\n```\n\n> my_decoratorï¼ˆè£…é¥°å™¨å‡½æ•°ï¼‰æ˜¯decorator_makerï¼ˆè£…é¥°å™¨ç”Ÿæˆå‡½æ•°ï¼‰çš„å†…éƒ¨å‡½æ•°\næ‰€ä»¥å¯ä»¥ä½¿ç”¨æŠŠå‚æ•°åŠ åœ¨decorator_makerï¼ˆè£…é¥°å™¨ç”Ÿæˆå‡½æ•°ï¼‰çš„æ–¹æ³•åƒè£…é¥°å™¨ä¼ é€’å‚æ•°\n\n```python\n# æˆ‘æ˜¯ä¸€ä¸ªåˆ›å»ºå¸¦å‚æ•°è£…é¥°å™¨çš„å‡½æ•°\ndef decorator_maker_with_arguments(darg1, darg2):\n    print \"I make decorators! And I accept arguments:\", darg1, darg2\n\n    def my_decorator(func):\n        print \"I am a decorator! Somehow you passed me arguments:\", darg1, darg2\n\n        def wrapped(farg1, farg2):\n            print \"I am the wrapper around the decorated function.\"\n            print \"I can access all the variables\", darg1, darg2, farg1, farg2\n            return func(farg1, farg2)\n\n        print \"As the decorator, I return the wrapped function.\"\n        return wrapped\n\n    print \"As a decorator maker, I return a decorator\"\n    return my_decorator\n\n@decorator_maker_with_arguments(\"deco_arg1\", \"deco_arg2\")\ndef decorated_function_with_arguments(function_arg1, function_arg2):\n    print (\"I am the decorated function and only knows about my arguments: {0}\"\n           \" {1}\".format(function_arg1, function_arg2))\n\n\ndecorated_function_with_arguments('farg1', 'farg2')\n\n# outputs\n\nI make decorators! And I accept arguments: deco_arg1 deco_arg2\nAs a decorator maker, I return a decorator\nI am a decorator! Somehow you passed me arguments: deco_arg1 deco_arg2\nAs the decorator, I return the wrapped function.\nI am the wrapper around the decorated function.\nI can access all the variables deco_arg1 deco_arg2 farg1 farg2\nI am the decorated function and only knows about my arguments: farg1 farg2    \n\n```\n\nè¿™é‡Œè£…é¥°å™¨ç”Ÿæˆå‡½æ•°å†…éƒ¨ä¼ é€’å‚æ•°æ˜¯é—­åŒ…çš„ç‰¹æ€§\n\n### ä½¿ç”¨è£…é¥°å™¨éœ€è¦æ³¨æ„\n\n* è£…é¥°å™¨æ˜¯Python2.4çš„æ–°ç‰¹æ€§\n* è£…é¥°å™¨ä¼šé™ä½ä»£ç çš„æ€§èƒ½\n* è£…é¥°å™¨ä»…åœ¨Pythonä»£ç å¯¼å…¥æ—¶è¢«è°ƒç”¨ä¸€æ¬¡,ä¹‹åä½ ä¸èƒ½åŠ¨æ€åœ°æ”¹å˜å‚æ•°.å½“ä½ ä½¿ç”¨\"import x\",å‡½æ•°å·²ç»è¢«è£…é¥°\n\n#### ä½¿ç”¨ `functools.wraps`\n\næœ€åPython2.5è§£å†³äº†æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå®ƒæä¾›`functools`æ¨¡å—ï¼ŒåŒ…å«`functools.wraps`ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå°†è¢«è£…é¥°å‡½æ•°çš„åç§°ã€æ¨¡å—ã€æ–‡æ¡£å­—ç¬¦ä¸²æ‹·è´ç»™å°è£…å‡½æ•°\n\n\n```python\ndef foo():\n    print \"foo\"\n\nprint foo.__name__\n#outputs: foo\n\n# ä½†å½“ä½ ä½¿ç”¨è£…é¥°å™¨\ndef bar(func):\n    def wrapper():\n        print \"bar\"\n        return func()\n    return wrapper\n\n@bar\ndef foo():\n    print \"foo\"\n\nprint foo.__name__\n#outputs: wrapper\n\n```\n**\"functools\" å¯ä»¥ä¿®æ­£è¿™ä¸ªé”™è¯¯**\n\n```python\n\nimport functools\n\ndef bar(func):\n    # æˆ‘ä»¬æ‰€è¯´çš„ \"wrapper\", å°è£… \"func\"\n    @functools.wraps(func)\n    def wrapper():\n        print \"bar\"\n        return func()\n    return wrapper\n\n@bar\ndef foo():\n    print \"foo\"\n\n# å¾—åˆ°çš„æ˜¯åŸå§‹çš„åç§°, è€Œä¸æ˜¯å°è£…å™¨çš„åç§°\nprint foo.__name__\n#outputs: foo\n```\n\n### ç±»è£…é¥°å™¨\n\n```python\nclass myDecorator(object):\n\n    def __init__(self, func):\n        print \"inside myDecorator.__init__()\"\n        self.func = func\n\n    def __call__(self):\n        self.func()\n        print \"inside myDecorator.__call__()\"\n\n@myDecorator\ndef aFunction():\n    print \"inside aFunction()\"\n\nprint \"Finished decorating aFunction()\"\n\naFunction()\n\n# outputï¼š\n# inside myDecorator.__init__()\n# Finished decorating aFunction()\n# inside aFunction()\n# inside myDecorator.__call__()\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»ä¸­æœ‰ä¸¤ä¸ªæˆå‘˜ï¼š\n\n1. ä¸€ä¸ªæ˜¯__init__()ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬ç»™æŸä¸ªå‡½æ•°decoratoræ—¶è¢«è°ƒç”¨ï¼Œæ‰€ä»¥ï¼Œéœ€è¦æœ‰ä¸€ä¸ªfuncçš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¢«decoratorçš„å‡½æ•°ã€‚\n2. ä¸€ä¸ªæ˜¯__call__()ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬è°ƒç”¨è¢«decoratorå‡½æ•°æ—¶è¢«è°ƒç”¨çš„\n\n**å¦‚æœdecoratoræœ‰å‚æ•°çš„è¯ï¼Œ__init__() å°±ä¸èƒ½ä¼ å…¥funcäº†ï¼Œè€Œfnæ˜¯åœ¨__call__çš„æ—¶å€™ä¼ å…¥**\n\n```python\nclass myDecorator(object):\n\n    def __init__(self, arg1, arg2):\n        self.arg1 = arg2\n\n    def __call__(self, func):\n        def wrapped(*args, **kwargs):\n            return self.func(*args, **kwargs)\n        return wrapped\n```\n\n## è£…é¥°å™¨ç¤ºä¾‹\n\nPython å†…ç½®äº†ä¸‰ä¸ªç”¨äºè£…é¥°æ–¹æ³•çš„å‡½æ•°ï¼špropertyã€classmethodå’Œ staticmethodã€‚\nå¦ä¸€ä¸ªå¸¸è§çš„è£…é¥°å™¨æ˜¯ functools.wrapsï¼Œå®ƒçš„ä½œç”¨æ˜¯ååŠ©æ„å»ºè¡Œä¸ºè‰¯å¥½çš„è£…é¥°å™¨ã€‚\n\n#### functools.lru_cache \n\n`functools.lru_cache` å®ç°äº†å†…å­˜ç¼“å­˜åŠŸèƒ½ï¼Œå®ƒå¯ä»¥æŠŠè€—æ—¶é•¿çš„å‡½æ•°ç»“æœä¿å­˜èµ·æ¥ï¼Œé¿å…ä¼ å…¥ç›¸åŒå‚æ•°æ—¶é‡å¤è®¡ç®—ã€‚\n\næˆ‘ä»¬è‡ªå·±çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š\n\n```python\n\nfrom functools import wraps\ndef memo(fn):\n    cache = {}\n    miss = object()\n\n    @wraps(fn)\n    def wrapper(*args):\n        result = cache.get(args, miss)\n        if result is miss:\n            result = fn(*args)\n            print \"{0} has been used: {1}x\".format(fn.__name__, wrapper.count)\n            cache[args] = result\n        return result\n\n    return wrapper\n\n@memo\ndef fib(n):\n    if n < 2:\n        return n\n    return fib(n - 1) + fib(n - 2)\n```\n\n#### ç»Ÿè®¡å‡½æ•°æ‰§è¡Œæ¬¡æ•°çš„è£…é¥°å™¨\n\n```python\ndef counter(func):\n    \"\"\"\n    è®°å½•å¹¶æ‰“å°ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°\n    \"\"\"\n    def wrapper(*args, **kwargs):\n        wrapper.count = wrapper.count + 1\n        res = func(*args, **kwargs)\n        print \"{0} has been used: {1}x\".format(func.__name__, wrapper.count)\n        return res\n    wrapper.count = 0\n    return wrapper\n```\n\n* è£…é¥°å™¨åšç¼“å­˜\n\n\n#### å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„å†…å­˜ç¼“å­˜\n\n```python\ndef cache_for(duration):\n    def deco(func):\n        @wraps(func)\n        def fn(*args, **kwargs):\n            key = pickle.dumps((args, kwargs))\n            value, expire = func.func_dict.get(key, (None, None))\n            now = int(time.time())\n            if value is not None and expire > now:\n                return value\n            value = func(*args, **kwargs)\n            func.func_dict[key] = (value, int(time.time()) + duration)\n            return value\n        return fn\n    return deco\n```\n\n#### ç»Ÿè®¡ä»£ç è¿è¡Œæ—¶é—´\n\n```python\ndef timeit(fn):\n\n    @wraps(fn)\n    def real_fn(*args, **kwargs):\n        if config.common['ENVIRON'] == 'PRODUCTION':\n            return fn(*args, **kwargs)\n\n        _start = time.time()\n        #app.logger.debug('Start timeit for %s' % fn.__name__)\n        result = fn(*args, **kwargs)\n        _end = time.time()\n        _last = _end - _start\n        app.logger.debug('End timeit for %s in %s seconds.' %\n                         (fn.__name__, _last))\n        return result\n\n    return real_fn\n```\n\n\n### å‚è€ƒé“¾æ¥\n\n1. [How can I make a chain of function decorators in Python?](http://stackoverflow.com/questions/739654/how-can-i-make-a-chain-of-function-decorators-in-python/1594484#1594484)\n2. [ç†è§£PYTHONä¸­çš„è£…é¥°å™¨](http://www.wklken.me/posts/2013/07/19/python-translate-decorator.html#_1)\n3. [Pythonä¿®é¥°å™¨çš„å‡½æ•°å¼ç¼–ç¨‹](http://coolshell.cn/articles/11265.html)\n4. [Understanding Python Decorators in 12 Easy Steps!](http://simeonfranklin.com/blog/2012/jul/1/python-decorators-in-12-steps/)\n5. [PEP 0318 -- Decorators for Functions and Methods](https://www.python.org/dev/peps/pep-0318/)\n6. [PEP 3129 -- Class Decorators](https://www.python.org/dev/peps/pep-3129/)\n7. [*args and **kwargs? [duplicate]](http://stackoverflow.com/questions/3394835/args-and-kwargs)\n8. [why-cant-i-set-a-global-variable-in-python](http://stackoverflow.com/questions/1281184/why-cant-i-set-a-global-variable-in-python)\n9. [ã€flask routeã€‘](https://github.com/mitsuhiko/flask/blob/master/flask/app.py#L1040)\n10. [PythonDecoratorLibrary](https://wiki.python.org/moin/PythonDecoratorLibrary)\n11. [å…³äºPython Decroatorçš„å„ç§ææ¡ˆ](https://wiki.python.org/moin/PythonDecoratorProposals)\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)\n\n\n",
      "data": {
        "title": "Python è£…é¥°å™¨ä½¿ç”¨æŒ‡å—",
        "date": "2017-08-15 14:41:51",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-decorator"
    },
    {
      "content": "\n> `Sanic` æ˜¯ä¸€ä¸ªå’Œç±»Flask çš„åŸºäºPython3.5+çš„webæ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Python3 å¼‚æ­¥ç‰¹æ€§ï¼Œæœ‰è¿œè¶… flask çš„æ€§èƒ½ã€‚\n\nç¼–å†™ RESTful API çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå®šä¹‰ç‰¹å®šçš„å¼‚å¸¸é”™è¯¯ç±»å‹ï¼Œæ¯”å¦‚æˆ‘å®šä¹‰çš„é”™è¯¯è¿”å›å€¼æ ¼å¼ä¸ºï¼š\n\n```json\n{\n  \"error_code\": 0,\n  \"message\": \"string\",\n  \"text\": \"string\"\n}\n```\n\nä¸åŒçš„é”™è¯¯ä¿¡æ¯æŒ‡å®šä¸åŒçš„ http çŠ¶æ€ç ã€‚\n\nsanic æä¾›äº†å‡ ç§å¸¸ç”¨çš„ exceptionï¼š\n\n* NotFound(404)\n* Forbidden(403)\n* ServerError(500)\n* InvalidUsage(400)\n* Unauthorized(401)\n* RequestTimeout(408)\n* PayloadTooLarge(413)\n\nè¿™äº› exception ç»§æ‰¿è‡ª SanicException ç±»ï¼š\n\n```python\nclass SanicException(Exception):\n\n    def __init__(self, message, status_code=None):\n        super().__init__(message)\n\n        if status_code is not None:\n            self.status_code = status_code\n```\n\nä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›å¼‚å¸¸åªèƒ½æŒ‡å®š message å’Œ status_code å‚æ•°ï¼Œé‚£æˆ‘ä»¬å¯ä¸å¯ä»¥è‡ªå®šä¹‰ exception ç„¶ååœ¨è‡ªå®šä¹‰çš„ exception ä¸­å¢åŠ å‚æ•°å‘¢ï¼Ÿä¸‹é¢çš„ä»£ç æ˜¯æŒ‰ç…§è¿™ä¸ªæ€è·¯ä¿®æ”¹åçš„ä»£ç ï¼š\n\n```python\nclass ApiException(SanicException):\n\n    def __init__(self, code, message=None, text=None, status_code=None):\n        super().__init__(message)\n        self.error_code = code\n        self.message = message\n        self.text = text\n\n        if status_code is not None:\n            self.status_code = status_code\n```\nä½¿ç”¨åæˆ‘å¾—åˆ°ä¸€ä¸ªç»“æœå¦‚ä¸‹ï¼š\n\n![é”™è¯¯ç»“æœç¤ºä¾‹](http://media.gusibi.mobi/2VpVk8OPGxBl7oZ4qzyU7pBroeXXUslZ5vWiHRPnq0cZ1fFUsGDd23o5Gk7knIUa)\n\nä»ç»“æœå¯ä»¥å‘ç°ï¼Œé™¤äº† http çŠ¶æ€ç ä½¿æˆ‘æƒ³è¦çš„å…¶å®ƒå…¨é”™ï¼Œè¿ `content-type` éƒ½æ˜¯ `text/plain; charset=utf-8`ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Œæˆ‘ä»¬å®šä¹‰çš„å‚æ•°code å’Œ text å»äº†å“ªé‡Œï¼Ÿ\n\nç¿»å¼€ sanic handler çš„ä»£ç [https://github.com/channelcat/sanic/blob/master/sanic/handlers.py](https://github.com/channelcat/sanic/blob/master/sanic/handlers.py)æˆ‘æ‰¾åˆ°äº†ç­”æ¡ˆï¼š\n\n```python\ndef default(self, request, exception):\n        self.log(format_exc())\n        if issubclass(type(exception), SanicException):\n            # å¦‚æœæ˜¯ SanicException ç±»ï¼Œè¿”å›æ ¼å¼æ˜¯å®šä¹‰å¥½çš„ï¼Œ\n            # response å¤„ç†æ–¹æ³•ç”¨çš„æ˜¯ text\n            return text(\n                'Error: {}'.format(exception),\n                status=getattr(exception, 'status_code', 500),\n                headers=getattr(exception, 'headers', dict())\n            )\n        elif self.debug:\n            html_output = self._render_traceback_html(exception, request)\n\n            response_message = (\n                'Exception occurred while handling uri: \"{}\"\\n{}'.format(\n                    request.url, format_exc()))\n            log.error(response_message)\n            return html(html_output, status=500)\n        else:\n            return html(INTERNAL_SERVER_ERROR_HTML, status=500)\n```\n\n> ä»æºç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœresponse ç»“æœæ˜¯ SanicException ç±»ï¼Œresponse å¤„ç†æ–¹æ³•ä¼šæ”¹ç”¨textï¼Œå“åº”å†…å®¹æ ¼å¼ä¸º `Error: status_code`ã€‚\n\nçœ‹æ¥ç›´æ¥ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³æˆ‘ä»¬ä¸Šè¾¹å®šä¹‰çš„ json æ ¼å¼ï¼ˆéœ€è¦æœ‰ error_codeã€message å’Œ textï¼‰æ•°æ®çš„è¦æ±‚ã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½è‡ªå®šä¹‰ å¼‚å¸¸å¤„ç†æ–¹æ³•å‘¢ï¼Ÿ`ç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥ã€‚`\n\nä¸‹é¢ä»‹ç»ä¸¤ç§è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†çš„æ–¹æ³•ï¼š\n\n## ä½¿ç”¨ response.json \n\nè¿™ç§æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæ—¢ç„¶ sanic å¼‚å¸¸å¤„ç†æ˜¯æŠŠé”™è¯¯ä¿¡æ¯ä½¿ç”¨ response.text() æ–¹æ³•è¿”å›ï¼Œé‚£æˆ‘ä»¬æ”¹æˆ response.json() ä¸å°±å¯ä»¥äº†ä¹ˆã€‚sanic response æä¾›äº† json çš„å“åº”å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨ response.json å®šä¹‰ä¸€ä¸ªé”™è¯¯å¤„ç†æ–¹æ³•ï¼š\n\n```python\ndef json_error(error_code, message, text, status_code):\n    return json(\n        {\n            'error_code': error_code,\n            'message': message,\n            'text': text\n        },\n        status=status_code)\n```\n\nè¿™æ ·æˆ‘ä»¬åªéœ€è¦åœ¨éœ€è¦æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹ `return json_error(code, msg, text, status_code)`ã€‚\n \nä½¿ç”¨è¿™ç§æ–¹æ³•æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š\n\n```python\n\ndef get_account():\n    ...\n    if account:\n        return account\n    else:\n        # å¦‚æœç”¨æˆ·æ²¡æ‰¾åˆ° è¿”å›é”™è¯¯ä¿¡æ¯\n        return json_error(code, msg, text, status_code)\n    \n@app.route(\"/\")\nasync def test(request):\n    account = get_account()\n    return text('Hello world!')\n```\nè¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œjson_error çš„è¿”å›ç»“æœä¼šèµ‹å€¼ç»™ accountï¼Œå¹¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœéœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ test æ–¹æ³•ä¸­æ£€æŸ¥ account çš„ç»“æœï¼Œå¦‚æœåŒ…å« account æ˜¯ response.json å¯¹è±¡ï¼Œ ç›´æ¥ returnï¼Œ æ›´æ­£åçš„ä»£ç å¦‚ä¸‹ï¼š\n\n```python\n@app.route(\"/\")\nasync def test(request):\n    account = get_account()\n    if isinstance(account, response.json):\n        return account\n    return text('Hello world!')\n```\n\nè¿™æ ·è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ä¼šå¢åŠ å¾ˆå¤šä¸å¿…è¦çš„åˆ¤æ–­ï¼Œé‚£æœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸å‘¢ï¼Ÿè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ sanic æä¾›çš„ `@app.exception` è£…é¥°å™¨äº†ã€‚\n\n## ä½¿ç”¨ Handling exceptions\n\nsanic æä¾›äº†ä¸€ä¸ª `@app.exception`è£…é¥°å™¨ï¼Œä½¿ç”¨å®ƒå¯ä»¥è¦†ç›–é»˜è®¤çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š\n\n```python\nfrom sanic.response import text\nfrom sanic.exceptions import NotFound\n\n@app.exception(NotFound)\ndef ignore_404s(request, exception):\n    return text(\"Yep, I totally found the page: {}\".format(request.url))\n```\n\nè¿™ä¸ªè£…é¥°å™¨å…è®¸æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªéœ€è¦æ•è·çš„å¼‚å¸¸çš„åˆ—è¡¨ï¼Œç„¶åï¼Œå°±å¯ä»¥åœ¨è‡ªå®šä¹‰æ–¹æ³•ä¸­è¿”å›ä»»æ„çš„å“åº”æ•°æ®äº†ã€‚\n\nä»¥ä¸‹è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†ç±»ï¼š\n\n```python\nerror_codes = {\n    'invalid_token': ('Invalid token', 'æ— æ•ˆçš„token'),\n}\n\ndef add_status_code(code):\n    \"\"\"\n    Decorator used for adding exceptions to _sanic_exceptions.\n    \"\"\"\n    def class_decorator(cls):\n        cls.status_code = code\n        return cls\n    return class_decorator\n\n\nclass MetisException(SanicException):\n\n    def __init__(self, code, message=None, text=None, status_code=None):\n        super().__init__(message)\n        self.error_code = code\n        _message, _text = error_codes.get(code, (None, None))\n        self.message = message or _message\n        self.text = text or _text\n\n        if status_code is not None:\n            self.status_code = status_code\n\n@add_status_code(404)\nclass NotFound(MetisException):\n    pass\n\n@add_status_code(400)\nclass BadRequest(MetisException):\n    pass\n\n# ä½¿ç”¨ app.exception æ•è·å¼‚å¸¸ï¼Œè¿”å›è‡ªå®šä¹‰å“åº”æ•°æ®\n@app.exception(Unauthorized, NotFound, BadRequest)\ndef json_error(request, exception):\n    return json(\n        {\n            'error_code': exception.error_code,\n            'message': exception.message,\n            'text': exception.text\n        },\n        status=exception.status_code)\n``` \n\n## å‚è€ƒé“¾æ¥\n\n* [Sanic Exceptionsï¼šhttp://sanic.readthedocs.io/en/latest/sanic/exceptions.html](http://sanic.readthedocs.io/en/latest/sanic/exceptions.html)\n* [Metisï¼šhttps://github.com/gusibi/Metis](https://github.com/gusibi/Metis)\n\n------\n\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\næ¬¢è¿å…³æ³¨(April_Louisa) | è¯·æˆ‘å–èŠ¬è¾¾\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n",
      "data": {
        "title": "è‡ªå®šä¹‰ Sanic Exception",
        "date": "2017-08-05 02:23:35",
        "tags": [
          "python",
          "tutorial",
          "sanic"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "sanic-custom-exception"
    },
    {
      "content": "\n## æ•°æ®åº“åŸºç¡€\n\n### æ•°æ®åº“\n\næ•°æ®åº“æ˜¯ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ç»„æ–‡ä»¶ï¼‰ã€‚\n\nä¸€ä¸ª excel æ–‡ä»¶ã€‚\n\n**è¿™é‡Œæ˜¯ä¸€ä¸ª excel æ–‡ä»¶å›¾ç‰‡**\n\n![è¿™é‡Œæ˜¯ä¸€ä¸ª excel æ–‡ä»¶å›¾ç‰‡](http://media.gusibi.mobi/WzFaDj_ugK7JLrtKzU-L9oTWY5qSXEHa0FszhV8gQicJWSZtHsXFss34r-TkRUJQ)\n\n**è¿™é‡Œæ˜¯ä¸€ä¸ªæ•°æ®åº“å›¾ç‰‡**\n\n![è¿™é‡Œæ˜¯ä¸€ä¸ªæ•°æ®åº“å›¾ç‰‡](http://media.gusibi.mobi/GtovdBEGv1VzGyeGImgE45jrJuakyx9-Bmkltwm5kNgKpKrgBB00sk_1yPC_IgnC)\n\n> é€šå¸¸äººä»¬ç”¨æ•°æ®åº“ä»£è¡¨ä»–ä»¬ä½¿ç”¨çš„æ•°æ®åº“è½¯ä»¶ã€‚ä¸è¿‡ç¡®åˆ‡çš„è¯´ï¼Œæ•°æ®åº“è½¯ä»¶åº”ç§°ä½œæ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚\n\n### è¡¨\n\nè¡¨æ˜¯æŸç§ç‰¹å®šæ•°æ®çš„ç»“æ„åŒ–æ¸…å•ã€‚\n\nexcel ä¸­çš„ sheetã€‚\n\næ•°æ®åº“ä¸­æ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åå­—æ¥æ ‡è¯†è‡ªå·±ï¼Œè¿™ä¸ªåå­—æ˜¯å”¯ä¸€çš„ï¼Œå³æ•°æ®åº“ä¸­æ²¡æœ‰å…¶ä»–è¡¨å…·æœ‰ç›¸åŒçš„åå­—ã€‚ï¼ˆä¸åŒçš„æ•°æ®åº“å¯ä»¥æœ‰ä¸åŒçš„åå­—ï¼‰\n\n**è¿™é‡Œæ˜¯ä¸€ä¸ª sheetç»“æ„**\n\n![è¿™é‡Œæ˜¯ä¸€ä¸ª sheetç»“æ„](http://media.gusibi.mobi/NCnjCS_QjOinK0X1e1p5uTvx7iYjTfFGZE_rn8CRk-m_mNZbrsqzq2kaUYqpTSCT)\n\n**è¿™é‡Œæ˜¯ä¸€ä¸ªè¡¨ç»“æ„**\n\n![è¿™é‡Œæ˜¯ä¸€ä¸ªè¡¨ç»“æ„](http://media.gusibi.mobi/AOjmnriLW8FxYAQqBUcZJSw-9NrzJ3rZPrqjfJf0MGBLQjTfhp1urWCRc9PRxIF5)\n\n> è¡¨å…·æœ‰ä¸€äº›ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§å®šä¹‰äº†æ•°æ®åœ¨è¡¨ä¸­å¦‚ä½•å­˜å‚¨ï¼ŒåŒ…å«å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œæ•°æ®å¦‚ä½•åˆ†è§£ï¼Œå„éƒ¨åˆ†ä¿¡æ¯å¦‚ä½•å‘½åç­‰ä¿¡æ¯ã€‚æè¿°è¡¨çš„è¿™ç»„ä¿¡æ¯å°±æ˜¯æ‰€è°“çš„æ¨¡å¼ï¼Œæ¨¡å¼å¯ä»¥ç”¨æ¥æè¿°æ•°æ®åº“ä¸­ç‰¹å®šçš„è¡¨ï¼Œä¹Ÿå¯ä»¥æè¿°æ•´ä¸ªæ•°æ®åº“ã€‚\n\n### åˆ—å’Œæ•°æ®ç±»å‹\n\nè¡¨ç”±åˆ—ç»„æˆã€‚åˆ—å­˜å‚¨è¡¨ä¸­æŸéƒ¨åˆ†çš„ä¿¡æ¯ã€‚\n\n> åˆ—æ˜¯è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚æ‰€æœ‰è¡¨éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ç»„æˆã€‚\n\n**è¿™æ˜¯è¡¨ç»“æ„**\n\n![è¿™æ˜¯è¡¨ç»“æ„ï¼ŒæŒ‡å‡ºå“ªäº›æ˜¯åˆ—](http://media.gusibi.mobi/iUwFYgJyLqZoJ88D0AWfHHKS3aOtPrK7q_l98-PUyeMQ2DJrHAkUjOdrYhcagOe2)\n\næ¯ä¸€åˆ—å­˜å‚¨ç€æŸç§ç‰¹å®šçš„ä¿¡æ¯ã€‚ä¾‹å¦‚åœ¨é¡¾å®¢è¡¨ä¸­ï¼Œä¸€åˆ—å­˜å‚¨é¡¾å®¢ç¼–å·ï¼Œå¦ä¸€åˆ—å­˜å‚¨é¡¾å®¢å§“åï¼Œè€Œåœ°å€ã€åŸå¸‚ã€å·ä»¥åŠé‚®ç¼–å…¨éƒ½å­˜å‚¨åœ¨å„è‡ªçš„åˆ—ä¸­ã€‚\n\næ•°æ®åº“ä¸­æ¯ä¸ªåˆ—éƒ½æœ‰ç›¸åº”çš„æ•°æ®ç±»å‹ã€‚æ•°æ®ç±»å‹(datatype)å®šä¹‰äº†åˆ—å¯ä»¥å­˜å‚¨å“ªäº›æ•°æ®ç§ç±»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåˆ—ä¸­å­˜å‚¨çš„æ˜¯æ•°å­—(æˆ–è®¸æ˜¯è®¢å•ä¸­çš„ç‰©å“æ•°)ï¼Œåˆ™ç›¸åº”çš„æ•°æ®ç±»å‹åº”è¯¥ä¸ºæ•°å€¼ç±»å‹ã€‚å¦‚æœåˆ—ä¸­å­˜å‚¨çš„æ˜¯æ—¥æœŸã€æ–‡æœ¬ã€æ³¨é‡Šã€é‡‘é¢ç­‰ï¼Œåˆ™åº”è¯¥è§„å®šå¥½æ°å½“çš„æ•°æ®ç±»å‹ã€‚\n\n> æ•°æ®ç±»å‹æ˜¯æ¯åˆ—æ‰€å…è®¸çš„ç±»å‹ã€‚æ¯ä¸ªåˆ—éƒ½æœ‰ç›¸åº”çš„æ•°æ®ç±»å‹ï¼Œå®ƒé™åˆ¶è¯¥åˆ—ä¸­å­˜å‚¨çš„æ•°æ®ã€‚\n> æ•°æ®ç±»å‹é™å®šäº†å¯å­˜å‚¨åœ¨åˆ—ä¸­çš„æ•°æ®ç§ç±»(ä¾‹å¦‚ï¼Œé˜²æ­¢åœ¨æ•°å€¼å­—æ®µä¸­å½•å…¥å­—ç¬¦å€¼)ã€‚æ•°æ®ç±»å‹è¿˜å¸®åŠ©æ­£ç¡®åœ°åˆ†ç±»æ•°æ®ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»ºè¡¨æ—¶å¿…é¡»ç‰¹åˆ«å…³æ³¨æ‰€ç”¨çš„æ•°æ®ç±»å‹ã€‚\n\n### è¡Œ\n\n> è¡Œæ˜¯è¡¨ä¸­çš„ä¸€ä¸ªè®°å½•ã€‚\n\nè¡¨ä¸­çš„æ•°æ®æ˜¯æŒ‰è¡Œå­˜å‚¨çš„ï¼Œæ‰€ä¿å­˜çš„æ¯ä¸ªè®°å½•å­˜å‚¨åœ¨è‡ªå·±çš„è¡Œå†…ã€‚\n\n### ä¸»é”®\n\nä¸€åˆ—(æˆ–ä¸€ç»„åˆ—)ï¼Œå…¶å€¼èƒ½å¤Ÿå”¯ä¸€æ ‡è¯†è¡¨ä¸­æ¯ä¸€è¡Œã€‚ï¼ˆç”¨æˆ·è¡¨çš„ç”¨æˆ· IDï¼Œé—®é¢˜è¡¨çš„é—®é¢˜ IDï¼‰\n\n> è¡¨å¯ä»¥ä¸åˆ›å»ºä¸»é”®ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šç»™æ¯ä¸ªè¡¨åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œä»¥ä¾¿ä»¥åçš„æ•°æ®æ“ä½œå’Œç®¡ç†ã€‚\n\næ¯ä¸ªåˆ—éƒ½å¯ä»¥åšä¸»é”®ï¼Œéœ€è¦çš„æ¡ä»¶ï¼š\n\n* ä»»æ„ä¸¤è¡Œéƒ½ä¸å…·æœ‰ç›¸åŒçš„ä¸»é”®å€¼;\n* æ¯ä¸€è¡Œéƒ½å¿…é¡»å…·æœ‰ä¸€ä¸ªä¸»é”®å€¼(ä¸»é”®åˆ—ä¸å…è®¸NULLå€¼); \n* ä¸»é”®åˆ—ä¸­çš„å€¼ä¸å…è®¸ä¿®æ”¹æˆ–æ›´æ–°; \n* ä¸»é”®å€¼ä¸èƒ½é‡ç”¨(å¦‚æœæŸè¡Œä»è¡¨ä¸­åˆ é™¤ï¼Œå®ƒçš„ä¸»é”®ä¸èƒ½èµ‹ç»™ä»¥åçš„æ–°è¡Œ)\n\n## æ“ä½œè¡¨\n\n### åˆ›å»ºè¡¨\n\nåˆ›å»ºè¡¨ç”¨åˆ°çš„å‘½ä»¤æ˜¯ `CREATE TABLE`ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹ä¸ºï¼š\n\n1. ç»™è¡¨èµ·ä¸€ä¸ªç‹¬ç‰¹ï¼ˆä¸èƒ½å’Œå…¶å®ƒè¡¨é‡åï¼‰çš„åå­—\n2. ç„¶ååœ¨æ‹¬å·å†…æ¥å®šä¹‰æ¯ä¸€åˆ—çš„åˆ—è¡¨ï¼Œåœ¨è¡¨ä¸­æ˜¯ä»€ä¹ˆæ ·çš„æ•°æ®ç±»å‹ä»¥åŠè¦åŠ çš„é™åˆ¶ï¼ˆæ¯”å¦‚ï¼Œä¸èƒ½é‡å¤ï¼Œæœ€é•¿å¤šå°‘å­—ç¬¦..)\n\n```sql\nCREATE TABLE account(\n user_id integer PRIMARY KEY, \n username VARCHAR (50) UNIQUE NOT NULL,\n password VARCHAR (50) NOT NULL,\n created_on TIMESTAMP NOT NULL DEFAULT now(),\n last_login TIMESTAMP\n);\n```\n\nè¡¨åï¼š account\nåˆ—åï¼š user_id, username, password, created_on, last_login\nPRIMARY KEY: è¡¨æ˜è¿™æ˜¯ä¸»é”®ã€‚\nUNIQUE: è¡¨æ˜è¿™ä¸ªå­—æ®µå€¼ä¸èƒ½é‡å¤ã€‚\nNOT NULL: è¡¨æ˜è¯¥åˆ—ä¸èƒ½ä¸ºç©ºã€‚\nDEFAULT: ç”¨æ¥æŒ‡å®šé»˜è®¤å€¼ã€‚\n\n### åˆ é™¤è¡¨\n\n```sql\nDROP TABLE account;\n```\n\n### æ›´æ–°è¡¨\n\n> æ›´æ–°æ“ä½œ\n\n## æ’å…¥æ•°æ®\n\n### æ•°æ®æ’å…¥\n\nè¯­æ³•æ ¼å¼ï¼š\n\n```sql\nINSERT INTO TABLE_NAME (column1, column2, column3,...columnN)  \nVALUES (value1, value2, value3,...valueN);\n```\n\n> `column1`, `column2`, `column3`,...`columnN` æ˜¯è¦æ’å…¥æ•°æ®çš„è¡¨ä¸­çš„åˆ—çš„åç§°ã€‚\n\n#### æ’å…¥å®Œæ•´çš„è¡Œ\n\n```sql\nINSERT INTO account (user_id, username, password, created_on, last_login)  \nVALUES (1, 'fenda', 'fenda123', now(), now());\n```\n\n> é‡å¤æ‰§è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸º user_id å’Œ username ä¸èƒ½é‡å¤ã€‚\n\n#### æ’å…¥éƒ¨åˆ†è¡Œ\n\nå¯ä¸ºç©ºçš„ï¼Œè®¾ç½®äº†é»˜è®¤å€¼çš„å­—æ®µå¯ä»¥ä¸è®¾å®šå€¼ã€‚\n\n```sql\nINSERT INTO account (user_id, username, password)  \nVALUES (2, 'zaihang', 'fenda123');\n```\n\nè¿™é‡Œï¼Œcreated_on å’Œ last_login å¹¶æ²¡æœ‰æŒ‡å®šå€¼ã€‚\n\n## æ£€ç´¢æ•°æ®\n\nSQLè¯­å¥æ˜¯ç”±ç®€å•çš„è‹±è¯­å•è¯æ„æˆçš„ã€‚è¿™äº›å•è¯ç§°ä¸ºå…³é”®å­—ï¼Œæ¯ä¸ªSQLè¯­å¥éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå…³é”®å­—æ„æˆçš„ã€‚æœ€ç»å¸¸ä½¿ç”¨çš„SQLè¯­å¥å¤§æ¦‚å°±æ˜¯SELECTè¯­å¥äº†SELECTè¯­å¥äº†ã€‚å®ƒçš„ç”¨é€”æ˜¯ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æ£€ç´¢ä¿¡æ¯ã€‚\n\n> ä¸ºäº†ä½¿ç”¨SELECTæ£€ç´¢è¡¨æ•°æ®ï¼Œå¿…é¡»è‡³å°‘ç»™å‡ºä¸¤æ¡ä¿¡æ¯â€”â€”æƒ³é€‰æ‹©ä»€ä¹ˆï¼Œä»¥åŠä»ä»€ä¹ˆåœ°æ–¹é€‰æ‹©\n\n### æ£€ç´¢å•ä¸ªåˆ—\n\n```sql\nselect user_id from account;\n```\n\n> ä¸Šè¿°è¯­å¥åˆ©ç”¨SELECTè¯­å¥ä» account è¡¨ä¸­æ£€ç´¢ä¸€ä¸ªåä¸º user_id çš„åˆ—ã€‚æ‰€éœ€çš„åˆ—åå†™åœ¨SELECTå…³é”®å­—ä¹‹åï¼ŒFROMå…³é”®å­—æŒ‡å‡ºä»å“ªä¸ªè¡¨ä¸­æ£€ç´¢ã€‚\n\nè¿™æ¡SELECTè¯­å¥å°†è¿”å›è¡¨ä¸­çš„æ‰€æœ‰è¡Œã€‚æ•°æ®æ²¡æœ‰è¿‡æ»¤(è¿‡æ»¤å°†å¾—å‡ºç»“æœé›†çš„ä¸€ä¸ªå­é›†)ï¼Œä¹Ÿæ²¡æœ‰æ’åºã€‚\n\n**æ³¨æ„**\n\n* å¤šæ¡SQLè¯­å¥å¿…é¡»ä»¥åˆ†å·(;)åˆ†éš”ã€‚å¤šæ•°DBMSä¸éœ€è¦åœ¨å•æ¡SQLè¯­å¥ååŠ åˆ†å·ï¼Œä½†Postgresqlå¿…é¡»åœ¨å•æ¡SQLè¯­å¥ååŠ ä¸Šåˆ†å·ã€‚å½“ç„¶ï¼Œå¦‚æœæ„¿æ„å¯ä»¥æ€»æ˜¯åŠ ä¸Šåˆ†å·ã€‚äº‹å®ä¸Šï¼Œå³ä½¿ä¸ä¸€å®šéœ€è¦ï¼ŒåŠ ä¸Šåˆ†å·ä¹Ÿè‚¯å®šæ²¡æœ‰åå¤„ã€‚\n* `SQLè¯­å¥ä¸åŒºåˆ†å¤§å°å†™`ï¼Œå› æ­¤SELECTä¸selectæ˜¯ç›¸åŒçš„ã€‚\n* åœ¨å¤„ç†SQLè¯­å¥æ—¶ï¼Œå…¶ä¸­æ‰€æœ‰ç©ºæ ¼éƒ½è¢«å¿½ç•¥ã€‚SQLè¯­å¥å¯ä»¥å†™æˆé•¿é•¿çš„ä¸€è¡Œï¼Œä¹Ÿå¯ä»¥åˆ†å†™åœ¨å¤šè¡Œã€‚ä¸‹é¢è¿™ä¸‰ç§å†™æ³•çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚\n\n```sql\n-- 1\nselect user_id from account;\n\n-- 2\nselect user_id\nfrom account;\n\n-- 3\nselect\nuser_id\nfrom\naccount;\n```\n\n> SQL ä½¿ç”¨ `åŒæ¨ªçº¿ï¼ˆ--ï¼‰` æ³¨é‡Š\n\n### ä»€ä¹ˆæ—¶å€™éœ€è¦æ³¨é‡Š\n\n* SQLè¯­å¥å˜é•¿ï¼Œå¤æ‚æ€§å¢åŠ æ—¶ï¼Œä½ å°±ä¼šæƒ³æ·»åŠ ä¸€äº›æè¿°æ€§çš„æ³¨é‡Šï¼Œè¿™ä¾¿äºä½ è‡ªå·±ä»Šåå‚è€ƒï¼Œæˆ–è€…ä¾›é¡¹ç›®åç»­å‚ä¸äººå‘˜å‚è€ƒï¼›\n* åœ¨SQLæ–‡ä»¶å¼€å§‹å¤„æ·»åŠ ç¨‹åºå‘˜çš„è”ç³»æ–¹å¼ã€ç¨‹åºæè¿°ä»¥åŠä¸€äº›è¯´æ˜çš„å†…å®¹ã€‚\n* æš‚æ—¶åœæ­¢è¦æ‰§è¡Œçš„SQLä»£ç ã€‚å¦‚æœä½ ç¢°åˆ°ä¸€ä¸ªé•¿SQLè¯­å¥ï¼Œè€Œåªæƒ³æµ‹è¯•å®ƒçš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆåº”è¯¥æ³¨é‡Šæ‰ä¸€äº›ä»£ç ï¼Œ ä»¥ä¾¿æ•°æ®åº“å°†å…¶è§†ä¸ºæ³¨é‡Šè€ŒåŠ ä»¥å¿½ç•¥ã€‚\n\n```sql\nselect user_id  -- è¿™æ˜¯æ³¨é‡Šï¼ˆå¯æ˜¯è¯•è¯•æŠŠ -- å»æ‰çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼‰\nfrom account;\n\n/* SELECT user_id,  FROM account; */\nSELECT username\nFROM account;\n```\n\n### æ£€ç´¢å¤šä¸ªåˆ—\n\n```sql\nselect user_id, username from account;\n```\n\n### æ£€ç´¢æ‰€æœ‰åˆ—\n\n```sql\nselect * from account;\n```\n\n### é™åˆ¶ç»“æœ\n\n```sql\nselect * from account limit 1;\n\nselect * from account where user_id> 1 limit 1;\n```\n\n## æ’åºæ£€ç´¢æ•°æ®\n\n`ORDER BY` å¯¹äº§ç”Ÿçš„è¾“å‡ºæ’åºã€‚\n\n### æ’åºæ•°æ®\n\n```sql\nselect * from trade where operate_type='recharge' order by operate_fee; -- æŒ‰å……å€¼é‡‘é¢ä»å°åˆ°å¤§\n\nselect * from trade where operate_type='recharge' order by operate_fee desc; -- æŒ‰å……å€¼é‡‘é¢ä»å¤§åˆ°å°\n```\n\n### æŒ‰å¤šä¸ªåˆ—æ’åº\n\n```sql\n-- æŒ‰å……å€¼é‡‘é¢ä»å°åˆ°å¤§ é‡‘é¢ç›¸åŒçš„æŒ‰å……å€¼æ—¶é—´ä»å¤§åˆ°å°\nselect * from trade where operate_type='recharge' order by operate_fee, date_created desc; \n\n-- æŒ‰å……å€¼é‡‘é¢ä»å¤§åˆ°å° é‡‘é¢ç›¸åŒçš„æŒ‰å……å€¼é‡‘é¢ä»å°åˆ°å¤§\nselect * from trade where operate_type='recharge' order by operate_fee desc, date_created; \n```\n\n## è¿‡æ»¤æ•°æ®\n\n### ä½¿ç”¨ where å­å¥\n\n```sql\nselect * from trade where where operate_type='recharge' and operate_fee > 1000 limit 1;\n```\n\n### where å­å¥æ“ä½œç¬¦\n\n```sql\nselect * from trade where operate_fee = 1000;\n\nselect * from trade where operate_fee > 1000;\n\nselect * from trade where operate_fee >= 1000;\n\nselect * from trade where operate_fee < 1000;\n\nselect * from trade where operate_fee <= 1000;\n```\n\n### ç»„åˆ where å­å¥\n\n```sql\nselect * from trade where operate_fee <= 1000 and date_created > '2017-04-05';\n\nselect * from trade where date_created < '2017-08-05' and date_created > '2017-04-05';\n\nselect * from trade where date_created > '2017-07-05' or date_created < '2017-04-05';\n```\n\n#### æ±‚å€¼é¡ºåº\n\n```sql\n-- å…ˆç»„åˆ date_created < '2017-04-05' and operate_fee > 1000 \n-- å†åˆ¤æ–­ date_created > '2017-07-05'\n-- æ„æ€æ˜¯ æŸ¥è¯¢åˆ›å»ºæ—¶é—´å¤§äº 2017-07-05 å’Œ åˆ›å»ºäº 2017-04-05 ä¹‹å‰çš„\n-- é‡‘é¢å¤§äº1000çš„å……å€¼æ•°æ®ã€‚\nselect * from trade \n    where date_created > '2017-07-05' \n    or date_created < '2017-04-05' \n    and operate_fee > 1000 \n    and operate_type='recharge';\n\n-- æŸ¥è¯¢ åˆ›å»ºæ—¶é—´åœ¨ 2017-04-05 ä¹‹å‰ \n-- æˆ–è€… 2017-07-05ä¹‹åçš„ å……å€¼é‡‘é¢å¤§äº1000çš„è®¢å•\nselect * from trade \n    where (date_created > '2017-07-05' \n        or date_created < '2017-04-05') \n    and operate_fee > 1000\n    and operate_type='recharge';\n```\n\n### in æ“ä½œ\n\n**æŸ¥è¯¢å……å€¼é‡‘é¢ä¸º1000 æˆ–è€… 600 çš„è®¢å•**\n\n```sql\nselect * from trade where operate_fee in (600, 1000) and operate_type='recharge';\n\n-- ç­‰åŒäº \n\nselect * from trade where (operate_fee = 600 or operate_fee = 1000) and operate_type='recharge';\n```\n\nä¸ºä»€ä¹ˆè¦ä½¿ç”¨INæ“ä½œç¬¦?å…¶ä¼˜ç‚¹ä¸º:\n\n* åœ¨æœ‰å¾ˆå¤šåˆæ³•é€‰é¡¹æ—¶ï¼ŒINæ“ä½œç¬¦çš„è¯­æ³•æ›´æ¸…æ¥šï¼Œæ›´ç›´è§‚ã€‚ \n* åœ¨ä¸å…¶ä»–ANDå’ŒORæ“ä½œç¬¦ç»„åˆä½¿ç”¨INæ—¶ï¼Œæ±‚å€¼é¡ºåºæ›´å®¹æ˜“ç®¡ç†ã€‚ \n* INæ“ä½œç¬¦ä¸€èˆ¬æ¯”ä¸€ç»„ORæ“ä½œç¬¦æ‰§è¡Œå¾—æ›´å¿«(åœ¨ä¸Šé¢è¿™ä¸ªåˆæ³•é€‰é¡¹å¾ˆå°‘çš„ä¾‹å­ä¸­ï¼Œä½ çœ‹ä¸å‡ºæ€§èƒ½å·®å¼‚)ã€‚ \n* INçš„æœ€å¤§ä¼˜ç‚¹æ˜¯å¯ä»¥åŒ…å«å…¶ä»–SELECTè¯­å¥ï¼Œèƒ½å¤Ÿæ›´åŠ¨æ€åœ°å»ºç«‹WHEREå­å¥ã€‚\n\n### not æ“ä½œç¬¦\nWHEREå­å¥ä¸­çš„NOTæ“ä½œç¬¦æœ‰ä¸”åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯å¦å®šå…¶åæ‰€è·Ÿçš„ä»»ä½•æ¡ä»¶ã€‚å› ä¸ºNOTä»ä¸å•ç‹¬ä½¿ç”¨(å®ƒæ€»æ˜¯ä¸å…¶ä»–æ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨)ï¼Œ\næ‰€ä»¥å®ƒçš„è¯­æ³•ä¸å…¶ä»–æ“ä½œç¬¦æœ‰æ‰€ä¸åŒã€‚NOTå…³é”®å­—å¯ä»¥ç”¨åœ¨è¦è¿‡æ»¤çš„åˆ—å‰ï¼Œè€Œä¸ä»…æ˜¯åœ¨å…¶åã€‚\n\n> `NOT`\nWHEREå­å¥ä¸­ç”¨æ¥å¦å®šå…¶åæ¡ä»¶çš„å…³é”®å­—ã€‚\n\n```sql\nselect * from trade where not operate_fee in (600, 1000) and operate_type='recharge' LIMIT 10;\n\nSELECT * FROM trade WHERE operate_fee NOT IN (600, 1000) AND operate_type='recharge' LIMIT 10;\n\nSELECT * FROM trade WHERE NOT (operate_fee IN (600, 1000) AND operate_type='recharge') LIMIT 10;\n```\n\n## like æ“ä½œç¬¦\n\nå‰é¢ä»‹ç»çš„æ‰€æœ‰æ“ä½œç¬¦éƒ½æ˜¯é’ˆå¯¹å·²çŸ¥å€¼è¿›è¡Œè¿‡æ»¤çš„ã€‚ä¸ç®¡æ˜¯åŒ¹é…ä¸€ä¸ªå€¼è¿˜æ˜¯å¤šä¸ªå€¼ï¼Œæ£€éªŒå¤§äºè¿˜æ˜¯å°äºå·²çŸ¥å€¼ï¼Œæˆ–è€…æ£€æŸ¥æŸä¸ªèŒƒå›´çš„å€¼ï¼Œå…¶å…±\nåŒç‚¹æ˜¯è¿‡æ»¤ä¸­ä½¿ç”¨çš„å€¼éƒ½æ˜¯å·²çŸ¥çš„ã€‚\n\nä½†æ˜¯ï¼Œè¿™ç§è¿‡æ»¤æ–¹æ³•å¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½å¥½ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³æ‰¾å‡º `account` è¡¨ä¸­ username ä»¥ `fenda` å¼€å¤´çš„æ•°æ®ã€‚\n\nè¿™æ—¶ï¼Œå°±å¿…é¡»ä½¿ç”¨é€šé…ç¬¦äº†ã€‚\n\n> `é€šé…ç¬¦(wildcard)` ç”¨æ¥åŒ¹é…å€¼çš„ä¸€éƒ¨åˆ†çš„ç‰¹æ®Šå­—ç¬¦ã€‚\n> `æœç´¢æ¨¡å¼(search pattern)` ç”±å­—é¢å€¼ã€é€šé…ç¬¦æˆ–ä¸¤è€…ç»„åˆæ„æˆçš„æœç´¢æ¡ä»¶ã€‚\n\nSQLæ”¯æŒå‡ ç§é€šé…ç¬¦ã€‚ä¸ºåœ¨æœç´¢å­å¥ä¸­ä½¿ç”¨é€šé…ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨LIKEæ“ä½œç¬¦ã€‚LIKEæŒ‡ç¤ºæ•°æ®åº“ï¼Œåè·Ÿçš„æœç´¢æ¨¡å¼åˆ©ç”¨é€šé…ç¬¦åŒ¹é…è€Œä¸æ˜¯ç®€å•çš„ç›¸ç­‰åŒ¹é…è¿›è¡Œæ¯”è¾ƒã€‚\n\n> `æ³¨æ„ï¼š`é€šé…ç¬¦æœç´¢åªèƒ½ç”¨äºæ–‡æœ¬å­—æ®µ(ä¸²)ï¼Œéæ–‡æœ¬æ•°æ®ç±»å‹å­—æ®µä¸èƒ½ä½¿ç”¨é€šé…ç¬¦æœç´¢ã€‚\n\n### ç™¾åˆ†å·(%)é€šé…ç¬¦\n\næœ€å¸¸ä½¿ç”¨çš„é€šé…ç¬¦æ˜¯ç™¾åˆ†å·(%)ã€‚åœ¨æœç´¢ä¸²ä¸­ï¼Œ%è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°ã€‚\n\n```sql\nselect * from account where username like 'fenda%';\n```\n\næ­¤ä¾‹å­ä½¿ç”¨äº†æœç´¢æ¨¡å¼'fenda%'ã€‚åœ¨æ‰§è¡Œè¿™æ¡å­å¥æ—¶ï¼Œå°†æ£€ç´¢ä»»æ„ä»¥ `fenda` èµ·å¤´çš„è¯ã€‚`%``å‘Šè¯‰æ•°æ®åº“æ¥å— `fenda` ä¹‹åçš„ä»»æ„å­—ç¬¦ï¼Œä¸ç®¡å®ƒæœ‰å¤šå°‘å­—ç¬¦ã€‚\n\n> æœç´¢æ¨¡å¼åŒºåˆ†å¤§å°å†™ã€‚ `'Fenda%'` å’Œ `'fenda%'` æ˜¯ä¸åŒçš„ã€‚\n\n`%` ä¸ä»…å¯ä»¥æ”¾åœ¨æœ€åï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å…¶ä»–ä½ç½®ï¼Œæ¯”å¦‚\n\n```sql\nselect * from account where username like '%enda%';\n```\n\n### ä¸‹åˆ’çº¿(_)é€šé…ç¬¦\n\nä¸‹åˆ’çº¿çš„ç”¨é€”ä¸%ä¸€æ ·ï¼Œä½†å®ƒåªåŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œè€Œä¸æ˜¯å¤šä¸ªå­—ç¬¦ã€‚\n\n```sql\nselect * from account where username like 'fenda-_bc-9';\n```\n\n### æ–¹æ‹¬å·([ ])é€šé…ç¬¦\n\næ–¹æ‹¬å·([])é€šé…ç¬¦ç”¨æ¥æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†ï¼Œå®ƒå¿…é¡»åŒ¹é…æŒ‡å®šä½ç½®(é€šé…ç¬¦çš„ä½ç½®)çš„ä¸€ä¸ªå­—ç¬¦ã€‚\n\n```sql\n-- bc å‰è¾¹çš„å­—ç¬¦åªèƒ½æ˜¯ a æˆ– b\nselect * from account where username like 'fenda-[ab]bc-9';\n\n-- bc å‰è¾¹çš„å­—ç¬¦ä¸èƒ½æ˜¯ a æˆ– b\nselect * from account where username like 'fenda-[^ab]bc-9';\n```\n\n### é€šé…ç¬¦è½¬ä¹‰\n\n```sql\n-- abc å‰åªèƒ½æ˜¯ ä¸‹åˆ’çº¿(_)\nselect * from account where username like 'fenda[_]abc-9';\n\n-- ä½¿ç”¨è½¬ä¹‰å­—ç¬¦å£°æ˜ä¸‹åˆ’çº¿æ˜¯ä¸€ä¸ªå­—ç¬¦è€Œä¸æ˜¯é€šé…ç¬¦\nselect * from account where username like 'fenda\\_abc-9';\n```\n\n### ä½¿ç”¨é€šé…ç¬¦çš„æŠ€å·§\n\né€šé…ç¬¦æœç´¢ä¸€èˆ¬æ¯”å‰é¢è®¨è®ºçš„å…¶ä»–æœç´¢è¦è€—è´¹æ›´é•¿çš„å¤„ç†æ—¶é—´ã€‚è¿™é‡Œç»™å‡ºä¸€äº›ä½¿ç”¨é€šé…ç¬¦æ—¶è¦è®°ä½çš„æŠ€å·§ã€‚\n\n* ä¸è¦è¿‡åº¦ä½¿ç”¨é€šé…ç¬¦ã€‚å¦‚æœå…¶ä»–æ“ä½œç¬¦èƒ½è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œåº”è¯¥ä½¿ç”¨å…¶ä»–æ“ä½œç¬¦ã€‚\n* åœ¨ç¡®å®éœ€è¦ä½¿ç”¨é€šé…ç¬¦æ—¶ï¼Œä¹Ÿå°½é‡ä¸è¦æŠŠå®ƒä»¬ç”¨åœ¨æœç´¢æ¨¡å¼çš„å¼€å§‹å¤„ã€‚æŠŠé€šé…ç¬¦ç½®äºå¼€å§‹å¤„ï¼Œæœç´¢èµ·æ¥æ˜¯æœ€æ…¢çš„ã€‚\n* ä»”ç»†æ³¨æ„é€šé…ç¬¦çš„ä½ç½®ã€‚å¦‚æœæ”¾é”™åœ°æ–¹ï¼Œå¯èƒ½ä¸ä¼šè¿”å›æƒ³è¦çš„æ•°æ®ã€‚\n\n\n## æ±‡æ€»æ•°æ®\n\næˆ‘ä»¬ç»å¸¸éœ€è¦æ±‡æ€»æ•°æ®è€Œä¸ç”¨æŠŠå®ƒä»¬å®é™…æ£€ç´¢å‡ºæ¥ï¼Œä¸ºæ­¤SQLæä¾›äº†ä¸“é—¨çš„å‡½æ•°ã€‚ä½¿ç”¨è¿™äº›å‡½æ•°ï¼ŒSQLæŸ¥è¯¢å¯ç”¨äºæ£€ç´¢æ•°æ®ï¼Œä»¥ä¾¿åˆ†æå’ŒæŠ¥è¡¨ç”Ÿæˆã€‚è¿™ç§ç±»å‹çš„æ£€ç´¢ä¾‹å­æœ‰:\n\n* ç¡®å®šè¡¨ä¸­è¡Œæ•°(æˆ–è€…æ»¡è¶³æŸä¸ªæ¡ä»¶æˆ–åŒ…å«æŸä¸ªç‰¹å®šå€¼çš„è¡Œæ•°);\n* è·å¾—è¡¨ä¸­æŸäº›è¡Œçš„å’Œ;\n* æ‰¾å‡ºè¡¨åˆ—(æˆ–æ‰€æœ‰è¡Œæˆ–æŸäº›ç‰¹å®šçš„è¡Œ)çš„æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€‚\n\nSQL æä¾›çš„å¸¸ç”¨çš„èšé›†å‡½æ•°ï¼š\n\nå‡½æ•° | è¯´æ˜\n-----|----\nCOUNT()| è¿”å›æŸåˆ—çš„è¡Œæ•°\nAVG()| è¿”å›æŸåˆ—çš„å¹³å‡å€¼\nMAX()| è¿”å›æŸåˆ—çš„æœ€å¤§å€¼\nMIN()| è¿”å›æŸåˆ—çš„æœ€å°å€¼\nSUM()| è¿”å›æŸåˆ—çš„å’Œ\n\n### AVG() å‡½æ•°\n\nAVG()é€šè¿‡å¯¹è¡¨ä¸­è¡Œæ•°è®¡æ•°å¹¶è®¡ç®—å…¶åˆ—å€¼ä¹‹å’Œï¼Œæ±‚å¾—è¯¥åˆ—çš„å¹³å‡å€¼ã€‚AVG()å¯ç”¨æ¥è¿”å›æ‰€æœ‰åˆ—çš„å¹³å‡å€¼ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¿”å›ç‰¹å®šåˆ—æˆ–è¡Œçš„å¹³å‡å€¼ã€‚ \n\nä¸‹é¢çš„ä¾‹å­ä½¿ç”¨AVG()è¿”å› trade è¡¨ä¸­æ‰€æœ‰å……å€¼æ•°æ®çš„å‡å€¼:\n\n```sql\n-- å……å€¼é‡‘é¢çš„å‡å€¼\nselect avg(operate_fee) from trade \n    where operate_type='recharge';\n```\n\n> AVG()å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è¡Œã€‚\n\n### COUNT() å‡½æ•°\n\nCOUNT()å‡½æ•°è¿›è¡Œè®¡æ•°ã€‚å¯åˆ©ç”¨COUNT()ç¡®å®šè¡¨ä¸­è¡Œçš„æ•°ç›®æˆ–ç¬¦åˆç‰¹å®šæ¡ä»¶çš„è¡Œçš„æ•°ç›®ã€‚\n\nCOUNT()å‡½æ•°æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼: \n* ä½¿ç”¨COUNT(*)å¯¹è¡¨ä¸­è¡Œçš„æ•°ç›®è¿›è¡Œè®¡æ•°ï¼Œä¸ç®¡è¡¨åˆ—ä¸­åŒ…å«çš„æ˜¯ç©ºå€¼(NULL)è¿˜æ˜¯éç©ºå€¼ã€‚\n* ä½¿ç”¨COUNT(column)å¯¹ç‰¹å®šåˆ—ä¸­å…·æœ‰å€¼çš„è¡Œè¿›è¡Œè®¡æ•°ï¼Œå¿½ç•¥NULLå€¼ã€‚\n\næ¯”å¦‚ï¼š\n\n```sql\nselect count(*) from account;  -- ç”¨æˆ·æ•°\n\nselect count(last_login) from account; -- ç™»å½•è¿‡çš„ç”¨æˆ·æ•°\n```\n\n> å¦‚æœæŒ‡å®šåˆ—åï¼Œåˆ™COUNT()å‡½æ•°ä¼šå¿½ç•¥æŒ‡å®šåˆ—çš„å€¼ä¸ºç©ºçš„è¡Œï¼Œä½†å¦‚æœCOUNT()å‡½æ•°ä¸­ç”¨çš„æ˜¯æ˜Ÿå·(*)ï¼Œåˆ™ä¸å¿½ç•¥ã€‚\n\n### MAX() å‡½æ•°\n\nMAX()è¿”å›æŒ‡å®šåˆ—ä¸­çš„æœ€å¤§å€¼ã€‚MAX()è¦æ±‚æŒ‡å®šåˆ—åï¼Œå¦‚ä¸‹æ‰€ç¤º:\n\n```sql\n-- å……å€¼æ•°æ®ä¸­çš„æœ€é«˜é‡‘é¢\nselect max(operate_fee) from trade where operate_type='recharge'; \n\nselect operate_fee from trade \n    where operate_type='recharge' \n    order by operate_fee desc limit 1;\n```\n\n> MAX()å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è¡Œã€‚\n\n### MIN() å‡½æ•°\n\nMIN()çš„åŠŸèƒ½æ­£å¥½ä¸MAX()åŠŸèƒ½ç›¸åï¼Œå®ƒè¿”å›æŒ‡å®šåˆ—çš„æœ€å°å€¼ã€‚ä¸MAX()ä¸€æ ·ï¼ŒMIN()è¦æ±‚æŒ‡å®šåˆ—åï¼Œå¦‚ä¸‹æ‰€ç¤º:\n\n```sql\n-- å……å€¼æ•°æ®ä¸­çš„æœ€å°‘é‡‘é¢\nselect min(operate_fee) from trade where operate_type='recharge'; \n\nselect operate_fee from trade \n    where operate_type='recharge' \n    order by operate_fee limit 1;\n```\n\n> MIN()å‡½æ•°å¿½ç•¥åˆ—å€¼ä¸ºNULLçš„è¡Œã€‚\n\n### SUM() å‡½æ•°\n\n```sql\n-- æœ€å¤§çš„å……å€¼é‡‘é¢\nSELECT max(operate_fee) FROM trade WHERE operate_type='recharge';\n\n-- ä»¥æœ€å¤§å……å€¼é‡‘é¢å……å€¼çš„æ¡æ•°\nSELECT count(*) FROM trade \n    WHERE operate_type='recharge' \n    AND operate_fee = (SELECT max(operate_fee) FROM trade \n                       WHERE operate_type='recharge');\n\nSELECT operate_fee * (SELECT count(*) FROM trade \n                          WHERE operate_type='recharge' \n                          AND operate_fee = (SELECT max(operate_fee) FROM trade \n                              WHERE operate_type='recharge')) AS æœ€å¤§å……å€¼é‡‘é¢æ€»å’Œ FROM trade \n    WHERE operate_type='recharge' \n    AND operate_fee=(SELECT max(operate_fee) FROM trade \n                     WHERE operate_type='recharge');\n\nSELECT sum(operate_fee) AS æœ€å¤§å……å€¼é‡‘é¢æ€»å’Œ FROM trade \n    WHERE operate_type='recharge' \n    AND operate_fee = (SELECT max(operate_fee) FROM trade \n                       WHERE operate_type='recharge');\n```\n\nSUM()ç”¨æ¥è¿”å›æŒ‡å®šåˆ—å€¼çš„å’Œ(æ€»è®¡)ã€‚æ¯”å¦‚:\n\n```sql\n-- å……å€¼é‡‘é¢çš„æ€»å’Œ\nselect sum(operate_fee) from trade where operate_type='recharge'; \n\n-- å……å€¼é‡‘é¢çš„æ€»å’Œ\nselect sum(operate_fee) from trade where operate_type='recharge';\n```\n\n### ç»„åˆèšé›†å‡½æ•°\n\nSELECTè¯­å¥å¯æ ¹æ®éœ€è¦åŒ…å«å¤šä¸ªèšé›†å‡½æ•°ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:\n\n```sql\nSELECT count(*) AS æ€»å……å€¼æ¡æ•°,\n    min(operate_fee) AS æœ€å°å……å€¼é‡‘é¢,\n    max(operate_fee) AS æœ€å¤§å……å€¼é‡‘é¢,\n    avg(operate_fee) AS fee_avg,\n    sum(operate_fee) AS fee_sum\nFROM trade WHERE operate_type='recharge';\n```\n\n#### ç»ƒä¹ ï¼š è®¡ç®—æœ€å¤§çš„å……å€¼é‡‘é¢ï¼Œå¹¶ç»Ÿè®¡æœ€å¤§é‡‘é¢çš„å……å€¼æ¬¡æ•°\n```sql\nSELECT count(*) FROM trade \n    WHERE operate_type='recharge' \n    AND operate_fee=(\n        SELECT max(operate_fee) FROM trade \n            WHERE operate_type='recharge');\n```\n#### ç»ƒä¹ ï¼šè®¡ç®—æœ€å¤§çš„å……å€¼é‡‘é¢ï¼Œå¹¶ç»Ÿè®¡ä»¥è¿™ä¸ªé‡‘é¢å……å€¼çš„æ€»é‡‘é¢\n```sql\nSELECT sum(operate_fee) FROM trade \n    WHERE operate_type='recharge' \n    AND operate_fee = (\n        SELECT max(operate_fee) FROM trade \n            WHERE operate_type='recharge');\n```\n\nè¿™æ¡ select è¯­å¥æ‰§è¡Œäº†5ä¸ªèšåˆå‡½æ•°ï¼Œè¿”å›5ä¸ªå€¼ï¼ˆæ€»å……å€¼æ¬¡æ•°ï¼Œæœ€å°å€¼ï¼Œæœ€å¤§å€¼ï¼Œå¹³å‡å€¼ï¼Œæ€»å……å€¼é‡‘é¢ï¼‰ã€‚\n\n> `å–åˆ«å` ä½¿ç”¨èšåˆå‡½æ•°æ—¶ï¼Œå»ºè®®ä½¿ç”¨åˆ«åæŒ‡å®šè®¡ç®—åçš„ç»“æœã€‚åœ¨æŒ‡å®šåˆ«åæ—¶ï¼Œä¸åº”è¯¥ä½¿ç”¨è¡¨ä¸­å®é™…çš„åˆ—åã€‚\n\n\n## åˆ†ç»„æ•°æ®\n\nä½¿ç”¨SQLèšé›†å‡½æ•°å¯ä»¥æ±‡æ€»æ•°æ®ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå¯¹è¡Œè¿›è¡Œè®¡æ•°ï¼Œè®¡ç®—å’Œä¸å¹³å‡æ•°ï¼Œä¸æ£€ç´¢æ‰€æœ‰æ•°æ®å°±è·å¾—æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚\nç›®å‰ä¸ºæ­¢çš„æ‰€æœ‰è®¡ç®—éƒ½æ˜¯åœ¨è¡¨çš„æ‰€æœ‰æ•°æ®æˆ–åŒ¹é…ç‰¹å®šçš„WHEREå­å¥çš„æ•°æ®ä¸Šè¿›è¡Œçš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­è¿”å›ä¾›åº”å•†DLL01æä¾›çš„äº§å“æ•°ç›®:\n\n```sql\nSELECT COUNT(*) AS num_prods FROM Products\nWHERE vend_id = 'DLL01';\n```\n\nå¦‚æœè¦è¿”å›æ¯ä¸ªä¾›åº”å•†æä¾›çš„äº§å“æ•°ç›®ï¼Œè¯¥æ€ä¹ˆåŠ?æˆ–è€…è¿”å›åªæä¾›ä¸€é¡¹äº§å“çš„ä¾›åº”å•†çš„äº§å“ï¼Œæˆ–è€…è¿”å›æä¾›10ä¸ªä»¥ä¸Šäº§å“çš„ä¾›åº”å•†çš„äº§å“ï¼Œæ€ä¹ˆåŠ?\nè¿™å°±æ˜¯åˆ†ç»„å¤§æ˜¾èº«æ‰‹çš„æ—¶å€™äº†ã€‚ä½¿ç”¨åˆ†ç»„å¯ä»¥å°†æ•°æ®åˆ†ä¸ºå¤šä¸ªé€»è¾‘ç»„ï¼Œå¯¹æ¯ä¸ªç»„è¿›è¡Œèšé›†è®¡ç®—ã€‚\n\n### åˆ›å»ºåˆ†ç»„\n\nåˆ†ç»„æ˜¯ä½¿ç”¨SELECTè¯­å¥çš„`GROUP BY`å­å¥å»ºç«‹çš„ã€‚ç†è§£åˆ†ç»„çš„æœ€å¥½åŠæ³•æ˜¯çœ‹ä¸€ä¸ªä¾‹å­:\n\n```sql\n-- æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·å……å€¼çš„æ¬¡æ•°\nselect account_id, count(*) AS å……å€¼æ¬¡æ•° from trade \n    where operate_type='recharge' \n    group by account_id;\n```\n\nä¸Šé¢çš„`SELECT`è¯­å¥æŒ‡å®šäº†ä¸¤ä¸ªåˆ—: account_id åŒ…å«ç”¨æˆ·çš„IDï¼Œ`å……å€¼æ¬¡æ•°`ä¸ºè®¡ç®—å­—æ®µ(ç”¨COUNT(*)å‡½æ•°å»ºç«‹)ã€‚`GROUP BY`å­å¥æŒ‡ç¤º æ•°æ®åº“æŒ‰ `account_id`æ’åºå¹¶åˆ†ç»„æ•°æ®ã€‚è¿™å°±ä¼šå¯¹æ¯ä¸ª`account_id`è€Œä¸æ˜¯æ•´ä¸ªè¡¨è®¡ç®—å……å€¼æ¬¡æ•°ä¸€æ¬¡ã€‚\nå› ä¸ºä½¿ç”¨äº†`GROUP BY`ï¼Œå°±ä¸å¿…æŒ‡å®šè¦è®¡ç®—å’Œä¼°å€¼çš„æ¯ä¸ªç»„äº†ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆã€‚`GROUP BY`å­å¥æŒ‡ç¤ºæ•°æ®åº“åˆ†ç»„æ•°æ®ï¼Œç„¶åå¯¹æ¯ä¸ªç»„è€Œä¸æ˜¯æ•´ä¸ªç»“æœé›†è¿›è¡Œèšé›†ã€‚\n\n* GROUP BYå­å¥å¿…é¡»å‡ºç°åœ¨WHEREå­å¥ä¹‹åï¼ŒORDER BYå­å¥ä¹‹å‰ã€‚\n* é™¤èšé›†è®¡ç®—è¯­å¥å¤–ï¼ŒSELECTè¯­å¥ä¸­çš„æ¯ä¸€åˆ—éƒ½å¿…é¡»åœ¨GROUP BYå­å¥ä¸­ç»™å‡ºã€‚\n* å¦‚æœåˆ†ç»„åˆ—ä¸­åŒ…å«å…·æœ‰NULLå€¼çš„è¡Œï¼Œåˆ™NULLå°†ä½œä¸ºä¸€ä¸ªåˆ†ç»„è¿”å›ã€‚å¦‚æœåˆ—ä¸­æœ‰å¤šè¡ŒNULLå€¼ï¼Œå®ƒä»¬å°†åˆ†ä¸ºä¸€ç»„ã€‚\n\n### è¿‡æ»¤åˆ†ç»„\n\né™¤äº†èƒ½ç”¨GROUP BYåˆ†ç»„æ•°æ®å¤–ï¼ŒSQLè¿˜å…è®¸è¿‡æ»¤åˆ†ç»„ï¼Œè§„å®šåŒ…æ‹¬å“ªäº›åˆ†ç»„ï¼Œæ’é™¤å“ªäº›åˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦åˆ—å‡ºè‡³å°‘å……å€¼ä¸¤æ¬¡çš„ç”¨æˆ·ã€‚ä¸ºæ­¤ï¼Œå¿…é¡»åŸºäºå®Œæ•´çš„åˆ†ç»„è€Œä¸æ˜¯ä¸ªåˆ«çš„è¡Œè¿›è¡Œè¿‡æ»¤ã€‚\n\nSQLä¸ºæ­¤æä¾›äº†å¦ä¸€ä¸ªå­å¥ï¼Œå°±æ˜¯`HAVING`å­å¥ã€‚HAVINGéå¸¸ç±»ä¼¼äºWHEREã€‚WHEREè¿‡æ»¤è¡Œï¼Œè€Œ `HAVING` è¿‡æ»¤åˆ†ç»„ã€‚\n\n```sql\n-- æŸ¥è¯¢å……å€¼çš„æ¬¡æ•°å¤§äº10çš„ç”¨æˆ·\nselect account_id, count(*) AS å……å€¼æ¬¡æ•° from trade \n    where operate_type='recharge' \n    group by account_id\n    having count(*) > 10;\n```\n\n> WHEREåœ¨æ•°æ®åˆ†ç»„å‰è¿›è¡Œè¿‡æ»¤ï¼ŒHAVINGåœ¨æ•°æ®åˆ†ç»„åè¿›è¡Œè¿‡æ»¤ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼ŒWHEREæ’é™¤çš„è¡Œä¸åŒ…æ‹¬åœ¨åˆ†ç»„ä¸­ã€‚è¿™å¯èƒ½ä¼šæ”¹å˜è®¡ç®—å€¼ï¼Œä»è€Œå½±å“HAVINGå­å¥ä¸­åŸºäºè¿™äº›å€¼è¿‡æ»¤æ‰çš„åˆ†ç»„\n\n### åˆ†ç»„å’Œæ’åº\n\nä½¿ç”¨ `GROUP BY` åˆ†ç»„çš„ç»“æœæ˜¯æ— åºçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `ORDER BY` å¯¹ç»“æœè¿›è¡Œæ’åºã€‚\n\n```sql\n-- æŸ¥è¯¢å……å€¼çš„æ¬¡æ•°å¤§äº10çš„ç”¨æˆ· æŒ‰å……å€¼æ¬¡æ•°æ’åº\nSELECT account_id, count(*) AS å……å€¼æ¬¡æ•° FROM trade \n    WHERE operate_type='recharge' \n    GROUP BY account_id\n    HAVING count(*) > 10\n    ORDER BY count(*) desc;\n```\n\n## å‚è€ƒé“¾æ¥\n\n------\n\n\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\næ¬¢è¿å…³æ³¨(April_Louisa) | è¯·æˆ‘å–èŠ¬è¾¾\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n",
      "data": {
        "title": "æ•°æ®åº“åŸºç¡€ï¼šåˆ›å»ºè¡¨",
        "date": "2017-07-30 00:02:22",
        "tags": [
          "database"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "sql-start-1-how-to-create-table"
    },
    {
      "content": "\nå‰ä¸¤ç¯‡ `å¾®ä¿¡å…¬å·DIY` ç³»åˆ—:\n* [å¾®ä¿¡å…¬å·DIYï¼šä¸€å°æ—¶æ­å»ºå¾®ä¿¡èŠå¤©æœºå™¨äºº](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752007&idx=1&sn=46cf89695e8147fb30acb162ec895290&chksm=80b0b86db7c7317bca8612498cb7b01bc541d5b03399496fd5ce06291b844c0af9920d09f8fc#rd) \n* [å¾®ä¿¡å…¬å·DIYï¼šè®­ç»ƒèŠå¤©æœºå™¨äºº&å…¬å·å˜èº«å›¾ç‰‡ä¸Šä¼ å·¥å…·](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752009&idx=1&sn=b6d533c6bf408daec7229e2ddb6843a0&chksm=80b0b863b7c73175ff3d6300ad1a2f9e013c5614397a7115a73eba38af715e9a905e28aaa49e#rd)  \n\nä»‹ç»äº†å¦‚ä½•ä½¿ç”¨æ­å»º&è®­ç»ƒèŠå¤©æœºå™¨äººä»¥åŠè®©å…¬å·æ”¯æŒå›¾ç‰‡ä¸Šä¼ åˆ°ä¸ƒç‰›ï¼ŒæŠŠå…¬å·å˜æˆä¸€ä¸ªä¸ƒç‰›å›¾ç‰‡ä¸Šä¼ å®¢æˆ·ç«¯ã€‚è¿™ä¸€ç¯‡å°†ç»§ç»­å¼€å‘å…¬å·ï¼Œè®©å…¬å·å˜æˆä¸€ä¸ªæ›´åŠ å®ç”¨çš„å·¥å…·`è´¦æœ¬`ï¼ˆç†è´¢ä»è®°è´¦å¼€å§‹ï¼‰ã€‚\n\n> `ä»£ç ï¼š` é¡¹ç›®ä»£ç å·²ä¸Šä¼ è‡³githubï¼Œåœ°å€ä¸º[gusibi/momoï¼šhttps://github.com/gusibi/momo](https://github.com/gusibi/momo)\n\nHUGOMORE42\n\n## è´¦æœ¬åŠŸèƒ½\n\nè´¦æœ¬æ˜¯ä¸€ä¸ªåŠŸèƒ½æ¯”è¾ƒç®€å•åº”ç”¨ï¼Œå…¬å·å†…åªéœ€è¦æ”¯æŒï¼š\n1. è®°è´¦ï¼ˆè®°è´¦ï¼Œä¿®æ”¹é‡‘é¢ï¼Œå–æ¶ˆè®°è´¦ï¼‰\n2. è´¦å•ç»Ÿè®¡ï¼ˆæä¾›æ•°æ®å’Œå›¾ç‰‡å½¢å¼çš„ç»Ÿè®¡åŠŸèƒ½ï¼‰\n\nå½“ç„¶åå°ç®¡ç†åŠŸèƒ½å°±æ¯”è¾ƒå¤šäº†ï¼Œè¿™ä¸ªä»¥åå†ä»‹ç»ã€‚\n\nå¯¹äºæ•°æ®å­˜å‚¨ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯MongoDBï¼ˆé€‰MongoDBçš„åŸå› æ˜¯ï¼Œä¹‹å‰æ²¡ç”¨è¿‡ï¼Œæƒ³è¯•ä¸€ä¸‹ï¼‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹MongoDBå’Œå…³ç³»å‹æ•°æ®åº“çš„ä¸åŒã€‚\n\n## MongoDB\n\n### ä»€ä¹ˆæ˜¯MongoDB ?\n\nMongoDB æ˜¯ç”±C++è¯­è¨€ç¼–å†™çš„ï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„é¢å‘æ–‡æ¡£çš„æ•°æ®åº“,æ˜“äºå¼€å‘å’Œç¼©æ”¾ã€‚\n\n> mongoå’Œä¼ ç»Ÿå…³ç³»æ•°æ®åº“çš„æœ€æœ¬è´¨çš„åŒºåˆ«åœ¨é‚£é‡Œå‘¢ï¼ŸMongoDB æ˜¯æ–‡æ¡£æ¨¡å‹ã€‚\n\nå…³ç³»æ¨¡å‹å’Œæ–‡æ¡£æ¨¡å‹çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ\n\n* å…³ç³»æ¨¡å‹éœ€è¦ä½ æŠŠä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œæ‹†åˆ†æˆé›¶éƒ¨ä»¶ï¼Œç„¶åå­˜åˆ°å„ä¸ªç›¸åº”çš„è¡¨é‡Œï¼Œéœ€è¦çš„æ˜¯æœ€åæŠŠå®ƒæ‹¼èµ·æ¥ã€‚ä¸¾ä¾‹å­æ¥è¯´ï¼Œå‡è®¾æˆ‘ä»¬è¦åšä¸€ä¸ªCRMåº”ç”¨ï¼Œé‚£ä¹ˆè¦ç®¡ç†å®¢æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®¢æˆ·åå­—ã€åœ°å€ã€ç”µè¯ç­‰ã€‚ç”±äºæ¯ä¸ªå®¢æˆ·å¯èƒ½æœ‰å¤šä¸ªç”µè¯ï¼Œé‚£ä¹ˆæŒ‰ç…§ç¬¬ä¸‰èŒƒå¼ï¼Œæˆ‘ä»¬ä¼šæŠŠç”µè¯å·ç ç”¨å•ç‹¬çš„ä¸€ä¸ªè¡¨æ¥å­˜å‚¨ï¼Œå¹¶åœ¨æ˜¾ç¤ºå®¢æˆ·ä¿¡æ¯çš„æ—¶å€™é€šè¿‡å…³è”æŠŠéœ€è¦çš„ä¿¡æ¯å–å›æ¥ã€‚\n* è€ŒMongoDBçš„æ–‡æ¡£æ¨¡å¼ï¼Œä¸è¿™ä¸ªæ¨¡å¼å¤§ä¸ç›¸åŒã€‚ç”±äºæˆ‘ä»¬çš„å­˜å‚¨å•ä½æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œå¯ä»¥æ”¯æŒæ•°ç»„å’ŒåµŒå¥—æ–‡æ¡£ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™ä½ ç›´æ¥ç”¨ä¸€ä¸ªè¿™æ ·çš„æ–‡æ¡£å°±å¯ä»¥æ¶µç›–è¿™ä¸ªå®¢æˆ·ç›¸å…³çš„æ‰€æœ‰ä¸ªäººä¿¡æ¯ã€‚å…³ç³»å‹æ•°æ®åº“çš„å…³è”åŠŸèƒ½ä¸ä¸€å®šå°±æ˜¯å®ƒçš„ä¼˜åŠ¿ï¼Œè€Œæ˜¯å®ƒèƒ½å¤Ÿå·¥ä½œçš„å¿…è¦æ¡ä»¶ã€‚ è€Œåœ¨MongoDBé‡Œé¢ï¼Œåˆ©ç”¨å¯Œæ–‡æ¡£çš„æ€§è´¨ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå…³è”æ˜¯ä¸ªä¼ªéœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡åˆç†å»ºæ¨¡æ¥é¿å…åšå…³è”ã€‚\n![å…³ç³»æ¨¡å‹å’Œæ–‡æ¡£æ¨¡å‹åŒºåˆ«å›¾ä¾‹](http://www.mongoing.com/wp-content/uploads/2016/01/MongoDB-%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E8%BF%9B%E9%98%B6%E6%A1%88%E4%BE%8B_%E9%A1%B5%E9%9D%A2_04-1024x791.png)\n\n### MongoDB æ¦‚å¿µè§£æ\n\nåœ¨mongodbä¸­åŸºæœ¬çš„æ¦‚å¿µæ˜¯æ–‡æ¡£ã€é›†åˆã€æ•°æ®åº“ï¼Œä¸‹è¡¨æ˜¯MongoDBå’Œå…³ç³»å‹æ•°æ®åº“æ¦‚å¿µå¯¹æ¯”ï¼š\n\n|SQLæœ¯è¯­/æ¦‚å¿µ\t|MongoDBæœ¯è¯­/æ¦‚å¿µ\t|è§£é‡Š/è¯´æ˜|\n|------|------|------|\n|database\t   |database\t|æ•°æ®åº“\n|table\t       |collection\t|æ•°æ®åº“è¡¨/é›†åˆ\n|row\t       |document\t|æ•°æ®è®°å½•è¡Œ/æ–‡æ¡£\n|column\t       |field\t    |æ•°æ®å­—æ®µ/åŸŸ\n|index\t       |index\t    |ç´¢å¼•\n|table         |joins\t    |è¡¨è¿æ¥,MongoDBä¸æ”¯æŒ\n|primary key\t|primary key\t|ä¸»é”®,MongoDBè‡ªåŠ¨å°†_idå­—æ®µè®¾ç½®ä¸ºä¸»é”®\n\né€šè¿‡ä¸‹å›¾å®ä¾‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´ç›´è§‚çš„çš„äº†è§£Mongoä¸­çš„ä¸€äº›æ¦‚å¿µï¼š\n\n![Mongoä¸­çš„ä¸€äº›æ¦‚å¿µ](http://www.runoob.com/wp-content/uploads/2013/10/Figure-1-Mapping-Table-to-Collection-1.png)\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»ä½¿ç”¨çš„è§’åº¦æ¥ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨ python å¦‚ä½•ä½¿ç”¨MongoDBï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šå®ç°ä¸€ä¸ªç®€å•çš„MongoDBçš„ORMï¼ŒåŒæ—¶ä¹Ÿä¼šè§£é‡Šä¸€ä¸‹æ¶‰åŠåˆ°çš„æ¦‚å¿µã€‚\n\n## ç®€æ˜“ Python MongoDB ORM\n### python ä½¿ç”¨ mongodb\n\né¦–å…ˆï¼Œéœ€è¦ç¡®è®¤å·²ç»å®‰è£…äº† PyMongoï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\n\n```sh\npip install pymongo\n# æˆ–è€…\neasy_install pymongo\n```\nè¯¦ç»†å®‰è£…æ­¥éª¤å‚è€ƒ: [PyMongo Installing / Upgrading](http://api.mongodb.com/python/current/installation.html)\n\n#### è¿æ¥ MongoClientï¼š\n\n```python\n>>> from pymongo import MongoClient\n>>> client = MongoClient()\n```\nä¸Šè¿°å‘½ä»¤ä¼šä½¿ç”¨Mongoçš„é»˜è®¤hostå’Œç«¯å£å·ï¼Œå’Œä»¥ä¸‹å‘½ä»¤ä½œç”¨ç›¸åŒï¼š\n```python\nclient = MongoClient('localhost', 27017) # mongo é»˜è®¤ç«¯å£å·\nä¸º27017\n# ä¹Ÿå¯ä»¥è¿™æ ·å†™\nclient = MongoClient('mongodb://localhost:27017/')\n```\n\n#### é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“\n\nè·å– MongoClient åæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„æ˜¯é€‰æ‹©è¦æ‰§è¡Œçš„æ•°æ®åº“ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n\n```python\n>>> db = client.test_database # test_database æ˜¯é€‰æ‹©çš„æ•°æ®åº“åç§°\n# ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹è¿°æ–¹å¼\n>>> db = client['test-database']\n```\n\n> `æ•°æ®åº“ï¼ˆDatabaseï¼‰` \n> ä¸€ä¸ªmongodbä¸­å¯ä»¥å»ºç«‹å¤šä¸ªæ•°æ®åº“ã€‚\nMongoDBçš„é»˜è®¤æ•°æ®åº“ä¸º\"db\"ï¼Œè¯¥æ•°æ®åº“å­˜å‚¨åœ¨dataç›®å½•ä¸­ã€‚\nMongoDBçš„å•ä¸ªå®ä¾‹å¯ä»¥å®¹çº³å¤šä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œæ¯ä¸€ä¸ªéƒ½æœ‰è‡ªå·±çš„é›†åˆå’Œæƒé™ï¼Œä¸åŒçš„æ•°æ®åº“ä¹Ÿæ”¾ç½®åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚\n\"show dbs\" å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰æ•°æ®çš„åˆ—è¡¨ã€‚\n> æ‰§è¡Œ \"db\" å‘½ä»¤å¯ä»¥æ˜¾ç¤ºå½“å‰æ•°æ®åº“å¯¹è±¡æˆ–é›†åˆã€‚\n> è¿è¡Œ\"use\"å‘½ä»¤ï¼Œå¯ä»¥è¿æ¥åˆ°ä¸€ä¸ªæŒ‡å®šçš„æ•°æ®åº“ã€‚\n\n#### è·å–é›†åˆ\n\né€‰æ‹©æ•°æ®åº“åï¼Œæ¥ä¸‹æ¥å°±æ˜¯é€‰æ‹©ä¸€ä¸ªé›†åˆï¼ˆCollectionï¼‰ï¼Œè·å–ä¸€ä¸ªé›†åˆå’Œé€‰æ‹©ä¸€ä¸ªæ•°æ®åº“çš„æ–¹å¼åŸºæœ¬ä¸€è‡´ï¼š\n\n```python\n>>> collection = db.test_collection  # test_collection æ˜¯é›†åˆåç§°\n# ä¹Ÿå¯ä»¥ä½¿ç”¨å­—å…¸çš„å½¢å¼\n>>> collection = db['test-collection']\n```\n\n> `é›†åˆï¼ˆcollectionï¼‰`\n> é›†åˆå°±æ˜¯ MongoDB æ–‡æ¡£ç»„ï¼Œç±»ä¼¼äº RDBMS ï¼ˆå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼šRelational Database Management System)ä¸­çš„è¡¨ã€‚\né›†åˆå­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œé›†åˆæ²¡æœ‰å›ºå®šçš„ç»“æ„ï¼Œè¿™æ„å‘³ç€ä½ åœ¨å¯¹é›†åˆå¯ä»¥æ’å…¥ä¸åŒæ ¼å¼å’Œç±»å‹çš„æ•°æ®ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ’å…¥é›†åˆçš„æ•°æ®éƒ½ä¼šæœ‰ä¸€å®šçš„å…³è”æ€§ã€‚\n> `å½“ç¬¬ä¸€ä¸ªæ–‡æ¡£æ’å…¥æ—¶ï¼Œé›†åˆå°±ä¼šè¢«åˆ›å»ºã€‚`\n> é›†åˆå`ä¸èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²\"\"`ã€‚\n> é›†åˆå`ä¸èƒ½å«æœ‰\\0å­—ç¬¦ï¼ˆç©ºå­—ç¬¦)`ï¼Œè¿™ä¸ªå­—ç¬¦è¡¨ç¤ºé›†åˆåçš„ç»“å°¾ã€‚\n> é›†åˆå`ä¸èƒ½ä»¥\"system.\"å¼€å¤´`ï¼Œè¿™æ˜¯ä¸ºç³»ç»Ÿé›†åˆä¿ç•™çš„å‰ç¼€ã€‚\n> ç”¨æˆ·åˆ›å»ºçš„é›†åˆåå­—`ä¸èƒ½å«æœ‰ä¿ç•™å­—ç¬¦`ã€‚æœ‰äº›é©±åŠ¨ç¨‹åºçš„ç¡®æ”¯æŒåœ¨é›†åˆåé‡Œé¢åŒ…å«ï¼Œè¿™æ˜¯å› ä¸ºæŸäº›ç³»ç»Ÿç”Ÿæˆçš„é›†åˆä¸­åŒ…å«è¯¥å­—ç¬¦ã€‚é™¤éä½ è¦è®¿é—®è¿™ç§ç³»ç»Ÿåˆ›å»ºçš„é›†åˆï¼Œå¦åˆ™åƒä¸‡ä¸è¦åœ¨åå­—é‡Œå‡ºç°$ã€‚ã€€\n\näº†è§£è¿™å‡ ä¸ªæ“ä½œåæˆ‘ä»¬æŠŠè¿™å‡ ä¸ªå°è£…ä¸€ä¸‹ï¼š\n\n```python\nfrom six import with_metaclass\nfrom pymongo import MongoClient\nfrom momo.settings import Config\n\npyclient = MongoClient(Config.MONGO_MASTER_URL)\n\nclass ModelMetaclass(type):\n    \"\"\"\n    Metaclass of the Model.\n    \"\"\"\n    __collection__ = None\n\n    def __init__(cls, name, bases, attrs):\n        super(ModelMetaclass, cls).__init__(name, bases, attrs)\n        cls.db = pyclient['momo_bill']  # æ•°æ®åº“åç§°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ é€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ªåº”ç”¨åªæ˜¯ç”¨ä¸€ä¸ªæ•°æ®åº“å°±èƒ½å®ç°éœ€æ±‚\n        if cls.__collection__:\n            cls.collection = cls.db[cls.__collection__]\n\n\nclass Model(with_metaclass(ModelMetaclass, object)):\n\n    __collection__ = 'model_base'\n```\n\nç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªé›†åˆï¼ˆCollectionï¼‰ï¼š\n```python\nclass Account(Model):\n\n    '''\n    æš‚æ—¶åœ¨è¿™é‡Œå£°æ˜æ–‡æ¡£ç»“æ„ï¼Œç”¨ä¸ç”¨åšæ ¡éªŒï¼Œåªæ˜¯æ–¹ä¾¿è‡ªå·±æŸ¥é˜…\n    ä»¥åä¹Ÿä¸ä¼šå˜æˆç±»ä¼¼ SQLAlchemy é‚£ç§å¼ºæ ¡éªŒçš„å½¢å¼\n    :param _id: 'ç”¨æˆ·ID',\n    :param nickname: 'ç”¨æˆ·æ˜µç§° ç”¨æˆ·æ˜¾ç¤º',\n    :param username: 'ç”¨æˆ·å ç”¨äºç™»å½•',\n    :param avatar: 'å¤´åƒ',\n    :param password: 'å¯†ç ',\n    :param created_time: 'åˆ›å»ºæ—¶é—´',\n    '''\n    __collection__ = 'account'  # é›†åˆå\n```\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```python\naccount = Account()\n```\nç°åœ¨å°±å·²ç»æŒ‡å®šäº†æ•°æ®åº“å’Œé›†åˆï¼Œå¯ä»¥è‡ªç”±åš CURD æ“ä½œäº†ï¼ˆè™½ç„¶è¿˜ä¸æ”¯æŒï¼‰ã€‚\n\n#### åˆ›å»ºæ–‡æ¡£ï¼ˆinsert documentï¼‰\n\nä½¿ç”¨PyMongo åˆ›å»ºæ–‡æ¡£éå¸¸æ–¹ä¾¿ï¼š\n\n```python\n>>> import datetime\n>>> account = {\"nickname\": \"Mike\",\n...         \"username\": \"mike\",\n...         \"avatar\": \"http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK\",\n...         \"password\": \"password\",\n...         \"created_time\": datetime.datetime.utcnow()}\n\n>>> accounts = db.account\n>>> account_id = accounts.insert_one(account).inserted_id\n>>> account_id\nObjectId('...')\n```\n\nåˆ›å»ºä¸€ä¸ªæ–‡æ¡£æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®š `_id`ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ ä¸Š`_id` å­—æ®µï¼Œè¿™ä¸ªå­—æ®µå¿…é¡»æ˜¯å”¯ä¸€ä¸å¯é‡å¤çš„å­—æ®µã€‚\n\nä¹Ÿå¯æ˜¯ä½¿ç”¨ `collection_names` å‘½ä»¤æ˜¾ç¤ºæ‰€æœ‰çš„é›†åˆï¼š\n```python\n>>> db.collection_names(include_system_collections=False)\n[u'account']\n```\n> `æ–‡æ¡£ï¼ˆDocumentï¼‰` æ–‡æ¡£æ˜¯ä¸€ç»„é”®å€¼(key-value)å¯¹(å³BSON)ã€‚MongoDB çš„æ–‡æ¡£ä¸éœ€è¦è®¾ç½®ç›¸åŒçš„å­—æ®µï¼Œå¹¶ä¸”ç›¸åŒçš„å­—æ®µä¸éœ€è¦ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œè¿™ä¸å…³ç³»å‹æ•°æ®åº“æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œä¹Ÿæ˜¯ MongoDB éå¸¸çªå‡ºçš„ç‰¹ç‚¹ã€‚\n\nç°åœ¨æˆ‘ä»¬ç»™è¿™ä¸ªç®€æ˜“ORMæ·»åŠ åˆ›å»ºæ–‡æ¡£çš„åŠŸèƒ½ï¼š\n```python\nclass Model(with_metaclass(ModelMetaclass, object)):\n\n    __collection__ = 'model_base'\n\n    @classmethod\n    def insert(cls, **kwargs):\n        # insert one document\n        doc = cls.collection.insert_one(kwargs)\n        return doc\n        \n    @classmethod\n    def bulk_inserts(cls, *params):\n        '''\n        :param params: document list\n        :return: \n        '''\n        results = cls.collection.insert_many(params)\n        return results        \n```\n\nåˆ›å»ºä¸€ä¸ªæ–‡æ¡£æ–¹æ³•ä¸ºï¼š\n\n```python\naccount = Account.insert(\"nickname\": \"Mike\",\n        \"username\": \"mike\",\n        \"avatar\": \"http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK\",\n        \"password\": \"password\",\n        \"created_time\": datetime.datetime.utcnow())\n```\n\n#### æŸ¥è¯¢æ–‡æ¡£\n\nä½¿ç”¨ `find_one` è·å–å•ä¸ªæ–‡æ¡£ï¼š\n\n```python\naccounts.find_one()\n```\n\n> å¦‚æœæ²¡æœ‰ä»»ä½•ç­›é€‰æ¡ä»¶ï¼Œfind_one å‘½ä»¤ä¼šå–é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£\n> å¦‚æœæœ‰ç­›é€‰æ¡ä»¶ï¼Œä¼šå–ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£\n\n```python\naccounts.find_one({\"nickname\": \"mike\"})\n```\n\nä½¿ç”¨ `ObjectId` æŸ¥è¯¢å•ä¸ªæ–‡æ¡£ï¼š\n\n```python\naccounts.find_one({\"_id\": account_id})\n```\n\nå°†è¿™ä¸ªæ·»åŠ åˆ°ORMä¸­ï¼š\n\n```python\nclass Model(with_metaclass(ModelMetaclass, object)):\n\n    __collection__ = 'model_base'\n\n    @classmethod\n    def get(cls, _id=None, **kwargs):\n        if _id: # å¦‚æœæœ‰_id\n            doc = cls.collection.find_one({'_id': _id})\n        else: # å¦‚æœæ²¡æœ‰id\n            doc = cls.collection.find_one(kwargs)\n        return doc\n```\nå¦‚æœä½ æƒ³è·å–å¤šä¸ªæ–‡æ¡£å¯ä»¥ä½¿ç”¨`find`å‘½ä»¤ã€‚\n\nä½¿ç”¨`find`å‘½ä»¤è·å–å¤šä¸ªæ–‡æ¡£\n\n```python\naccounts.find()\n# å½“ç„¶æ”¯æŒç­›é€‰æ¡ä»¶\naccounts.find({\"nickname\": \"mike\"})\n```\n\nå°†è¿™ä¸ªåŠŸèƒ½æ·»åŠ åˆ°ORMï¼š\n\n```python\nclass Model(with_metaclass(ModelMetaclass, object)):\n\n    __collection__ = 'model_base'\n    \n    @classmethod\n    def find(cls, filter=None, projection=None, skip=0, limit=20, **kwargs):\n        docs = cls.collection.find(filter=filter,\n                                   projection=projection,\n                                   skip=skip, \n                                   limit=limit,\n                                   **kwargs)\n        return docs\n```\n\nç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·åšæŸ¥è¯¢æ“ä½œï¼š\n\n```python\naccount = Account.get(_id='account_id')\naccounts = Account.find({'name': \"mike\"})\n```\n\n#### ä¿®æ”¹ï¼ˆupdateï¼‰\n\næ›´æ–°æ“ä½œ[æ–‡æ¡£åœ°å€ï¼šhttp://api.mongodb.com/python/current/api/pymongo/collection.html#pymongo.collection.Collection.update_one](http://api.mongodb.com/python/current/api/pymongo/collection.html?highlight=update_one#pymongo.collection.Collection.update_one)ï¼š\n\n> `update_one`(filter, update, upsert=False, bypass_document_validation=False, collation=None)\n\næ›´æ–°ä¸€ä¸ªç¬¦åˆç­›é€‰æ¡ä»¶çš„æ–‡æ¡£ upsert å¦‚æœä¸ºTrue åˆ™ä¼šåœ¨æ²¡æœ‰åŒ¹é…åˆ°æ–‡æ¡£çš„æ—¶å€™åˆ›å»ºä¸€ä¸ª\n> `update_many`(filter, update, upsert=False, bypass_document_validation=False, collation=None)\n\næ›´æ–°å…¨éƒ¨ç¬¦åˆç­›é€‰æ¡ä»¶çš„æ–‡æ¡£ upsert å¦‚æœä¸ºTrue åˆ™ä¼šåœ¨æ²¡æœ‰åŒ¹é…åˆ°æ–‡æ¡£çš„æ—¶å€™åˆ›å»ºä¸€ä¸ª\n\næ·»åŠ åˆ°ORMä¸­ï¼š\n\n```python\nclass Model(with_metaclass(ModelMetaclass, object)):\n\n    __collection__ = 'model_base'\n    \n    @classmethod\n    def update_one(cls, filter, **kwargs):\n        result = cls.collection.update_one(filter, **kwargs)\n        return result\n\n    @classmethod\n    def update_many(cls, filter, **kwargs):\n        results = cls.collection.update_many(filter, **kwargs)\n        return results\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘è¿™é‡Œå¹¶æ²¡æœ‰åšå¤šä½™çš„æ“ä½œï¼Œåªæ˜¯ç›´æ¥è°ƒç”¨äº†PyMongoçš„æ–¹æ³•ã€‚\n\n#### åˆ é™¤\n\nåˆ é™¤æ“ä½œå’Œupdateç±»ä¼¼ä½†æ˜¯æ¯”è¾ƒç®€å•ï¼š\n\n> delete_one(filter, collation=None):\n\nåˆ é™¤ä¸€ä¸ªåŒ¹é…åˆ°çš„æ–‡æ¡£\n\n> delete_many(filter, collation=None):\n\nåˆ é™¤å…¨éƒ¨åŒ¹é…åˆ°çš„æ–‡æ¡£\n\næ·»åŠ åˆ°ORMä¸­ï¼š\n\n```python\nclass Model(with_metaclass(ModelMetaclass, object)):\n\n    __collection__ = 'model_base'\n\n    @classmethod\n    def delete_one(cls, **filter):\n        cls.collection.delete_one(filter)\n\n    @classmethod\n    def delete_many(cls, **filter):\n        cls.collection.delete_many(filter)\n\n```\n\nåˆ°è¿™é‡Œï¼Œç®€æ˜“çš„ORMå°±å®ç°äº†ï¼ˆè¿™åªèƒ½ç®—æ˜¯ä¸ªåŠŸèƒ½ç®€å•çš„æ¡†ï¼Œå¯ä»¥å†è‡ªç”±æ·»åŠ å…¶å®ƒæ›´å¤šçš„åŠŸèƒ½ï¼‰ã€‚\n\næ¥ä¸‹æ¥æ˜¯è´¦æœ¬æ–‡æ¡£ç»“æ„çš„è®¾è®¡\n\n## è´¦æœ¬æ•°æ®ç»“æ„è®¾è®¡\n\nè´¦æœ¬éœ€è¦åŒ…å«çš„æ•°æ®æœ‰ï¼š\n\n* è´¦æˆ·æ‰€æœ‰äºº\n* è´¦å•è®°å½•\n* è´¦å•åˆ†ç±»\n\né‚£ä¹ˆæˆ‘ä»¬è‡³å°‘éœ€è¦ä¸‰ä¸ªé›†åˆï¼š\n\n```python\n{\n    'account': {  # ç”¨æˆ·é›†åˆ\n        '_id': 'ç”¨æˆ·ID',\n        'nickname': 'ç”¨æˆ·æ˜µç§°',\n        'username': 'ç”¨æˆ·å ç”¨äºç™»å½•',\n        'avatar': 'å¤´åƒ',\n        'password': 'å¯†ç ',\n        'created_time': 'åˆ›å»ºæ—¶é—´',\n    },\n    'bill': { # è´¦å•é›†åˆ\n        '_id': 'è´¦å•ID',\n        'uid': 'ç”¨æˆ·ID',\n        'money': 'é‡‘é¢ ç²¾ç¡®åˆ°åˆ†',\n        'tag': 'æ ‡ç­¾',\n        'remark': 'å¤‡æ³¨',\n        'created_time': 'åˆ›å»ºæ—¶é—´',\n    },\n    'tag': {  # è´¦å•æ ‡ç­¾\n        '_id': 'æ ‡ç­¾ID',\n        'name': 'æ ‡ç­¾å',\n        'icon': 'æ ‡ç­¾å›¾æ ‡',\n        'uid': 'åˆ›å»ºè€…IDï¼ˆé»˜è®¤æ˜¯ç®¡ç†å‘˜ï¼‰',\n        'created_time': 'åˆ›å»ºæ—¶é—´',\n    }\n}\n```\n\nè¿™é‡Œè´¦å•å’Œç”¨æˆ·ä½¿ç”¨ uid ä½œä¸ºå¼•ç”¨çš„å…³è”ï¼Œaccount å’Œ bill æ˜¯ä¸€å¯¹å¤šå…³ç³»ã€‚\n\n> å½“ç„¶ä½ ä¹Ÿå¯ä»¥å†åŠ ä¸€ä¸ªè´¦æœ¬çš„é›†åˆï¼Œç”¨æˆ·å’Œè´¦æœ¬å¯¹åº”ï¼Œè¿™æ—¶ï¼Œè´¦å•å¯ä»¥ä½œä¸ºè´¦æœ¬ä¸­çš„ä¸€ä¸ªlistæ•°æ®ç»“æ„ï¼ˆå•ä¸ªæ–‡æ¡£æœ‰16Mçš„é™åˆ¶ï¼Œå¦‚æœå­˜å‚¨è¶…è¿‡è¿™ä¸ªå¤§å°ä¸èƒ½ä½¿ç”¨è¿™ç§å½¢å¼ï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ“ä½œä¼šæ¯”è¾ƒç¼“æ…¢ï¼‰ã€‚\n\nä½œä¸ºå…¬å·ä¸­çš„è´¦æœ¬ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸åŠ è´¦æœ¬åŠŸèƒ½ï¼Œå› ä¸ºè¿™ä¼šè®©æˆ‘ä»¬çš„æ“ä½œå˜å¾—å¤æ‚ã€‚\n\nå› ä¸ºå…¬å·é‡Œçš„æ¯æ¬¡æ“ä½œéƒ½æ˜¯ç‹¬ç«‹è¯·æ±‚ï¼Œå¹¶æ²¡æœ‰ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è®°å½•è®°è´¦è¿™ä¸ªæ“ä½œèµ°åˆ°äº†å“ªä¸€æ­¥ï¼Œæ¥ä¸‹æ¥æ”¹å¹²å˜›ã€‚\n\nè®°è´¦é€»è¾‘å¦‚å›¾ï¼š\n\n![å…¬å·è®°è´¦æµç¨‹å›¾](http://media.gusibi.mobi/5hzgvdbSsM37XRm-A8mRkPe6d2sHmvvT6w3RgNAKzoHxZwpxcE3f_tRBsFxRgA-p)\n\næ‰€ä»¥æˆ‘ä»¬è¿™é‡Œè¦æœ‰æ•°æ®æ¥è®°å½•å½“å‰çš„æ“ä½œæ­¥éª¤ä»¥åŠæ¥ä¸‹æ¥æ”¹æœ‰çš„æ“ä½œæ­¥éª¤ï¼š\n\n```python\n{\n    'account_workflow': {  # ç”¨æˆ·å½“å‰å·¥ä½œæµ\n        '_id': 'id', \n        'next': 'ä¸‹ä¸€æ­¥çš„æ“ä½œ',\n        'uid': 'ç”¨æˆ·ID',\n        'workflow': 'ä½¿ç”¨çš„å·¥ä½œæµ',\n        'created_time': 'å¼€å§‹æ—¶é—´'\n    }\n}\n```\n\nè¿™ä¸ªé›†åˆè®°å½•äº†æˆ‘ä»¬å½“å‰æ‰€åœ¨çš„å·¥ä½œæµï¼Œä¸‹ä¸€æ­¥è¯¥èµ°å‘å“ªä¸€æ­¥ã€‚\n\n> è¿™ä¸ªé›†åˆéœ€è¦è®¾ç½®æ–‡æ¡£çš„è¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚è¾“å…¥ â€œè®°è´¦â€ æ¿€æ´»è®°è´¦å·¥ä½œæµåï¼Œå¦‚æœ10åˆ†é’Ÿæ²¡æœ‰æ“ä½œå®Œæˆï¼Œé‚£ä¹ˆéœ€è¦é‡æ–°å¼€å§‹ã€‚ä»¥å…è¾“å…¥è®°è´¦åä¸å®Œæˆä¸èƒ½ç»§ç»­å…¶å®ƒçš„æ“ä½œã€‚\n\nä¸‹é¢çš„è¿™ä¸ªé›†åˆè®°å½•äº†å“ªäº›å…³é”®å­—å¯ä»¥æ¿€æ´»å·¥ä½œæµï¼Œå¯¹åº”çš„å·¥ä½œæµæ˜¯ä»€ä¹ˆä»¥åŠå¼€å§‹å“ªä¸ªåŠ¨ä½œã€‚\n\n```python\n{\n    'keyword': {  # ç‰¹æ®Šå…³é”®å­—\n        '_id': 'å…³é”®å­—ID',\n        'word': 'å…³é”®å­—',\n        'data': {\n            'workflow': 'å·¥ä½œæµ',\n            'action': 'å·¥ä½œæµåŠ¨ä½œ',\n            'value': 'è¿”å›å€¼',\n            'type': 'è¿”å›å€¼ç±»å‹ url|pic|text',\n        },\n        'created_time': 'åˆ›å»ºæ—¶é—´'\n    },\n}\n```\n\nåˆ°è¿™é‡Œè´¦æœ¬çš„æ•°æ®åº“è®¾è®¡å°±ç»“æŸäº†ã€‚\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»äº†MongoDBï¼ŒPyMongo çš„ä½¿ç”¨ä»¥åŠå¦‚ä½•ç¼–å†™ä¸€ä¸ªç®€æ˜“çš„MongoDB ORMã€‚\nç„¶ååˆä»‹ç»äº†åŸºäº MongoDB çš„å…¬å·è´¦æœ¬åº”ç”¨çš„æ•°æ®åº“è®¾è®¡ã€‚\n\n### é¢„å‘Š\n\nä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†ä»‹ç»ï¼Œå¦‚ä½•å®ç°è®°è´¦åŠŸèƒ½ã€‚\n\nä»¥ä¸‹æ˜¯æ“ä½œæˆªå›¾ã€‚\n\n![è®°è´¦](http://media.gusibi.mobi/SDTcm0mQp-0ugO8R9bz9NxA-HrhsKBXCdEK85exrLYmU7EiI2X07FhsVRFhQqj3K)\n![ä¿®æ”¹é‡‘é¢](http://media.gusibi.mobi/Ya4Ip_QWn_XR2CnG5yipx9ZeG7s6wJZy8_SFYIKYPLOFk75KPq54e42x27v6kjD4)\n![å–æ¶ˆè®°è´¦](http://media.gusibi.mobi/JdJvDNlb4SyvozhE-1YSPdkTWkrk8A1BSO6pxmLUzHpF-7QyqEQYACAeetdkhbFo)\n\næ¬¢è¿å…³æ³¨å…¬å·`å››æœˆï¼ˆApril_Louisaï¼‰`è¯•ç”¨ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [MongoDBæ•°æ®åº“è®¾è®¡ä¸­6æ¡é‡è¦çš„ç»éªŒæ³•åˆ™ï¼šhttp://www.cnblogs.com/WeiGe/p/4903850.html](http://www.cnblogs.com/WeiGe/p/4903850.html)\n* [MongoDB è¿›é˜¶æ¨¡å¼è®¾è®¡ï¼šhttp://www.mongoing.com/mongodb-advanced-pattern-design](http://www.mongoing.com/mongodb-advanced-pattern-design)\n* [MongoDB æ¦‚å¿µè§£æï¼šhttp://www.runoob.com/mongodb/mongodb-databases-documents-collections.html](http://www.runoob.com/mongodb/mongodb-databases-documents-collections.html)\n* [PyMongo 3.4.0 Documentationï¼šhttp://api.mongodb.com/python/current/index.html](http://api.mongodb.com/python/current/index.html)\n\n-------\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å¾®ä¿¡å…¬å·DIYï¼šMongoDB ç®€æ˜“ORM & å…¬å·è®°è´¦æ•°æ®åº“è®¾è®¡",
        "date": "2017-07-16 13:14:10",
        "tags": [
          "python",
          "tutorial",
          "weixin",
          "å…¬ä¼—å·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "weixin_mp_diy_setp_by_setp_1_db_desgin"
    },
    {
      "content": "\n## ä»€ä¹ˆæ˜¯ RESTful\n \n### ä»€ä¹ˆæ˜¯REST\n\nRESTï¼ˆè‹±æ–‡ï¼šRepresentational State Transferï¼Œåˆç§°å…·è±¡çŠ¶æ€ä¼ è¾“ï¼‰æ˜¯Roy Thomas Fieldingåšå£«äº2000å¹´åœ¨ä»–çš„åšå£«è®ºæ–‡[1] ä¸­æå‡ºæ¥çš„ä¸€ç§ä¸‡ç»´ç½‘è½¯ä»¶æ¶æ„é£æ ¼ï¼Œç›®çš„æ˜¯ä¾¿äºä¸åŒè½¯ä»¶/ç¨‹åºåœ¨ç½‘ç»œï¼ˆä¾‹å¦‚äº’è”ç½‘ï¼‰ä¸­äº’ç›¸ä¼ é€’ä¿¡æ¯ã€‚\n\nREST çš„æ ¸å¿ƒæ˜¯å¯ç¼–è¾‘çš„èµ„æºåŠå…¶é›†åˆï¼Œç”¨ç¬¦åˆ Atom æ–‡æ¡£æ ‡å‡†çš„ Feed å’Œ Entry è¡¨ç¤ºã€‚æ¯ä¸ªèµ„æºæˆ–è€…é›†åˆæœ‰ä¸€ä¸ªæƒŸä¸€çš„ URIã€‚ç³»ç»Ÿä»¥èµ„æºä¸ºä¸­å¿ƒï¼Œæ„å»ºå¹¶æä¾›ä¸€ç³»åˆ—çš„ Web æœåŠ¡ã€‚\n\nåœ¨ REST ä¸­ï¼Œå¼€å‘äººå‘˜æ˜¾å¼åœ°ä½¿ç”¨ HTTP æ–¹æ³•ï¼Œå¯¹ç³»ç»Ÿèµ„æºè¿›è¡Œåˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤çš„æ“ä½œï¼š\n\n* ä½¿ç”¨ POST æ–¹æ³•åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºèµ„æº\n* ä½¿ç”¨ GET æ–¹æ³•ä»æœåŠ¡å™¨æ£€ç´¢æŸä¸ªèµ„æºæˆ–è€…èµ„æºé›†åˆ\n* ä½¿ç”¨ PUT æ–¹æ³•å¯¹æœåŠ¡å™¨çš„ç°æœ‰èµ„æºè¿›è¡Œæ›´æ–°\n* ä½¿ç”¨ DELETE æ–¹æ³•åˆ é™¤æœåŠ¡å™¨çš„æŸä¸ªèµ„æº\n\nå¦‚æœä¸€ä¸ªæ¶æ„ç¬¦åˆRESTåŸåˆ™ï¼Œå°±å¯ä»¥ç§°å®ƒä¸º`RESTfulæ¶æ„`ã€‚\n\n#### RESTful API è®¾è®¡å®šä¹‰\n\nä»¥ä¸‹æ˜¯å‡ ä¸ªRESTful APIçš„å‡ ä¸ªæ¦‚å¿µã€‚\n\n* èµ„æºï¼ˆResourceï¼‰ï¼šç³»ç»Ÿä¸Šçš„æ‰€æœ‰äº‹ç‰©éƒ½è¢«æŠ½è±¡ä¸ºèµ„æºï¼ˆä¸€ç¯‡æ–‡ç« ï¼Œä¸€å¼ ç…§ç‰‡ï¼Œä¸€æ®µè¯­éŸ³ï¼‰\n* é›†åˆï¼ˆCollectionï¼‰ï¼šä¸€ç»„èµ„æºçš„åˆè¾‘ç§°ä¸ºé›†åˆï¼ˆå‡ ç¯‡æ–‡ç« ï¼Œå‡ å¼ ç…§ç‰‡ï¼‰\n* è·¯å¾„ï¼ˆEndpointï¼‰ï¼šè·¯å¾„åˆç§°â€ç»ˆç‚¹â€œï¼Œè¡¨ç¤ºAPIçš„å…·ä½“ç½‘å€ï¼ˆæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼‰\n\né‚£ä¹ˆä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„RESTful APIåº”è¯¥éµå¾ªå“ªäº›åŸåˆ™å‘¢ï¼Ÿ\n\n##### åè®®\n\nAPIä¸ç”¨æˆ·çš„é€šä¿¡åè®®æ€»æ˜¯ä½¿ç”¨HTTPsåè®®ã€‚\n\n##### åŸŸå\n\nåº”è¯¥å°½é‡å°†APIéƒ¨ç½²åœ¨ä¸“ç”¨åŸŸåï¼Œä¾‹å¦‚ï¼š\n\n```sh\nhttps://apis.gusibi.com\n```\n#####  APIåœ°å€å’Œç‰ˆæœ¬\n\nåœ¨urlä¸­æŒ‡å®šAPIç‰ˆæœ¬ã€‚æ¯”å¦‚ï¼š\n\n```sh\nhttps://apis.gusibi.com/v1\n```\n\n##### ä»¥èµ„æºä¸ºä¸­å¿ƒè®¾è®¡URL\n\nèµ„æºæ˜¯RESTful APIçš„æ ¸å¿ƒå…ƒç´ ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯é’ˆå¯¹ç‰¹å®šèµ„æºè¿›åŒ–çš„ã€‚è€Œèµ„æºå°±æ˜¯URLè¡¨ç¤ºçš„ï¼Œæ‰€ä»¥ç®€æ´ã€æ¸…æ™°ã€ç»“æ„åŒ–çš„URLè®¾è®¡æ˜¯è‡³å…³é‡è¦çš„ã€‚ \nåœ¨RESTful æ¶æ„ä¸­ï¼Œæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼ˆresourceï¼‰ï¼Œæ‰€ä»¥ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼Œè€Œä¸”æ‰€ç”¨çš„åè¯å¾€å¾€ä¸æ•°æ®åº“çš„è¡¨æ ¼åå¯¹åº”ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Github çš„ä¾‹å­ï¼š\n\n```sh\n/users/:username/repos\n/users/:org/repos\n/repos/:owner/:repo\n/repos/:owner/:repo/tags\n/repos/:owner/:repo/branches/:branch\n```\n\n##### ä½¿ç”¨æ­£ç¡®çš„Method\n\nå¯¹äºèµ„æºçš„å…·ä½“æ“ä½œç±»å‹ï¼Œä½¿ç”¨HTTP method è¡¨ç¤ºã€‚\nä»¥ä¸‹æ˜¯å¸¸ç”¨çš„HTTPæ–¹æ³•ã€‚\n\n* GETï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æº\n* POSTï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æº\n* PUTï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æº\n* PATCHï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯åªæä¾›æ”¹å˜äº†å±æ€§ï¼‰\n* DELETEï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æº\n\nè¿˜æ˜¯ä½¿ç”¨ github çš„ä¾‹å­ï¼š\n\n```sh\nGET /repos/:owner/:repo/issues\nGET /repos/:owner/:repo/issues/:number\nPOST /repos/:owner/:repo/issues\nPATCH /repos/:owner/:repo/issues/:number\nDELETE /repos/:owner/:repo\n```\n\n##### æ­£ç¡®çš„è¿‡æ»¤ä¿¡æ¯ï¼ˆfilteringï¼‰\n\nå¦‚æœè®°å½•æ•°é‡å¾ˆå¤šï¼ŒæœåŠ¡å™¨ä¸èƒ½éƒ½å°†ä»–ä»¬è¿”å›ç»™ç”¨æˆ·ã€‚APIåº”è¯¥æä¾›å‚æ•°ï¼Œè¿‡æ»¤è¿”å›ç»“æœã€‚\n\nä¸‹è¾¹æ˜¯ä¸€äº›æ˜¯ã€å¸¸è§çš„å‚æ•°ã€‚\n\n* ?limit=10: æŒ‡å®šè¿”å›è®°å½•çš„æ•°é‡\n* ?offset=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„å¼€å§‹ä½ç½®\n* ?page=2&per_page=100ï¼šï¼šæŒ‡å®šç¬¬å‡ é¡µï¼Œä»¥åŠæ¯é¡µçš„è®°å½•æ•°ã€‚\n* ?sortby=name&order=ascï¼šæŒ‡å®šè¿”å›ç»“æœæŒ‰ç…§å“ªä¸ªå±æ€§æ’åºï¼Œä»¥åŠæ’åºé¡ºåºã€‚\n* ?animal_type_id=1ï¼šæŒ‡å®šç­›é€‰æ¡ä»¶\n\n##### é€‰æ‹©åˆé€‚çš„çŠ¶æ€ç \n\nHTTP åº”ç­”ä¸­ï¼Œéœ€è¦å¸¦ä¸€ä¸ªå¾ˆé‡è¦çš„å­—æ®µï¼šstatus codeã€‚å®ƒè¯´æ˜äº†è¯·æ±‚çš„å¤§è‡´æƒ…å†µï¼Œæ˜¯å¦æ­£å¸¸å®Œæˆã€éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€å‡ºç°äº†ä»€ä¹ˆé”™è¯¯ï¼Œå¯¹äºå®¢æˆ·ç«¯éå¸¸é‡è¦ã€‚çŠ¶æ€ç éƒ½æ˜¯ä¸‰ä½çš„æ•´æ•°ï¼Œå¤§æ¦‚åˆ†æˆäº†å‡ ä¸ªåŒºé—´ï¼š\n\n2XXï¼šè¯·æ±‚æ­£å¸¸å¤„ç†å¹¶è¿”å›\n3XXï¼šé‡å®šå‘ï¼Œè¯·æ±‚çš„èµ„æºä½ç½®å‘ç”Ÿå˜åŒ–\n4XXï¼šå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æœ‰é”™è¯¯\n5XXï¼šæœåŠ¡å™¨ç«¯é”™è¯¯\n\nå¸¸è§çš„çŠ¶æ€ç æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n> 200 OK - [GET]ï¼šæœåŠ¡å™¨æˆåŠŸè¿”å›ç”¨æˆ·è¯·æ±‚çš„æ•°æ®ï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼ˆIdempotentï¼‰ã€‚\n201 CREATED - [POST/PUT/PATCH]ï¼šç”¨æˆ·æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚\n204 NO CONTENT - [DELETE]ï¼šç”¨æˆ·åˆ é™¤æ•°æ®æˆåŠŸã€‚\n400 INVALID REQUEST - [POST/PUT/PATCH]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚\n401 Unauthorized - [*]ï¼šè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚\n403 Forbidden - [*] è¡¨ç¤ºç”¨æˆ·å¾—åˆ°æˆæƒï¼ˆä¸401é”™è¯¯ç›¸å¯¹ï¼‰ï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚\n404 NOT FOUND - [*]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚\n406 Not Acceptable - [GET]ï¼šç”¨æˆ·è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚JSONæ ¼å¼ï¼Œä½†æ˜¯åªæœ‰XMLæ ¼å¼ï¼‰ã€‚\n410 Gone -[GET]ï¼šç”¨æˆ·è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚\n422 Unprocesable entity - [POST/PUT/PATCH] å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚\n500 INTERNAL SERVER ERROR - [*]ï¼šæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œç”¨æˆ·å°†æ— æ³•åˆ¤æ–­å‘å‡ºçš„è¯·æ±‚æ˜¯å¦æˆåŠŸã€‚\n\n##### è¿”å›ç»“æœ\n\né’ˆå¯¹ä¸åŒæ“ä½œï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„ç»“æœåº”è¯¥ç¬¦åˆä»¥ä¸‹è§„èŒƒã€‚\n\n> GET /collectionï¼šè¿”å›èµ„æºå¯¹è±¡çš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰\nGET /collection/resourceï¼šè¿”å›å•ä¸ªèµ„æºå¯¹è±¡\nPOST /collectionï¼šè¿”å›æ–°ç”Ÿæˆçš„èµ„æºå¯¹è±¡\nPUT /collection/resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡\nPATCH /collection/resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡\nDELETE /collection/resourceï¼šè¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£\n\n##### é”™è¯¯å¤„ç†ï¼ˆError handlingï¼‰\n\nå¦‚æœå‡ºé”™çš„è¯ï¼Œåœ¨response body ä¸­é€šè¿‡ message ç»™å‡ºæ˜ç¡®çš„ä¿¡æ¯ã€‚å¦‚æœçŠ¶æ€ç æ˜¯4xxï¼Œå°±åº”è¯¥å‘ç”¨æˆ·è¿”å›å‡ºé”™ä¿¡æ¯ã€‚\n\n##### è‰¯å¥½çš„æ–‡æ¡£\n\næ–‡æ¡£åº”è¯¥æ˜¯è§„èŒƒçš„APIçš„é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œæ²¡æœ‰æ–‡æ¡£çš„APIæ˜¯éš¾ä»¥ç»™ä»–äººä½¿ç”¨çš„ï¼Œä¹Ÿæ˜¯ä¸åˆ©äºç»´æŠ¤çš„ã€‚\n\n##### å…¶å®ƒ\n\n* ä½¿ç”¨ OAuth2.0 é‰´æƒ\n* å°½é‡ä½¿ç”¨JSONä½œä¸ºè¿”å›çš„æ•°æ®æ ¼å¼\n* é™æµ\n\nå¯¹åº”ä¸Šè¿°è§„åˆ™ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ä¿è¯å…¶å®ƒçš„APIæä¾›è€…ä¹Ÿä¼šéµå®ˆï¼Œç‰¹åˆ«æ˜¯æ–‡æ¡£ï¼Œæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†APIæä¾›è€…ç»™å‡ºçš„æ–‡æ¡£æ˜¯pdfæˆ–è€…wordæ–‡æ¡£ï¼Œè¿™æ˜¯å› ä¸ºåœ¨APIçš„è¿­ä»£å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ–‡æ¡£æ›´æ–°ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚\n\nswaggerå¸®APIä½¿ç”¨è€…å’Œå¼€å‘è€…çº æ­£äº†è¿™ä¸ªé—®é¢˜ã€‚\n\n## ä»€ä¹ˆæ˜¯swagger\n\nSwaggeræ˜¯ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„APIè¡¨è¾¾å·¥å…·ã€‚æ”¹æ¡†æ¶ä¸ºåˆ›å»ºJSONæˆ–YAMLæ ¼å¼çš„RESTful API æ–‡æ¡£æä¾›äº†OpenAPIè§„èŒƒã€‚swaggeræ–‡æ¡£å¯ç”±å„ç§ç¼–ç¨‹è¯­è¨€å¤„ç†ï¼Œå¯ä»¥åœ¨è½¯ä»¶å¼€å‘å‘¨æœŸä¸­åµŒå…¥æºä»£ç æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œä»¥ä¾¿è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚ä½¿ç”¨Swaggerç”ŸæˆAPIï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°äº¤äº’å¼æ–‡æ¡£ï¼Œè‡ªåŠ¨ç”Ÿæˆä»£ç çš„SDKä»¥åŠAPIçš„å‘ç°ç‰¹æ€§ç­‰ã€‚\n\n### å¦‚ä½•ç¼–å†™APIæ–‡æ¡£\n\næˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨JSONæˆ–è€…YAMLæ¥ç¼–å†™APIæ–‡æ¡£ã€‚æ–‡æ¡£ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\njson æ ¼å¼æ–‡æ¡£ï¼š\n\n```json\n{\n    \"swagger\": \"2.0\",\n    \"info\": {\n        \"version\": \"1.0.0\",\n        \"title\": \"Simple API\",\n        \"description\": \"A simple API to learn how to write OpenAPI Specification\"\n    },\n    \"schemes\": [\n        \"https\"\n    ],\n    \"host\": \"simple.api\",\n    \"basePath\": \"/openapi101\",\n    \"paths\": {\n        \"/persons\": {\n            \"get\": {\n                \"summary\": \"Gets some persons\",\n                \"description\": \"Returns a list containing all persons.\",\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"A list of Person\",\n                        \"schema\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"properties\": {\n                                    \"firstName\": {\n                                        \"type\": \"string\"\n                                    },\n                                    \"lastName\": {\n                                        \"type\": \"string\"\n                                    },\n                                    \"username\": {\n                                        \"type\": \"string\"\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nyaml æ ¼å¼æ–‡æ¡£ï¼š\n```yml\nswagger: \"2.0\"\n\ninfo:\n  version: 1.0.0\n  title: Simple API\n  description: A simple API to learn how to write OpenAPI Specification\n\nschemes:\n  - https\nhost: simple.api\nbasePath: /openapi101\n\npaths:\n  /persons:\n    get:\n      summary: Gets some persons\n      description: Returns a list containing all persons.\n      responses:\n        200:\n          description: A list of Person\n          schema:\n            type: array\n            items:\n              required:\n                - username\n              properties:\n                firstName:\n                  type: string\n                lastName:\n                  type: string\n                username:\n                  type: string\n```\n\nå¯ä»¥å‘ç°ï¼Œyamlæ ¼å¼çš„æ–‡æ¡£æ¯”jsonæ ¼å¼çš„æ›´æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´é«˜ï¼Œæ¨èä½¿ç”¨yamlæ ¼å¼ä¹¦å†™æ–‡æ¡£ã€‚\n\nswagger å®˜ç½‘æä¾›äº† [swagger editor: http://editor.swagger.io/#/](http://editor.swagger.io/#/)ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªç¼–è¾‘å™¨ä¸­åˆ›å»ºæˆ–å¯¼å…¥æ–‡æ¡£ï¼Œå¹¶åœ¨äº¤äº’å¼ç¯å¢ƒä¸­æµè§ˆå®ƒã€‚\n\nä»¥ä¸‹æ˜¯æ‚¨å¯¼å…¥ leads.yaml å®šä¹‰åçš„ Swagger Editor UI å¤–è§‚ï¼š\n\n![Swagger Editor UI å¤–è§‚](http://media.gusibi.mobi/5f3vEHQSGzv7HLePBpb-fIZBRCw5wnuCkBe4gPFLMtQTuz4LsZCOMHq5gWv-dlal)\n\nå³ä¾§çš„æ˜¾ç¤ºçª—æ ¼æ˜¾ç¤ºäº†æ ¼å¼åŒ–çš„æ–‡æ¡£ï¼Œåæ˜ äº†åœ¨å·¦ä¾§çª—æ ¼ä¸­çš„ä»£ç ç¼–è¾‘å™¨ä¸­æ‰§è¡Œçš„æ›´æ”¹ã€‚ä»£ç ç¼–è¾‘å™¨ä¼šæŒ‡å‡ºäº†æ‰€æœ‰æ ¼å¼é”™è¯¯ã€‚ä½ å¯ä»¥å±•å¼€å’ŒæŠ˜å æ¯ä¸ªçª—æ ¼ã€‚\n\n### APIæ–‡æ¡£çš„åŸºæœ¬ç»“æ„\n\næˆ‘ç”¨ä¸€ä¸ªä¾‹å­æ¥ä»‹ç»ä¸‹swaggeræ–‡æ¡£çš„åŸºæœ¬ç»“æ„ï¼Œè¿™é‡Œæˆ‘ç”¨yamlæ ¼å¼æ¥ç¼–å†™æ–‡æ¡£ï¼š\n\n```yml\nswagger: \"2.0\"\ninfo:\n  title: Sample API\n  description: API description in Markdown.\n  version: 1.0.0\n\nhost: api.example.com\nbasePath: /v1\nschemes:\n  - https\n\npaths:\n  /users:\n    get:\n      summary: Returns a list of users.\n      description: Optional extended description in Markdown.\n      produces:\n        - application/json\n      responses:\n        200:\n          description: OK\n```\n\nä¸Šè¿°æ–‡æ¡£åŒ…æ‹¬å…ƒæ•°æ®ï¼ˆMetadataï¼‰ã€Base URLã€APIè·¯å¾„ï¼ˆpathsï¼‰ä¸‰éƒ¨åˆ†ï¼š\n\n#### Metadata\n\nè¿™éƒ¨åˆ†ä¿¡æ¯åŒ…æ‹¬swagger ä½¿ç”¨çš„ç‰ˆæœ¬ï¼š\n\n```yml\nswagger: \"2.0\"\n```\nAPIç›¸å…³çš„æè¿°ä¿¡æ¯ï¼ˆæ¯”å¦‚APIä»‹ç»ã€ç‰ˆæœ¬ç­‰ï¼‰ï¼š\n\n```yml\ninfo:\n  title: Sample API\n  description: API description in Markdown.\n  version: 1.0.0\n```\n\n#### Base URL\n\nä½œä¸ºweb APIï¼Œä¸€ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯å°±æ˜¯ç”¨æ¥ç»™ç”¨æˆ·ä½¿ç”¨çš„ æ ¹URLï¼Œå¯ç”¨åè®®ï¼ˆhttp/httpsï¼‰ã€hoståœ°å€ï¼š\n\n```yml\nhost: api.example.com\nbasePath: /v1\nschemes:\n  - https\n```\n\næ‰€æœ‰çš„APIéƒ½æ˜¯base URL çš„ç›¸å¯¹è·¯å¾„ ä¾‹å¦‚ /users çš„APIåœ°å€æ˜¯ `https://api.example.com/v1/users`ã€‚\n\n#### è·¯å¾„ï¼ˆPathsï¼‰\n\npaths éƒ¨åˆ†å®šä¹‰APIçš„è·¯å¾„ï¼ˆendpointï¼‰ã€æ”¯æŒçš„HTTP è¯·æ±‚æ–¹æ³•\n\n```yml\npaths:  # å£°æ˜è·¯å¾„\n  /users:  # å®šä¹‰APIè·¯å¾„\n    get:   # å®šä¹‰è¯·æ±‚æ–¹å¼\n      summary: Returns a list of users.  # ç®€ä»‹\n      description: Optional extended description in Markdown.  # æè¿°\n      produces:\n        - application/json    # å®šä¹‰ æœåŠ¡ç«¯response MIME types \n      responses:\n        200:    # response çŠ¶æ€ç \n          description: OK\n```\n\nå½“ç„¶è¿™åªæ˜¯ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œswaggerå¯å®šä¹‰çš„å†…å®¹è¦æ¯”æˆ‘æåˆ°çš„å¤šçš„å¤šã€‚\nå…·ä½“è¯¦ç»†ä¿¡æ¯å¯ä»¥çœ‹ä¸‹ [swagger æ–‡æ¡£ï¼šhttps://swagger.io/docs/specification/what-is-swagger/](https://swagger.io/docs/specification/what-is-swagger/)ã€‚\n\nå½“ç„¶ï¼Œå†™å®Œæ–‡æ¡£å¹¶ä¸ä»£è¡¨æˆ‘ä»¬çš„ä»£ç å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä»½æ–‡æ¡£ä»¥åŠæ–‡æ¡£ä¸­çš„çº¦æŸï¼Œswagger è¿˜æä¾›äº† [swagger-codegenï¼šhttps://github.com/swagger-api/swagger-codegen](https://github.com/swagger-api/swagger-codegen)ã€‚\n\n### swagger_codegen\n\nswagger-codegen æ˜¯ä¸€ä¸ªå¼€æºçš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ¨¡æ¿é©±åŠ¨å¼•æ“ï¼Œå¯ä»¥ç›´æ¥ä»æˆ‘ä»¬å®šä¹‰çš„ swagger æ–‡æ¡£ä¸­ç”Ÿæˆå¯è§†åŒ–çš„æ–‡æ¡£æŸ¥çœ‹ç•Œé¢å’ŒAPIå®¢æˆ·ç«¯ã€‚\n\nè¿™æ˜¯ä¸€ä¸ªå¼€æºçš„é¡¹ç›®ï¼Œåœ°å€æ˜¯[swagger-codegensï¼š https://github.com/swagger-api/swagger-codegen](https://github.com/swagger-api/swagger-codegen)ã€‚å¯ä»¥è‡ªå·±å®‰è£…ä½¿ç”¨ä¸€ä¸‹ã€‚\n\nå› ä¸ºæˆ‘æœ€å¸¸ç”¨çš„è¯­è¨€æ˜¯Pythonï¼Œæ‰€ä»¥ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ python çš„ä»£ç ç”Ÿæˆå™¨[swagger-py-codegenï¼šhttps://github.com/guokr/swagger-py-codegen](https://github.com/guokr/swagger-py-codegen)\n\n## swagger_py_codegen\n\nswagger-py-codegençš„äº®ç‚¹æ˜¯å®ƒæ˜¯ä¸€ä¸ªPython web framework ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥æ ¹æ®swagger æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆç›¸åº”web framework çš„ä»£ç ï¼Œç°åœ¨æ”¯æŒ Flask, Tornadoï¼Œfalconï¼Œæœ€æ–°ç‰ˆå°†æ”¯æŒsanicã€‚\n\n### å®‰è£…\n\nå¯ä»¥ä½¿ç”¨ pip å®‰è£…ï¼š\n\n```sh\npip install swagger-py-codegen\n```\n### ä½¿ç”¨\n\nå®‰è£…åä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```sh\nswagger_py_codegen --swagger-doc api.yml example-app\n```\n\nå¯é€‰å‚æ•°æœ‰ï¼š\n\n```\n-s, --swagger, --swagger-doc    Swagger doc file.  [required]\n-f, --force                     Force overwrite.\n-p, --package                   Package name / application name.\n-t, --template-dir              Path of your custom templates directory.\n--spec, --specification         Generate online specification json response.\n--ui                            Generate swagger ui.\n-j, --jobs INTEGER              Parallel jobs for processing.\n-tlp, --templates               gen flask/tornado/falcon templates, default flask.\n--version                       Show current version.\n--help                          Show this message and exit.\n```\n\nå¦‚æœä¸æŒ‡å®š -tlp å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨ flask ä½œä¸ºæ¨¡æ¿ã€‚\nå¦‚æœæŒ‡å®š --ui --spec å‚æ•°åˆ™ä¼šåœ¨ ç”±-p å‚æ•°æŒ‡å®šçš„ç›®å½•ä¸‹ç”Ÿæˆswagger UI ç›®å½• staticã€‚\n\n#### ä¸¾ä¸ªä¾‹å­\n\næˆ‘ä»¬è¿™é‡Œä½¿ç”¨ swagger-py-codegen æä¾›çš„æµ‹è¯•æ–‡æ¡£ æ‰§è¡Œï¼š\n\n```sh\nswagger_py_codegen --swagger-doc api.yml example-app --ui --spec\n```\nç”Ÿæˆçš„ä»£ç ç›®å½•ç»“æ„å¦‚ä¸‹\n\n```\n$tree\n.\n|__ api.yml\n\n$ swagger_py_codegen -s api.yml example-app -p demo\n$ tree (flask-demo)\n.\n|__ api.yml\n|__ example-app\n   |__ demo\n   |  |__ __init__.py\n   |  |__ v1\n   |     |__ api\n   |     |  |__ __init__.py\n   |     |  |__ oauth_auth_approach_approach.py\n   |     |  |__ oauth_auth_approach.py\n   |     |  |__ users_token.py\n   |     |  |__ users_current.py\n   |     |  |__ users.py\n   |     |__ __init__.py\n   |     |__ routes.py\n   |     |__ schemas.py\n   |     |__ validators.py\n   |__ requirements.txt\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ—¶ä¸€ä¸ªç®€å•çš„appæ¡†æ¶å·²ç»ç”Ÿæˆäº†ï¼Œå…¶ä¸­ routes.py æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±ï¼Œvalidators.py æ˜¯responseå’Œrequestçš„æ ¡éªŒä»£ç ï¼Œschemas.py æ˜¯ç”±æ–‡æ¡£ç”Ÿæˆçš„æ ¡éªŒè§„åˆ™ï¼Œapi ç›®å½•ä¸‹çš„å„ä¸ªæ–‡ä»¶æ˜¯ä½ å®šä¹‰çš„endpointã€‚\n\nè¿™æ—¶è¿è¡Œdemo ç›®å½•ä¸‹çš„ `__init__.py` æ–‡ä»¶:\n\n```python\npython __init__.py \n```\nä¼šå‘ç° server å·²ç»å¯åŠ¨ï¼š\n\n![server å¯åŠ¨ç¤ºä¾‹](http://media.gusibi.mobi/pRyxskK89xODXjfsCdPVns9DJfMA2TF7tDLszenOAvhdB8gf5aBSwkCHCX9rSfQO)\n\nå¦‚æœç”Ÿæˆå‘½ä»¤å¸¦ä¸Š --ui --specï¼Œç”Ÿæˆä»£ç çš„åŒæ—¶ä¹Ÿä¼šç”Ÿæˆswagger UIï¼š\n\n```sh\nswagger_py_codegen --swagger-doc api.yml example-app --ui --spec\n```\nå¯åŠ¨serverååœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ `http://0.0.0.0:8000/static/swagger-ui/index.html#!/default/get_users_uid`\n\nå¯ä»¥çœ‹åˆ°ç›´æ¥ä½¿ç”¨çš„ swagger UIã€‚\n\n![swagger ui æˆªå›¾](http://media.gusibi.mobi/SGfBUnb6jxikwbr0IxOYROmwpqmScGJBWUHu88v5sIy806XNbk6KWDGGggDIeJH3)\n\n> swagger-py-codegen è®¤è¯é»˜è®¤ä½¿ç”¨ OAuth2 è®¤è¯æ–¹å¼ï¼Œè®¤è¯éƒ¨åˆ†ä»£ç éœ€è¦è‡ªå·±å®ç°ã€‚\n\nç°åœ¨ä»£ç ç»“æ„å·²ç»ç”Ÿæˆï¼Œå¯ä»¥å®‰å¿ƒçš„å†™é€»è¾‘ä»£ç äº†ã€‚\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»äº†RESTful APIä»¥åŠå¦‚ä½•ä½¿ç”¨swaggerç¼–å†™è§„èŒƒçš„RESTful APIã€‚\næœ€åä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ swagger-py-codegen ç”Ÿæˆ web framework çš„ç»“æ„ä»£ç ã€‚\nå‚è€ƒé“¾æ¥ä¸­çš„æ–‡ç« éƒ½éå¸¸å€¼å¾—ä¸€çœ‹ï¼Œå»ºè®®éƒ½çœ‹ä¸€ä¸‹ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [RESTï¼š https://zh.wikipedia.org/wiki/REST](https://zh.wikipedia.org/wiki/REST)\n* [RESTful API è®¾è®¡æŒ‡å—ï¼š http://www.ruanyifeng.com/blog/2014/05/restful_api.html](http://www.ruanyifeng.com/blog/2014/05/restful_api.html)\n* [Principles of good RESTful API Designï¼š https://codeplanet.io/principles-good-restful-api-design/](https://codeplanet.io/principles-good-restful-api-design/)\n* [è·Ÿç€ Github å­¦ä¹  Restful HTTP API è®¾è®¡ï¼š http://cizixs.com/2016/12/12/restful-api-design-guide](http://cizixs.com/2016/12/12/restful-api-design-guide)\n* [æœ€ä½³å®è·µï¼šæ›´å¥½çš„è®¾è®¡ä½ çš„ REST APIï¼š https://www.ibm.com/developerworks/cn/web/1103_chenyan_restapi/](https://www.ibm.com/developerworks/cn/web/1103_chenyan_restapi/)\n* [swaggerï¼š https://swagger.io/](https://swagger.io/)\n* [å¦‚ä½•ç¼–å†™åŸºäºOpenAPIè§„èŒƒçš„APIæ–‡æ¡£ï¼šhttps://www.gitbook.com/book/huangwenchao/swagger/details](https://www.gitbook.com/book/huangwenchao/swagger/details)\n* [ä½¿ç”¨ Swagger æ–‡æ¡£åŒ–å’Œå®šä¹‰ RESTful APIï¼šhttps://www.ibm.com/developerworks/cn/web/wa-use-swagger-to-document-and-define-restful-apis/index.html](https://www.ibm.com/developerworks/cn/web/wa-use-swagger-to-document-and-define-restful-apis/index.html)\n* [swagger æ–‡æ¡£ï¼šhttps://swagger.io/docs/specification/what-is-swagger/](https://swagger.io/docs/specification/what-is-swagger/)\n* [swagger-py-codegenï¼šhttps://github.com/guokr/swagger-py-codegen](https://github.com/guokr/swagger-py-codegen)\n\n------\n\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\næ¬¢è¿å…³æ³¨(April_Louisa) | è¯·æˆ‘å–èŠ¬è¾¾\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n\nè¿™é‡Œæ˜¯åˆ†å‰²çº¿\n\n--------------\n\nå…¬å·ç°åœ¨å·²ç»å¼€é€šäº†ç•™è¨€åŠŸèƒ½ï¼Œå¦‚æœä½ è§‰å¾—æ–‡ç« æœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºã€‚\n",
      "data": {
        "title": "ä½¿ç”¨swagger ç”Ÿæˆ Flask RESTful API",
        "date": "2017-07-11 13:29:15",
        "tags": [
          "python",
          "swagger",
          "restful"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "restful_api_by_swagger_py_codegen"
    },
    {
      "content": "\nä¸Šä¸€ç¯‡ [ä¸€å°æ—¶æ­å»ºå¾®ä¿¡èŠå¤©æœºå™¨äºº](http://blog.gusibi.site/post/wechat-chatbot-step-by-step/) ä»‹ç»äº†å¦‚ä½•æ­å»ºä¸€ä¸ªå¯ç”¨çš„èŠå¤©æœºå™¨äººï¼Œä½†æ˜¯å’Œæœºå™¨äººèŠå®Œä½ ä¼šå‘ç°ï¼ŒèŠå¤©æœºå™¨äººå®åœ¨æ˜¯å¤ªå‚»äº†ï¼Œæ¥å›å°±é‚£ä¹ˆå‡ å¥ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç»™èŠå¤©æœºå™¨äººçš„æ•°æ®å¤ªå°‘ï¼Œä»–åªèƒ½åœ¨æˆ‘ä»¬ç»™çš„è®­ç»ƒé›†ä¸­æ‰¾å®ƒè®¤ä¸ºæœ€åˆé€‚çš„ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•å¯¼å…¥æ›´å¤šçš„è®­ç»ƒæ•°æ®å‘¢ï¼Ÿ\næˆ‘èƒ½æƒ³åˆ°æœ€ç®€å•çš„æ–¹æ³•æ˜¯æ‰¾å¯¹è¯çš„æ•°æ®ï¼Œç„¶åæŠŠè¿™äº›æ•°æ®ä½œä¸ºè®­ç»ƒæ•°æ®è®­ç»ƒæœºå™¨äººã€‚\n\næ„Ÿè°¢ candlewill å·²ç»æ”¶é›†å¥½äº†å¤§é‡çš„è®­ç»ƒæ•°æ®ï¼Œ[dialog_corpus https://github.com/candlewill/Dialog_Corpus](https://github.com/candlewill/Dialog_Corpus) ã€‚\n\nHUGOMORE42\n\nè¿™ä¸ªåº“ä¸­åŒ…å«ç”µå½±å°è¯ã€ä¸­è‹±æ–‡çŸ­ä¿¡æ¯ã€è‡ªç„¶è¯­è¨€å¤„ç†ç›¸å…³çš„æ•°æ®é›†ã€å°é»„é¸¡è¯­æ–™ç­‰ã€‚è¿™é‡Œæˆ‘é€‰æ‹©ç”µå½±å°è¯è¯­æ–™ã€‚\n\n> è¯­æ–™åœ°å€ä¸ºï¼š[dgk_lost_convï¼šhttps://github.com/rustch3n/dgk_lost_conv](https://github.com/rustch3n/dgk_lost_conv)\n\n## chatterbot è®­ç»ƒé€»è¾‘å¤„ç†æ¨¡å—\n\nè¿™ä¸ªæ¨¡å—æä¾›è®­ç»ƒæœºå™¨äººçš„æ–¹æ³•ï¼Œchatterbotè‡ªå¸¦äº†é€šè¿‡è¾“å…¥listæ¥è®­ç»ƒï¼ˆ[\"ä½ å¥½\", \"ä½ å¥½å•Š\"] åè€…æ˜¯å‰è€…çš„å›ç­”ï¼‰ä»¥åŠé€šè¿‡å¯¼å…¥Corpusæ ¼å¼æ–‡ä»¶æ¥è®­ç»ƒçš„æ–¹å¼ã€‚\n\nè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ç¬¬ä¸€ç§ï¼Œé€šè¿‡è¾“å…¥listæ¥è®­ç»ƒæœºå™¨äººã€‚\n\n### å¤„ç†è®­ç»ƒæ•°æ®\n\né¦–å…ˆä¸‹è½½æ•°æ®é›†ï¼š\n\n```sh\nwget https://codeload.github.com/rustch3n/dgk_lost_conv/zip/master\n# è§£å‹\n$ unzip dgk_lost_conv-master.zip\n```\n\næˆ‘ä»¬å…ˆæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶çœ‹ä¸‹æ•°æ®ç»“æ„ï¼š\n\n```sh\nE\nM ä½ å¾—æƒ³æƒ³åŠæ³• æˆ‘å¼Ÿå¼Ÿæ˜¯æ— è¾œçš„\nM ä»–å¯æ˜¯ç¾å›½å…¬æ°‘å•Š\nM å¯¹æ­¤æˆ‘ä¹Ÿæ— èƒ½ä¸ºåŠ›\nM ä½ å½“ç„¶èƒ½\nM å†å»çŠ¯ç½ªç°åœºçœ‹çœ‹ å®šèƒ½è¯å®æ¸…ç™½\nM ä½ çœ‹ æˆ‘ä¸è¿‡æ˜¯ä¸ªå¤œé—´åŠäº‹å‘˜è€Œå·²\nM ä½ è‹¥çœŸæƒ³è§£å†³é—®é¢˜\nM æœ€å¥½ç­‰é¢†äº‹æ¥\nM ä»–æ—©ä¸Šæ‰ä¸Šç­\nM æˆ‘å¾ˆæŠ±æ­‰\nE\nM é‚£æˆ‘è‡ªå·±æ¥æå®š\nM ä½ å…„å¼Ÿ\nM å…³åœ¨å“ªä¸ªç›‘ç‹±?\nM ç´¢çº³ç›‘ç‹±\nE\nM æ€ä¹ˆäº†?\nM é‚£é‡Œå…³çš„éƒ½æ˜¯æœ€ç©·å‡¶ææ¶çš„ç½ªçŠ¯\nM åˆ«çš„ç›‘ç‹±éƒ½ä¸æ”¶\n```\n\n.conv è¯­æ–™æ–‡ä»¶ä¸­ï¼šE æ˜¯åˆ†éš”ç¬¦ M è¡¨ç¤ºä¼šè¯ã€‚å› ä¸ºæˆ‘æ˜¯ä½¿ç”¨è¾“å…¥list çš„æ–¹å¼è®­ç»ƒæ•°æ®ï¼Œè¿™æ—¶æˆ‘å¯ä»¥ä»¥åˆ†éš”ç¬¦Eä¸ºåˆ†éš”ï¼Œå°†ä¸€æ®µå¯¹è¯æ”¾å…¥ä¸€ä¸ªlistä¸­ï¼Œé‚£ä¹ˆä¸Šè¿°ä¾‹å­ä¸­çš„è®­ç»ƒæ•°æ®åº”è¯¥è¢«æ ¼å¼åŒ–ä¸ºï¼š\n\n```python\nconvs = [\n    [\n       'ä½ å¾—æƒ³æƒ³åŠæ³• æˆ‘å¼Ÿå¼Ÿæ˜¯æ— è¾œçš„',\n       'ä»–å¯æ˜¯ç¾å›½å…¬æ°‘å•Š',\n       'å¯¹æ­¤æˆ‘ä¹Ÿæ— èƒ½ä¸ºåŠ›',\n       'ä½ å½“ç„¶èƒ½',\n       'å†å»çŠ¯ç½ªç°åœºçœ‹çœ‹ å®šèƒ½è¯å®æ¸…ç™½',\n       'ä½ çœ‹ æˆ‘ä¸è¿‡æ˜¯ä¸ªå¤œé—´åŠäº‹å‘˜è€Œå·²',\n       'ä½ è‹¥çœŸæƒ³è§£å†³é—®é¢˜',\n       'æœ€å¥½ç­‰é¢†äº‹æ¥',\n       'ä»–æ—©ä¸Šæ‰ä¸Šç­',\n       'æˆ‘å¾ˆæŠ±æ­‰'\n    ],\n    [\n       'é‚£æˆ‘è‡ªå·±æ¥æå®š',\n       'ä½ å…„å¼Ÿ',\n       'å…³åœ¨å“ªä¸ªç›‘ç‹±?',\n       'ç´¢çº³ç›‘ç‹±',\n    ],\n    [\n       'æ€ä¹ˆäº†?',\n       'é‚£é‡Œå…³çš„éƒ½æ˜¯æœ€ç©·å‡¶ææ¶çš„ç½ªçŠ¯',\n       'åˆ«çš„ç›‘ç‹±éƒ½ä¸æ”¶',\n    ]\n]\n```\n\nå¯¼å…¥è®­ç»ƒæ•°æ®çš„è„šæœ¬å¦‚ä¸‹ï¼š\n```python\nfrom chatterbot import ChatBot\nfrom chatterbot.trainers import ListTrainer\n\n# åˆå§‹åŒ–èŠå¤©æœºå™¨äºº\nmomo = ChatBot(\n    'Momo',\n    storage_adapter='chatterbot.storage.MongoDatabaseAdapter', # ä½¿ç”¨mongoå­˜å‚¨æ•°æ®\n    logic_adapters=[ # æŒ‡å®šé€»è¾‘å¤„ç†æ¨¡å—\n            \"chatterbot.logic.BestMatch\",\n            \"chatterbot.logic.MathematicalEvaluation\",\n            \"chatterbot.logic.TimeLogicAdapter\",\n        ],\n    input_adapter='chatterbot.input.VariableInputTypeAdapter',\n    output_adapter='chatterbot.output.OutputAdapter',\n    database='chatterbot', # æŒ‡å®šæ•°æ®åº“\n    read_only=True\n)\n\n# è¯»å–.conv æ•°æ®æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘æœåŠ¡å™¨é…ç½®è¾ƒä½ï¼Œæ‰€ä»¥é€‰æ‹©äº†ä¸€ä¸ªå†…å®¹è¾ƒå°‘çš„æ–‡ä»¶\n# è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨\ndef read_conv(filename='prisonb.conv'):\n    with open(filename, 'rt') as f:\n        conv = []\n        # é€è¡Œè¯»å–\n        for line in f:\n            _line = line.replace('\\n', '').strip()  # é¢„å¤„ç†å­—ç¬¦ä¸² å»æ‰é¦–ä½ç©ºæ ¼\n            if _line == 'E':  # å¦‚æœæ˜¯åˆ†éš”ç¬¦ è¡¨ç¤ºå¯¹è¯ç»“æŸ è¿”å›å¯¹è¯åˆ—è¡¨\n                yield conv\n                conv = []  # é‡ç½®å¯¹è¯åˆ—è¡¨\n            else:  # ä¸æ˜¯åˆ†éš”ç¬¦åˆ™å°†å†…å®¹åŠ å…¥å¯¹è¯åˆ—è¡¨\n                c = _line.split()[-1]  # å…¶å®è¿™é‡Œå¦‚æœå¯¹è¯ä¸­åŒ…å«ç©ºæ ¼ å¯¹è¯æ•°æ®ä¼šä¸å®Œæ•´ï¼Œåº”è¯¥åªå»æ‰Må’Œå¼€å¤´çš„ç©ºæ ¼\n                conv.append(c)\n\n\ndef traine_momo():\n    for conv in read_conv():\n        print(conv)\n        momo.set_trainer(ListTrainer) # æŒ‡å®šè®­ç»ƒæ–¹å¼\n        momo.train(conv) # è®­ç»ƒæ•°æ®\n\n\ndef main():\n    traine_momo()\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\nè¿™ä¸ªè„šæœ¬æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ç®€å•çš„å°†æ•°æ®ä»å¯¹è¯æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œç„¶åæ‹¼æ¥ä¸ºå¯¹è¯åˆ—è¡¨è¾“å…¥èŠå¤©æœºå™¨äººã€‚\n\n> ç”±äºè¿™é‡Œå¯¹è¯å¤§éƒ¨åˆ†éƒ½æ˜¯å¤šè¡Œæ•°æ®ï¼ŒèŠå¤©æœºå™¨äººåŒ¹é…ç»“æœæ—¶è¿ç®—é‡ä¼šå¤§å¹…æå‡ï¼Œæˆ‘å•æ ¸cpuçš„æœåŠ¡å™¨åœ¨å¯¼å…¥ä¸€ä¸ª700k çš„è¯­æ–™æ–‡ä»¶åæ¯æ¬¡èŠå¤©éƒ½ä¼šè®©cpué£šåˆ°100%ï¼ğŸ¤¦â€ æ— å¥ˆä¹‹ä¸‹åªèƒ½åˆ æ‰å¤§åŠæ•°æ®ã€‚\n\nå¯¹è¯ç¤ºä¾‹å¦‚å›¾:\n\n![ä½¿ç”¨ç”µå½±å°è¯è®­ç»ƒåçš„èŠå¤©æˆªå›¾](http://media.gusibi.mobi/kF27RcGVBL3xDf4kKhJQCbXAB3qgc_HXpYy28ykdfudK0B52Z5nvm63m0wbiKlCA)\n\nå¯¼å…¥ç”µå½±å°è¯åï¼Œè™½ç„¶è®­ç»ƒæ•°æ®å¤§å¹…æå‡ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°èŠå¤©æœºå™¨äººå¼€å§‹ç­”éæ‰€é—®äº†ï¼Œè¿™æ˜¯å› ä¸ºèŠå¤©æ•°æ®å™ªéŸ³å¤ªå¤§ï¼Œå¯¹ç™½ä¹Ÿæœ‰ç‚¹é—®é¢˜ã€‚\n\n### ä½¿ç”¨å›¾çµæœºå™¨äººè®­ç»ƒ\n\nä¹‹å‰åœ¨å¯¹æ¯”èŠå¤©æœºå™¨äººå®ç°æ–¹æ¡ˆçš„æ—¶å€™ï¼Œæˆ‘è¯•ç”¨è¿‡ [å›¾çµæœºå™¨äºº](http://www.tuling123.com)ï¼Œä»–ä»¬å·ç§°ä¸­æ–‡è¯­å¢ƒä¸‹æ™ºèƒ½æ¸¡æœ€é«˜çš„æœºå™¨äººå¤§è„‘ã€‚ä»–ä»¬çš„å¯¹è¯æ¯”æˆ‘è‡ªå·±çš„æ­å»ºçš„é è°±å¾ˆå¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ä¸€ä¸‹ä»–çš„æ•°æ®å‘¢ï¼Ÿ\n\næˆ‘çš„æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼Œåœ¨å›¾çµæœºå™¨äººæ–°å»ºä¸¤ä¸ªæœºå™¨äººæ•™ç»ƒA å’Œ æ•™ç»ƒBï¼Œè®©ä¸¤ä¸ªæœºå™¨äººäº’ç›¸å¯¹è¯ï¼Œç„¶åæŠŠè®­ç»ƒæ•°æ®å¯¼å…¥chatterbotã€‚\n\n1. æ‰“å¼€ [http://www.tuling123.com](http://www.tuling123.com)ï¼Œæ³¨å†Œè´¦å·\n2. æ–°å»ºä¸¤ä¸ªæœºå™¨äººï¼ˆå…è´¹ç”¨æˆ·æœ€å¤šå¯ä»¥åˆ›å»º5ä¸ªï¼Œæ¯ä¸ªæœºå™¨äººæ¯å¤©æœ€å¤šè¯·æ±‚5000æ¬¡ï¼‰\n3. è°ƒç”¨å¯¹è¯APIï¼Œè®©ä¸¤ä¸ªæœºå™¨äººäº’ç›¸èŠå¤©\n\nå»ºå¥½æœºå™¨äººåçš„ç•Œé¢ï¼š\n\n![æœºå™¨äººç¤ºä¾‹ğŸ¤–](http://media.gusibi.mobi/3WZasRFKofxaVIV55WJy2TNRYeUlf7qcD5ijEpYZqwJctWzuAqu3HRBi8VRZSFYz)\n\nè®­ç»ƒç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```python\n# tuling_trainer.py\nimport sys\nfrom time import sleep\n\nfrom chatterbot import ChatBot\nfrom chatterbot.trainers import ListTrainer\n\nimport requests\n\nAPI_URL = \"http://www.tuling123.com/openapi/api\"\nAPI_KEY0 = \"\"  # æœºå™¨äºº1 çš„key\nAPI_KEY1 = \"\"  # æœºå™¨äºº2 çš„key\n\n# åˆå§‹åŒ–chatterbot\nmomo = ChatBot(\n    'Momo',\n    storage_adapter='chatterbot.storage.MongoDatabaseAdapter',\n    logic_adapters=[\n            \"chatterbot.logic.BestMatch\",\n            \"chatterbot.logic.MathematicalEvaluation\",\n            \"chatterbot.logic.TimeLogicAdapter\",\n        ],\n    input_adapter='chatterbot.input.VariableInputTypeAdapter',\n    output_adapter='chatterbot.output.OutputAdapter',\n    database='chatterbot',\n    read_only=True\n)\n\n# è¯·æ±‚å›¾çµæœºå™¨äººæ¥å£\ndef ask(question, key, name):\n    params = {\n        \"key\": key,\n        \"userid\": name,\n        \"info\": question,\n    }\n    res = requests.post(API_URL, json=params)\n    result = res.json()\n    answer = result.get('text')\n    return answer\n\n\ndef A(bsay):\n    # æ‰“å° A å’Œ B çš„å¯¹è¯å†…å®¹\n    print('B:', bsay)\n    answer = ask(bsay, API_KEY0, 'momo123')\n    print('A:', answer)\n    return answer\n\n\ndef B(asay):\n    print('A:', asay)\n    answer = ask(asay, API_KEY1, 'momo456')\n    print('B', answer)\n    return answer\n\n\ndef tariner(asay):\n    momo.set_trainer(ListTrainer)  # è®¾ç½®å¤„ç†æ–¹å¼\n    while True:  # ä¸¤ä¸ªæœºå™¨äººè®­ç»ƒçš„ä¸»å¾ªç¯\n        conv = []\n        conv.append(asay) # å…ˆæŠŠ A è¯´çš„ç¬¬ä¸€å¥åŠ å…¥åˆ°å¯¹è¯åˆ—è¡¨\n        bsay = B(asay)  # A å…ˆé—® B\n        conv.append(bsay) # å°†B çš„å›ç­”åŠ å…¥åˆ°å¯¹è¯åˆ—è¡¨\n        momo.train(conv) # å°†å¯¹è¯ç”¨äºè®­ç»ƒ\n        print(conv)\n        conv = []\n        conv.append(bsay) # ç”¨Bçš„å¯¹è¯ å»é—® A æ­¥éª¤å’Œä¸Šè¿°æ–¹å¼ä¸€è‡´\n        asay = A(bsay)\n        conv.append(asay)\n        momo.train(conv)\n        print(conv)\n        sleep(5)  # æ§åˆ¶é¢‘ç‡\n\n\ndef main(asay):\n    tariner(asay)\n\n\nif __name__ == '__main__':\n    main(*sys.argv[1:])  # æ¥æ”¶å‚æ•°ä½œä¸ºå¼€å§‹çš„ç¬¬ä¸€å¥è¯\n    \n# æ‰§è¡Œè„šæœ¬\n# python tuling_trainer.py ä½ å¥½ï¼Ÿ\n\n```\n\nä½¿ç”¨å›¾çµèŠå¤©æœºå™¨äººè®­ç»ƒçš„æ—¶å€™æ˜¯éœ€è¦ç›‘æµ‹çš„ï¼Œå› ä¸ºå¦‚æœä¸¤ä¸ªæœºå™¨äººè¯´çš„å†…å®¹ä¸€æ ·çš„æ—¶å€™ï¼Œæœºå™¨äººå¯èƒ½ä¼šä¸€ç›´é‡å¤åŒä¸€å¥è¯ï¼Œç›´åˆ°è°ƒç”¨æ¬¡æ•°è€—å°½ï¼Œä½ éœ€è¦çœ‹ä¸€ä¸‹ä¸¤ä¸ªæœºå™¨äººçš„å¯¹è¯æ˜¯å¦é™·å…¥äº†åƒµå±€ã€‚\n\nå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­åŠ å…¥åˆ¤æ–­ï¼Œå…ˆå¤šè®¾å®šå‡ ä¸ªå¼€å§‹æ‰“æ‹›å‘¼çš„å¥å­ï¼Œå¦‚æœä¸€å¥è¯è¿ç»­å‡ºç°å¤šæ¬¡çš„æ—¶å€™ï¼Œæ¢ä¸‹ä¸€ä¸ªå¥å­çº æ­£ä»–ä»¬ã€‚\n\nä»¥ä¸‹æ˜¯æˆ‘è®­ç»ƒäº†ä¸¤å¤©ä¹‹åçš„ç»“æœï¼š\n\n![å¯¹è¯ç¤ºä¾‹](http://media.gusibi.mobi/wNM0i84JsmsgldhxUjV1TMHr_YwwM726brHr0tmSYS_cxAYWWIHQEvG-eTmBIRjJ)\n\nè™½ç„¶è¿˜æ˜¯ç­”éæ‰€é—®ï¼Œä½†æ˜¯å·²ç»æ¯”ä¹‹å‰åƒæ ·äº†ã€‚\n\n> å›¾çµèŠå¤©æœºå™¨äººå…è´¹ç‰ˆæ¯å¤©å¯è°ƒç”¨5000 æ¬¡ï¼Œå¦‚æœè§‰å¾—æ¬¡æ•°å¤ªå°‘å¯ä»¥å¤šæ–°å»ºå‡ ä¸ªè½®æµä½¿ç”¨\n\nèŠå¤©æœºå™¨äººçš„é…ç½®åŠè®­ç»ƒæ–¹å¼å°±åˆ°è¿™é‡Œäº†ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸ªæ›´å®ç”¨çš„åŠŸèƒ½ï¼Œå¦‚ä½•è®©å¾®ä¿¡å…¬å·å˜æˆå›¾åºŠã€‚\n\n## å¦‚ä½•è®©å¾®ä¿¡å…¬å·åŒ–èº«å›¾ç‰‡ä¸Šä¼ åŠ©æ‰‹\n\nåœ¨ä½¿ç”¨ `markdown` æ ¼å¼æ¥å†™æ–‡ç« çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å›¾ç‰‡åœ°å€æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼Œæ¯æ¬¡è´´å›¾è·å–å›¾ç‰‡URLéƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„è¿‡ç¨‹ã€‚\nä»¥æˆ‘ä½¿ç”¨çš„ä¸ƒç‰›ä¸ºä¾‹ï¼Œè·å–å›¾ç‰‡åœ°å€çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. ç™»å½•ä¸ƒç‰›ç½‘ç«™ï¼Œæ‰“å¼€å­˜å‚¨ç©ºé—´>å†…å®¹ç®¡ç†\n2. ä¸Šä¼ æ–‡ä»¶\n3. è¿”å›å†…å®¹ç®¡ç†æ‰¾åˆ°åˆšæ‰ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè·å–å¤–é“¾\n\næŒ‰ç…§è¿™ä¸ªæ­¥éª¤ä¸Šä¼ ä¸€å¼ å›¾ç‰‡è‡³å°‘è€—æ—¶åŠåˆ†é’Ÿã€‚\n\né‚£èƒ½ä¸èƒ½ç®€åŒ–è¿™ä¸ªæ­¥éª¤å‘¢ï¼Ÿ\n\nç­”æ¡ˆæ˜¯`å¯ä»¥ï¼`\n\nå¾®ä¿¡å…¬å·æ˜¯å¯ä»¥å‘é€å›¾ç‰‡æ¶ˆæ¯çš„ï¼Œæˆ‘çš„åšæ³•æ˜¯\n\n1. å°†å›¾ç‰‡å‘é€åˆ°å…¬å·\n2. æœåŠ¡å™¨è·å–è§¦å‘å›¾ç‰‡æ¶ˆæ¯çš„å¤„ç†é€»è¾‘> å°†å›¾ç‰‡ä½¿ç”¨ä¸ƒç‰›æä¾›çš„`ç¬¬ä¸‰æ–¹èµ„æºæŠ“å–`API`å¦å­˜åˆ°`ï¼Œä¸ƒç‰›å­˜å‚¨ç©ºé—´\n3. å°†è®¾å®šå¥½çš„å›¾ç‰‡åœ°å€è¿”å›ç»™å¾®ä¿¡ï¼Œå‘é€åˆ°å…¬å·æ¶ˆæ¯å¯¹è¯ä¸­\n\nç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![ä¸Šä¼ å›¾ç‰‡åˆ°ä¸ƒç‰›](http://media.gusibi.mobi/Eg5Idjmp3nLyufBVU2hzp6jNMdNoSWEYgKTqNG9BbqD6VrM4U5oN-gmJw3PaN-Yh)\n\n### å®ç°æ­¥éª¤\n\n* æ³¨å†Œä¸ªä¸ƒç‰›è´¦å·\n* æ–°å»ºå­˜å‚¨ç©ºé—´\n* åœ¨ä¸ªäººä¸­å¿ƒç§˜é’¥ç®¡ç†è·å– AccessKey å’Œ SecreKey \n* pip install qiniu\n\nä»£ç å®ç°å¦‚ä¸‹ï¼š\n\n```python\n# media.py\n# å›¾ç‰‡æŠ“å–é€»è¾‘å¤„ç†\nfrom qiniu import Auth, BucketManager\n\nfrom momo.settings import Config\n\ndef qiniu_auth():\n    access_key = str(Config.QINIU_ACCESS_TOKEN)\n    secret_key = str(Config.QINIU_SECRET_TOKEN)\n    auth = Auth(access_key, secret_key)\n    return auth\n    \ndef media_fetch(media_url, media_id):\n    '''æŠ“å–urlçš„èµ„æºå­˜å‚¨åœ¨åº“'''\n    auth = qiniu_auth()\n    bucket = BucketManager(auth)\n    bucket_name = Config.QINIU_BUCKET  # å­˜å‚¨ç©ºé—´åç§°\n    ret, info = bucket.fetch(media_url, bucket_name, media_id) # å‚æ•°ä¾æ¬¡æ˜¯ç¬¬ä¸‰æ–¹å›¾ç‰‡åœ°å€ï¼Œç©ºé—´åç§°ï¼Œç›®æ ‡æ–‡ä»¶å\n    if info.status_code == 200:\n        return True, media_id # å¦‚æœä¸Šä¼ æˆåŠŸï¼Œè¿”å›æ–‡ä»¶å\n    return False, None\n```\n\næŠ“å–ç¬¬ä¸‰æ–¹å›¾ç‰‡æ–‡æ¡£åœ°å€ä¸ºï¼š[ç¬¬ä¸‰æ–¹èµ„æºæŠ“å– https://developer.qiniu.com/kodo/api/1263/fetch](https://developer.qiniu.com/kodo/api/1263/fetch)ã€‚\n\nå¾®ä¿¡å›¾ç‰‡æ¶ˆæ¯å¤„ç†é€»è¾‘ä»£ç ï¼š\n\n```python\nclass WXResponse(_WXResponse):\n\n    def _image_msg_handler(self):\n        media_id = self.data['MediaId']\n        picurl = None\n        if not picurl:\n            picurl = self.data['PicUrl']  # ä»æ¶ˆæ¯ä¸­è·å–å›¾ç‰‡åœ°å€\n        is_succeed, media_key = media_fetch(picurl, media_id) # ä½¿ç”¨å›¾ç‰‡æŠ“å–æ¥å£å°†å›¾ç‰‡å­˜å‚¨åˆ°ä¸ƒç‰›å¹¶è·å–å›¾ç‰‡æ–‡ä»¶å\n        if is_succeed:\n            qiniu_url = '{host}/{key}'.format(host=Config.QINIU_HOST, key=media_key) # æ‹¼æ¥å›¾ç‰‡åœ°å€\n        else:\n            qiniu_url = 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡æ–°ä¸Šä¼ '\n        self.reply_params['content'] = qiniu_url # è¿”å›å›¾ç‰‡åœ°å€\n        self.reply = TextReply(**self.reply_params).render()\n```\n\nä»£ç å·²å¼€æºé“githubï¼Œè¯¦ç»†ä»£ç é€»è¾‘å‚è€ƒ [gusibi/momo: https://github.com/gusibi/momo/tree/chatterbot](https://github.com/gusibi/momo/blob/chatterbot/momo/views/mweixin.py)\n\næ¬¢è¿è¯•ç”¨ä½“éªŒï¼š\n\n* è¯·ä¸è¦ä¸Šä¼ é«˜æ¸…å›¾ç‰‡ï¼Œå¾®ä¿¡ä¼šå‹ç¼©æŸåå›¾ç‰‡è´¨é‡\n* ä¹Ÿä¸è¦ä¸Šä¼ å¤ªä¸ªäººçš„å›¾ç‰‡ï¼Œæ¯•ç«Ÿå†…å®¹æˆ‘èƒ½çœ‹åˆ°\n\n## æ€»ç»“\n\nè¿™ä¸€ç¯‡ä¸»è¦æä¾›äº†ä¸¤ä¸ªè®­ç»ƒ chatterbot çš„æ€è·¯ï¼Œä»¥åŠä½¿ç”¨å…¬å·ä½œä¸ºå›¾ç‰‡ä¸Šä¼ å®¢æˆ·ç«¯æé«˜ä¸Šä¼ å›¾ç‰‡çš„æ•ˆç‡çš„è§£å†³æ–¹æ³•ã€‚\næ¥ä¸‹æ¥å…¬å·è¿˜æ˜¯ç»§ç»­å¼€å‘ï¼Œå‡†å¤‡ç»™å…¬å·åŠ ä¸€ä¸ªè®°è´¦åŠŸèƒ½ï¼Œä¿ƒä½¿è‡ªå·±å…»æˆè®°è´¦çš„ä¹ æƒ¯ã€‚\n\n### é¢„å‘Š\n\nä¸‹ä¸€ç¯‡çš„å…¬å·DIY å°†ä»‹ç» `è®°è´¦çš„åŠŸèƒ½è®¾è®¡ä»¥åŠå®ç°æ€è·¯`ã€‚\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å¾®ä¿¡å…¬å·DIYï¼šè®­ç»ƒèŠå¤©æœºå™¨äºº&å…¬å·å˜èº«å›¾ç‰‡ä¸Šä¼ å·¥å…·",
        "date": "2017-07-08 15:34:53",
        "tags": [
          "python",
          "tutorial",
          "weixin",
          "å…¬ä¼—å·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "weixin_mp_diy_image_upload"
    },
    {
      "content": "\n> æœ€è¿‘å€Ÿç”¨äº†å¥³æœ‹å‹çš„å…¬å·ï¼Œæ„Ÿè§‰å¦‚æœåªæ˜¯ç”¨æ¥å‘æ–‡ç« ï¼Œå¤ªæµªè´¹å¾®ä¿¡ç»™æä¾›çš„è¿™äº›åŠŸèƒ½äº†ã€‚æƒ³äº†æƒ³ï¼Œå…ˆä»æœ€ç®€å•çš„å¼€å§‹ï¼Œåšä¸€ä¸ªèŠå¤©æœºå™¨äººå§ã€‚\n\nä½¿ç”¨Pythonå®ç°èŠå¤©æœºå™¨äººçš„æ–¹æ¡ˆæœ‰å¤šç§ï¼šAIMLã€chatterBotä»¥åŠå›¾çµèŠå¤©æœºå™¨äººå’Œå¾®è½¯å°å†°ç­‰ã€‚\n\nè€ƒè™‘åˆ°ä»¥åå¯èƒ½ä¼šåšä¸€äº›å®šåˆ¶åŒ–çš„éœ€æ±‚ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†`chatterBot`ï¼ˆ[github é¡¹ç›®åœ°å€ï¼šhttps://github.com/gunthercox/ChatterBot](https://github.com/gunthercox/ChatterBot))ã€‚\n\nchatterbotæ˜¯ä¸€æ¬¾pythonæ¥å£çš„ï¼ŒåŸºäºä¸€ç³»åˆ—è§„åˆ™å’Œæœºå™¨å­¦ä¹ ç®—æ³•å®Œæˆçš„èŠå¤©æœºå™¨äººã€‚å…·æœ‰ç»“æ„æ¸…æ™°ï¼Œå¯æ‰©å±•æ€§å¥½ï¼Œç®€å•å®ç”¨çš„ç‰¹ç‚¹ã€‚\n\n\n\nchatterBot çš„å·¥ä½œæµç¨‹å¦‚å›¾ï¼š\n\n![chatterBot å·¥ä½œæµç¨‹](http://media.gusibi.mobi/l-OywTEmN9B6u_RevUWyUpAD9yeHyChmh55q7fIObhC82Wf9X-DTxCF6oGI4tqG7)\n\n1. è¾“å…¥æ¨¡å—ï¼ˆinput adapterï¼‰ä»ç»ˆç«¯æˆ–è€…APIç­‰è¾“å…¥æºè·å–æ•°æ®\n2. è¾“å…¥æºä¼šè¢«æŒ‡å®šçš„é€»è¾‘å¤„ç†æ¨¡å—ï¼ˆlogic Adapterï¼‰åˆ†åˆ«å¤„ç†ï¼Œé€»è¾‘å¤„ç†æ¨¡å—ä¼šåŒ¹é…è®­ç»ƒé›†ä¸­å·²çŸ¥çš„æœ€æ¥è¿‘è¾“å…¥æ•°æ®å¥å­Aï¼Œç„¶åæ ¹æ®å¥å­Aå»æ‰¾åˆ°ç›¸å…³åº¦æœ€é«˜çš„ç»“æœBï¼Œå¦‚æœæœ‰å¤šä¸ªé€»è¾‘å¤„ç†æ¨¡å—è¿”å›äº†ä¸åŒçš„ç»“æœï¼Œä¼šè¿”å›ä¸€ä¸ªç›¸å…³åº¦æœ€é«˜çš„ç»“æœã€‚\n3. è¾“å‡ºæ¨¡å—ï¼ˆoutput adapterï¼‰å°†åŒ¹é…åˆ°çš„ç»“æœè¿”å›ç»™ç»ˆç«¯æˆ–è€…APIã€‚\n\n\nå€¼å¾—ä¸€è¯´çš„æ˜¯chatterBot æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–çš„é¡¹ç›®ï¼Œåˆ†ä¸º input Adapterã€logic Adapterã€storage Adapterã€output Adapterä»¥åŠTrainer æ¨¡å—ã€‚\n\nlogic Adapteræ˜¯ä¸€ä¸ªæ’ä»¶å¼è®¾è®¡ï¼Œä¸»è¿›ç¨‹åœ¨å¯åŠ¨æ—¶ä¼šå°†ç”¨æˆ·å®šä¹‰çš„æ‰€æœ‰é€»è¾‘å¤„ç†æ’ä»¶æ·»åŠ åˆ°logic contextä¸­ï¼Œç„¶åäº¤MultiLogicAdapter è¿›è¡Œå¤„ç†ï¼ŒMultiLogicAdapter ä¾æ¬¡è°ƒç”¨æ¯ä¸ª logic Adapterï¼Œlogic Adapter è¢«è°ƒç”¨æ—¶å…ˆæ‰§è¡Œcan_process æ–¹å¼åˆ¤æ–­è¾“å…¥æ˜¯å¦å¯ä»¥å‘½ä¸­è¿™ä¸ªé€»è¾‘å¤„ç†æ’ä»¶ã€‚æ¯”å¦‚â€ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·â€œè¿™æ ·çš„é—®é¢˜æ˜¾ç„¶éœ€è¦å‘½ä¸­å¤©æ°”é€»è¾‘å¤„ç†æ’ä»¶ï¼Œè¿™æ—¶æ—¶é—´é€»è¾‘å¤„ç†æ’ä»¶çš„can_process åˆ™ä¼šè¿”å›Falseã€‚åœ¨å‘½ä¸­ålogic Adapter è´Ÿè´£è®¡ç®—å‡ºå¯¹åº”çš„å›ç­”ï¼ˆStatementå¯¹è±¡ï¼‰ä»¥åŠå¯ä¿¡åº¦ï¼ˆconfidenceï¼‰ï¼ŒMultiLogicAdapterä¼šå–å¯ä¿¡åº¦æœ€é«˜çš„å›ç­”ï¼Œå¹¶è¿›å…¥ä¸‹ä¸€æ­¥ã€‚\n\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹ chatterBot å¦‚ä½•ä½¿ç”¨\n\n## chatterBot å®‰è£…&ä½¿ç”¨\n\n### å®‰è£…\n\nchatterBot æ˜¯ä½¿ç”¨Pythonç¼–å†™çš„ï¼Œå¯ä»¥ä½¿ç”¨ pip å®‰è£…ï¼š\n\n```bash\npip install chatterbot\n```\n\n> chatterBot çš„ä¸­æ–‡å¯¹è¯è¦æ±‚Python3 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®åœ¨Python3.x ç¯å¢ƒä¸‹å¼€å‘\n\n### æµ‹è¯•\n\næ‰“å¼€iPythonï¼Œè¾“å…¥æµ‹è¯•ä¸€ä¸‹\n\n```bash\nIn [1]: from chatterbot import ChatBot  # import ChatBot\n\nIn [2]: momo = ChatBot('Momo', trainer='chatterbot.trainers.ChatterBotCorpusTrainer')\n/Users/gs/.virtualenvs/py3/lib/python3.6/site-packages/chatterbot/storage/jsonfile.py:26: UnsuitableForProductionWarning: The JsonFileStorageAdapter is not recommended for production environments.\n  self.UnsuitableForProductionWarning  # è¿™é‡Œstorage adapter é»˜è®¤ä½¿ç”¨çš„æ˜¯ json æ ¼å¼å­˜å‚¨æ•°æ®çš„ï¼Œå¦‚æœæƒ³åœ¨æœåŠ¡ç«¯éƒ¨ç½²ï¼Œåº”è¯¥é¿å…ä½¿ç”¨è¿™ç§æ ¼å¼ï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªæ…¢äº†\n\nIn [3]: momo.train(\"chatterbot.corpus.chinese\")  # æŒ‡å®šè®­ç»ƒé›†ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸­æ–‡\n\n# ä¸‹è¾¹æ˜¯å¯¹è¯ç»“æœ\nIn [4]: momo.get_response('ä½ å¥½')\nOut[4]: <Statement text:ä½ å¥½>\n\nIn [5]: momo.get_response('æ€ä¹ˆäº†')\nOut[5]: <Statement text:æ²¡ä»€ä¹ˆ.>\n\nIn [6]: momo.get_response('ä½ çŸ¥é“å®ƒçš„æ‰€æœ‰å†…å®¹å—?')\nOut[6]: <Statement text:ä¼˜ç¾èƒœäºä¸‘é™‹.>\n\nIn [7]: momo.get_response('ä½ æ˜¯ä¸€ä¸ªç¨‹åºå‘˜å—?')\nOut[7]: <Statement text:æˆ‘æ˜¯ä¸ªç¨‹åºå‘˜>\n\nIn [8]: momo.get_response('ä½ ä½¿ç”¨ä»€ä¹ˆè¯­è¨€å‘¢ï¼Ÿ')\nOut[8]: <Statement text:æˆ‘ç»å¸¸ä½¿ç”¨ Python, Java å’Œ C++ .>\n```\n\nè¿™æ—¶ä½ å·²ç»å¯ä»¥å’Œæœºå™¨äººå¯¹è¯äº†ï¼Œä¸è¿‡ç°åœ¨ç”±äºè®­ç»ƒæ•°æ®å¤ªå°‘ï¼Œæœºå™¨äººåªèƒ½è¿”å›ç®€å•çš„å¯¹è¯ã€‚\n> è¿™é‡Œæ˜¯é»˜è®¤çš„ä¸­æ–‡å¯¹è¯è®­ç»ƒæ•°æ® [ä¸­æ–‡è®­ç»ƒæ•°æ®åœ°å€ï¼šhttps://github.com/gunthercox/chatterbot-corpus/tree/master/chatterbot_corpus/data/chinese](https://github.com/gunthercox/chatterbot-corpus/tree/master/chatterbot_corpus/data/chinese)ã€‚\n\né‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ·»åŠ è®­ç»ƒæ•°æ®å‘¢ï¼Ÿ\n\n### è®­ç»ƒæœºå™¨äºº\n\nchatterBot å†…ç½®äº†training classï¼Œè‡ªå¸¦çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨é€šè¿‡è¾“å…¥list æ¥è®­ç»ƒï¼Œæ¯”å¦‚ [\"ä½ å¥½\", \"æˆ‘ä¸å¥½\"]ï¼Œåè€…æ˜¯å‰è€…çš„å›ç­”ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡å¯¼å…¥Corpus æ ¼å¼çš„æ–‡ä»¶æ¥è®­ç»ƒã€‚ä¹Ÿæ”¯æŒè‡ªå®šä¹‰çš„è®­ç»ƒæ¨¡å—ï¼Œä¸è¿‡æœ€ç»ˆéƒ½æ˜¯è½¬ä¸ºä¸Šè¿°ä¸¤ç§ç±»å‹ã€‚\n\nchatterBot é€šè¿‡è°ƒç”¨ train() å‡½æ•°è®­ç»ƒï¼Œä¸è¿‡åœ¨è¿™ä¹‹å‰è¦å…ˆç”¨ set_trainer() æ¥è¿›è¡Œè®¾ç½®ã€‚ä¾‹å¦‚ï¼š\n\n```bash\nIn [12]: from chatterbot.trainers import ListTrainer  # å¯¼å…¥è®­ç»ƒæ¨¡å—çš„ ListTrainer ç±»\n\nIn [13]: momo.get_response('ä½ å«ä»€ä¹ˆ?')  # ç°åœ¨æ˜¯ç­”éæ‰€é—®ï¼Œå› ä¸ºåœ¨è¿™ä¹‹å‰æˆ‘ä»¬å¹¶æ²¡æœ‰è®­ç»ƒè¿‡\nOut[13]: <Statement text:æˆ‘åœ¨çƒ¤è›‹ç³•.>\n\nIn [14]: momo.set_trainer(ListTrainer)  # æŒ‡å®šè®­ç»ƒæ–¹å¼\n\nIn [15]: momo.train(['ä½ å«ä»€ä¹ˆ?', 'æˆ‘å«é­”é­”ï¼'])  # è®­ç»ƒ\n\nIn [16]: momo.get_response('ä½ å«ä»€ä¹ˆ?')  # ç°åœ¨æœºå™¨äººå·²ç»å¯ä»¥å›ç­”äº†\nOut[16]: <Statement text:æˆ‘å«é­”é­”ï¼>\n```\n\nè®­ç»ƒå¥½çš„æ•°æ®é»˜è®¤å­˜åœ¨ ./database.dbï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ jsondbã€‚\n\nå¯¹ chatterBot çš„ä»‹ç»å…ˆåˆ°è¿™é‡Œï¼Œå…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š[ChatterBot Tutorialï¼šhttp://chatterbot.readthedocs.io/en/stable/tutorial.html](http://chatterbot.readthedocs.io/en/stable/tutorial.html)\n\næ¥ä¸‹æ¥ï¼Œä»‹ç»å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ chatterBotã€‚\n\n## ä½¿ç”¨ Sanic åˆ›å»ºé¡¹ç›®\n\nSanic æ˜¯ä¸€ä¸ªå’Œç±»Flask çš„åŸºäºPython3.5+çš„webæ¡†æ¶ï¼Œå®ƒç¼–å†™çš„ä»£ç é€Ÿåº¦ç‰¹åˆ«å¿«ã€‚\n\né™¤äº†åƒFlask ä»¥å¤–ï¼ŒSanic è¿˜æ”¯æŒä»¥å¼‚æ­¥è¯·æ±‚çš„æ–¹å¼å¤„ç†è¯·æ±‚ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨æ–°çš„ async/await è¯­æ³•ï¼Œç¼–å†™éé˜»å¡çš„å¿«é€Ÿçš„ä»£ç ã€‚\n\nå¯¹ Sanic ä¸äº†è§£çš„å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ï¼š [python web æ¡†æ¶ Sanci å¿«é€Ÿå…¥é—¨](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655752001&idx=1&sn=2c2e84f5f493514fdbff482a28dd7551&chksm=80b0b86bb7c7317df9d1c7b13411a231b91bb107de5e99c5379a3d9d072d5d3fb8117f364188#rd)ï¼Œå¯ä»¥åœ¨å…¬å·è¾“å…¥ ã€sanicã€‘è·å–æ–‡ç« åœ°å€ã€‚\n\nè¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨ Sanic æ˜¯å› ä¸ºä»–å’ŒFlask éå¸¸åƒï¼Œä¹‹å‰æˆ‘ä¸€ç›´ä½¿ç”¨Flaskï¼Œå¹¶ä¸”å®ƒä¹Ÿæ˜¯ä¸“é—¨ä¸ºPython3.5 å†™çš„ï¼Œä½¿ç”¨åˆ°äº†åç¨‹ã€‚\n\né¦–å…ˆå»ºä¸ªé¡¹ç›®ï¼Œè¿™é‡Œé¡¹ç›®æˆ‘å·²ç»å»ºå¥½äº†ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š\n\n```sh\n.\nâ”œâ”€â”€ LICENSE\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ manage.py   # è¿è¡Œæ–‡ä»¶ å¯åŠ¨é¡¹ç›® ä½¿ç”¨ python manage.py å‘½ä»¤\nâ”œâ”€â”€ momo\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ app.py          # åˆ›å»ºapp æ¨¡å—\nâ”‚   â”œâ”€â”€ helper.py  \nâ”‚   â”œâ”€â”€ settings.py     # åº”ç”¨é…ç½®\nâ”‚   â””â”€â”€ views\nâ”‚       â”œâ”€â”€ __init__.py\nâ”‚       â”œâ”€â”€ hello.py    # æµ‹è¯•æ¨¡å—\nâ”‚       â””â”€â”€ mweixin.py  # å¾®ä¿¡æ¶ˆæ¯å¤„ç†æ¨¡å—\nâ”œâ”€â”€ requirements.txt\nâ””â”€â”€ supervisord.conf\n```\næºç æˆ‘å·²ç»ä¸Šä¼ åˆ°githubï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‹‰ä¸‹æ¥æµ‹è¯•ã€‚\n[é¡¹ç›®ä»£ç åœ°å€](https://github.com/gusibi/momo/tree/chatterbot)\n\næˆ‘ä»¬å…ˆé‡ç‚¹çœ‹ä¸‹ `hello.py` æ–‡ä»¶ å’Œ `helper.py `ã€‚\n\n```python\n# hello.py\n# -*- coding: utf-8 -*-\n\nfrom sanic import Sanic, Blueprint\nfrom sanic.views import HTTPMethodView\nfrom sanic.response import text\n\nfrom momo.helper import get_momo_answer  # å¯¼å…¥è·å–æœºå™¨äººå›ç­”è·å–å‡½æ•°\n\n\nblueprint = Blueprint('index', url_prefix='/')\n\n\nclass ChatBot(HTTPMethodView):\n    # èŠå¤©æœºå™¨äºº http è¯·æ±‚å¤„ç†é€»è¾‘\n    async def get(self, request):\n        ask = request.args.get('ask')\n        # å…ˆè·å–url å‚æ•°å€¼ å¦‚æœæ²¡æœ‰å€¼ï¼Œè¿”å› 'ä½ è¯´å•¥'\n        if ask:\n            answer = get_momo_answer(ask)\n            return text(answer)\n        return text('ä½ è¯´å•¥?')\n\n\nblueprint.add_route(ChatBot.as_view(), '/momo')\n```\n\n```python\n# helper.py\nfrom chatterbot import ChatBot\n\nmomo_chat = ChatBot(\n    'Momo',\n    # æŒ‡å®šå­˜å‚¨æ–¹å¼ ä½¿ç”¨mongodb å­˜å‚¨æ•°æ®\n    storage_adapter='chatterbot.storage.MongoDatabaseAdapter',\n    # æŒ‡å®š logic adpater è¿™é‡Œæˆ‘ä»¬æŒ‡å®šä¸‰ä¸ª\n    logic_adapters=[\n        \"chatterbot.logic.BestMatch\", \n        \"chatterbot.logic.MathematicalEvaluation\",  # æ•°å­¦æ¨¡å—\n        \"chatterbot.logic.TimeLogicAdapter\",   # æ—¶é—´æ¨¡å—\n    ],\n    input_adapter='chatterbot.input.VariableInputTypeAdapter',\n    output_adapter='chatterbot.output.OutputAdapter',\n    database='chatterbot',\n    read_only=True\n)\n\n\ndef get_momo_answer(content):\n    # è·å–æœºå™¨äººè¿”å›ç»“æœå‡½æ•°\n    response = momo_chat.get_response(content)\n    if isinstance(response, str):\n        return response\n    return response.text\n\n```\nè¿è¡Œå‘½ä»¤ `python manage.py` å¯åŠ¨é¡¹ç›®ã€‚\n\nåœ¨æµè§ˆå™¨è®¿é—®urlï¼š [http://0.0.0.0:8000/momo?ask=ä½ æ˜¯ç¨‹åºå‘˜å—](http://0.0.0.0:8000/momo?ask=ä½ æ˜¯ç¨‹åºå‘˜å—)\n\n![è¿è¡Œç»“æœ](http://media.gusibi.mobi/3l0HV4l5N473KqwM6C35IW78zP5j0qybSymjK4HHzeFj3KbMkH3jS7W_kpsF-EtX)\n\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å¯åŠ¨äº†ä¸€ä¸ªweb é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡è®¿é—®url çš„æ–¹å¼å’Œæœºå™¨äººå¯¹è¯ï¼Œæ˜¯æ—¶å€™æ¥å…¥å¾®ä¿¡å…¬å·äº†ï¼\n\n## æ¥å…¥å¾®ä¿¡å…¬ä¼—å·\n\n### å‰æ\n\n1. æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„å¾®ä¿¡å…¬ä¼—å·ï¼ˆè®¢é˜…å·æœåŠ¡å·éƒ½å¯ä»¥ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä½¿ç”¨å¾®ä¿¡æä¾›çš„æµ‹è¯•è´¦å·ï¼‰\n2. æ‹¥æœ‰ä¸€ä¸ªå¤–ç½‘å¯ä»¥è®¿é—®çš„æœåŠ¡å™¨ï¼ˆvps æˆ–å…¬æœ‰äº‘éƒ½å¯ä»¥ aws æ–°ç”¨æˆ·å…è´¹ä½¿ç”¨ä¸€å¹´ï¼Œå¯ä»¥è¯•è¯•ï¼‰\n3. æœåŠ¡å™¨é…ç½®äº†python3 ç¯å¢ƒï¼Œï¼ˆå»ºè®®ä½¿ç”¨ virtualenvwrapper é…ç½®è™šæ‹Ÿç¯å¢ƒï¼‰\n\n### å¾®ä¿¡è®¾ç½®\n\nç™»å½•å¾®ä¿¡å…¬ä¼—å·ï¼š [https://mp.weixin.qq.com](https://mp.weixin.qq.com)\n\n#### æ‰“å¼€ï¼šå¼€å‘>åŸºæœ¬é…ç½®\næŸ¥çœ‹å…¬å·å¼€å‘ä¿¡æ¯ï¼š\n\n![å…¬å·åŸºæœ¬ä¿¡æ¯](http://media.gusibi.mobi/JZqW6bMs4_qRB-XnMoPZNMHWUh3uI3l482UTg6EbkrN0KZSisiloqhV4uCBuLPYP)\n\n#### å¼€å¯æœåŠ¡å™¨é…ç½®ï¼š\n**è®¾ç½®è¯·æ±‚urlï¼Œè¿™é‡Œæ˜¯ä½ é…ç½®çš„urlï¼ˆéœ€è¦å¤–ç½‘å¯è®¿é—®ï¼Œåªèƒ½æ˜¯80æˆ–443ç«¯å£ï¼‰**\n\n![å¼€å¯æœåŠ¡å™¨é…ç½®](http://media.gusibi.mobi/gx5Ssn4Taoq-BDMJ0Dty56ks7IkWR9ruCn5oMYuXEUMDeNj8YgCSM8caxI3AVzcu)\nå¡«å†™tokenå’ŒEncodingAESKeyï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯å…¼å®¹æ¨¡å¼ï¼Œæ—¢æœ‰æ˜æ–‡æ–¹ä¾¿è°ƒè¯•ï¼Œåˆæœ‰ä¿¡æ¯åŠ å¯†ã€‚\n\n![é…ç½®æœåŠ¡å™¨](http://media.gusibi.mobi/CghRlbwDFA2-U2I9mOZZZitRiT-gRnj433UPHuRMh9jEEbUMuzE8PfrmCc9lZqNk)\n\nè¯¦ç»†é…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š[æ¥å…¥æŒ‡å—](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1445241432)\n\nå¦‚æœä½ çš„ `æœåŠ¡å™¨åœ°å€` å·²ç»é…ç½®å®Œæˆï¼Œç°åœ¨ç‚¹å‡»æäº¤åº”è¯¥å°±æˆåŠŸäº†ã€‚å¦‚æœæ²¡æœ‰æˆåŠŸæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹æ€ä¹ˆé…ç½®æœåŠ¡å™¨åœ°å€ã€‚\n\n### ä»£ç ç¤ºä¾‹\n\nå…ˆçœ‹ä¸‹ å¾®ä¿¡è¯·æ±‚çš„è§†å›¾ä»£ç ï¼š\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom six import StringIO\n\nimport re\nimport xmltodict\nfrom chatterbot.trainers import ListTrainer\n\nfrom sanic import Blueprint\nfrom sanic.views import HTTPMethodView\nfrom sanic.response import text\nfrom sanic.exceptions import ServerError\n\nfrom weixin import WeixinMpAPI\nfrom weixin.lib.WXBizMsgCrypt import WXBizMsgCrypt\n\nfrom momo.settings import Config\n\nblueprint = Blueprint('weixin', url_prefix='/weixin')\n\n\nclass WXRequestView(HTTPMethodView):\n\n    def _get_args(self, request):\n        # è·å–å¾®ä¿¡è¯·æ±‚å‚æ•°ï¼ŒåŠ ä¸Štoken  æ‹¼æ¥ä¸ºå®Œæ•´çš„è¯·æ±‚å‚æ•°\n        params = request.raw_args\n        if not params:\n            raise ServerError(\"invalid params\", status_code=400)\n        args = {\n            'mp_token': Config.WEIXINMP_TOKEN,\n            'signature': params.get('signature'),\n            'timestamp': params.get('timestamp'),\n            'echostr': params.get('echostr'),\n            'nonce': params.get('nonce'),\n        }\n        return args\n\n    def get(self, request):\n        # å¾®ä¿¡éªŒè¯æœåŠ¡å™¨è¿™ä¸€æ­¥æ˜¯get  è¯·æ±‚ï¼Œå‚æ•°å¯ä»¥ä½¿ç”¨ request.raw_args è·å–\n        args = self._get_args(request)\n        weixin = WeixinMpAPI(**args) # è¿™é‡Œæˆ‘ä½¿ç”¨äº† ç¬¬ä¸‰æ–¹åŒ… python-weixin å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªWeixinMpAPIå¯¹è±¡\n        if weixin.validate_signature(): # éªŒè¯å‚æ•°åˆæ³•æ€§\n            # å¦‚æœå‚æ•°äº‰å–ï¼Œæˆ‘ä»¬å°†å¾®ä¿¡å‘è¿‡æ¥çš„echostrå‚æ•°å†è¿”å›ç»™å¾®ä¿¡ï¼Œå¦åˆ™è¿”å› fail\n            return text(args.get('echostr') or 'fail')\n        return text('fail')\n        \nblueprint.add_route(WXRequestView.as_view(), '/request')\n```\nè¿™é‡Œå¤„ç†å¾®ä¿¡è¯·æ±‚æˆ‘ä½¿ç”¨çš„æ˜¯ æˆ‘ç”¨python å†™çš„ å¾®ä¿¡SDK [python-weixin](https://github.com/gusibi/python-weixin)ï¼Œå¯ä»¥ä½¿ç”¨ pip å®‰è£…ï¼š\n\n```bash\npip install python-weixin\n```\n\nè¿™ä¸ªåŒ…æœ€æ–°ç‰ˆæœ¬å¯¹Python3 åŠ å¯†è§£å¯†æœ‰ç‚¹é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥ä»github å®‰è£…:\n\n```bash\npip install git+https://github.com/zongxiao/python-weixin.git@py3\n```\n\nç„¶åæ›´æ–° app.py æ–‡ä»¶ï¼š\n\n```python\n# -*- coding: utf-8 -*-\nfrom sanic import Sanic\nfrom momo.settings import Config\n\n\ndef create_app(register_bp=True, test=False):\n    # åˆ›å»ºapp    \n    app = Sanic(__name__)\n    if test:\n        app.config['TESTING'] = True\n    # ä»object å¯¼å…¥é…ç½®\n    app.config.from_object(Config)\n    register_blueprints(app)\n    return app\n\n\ndef register_blueprints(app):\n    from momo.views.hello import blueprint as hello_bp\n    from momo.views.mweixin import blueprint as wx_bp\n    app.register_blueprint(hello_bp)\n    # æ³¨å†Œ wx_bp \n    app.register_blueprint(wx_bp)\n```\n\nè¯¦ç»†ä»£ç å‚è€ƒgithub: [å¾®ä¿¡èŠå¤©æœºå™¨äºº momo](https://github.com/gusibi/momo/tree/chatterbot)\n\n## æ¥å…¥èŠå¤©æœºå™¨äºº\n\nç°åœ¨æˆ‘ä»¬å…¬å·å·²ç»æ¥å…¥äº†è‡ªå·±çš„æœåŠ¡ï¼Œæ˜¯æ—¶å€™æ¥å…¥å¾®ä¿¡èŠå¤©æœºå™¨äººã€‚\n\nå¾®ä¿¡èŠå¤©æœºå™¨äººçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\n\n![å¾®ä¿¡èŠå¤©æœºå™¨äººå·¥ä½œæµç¨‹](http://media.gusibi.mobi/p88CrkRItlwU7VXo7uihsd9DPV-vSexkuXqKuQ1ZJGlFrFT25AzhvkFh2Aqc6Ajn)\n\nçœ‹æˆ‘ä»¬æ¶ˆæ¯é€»è¾‘å¤„ç†ä»£ç ï¼š\n\n```python\n# -*- coding: utf-8 -*-\nfrom __future__ import unicode_literals\n\nfrom six import StringIO\n\nimport re\nimport xmltodict\nfrom chatterbot.trainers import ListTrainer\n\nfrom sanic import Blueprint\nfrom sanic.views import HTTPMethodView\nfrom sanic.response import text\nfrom sanic.exceptions import ServerError\n\nfrom weixin import WeixinMpAPI\nfrom weixin.reply import TextReply\nfrom weixin.response import WXResponse as _WXResponse\nfrom weixin.lib.WXBizMsgCrypt import WXBizMsgCrypt\n\nfrom momo.settings import Config\nfrom momo.helper import validate_xml, smart_str, get_momo_answer\nfrom momo.media import media_fetch\n\n\nblueprint = Blueprint('weixin', url_prefix='/weixin')\n\nappid = smart_str(Config.WEIXINMP_APPID)\ntoken = smart_str(Config.WEIXINMP_TOKEN)\nencoding_aeskey = smart_str(Config.WEIXINMP_ENCODINGAESKEY)\n\n# å…³æ³¨åè‡ªåŠ¨è¿”å›çš„æ–‡æ¡ˆ\nAUTO_REPLY_CONTENT = \"\"\"\nHiï¼Œæœ‹å‹ï¼\nè¿™æ˜¯æˆ‘å¦ˆå››æœˆçš„å…¬å·ï¼Œæˆ‘æ˜¯é­”é­”ï¼Œæˆ‘å¯ä»¥é™ªä½ èŠå¤©å‘¦ï¼\næˆ‘è¿˜èƒ½\"è®°è´¦\"ï¼Œè¾“å…¥\"è®°è´¦\"ä¼šæœ‰æƒŠå–œå‘¦ï¼\n<a href=\"https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=MzAwNjI5MjAzNw==&scene=124#wechat_redirect\">å†å²è®°å½•</a>\n\"\"\"\n\n\nclass ReplyContent(object):\n\n    _source = 'value'\n\n    def __init__(self, event, keyword, content=None, momo=True):\n        self.momo = momo\n        self.event = event\n        self.content = content\n        self.keyword = keyword\n        if self.event == 'scan':\n            pass\n\n    @property\n    def value(self):\n        if self.momo:\n            answer = get_momo_answer(self.content)\n            return answer\n        return ''\n\n\nclass WXResponse(_WXResponse):\n\n    auto_reply_content = AUTO_REPLY_CONTENT\n\n    def _subscribe_event_handler(self):\n        # å…³æ³¨å…¬å·åçš„å¤„ç†é€»è¾‘\n        self.reply_params['content'] = self.auto_reply_content\n        self.reply = TextReply(**self.reply_params).render()\n\n    def _unsubscribe_event_handler(self):\n        # å–å…³åçš„å¤„ç†é€»è¾‘ï¼Œå–å…³æˆ‘ä¼°è®¡ä¼šå“­å§\n        pass\n\n    def _text_msg_handler(self):\n        # æ–‡å­—æ¶ˆæ¯å¤„ç†é€»è¾‘ èŠå¤©æœºå™¨äººçš„ä¸»è¦é€»è¾‘\n        event_key = 'text'\n        content = self.data.get('Content')\n        reply_content = ReplyContent('text', event_key, content)\n        self.reply_params['content'] = reply_content.value\n        self.reply = TextReply(**self.reply_params).render()\n\n\nclass WXRequestView(HTTPMethodView):\n\n    def _get_args(self, request):\n        params = request.raw_args\n        if not params:\n            raise ServerError(\"invalid params\", status_code=400)\n        args = {\n            'mp_token': Config.WEIXINMP_TOKEN,\n            'signature': params.get('signature'),\n            'timestamp': params.get('timestamp'),\n            'echostr': params.get('echostr'),\n            'nonce': params.get('nonce'),\n        }\n        return args\n\n    def get(self, request):\n        args = self._get_args(request)\n        weixin = WeixinMpAPI(**args)\n        if weixin.validate_signature():\n            return text(args.get('echostr') or 'fail')\n        return text('fail')\n\n    def _get_xml(self, data):\n        post_str = smart_str(data)\n        # éªŒè¯xml æ ¼å¼æ˜¯å¦æ­£ç¡®\n        validate_xml(StringIO(post_str))\n        return post_str\n\n    def _decrypt_xml(self, params, crypt, xml_str):\n        # è§£å¯†æ¶ˆæ¯\n        nonce = params.get('nonce')\n        msg_sign = params.get('msg_signature')\n        timestamp = params.get('timestamp')\n        ret, decryp_xml = crypt.DecryptMsg(xml_str, msg_sign,\n                                           timestamp, nonce)\n        return decryp_xml, nonce\n\n    def _encryp_xml(self, crypt, to_xml, nonce):\n        # åŠ å¯†æ¶ˆæ¯\n        to_xml = smart_str(to_xml)\n        ret, encrypt_xml = crypt.EncryptMsg(to_xml, nonce)\n        return encrypt_xml\n\n    def post(self, request):\n        # è·å–å¾®ä¿¡æœåŠ¡å™¨å‘é€çš„è¯·æ±‚å‚æ•°\n        args = self._get_args(request)\n        weixin = WeixinMpAPI(**args)\n        if not weixin.validate_signature(): # éªŒè¯å‚æ•°åˆæ³•æ€§\n            raise AttributeError(\"Invalid weixin signature\")\n        xml_str = self._get_xml(request.body)  # è·å–form data\n        crypt = WXBizMsgCrypt(token, encoding_aeskey, appid) \n        decryp_xml, nonce = self._decrypt_xml(request.raw_args, crypt, xml_str) # è§£å¯†\n        xml_dict = xmltodict.parse(decryp_xml)\n        xml = WXResponse(xml_dict)() or 'success' # ä½¿ç”¨WXResponse æ ¹æ®æ¶ˆæ¯è·å–æœºå™¨äººè¿”å›å€¼\n        encryp_xml = self._encryp_xml(crypt, xml, nonce) # åŠ å¯†æ¶ˆæ¯\n        return text(encryp_xml or xml) # å›åº”å¾®ä¿¡è¯·æ±‚\n\n\nblueprint.add_route(WXRequestView.as_view(), '/request')\n\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘å¤„ç†å¾®ä¿¡è¯·æ±‚è¿”å›ç»“æœæ¯”è¾ƒç®€å•ï¼Œä¹Ÿæ˜¯ä½¿ç”¨çš„ python-weixin åŒ…å°è£…çš„æ¥å£ï¼Œ\nä¸»è¦çš„å¤„ç†é€»è¾‘æ˜¯ WXResponseã€‚\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨åœ¨5ç§’å†…æ²¡æœ‰å“åº”å¾®ä¿¡æœåŠ¡å™¨ä¼šé‡è¯•ã€‚ä¸ºäº†åŠ å¿«å“åº”é€Ÿåº¦ï¼Œä¸è¦åœ¨æœåŠ¡å™¨ å°† chatterBot çš„ storage adapter è®¾ç½®ä¸ºä½¿ç”¨ jsondbã€‚\n\nä¸Šè¾¹è¿™äº›å°±æ˜¯ï¼Œå¾®ä¿¡èŠå¤©æœºå™¨äººçš„ä¸»è¦å¤„ç†é€»è¾‘ï¼Œæˆ‘ä»¬è¿è¡ŒæœåŠ¡ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n![èŠå¤©ç¤ºä¾‹å›¾](http://media.gusibi.mobi/gdLue88YMxJcy0hDqcWntqUHl_ekWu99WXe_vbphQy5TetIuESae-M6lEaWw2WqP)\n\nå¯ä»¥çœ‹åˆ°è¿™é‡ŒèŠå¤©æœºå™¨äººä¹Ÿå¯ä»¥åšç®€å•çš„æ•°å­¦è¿ç®—å’ŒæŠ¥æ—¶ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨ä¸Šè¾¹æŒ‡å®šå¤„ç†é€»è¾‘çš„æ—¶å€™æ·»åŠ äº†æ•°å­¦æ¨¡å—å’Œæ—¶é—´æ¨¡å—ï¼š\n\n```python\nmomo_chat = ChatBot(\n    'Momo',\n    # æŒ‡å®šå­˜å‚¨æ–¹å¼ ä½¿ç”¨mongodb å­˜å‚¨æ•°æ®\n    storage_adapter='chatterbot.storage.MongoDatabaseAdapter',\n    # æŒ‡å®š logic adpater è¿™é‡Œæˆ‘ä»¬æŒ‡å®šä¸‰ä¸ª\n    logic_adapters=[\n        \"chatterbot.logic.BestMatch\", \n        \"chatterbot.logic.MathematicalEvaluation\",  # æ•°å­¦æ¨¡å—\n        \"chatterbot.logic.TimeLogicAdapter\",   # æ—¶é—´æ¨¡å—\n    ],\n    input_adapter='chatterbot.input.VariableInputTypeAdapter',\n    output_adapter='chatterbot.output.OutputAdapter',\n    database='chatterbot',\n    read_only=True\n)\n```\n\nåˆ°è¿™é‡Œï¼Œå¾®ä¿¡æœºå™¨äººçš„æ­å»ºå°±å®Œæˆäº†ï¼Œè¯¦ç»†ä»£ç å·²ç»é•¿ä¼ åˆ°äº† [github: https://github.com/gusibi/momo/tree/chatterbot](https://github.com/gusibi/momo/tree/chatterbot)ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚\n\n## å‚è€ƒé“¾æ¥\n\n* [ChatterBot é¡¹ç›®åœ°å€ï¼šhttps://github.com/gunthercox/ChatterBot](https://github.com/gunthercox/ChatterBot)\n* [ChatterBot Tutorialï¼šhttp://chatterbot.readthedocs.io/en/stable/tutorial.html](http://chatterbot.readthedocs.io/en/stable/tutorial.html)\n* [ç”¨Pythonå¿«é€Ÿå®ç°ä¸€ä¸ªèŠå¤©æœºå™¨äººï¼šhttp://www.jianshu.com/p/d1333fde266f](http://www.jianshu.com/p/d1333fde266f)\n* [åŸºäºPython-ChatterBotæ­å»ºä¸åŒadapterçš„èŠå¤©æœºå™¨äººï¼šhttps://ask.hellobi.com/blog/guodongwei1991/7626](https://ask.hellobi.com/blog/guodongwei1991/7626)\n* [æ“æœ‰è‡ªå‹•å­¸ç¿’çš„ Python æ©Ÿå™¨äºº - ChatterBotï¼šhttps://kantai235.github.io/2017/03/16/ChatterBotTeaching/](https://kantai235.github.io/2017/03/16/ChatterBotTeaching/)\n* [ä½¿ç”¨ ChatterBotæ„å»ºèŠå¤©æœºå™¨äººï¼šhttps://www.biaodianfu.com/chatterbot.html](https://www.biaodianfu.com/chatterbot.html)\n* [python-weixin sdk: https://github.com/gusibi/python-weixin](https://github.com/gusibi/python-weixin)\n\n## é¢„å‘Š\n\nè¿™é‡Œï¼ŒèŠå¤©æœºå™¨äººè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„åªèƒ½å›å¤ç®€å•çš„å¯¹è¯ï¼Œä¸‹ä¸€ç¯‡å°†è¦ç»“æŸå¦‚ä½•åœ¨å…¬å·è®­ç»ƒæœºå™¨äººä»¥åŠä¸€ä¸ªæ›´å®ç”¨çš„åŠŸèƒ½ï¼Œå¦‚ä½•è®©å…¬å·å˜æˆä¸€ä¸ªåšå®¢å†™ä½œåŠ©æ‰‹ã€‚\n\n------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "å¾®ä¿¡å…¬å·DIYï¼šä¸€å°æ—¶æ­å»ºå¾®ä¿¡èŠå¤©æœºå™¨äºº",
        "date": "2017-07-05 15:47:13",
        "tags": [
          "python",
          "tutorial",
          "weixin",
          "å…¬ä¼—å·"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "weixin_chatbot_step_by_step"
    },
    {
      "content": "\n> è¿™ä¸€ç¯‡æ˜¯Pythonå¹¶å‘çš„ç¬¬å››ç¯‡ï¼Œä¸»è¦ä»‹ç»è¿›ç¨‹å’Œçº¿ç¨‹çš„å®šä¹‰ï¼ŒPythonçº¿ç¨‹å’Œå…¨å±€è§£é‡Šå™¨é”ä»¥åŠPythonå¦‚ä½•ä½¿ç”¨threadæ¨¡å—å¤„ç†å¹¶å‘ï¼Œè¿™ç¯‡æ–‡ç« ä¹‹å‰å‘è¿‡ï¼Œä½†æ˜¯å‰å‡ ç¯‡ä»‹ç»åˆ°äº†å¹¶å‘ï¼Œå°±é¡ºä¾¿å†å‘ä¸€ä¸‹ç»„æˆä¸€ä¸ªç³»åˆ—\n\n## å¼•è¨€&åŠ¨æœº\n\nè€ƒè™‘ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬æœ‰10000æ¡æ•°æ®éœ€è¦å¤„ç†ï¼Œå¤„ç†æ¯æ¡æ•°æ®éœ€è¦èŠ±è´¹1ç§’ï¼Œä½†è¯»å–æ•°æ®åªéœ€è¦0.1ç§’ï¼Œæ¯æ¡æ•°æ®äº’ä¸å¹²æ‰°ã€‚è¯¥å¦‚ä½•æ‰§è¡Œæ‰èƒ½èŠ±è´¹æ—¶é—´æœ€çŸ­å‘¢ï¼Ÿ\n\nåœ¨å¤šçº¿ç¨‹(MT)ç¼–ç¨‹å‡ºç°ä¹‹å‰ï¼Œç”µè„‘ç¨‹åºçš„è¿è¡Œç”±ä¸€ä¸ªæ‰§è¡Œåºåˆ—ç»„æˆï¼Œæ‰§è¡Œåºåˆ—æŒ‰é¡ºåºåœ¨ä¸»æœºçš„ä¸­å¤®å¤„ç†å™¨(CPU)ä¸­è¿è¡Œã€‚æ— è®ºæ˜¯ä»»åŠ¡æœ¬èº«è¦æ±‚é¡ºåºæ‰§è¡Œè¿˜æ˜¯æ•´ä¸ªç¨‹åºæ˜¯ç”±å¤šä¸ªå­ä»»åŠ¡ç»„æˆï¼Œç¨‹åºéƒ½æ˜¯æŒ‰è¿™ç§æ–¹å¼æ‰§è¡Œçš„ã€‚å³ä½¿å­ä»»åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ç›¸æ— å…³(å³ï¼Œä¸€ä¸ªå­ä»»åŠ¡çš„ç»“æœä¸å½±å“å…¶å®ƒå­ ä»»åŠ¡çš„ç»“æœ)æ—¶ä¹Ÿæ˜¯è¿™æ ·ã€‚\n\nHUGOMORE42\n\nå¯¹äºä¸Šè¾¹çš„é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªæ‰§è¡Œåºåˆ—æ¥å®Œæˆï¼Œæˆ‘ä»¬å¤§çº¦éœ€è¦èŠ±è´¹ 10000*0.1 + 10000 = 11000 ç§’ã€‚è¿™ä¸ªæ—¶é—´æ˜¾ç„¶æ˜¯å¤ªé•¿äº†ã€‚\n\né‚£æˆ‘ä»¬æœ‰æ²¡æœ‰å¯èƒ½åœ¨æ‰§è¡Œè®¡ç®—çš„åŒæ—¶å–æ•°æ®å‘¢ï¼Ÿæˆ–è€…æ˜¯åŒæ—¶å¤„ç†å‡ æ¡æ•°æ®å‘¢ï¼Ÿå¦‚æœå¯ä»¥ï¼Œè¿™æ ·å°±èƒ½å¤§å¹…æé«˜ä»»åŠ¡çš„æ•ˆç‡ã€‚è¿™å°±æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹çš„ç›®çš„ã€‚\n\nå¯¹äºæœ¬è´¨ä¸Šå°±æ˜¯å¼‚æ­¥çš„ï¼Œ éœ€è¦æœ‰å¤šä¸ªå¹¶å‘äº‹åŠ¡ï¼Œå„ä¸ªäº‹åŠ¡çš„è¿è¡Œé¡ºåºå¯ä»¥æ˜¯ä¸ç¡®å®šçš„ï¼Œéšæœºçš„ï¼Œä¸å¯é¢„æµ‹çš„é—®é¢˜ï¼Œå¤šçº¿ç¨‹æ˜¯æœ€ç†æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚è¿™æ ·çš„ä»»åŠ¡å¯ä»¥è¢«åˆ†æˆå¤šä¸ªæ‰§è¡Œæµï¼Œæ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªè¦å®Œæˆçš„ç›®æ ‡ï¼Œç„¶åå°†å¾—åˆ°çš„ç»“æœåˆå¹¶ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚\n\n## çº¿ç¨‹å’Œè¿›ç¨‹\n\n### ä»€ä¹ˆæ˜¯è¿›ç¨‹\n\nè¿›ç¨‹(æœ‰æ—¶è¢«ç§°ä¸ºé‡é‡çº§è¿›ç¨‹)æ˜¯ç¨‹åºçš„ä¸€æ¬¡ æ‰§è¡Œã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œå†…å­˜ï¼Œæ•°æ®æ ˆä»¥åŠå…¶å®ƒè®°å½•å…¶è¿è¡Œè½¨è¿¹çš„è¾…åŠ©æ•°æ®ã€‚æ“ä½œç³» ç»Ÿç®¡ç†åœ¨å…¶ä¸Šè¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ï¼Œå¹¶ä¸ºè¿™äº›è¿›ç¨‹å…¬å¹³åœ°åˆ†é…æ—¶é—´ã€‚è¿›ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡ fork å’Œ spawn æ“ä½œ æ¥å®Œæˆå…¶å®ƒçš„ä»»åŠ¡ã€‚ä¸è¿‡å„ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ•°æ®æ ˆç­‰ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨è¿›ç¨‹é—´é€šè®¯(IPC)ï¼Œ è€Œä¸èƒ½ç›´æ¥å…±äº«ä¿¡æ¯ã€‚\n\n### ä»€ä¹ˆæ˜¯çº¿ç¨‹\n\nçº¿ç¨‹(æœ‰æ—¶è¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹)è·Ÿè¿›ç¨‹æœ‰äº›ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œæ‰€æœ‰çš„çº¿ç¨‹è¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œ å…±äº«ç›¸åŒçš„è¿è¡Œç¯å¢ƒã€‚å®ƒä»¬å¯ä»¥æƒ³åƒæˆæ˜¯åœ¨ä¸»è¿›ç¨‹æˆ–â€œä¸»çº¿ç¨‹â€ä¸­å¹¶è¡Œè¿è¡Œçš„â€œè¿·ä½ è¿›ç¨‹â€ã€‚\n\nçº¿ç¨‹çŠ¶æ€å¦‚å›¾\n\n![çº¿ç¨‹çŠ¶æ€å¦‚å›¾](http://omuo4kh1k.bkt.clouddn.com/python-thread-status.png)\n\n\nçº¿ç¨‹æœ‰å¼€å§‹ï¼Œé¡ºåºæ‰§è¡Œå’Œç»“æŸä¸‰éƒ¨åˆ†ã€‚å®ƒæœ‰ä¸€ä¸ªè‡ªå·±çš„æŒ‡ä»¤æŒ‡é’ˆï¼Œè®°å½•è‡ªå·±è¿è¡Œåˆ°ä»€ä¹ˆåœ°æ–¹ã€‚ çº¿ç¨‹çš„è¿è¡Œå¯èƒ½è¢«æŠ¢å (ä¸­æ–­)ï¼Œæˆ–æš‚æ—¶çš„è¢«æŒ‚èµ·(ä¹Ÿå«ç¡çœ )ï¼Œè®©å…¶å®ƒçš„çº¿ç¨‹è¿è¡Œï¼Œè¿™å«åšè®©æ­¥ã€‚ ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å„ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«åŒä¸€ç‰‡æ•°æ®ç©ºé—´ï¼Œæ‰€ä»¥çº¿ç¨‹ä¹‹é—´å¯ä»¥æ¯”è¿›ç¨‹ä¹‹é—´æ›´æ–¹ä¾¿åœ°å…±äº«æ•°æ®ä»¥åŠç›¸äº’é€šè®¯ã€‚\n\nå½“ç„¶ï¼Œè¿™æ ·çš„å…±äº«å¹¶ä¸æ˜¯å®Œå…¨æ²¡æœ‰å±é™©çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹å…±åŒè®¿é—®åŒä¸€ç‰‡æ•°æ®ï¼Œåˆ™ç”±äºæ•°æ®è®¿ é—®çš„é¡ºåºä¸ä¸€æ ·ï¼Œæœ‰å¯èƒ½å¯¼è‡´æ•°æ®ç»“æœçš„ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è¿™å«åšç«æ€æ¡ä»¶(race condition)ã€‚\n\nçº¿ç¨‹ä¸€èˆ¬éƒ½æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œä¸è¿‡åœ¨å• CPU çš„ç³»ç»Ÿä¸­ï¼ŒçœŸæ­£çš„å¹¶å‘æ˜¯ä¸å¯èƒ½çš„ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼šè¢«å®‰æ’æˆæ¯æ¬¡åªè¿è¡Œä¸€å°ä¼šï¼Œç„¶åå°±æŠŠ CPU è®©å‡ºæ¥ï¼Œè®©å…¶å®ƒçš„çº¿ç¨‹å»è¿è¡Œã€‚ç”±äºæœ‰çš„å‡½æ•°ä¼šåœ¨å®Œæˆä¹‹å‰é˜»å¡ä½ï¼Œåœ¨æ²¡æœ‰ç‰¹åˆ«ä¸ºå¤šçº¿ç¨‹åšä¿®æ”¹çš„æƒ… å†µä¸‹ï¼Œè¿™ç§â€œè´ªå©ªâ€çš„å‡½æ•°ä¼šè®© CPU çš„æ—¶é—´åˆ†é…æœ‰æ‰€å€¾æ–œã€‚å¯¼è‡´å„ä¸ªçº¿ç¨‹åˆ†é…åˆ°çš„è¿è¡Œæ—¶é—´å¯èƒ½ä¸ å°½ç›¸åŒï¼Œä¸å°½å…¬å¹³ã€‚\n\n## Pythonã€çº¿ç¨‹å’Œå…¨å±€è§£é‡Šå™¨é”\n\n### å…¨å±€è§£é‡Šå™¨é”(GIL)\n\né¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯GILå¹¶ä¸æ˜¯Pythonçš„ç‰¹æ€§ï¼Œå®ƒæ˜¯åœ¨å®ç°Pythonè§£æå™¨(CPython)æ—¶æ‰€å¼•å…¥çš„ä¸€ä¸ªæ¦‚å¿µã€‚å°±å¥½æ¯”C++æ˜¯ä¸€å¥—è¯­è¨€ï¼ˆè¯­æ³•ï¼‰æ ‡å‡†ï¼Œä½†æ˜¯å¯ä»¥ç”¨ä¸åŒçš„ç¼–è¯‘å™¨æ¥ç¼–è¯‘æˆå¯æ‰§è¡Œä»£ç ã€‚åŒæ ·ä¸€æ®µä»£ç å¯ä»¥é€šè¿‡CPythonï¼ŒPyPyï¼ŒPsycoç­‰ä¸åŒçš„Pythonæ‰§è¡Œç¯å¢ƒæ¥æ‰§è¡Œï¼ˆå…¶ä¸­çš„JPythonå°±æ²¡æœ‰GILï¼‰ã€‚\n\né‚£ä¹ˆCPythonå®ç°ä¸­çš„GILåˆæ˜¯ä»€ä¹ˆå‘¢ï¼ŸGILå…¨ç§°Global Interpreter Lockä¸ºäº†é¿å…è¯¯å¯¼ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„è§£é‡Šï¼š\n\n> In CPython, the global interpreter lock, or GIL, is a mutex that prevents multiple native threads from executing Python bytecodes at once. This lock is necessary mainly because CPythonâ€™s memory management is not thread-safe. (However, since the GIL exists, other features have grown to depend on the guarantees that it enforces.)\n\nå°½ç®¡Pythonå®Œå…¨æ”¯æŒå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œ ä½†æ˜¯è§£é‡Šå™¨çš„Cè¯­è¨€å®ç°éƒ¨åˆ†åœ¨å®Œå…¨å¹¶è¡Œæ‰§è¡Œæ—¶å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å®é™…ä¸Šï¼Œè§£é‡Šå™¨è¢«ä¸€ä¸ªå…¨å±€è§£é‡Šå™¨é”ä¿æŠ¤ç€ï¼Œå®ƒç¡®ä¿ä»»ä½•æ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªPythonçº¿ç¨‹æ‰§è¡Œã€‚\n\nåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼ŒPython è™šæ‹ŸæœºæŒ‰ä»¥ä¸‹æ–¹å¼æ‰§è¡Œ:\n\n1. è®¾ç½®GIL\n2. åˆ‡æ¢åˆ°ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œ\n3. è¿è¡Œ\n  - æŒ‡å®šæ•°é‡çš„å­—èŠ‚ç æŒ‡ä»¤\n  - çº¿ç¨‹ä¸»åŠ¨è®©å‡ºæ§åˆ¶ï¼ˆå¯ä»¥è°ƒç”¨time.sleep(0))\n4. æŠŠçº¿ç¨‹è®¾ç½®å®Œç¡çœ çŠ¶æ€\n5. è§£é”GIL\n6. å†æ¬¡é‡å¤ä»¥ä¸Šæ­¥éª¤\n\n> å¯¹æ‰€æœ‰é¢å‘ I/O çš„(ä¼šè°ƒç”¨å†…å»ºçš„æ“ä½œç³»ç»Ÿ C ä»£ç çš„)ç¨‹åºæ¥è¯´ï¼ŒGIL ä¼šåœ¨è¿™ä¸ª I/O è°ƒç”¨ä¹‹ å‰è¢«é‡Šæ”¾ï¼Œä»¥å…è®¸å…¶å®ƒçš„çº¿ç¨‹åœ¨è¿™ä¸ªçº¿ç¨‹ç­‰å¾… I/O çš„æ—¶å€™è¿è¡Œã€‚å¦‚æœæŸçº¿ç¨‹å¹¶æœªä½¿ç”¨å¾ˆå¤š I/O æ“ä½œï¼Œ å®ƒä¼šåœ¨è‡ªå·±çš„æ—¶é—´ç‰‡å†…ä¸€ç›´å ç”¨å¤„ç†å™¨(å’Œ GIL)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒI/O å¯†é›†å‹çš„ Python ç¨‹åºæ¯”è®¡ç®—å¯†é›† å‹çš„ç¨‹åºæ›´èƒ½å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹ç¯å¢ƒçš„å¥½å¤„ã€‚\n\n### é€€å‡ºçº¿ç¨‹\n\nå½“ä¸€ä¸ªçº¿ç¨‹ç»“æŸè®¡ç®—ï¼Œå®ƒå°±é€€å‡ºäº†ã€‚çº¿ç¨‹å¯ä»¥è°ƒç”¨ thread.exit()ä¹‹ç±»çš„é€€å‡ºå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Python é€€å‡ºè¿›ç¨‹çš„æ ‡å‡†æ–¹æ³•ï¼Œå¦‚ sys.exit()æˆ–æŠ›å‡ºä¸€ä¸ª SystemExit å¼‚å¸¸ç­‰ã€‚ä¸è¿‡ï¼Œä½ ä¸å¯ä»¥ç›´æ¥ â€œæ€æ‰â€(\"kill\")ä¸€ä¸ªçº¿ç¨‹ã€‚\n\n### åœ¨ Python ä¸­ä½¿ç”¨çº¿ç¨‹\n\nåœ¨ Win32 å’Œ Linux, Solaris, MacOS, \\*BSD ç­‰å¤§å¤šæ•°ç±» Unix ç³»ç»Ÿä¸Šè¿è¡Œæ—¶ï¼ŒPython æ”¯æŒå¤šçº¿ç¨‹ ç¼–ç¨‹ã€‚Python ä½¿ç”¨ POSIX å…¼å®¹çš„çº¿ç¨‹ï¼Œå³ pthreadsã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦åœ¨è§£é‡Šå™¨ä¸­\n\n```\n>> import thread\n```\n\nå¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œåˆ™è¯´æ˜çº¿ç¨‹å¯ç”¨ã€‚\n\n### Python çš„ threading æ¨¡å—\n\nPython  ä¾›äº†å‡ ä¸ªç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ thread, threading å’Œ Queue ç­‰ã€‚thread å’Œ threading æ¨¡å—å…è®¸ç¨‹åºå‘˜åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹ã€‚thread æ¨¡å— ä¾›äº†åŸºæœ¬çš„çº¿ç¨‹å’Œé”çš„æ”¯æŒï¼Œè€Œ threading  ä¾›äº†æ›´é«˜çº§åˆ«ï¼ŒåŠŸèƒ½æ›´å¼ºçš„çº¿ç¨‹ç®¡ç†çš„åŠŸèƒ½ã€‚Queue æ¨¡å—å…è®¸ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¯ä»¥ç”¨äºå¤šä¸ªçº¿ç¨‹ä¹‹é—´ å…±äº«æ•°æ®çš„é˜Ÿåˆ—æ•°æ®ç»“æ„ã€‚\n\n##### æ ¸å¿ƒ ç¤º:é¿å…ä½¿ç”¨ thread æ¨¡å—\n\nå‡ºäºä»¥ä¸‹å‡ ç‚¹è€ƒè™‘ï¼Œæˆ‘ä»¬ä¸å»ºè®®æ‚¨ä½¿ç”¨ thread æ¨¡å—ã€‚\n\n1. æ›´é«˜çº§åˆ«çš„ threading æ¨¡å—æ›´ä¸ºå…ˆ è¿›ï¼Œå¯¹çº¿ç¨‹çš„æ”¯æŒæ›´ä¸ºå®Œå–„ï¼Œè€Œä¸”ä½¿ç”¨ thread æ¨¡å—é‡Œçš„å±æ€§æœ‰å¯èƒ½ä¼šä¸ threading å‡ºç°å†²çªã€‚å…¶æ¬¡ï¼Œ ä½çº§åˆ«çš„ thread æ¨¡å—çš„åŒæ­¥åŸè¯­å¾ˆå°‘(å®é™…ä¸Šåªæœ‰ä¸€ä¸ª)ï¼Œè€Œ threading æ¨¡å—åˆ™æœ‰å¾ˆå¤šã€‚\n2. å¯¹äºä½ çš„è¿›ç¨‹ä»€ä¹ˆæ—¶å€™åº”è¯¥ç»“æŸå®Œå…¨æ²¡æœ‰æ§åˆ¶ï¼Œå½“ä¸»çº¿ç¨‹ç»“æŸ æ—¶ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šè¢«å¼ºåˆ¶ç»“æŸæ‰ï¼Œæ²¡æœ‰è­¦å‘Šä¹Ÿä¸ä¼šæœ‰æ­£å¸¸çš„æ¸…é™¤å·¥ä½œã€‚æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œè‡³å°‘ threading æ¨¡å—èƒ½ç¡®ä¿é‡è¦çš„å­çº¿ç¨‹é€€å‡ºåè¿›ç¨‹æ‰é€€å‡ºã€‚\n\n\n## thread æ¨¡å—\n\né™¤äº†äº§ç”Ÿçº¿ç¨‹å¤–ï¼Œthread æ¨¡å—ä¹Ÿæä¾›äº†åŸºæœ¬çš„åŒæ­¥æ•° æ®ç»“æ„é”å¯¹è±¡(lock objectï¼Œä¹Ÿå«åŸè¯­é”ï¼Œç®€å•é”ï¼Œäº’æ–¥é”ï¼Œäº’æ–¥é‡ï¼ŒäºŒå€¼ä¿¡å·é‡)ã€‚\n\nthread æ¨¡å—å‡½æ•°\n\n* start_new_thread(function, args, kwargs=None)ï¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­ç”¨æŒ‡å®šçš„å‚æ•°å’Œå¯é€‰çš„ kwargs æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚\n* allocate_lock()ï¼šåˆ†é…ä¸€ä¸ª LockType ç±»å‹çš„é”å¯¹è±¡\n* exit()ï¼šè®©çº¿ç¨‹é€€å‡º\n* acquire(wait=None)ï¼šå°è¯•è·å–é”å¯¹è±¡\n* locked()ï¼šå¦‚æœè·å–äº†é”å¯¹è±¡è¿”å› Trueï¼Œå¦åˆ™è¿”å› False\n* release()ï¼šé‡Šæ”¾é”\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ thread çš„ä¾‹å­ï¼š\n\n``` python\nimport thread\nfrom time import sleep, time\n\n\ndef loop(num):\n    print('start loop at:', time())\n    sleep(num)\n    print('loop done at:', time())\n\n\ndef loop1(num):\n    print('start loop 1 at:', time())\n    sleep(num)\n    print('loop 1 done at:', time())\n\n\ndef main():\n    print('starting at:', time())\n    thread.start_new_thread(loop, (4,))\n    thread.start_new_thread(loop1, (5,))\n    sleep(6)\n    print('all DONE at:', time())\n\nif __name__ == '__main__':\n    main()\n\n('starting at:', 1489387024.886667)\n('start loop at:', 1489387024.88705)\n('start loop 1 at:', 1489387024.887277)\n('loop done at:', 1489387028.888182)\n('loop 1 done at:', 1489387029.888904)\n('all DONE at:', 1489387030.889918)\n```\n\nstart_new_thread()è¦æ±‚ä¸€å®šè¦æœ‰å‰ä¸¤ä¸ªå‚æ•°ã€‚æ‰€ä»¥ï¼Œå°±ç®—æˆ‘ä»¬æƒ³è¦è¿è¡Œçš„å‡½æ•°ä¸è¦å‚æ•°ï¼Œä¹Ÿè¦ä¼ ä¸€ä¸ªç©ºçš„å…ƒç»„ã€‚\nä¸ºä»€ä¹ˆè¦åŠ ä¸Šsleep(6)è¿™ä¸€å¥å‘¢? å› ä¸ºï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è®©ä¸»çº¿ç¨‹åœä¸‹æ¥ï¼Œé‚£ä¸»çº¿ç¨‹å°±ä¼šè¿è¡Œä¸‹ä¸€æ¡è¯­å¥ï¼Œæ˜¾ç¤º â€œall doneâ€ï¼Œç„¶åå°±å…³é—­è¿è¡Œç€ loop()å’Œ loop1()çš„ä¸¤ä¸ªçº¿ç¨‹ï¼Œé€€å‡ºäº†ã€‚\n\næˆ‘ä»¬æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•æ›¿æ¢ä½¿ç”¨sleep() è¿™ç§ä¸é è°±çš„åŒæ­¥æ–¹å¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨é”ï¼Œä½¿ç”¨äº†é”ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸¤ä¸ªçº¿ç¨‹éƒ½é€€å‡ºä¹‹åé©¬ä¸Šé€€å‡ºã€‚\n\n\n``` python\n#! -*- coding: utf-8 -*-\n\nimport thread\nfrom time import sleep, time\n\nloops = [4, 2]\n\ndef loop(nloop, nsec, lock):\n    print('start loop %s at: %s' % (nloop, time()))\n    sleep(nsec)\n    print('loop %s done at: %s' % (nloop, time()))\n    # æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªäº‹å…ˆå·²ç»è·å¾—çš„é”ï¼Œåœ¨ sleep()çš„æ—¶é—´åˆ°äº†ä¹‹åå°±é‡Šæ”¾ ç›¸åº”çš„é”ä»¥é€šçŸ¥ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å·²ç»ç»“æŸäº†ã€‚\n    lock.release()\n\n\ndef main():\n    print('starting at:', time())\n    locks = []\n    nloops = range(len(loops))\n\n    for i in nloops:\n        # è°ƒç”¨ thread.allocate_lock()å‡½æ•°åˆ›å»ºä¸€ä¸ªé”çš„åˆ—è¡¨\n        lock = thread.allocate_lock()\n        # åˆ†åˆ«è°ƒç”¨å„ä¸ªé”çš„ acquire()å‡½æ•°è·å¾—, è·å¾—é”è¡¨ç¤ºâ€œæŠŠé”é”ä¸Šâ€\n        lock.acquire()\n        locks.append(lock)\n\n    for i in nloops:\n        # åˆ›å»ºçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ç”¨å„è‡ªçš„å¾ªç¯å·ï¼Œç¡çœ æ—¶é—´å’Œé”ä¸ºå‚æ•°å»è°ƒç”¨ loop()å‡½æ•°\n        thread.start_new_thread(loop, (i, loops[i], locks[i]))\n\n    for i in nloops:\n        # åœ¨çº¿ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œçº¿ç¨‹è¦è‡ªå·±å»åšè§£é”æ“ä½œ\n        # å½“å‰å¾ªç¯åªæ˜¯ååœ¨é‚£ä¸€ç›´ç­‰(è¾¾åˆ°æš‚åœä¸» çº¿ç¨‹çš„ç›®çš„)ï¼Œç›´åˆ°ä¸¤ä¸ªé”éƒ½è¢«è§£é”ä¸ºæ­¢æ‰ç»§ç»­è¿è¡Œã€‚\n        while locks[i].locked(): pass\n\n    print('all DONE at:', time())\n\nif __name__ == '__main__':\n    main()\n\n```\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸åœ¨åˆ›å»ºé”çš„å¾ªç¯é‡Œåˆ›å»ºçº¿ç¨‹å‘¢?æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› :\n1. æˆ‘ä»¬æƒ³åˆ°å®ç°çº¿ç¨‹çš„åŒæ­¥ï¼Œæ‰€ä»¥è¦è®©â€œæ‰€æœ‰çš„é©¬åŒæ—¶å†²å‡ºæ …æ â€ã€‚\n2. è·å–é”è¦èŠ±ä¸€äº›æ—¶é—´ï¼Œå¦‚æœä½ çš„ çº¿ç¨‹é€€å‡ºå¾—â€œå¤ªå¿«â€ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¿˜æ²¡æœ‰è·å¾—é”ï¼Œçº¿ç¨‹å°±å·²ç»ç»“æŸäº†çš„æƒ…å†µã€‚\n\n## threading æ¨¡å—\n\nthreading æ¨¡å—ä¸ä»…æä¾›äº† Thread ç±»ï¼Œè¿˜æä¾›äº†å„ç§éå¸¸å¥½ç”¨çš„åŒæ­¥æœºåˆ¶ã€‚\n\nä¸‹é¢æ˜¯threading æ¨¡å—é‡Œæ‰€æœ‰çš„å¯¹è±¡ï¼š\n\n1. Threadï¼š è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œçš„å¯¹è±¡\n2. Lockï¼š é”åŸè¯­å¯¹è±¡(è·Ÿ thread æ¨¡å—é‡Œçš„é”å¯¹è±¡ç›¸åŒ)\n3. RLockï¼š å¯é‡å…¥é”å¯¹è±¡ã€‚ä½¿å•çº¿ç¨‹å¯ä»¥å†æ¬¡è·å¾—å·²ç»è·å¾—äº†çš„é”(é€’å½’é”å®š)ã€‚\n4. Conditionï¼š æ¡ä»¶å˜é‡å¯¹è±¡èƒ½è®©ä¸€ä¸ªçº¿ç¨‹åœä¸‹æ¥ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹æ»¡è¶³äº†æŸä¸ªâ€œæ¡ä»¶â€ã€‚ å¦‚ï¼ŒçŠ¶æ€çš„æ”¹å˜æˆ–å€¼çš„æ”¹å˜ã€‚\n5. Eventï¼š é€šç”¨çš„æ¡ä»¶å˜é‡ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‘ç”Ÿï¼Œåœ¨äº‹ä»¶å‘ç”Ÿåï¼Œ æ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šè¢«æ¿€æ´»ã€‚\n6. Semaphoreï¼š ä¸ºç­‰å¾…é”çš„çº¿ç¨‹ ä¾›ä¸€ä¸ªç±»ä¼¼â€œç­‰å€™å®¤â€çš„ç»“æ„\n7. BoundedSemaphoreï¼š ä¸ Semaphore ç±»ä¼¼ï¼Œåªæ˜¯å®ƒä¸å…è®¸è¶…è¿‡åˆå§‹å€¼\n8. Timerï¼š ä¸ Thread ç›¸ä¼¼ï¼Œåªæ˜¯ï¼Œå®ƒè¦ç­‰å¾…ä¸€æ®µæ—¶é—´åæ‰å¼€å§‹è¿è¡Œã€‚\n\n#### å®ˆæŠ¤çº¿ç¨‹\n\nå¦ä¸€ä¸ªé¿å…ä½¿ç”¨ thread æ¨¡å—çš„åŸå› æ˜¯ï¼Œå®ƒä¸æ”¯æŒå®ˆæŠ¤çº¿ç¨‹ã€‚å½“ä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œæ‰€æœ‰çš„å­çº¿ç¨‹ä¸ è®ºå®ƒä»¬æ˜¯å¦è¿˜åœ¨å·¥ä½œï¼Œéƒ½ä¼šè¢«å¼ºè¡Œé€€å‡ºã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æœŸæœ›è¿™ç§è¡Œä¸ºï¼Œè¿™æ—¶ï¼Œå°±å¼•å…¥äº†å®ˆæŠ¤çº¿ç¨‹ çš„æ¦‚å¿µ\nthreading æ¨¡å—æ”¯æŒå®ˆæŠ¤çº¿ç¨‹ï¼Œå®ƒä»¬æ˜¯è¿™æ ·å·¥ä½œçš„:å®ˆæŠ¤çº¿ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªç­‰å¾…å®¢æˆ·è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œ å¦‚æœæ²¡æœ‰å®¢æˆ· å‡ºè¯·æ±‚ï¼Œå®ƒå°±åœ¨é‚£ç­‰ç€ã€‚å¦‚æœä½ è®¾å®šä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå°±è¡¨ç¤ºä½ åœ¨è¯´è¿™ä¸ªçº¿ç¨‹ æ˜¯ä¸é‡è¦çš„ï¼Œåœ¨è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œä¸ç”¨ç­‰å¾…è¿™ä¸ªçº¿ç¨‹é€€å‡ºã€‚\nå¦‚æœä½ çš„ä¸»çº¿ç¨‹è¦é€€å‡ºçš„æ—¶å€™ï¼Œä¸ç”¨ç­‰å¾…é‚£äº›å­çº¿ç¨‹å®Œæˆï¼Œé‚£å°±è®¾å®šè¿™äº›çº¿ç¨‹çš„ daemon å±æ€§ã€‚ å³ï¼Œåœ¨çº¿ç¨‹å¼€å§‹(è°ƒç”¨ thread.start())ä¹‹å‰ï¼Œè°ƒç”¨ setDaemon()å‡½æ•°è®¾å®šçº¿ç¨‹çš„ daemon æ ‡å¿— (thread.setDaemon(True))å°±è¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹â€œä¸é‡è¦â€\nå¦‚æœä½ æƒ³è¦ç­‰å¾…å­çº¿ç¨‹å®Œæˆå†é€€å‡ºï¼Œé‚£å°±ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œæˆ–è€…æ˜¾å¼åœ°è°ƒç”¨ thread.setDaemon(False)ä»¥ä¿è¯å…¶ daemon æ ‡å¿—ä¸º Falseã€‚ä½ å¯ä»¥è°ƒç”¨ thread.isDaemon()å‡½æ•°æ¥åˆ¤ æ–­å…¶ daemon æ ‡å¿—çš„å€¼ã€‚æ–°çš„å­çº¿ç¨‹ä¼šç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ daemon æ ‡å¿—ã€‚æ•´ä¸ª Python ä¼šåœ¨æ‰€æœ‰çš„éå®ˆæŠ¤ çº¿ç¨‹é€€å‡ºåæ‰ä¼šç»“æŸ,å³è¿›ç¨‹ä¸­æ²¡æœ‰éå®ˆæŠ¤çº¿ç¨‹å­˜åœ¨çš„æ—¶å€™æ‰ç»“æŸã€‚\n\n### Thread ç±»\n\nThreadç±»æä¾›äº†ä»¥ä¸‹æ–¹æ³•:\n\n* run(): ç”¨ä»¥è¡¨ç¤ºçº¿ç¨‹æ´»åŠ¨çš„æ–¹æ³•ã€‚\n* start():å¯åŠ¨çº¿ç¨‹æ´»åŠ¨ã€‚\n* join([time]): ç­‰å¾…è‡³çº¿ç¨‹ä¸­æ­¢ã€‚è¿™é˜»å¡è°ƒç”¨çº¿ç¨‹ç›´è‡³çº¿ç¨‹çš„join() æ–¹æ³•è¢«è°ƒç”¨ä¸­æ­¢-æ­£å¸¸é€€å‡ºæˆ–è€…æŠ›å‡ºæœªå¤„ç†çš„å¼‚å¸¸-æˆ–è€…æ˜¯å¯é€‰çš„è¶…æ—¶å‘ç”Ÿã€‚\n* is_alive(): è¿”å›çº¿ç¨‹æ˜¯å¦æ´»åŠ¨çš„ã€‚\n* name(): è®¾ç½®/è¿”å›çº¿ç¨‹åã€‚\n* daemon(): è¿”å›/è®¾ç½®çº¿ç¨‹çš„ daemon æ ‡å¿—ï¼Œä¸€å®šè¦åœ¨è°ƒç”¨ start()å‡½æ•°å‰è®¾ç½®\n\nç”¨ Thread ç±»ï¼Œä½ å¯ä»¥ç”¨å¤šç§æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä»‹ç»ä¸‰ç§æ¯”è¾ƒç›¸åƒçš„æ–¹æ³•ã€‚\n\n* åˆ›å»ºä¸€ä¸ªThreadçš„å®ä¾‹ï¼Œä¼ ç»™å®ƒä¸€ä¸ªå‡½æ•°\n* åˆ›å»ºä¸€ä¸ªThreadçš„å®ä¾‹ï¼Œä¼ ç»™å®ƒä¸€ä¸ªå¯è°ƒç”¨çš„ç±»å¯¹è±¡\n* ä»Threadæ´¾ç”Ÿå‡ºä¸€ä¸ªå­ç±»ï¼Œåˆ›å»ºä¸€ä¸ªè¿™ä¸ªå­ç±»çš„å®ä¾‹\n\nä¸‹è¾¹æ˜¯ä¸‰ç§ä¸åŒæ–¹å¼çš„åˆ›å»ºçº¿ç¨‹çš„ç¤ºä¾‹ï¼š\n\n```python\n#! -*- coding: utf-8 -*-\n\n# åˆ›å»ºä¸€ä¸ªThreadçš„å®ä¾‹ï¼Œä¼ ç»™å®ƒä¸€ä¸ªå‡½æ•°\n\nimport threading\nfrom time import sleep, time\n\nloops = [4, 2]\n\ndef loop(nloop, nsec, lock):\n    print('start loop %s at: %s' % (nloop, time()))\n    sleep(nsec)\n    print('loop %s done at: %s' % (nloop, time()))\n    # æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªäº‹å…ˆå·²ç»è·å¾—çš„é”ï¼Œåœ¨ sleep()çš„æ—¶é—´åˆ°äº†ä¹‹åå°±é‡Šæ”¾ ç›¸åº”çš„é”ä»¥é€šçŸ¥ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å·²ç»ç»“æŸäº†ã€‚\n\n\ndef main():\n    print('starting at:', time())\n    threads = []\n    nloops = range(len(loops))\n\n    for i in nloops:\n        t = threading.Thread(target=loop, args=(i, loops[i]))\n        threads.append(t)\n\n    for i in nloops:\n        # start threads\n        threads[i].start()\n\n    for i in nloops:\n        # wait for all\n        # join()ä¼šç­‰åˆ°çº¿ç¨‹ç»“æŸï¼Œæˆ–è€…åœ¨ç»™äº† timeout å‚æ•°çš„æ—¶å€™ï¼Œç­‰åˆ°è¶…æ—¶ä¸ºæ­¢ã€‚\n        # ä½¿ç”¨ join()çœ‹ä¸Šå» ä¼šæ¯”ä½¿ç”¨ä¸€ä¸ªç­‰å¾…é”é‡Šæ”¾çš„æ— é™å¾ªç¯æ¸…æ¥šä¸€äº›(è¿™ç§é”ä¹Ÿè¢«ç§°ä¸º\"spinlock\")\n        threads[i].join()  # threads to finish\n\n    print('all DONE at:', time())\n\nif __name__ == '__main__':\n    main()\n```\nä¸ä¼ ä¸€ä¸ªå‡½æ•°å¾ˆç›¸ä¼¼çš„å¦ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ï¼Œä¼ ä¸€ä¸ªå¯è°ƒç”¨çš„ç±»çš„å®ä¾‹ä¾›çº¿ç¨‹å¯åŠ¨ çš„æ—¶å€™æ‰§è¡Œâ€”â€”è¿™æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¸€ä¸ªæ›´ä¸ºé¢å‘å¯¹è±¡çš„æ–¹æ³•ã€‚ç›¸å¯¹äºä¸€ä¸ªæˆ–å‡ ä¸ªå‡½æ•°æ¥è¯´ï¼Œç”±äºç±» å¯¹è±¡é‡Œå¯ä»¥ä½¿ç”¨ç±»çš„å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¿å­˜æ›´å¤šçš„ä¿¡æ¯ï¼Œè¿™ç§æ–¹æ³•æ›´ä¸ºçµæ´»\n\n```python\n#! -*- coding: utf-8 -*-\n\n# åˆ›å»ºä¸€ä¸ª Thread çš„å®ä¾‹ï¼Œä¼ ç»™å®ƒä¸€ä¸ªå¯è°ƒç”¨çš„ç±»å¯¹è±¡\n\nfrom threading import Thread\nfrom time import sleep, time\n\n\nloops = [4, 2]\n\n\nclass ThreadFunc(object):\n\n    def __init__(self, func, args, name=\"\"):\n        self.name = name\n        self.func = func\n        self.args = args\n\n    def __call__(self):\n        # åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ï¼ŒThread å¯¹è±¡ä¼šè°ƒç”¨æˆ‘ä»¬çš„ ThreadFunc å¯¹è±¡ï¼Œè¿™æ—¶ä¼šç”¨åˆ°ä¸€ä¸ªç‰¹æ®Šå‡½æ•° __call__()ã€‚\n        self.func(*self.args)\n\n\ndef loop(nloop, nsec):\n    print('start loop %s at: %s' % (nloop, time()))\n    sleep(nsec)\n    print('loop %s done at: %s' % (nloop, time()))\n\n\ndef main():\n    print('starting at:', time())\n    threads = []\n    nloops = range(len(loops))\n\n    for i in nloops:\n        t = Thread(target=ThreadFunc(loop, (i, loops[i]), loop.__name__))\n        threads.append(t)\n\n    for i in nloops:\n        # start threads\n        threads[i].start()\n\n    for i in nloops:\n        # wait for all\n        # join()ä¼šç­‰åˆ°çº¿ç¨‹ç»“æŸï¼Œæˆ–è€…åœ¨ç»™äº† timeout å‚æ•°çš„æ—¶å€™ï¼Œç­‰åˆ°è¶…æ—¶ä¸ºæ­¢ã€‚\n        # ä½¿ç”¨ join()çœ‹ä¸Šå» ä¼šæ¯”ä½¿ç”¨ä¸€ä¸ªç­‰å¾…é”é‡Šæ”¾çš„æ— é™å¾ªç¯æ¸…æ¥šä¸€äº›(è¿™ç§é”ä¹Ÿè¢«ç§°ä¸º\"spinlock\")\n        threads[i].join()  # threads to finish\n\n    print('all DONE at:', time())\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\næœ€åä¸€ä¸ªä¾‹å­ä»‹ç»å¦‚ä½•å­ç±»åŒ– Thread ç±»ï¼Œè¿™ä¸ä¸Šä¸€ä¸ªä¾‹å­ä¸­çš„åˆ›å»ºä¸€ä¸ªå¯è°ƒç”¨çš„ç±»éå¸¸åƒã€‚ä½¿ç”¨å­ç±»åŒ–åˆ›å»ºçº¿ç¨‹(ç¬¬ 29-30 è¡Œ)ä½¿ä»£ç çœ‹ä¸Šå»æ›´æ¸…æ™°æ˜äº†ã€‚\n\n```python\n#! -*- coding: utf-8 -*-\n\n# åˆ›å»ºä¸€ä¸ª Thread çš„å®ä¾‹ï¼Œä¼ ç»™å®ƒä¸€ä¸ªå¯è°ƒç”¨çš„ç±»å¯¹è±¡\n\nfrom threading import Thread\nfrom time import sleep, time\n\n\nloops = [4, 2]\n\n\nclass MyThread(Thread):\n\n    def __init__(self, func, args, name=\"\"):\n        super(MyThread, self).__init__()\n        self.name = name\n        self.func = func\n        self.args = args\n\n    def getResult(self):\n        return self.res\n\n    def run(self):\n        # åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ï¼ŒThread å¯¹è±¡ä¼šè°ƒç”¨æˆ‘ä»¬çš„ ThreadFunc å¯¹è±¡ï¼Œè¿™æ—¶ä¼šç”¨åˆ°ä¸€ä¸ªç‰¹æ®Šå‡½æ•° __call__()ã€‚\n        print 'starting', self.name, 'at:', time()\n        self.res = self.func(*self.args)\n        print self.name, 'finished at:', time()\n\n\n\ndef loop(nloop, nsec):\n    print('start loop %s at: %s' % (nloop, time()))\n    sleep(nsec)\n    print('loop %s done at: %s' % (nloop, time()))\n\n\ndef main():\n    print('starting at:', time())\n    threads = []\n    nloops = range(len(loops))\n\n    for i in nloops:\n        t = MyThread(loop, (i, loops[i]), loop.__name__)\n        threads.append(t)\n\n    for i in nloops:\n        # start threads\n        threads[i].start()\n\n    for i in nloops:\n        # wait for all\n        # join()ä¼šç­‰åˆ°çº¿ç¨‹ç»“æŸï¼Œæˆ–è€…åœ¨ç»™äº† timeout å‚æ•°çš„æ—¶å€™ï¼Œç­‰åˆ°è¶…æ—¶ä¸ºæ­¢ã€‚\n        # ä½¿ç”¨ join()çœ‹ä¸Šå» ä¼šæ¯”ä½¿ç”¨ä¸€ä¸ªç­‰å¾…é”é‡Šæ”¾çš„æ— é™å¾ªç¯æ¸…æ¥šä¸€äº›(è¿™ç§é”ä¹Ÿè¢«ç§°ä¸º\"spinlock\")\n        threads[i].join()  # threads to finish\n\n    print('all DONE at:', time())\n\n\nif __name__ == '__main__':\n    main()\n\n```\n\n#### ä¸‹è½½å›½æ——çš„ä¾‹å­\n\nä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æˆ‘ä»¬ä¹‹å‰æŒ‰ä¹‹å‰å¹¶å‘çš„å¥—è·¯ï¼Œç”¨å®ç°ä¸€ä¸‹ä½¿ç”¨ threading å¹¶å‘ä¸‹è½½å›½æ——\n\n```python\n# python3\n\nimport threading\nfrom threading import Thread\n\nfrom flags import save_flag, show, main, get_flag\n\n\nclass MyThread(Thread):\n\n    def __init__(self, func, args, name=\"\"):\n        super(MyThread, self).__init__()\n        self.name = name\n        self.func = func\n        self.args = args\n\n    def getResult(self):\n        return self.res\n\n    def run(self):\n        # åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ï¼ŒThread å¯¹è±¡ä¼šè°ƒç”¨æˆ‘ä»¬çš„ ThreadFunc å¯¹è±¡ï¼Œè¿™æ—¶ä¼šç”¨åˆ°ä¸€ä¸ªç‰¹æ®Šå‡½æ•° __call__()ã€‚\n        self.res = self.func(*self.args)\n\n\ndef download_one(cc):  # <3>\n    image = get_flag(cc)\n    show(cc)\n    save_flag(image, cc.lower() + '.gif')\n    return cc\n\n\ndef download_many(cc_list):\n    threads = []\n    for cc in cc_list:\n        thread = MyThread(download_one, (cc, ), download_one.__name__)\n        threads.append(thread)\n\n    for thread in threads:\n        # å¯åŠ¨çº¿ç¨‹\n        thread.start()\n\n    for thread in threads:\n        # wait for all\n        # join()ä¼šç­‰åˆ°çº¿ç¨‹ç»“æŸï¼Œæˆ–è€…åœ¨ç»™äº† timeout å‚æ•°çš„æ—¶å€™ï¼Œç­‰åˆ°è¶…æ—¶ä¸ºæ­¢ã€‚\n        # ä½¿ç”¨ join()çœ‹ä¸Šå» ä¼šæ¯”ä½¿ç”¨ä¸€ä¸ªç­‰å¾…é”é‡Šæ”¾çš„æ— é™å¾ªç¯æ¸…æ¥šä¸€äº›(è¿™ç§é”ä¹Ÿè¢«ç§°ä¸º\"spinlock\")\n        thread.join()\n\n    return len(list(threads))  # <7>\n\n\nif __name__ == '__main__':\n    main(download_many)\n```\n\næ‰§è¡Œä»£ç å‘ç°å’Œä½¿ç”¨åç¨‹ç›¸æ¯”é€Ÿåº¦åŸºæœ¬ä¸€è‡´ã€‚\n\né™¤äº†å„ç§åŒæ­¥å¯¹è±¡å’Œçº¿ç¨‹å¯¹è±¡å¤–ï¼Œthreading æ¨¡å—è¿˜ ä¾›äº†ä¸€äº›å‡½æ•°ã€‚\n\n* active_count(): å½“å‰æ´»åŠ¨çš„çº¿ç¨‹å¯¹è±¡çš„æ•°é‡\n* current_thread(): è¿”å›å½“å‰çº¿ç¨‹å¯¹è±¡\n* enumerate(): è¿”å›å½“å‰æ´»åŠ¨çº¿ç¨‹çš„åˆ—è¡¨\n* settrace(func): ä¸ºæ‰€æœ‰çº¿ç¨‹è®¾ç½®ä¸€ä¸ªè·Ÿè¸ªå‡½æ•°\n* setprofile(func): ä¸ºæ‰€æœ‰çº¿ç¨‹è®¾ç½®ä¸€ä¸ª profile å‡½æ•°\n\n### Lock & RLock\n\nåŸè¯­é”å®šæ˜¯ä¸€ä¸ªåŒæ­¥åŸè¯­ï¼ŒçŠ¶æ€æ˜¯é”å®šæˆ–æœªé”å®šã€‚ä¸¤ä¸ªæ–¹æ³•acquire()å’Œrelease() ç”¨äºåŠ é”å’Œé‡Šæ”¾é”ã€‚\nRLock å¯é‡å…¥é”æ˜¯ä¸€ä¸ªç±»ä¼¼äºLockå¯¹è±¡çš„åŒæ­¥åŸè¯­ï¼Œä½†åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è°ƒç”¨ã€‚\n\nLock ä¸æ”¯æŒé€’å½’åŠ é”ï¼Œä¹Ÿå°±æ˜¯è¯´å³ä¾¿åœ¨åŒ çº¿ç¨‹ä¸­ï¼Œä¹Ÿå¿…é¡»ç­‰å¾…é”é‡Šæ”¾ã€‚é€šå¸¸å»ºè®®æ”¹  RLockï¼Œ å®ƒä¼šå¤„ç† \"owning thread\" å’Œ \"recursion level\" çŠ¶æ€ï¼Œå¯¹äºåŒ çº¿ç¨‹çš„å¤šæ¬¡è¯·æ±‚é” ä¸ºï¼Œåªç´¯åŠ \nè®¡æ•°å™¨ã€‚æ¯æ¬¡è°ƒ release() å°†é€’å‡è¯¥è®¡æ•°å™¨ï¼Œç›´åˆ° 0 æ—¶é‡Šæ”¾é”ï¼Œå› æ­¤ acquire() å’Œ release() å¿…é¡» è¦æˆå¯¹å‡ºç°ã€‚\n\n```python\n\nfrom time import sleep\nfrom threading import current_thread, Thread\n\nlock = Rlock()\n\ndef show():\n    with lock:\n        print current_thread().name, i\n        sleep(0.1)\n\ndef test():\n    with lock:\n        for i in range(3):\n            show(i)\n\nfor i in range(2):\n    Thread(target=test).start()\n```\n\n### Event\n\näº‹ä»¶ç”¨äºåœ¨çº¿ç¨‹é—´é€šä¿¡ã€‚ä¸€ä¸ªçº¿ç¨‹å‘å‡ºä¸€ä¸ªä¿¡å·ï¼Œå…¶ä»–ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ã€‚\nEvent é€šè¿‡é€šè¿‡ ä¸ªå†…éƒ¨æ ‡è®°æ¥åè°ƒå¤šçº¿ç¨‹è¿ ã€‚ æ³• wait() é˜»å¡çº¿ç¨‹æ‰§ ï¼Œç›´åˆ°æ ‡è®°ä¸º Trueã€‚ set() å°†æ ‡è®°è®¾ä¸º Trueï¼Œclear() æ›´æ”¹æ ‡è®°ä¸º Falseã€‚isSet() ç”¨äºåˆ¤æ–­æ ‡è®°çŠ¶æ€ã€‚\n\n```python\nfrom threading import Event\n\ndef test_event():\n    e = Event()\n    def test():\n        for i in range(5):\n            print 'start wait'\n            e.wait()\n            e.clear()  # å¦‚æœä¸è°ƒç”¨clear()ï¼Œé‚£ä¹ˆæ ‡è®°ä¸€ç›´ä¸º Trueï¼Œwait()å°±ä¸ä¼šå‘ç”Ÿé˜»å¡è¡Œä¸º\n            print i\nThread(target=test).start()\nreturn e\n\n\ne = test_event()\n```\n\n### Condition\n\næ¡ä»¶å˜é‡å’Œ Lock å‚æ•°ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŒæ­¥åŸè¯­ï¼Œå½“éœ€è¦çº¿ç¨‹å…³æ³¨ç‰¹å®šçš„çŠ¶æ€å˜åŒ–æˆ–äº‹ä»¶çš„å‘ç”Ÿæ—¶ä½¿ç”¨è¿™ä¸ªé”å®šã€‚\n\nå¯ä»¥è®¤ä¸ºï¼Œé™¤äº†Lockå¸¦æœ‰çš„é”å®šæ± å¤–ï¼ŒConditionè¿˜åŒ…å«ä¸€ä¸ªç­‰å¾…æ± ï¼Œæ± ä¸­çš„çº¿ç¨‹å¤„äºçŠ¶æ€å›¾ä¸­çš„ç­‰å¾…é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notify()/notifyAll()é€šçŸ¥ï¼›å¾—åˆ°é€šçŸ¥åçº¿ç¨‹è¿›å…¥é”å®šæ± ç­‰å¾…é”å®šã€‚\n\næ„é€ æ–¹æ³•ï¼š\nCondition([lock/rlock])\n\nCondition æœ‰ä»¥ä¸‹è¿™äº›æ–¹æ³•ï¼š\n* acquire([timeout])/release(): è°ƒç”¨å…³è”çš„é”çš„ç›¸åº”æ–¹æ³•ã€‚\n* wait([timeout]): è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°†ä½¿çº¿ç¨‹è¿›å…¥Conditionçš„ç­‰å¾…æ± ç­‰å¾…é€šçŸ¥ï¼Œå¹¶é‡Šæ”¾é”ã€‚ä½¿ç”¨å‰çº¿ç¨‹å¿…é¡»å·²è·å¾—é”å®šï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚\n* notify(): è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°†ä»ç­‰å¾…æ± æŒ‘é€‰ä¸€ä¸ªçº¿ç¨‹å¹¶é€šçŸ¥ï¼Œæ”¶åˆ°é€šçŸ¥çš„çº¿ç¨‹å°†è‡ªåŠ¨è°ƒç”¨acquire()å°è¯•è·å¾—é”å®šï¼ˆè¿›å…¥é”å®šæ± ï¼‰ï¼›å…¶ä»–çº¿ç¨‹ä»ç„¶åœ¨ç­‰å¾…æ± ä¸­ã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¸ä¼šé‡Šæ”¾é”å®šã€‚ä½¿ç”¨å‰çº¿ç¨‹å¿…é¡»å·²è·å¾—é”å®šï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚\n* notifyAll(): è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°†é€šçŸ¥ç­‰å¾…æ± ä¸­æ‰€æœ‰çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹éƒ½å°†è¿›å…¥é”å®šæ± å°è¯•è·å¾—é”å®šã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¸ä¼šé‡Šæ”¾é”å®šã€‚ä½¿ç”¨å‰çº¿ç¨‹å¿…é¡»å·²è·å¾—é”å®šï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚\n\n```python\nfrom threading import Condition, current_thread, Thread\n\ncon = Condition()\n\ndef tc1():\n    with con:\n        for i in range(5):\n            print current_thread().name, i\n            sleep(0.3)\n            if i == 3:\n                con.wait()\n\n\ndef tc2():\n    with con:\n        for i in range(5):\n            print current_thread().name, i\n            sleep(0.1)\n            con.notify()\n\nThread(target=tc1).start()\nThread(target=tc2).start()\n\nThread-1 0\nThread-1 1\nThread-1 2\nThread-1 3    # è®©å‡ºé”\nThread-2 0\nThread-2 1\nThread-2 2\nThread-2 3\nThread-2 4\nThread-1 4    # é‡æ–°è·å–é”ï¼Œç»§ç»­æ‰§\n\n```\n\nåªæœ‰è·å–é”çš„çº¿ç¨‹æ‰èƒ½è°ƒç”¨ wait() å’Œ notify()ï¼Œå› æ­¤å¿…é¡»åœ¨é”é‡Šæ”¾å‰è°ƒç”¨ã€‚\nå½“ wait() é‡Šæ”¾é”åï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿå¯è¿›å…¥ wait çŠ¶æ€ã€‚notifyAll() æ¿€æ´»æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œè®©å®ƒä»¬å»æŠ¢é”ç„¶åå®Œæˆåç»­æ‰§è¡Œã€‚\n\n\n### ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜å’Œ Queue æ¨¡å—\n\nç°åœ¨æˆ‘ä»¬ç”¨ä¸€ä¸ªç»å…¸çš„(ç”Ÿäº§è€…æ¶ˆè´¹è€…)ä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹ Queueæ¨¡å—ã€‚\n\nç”Ÿäº§è€…æ¶ˆè´¹è€…çš„åœºæ™¯æ˜¯ï¼š ç”Ÿäº§è€…ç”Ÿäº§è´§ç‰©ï¼Œç„¶åæŠŠè´§ç‰©æ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¹‹ç±»çš„æ•°æ®ç»“æ„ä¸­ï¼Œç”Ÿäº§è´§ç‰©æ‰€è¦èŠ±è´¹çš„æ—¶é—´æ— æ³•é¢„å…ˆç¡®å®šã€‚æ¶ˆè´¹è€…æ¶ˆè€—ç”Ÿäº§è€…ç”Ÿäº§çš„è´§ç‰©çš„æ—¶é—´ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ã€‚\n\nå¸¸ç”¨çš„ Queue æ¨¡å—çš„å±æ€§:\n\n* queue(size): åˆ›å»ºä¸€ä¸ªå¤§å°ä¸ºsizeçš„Queueå¯¹è±¡ã€‚\n* qsize(): è¿”å›é˜Ÿåˆ—çš„å¤§å°(ç”±äºåœ¨è¿”å›çš„æ—¶å€™ï¼Œé˜Ÿåˆ—å¯èƒ½ä¼šè¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼æ˜¯è¿‘ä¼¼å€¼)\n* empty(): å¦‚æœé˜Ÿåˆ—ä¸ºç©ºè¿”å› Trueï¼Œå¦åˆ™è¿”å› False\n* full(): å¦‚æœé˜Ÿåˆ—å·²æ»¡è¿”å› Trueï¼Œå¦åˆ™è¿”å› False\n* put(item,block=0): æŠŠitemæ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœç»™äº†block(ä¸ä¸º0)ï¼Œå‡½æ•°ä¼šä¸€ç›´é˜»å¡åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºé—´ä¸ºæ­¢\n* get(block=0): ä»é˜Ÿåˆ—ä¸­å–ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœç»™äº† block(ä¸ä¸º 0)ï¼Œå‡½æ•°ä¼šä¸€ç›´é˜»å¡åˆ°é˜Ÿåˆ—ä¸­æœ‰å¯¹è±¡ä¸ºæ­¢\n\nQueue æ¨¡å—å¯ä»¥ç”¨æ¥è¿›è¡Œçº¿ç¨‹é—´é€šè®¯ï¼Œè®©å„ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®ã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®© ç”Ÿäº§è€…(çº¿ç¨‹)æŠŠæ–°ç”Ÿäº§çš„è´§ç‰©æ”¾è¿›å»ä¾›æ¶ˆè´¹è€…(çº¿ç¨‹)ä½¿ç”¨ã€‚\n\n```python\n# python2\n#! -*- coding: utf-8 -*-\n\nfrom Queue import Queue\nfrom random import randint\nfrom time import sleep, time\nfrom threading import Thread\n\n\nclass MyThread(Thread):\n\n    def __init__(self, func, args, name=\"\"):\n        super(MyThread, self).__init__()\n        self.name = name\n        self.func = func\n        self.args = args\n\n    def getResult(self):\n        return self.res\n\n    def run(self):\n        # åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ï¼ŒThread å¯¹è±¡ä¼šè°ƒç”¨æˆ‘ä»¬çš„ ThreadFunc å¯¹è±¡ï¼Œè¿™æ—¶ä¼šç”¨åˆ°ä¸€ä¸ªç‰¹æ®Šå‡½æ•° __call__()ã€‚\n        print 'starting', self.name, 'at:', time()\n        self.res = self.func(*self.args)\n        print self.name, 'finished at:', time()\n\n\n# writeQ()å’Œ readQ()å‡½æ•°åˆ†åˆ«ç”¨æ¥æŠŠå¯¹è±¡æ”¾å…¥é˜Ÿåˆ—å’Œæ¶ˆè€—é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ å­—ç¬¦ä¸²'xxx'æ¥è¡¨ç¤ºé˜Ÿåˆ—ä¸­çš„å¯¹è±¡ã€‚\ndef writeQ(queue):\n    print 'producing object for Q...'\n    queue.put('xxx', 1)\n    print \"size now\", queue.qsize()\n\n\ndef readQ(queue):\n    queue.get(1)\n    print(\"consumed object from Q... size now\", queue.qsize())\n\n\ndef writer(queue, loops):\n    # writer()å‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œå°±æ˜¯ä¸€æ¬¡å¾€é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œç­‰å¾…ä¸€ä¼šï¼Œç„¶åå†åšåŒæ ·çš„äº‹\n    for i in range(loops):\n        writeQ(queue)\n        sleep(1)\n\n\ndef reader(queue, loops):\n    # reader()å‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œå°±æ˜¯ä¸€æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œç­‰å¾…ä¸€ä¼šï¼Œç„¶åå†åšåŒæ ·çš„äº‹\n    for i in range(loops):\n        readQ(queue)\n        sleep(randint(2, 5))\n\n\n# è®¾ç½®æœ‰å¤šå°‘ä¸ªçº¿ç¨‹è¦è¢«è¿è¡Œ\nfuncs = [writer, reader]\nnfuncs = range(len(funcs))\n\n\ndef main():\n    nloops = randint(10, 20)\n    q = Queue(32)\n    threads = []\n\n    for i in nfuncs:\n        t = MyThread(funcs[i], (q, nloops), funcs[i].__name__)\n        threads.append(t)\n\n    for i in nfuncs:\n        threads[i].start()\n\n    for i in nfuncs:\n        threads[i].join()\n        print threads[i].getResult()\n\n    print 'all DONE'\n\n\nif __name__ == '__main__':\n    main()\n```\n\n\n### FAQ\n\n##### è¿›ç¨‹ä¸çº¿ç¨‹ã€‚çº¿ç¨‹ä¸è¿›ç¨‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?\n\nè¿›ç¨‹(æœ‰æ—¶è¢«ç§°ä¸ºé‡é‡çº§è¿›ç¨‹)æ˜¯ç¨‹åºçš„ä¸€æ¬¡ æ‰§è¡Œã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œå†…å­˜ï¼Œæ•°æ®æ ˆä»¥åŠå…¶å®ƒè®°å½•å…¶è¿è¡Œè½¨è¿¹çš„è¾…åŠ©æ•°æ®ã€‚\nçº¿ç¨‹(æœ‰æ—¶è¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹)è·Ÿè¿›ç¨‹æœ‰äº›ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œæ‰€æœ‰çš„çº¿ç¨‹è¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œ å…±äº«ç›¸åŒçš„è¿è¡Œç¯å¢ƒã€‚å®ƒä»¬å¯ä»¥æƒ³åƒæˆæ˜¯åœ¨ä¸»è¿›ç¨‹æˆ–â€œä¸»çº¿ç¨‹â€ä¸­å¹¶è¡Œè¿è¡Œçš„â€œè¿·ä½ è¿›ç¨‹â€ã€‚\n\nè¿™ç¯‡æ–‡ç« å¾ˆå¥½çš„è§£é‡Šäº† çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Œæ¨èé˜…è¯»: http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html\n\n##### Python çš„çº¿ç¨‹ã€‚åœ¨ Python ä¸­ï¼Œå“ªä¸€ç§å¤šçº¿ç¨‹çš„ç¨‹åºè¡¨ç°å¾—æ›´å¥½ï¼ŒI/O å¯†é›†å‹çš„è¿˜æ˜¯è®¡ç®— å¯†é›†å‹çš„?\n\nç”±äºGILçš„ç¼˜æ•…ï¼Œå¯¹æ‰€æœ‰é¢å‘ I/O çš„(ä¼šè°ƒç”¨å†…å»ºçš„æ“ä½œç³»ç»Ÿ C ä»£ç çš„)ç¨‹åºæ¥è¯´ï¼ŒGIL ä¼šåœ¨è¿™ä¸ª I/O è°ƒç”¨ä¹‹ å‰è¢«é‡Šæ”¾ï¼Œä»¥å…è®¸å…¶å®ƒçš„çº¿ç¨‹åœ¨è¿™ä¸ªçº¿ç¨‹ç­‰å¾… I/O çš„æ—¶å€™è¿è¡Œã€‚å¦‚æœæŸçº¿ç¨‹å¹¶æœªä½¿ç”¨å¾ˆå¤š I/O æ“ä½œï¼Œ å®ƒä¼šåœ¨è‡ªå·±çš„æ—¶é—´ç‰‡å†…ä¸€ç›´å ç”¨å¤„ç†å™¨(å’Œ GIL)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒI/O å¯†é›†å‹çš„ Python ç¨‹åºæ¯”è®¡ç®—å¯†é›† å‹çš„ç¨‹åºæ›´èƒ½å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹ç¯å¢ƒçš„å¥½å¤„ã€‚\n\n##### çº¿ç¨‹ã€‚ä½ è®¤ä¸ºï¼Œå¤šCPU çš„ç³»ç»Ÿä¸ä¸€èˆ¬çš„ç³»ç»Ÿæœ‰ä»€ä¹ˆå¤§çš„ä¸åŒ?å¤šçº¿ç¨‹çš„ç¨‹åºåœ¨è¿™ç§ç³»ç»Ÿä¸Šçš„è¡¨ç°ä¼šæ€ä¹ˆæ ·?\n\nPythonçš„çº¿ç¨‹å°±æ˜¯Cè¯­è¨€çš„ä¸€ä¸ªpthreadï¼Œå¹¶é€šè¿‡æ“ä½œç³»ç»Ÿè°ƒåº¦ç®—æ³•è¿›è¡Œè°ƒåº¦ï¼ˆä¾‹å¦‚linuxæ˜¯CFSï¼‰ã€‚ä¸ºäº†è®©å„ä¸ªçº¿ç¨‹èƒ½å¤Ÿå¹³å‡åˆ©ç”¨CPUæ—¶é—´ï¼Œpythonä¼šè®¡ç®—å½“å‰å·²æ‰§è¡Œçš„å¾®ä»£ç æ•°é‡ï¼Œè¾¾åˆ°ä¸€å®šé˜ˆå€¼åå°±å¼ºåˆ¶é‡Šæ”¾GILã€‚è€Œè¿™æ—¶ä¹Ÿä¼šè§¦å‘ä¸€æ¬¡æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ï¼ˆå½“ç„¶æ˜¯å¦çœŸæ­£è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ç”±æ“ä½œç³»ç»Ÿè‡ªä¸»å†³å®šï¼‰ã€‚\nä¼ªä»£ç \n\n```python\nwhile True:\n    acquire GIL\n    for i in 1000:\n        do something\n    release GIL\n    /* Give Operating System a chance to do thread scheduling */\n```\n\nè¿™ç§æ¨¡å¼åœ¨åªæœ‰ä¸€ä¸ªCPUæ ¸å¿ƒçš„æƒ…å†µä¸‹æ¯«æ— é—®é¢˜ã€‚ä»»ä½•ä¸€ä¸ªçº¿ç¨‹è¢«å”¤èµ·æ—¶éƒ½èƒ½æˆåŠŸè·å¾—åˆ°GILï¼ˆå› ä¸ºåªæœ‰é‡Šæ”¾äº†GILæ‰ä¼šå¼•å‘çº¿ç¨‹è°ƒåº¦ï¼‰ã€‚\nä½†å½“CPUæœ‰å¤šä¸ªæ ¸å¿ƒçš„æ—¶å€™ï¼Œé—®é¢˜å°±æ¥äº†ã€‚ä»ä¼ªä»£ç å¯ä»¥çœ‹åˆ°ï¼Œä»release GILåˆ°acquire GILä¹‹é—´å‡ ä¹æ˜¯æ²¡æœ‰é—´éš™çš„ã€‚æ‰€ä»¥å½“å…¶ä»–åœ¨å…¶ä»–æ ¸å¿ƒä¸Šçš„çº¿ç¨‹è¢«å”¤é†’æ—¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸»çº¿ç¨‹å·²ç»åˆå†ä¸€æ¬¡è·å–åˆ°GILäº†ã€‚è¿™ä¸ªæ—¶å€™è¢«å”¤é†’æ‰§è¡Œçš„çº¿ç¨‹åªèƒ½ç™½ç™½çš„æµªè´¹CPUæ—¶é—´ï¼Œçœ‹ç€å¦ä¸€ä¸ªçº¿ç¨‹æ‹¿ç€GILæ¬¢å¿«çš„æ‰§è¡Œç€ã€‚ç„¶åè¾¾åˆ°åˆ‡æ¢æ—¶é—´åè¿›å…¥å¾…è°ƒåº¦çŠ¶æ€ï¼Œå†è¢«å”¤é†’ï¼Œå†ç­‰å¾…ï¼Œä»¥æ­¤å¾€å¤æ¶æ€§å¾ªç¯ã€‚\nç®€å•çš„æ€»ç»“ä¸‹å°±æ˜¯ï¼šPythonçš„å¤šçº¿ç¨‹åœ¨å¤šæ ¸CPUä¸Šï¼Œåªå¯¹äºIOå¯†é›†å‹è®¡ç®—äº§ç”Ÿæ­£é¢æ•ˆæœï¼›è€Œå½“æœ‰è‡³å°‘æœ‰ä¸€ä¸ªCPUå¯†é›†å‹çº¿ç¨‹å­˜åœ¨ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹æ•ˆç‡ä¼šç”±äºGILè€Œå¤§å¹…ä¸‹é™ã€‚\n\n##### çº¿ç¨‹æ± ã€‚ä¿®æ”¹ ç”Ÿæˆè€…æ¶ˆè´¹è€… çš„ä»£ç ï¼Œä¸å†æ˜¯ä¸€ä¸ªç”Ÿäº§è€…å’Œä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè€Œæ˜¯å¯ä»¥æœ‰ä»»æ„ä¸ª æ¶ˆè´¹è€…çº¿ç¨‹(ä¸€ä¸ªçº¿ç¨‹æ± )ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å¤„ç†æˆ–æ¶ˆè€—ä»»æ„å¤šä¸ªäº§å“ã€‚\n\n## å‚è€ƒæ–‡ç« \n\n* [è¿›ç¨‹ä¸çº¿ç¨‹çš„ä¸€ä¸ªç®€å•è§£é‡Š http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)\n* [Pythonçš„GILæ˜¯ä»€ä¹ˆé¬¼ï¼Œå¤šçº¿ç¨‹æ€§èƒ½ç©¶ç«Ÿå¦‚ä½• http://cenalulu.github.io/python/gil-in-python/](http://cenalulu.github.io/python/gil-in-python/)\n* [Pythonçš„å…¨å±€é”é—®é¢˜ http://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html](http://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p09_dealing_with_gil_stop_worring_about_it.html)\n* [Pythonçº¿ç¨‹æŒ‡å— http://www.cnblogs.com/huxi/archive/2010/06/26/1765808.html](http://www.cnblogs.com/huxi/archive/2010/06/26/1765808.html)\n\n\n|>æ¬¢è¿å…³æ³¨ | >è¯·æˆ‘å–èŠ¬è¾¾|\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n",
      "data": {
        "title": "pythonå¹¶å‘4ï¼šä½¿ç”¨threadå¤„ç†å¹¶å‘",
        "date": "2017-07-02 08:29:39",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°",
          "å¹¶å‘"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-threading"
    },
    {
      "content": "\n## ç®€ä»‹\nSanic æ˜¯ä¸€ä¸ªå’Œç±»Flask çš„åŸºäºPython3.5+çš„webæ¡†æ¶ï¼Œå®ƒç¼–å†™çš„ä»£ç é€Ÿåº¦ç‰¹åˆ«å¿«ã€‚\n\né™¤äº†åƒFlask ä»¥å¤–ï¼ŒSanic è¿˜æ”¯æŒä»¥å¼‚æ­¥è¯·æ±‚çš„æ–¹å¼å¤„ç†è¯·æ±‚ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨æ–°çš„ async/await è¯­æ³•ï¼Œç¼–å†™éé˜»å¡çš„å¿«é€Ÿçš„ä»£ç ã€‚\n\n> å…³äº asyncio åŒ…çš„ä»‹ç»ï¼Œè¯·å‚è€ƒä¹‹å‰çš„ä¸€ç¯‡æ–‡ç«  [pythonå¹¶å‘2ï¼šä½¿ç”¨asyncioå¤„ç†å¹¶å‘](http://blog.gusibi.site/post/python-asyncio/)\n\nGithub åœ°å€ æ˜¯ [https://github.com/channelcat/sanic](https://github.com/channelcat/sanic)ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»è´¡çŒ®ä»£ç ã€‚\n\næ—¢ç„¶å®ƒè¯´é€Ÿåº¦ç‰¹åˆ«å¿«ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹å®˜æ–¹æä¾›çš„ åŸºå‡†æµ‹è¯•ç»“æœã€‚\n\n## SanicåŸºå‡†æµ‹è¯•\n\n![sanic benchmarks](http://media.gusibi.mobi/Z4kaZYttJBgd10Nl9CxCc9aRv0lpERgpW2tCnnRjHQ7G3Yb0swwrL2qFBORVcRSp)\n\nè¿™ä¸ªæµ‹è¯•çš„ç¨‹åºè¿è¡Œåœ¨ AWS å®ä¾‹ä¸Šï¼Œç³»ç»Ÿæ˜¯Ubuntuï¼Œåªä½¿ç”¨äº†ä¸€ä¸ªè¿›ç¨‹ã€‚\n\nSanic çš„å¼€å‘è€…è¯´ä»–ä»¬çš„çµæ„Ÿæ¥è‡ªäºè¿™ç¯‡æ–‡ç«  [uvloop: Blazing fast Python networking](https://magic.io/blog/uvloop-blazing-fast-python-networking/)ã€‚\n\né‚£æˆ‘ä»¬å°±æœ‰å¿…è¦çœ‹ä¸‹uvloopæ˜¯ä¸ªä»€ä¹ˆåº“ã€‚\n\n## uvloop\n\nuvloop æ˜¯ asyncio é»˜è®¤äº‹ä»¶å¾ªç¯çš„æ›¿ä»£å“ï¼Œå®ç°çš„åŠŸèƒ½å®Œæ•´ï¼Œåˆ‡å³æ’å³ç”¨ã€‚uvloopæ˜¯ç”¨CPython å†™çš„ï¼Œå»ºäºlibuvä¹‹ä¸Šã€‚\nuvloop å¯ä»¥ä½¿ asyncio æ›´å¿«ã€‚äº‹å®ä¸Šï¼Œå®ƒè‡³å°‘æ¯” nodejsã€gevent å’Œå…¶ä»– Python å¼‚æ­¥æ¡†æ¶è¦å¿«ä¸¤å€ ã€‚åŸºäº uvloop çš„ asyncio çš„é€Ÿåº¦å‡ ä¹æ¥è¿‘äº† Go ç¨‹åºçš„é€Ÿåº¦ã€‚\n\n### å®‰è£… uvloop\n\nuvloop è¿˜åªèƒ½åœ¨ *nix å¹³å° å’Œ Python3.5+ä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨ã€‚\nä½¿ç”¨pipå®‰è£…ï¼š\n```bash\npip install uvloop\n```\nåœ¨ asyncio ä»£ç ä¸­ä½¿ç”¨uvloop ä¹Ÿå¾ˆç®€å•ï¼š\n\n```python\nimport asyncio\nimport uvloop\nasyncio.set_event_loop_policy(uvloop.EventLoopPolicy())\n```\nè¿™å¾—ä»£ç ä½¿å¾—å¯¹ä»»ä½•asyncio.get_event_loop() çš„è°ƒç”¨éƒ½å°†è¿”å›ä¸€ä¸ªuvloopå®ä¾‹ã€‚\n\nè¯¦ç»†çš„uvloop ä»‹ç»å¯ä»¥çœ‹ä¸‹åŸæ–‡ï¼š[uvloop: Blazing fast Python networking](https://magic.io/blog/uvloop-blazing-fast-python-networking/)ã€‚\n\nuvloopçš„githubåœ°å€æ˜¯[https://github.com/MagicStack/uvloop](https://github.com/MagicStack/uvloop)ã€‚\n\nç°åœ¨æˆ‘ä»¬å¼€å§‹å­¦ä¹ Sanicï¼š\n\n## å®‰è£… Sanic \n\n```bash\npip install sanic\n```\n\n### åˆ›å»ºç¬¬ä¸€ä¸ª sanic ä»£ç \n\n```python\nfrom sanic import Sanic\nfrom sanic.response import text\n\napp = Sanic(__name__)\n\n@app.route(\"/\")\nasync def test(request):\n    return text('Hello world!')\n\napp.run(host=\"0.0.0.0\", port=8000, debug=True)\n```\n\nè¿è¡Œä»£ç ï¼š `python main.py`, ç°åœ¨æ‰“å¼€æµè§ˆå™¨è®¿é—® http://0.0.0.0:8000ï¼Œä½ ä¼šçœ‹åˆ° `hello world!`ã€‚\n\nå¦‚æœä½ ç†Ÿæ‚‰Flaskï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ä¸ªè¯­æ³•ç®€ç›´å’ŒFlaskä¸€æ¨¡ä¸€æ ·ã€‚\n\n## è·¯ç”±ï¼ˆRoutingï¼‰\n\nè·¯ç”±ç”¨äºæŠŠä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°ä¸€ä¸ª URLã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„ä¾‹å­ï¼š\n\n```python\n@app.route('/')\ndef index():\n    return text('Index Page')\n\n@app.route('/hello')\ndef hello():\n    return text('Hello World')\n```\nå½“ç„¶ï¼Œä½ è¿˜å¯ä»¥åŠ¨æ€çš„å˜åŒ–URLçš„æŸäº›éƒ¨åˆ†ï¼Œè¿˜å¯ä»¥ä¸ºä¸€ä¸ªå‡½æ•°æŒ‡å®šå¤šä¸ªè§„åˆ™ã€‚\n\n### å˜é‡è§„åˆ™\n\né€šè¿‡æŠŠ URL çš„ä¸€éƒ¨åˆ†æ ‡è®°ä¸º <variable_name> å°±å¯ä»¥åœ¨ URL ä¸­æ·»åŠ å˜é‡ã€‚æ ‡è®°çš„ éƒ¨åˆ†ä¼šä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚é€šè¿‡ä½¿ç”¨ `<converter:variable_name>` ï¼Œå¯ä»¥ é€‰æ‹©æ€§çš„åŠ ä¸Šä¸€ä¸ªè½¬æ¢å™¨ï¼Œä¸ºå˜é‡æŒ‡å®šç‰¹å®šçš„ç±»å‹ï¼Œå¦‚æœä¼ å…¥çš„ç±»å‹é”™è¯¯ï¼ŒSanicä¼šæŠ›å‡º`NotFound`å¼‚å¸¸ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­:\n\n```python\nfrom sanic.response import text\n\n@app.route('/tag/<tag>')\nasync def tag_handler(request, tag):\n    return text('Tag - {}'.format(tag))\n\n@app.route('/number/<integer_arg:int>')\nasync def integer_handler(request, integer_arg):\n    return text('Integer - {}'.format(integer_arg))\n\n@app.route('/number/<number_arg:number>')\nasync def number_handler(request, number_arg):\n    return text('Number - {}'.format(number_arg))\n\n@app.route('/person/<name:[A-z]>')\nasync def person_handler(request, name):\n    return text('Person - {}'.format(name))\n\n@app.route('/folder/<folder_id:[A-z0-9]{0,4}>')\nasync def folder_handler(request, folder_id):\n    return text('Folder - {}'.format(folder_id))\n```\n### HTTP è¯·æ±‚ç±»å‹\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®šä¹‰çš„URLåªæ”¯æŒ`GET` è¯·æ±‚ï¼Œ`@app.route`è£…é¥°å™¨æä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°`methods`ï¼Œè¿™ä¸ªå‚æ•°å…è®¸ä¼ å…¥æ‰€æœ‰HTTP æ–¹æ³•ã€‚\nä¾‹å¦‚ï¼š\n```python\nfrom sanic.response import text\n\n@app.route('/post', methods=['POST'])\nasync def post_handler(request):\n    return text('POST request - {}'.format(request.json))\n\n@app.route('/get', methods=['GET'])\nasync def get_handler(request):\n    return text('GET request - {}'.format(request.args))\n```\n\nä¹Ÿå¯ä»¥ç®€å†™ä¸ºï¼š\n\n```python\nfrom sanic.response import text\n\n@app.post('/post')\nasync def post_handler(request):\n    return text('POST request - {}'.format(request.json))\n\n@app.get('/get')\nasync def get_handler(request):\n    return text('GET request - {}'.format(request.args))\n```\n### add_route æ–¹æ³•\n\né™¤äº†`@app.route`è£…é¥°å™¨ï¼ŒSanic è¿˜æä¾›äº† `add_route` æ–¹æ³•ã€‚\n> `@app.route` åªæ˜¯åŒ…è£…äº† `add_route`æ–¹æ³•ã€‚\n\n```python\nfrom sanic.response import text\n\n# Define the handler functions\nasync def handler1(request):\n    return text('OK')\n\nasync def handler2(request, name):\n    return text('Folder - {}'.format(name))\n\nasync def person_handler2(request, name):\n    return text('Person - {}'.format(name))\n\n# Add each handler function as a route\napp.add_route(handler1, '/test')\napp.add_route(handler2, '/folder/<name>')\napp.add_route(person_handler2, '/person/<name:[A-z]>', methods=['GET'])\n```\n### URL æ„å»º\n\nå¦‚æœå¯ä»¥åŒ¹é…URLï¼Œé‚£ä¹ˆSanicå¯ä»¥ç”ŸæˆURLå—ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œurl_for() å‡½æ•°å°±æ˜¯ç”¨äºæ„å»ºæŒ‡å®šå‡½æ•°çš„URLçš„ã€‚å®ƒæŠŠå‡½æ•°åç§°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…¶ä½™å‚æ•°å¯¹åº”URLä¸­çš„å˜é‡ï¼Œä¾‹å¦‚ï¼š\n```python\n@app.route('/')\nasync def index(request):\n    # generate a URL for the endpoint `post_handler`\n    url = app.url_for('post_handler', post_id=5)\n    # the URL is `/posts/5`, redirect to it\n    return redirect(url)\n\n\n@app.route('/posts/<post_id>')\nasync def post_handler(request, post_id):\n    return text('Post - {}'.format(post_id))\n```\næœªå®šä¹‰å˜é‡ä¼šä½œä¸ºURLçš„æŸ¥è¯¢å‚æ•°ï¼š\n```python\nurl = app.url_for('post_handler', post_id=5, arg_one='one', arg_two='two')\n# /posts/5?arg_one=one&arg_two=two\n\n# æ”¯æŒå¤šå€¼å‚æ•°\nurl = app.url_for('post_handler', post_id=5, arg_one=['one', 'two'])\n# /posts/5?arg_one=one&arg_one=two\n```\n## ä½¿ç”¨è“å›¾ï¼ˆBlueprintï¼‰\n\nSanicä¹Ÿæä¾›äº†å’ŒFlask ç±»ä¼¼çš„ Blueprintã€‚\n\nBlueprintæœ‰ä»¥ä¸‹ç”¨é€”ï¼š\n\n* æŠŠä¸€ä¸ªåº”ç”¨åˆ†è§£ä¸ºä¸€å¥—è“å›¾ã€‚è¿™æ˜¯é’ˆå¯¹å¤§å‹åº”ç”¨çš„ç†æƒ³æ–¹æ¡ˆï¼šä¸€ä¸ªé¡¹ç›®å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ª åº”ç”¨ï¼Œåˆå§‹åŒ–å¤šä¸ªæ‰©å±•ï¼Œå¹¶æ³¨å†Œè®¸å¤šè“å›¾ã€‚\n* åœ¨ä¸€ä¸ªåº”ç”¨çš„ URL å‰ç¼€å’Œï¼ˆæˆ–ï¼‰å­åŸŸä¸Šæ³¨å†Œä¸€ä¸ªè“å›¾ã€‚ URL å‰ç¼€å’Œï¼ˆæˆ–ï¼‰å­åŸŸçš„å‚æ•° æˆä¸ºè“å›¾ä¸­æ‰€æœ‰è§†å›¾çš„é€šç”¨è§†å›¾å‚æ•°ï¼ˆç¼ºçœæƒ…å†µä¸‹ï¼‰ã€‚\n* ä½¿ç”¨ä¸åŒçš„ URL è§„åˆ™åœ¨åº”ç”¨ä¸­å¤šæ¬¡æ³¨å†Œè“å›¾ã€‚\n* é€šè¿‡è“å›¾æä¾›æ¨¡æ¿è¿‡æ»¤å™¨ã€é™æ€æ–‡ä»¶ã€æ¨¡æ¿å’Œå…¶ä»–å·¥å…·ã€‚è“å›¾ä¸å¿…æ‰§è¡Œåº”ç”¨æˆ–è§†å›¾ å‡½æ•°ã€‚\n\n### blueprint ç¤ºä¾‹\n\n```python\nfrom sanic import Sanic\nfrom sanic.response import json\nfrom sanic import Blueprint\n\nbp = Blueprint('my_blueprint')\n\n@bp.route('/')\nasync def bp_root(request):\n    return json({'my': 'blueprint'})\n    \napp = Sanic(__name__)\napp.blueprint(bp)\n\napp.run(host='0.0.0.0', port=8000, debug=True)\n```\nSanic ä½¿ç”¨ app.blueprint() æ–¹æ³•æ³¨å†Œblueprintã€‚\n\n### ä½¿ç”¨è“å›¾æ³¨å†Œå…¨å±€ä¸­é—´ä»¶\n\n```python\n@bp.middleware\nasync def print_on_request(request):\n    print(\"I am a spy\")\n\n@bp.middleware('request')\nasync def halt_request(request):\n    return text('I halted the request')\n\n@bp.middleware('response')\nasync def halt_response(request, response):\n    return text('I halted the response')\n```\n\n### ä½¿ç”¨è“å›¾å¤„ç†å¼‚å¸¸\n\n```python\n@bp.exception(NotFound)\ndef ignore_404s(request, exception):\n    return text(\"Yep, I totally found the page: {}\".format(request.url))\n```\n\n### ä½¿ç”¨è“å›¾å¤„ç†é™æ€æ–‡ä»¶\n\nç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å‘å½“å‰çš„PythonåŒ…\nç¬¬äºŒä¸ªå‚æ•°æ˜¯é™æ€æ–‡ä»¶çš„ç›®å½•\n\n```python\nbp.static('/folder/to/serve', '/web/path')\n```\n\n### ä½¿ç”¨url_for\n\nå¦‚æœè¦åˆ›å»ºé¡µé¢é“¾æ¥ï¼Œå¯ä»¥å’Œé€šå¸¸ä¸€æ ·ä½¿ç”¨ url_for() å‡½æ•°ï¼Œåªæ˜¯è¦æŠŠè“å›¾åç§°ä½œä¸ºç«¯ç‚¹çš„å‰ç¼€ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªç‚¹ï¼ˆ . ï¼‰æ¥ åˆ†éš”:\n\n```python\n@blueprint_v1.route('/')\nasync def root(request):\n    url = app.url_for('v1.post_handler', post_id=5) # --> '/v1/post/5'\n    return redirect(url)\n\n\n@blueprint_v1.route('/post/<post_id>')\nasync def post_handler(request, post_id):\n    return text('Post {} in Blueprint V1'.format(post_id))\n```\n\n## æ“ä½œè¯·æ±‚æ•°æ®\n\nå¯¹äºweb åº”ç”¨æ¥è¯´å¯¹å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„æ•°æ®åšå‡ºç›¸åº”å¾ˆé‡è¦ï¼Œåœ¨Sanicä¸­ç”±ä¼ å…¥çš„å‚æ•° requestæ¥æä¾›è¯·æ±‚ä¿¡æ¯ã€‚\n\n> <section class=\"caption\">ä¸ºä»€ä¹ˆä¸åƒFlask ä¸€æ ·æä¾›ä¸€ä¸ªå…¨å±€å˜é‡ requestï¼Ÿ</section>\n> Flask æ˜¯åŒæ­¥è¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ–°çº¿ç¨‹æ¥å¤„ç†ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸­ä¹Ÿåªå¤„ç†è¿™ä¸€ä¸ªè¯·æ±‚ã€‚è€ŒSanicæ˜¯åŸºäºåç¨‹çš„å¤„ç†æ–¹å¼ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¤„ç†å‡ ä¸ªã€å‡ åä¸ªç”šè‡³å‡ ç™¾ä¸ªè¯·æ±‚ï¼ŒæŠŠrequestä½œä¸ºå…¨å±€å˜é‡æ˜¾ç„¶ä¼šæ¯”è¾ƒéš¾ä»¥å¤„ç†ã€‚\n\nRequest å¯¹è±¡å¸¸ç”¨å‚æ•°æœ‰ \n#### jsonï¼ˆanyï¼‰  json body\n\n```python\nfrom sanic.response import json\n\n@app.route(\"/json\")\ndef post_json(request):\n    return json({ \"received\": True, \"message\": request.json })\n```\n\n\n#### argsï¼ˆdictï¼‰  URLè¯·æ±‚å‚æ•°\n?key1=value1&key2=value2  å°†è½¬å˜ä¸º\n```json\n{'key1': ['value1'], 'key2': ['value2']}\n```\n\n\n#### raw_argsï¼ˆdictï¼‰ å’Œargs ç±»ä¼¼\n?key1=value1&key2=value2  å°†è½¬å˜ä¸º\n```json\n{'key1': 'value1', 'key2': 'value2'}\n```\n#### formï¼ˆdictï¼‰å¤„ç† POST è¡¨å•è¯·æ±‚ï¼Œæ•°æ®æ˜¯ä¸€ä¸ªå­—å…¸\n#### bodyï¼ˆbytesï¼‰å¤„ç†POST è¡¨å•è¯·æ±‚ï¼Œæ•°æ®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²\n\nå…¶ä»–å‚æ•°è¿˜æœ‰:\n* file\n* ip\n* app\n* url\n* scheme\n* path\n* query_string\n\nè¯¦ç»†ä¿¡æ¯å‚è€ƒæ–‡æ¡£: [Request Data](http://sanic.readthedocs.io/en/latest/sanic/request_data.html)\n\n## å…³äºå“åº”\n\nSanicä½¿ç”¨response å‡½æ•°åˆ›å»ºå“åº”å¯¹è±¡ã€‚\n\n* æ–‡æœ¬ `response.text('hello world')`\n* html `response.html('<p>hello world</p>')`\n* json `response.json({'hello': 'world'})`\n* file `response.file('/srv/www/hello.txt')`\n* streaming \n\n```python\nfrom sanic import response\n\n@app.route(\"/streaming\")\nasync def index(request):\n    async def streaming_fn(response):\n        response.write('foo')\n        response.write('bar')\n    return response.stream(streaming_fn, content_type='text/plain')\n```\n* redirect `response.file('/json')`\n* raw `response.raw('raw data')`\n* å¦‚æœæƒ³ä¿®æ”¹å“åº”çš„headerså¯ä»¥ä¼ å…¥headers å‚æ•°\n\n```python\nfrom sanic import response\n\n@app.route('/json')\ndef handle_request(request):\n    return response.json(\n        {'message': 'Hello world!'},\n        headers={'X-Served-By': 'sanic'},\n        status=200\n    )\n```\n## é…ç½®ç®¡ç†\n\nåº”ç”¨æ€»æ˜¯éœ€è¦ä¸€å®šçš„é…ç½®çš„ã€‚æ ¹æ®åº”ç”¨ç¯å¢ƒä¸åŒï¼Œä¼šéœ€è¦ä¸åŒçš„é…ç½®ã€‚æ¯”å¦‚å¼€å…³è°ƒè¯• æ¨¡å¼ã€è®¾ç½®å¯†é’¥ä»¥åŠå…¶ä»–ä¾èµ–äºç¯å¢ƒçš„ä¸œè¥¿ã€‚\nSanic çš„è®¾è®¡æ€è·¯æ˜¯åœ¨åº”ç”¨å¼€å§‹æ—¶è½½å…¥é…ç½®ã€‚ä½ å¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥ç¡¬ç¼–ç å†™å…¥é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚\n\nä¸ç®¡ä½ ä½¿ç”¨ä½•ç§æ–¹å¼è½½å…¥é…ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ Sanic çš„ config å±æ€§æ¥æ“ä½œé…ç½®çš„å€¼ã€‚ Sanic æœ¬èº«å°±ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ¥ä¿å­˜ ä¸€äº›é…ç½®ï¼Œæ‰©å±•ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ä¿å­˜é…ç½®ã€‚åŒæ—¶è¿™ä¹Ÿæ˜¯ä½ ä¿å­˜é…ç½®çš„åœ°æ–¹ã€‚\n### é…ç½®å…¥é—¨\nconfig å®è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—å…¸çš„å­ç±»ï¼Œå¯ä»¥åƒå­—å…¸ä¸€æ ·æ“ä½œï¼š\n```python\napp = Sanic('myapp')\napp.config.DB_NAME = 'appdb'\napp.config.DB_USER = 'appuser'\n```\nä¹Ÿå¯ä»¥ä¸€æ¬¡æ›´æ–°å¤šä¸ªé…ç½®ï¼š\n\n```python\ndb_settings = {\n    'DB_HOST': 'localhost',\n    'DB_NAME': 'appdb',\n    'DB_USER': 'appuser'\n}\napp.config.update(db_settings)\n```\n### ä»å¯¹è±¡å¯¼å…¥é…ç½®\n```python\nimport myapp.default_settings\n\napp = Sanic('myapp')\napp.config.from_object(myapp.default_settings)\n```\nè¿™é‡Œæ˜¯æˆ‘å†™çš„èŠå¤©æœºå™¨äººçš„çœŸå®é…ç½®ç¤ºä¾‹ï¼š[https://github.com/gusibi/momo/](https://github.com/gusibi/momo/blob/master/app.py#L17)\n\n### ä½¿ç”¨é…ç½®æ–‡ä»¶\nå¦‚æœæŠŠé…ç½®æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ä¼šæ›´æœ‰ç”¨ã€‚ç†æƒ³æƒ…å†µä¸‹é…ç½®æ–‡ä»¶åº”å½“æ”¾åœ¨åº”ç”¨åŒ…çš„ å¤–é¢ã€‚è¿™æ ·å¯ä»¥åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶ä¸å½±å“åº”ç”¨çš„æ‰“åŒ…ä¸åˆ†å‘\nå¸¸è§ç”¨æ³•å¦‚ä¸‹:\n```python\napp = Sanic('myapp')\napp.config.from_envvar('MYAPP_SETTINGS')\n```\né¦–å…ˆä» myapp.default_settings æ¨¡å—è½½å…¥é…ç½®ï¼Œç„¶åæ ¹æ® MYAPP_SETTINGS ç¯å¢ƒå˜é‡æ‰€æŒ‡å‘çš„æ–‡ä»¶çš„å†…å®¹é‡è½½é…ç½®çš„å€¼ã€‚åœ¨ å¯åŠ¨æœåŠ¡å™¨å‰ï¼Œåœ¨ Linux æˆ– OS X æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ export å‘½ä»¤æ¥è®¾ç½®:\n```bash\n$ export MYAPP_SETTINGS=/path/to/config_file\n$ python myapp.py\n```\n\n## éƒ¨ç½²\nSanic é¡¹ç›®è¿˜ä¸æ˜¯ç‰¹åˆ«æˆç†Ÿï¼Œç°åœ¨éƒ¨ç½²æ¯”è¾ƒç®€é™‹ã€‚å¯¹Gunicornçš„æ”¯æŒä¹Ÿä¸å®Œå–„ã€‚\nè¯¦ç»†ä¿¡æ¯å¯ä»¥ çœ‹ä¸‹è¿™ä¸ªé—®é¢˜ [Projects built with sanic?](https://github.com/channelcat/sanic/issues/396)\n\nå…ˆåœ¨è¯´ä¸‹æˆ‘çš„éƒ¨ç½²æ–¹å¼\n### ä½¿ç”¨ supervisord éƒ¨ç½²\n\nsupervisord é…ç½®æ–‡ä»¶ï¼š [https://github.com/gusibi/momo/blob/master/supervisord.conf](https://github.com/gusibi/momo/blob/master/supervisord.conf)\n\nå¯åŠ¨ æ–¹å¼\n\n```bash\nsupervisord -c supervisor.conf\n```\n\n## æ€»ç»“\nè¯•ç”¨äº†ä¸‹Sanicï¼ŒæŠŠä¹‹å‰çš„ä¸€ä¸ªèŠå¤©æœºå™¨äººä»Flask æ”¹æˆäº† Sanicã€‚ä¸å¾—ä¸è¯´ï¼Œå¦‚æœä½ æœ‰Flaskç»éªŒï¼Œå¤§è‡´çœ‹ä¸€ä¸‹Sanicæ–‡æ¡£å°±å¯ä»¥ç›´æ¥ä¸Šæ‰‹äº†ã€‚\nå¹¶ä¸”Sanic çš„é€Ÿåº¦æ¯”Flask å¿«å¾ˆå¤šï¼Œåªæ˜¯Sanicé…å¥—çš„åŒ…è¿˜æ˜¯å¤ªå°‘ï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒæœ‰ä¸€å®šçš„é£é™©ã€‚\n\næœ€åå¯¹èŠå¤©å¾®ä¿¡èŠå¤©æœºå™¨äººæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸‹[https://github.com/gusibi/momo](https://github.com/gusibi/momo)ã€‚\n\n## é¢„å‘Š\n\nä¸‹ä¸€ç¯‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Sanic ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ª èŠå¤©æœºå™¨äººã€‚\n\n## å‚è€ƒé“¾æ¥\n* [uvloop: Blazing fast Python networking](https://magic.io/blog/uvloop-blazing-fast-python-networking)\n* [Sanic Githu åœ°å€](https://github.com/channelcat/sanic)\n* [Sanic æ–‡æ¡£](http://sanic.readthedocs.io/en/latest/)\n- - - - -\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\n|>æ¬¢è¿å…³æ³¨ | >è¯·æˆ‘å–èŠ¬è¾¾|\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n\n## å½©è›‹\n**é­”é­”æ˜¯æˆ‘ä»¬å®¶å·´å“¥çš„åå­—**\nè´´ä¸€å¼ é­”é­”çš„ç…§ç‰‡ç»“æŸæœ¬ç¯‡æ–‡ç« ã€‚\n\n![](http://media.gusibi.mobi/ocViYNLQGTk_wX2aGhazWKH_q2kkpJkxAosa8f8NbLFLBdHt78dEDYRGklBbBT1J)\n\n",
      "data": {
        "title": "python web æ¡†æ¶ Sanci å¿«é€Ÿå…¥é—¨",
        "date": "2017-06-25 04:47:34",
        "tags": [
          "python",
          "tutorial",
          "sanic"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "sanic-quickstart"
    },
    {
      "content": "\næœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒã€‚\n\n|>æ¬¢è¿å…³æ³¨ | >è¯·æˆ‘å–èŠ¬è¾¾|\n------- | -------\n![æ¬¢è¿å…³æ³¨](http://media.gusibi.mobi/Hy8XHexmzppNKuekLuGxWy8LjdGrQAzZA3mH_e9xltoiYgTFWdvlpZwGWxZESrbK)| ![è¯·æˆ‘å–èŠ¬è¾¾](http://media.gusibi.mobi/CO9DwU6ZHnXHD5xuG3GqTsY_IYPl-JdpQrDaOo6tl6PiAGEBDeYFHO7sGQi_VVFc)\n",
      "data": {
        "categories": [
          "xxx",
          "xxxx"
        ],
        "date": "2017-06-25 01:41:13",
        "description": "description",
        "permalink": "/post/url-path",
        "tags": [
          "xx",
          "xxxx"
        ],
        "title": "title",
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-how-to-use-elasticsearch"
    },
    {
      "content": "\nå‰ä¸¤ç¯‡æˆ‘ä»¬å·²ç»ä»‹ç»äº†[python åç¨‹çš„ä½¿ç”¨](https://gusibi.github.io/post/python-coroutine-1-yield/)å’Œ[yield from çš„åŸç†](https://gusibi.github.io/post/python-coroutine-yield-from/)ï¼Œè¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥æ­ç¤ºå¦‚ä½•ä½¿ç”¨åç¨‹åœ¨å•çº¿ç¨‹ä¸­ç®¡ç†å¹¶å‘æ´»åŠ¨ã€‚\n\n## ä»€ä¹ˆæ˜¯ç¦»æ•£äº‹ä»¶ä»¿çœŸ\n\nWikiä¸Šçš„å®šä¹‰æ˜¯ï¼š\n\n> ç¦»æ•£äº‹ä»¶ä»¿çœŸå°†ç³»ç»Ÿéšæ—¶é—´çš„å˜åŒ–æŠ½è±¡æˆä¸€ç³»åˆ—çš„ç¦»æ•£æ—¶é—´ç‚¹ä¸Šçš„äº‹ä»¶ï¼Œé€šè¿‡æŒ‰ç…§äº‹ä»¶æ—¶é—´é¡ºåºå¤„ç†äº‹ä»¶æ¥æ¼”è¿›ï¼Œæ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨çš„ä»¿çœŸä¸–ç•Œè§‚ã€‚ç¦»æ•£äº‹ä»¶ä»¿çœŸå°†ç³»ç»Ÿçš„å˜åŒ–çœ‹åšä¸€ä¸ªäº‹ä»¶ï¼Œå› æ­¤ç³»ç»Ÿä»»ä½•çš„å˜åŒ–éƒ½åªèƒ½æ˜¯é€šè¿‡å¤„ç†ç›¸åº”çš„äº‹ä»¶æ¥å®ç°ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»çš„äº‹ä»¶ä¹‹é—´ï¼Œç³»ç»ŸçŠ¶æ€ç»´æŒå‰ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåçš„çŠ¶æ€ä¸å˜ã€‚\n\näººè¯è¯´å°±æ˜¯ä¸€ç§æŠŠç³»ç»Ÿå»ºæ¨¡æˆä¸€ç³»åˆ—äº‹ä»¶çš„ä»¿çœŸç³»ç»Ÿã€‚åœ¨ç¦»æ•£äº‹ä»¶ä»¿çœŸä¸­ï¼Œä»¿çœŸâ€œé’Ÿâ€å‘å‰æ¨è¿›çš„é‡ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ç›´æ¥æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶æ¨¡å‹çš„æ¨¡æ‹Ÿæ—¶é—´ã€‚\n\nå‡è®¾æˆ‘ä»¬æŠ½è±¡æ¨¡æ‹Ÿå‡ºç§Ÿè½¦çš„è¿è¥è¿‡ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªäº‹ä»¶æ˜¯ä¹˜å®¢ä¸Šè½¦ï¼Œä¸‹ä¸€ä¸ªäº‹ä»¶åˆ™æ˜¯ä¹˜å®¢ä¸‹è½¦ã€‚ä¸ç®¡ä¹˜å®¢åšäº†5åˆ†é’Ÿè¿˜æ˜¯50åˆ†é’Ÿï¼Œä¸€æ—¦ä¸‹è½¦ï¼Œä»¿çœŸé’Ÿå°±ä¼šæ›´æ–°ï¼ŒæŒ‡å‘æ­¤æ¬¡è¿è¥çš„ç»“æŸæ—¶é—´ã€‚\n\näº‹ä»¶ï¼Ÿæ˜¯ä¸æ˜¯æƒ³åˆ°äº†åç¨‹ï¼\n\nåç¨‹æ°å¥½ä¸ºå®ç°ç¦»æ•£äº‹ä»¶ä»¿çœŸæä¾›äº†åˆç†çš„æŠ½è±¡ã€‚\n\nHUGOMORE42\n\n> ç¬¬ä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­éŸ³ Simula å¼•å…¥åç¨‹è¿™ä¸ªæ¦‚å¿µå°±æ˜¯ä¸ºäº†æ”¯æŒä»¿çœŸã€‚\n> Simpy æ˜¯ä¸€ä¸ªå®ç°ç¦»æ•£äº‹ä»¶ä»¿çœŸçš„PythonåŒ…ï¼Œé€šè¿‡ä¸€ä¸ªåç¨‹è¡¨ç¤ºç¦»æ•£äº‹ä»¶ä»¿çœŸç³»ç»Ÿçš„å„ä¸ªè¿›ç¨‹ã€‚\n\n## å‡ºç§Ÿè½¦å¯¹è¿è¥ä»¿çœŸ\n\nä»¿çœŸç¨‹åºä¼šåˆ›å»ºå‡ è¾†å‡ºç§Ÿè½¦ï¼Œæ¯è¾†å‡ºç§Ÿè½¦ä¼šæ‹‰å‡ ä¸ªä¹˜å®¢ï¼Œç„¶åå›å®¶ã€‚å‡ºç§Ÿè½¦ä¼šé¦–å…ˆé©¶ç¦»è½¦åº“ï¼Œå››å¤„å¾˜å¾Šï¼Œå¯»æ‰¾ä¹˜å®¢ï¼›æ‹‰åˆ°ä¹˜å®¢åï¼Œè¡Œç¨‹å¼€å§‹ï¼›ä¹˜å®¢ä¸‹è½¦åï¼Œç»§ç»­å››å¤„å¾˜å¾Šã€‚\n\nå¾˜å¾Šå’Œè¡Œç¨‹æ‰€ç”¨çš„æ—¶é—´ä½¿ç”¨æŒ‡æ•°åˆ†å¸ƒç”Ÿæˆï¼Œæˆ‘ä»¬å°†æ—¶é—´è®¾ä¸ºåˆ†é’Ÿæ•°ï¼Œä»¥ä¾¿æ˜¾ç¤ºæ¸…æ¥šã€‚\n\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š(taxi_sim.py)\n\n```python\n\n#! -*- coding: utf-8 -*-\nimport random\nimport collections\nimport queue\nimport argparse\n\nDEFAULT_NUMBER_OF_TAXIS = 3\nDEFAULT_END_TIME = 180\nSEARCH_DURATION = 5\nTRIP_DURATION = 20\nDEPARTURE_INTERAVAL = 5\n\n\n# time æ˜¯äº‹ä»¶å‘ç”Ÿçš„ä»¿çœŸæ—¶é—´ï¼Œproc æ˜¯å‡ºç§Ÿè½¦è¿›ç¨‹å®ä¾‹çš„ç¼–å·ï¼Œactionæ˜¯æè¿°æ´»åŠ¨çš„å­—ç¬¦ä¸²\nEvent = collections.namedtuple('Event', 'time proc action')\n\n# å¼€å§‹ å‡ºç§Ÿè½¦è¿›ç¨‹\n# æ¯è¾†å‡ºç§Ÿè½¦è°ƒç”¨ä¸€æ¬¡taxi_process å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œè¡¨ç¤ºå„è¾†å‡ºç§Ÿè½¦çš„è¿è¥è¿‡ç¨‹ã€‚\ndef taxi_process(ident, trips, start_time=0):\n    '''\n    æ¯æ¬¡çŠ¶æ€å˜åŒ–æ—¶å‘åˆ›å»ºäº‹ä»¶ï¼ŒæŠŠæ§åˆ¶æƒäº¤ç»™ä»¿çœŸå™¨\n    :param ident: å‡ºç§Ÿè½¦ç¼–å·\n    :param trips: å‡ºç§Ÿè½¦å›å®¶å‰çš„è¡Œç¨‹æ•°é‡\n    :param start_time: ç¦»å¼€è½¦åº“çš„æ—¶é—´\n    :return: \n    '''\n    time = yield Event(start_time, ident, 'leave garage') # äº§å‡ºçš„ç¬¬ä¸€ä¸ªEvent\n    for i in range(trips):  # æ¯æ¬¡è¡Œç¨‹éƒ½ä¼šæ‰§è¡Œä¸€éè¿™ä¸ªä»£ç å—\n        # äº§å‡ºä¸€ä¸ªEventå®ä¾‹ï¼Œè¡¨ç¤ºæ‹‰åˆ°äº†ä¹˜å®¢ åç¨‹åœ¨è¿™é‡Œæš‚åœ ç­‰å¾…ä¸‹ä¸€æ¬¡send() æ¿€æ´»\n        time = yield Event(time, ident, 'pick up passenger')\n         # äº§å‡ºä¸€ä¸ªEventå®ä¾‹ï¼Œè¡¨ç¤ºä¹˜å®¢ä¸‹è½¦ åç¨‹åœ¨è¿™é‡Œæš‚åœ ç­‰å¾…ä¸‹ä¸€æ¬¡send() æ¿€æ´»\n        time = yield Event(time, ident, 'drop off passenger')\n    # æŒ‡å®šçš„è¡Œç¨‹æ•°é‡å®Œæˆåï¼Œfor å¾ªç¯ç»“æŸï¼Œæœ€åäº§å‡º 'going home' äº‹ä»¶ã€‚åç¨‹æœ€åä¸€æ¬¡æš‚åœ\n    yield Event(time, ident, 'going home')\n    # åç¨‹æ‰§è¡Œåˆ°æœ€å æŠ›å‡ºStopIteration å¼‚å¸¸\n\n\ndef compute_duration(previous_action):\n    '''ä½¿ç”¨æŒ‡æ•°åˆ†å¸ƒè®¡ç®—æ“ä½œçš„è€—æ—¶'''\n    if previous_action in ['leave garage', 'drop off passenger']:\n        # æ–°çŠ¶æ€æ˜¯å››å¤„å¾˜å¾Š\n        interval = SEARCH_DURATION\n    elif previous_action == 'pick up passenger':\n        # æ–°çŠ¶æ€æ˜¯å¼€å§‹è¡Œç¨‹\n        interval = TRIP_DURATION\n    elif previous_action == 'going home':\n        interval = 1\n    else:\n        raise ValueError('Unkonw previous_action: %s' % previous_action)\n    return int(random.expovariate(1/interval)) + 1\n\n\n# å¼€å§‹ä»¿çœŸ\nclass Simulator:\n\n    def __init__(self, procs_map):\n        self.events = queue.PriorityQueue()  # å¸¦ä¼˜å…ˆçº§çš„é˜Ÿåˆ— ä¼šæŒ‰æ—¶é—´æ­£å‘æ’åº\n        self.procs = dict(procs_map) # ä»è·å–çš„procs_map å‚æ•°ä¸­åˆ›å»ºæœ¬åœ°å‰¯æœ¬ï¼Œä¸ºäº†ä¸ä¿®æ”¹ç”¨æˆ·ä¼ å…¥çš„å€¼\n\n    def run(self, end_time):\n        '''\n        è°ƒåº¦å¹¶æ˜¾ç¤ºäº‹ä»¶ï¼Œç›´åˆ°æ—¶é—´ç»“æŸ\n        :param end_time:  ç»“æŸæ—¶é—´ åªéœ€è¦æŒ‡å®šä¸€ä¸ªå‚æ•°\n        :return: \n        '''\n        # è°ƒåº¦å„è¾†å‡ºç§Ÿè½¦çš„ç¬¬ä¸€ä¸ªäº‹ä»¶\n        for iden, proc in sorted(self.procs.items()):\n            first_event = next(proc)  # é¢„æ¿€åç¨‹ å¹¶äº§å‡ºä¸€ä¸ª Event å¯¹è±¡\n            self.events.put(first_event)  # æŠŠå„ä¸ªäº‹ä»¶åŠ åˆ°self.events å±æ€§è¡¨ç¤ºçš„ PriorityQueueå¯¹è±¡ä¸­\n\n        # æ­¤æ¬¡ä»¿çœŸçš„ä¸»å¾ªç¯\n        sim_time = 0  # æŠŠ sim_time å½’0\n        while sim_time < end_time:\n            if self.events.empty(): # äº‹ä»¶å…¨éƒ¨å®Œæˆåé€€å‡ºå¾ªç¯\n                print('*** end of event ***')\n                break\n            current_event = self.events.get() # è·å–ä¼˜å…ˆçº§æœ€é«˜(time å±æ€§æœ€å°)çš„äº‹ä»¶\n            sim_time, proc_id, previous_action = current_event # æ›´æ–° sim_time\n            print('taxi:', proc_id, proc_id * '  ', current_event)\n            active_proc = self.procs[proc_id]  # ä»self.procs å­—å…¸ä¸­è·å–è¡¨ç¤ºå½“å‰æ´»åŠ¨çš„å‡ºç§Ÿè½¦åç¨‹\n            next_time = sim_time + compute_duration(previous_action)\n            try:\n                next_event = active_proc.send(next_time)  # æŠŠè®¡ç®—å¾—åˆ°çš„æ—¶é—´å‘é€ç»™å‡ºç§Ÿè½¦åç¨‹ã€‚åç¨‹ä¼šäº§å‡ºä¸‹ä¸€ä¸ªäº‹ä»¶ï¼Œæˆ–è€…æŠ›å‡º StopIteration\n            except StopIteration:\n                del self.procs[proc_id]  # å¦‚æœæœ‰å¼‚å¸¸ è¡¨ç¤ºå·²ç»é€€å‡ºï¼Œ åˆ é™¤è¿™ä¸ªåç¨‹\n            else:\n                self.events.put(next_event)  # å¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼ŒæŠŠnext_event åŠ å…¥åˆ°é˜Ÿåˆ—\n        else:  # å¦‚æœè¶…æ—¶ åˆ™èµ°åˆ°è¿™é‡Œ\n            msg = '*** end of simulation time: {} event pendding ***'\n            print(msg.format(self.events.qsize()))\n\n\n\ndef main(end_time=DEFAULT_END_TIME, num_taxis=DEFAULT_NUMBER_OF_TAXIS,\n         seed=None):\n    '''åˆå§‹åŒ–éšæœºç”Ÿæˆå™¨ï¼Œæ„å»ºè¿‡ç¨‹ï¼Œè¿è¡Œä»¿çœŸç¨‹åº'''\n    if seed is not None:\n        random.seed(seed)  # è·å–å¯å¤ç°çš„ç»“æœ\n    # æ„å»ºtaxis å­—å…¸ã€‚å€¼æ˜¯ä¸‰ä¸ªå‚æ•°ä¸åŒçš„ç”Ÿæˆå™¨å¯¹è±¡ã€‚\n    taxis = {i: taxi_process(i, (i + 1) * 2, i*DEPARTURE_INTERAVAL)\n             for i in range(num_taxis)}\n    sim = Simulator(taxis)\n    sim.run(end_time)\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser(description='Taxi fleet simulator.')\n    parser.add_argument('-e', '--end-time', type=int,\n                        default=DEFAULT_END_TIME,\n                        help='simulation end time; default=%s' % DEFAULT_END_TIME)\n    parser.add_argument('-t', '--taxis', type=int,\n                        default=DEFAULT_NUMBER_OF_TAXIS,\n                        help='number of taxis running; default = %s' % DEFAULT_NUMBER_OF_TAXIS)\n    parser.add_argument('-s', '--seed', type=int, default=None,\n                        help='random generator seed (for testing)')\n\n    args = parser.parse_args()\n    main(args.end_time, args.taxis, args.seed)\n\n```\n\nè¿è¡Œç¨‹åºï¼Œ\n\n```sh\n# -s 3 å‚æ•°è®¾ç½®éšæœºç”Ÿæˆå™¨çš„ç§å­ï¼Œä»¥ä¾¿è°ƒè¯•çš„æ—¶å€™éšæœºæ•°ä¸å˜ï¼Œè¾“å‡ºç›¸åŒçš„ç»“æœ\npython taxi_sim.py -s 3\n```\n\nè¾“å‡ºç»“æœå¦‚ä¸‹å›¾\n\n![](http://media.gusibi.mobi/3237874125-5942771d7ee84_articlex.jpeg)\n\nä»ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ3è¾†å‡ºç§Ÿè½¦çš„è¡Œç¨‹æ˜¯äº¤å‰è¿›è¡Œçš„ã€‚ä¸åŒé¢œè‰²çš„ç®­å¤´ä»£è¡¨ä¸åŒå‡ºç§Ÿè½¦ä»ä¹˜å®¢ä¸Šè½¦åˆ°ä¹˜å®¢ä¸‹è½¦çš„è·¨åº¦ã€‚\n\nä»ç»“æœå¯ä»¥çœ‹å‡ºï¼š\n\n* å‡ºç§Ÿè½¦æ¯5éš”åˆ†é’Ÿä»è½¦åº“å‡ºå‘\n* 0 å·å‡ºç§Ÿè½¦2åˆ†é’Ÿåæ‹‰åˆ°ä¹˜å®¢ï¼ˆtime=2ï¼‰ï¼Œ1å·å‡ºç§Ÿè½¦3åˆ†é’Ÿåæ‹‰åˆ°ä¹˜å®¢ï¼ˆtime=8ï¼‰ï¼Œ2å·å‡ºç§Ÿè½¦5åˆ†é’Ÿåæ‹‰åˆ°ä¹˜å®¢ï¼ˆtime=15ï¼‰\n* 0 å·å‡ºç§Ÿè½¦æ‹‰äº†ä¸¤ä¸ªä¹˜å®¢\n* 1 å·å‡ºç§Ÿè½¦æ‹‰äº†4ä¸ªä¹˜å®¢\n* 2 å·å‡ºç§Ÿè½¦æ‹‰äº†6ä¸ªä¹˜å®¢\n* åœ¨æ­¤æ¬¡ç¤ºä¸­ï¼Œæ‰€æœ‰æ’å®šçš„äº‹ä»¶éƒ½åœ¨é»˜è®¤çš„ä»¿çœŸæ—¶é—´å†…å®Œæˆ\n\næˆ‘ä»¬å…ˆåœ¨æ§åˆ¶å°ä¸­è°ƒç”¨taxi_process å‡½æ•°ï¼Œè‡ªå·±é©¾é©¶ä¸€è¾†å‡ºç§Ÿè½¦ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```python\nIn [1]: from taxi_sim import taxi_process\n# åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè¡¨ç¤ºä¸€è¾†å‡ºç§Ÿè½¦ ç¼–å·æ˜¯13 ä»t=0 å¼€å§‹ï¼Œæœ‰ä¸¤æ¬¡è¡Œç¨‹\nIn [2]: taxi = taxi_process(ident=13, trips=2, start_time=0) \n\nIn [3]: next(taxi) # é¢„æ¿€åç¨‹\nOut[3]: Event(time=0, proc=13, action='leave garage')\n\n# å‘é€å½“å‰æ—¶é—´ åœ¨æ§åˆ¶å°ä¸­ï¼Œå˜é‡_ç»‘å®šçš„æ˜¯å‰ä¸€ä¸ªç»“æœ\n# _.time + 7 æ˜¯ 0 + 7\nIn [4]: taxi.send(_.time+7) \nOut[4]: Event(time=7, proc=13, action='pick up passenger') # è¿™ä¸ªäº‹ä»¶æœ‰forå¾ªç¯åœ¨ç¬¬ä¸€ä¸ªè¡Œç¨‹çš„å¼€å¤´äº§å‡º\n\n# å‘é€_.time+12 è¡¨ç¤ºè¿™ä¸ªä¹˜å®¢ç”¨æ—¶12åˆ†é’Ÿ\nIn [5]: taxi.send(_.time+12)\nOut[5]: Event(time=19, proc=13, action='drop off passenger')\n\n# å¾˜å¾Šäº†29 åˆ†é’Ÿ\nIn [6]: taxi.send(_.time+29)\nOut[6]: Event(time=48, proc=13, action='pick up passenger')\n\n# ä¹˜åäº†50åˆ†é’Ÿ\nIn [7]: taxi.send(_.time+50)\nOut[7]: Event(time=98, proc=13, action='drop off passenger')\n\n# ä¸¤æ¬¡è¡Œç¨‹ç»“æŸ for å¾ªç¯ç»“æŸäº§å‡º'going home'\nIn [8]: taxi.send(_.time+5)\nOut[8]: Event(time=103, proc=13, action='going home')\n\n# å†å‘é€å€¼ï¼Œä¼šæ‰§è¡Œåˆ°æœ«å°¾ åç¨‹è¿”å›å æŠ›å‡º StopIteration å¼‚å¸¸\nIn [9]: taxi.send(_.time+10)\n---------------------------------------------------------------------------\nStopIteration                            Traceback (most recent call last)\n<ipython-input-9-d775cc8cc079> in <module>()\n----> 1 taxi.send(_.time+10)\n\nStopIteration:\n```\n\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç”¨æ§åˆ¶å°æ¨¡æ‹Ÿä»¿çœŸä¸»å¾ªç¯ã€‚ä»taxiåç¨‹ä¸­äº§å‡ºçš„Eventå®ä¾‹ä¸­è·å– .time å±æ€§ï¼Œéšæ„åŠ ä¸€ä¸ªæ•°ï¼Œç„¶åè°ƒç”¨send()æ–¹æ³•å‘é€ä¸¤æ•°ä¹‹å’Œï¼Œé‡æ–°æ¿€æ´»åç¨‹ã€‚\n\nåœ¨taxi_sim.py ä»£ç ä¸­ï¼Œå‡ºç§Ÿè½¦åç¨‹ç”± Simulator.run æ–¹æ³•ä¸­çš„ä¸»å¾ªç¯é©±åŠ¨ã€‚\n\nSimulator ç±»çš„ä¸»è¦æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\n\nself.events\n\n    PriorityQueue å¯¹è±¡ï¼Œä¿å­˜Eventå®ä¾‹ã€‚å…ƒç´ å¯ä»¥æ”¾è¿›PriorityQueueå¯¹è±¡ä¸­ï¼Œç„¶åæŒ‰ item[0](å¯¹è±¡çš„time å±æ€§)ä¾åºå–å‡ºï¼ˆæŒ‰ä»å°åˆ°å¤§ï¼‰ã€‚\n\nself.procs\n\n    ä¸€ä¸ªå­—å…¸ï¼ŒæŠŠå‡ºç§Ÿè½¦çš„ç¼–å·æ˜ å°„åˆ°ä»¿çœŸè¿‡ç¨‹çš„è¿›ç¨‹ï¼ˆè¡¨ç¤ºå‡ºç§Ÿè½¦ç”Ÿæˆå™¨çš„å¯¹è±¡ï¼‰ã€‚è¿™ä¸ªå±æ€§ä¼šç»‘å®šå‰é¢æ‰€ç¤ºçš„taxiså­—å…¸å‰¯æœ¬ã€‚\n\n> ä¼˜å…ˆé˜Ÿåˆ—æ˜¯ç¦»æ•£äº‹ä»¶ä»¿çœŸç³»ç»Ÿçš„åŸºç¡€æ„ä»¶ï¼šåˆ›å»ºäº‹ä»¶çš„é¡ºåºä¸å®šï¼Œæ”¾å…¥è¿™ç§é˜Ÿåˆ—åï¼Œå¯ä»¥æŒ‰å„ä¸ªäº‹ä»¶æ’å®šçš„é¡ºåºå–å‡ºã€‚\n\næ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠä¸¤ä¸ªäº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ï¼š\n\n```python\nEvent(time=14, proc=0, action='pick up passenger')\nEvent(time=10, proc=1, action='pick up passenger')\n```\n\nè¿™ä¸ªæ„æ€æ˜¯ 0å·å‡ºç§Ÿè½¦14åˆ†æ‹‰åˆ°ä¸€ä¸ªä¹˜å®¢ï¼Œ1å·å‡ºç§Ÿè½¦10åˆ†æ‹‰åˆ°ä¸€ä¸ªä¹˜å®¢ã€‚ä½†æ˜¯ä¸»å¾ªç¯è·å–çš„ç¬¬ä¸€ä¸ªäº‹ä»¶å°†æ˜¯\n\nEvent(time=10, proc=1, action='pick up passenger')\n\nä¸‹é¢æˆ‘ä»¬åˆ†æä¸€ä¸‹ä»¿çœŸç³»ç»Ÿçš„ä¸»ç®—æ³•--Simulator.run æ–¹æ³•ã€‚\n\n1. è¿­ä»£è¡¨ç¤ºå„è¾†å‡ºç§Ÿè½¦çš„è¿›ç¨‹\n  * åœ¨å„è¾†å‡ºç§Ÿè½¦ä¸Šè°ƒç”¨next()å‡½æ•°ï¼Œé¢„æ¿€åç¨‹ã€‚\n  * æŠŠå„ä¸ªäº‹ä»¶æ”¾å…¥Simulatorç±»çš„self.eventså±æ€§ä¸­ã€‚\n2. æ»¡è¶³ sim_time < end_time æ¡ä»¶æ˜¯ï¼Œè¿è¡Œä»¿çœŸç³»ç»Ÿçš„ä¸»å¾ªç¯ã€‚\n  * æ£€æŸ¥self.events å±æ€§æ˜¯å¦ä¸ºç©ºï¼›å¦‚æœä¸ºç©ºï¼Œè·³å‡ºå¾ªç¯\n  * ä»self.events ä¸­è·å–å½“å‰äº‹ä»¶\n  * æ˜¾ç¤ºè·å–çš„Eventå¯¹è±¡\n  * è·å–curent_event çš„time å±æ€§ï¼Œæ›´æ–°ä»¿çœŸæ—¶é—´\n  * æŠŠæ—¶é—´å‘é€ç»™current_event çš„proå±æ€§æ ‡è¯†çš„åç¨‹ï¼Œäº§å‡ºä¸‹ä¸€ä¸ªäº‹ä»¶\n  * æŠŠnext_event æ·»åŠ åˆ°self.events é˜Ÿåˆ—ä¸­ï¼Œæ’å®š next_event \n\næˆ‘ä»¬ä»£ç ä¸­ while å¾ªç¯æœ‰ä¸€ä¸ªelse è¯­å¥ï¼Œä»¿çœŸç³»ç»Ÿåˆ°è¾¾ç»“æŸæ—¶é—´åï¼Œä»£ç ä¼šæ‰§è¡Œelseä¸­çš„è¯­å¥ã€‚\n\nè¿™ä¸ªç¤ºä¾‹ä¸»è¦æ˜¯æƒ³è¯´æ˜å¦‚ä½•åœ¨ä¸€ä¸ªä¸»å¾ªç¯ä¸­å¤„ç†äº‹ä»¶ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å‘é€æ•°æ®é©±åŠ¨åç¨‹ï¼ŒåŒæ—¶è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ç”Ÿæˆå™¨ä»£æ›¿çº¿ç¨‹å’Œå›è°ƒï¼Œå®ç°å¹¶å‘ã€‚\n\n> å¹¶å‘ï¼š å¤šä¸ªä»»åŠ¡äº¤æ›¿æ‰§è¡Œ\n>\n> å¹¶è¡Œï¼š å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ\n\nåˆ°è¿™é‡Œ Pythonåç¨‹ç³»åˆ—çš„ä¸‰ç¯‡æ–‡ç« å°±ç»“æŸäº†ã€‚\n\n> æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œåç¨‹åšé¢å‘äº‹ä»¶ç¼–ç¨‹æ—¶ï¼Œä¼šä¸æ–­æŠŠæ§åˆ¶æƒè®©æ­¥ç»™ä¸»å¾ªç¯ï¼Œæ¿€æ´»å¹¶å‘å‰è¿è¡Œå…¶ä»–åç¨‹ï¼Œä»è€Œæ‰§è¡Œå„ä¸ªå¹¶å‘æ´»åŠ¨ã€‚\n>\n> åç¨‹ä¸€ç§åä½œå¼å¤šä»»åŠ¡ï¼šåç¨‹æ˜¾å¼è‡ªä¸»çš„æŠŠæ§åˆ¶æƒè®©æ­¥ç»™ä¸­å¤®è°ƒåº¦ç¨‹åºã€‚\n>\n> å¤šçº¿ç¨‹å®ç°çš„æ˜¯æŠ¢å å¼å¤šä»»åŠ¡ã€‚è°ƒåº¦ç¨‹åºå¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»æš‚åœçº¿ç¨‹ï¼ŒæŠŠæ§åˆ¶æƒäº¤ç»™å…¶ä»–çº¿ç¨‹\n\n## å‰ä¸¤ç¯‡æ–‡ç« \n\n[python åç¨‹1ï¼šåç¨‹10åˆ†é’Ÿå…¥é—¨](https://gusibi.github.io/post/python-coroutine-1-yield/)\n[python åç¨‹2ï¼šyield from ä»å…¥é—¨åˆ°ç²¾é€š](https://gusibi.github.io/post/python-coroutine-yield-from/)\n\nå†æ¬¡è¯´æ˜ä¸€ä¸‹ï¼Œè¿™å‡ ç¯‡æ˜¯ã€Šæµç•…çš„pythonã€‹ä¸€ä¹¦çš„è¯»ä¹¦ç¬”è®°ï¼Œä½œè€…æä¾›äº†å¤§é‡çš„æ‰©å±•é˜…è¯»ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ã€‚\n\n## æ‰©å±•é˜…è¯»\n\n* [Generator Tricks for Systems Programmers](http://www.dabeaz.com/generators/)\n* [A Curious Course on Coroutines and Concurrency](http://www.dabeaz.com/coroutines/)\n* [Generators: The Final Frontier](http://www.dabeaz.com/finalgenerator/)\n* [greedy algorithm with coroutines](http://seriously.dontusethiscode.com/2013/05/01/greedy-coroutine.html)\n* BinaryTreeç±»ã€ä¸€ä¸ªç®€å•çš„XMLè§£æå™¨ã€å’Œä¸€ä¸ªä»»åŠ¡è°ƒåº¦å™¨[Proposal for a yield from statement for Python](http://www.cosc.canterbury.ac.nz/greg.ewing/python/yield-from/yield_from.html)\n* [è€ƒè™‘ç”¨åç¨‹æ“ä½œå¤šä¸ªå‡½æ•°](http://www.effectivepython.com/2015/03/10/consider-coroutines-to-run-many-functions-concurrently/)\n\n--------------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonåç¨‹3ï¼šç”¨ä»¿çœŸå®éªŒå­¦ä¹ åç¨‹",
        "date": "2017-06-15 11:22:49",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°",
          "å¹¶å‘"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-coroutine-3"
    },
    {
      "content": "\nä¸Šä¸€ç¯‡[pythonåç¨‹1ï¼šyieldçš„ä½¿ç”¨](https://mp.weixin.qq.com/s?__biz=MzAwNjI5MjAzNw==&mid=2655751983&idx=1&sn=e4c093c6e5d6e4e8281d76db7c67eb23)ä»‹ç»äº†ï¼š\n\n* ç”Ÿæˆå™¨ä½œä¸ºåç¨‹ä½¿ç”¨æ—¶çš„è¡Œä¸ºå’ŒçŠ¶æ€\n* ä½¿ç”¨è£…é¥°å™¨é¢„æ¿€åç¨‹\n* è°ƒç”¨æ–¹å¦‚ä½•ä½¿ç”¨ç”Ÿæˆå™¨å¯¹è±¡çš„ .throw(...) å’Œ .close() æ–¹æ³•æ§åˆ¶åç¨‹\n\nè¿™ä¸€ç¯‡å°†ä»‹ç»ï¼š\n\n* åç¨‹ç»ˆæ­¢æ—¶å¦‚ä½•è¿”å›å€¼\n* yieldæ–°å¥æ³•çš„ç”¨é€”å’Œè¯­ä¹‰\n\nHUGOMORE42\n\n## è®©åç¨‹è¿”å›å€¼\n\nå…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼š\nè¿™æ®µä»£ç ä¼šè¿”å›æœ€ç»ˆå‡å€¼çš„ç»“æœï¼Œæ¯æ¬¡æ¿€æ´»åç¨‹æ—¶ä¸ä¼šäº§å‡ºç§»åŠ¨å¹³å‡å€¼ï¼Œè€Œæ˜¯æœ€åä¸€æ¬¡è¿”å›ã€‚\n\n```python\n#! -*- coding: utf-8 -*-\n\nfrom collections import namedtuple\n\nResult = namedtuple('Result', 'count average')\n\n\ndef averager():\n    total = 0.0\n    count = 0\n    average = None\n    while True:\n        term = yield\n        if term is None:\n            break  # ä¸ºäº†è¿”å›å€¼ï¼Œåç¨‹å¿…é¡»æ­£å¸¸ç»ˆæ­¢ï¼›è¿™é‡Œæ˜¯é€€å‡ºæ¡ä»¶\n        total += term\n        count += 1\n        average = total/count\n    # è¿”å›ä¸€ä¸ªnamedtupleï¼ŒåŒ…å«countå’Œaverageä¸¤ä¸ªå­—æ®µã€‚åœ¨python3.3å‰ï¼Œå¦‚æœç”Ÿæˆå™¨è¿”å›å€¼ï¼Œä¼šæŠ¥é”™\n    return Result(count, average)\n```\n\næˆ‘ä»¬è°ƒç”¨è¿™æ®µä»£ç ï¼Œç»“æœå¦‚ä¸‹\n\n```python\n>>> coro_avg = averager()\n>>> next(coro_avg)\n>>> coro_avg.send(20) # å¹¶æ²¡æœ‰è¿”å›å€¼\n>>> coro_avg.send(30)\n>>> coro_avg.send(40)\n>>> coro_avg.send(None) # å‘é€Noneç»ˆæ­¢å¾ªç¯ï¼Œå¯¼è‡´åç¨‹ç»“æŸã€‚ç”Ÿæˆå™¨å¯¹è±¡ä¼šæŠ›å‡ºStopIterationå¼‚å¸¸ã€‚å¼‚å¸¸å¯¹è±¡çš„valueå±æ€§ä¿å­˜ç€è¿”å›å€¼ã€‚\nTraceback (most recent call last):\n   ...\nStopIteration: Result(count=3, average=30)\n```\n\n> return è¡¨è¾¾å¼çš„å€¼ä¼šä¼ ç»™è°ƒç”¨æ–¹ï¼Œ*èµ‹å€¼ç»™StopIteration* å¼‚å¸¸çš„ä¸€ä¸ªå±æ€§ã€‚è¿™æ ·åšè™½ç„¶çœ‹ç€åˆ«æ‰­ï¼Œä½†ä¸ºäº†ä¿ç•™ç”Ÿæˆå™¨å¯¹è±¡è€—å°½æ—¶æŠ›å‡ºStopIterationå¼‚å¸¸çš„è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥ç†è§£ã€‚\n\nå¦‚æœæˆ‘ä»¬æƒ³è·å–åç¨‹çš„è¿”å›å€¼ï¼Œå¯ä»¥è¿™ä¹ˆæ“ä½œï¼š\n\n```python\n>>> coro_avg = averager()\n>>> next(coro_avg)\n>>> coro_avg.send(20) # å¹¶æ²¡æœ‰è¿”å›å€¼\n>>> coro_avg.send(30)\n>>> coro_avg.send(40)\n>>> try:\n...     coro_avg.send(None)\n... except StopIteration as exc:\n...     result = exc.value\n...\n>>> result\nResult(count=3, average=30)\n\n```\n\nçœ‹åˆ°è¿™æˆ‘ä»¬ä¼šè¯´ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Œä¸ºä»€ä¹ˆè·å–è¿”å›å€¼è¦ç»•è¿™ä¹ˆä¸€å¤§åœˆï¼Œå°±æ²¡æœ‰ç®€å•çš„æ–¹æ³•å—ï¼Ÿ\n\næœ‰çš„ï¼Œé‚£å°±æ˜¯ *yield from*\n\nyield from ç»“æœä¼šåœ¨å†…éƒ¨è‡ªåŠ¨æ•è·StopIteration å¼‚å¸¸ã€‚è¿™ç§å¤„ç†æ–¹å¼ä¸ for å¾ªç¯å¤„ç†StopIterationå¼‚å¸¸çš„æ–¹å¼ä¸€æ ·ã€‚\nå¯¹äºyield from ç»“æ„æ¥è¯´ï¼Œè§£é‡Šå™¨ä¸ä»…ä¼šæ•è·StopIterationå¼‚å¸¸ï¼Œè¿˜ä¼šæŠŠvalueå±æ€§çš„å€¼å˜æˆyield from è¡¨è¾¾å¼çš„å€¼ã€‚\n\n> åœ¨å‡½æ•°å¤–éƒ¨ä¸èƒ½ä½¿ç”¨yield fromï¼ˆyieldä¹Ÿä¸è¡Œï¼‰ã€‚\n\næ—¢ç„¶æˆ‘ä»¬æåˆ°äº† *yield from* é‚£yield from æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\n## yield from\n\nyield from æ˜¯ Python3.3 åæ–°åŠ çš„è¯­è¨€ç»“æ„ã€‚å’Œå…¶ä»–è¯­è¨€çš„awaitå…³é”®å­—ç±»ä¼¼ï¼Œå®ƒè¡¨ç¤ºï¼š*åœ¨ç”Ÿæˆå™¨ gen ä¸­ä½¿ç”¨ yield from subgen()æ—¶ï¼Œsubgen ä¼šè·å¾—æ§åˆ¶æƒï¼ŒæŠŠäº§å‡ºçš„å€¼ä¼ ä¸ªgençš„è°ƒç”¨æ–¹ï¼Œå³è°ƒç”¨æ–¹å¯ä»¥ç›´æ¥æ§åˆ¶subgenã€‚äºæ­¤åŒæ—¶ï¼Œgenä¼šé˜»å¡ï¼Œç­‰å¾…subgenç»ˆæ­¢ã€‚\n\nyield from å¯ç”¨äºç®€åŒ–forå¾ªç¯ä¸­çš„yieldè¡¨è¾¾å¼ã€‚\n\nä¾‹å¦‚ï¼š\n\n```python\ndef gen():\n    for c in 'AB':\n        yield c\n    for i in range(1, 3):\n        yield i\n\nlist(gen())\n['A', 'B', '1', '2']\n```\n\nå¯ä»¥æ”¹å†™ä¸ºï¼š\n\n```python\ndef gen():\n    yield from 'AB'\n    yield from range(1, 3)\n    \n\nlist(gen())\n['A', 'B', '1', '2']\n```\n\nä¸‹é¢æ¥çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ï¼š(æ¥è‡ªPython cookbook 3 ï¼Œgithubæºç åœ°å€ [https://github.com/dabeaz/python-cookbook/blob/master/src/4/how_to_flatten_a_nested_sequence/example.py](https://github.com/dabeaz/python-cookbook/blob/master/src/4/how_to_flatten_a_nested_sequence/example.py))\n\n```python\n# Example of flattening a nested sequence using subgenerators\n\nfrom collections import Iterable\n\ndef flatten(items, ignore_types=(str, bytes)):\n    for x in items:\n        if isinstance(x, Iterable) and not isinstance(x, ignore_types):\n            yield from flatten(x) # è¿™é‡Œé€’å½’è°ƒç”¨ï¼Œå¦‚æœxæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œç»§ç»­åˆ†è§£\n        else:\n            yield x\n\nitems = [1, 2, [3, 4, [5, 6], 7], 8]\n\n# Produces 1 2 3 4 5 6 7 8\nfor x in flatten(items):\n    print(x)\n\nitems = ['Dave', 'Paula', ['Thomas', 'Lewis']]\nfor x in flatten(items):\n    print(x)\n```\n\nyield from x è¡¨è¾¾å¼å¯¹xå¯¹è±¡åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œè°ƒç”¨ iter(x)ï¼Œè·å–è¿­ä»£å™¨ã€‚æ‰€ä»¥è¦æ±‚xæ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚\n\nPEP380 çš„æ ‡é¢˜æ˜¯ â€syntax for delegating to subgeneratorâ€œ(æŠŠæŒ‡è´£å§”æ‰˜ç»™å­ç”Ÿæˆå™¨çš„å¥æ³•)ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œyield fromæ˜¯å¯ä»¥å®ç°åµŒå¥—ç”Ÿæˆå™¨çš„ä½¿ç”¨ã€‚\n\nyield from çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰“å¼€åŒå‘é€šé“ï¼ŒæŠŠæœ€å¤–å±‚çš„è°ƒç”¨æ–¹ä¸æœ€å†…å±‚çš„å­ç”Ÿæˆå™¨è¿æ¥èµ·æ¥ï¼Œä½¿ä¸¤è€…å¯ä»¥ç›´æ¥å‘é€å’Œäº§å‡ºå€¼ï¼Œè¿˜å¯ä»¥ç›´æ¥ä¼ å…¥å¼‚å¸¸ï¼Œè€Œä¸ç”¨åœ¨ä¸­é—´çš„åç¨‹æ·»åŠ å¼‚å¸¸å¤„ç†çš„ä»£ç ã€‚\n\nyield from åŒ…å«å‡ ä¸ªæ¦‚å¿µï¼š\n\n* å§”æ´¾ç”Ÿæˆå™¨\n\nåŒ…å«yield from <iterable> è¡¨è¾¾å¼çš„ç”Ÿæˆå™¨å‡½æ•°\n\n* å­ç”Ÿæˆå™¨\n\nä»yield from <iterable> éƒ¨åˆ†è·å–çš„ç”Ÿæˆå™¨ã€‚\n\n* è°ƒç”¨æ–¹\n\nè°ƒç”¨å§”æ´¾ç”Ÿæˆå™¨çš„å®¢æˆ·ç«¯ï¼ˆè°ƒç”¨æ–¹ï¼‰ä»£ç \n\nè¿™ä¸ªç¤ºæ„å›¾æ˜¯ å¯¹yield from çš„è°ƒç”¨è¿‡ç¨‹\n\n![](http://omuo4kh1k.bkt.clouddn.com/z6VQ9oWIy-KOo2eJckn6_FDzRaiZoxdyyvbe-QstGCLw5p5AlJ43coiNPMy23Rup)\n\nå§”æ´¾ç”Ÿæˆå™¨åœ¨ yield from è¡¨è¾¾å¼å¤„æš‚åœæ—¶ï¼Œè°ƒç”¨æ–¹å¯ä»¥ç›´æ¥æŠŠæ•°æ®å‘ç»™å­—ç”Ÿæˆå™¨ï¼Œå­ç”Ÿæˆå™¨å†æŠŠäº§å‡ºçš„å€¼å‘é€ç»™è°ƒç”¨æ–¹ã€‚å­ç”Ÿæˆå™¨è¿”å›ä¹‹åï¼Œè§£é‡Šå™¨ä¼šæŠ›å‡ºStopIterationå¼‚å¸¸ï¼Œå¹¶æŠŠè¿”å›å€¼é™„åŠ åˆ°å¼‚å¸¸å¯¹è±¡ä¸Šï¼Œåªæ˜¯å§”æ´¾ç”Ÿæˆå™¨æ¢å¤ã€‚\n\n> è¿™ä¸ªå›¾æ¥è‡ªäºPaul\n Sokolovsky çš„ [How Python 3.3 \"yield from\" construct works](http://flupy.org/resources/yield-from.pdf)\n\n ä¸‹è¾¹è¿™ä¸ªä¾‹å­æ˜¯å¯¹yield from çš„ä¸€ä¸ªåº”ç”¨ï¼š\n\n\n```python\n #! -*- coding: utf-8 -*-\n\nfrom collections import namedtuple\n\n\nResult = namedtuple('Result', 'count average')\n\n\n# å­ç”Ÿæˆå™¨\n# è¿™ä¸ªä¾‹å­å’Œä¸Šè¾¹ç¤ºä¾‹ä¸­çš„ averager åç¨‹ä¸€æ ·ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯ä½œä¸ºå­—ç”Ÿæˆå™¨ä½¿ç”¨\ndef averager():\n    total = 0.0\n    count = 0\n    average = None\n    while True:\n        # main å‡½æ•°å‘é€æ•°æ®åˆ°è¿™é‡Œ \n        term = yield\n        if term is None: # ç»ˆæ­¢æ¡ä»¶\n            break\n        total += term\n        count += 1\n        average = total/count\n    return Result(count, average) # è¿”å›çš„Result ä¼šæˆä¸ºgrouperå‡½æ•°ä¸­yield fromè¡¨è¾¾å¼çš„å€¼\n\n\n# å§”æ´¾ç”Ÿæˆå™¨\ndef grouper(results, key):\n     # è¿™ä¸ªå¾ªç¯æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªaverager å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä½œä¸ºåç¨‹ä½¿ç”¨çš„ç”Ÿæˆå™¨å¯¹è±¡\n    while True:\n        # grouper å‘é€çš„æ¯ä¸ªå€¼éƒ½ä¼šç»ç”±yield from å¤„ç†ï¼Œé€šè¿‡ç®¡é“ä¼ ç»™averager å®ä¾‹ã€‚grouperä¼šåœ¨yield fromè¡¨è¾¾å¼å¤„æš‚åœï¼Œç­‰å¾…averagerå®ä¾‹å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å€¼ã€‚averagerå®ä¾‹è¿è¡Œå®Œæ¯•åï¼Œè¿”å›çš„å€¼ç»‘å®šåˆ°results[key] ä¸Šã€‚while å¾ªç¯ä¼šä¸æ–­åˆ›å»ºaveragerå®ä¾‹ï¼Œå¤„ç†æ›´å¤šçš„å€¼ã€‚\n        results[key] = yield from averager()\n\n\n# è°ƒç”¨æ–¹\ndef main(data):\n    results = {}\n    for key, values in data.items():\n        # group æ˜¯è°ƒç”¨grouperå‡½æ•°å¾—åˆ°çš„ç”Ÿæˆå™¨å¯¹è±¡ï¼Œä¼ ç»™grouper å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯resultsï¼Œç”¨äºæ”¶é›†ç»“æœï¼›ç¬¬äºŒä¸ªæ˜¯æŸä¸ªé”®\n        group = grouper(results, key)\n        next(group)\n        for value in values:\n            # æŠŠå„ä¸ªvalueä¼ ç»™grouper ä¼ å…¥çš„å€¼æœ€ç»ˆåˆ°è¾¾averagerå‡½æ•°ä¸­ï¼›\n            # grouperå¹¶ä¸çŸ¥é“ä¼ å…¥çš„æ˜¯ä»€ä¹ˆï¼ŒåŒæ—¶grouperå®ä¾‹åœ¨yield fromå¤„æš‚åœ\n            group.send(value)\n        # æŠŠNoneä¼ å…¥groupperï¼Œä¼ å…¥çš„å€¼æœ€ç»ˆåˆ°è¾¾averagerå‡½æ•°ä¸­ï¼Œå¯¼è‡´å½“å‰å®ä¾‹ç»ˆæ­¢ã€‚ç„¶åç»§ç»­åˆ›å»ºä¸‹ä¸€ä¸ªå®ä¾‹ã€‚\n        # å¦‚æœæ²¡æœ‰group.send(None)ï¼Œé‚£ä¹ˆaveragerå­ç”Ÿæˆå™¨æ°¸è¿œä¸ä¼šç»ˆæ­¢ï¼Œå§”æ´¾ç”Ÿæˆå™¨ä¹Ÿæ°¸è¿œä¸ä¼šåœ¨æ­¤æ¿€æ´»ï¼Œä¹Ÿå°±ä¸ä¼šä¸ºresult[key]èµ‹å€¼\n        group.send(None)\n    report(results)\n\n\n# è¾“å‡ºæŠ¥å‘Š\ndef report(results):\n    for key, result in sorted(results.items()):\n        group, unit = key.split(';')\n        print('{:2} {:5} averaging {:.2f}{}'.format(result.count, group, result.average, unit))\n\n\ndata = {\n    'girls;kg':[40, 41, 42, 43, 44, 54],\n    'girls;m': [1.5, 1.6, 1.8, 1.5, 1.45, 1.6],\n    'boys;kg':[50, 51, 62, 53, 54, 54],\n    'boys;m': [1.6, 1.8, 1.8, 1.7, 1.55, 1.6],\n}\n\nif __name__ == '__main__':\n    main(data)\n```\n\n> è¿™æ®µä»£ç ä»ä¸€ä¸ªå­—å…¸ä¸­è¯»å–ç”·ç”Ÿå’Œå¥³ç”Ÿçš„èº«é«˜å’Œä½“é‡ã€‚ç„¶åæŠŠæ•°æ®ä¼ ç»™ä¹‹å‰å®šä¹‰çš„ averager åç¨‹ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šã€‚\n\næ‰§è¡Œç»“æœä¸º\n\n```python\n6 boys  averaging 54.00kg\n6 boys  averaging 1.68m\n6 girls averaging 44.00kg\n6 girls averaging 1.58m\n```\n\nè¿™æ–­ä»£ç å±•ç¤ºäº†yield from ç»“æ„æœ€ç®€å•çš„ç”¨æ³•ã€‚å§”æ´¾ç”Ÿæˆå™¨ç›¸å½“äºç®¡é“ï¼Œæ‰€ä»¥å¯ä»¥æŠŠä»»æ„æ•°é‡çš„å§”æ´¾ç”Ÿæˆå™¨è¿æ¥åœ¨ä¸€èµ·---ä¸€ä¸ªå§”æ´¾ç”Ÿæˆå™¨ä½¿ç”¨yield from è°ƒç”¨ä¸€ä¸ªå­ç”Ÿæˆå™¨ï¼Œè€Œé‚£ä¸ªå­ç”Ÿæˆå™¨æœ¬èº«ä¹Ÿæ˜¯å§”æ´¾ç”Ÿæˆå™¨ï¼Œä½¿ç”¨yield fromè°ƒç”¨å¦ä¸€ä¸ªç”Ÿæˆå™¨ã€‚æœ€ç»ˆä»¥ä¸€ä¸ªåªæ˜¯ç”¨yieldè¡¨è¾¾å¼çš„ç”Ÿæˆå™¨ï¼ˆæˆ–è€…ä»»æ„å¯è¿­ä»£å¯¹è±¡ï¼‰ç»“æŸã€‚\n\n## yield from çš„æ„ä¹‰\n\nPEP380 åˆ†6ç‚¹è¯´æ˜äº†yield from çš„è¡Œä¸ºã€‚\n\n* å­ç”Ÿæˆå™¨äº§å‡ºçš„å€¼éƒ½ç›´æ¥ä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨çš„è°ƒç”¨æ–¹ï¼ˆå®¢æˆ·ç«¯ä»£ç ï¼‰\n* ä½¿ç”¨send() æ–¹æ³•å‘ç»™å§”æ´¾ç”Ÿæˆå™¨çš„å€¼éƒ½ç›´æ¥ä¼ ç»™å­ç”Ÿæˆå™¨ã€‚å¦‚æœå‘é€çš„å€¼æ˜¯Noneï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„ __next__()æ–¹æ³•ã€‚å¦‚æœå‘é€çš„å€¼ä¸æ˜¯Noneï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„send()æ–¹æ³•ã€‚å¦‚æœè°ƒç”¨çš„æ–¹æ³•æŠ›å‡ºStopIterationå¼‚å¸¸ï¼Œé‚£ä¹ˆå§”æ´¾ç”Ÿæˆå™¨æ¢å¤è¿è¡Œã€‚ä»»ä½•å…¶ä»–å¼‚å¸¸éƒ½ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨ã€‚\n* ç”Ÿæˆå™¨é€€å‡ºæ—¶ï¼Œç”Ÿæˆå™¨ï¼ˆæˆ–å­ç”Ÿæˆå™¨ï¼‰ä¸­çš„return expr è¡¨è¾¾å¼ä¼šè§¦å‘ StopIteration(expr) å¼‚å¸¸æŠ›å‡ºã€‚\n* yield fromè¡¨è¾¾å¼çš„å€¼æ˜¯å­ç”Ÿæˆå™¨ç»ˆæ­¢æ—¶ä¼ ç»™StopIterationå¼‚å¸¸çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚\n* ä¼ å…¥å§”æ´¾ç”Ÿæˆå™¨çš„å¼‚å¸¸ï¼Œé™¤äº† GeneratorExit ä¹‹å¤–éƒ½ä¼ ç»™å­ç”Ÿæˆå™¨çš„throw()æ–¹æ³•ã€‚å¦‚æœè°ƒç”¨throw()æ–¹æ³•æ—¶æŠ›å‡º StopIteration å¼‚å¸¸ï¼Œå§”æ´¾ç”Ÿæˆå™¨æ¢å¤è¿è¡Œã€‚StopIterationä¹‹å¤–çš„å¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ã€‚ä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨ã€‚\n* å¦‚æœæŠŠ GeneratorExit å¼‚å¸¸ä¼ å…¥å§”æ´¾ç”Ÿæˆå™¨ï¼Œæˆ–è€…åœ¨å§”æ´¾ç”Ÿæˆå™¨ä¸Šè°ƒç”¨close() æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å­ç”Ÿæˆå™¨ä¸Šè°ƒç”¨close() æ–¹æ³•ï¼Œå¦‚æœä»–æœ‰çš„è¯ã€‚å¦‚æœè°ƒç”¨close() æ–¹æ³•å¯¼è‡´å¼‚å¸¸æŠ›å‡ºï¼Œé‚£ä¹ˆå¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨ï¼›å¦åˆ™ï¼Œå§”æ´¾ç”Ÿæˆå™¨æŠ›å‡º GeneratorExit å¼‚å¸¸ã€‚\n\nyield fromçš„å…·ä½“è¯­ä¹‰å¾ˆéš¾ç†è§£ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹Greg Ewing çš„ä¼ªä»£ç ï¼Œé€šè¿‡ä¼ªä»£ç åˆ†æä¸€ä¸‹ï¼š\n\n```python\nRESULT = yield from EXPR\n\n# is semantically equivalent to\n# EXPR å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼Œå› ä¸ºè·å–è¿­ä»£å™¨_i ä½¿ç”¨çš„æ˜¯iter()å‡½æ•°ã€‚\n_i = iter(EXPR)\ntry:\n    _y = next(_i) # 2 é¢„æ¿€å­—ç”Ÿæˆå™¨ï¼Œç»“æœä¿å­˜åœ¨_y ä¸­ï¼Œä½œä¸ºç¬¬ä¸€ä¸ªäº§å‡ºçš„å€¼\nexcept StopIteration as _e:\n    # 3 å¦‚æœè°ƒç”¨çš„æ–¹æ³•æŠ›å‡ºStopIterationå¼‚å¸¸ï¼Œè·å–å¼‚å¸¸å¯¹è±¡çš„valueå±æ€§ï¼Œèµ‹å€¼ç»™_r\n    _r = _e.value\nelse:\n    while 1: # 4 è¿è¡Œè¿™ä¸ªå¾ªç¯æ—¶ï¼Œå§”æ´¾ç”Ÿæˆå™¨ä¼šé˜»å¡ï¼Œåªèƒ½ä½œä¸ºè°ƒç”¨æ–¹å’Œå­ç”Ÿæˆå™¨ç›´æ¥çš„é€šé“\n        try:\n            _s = yield _y # 5 äº§å‡ºå­ç”Ÿæˆå™¨å½“å‰äº§å‡ºçš„å…ƒç´ ï¼›ç­‰å¾…è°ƒç”¨æ–¹å‘é€_sä¸­ä¿å­˜çš„å€¼ã€‚\n        except GeneratorExit as _e:\n            # 6 è¿™ä¸€éƒ¨åˆ†æ˜¯ç”¨äºå…³é—­å§”æ´¾ç”Ÿæˆå™¨å’Œå­ç”Ÿæˆå™¨ï¼Œå› ä¸ºå­ç”Ÿæˆå™¨å¯ä»¥æ˜¯ä»»æ„å¯è¿­ä»£å¯¹è±¡ï¼Œæ‰€ä»¥å¯èƒ½æ²¡æœ‰close() æ–¹æ³•ã€‚\n            try:\n                _m = _i.close\n            except AttributeError:\n                pass\n            else:\n                _m()\n            # å¦‚æœè°ƒç”¨close() æ–¹æ³•å¯¼è‡´å¼‚å¸¸æŠ›å‡ºï¼Œé‚£ä¹ˆå¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨ï¼›å¦åˆ™ï¼Œå§”æ´¾ç”Ÿæˆå™¨æŠ›å‡º GeneratorExit å¼‚å¸¸ã€‚\n            raise _e\n        except BaseException as _e: # 7 è¿™ä¸€éƒ¨åˆ†å¤„ç†è°ƒç”¨æ–¹é€šè¿‡.throw() æ–¹æ³•ä¼ å…¥çš„å¼‚å¸¸ã€‚å¦‚æœå­ç”Ÿæˆå™¨æ˜¯è¿­ä»£å™¨ï¼Œæ²¡æœ‰throw()æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µä¼šå¯¼è‡´å§”æ´¾ç”Ÿæˆå™¨æŠ›å‡ºå¼‚å¸¸\n            _x = sys.exc_info()\n            try:\n                # ä¼ å…¥å§”æ´¾ç”Ÿæˆå™¨çš„å¼‚å¸¸ï¼Œé™¤äº† GeneratorExit ä¹‹å¤–éƒ½ä¼ ç»™å­ç”Ÿæˆå™¨çš„throw()æ–¹æ³•ã€‚\n                _m = _i.throw\n            except AttributeError:\n                # å­ç”Ÿæˆå™¨ä¸€è¿­ä»£å™¨ï¼Œæ²¡æœ‰throw()æ–¹æ³•ï¼Œ è°ƒç”¨throw()æ–¹æ³•æ—¶æŠ›å‡ºAttributeErrorå¼‚å¸¸ä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨\n                raise _e\n            else: # 8\n                try:\n                    _y = _m(*_x)\n                except StopIteration as _e:\n                     # å¦‚æœè°ƒç”¨throw()æ–¹æ³•æ—¶æŠ›å‡º StopIteration å¼‚å¸¸ï¼Œå§”æ´¾ç”Ÿæˆå™¨æ¢å¤è¿è¡Œã€‚\n                     # StopIterationä¹‹å¤–çš„å¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ã€‚ä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨ã€‚\n                    _r = _e.value\n                    break\n        else: # 9 å¦‚æœäº§å‡ºå€¼æ—¶æ²¡æœ‰å¼‚å¸¸\n            try: # 10 å°è¯•è®©å­ç”Ÿæˆå™¨å‘å‰æ‰§è¡Œ\n                if _s is None: \n                    # 11. å¦‚æœå‘é€çš„å€¼æ˜¯Noneï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„ __next__()æ–¹æ³•ã€‚\n                    _y = next(_i)\n                else:\n                    # 11. å¦‚æœå‘é€çš„å€¼ä¸æ˜¯Noneï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„send()æ–¹æ³•ã€‚\n                    _y = _i.send(_s)\n            except StopIteration as _e: # 12\n                # 2. å¦‚æœè°ƒç”¨çš„æ–¹æ³•æŠ›å‡ºStopIterationå¼‚å¸¸ï¼Œè·å–å¼‚å¸¸å¯¹è±¡çš„valueå±æ€§ï¼Œèµ‹å€¼ç»™_r, é€€å‡ºå¾ªç¯ï¼Œå§”æ´¾ç”Ÿæˆå™¨æ¢å¤è¿è¡Œã€‚ä»»ä½•å…¶ä»–å¼‚å¸¸éƒ½ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ ç»™å§”æ´¾ç”Ÿæˆå™¨ã€‚\n                _r = _e.value \n                break\nRESULT = _r #13 è¿”å›çš„ç»“æœæ˜¯ _r å³æ•´ä¸ªyield fromè¡¨è¾¾å¼çš„å€¼\n```\n\nä¸Šæ®µä»£ç å˜é‡è¯´æ˜:\n\n* _i è¿­ä»£å™¨ï¼ˆå­ç”Ÿæˆå™¨ï¼‰\n* _y äº§å‡ºçš„å€¼ ï¼ˆå­ç”Ÿæˆå™¨äº§å‡ºçš„å€¼ï¼‰\n* _r ç»“æœ ï¼ˆæœ€ç»ˆçš„ç»“æœ  å³æ•´ä¸ªyield fromè¡¨è¾¾å¼çš„å€¼ï¼‰\n* _s å‘é€çš„å€¼ ï¼ˆè°ƒç”¨æ–¹å‘ç»™å§”æ´¾ç”Ÿæˆå™¨çš„å€¼ï¼Œè¿™ä¸ªåªä¼šä¼ ç»™å­ç”Ÿæˆå™¨ï¼‰\n* _e å¼‚å¸¸ ï¼ˆå¼‚å¸¸å¯¹è±¡ï¼‰\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä»£ç çš„ç¬¬ä¸€ä¸ª try éƒ¨åˆ† ä½¿ç”¨ _y = next(_i) é¢„æ¿€äº†å­ç”Ÿæˆå™¨ã€‚è¿™å¯ä»¥çœ‹å‡ºï¼Œä¸Šä¸€ç¯‡æˆ‘ä»¬ä½¿ç”¨çš„ç”¨äºè‡ªåŠ¨é¢„æ¿€çš„è£…é¥°å™¨ä¸yield from è¯­å¥ä¸å…¼å®¹ã€‚\n\né™¤äº†è¿™æ®µä¼ªä»£ç ä¹‹å¤–ï¼Œ[PEP380](https://www.python.org/dev/peps/pep-0380/#proposal) è¿˜æœ‰ä¸ªè¯´æ˜ï¼š\n\n```python\nIn a generator, the statement\n\nreturn value\n\nis semantically equivalent to\n\nraise StopIteration(value)\n\nexcept that, as currently, the exception cannot be caught by except clauses within the returning generator.\n```\n\nè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ yield from å¯ä»¥ä½¿ç”¨return æ¥è¿”å›å€¼è€Œ yield åªèƒ½ä½¿ç”¨ try ... except StopIteration ... æ¥æ•è·å¼‚å¸¸çš„value å€¼ã€‚\n\n```python\n>>> try:\n...     coro_avg.send(None)\n... except StopIteration as exc:\n...     result = exc.value\n...\n>>> result\n```\n\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº† yield from çš„å…·ä½“ç»†èŠ‚ã€‚ä¸‹ä¸€ç¯‡ï¼Œä¼šåˆ†æä¸€ä¸ªä½¿ç”¨åç¨‹çš„ç»å…¸æ¡ˆä¾‹ï¼š ä»¿çœŸç¼–ç¨‹ã€‚è¿™ä¸ªæ¡ˆä¾‹è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨åç¨‹åœ¨å•çº¿ç¨‹ä¸­ç®¡ç†å¹¶å‘æ´»åŠ¨ã€‚\n\n## å‚è€ƒæ–‡æ¡£\n\n* æµç•…çš„python ç¬¬16ç« ï¼ˆè¿™æ˜¯è¯»ä¹¦ç¬”è®°ï¼Œè¿™æ˜¯è¯»ä¹¦ç¬”è®°ï¼‰\n* [PEP 380-- Syntax for Delegating to a Subgenerator](https://www.python.org/dev/peps/pep-0380/#proposal)\n* [How Python 3.3 \"yield from\" construct works](http://flupy.org/resources/yield-from.pdf)\n\n----------------\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "title": "pythonåç¨‹2ï¼šyield from ä»å…¥é—¨åˆ°ç²¾é€š",
        "date": "2017-06-14 09:22:49",
        "tags": [
          "python",
          "tutorial",
          "è¯»ä¹¦ç¬”è®°"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-coroutine-2"
    },
    {
      "content": "\n\n",
      "data": {
        "permalink": "/post/python-prototype-pattern",
        "title": "python è®¾è®¡æ¨¡å¼ ",
        "author": "goodspeed",
        "tags": [
          "python",
          "è®¾è®¡æ¨¡å¼"
        ],
        "date": "2016-12-04 08:22:54",
        "categories": [
          "development",
          "è¯»ä¹¦ç¬”è®°",
          "golang"
        ],
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-prototype-pattern"
    },
    {
      "content": "\n\n## python æ•°æ®ç»“æ„\n\n* Python çš„ list æ˜¯æ€ä¹ˆå›äº‹ï¼Œä¸ºä»€ä¹ˆæœ‰è¿‘ä¹æ— é™å¤§å°çš„ç©ºé—´ï¼Ÿä¸ºä»€ä¹ˆä¸“é—¨æœ‰ä¸€ä¸ªå›ºå®šé•¿åº¦ä¸”ä¸èƒ½ä¿®æ”¹çš„æ•°æ®ç»“æ„ tuple è€Œä¸å…¨ç”¨ listï¼Ÿ\n* list çš„ insert å’Œ append çš„è´¹æ—¶æ˜¯ä¸€æ ·çš„å—ï¼Ÿ\n* Python çš„ dict æ˜¯æ€ä¹ˆå›äº‹ï¼Œä¸ºä»€ä¹ˆå¯ä»¥ç”¨å­—ç¬¦ä¸²æ•°å­—ç­‰ç­‰ä¸œè¥¿æ¥ç´¢å¼•ï¼Ÿæ˜¯æ€ä¹ˆæœç´¢çš„ï¼Ÿåœ¨ dict ä¸­æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œå’Œåœ¨ list é‡Œé¢æ‰¾ä¸€ä¸ªå…ƒç´ æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n* Python å†…ç½®çš„ list, dict, set, ...æ•°æ®ç»“æ„ï¼Œä½ åº”è¯¥åœ¨ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ\n\nHUGOMORE42\n\nPythonä¸­å¸¸è§çš„æ•°æ®ç»“æ„å¯ä»¥ç»Ÿç§°ä¸ºå®¹å™¨ï¼ˆcontainerï¼‰ã€‚åºåˆ—ï¼ˆå¦‚åˆ—è¡¨å’Œå…ƒç»„ï¼‰ã€æ˜ å°„ï¼ˆå¦‚å­—å…¸ï¼‰ä»¥åŠé›†åˆï¼ˆsetï¼‰æ˜¯ä¸‰ç±»ä¸»è¦çš„å®¹å™¨ã€‚\n\n### åˆ—è¡¨\n\nå’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œåˆ—è¡¨ä¹Ÿæ˜¯åºåˆ—å¼çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡æˆ–è€…åˆ‡ç‰‡æ“ä½œæ¥è®¿é—®æŸä¸€ä¸ªæˆ–è€…æŸä¸€å—è¿ç»­çš„å…ƒç´ ã€‚\nä¸åŒä¹‹å¤„ï¼š\n1. åˆ—è¡¨å¯ä»¥åŒ…å«ä¸åŒç±»å‹çš„å¯¹è±¡\n2. åˆ—è¡¨é•¿åº¦æ˜¯å¯å˜çš„\n\npythonä¸­listå¹¶ä¸æ˜¯æˆ‘ä»¬ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åˆ—è¡¨ã€‚ä¼ ç»Ÿåˆ—è¡¨--é€šå¸¸ä¹Ÿå«åšé“¾è¡¨ï¼ˆlinked listï¼‰--é€šå¸¸æ˜¯ç”±ä¸€ç³»åˆ—èŠ‚ç‚¹æ¥å®ç°çš„ï¼Œå…¶æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå°¾èŠ‚ç‚¹é™¤å¤–ï¼‰ä¸­éƒ½æŒæœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚\n\né“¾è¡¨çš„ç®€å•å®ç°ï¼š\n\n```\n\nclass Node:\n\tdef __init__(self, value, next=None):\n\t\tself.value = value\n\t\tself.next = next\n\n\n>>> L = Node(\"a\", Node(\"b\", Node(\"c\", Node(\"d\"))))\n>>> L.next.next.value\n\n'c'\n\n# è¿™æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ã€‚åŒå‘é“¾è¡¨çš„å„èŠ‚ç‚¹ä¸­è¿˜éœ€æŒæœ‰ä¸€ä¸ªæŒ‡å‘å‰ä¸€èŠ‚ç‚¹çš„å¼•ç”¨ã€‚\n\n# TODO åŒå‘åˆ—è¡¨çš„å®ç°\n\n```\n\nä½†Pythonä¸­çš„liståˆ™ä¸æ­¤æœ‰äº›ä¸åŒã€‚å®ƒä¸æ˜¯ç”±è‹¥å¹²ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ç›¸äº’å¼•ç”¨è€Œæˆçš„ï¼Œè€Œæ˜¯ä¸€æ•´ä¸ªå•ä¸€è¿ç»­çš„å†…å­˜åŒºå—--æˆ‘ä»¬é€šå¸¸ç§°ä¹‹ä¸ºæ•°ç»„ï¼ˆarrayï¼‰ã€‚\n\n\n### æ ‘ä¸å›¾çš„å®ç°\n\n* é‚»æ¥åˆ—è¡¨åŠå…¶ç±»ä¼¼ç»“æ„\n* é‚»æ¥çŸ©é˜µ\n* æ ‘çš„å®ç°\n\n###\n",
      "data": {
        "permalink": "/post/python-data-structures",
        "title": "Python Data Structures",
        "author": "goodspeed",
        "tags": [
          "python",
          "ç®—æ³•"
        ],
        "date": "2016-10-16 14:03:53",
        "categories": [
          "development",
          "è¯»ä¹¦ç¬”è®°",
          "python"
        ],
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-data-structures"
    },
    {
      "content": "\n##\n\n### \n\n## å‚è€ƒé“¾æ¥\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![æ‰«ç å…³æ³¨](http://media.gusibi.mobi/zHqNew3j1brVxSoTkjOerslhnB_ZpchcOXf60lFUxiZ5YtnCHs5HrJNOP14go6Ea)\n\n---------------\n\n### å†…æ¨æ—¶é—´\n\n![](http://media.gusibi.mobi/5FzreeM6IYt55JSQMAV63INPIvuPik75FlJAbP1e7Zdlg1WPe6BrHI-q0jkXskGf)",
      "data": {
        "date": "",
        "title": "title",
        "author": "goodspeed",
        "permalink": "/post/url-path",
        "description": "description",
        "tags": [
          "xx",
          "xxxx"
        ],
        "categories": [
          "xxx",
          "xxxx"
        ],
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-design-pattern-decorator"
    },
    {
      "content": "\n\næœ€è¿‘æˆ‘ä»¬çš„ç½‘ç«™è¦åŠ å¾®ä¿¡ç™»å½•åŠŸèƒ½ï¼Œæ‰¾äº†python sdk æ„Ÿè§‰éƒ½ä¸æ»¡æ„ï¼Œç„¶åå°±å‚è€ƒinstagram python sdk è‡ªå·±é€ äº†è½®å­ã€‚\n\nè½®å­ github åœ°å€  [python-weixin](https://github.com/gusibi/python-weixin)\n\n### æ ¹æ®éœ€æ±‚é€‰æ‹©ç›¸åº”çš„ç™»å½•æ–¹å¼\n\nå¾®ä¿¡ç°åœ¨æä¾›ä¸¤ç§ç™»å½•æ¥å…¥æ–¹å¼\n\n* ç§»åŠ¨åº”ç”¨å¾®ä¿¡ç™»å½•\n* ç½‘ç«™åº”ç”¨å¾®ä¿¡ç™»å½•\n\nHUGOMORE42\n\n*è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç½‘ç«™åº”ç”¨å¾®ä¿¡ç™»å½•*\n\næŒ‰ç…§ å®˜æ–¹æµç¨‹\n\n1. æ³¨å†Œå¹¶é€šè¿‡å¼€æ”¾å¹³å°å¼€å‘è€…èµ„è´¨è®¤è¯\n\næ³¨å†Œå¾®ä¿¡å¼€æ”¾å¹³å°å¸å·åï¼Œåœ¨å¸å·ä¸­å¿ƒä¸­å¡«å†™å¼€å‘è€…èµ„è´¨è®¤è¯ç”³è¯·ï¼Œå¹¶ç­‰å¾…è®¤è¯é€šè¿‡ã€‚\n\n2. åˆ›å»ºç½‘ç«™åº”ç”¨\n\né€šè¿‡å¡«å†™ç½‘ç«™åº”ç”¨åç§°ã€ç®€ä»‹å’Œå›¾æ ‡ï¼Œä»¥åŠå„å¹³å°ä¸‹è½½åœ°å€ç­‰èµ„æ–™ï¼Œåˆ›å»ºç½‘ç«™åº”ç”¨\n\n3. æ¥å…¥å¾®ä¿¡ç™»å½•\n\nåœ¨èµ„æºä¸­å¿ƒæŸ¥é˜…ç½‘ç«™åº”ç”¨å¼€å‘æ–‡æ¡£,å¼€å‘æ¥å…¥å¾®ä¿¡ç™»é™†åŠŸèƒ½ï¼Œè®©ç”¨æˆ·å¯ä½¿ç”¨å¾®ä¿¡ç™»å½•ä½ çš„ç½‘ç«™åº”ç”¨\n\n\nå¦‚æœå·²ç»å®Œæˆä¸Šé¢çš„æ“ä½œï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹\n\n\nå¾®ä¿¡ç½‘ç«™åº”ç”¨å¾®ä¿¡ç™»å½•æ˜¯åŸºäºOAuth2.0åè®®æ ‡å‡†æ„å»ºçš„å¾®ä¿¡OAuth2.0æˆæƒç™»å½•ç³»ç»Ÿã€‚\n\nå¾®ä¿¡OAuth2.0æˆæƒç™»å½•ç›®å‰æ”¯æŒauthorization_codeæ¨¡å¼ï¼Œé€‚ç”¨äºæ‹¥æœ‰serverç«¯çš„åº”ç”¨æˆæƒã€‚è¯¥æ¨¡å¼æ•´ä½“æµç¨‹ä¸ºï¼š\n\n1. ç¬¬ä¸‰æ–¹å‘èµ·å¾®ä¿¡æˆæƒç™»å½•è¯·æ±‚ï¼Œå¾®ä¿¡ç”¨æˆ·å…è®¸æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨åï¼Œå¾®ä¿¡ä¼šæ‹‰èµ·åº”ç”¨æˆ–é‡å®šå‘åˆ°ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œå¹¶ä¸”å¸¦ä¸Šæˆæƒä¸´æ—¶ç¥¨æ®codeå‚æ•°ï¼›\n2. é€šè¿‡codeå‚æ•°åŠ ä¸ŠAppIDå’ŒAppSecretç­‰ï¼Œé€šè¿‡APIæ¢å–access_tokenï¼›\n3. é€šè¿‡access_tokenè¿›è¡Œæ¥å£è°ƒç”¨ï¼Œè·å–ç”¨æˆ·åŸºæœ¬æ•°æ®èµ„æºæˆ–å¸®åŠ©ç”¨æˆ·å®ç°åŸºæœ¬æ“ä½œã€‚\n\n-------\n\n#### è·å–access_token æ—¶åºå›¾\n\n![è·å–access_token æ—¶åºå›¾](https://res.wx.qq.com/op_res/D0wkkHSbtC6VUSHX4WsjP5ssg5mdnEmXO8NGVGF34dxS9N1WCcq6wvquR4K_Hcut)\n\n\nå…·ä½“æµç¨‹è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬è¿™é‡Œåªè¯´ä¸€ä¸‹pythonçš„å®ç°æ–¹æ³•ã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ [ç‚¹è¿™é‡Œ](https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&t=resource/res_list&verify=1&lang=zh_CN&token=db685a316b7e3933cae42c5ca91d4e024125d1b8&appid=wx6d8c79fb64de6c08)\n\n\nå‚è€ƒpython-instagram æˆ‘å†™äº†ä¸€ä¸ª [python-weixin] (https://github.com/gusibi/python-weixin)ä¸€ä¸ªå¾®ä¿¡python SDK\n\nä¸è¿‡ç°åœ¨è¿˜åªæœ‰å¾®ä¿¡æ¥å…¥ã€è·å–ç”¨æˆ·ä¿¡æ¯ã€ åˆ·æ–°refresh_token ç­‰ç®€å•åŠŸèƒ½\n\n-------\n### å®‰è£…\n\n#### æ–¹æ³•ä¸€ æ‰‹åŠ¨å®‰è£…\n1. é¦–å…ˆ éœ€è¦æŠŠä»£ç cloneåˆ°æœ¬åœ°\n2. python setup.py install\n\n#### æ–¹æ³•äºŒ pip install\n\n```\npip install git+https://github.com/gusibi/python-weixin.git@master\n```\n\n-------\n\n### ä½¿ç”¨æ–¹å¼\n\n```python\n\nfrom weixin.client import WeixinAPI\n\nAPP_ID = 'your app id'\nAPP_SECRET = 'your app secret'\nREDIRECT_URI = 'http://your_domain.com/redirect_uri'  # è¿™é‡Œä¸€å®šè¦æ³¨æ„ åœ°å€ä¸€å®šè¦åŠ ä¸Šhttp/https\n\nscope = (\"snsapi_login\", )\napi = WeixinAPI(appid=APP_ID,\n                app_secret=APP_SECRET,\n                redirect_uri=REDIRECT_URI)\n\nauthorize_url = api.get_authorize_url(scope=scope)\n```\n\nç°åœ¨å°† authorize_urlåœ°å€(å¦‚ http://yoursite.com/login/weixin)åœ¨æµè§ˆå™¨æ‰“å¼€ï¼Œ å°†è·³è½¬åˆ°å¾®ä¿¡ç™»å½•é¡µé¢ï¼Œä½¿ç”¨æ‰‹æœºæ‰«ç ç™»å½•åå°†è·³è½¬åˆ°\n\nhttp://your_domain.com/redirect_uri?code=CODE&state=STATE é¡µé¢\n\nç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨code æ¥è·å–ç™»å½•çš„ access_token\n\n```python\naccess_token = api.exchange_code_for_access_token(code=code)\n```\n\naccess_token ä¿¡æ¯ä¸º\n\n```json\n{\n\"access_token\":\"ACCESS_TOKEN\",\n\"expires_in\":7200,\n\"refresh_token\":\"REFRESH_TOKEN\",\n\"openid\":\"OPENID\",\n\"scope\":\"SCOPE\"\n}\n```\n\n|å‚æ•°\t|è¯´æ˜|\n| ------------- |:-------------|\n|access_token\t|æ¥å£è°ƒç”¨å‡­è¯ï¼ˆæœ‰æ•ˆæœŸç›®å‰ä¸º2ä¸ªå°æ—¶ï¼‰|\n|expires_in\t|access_tokenæ¥å£è°ƒç”¨å‡­è¯è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼ˆç§’ï¼‰|\n|refresh_token\t|ç”¨æˆ·åˆ·æ–°access_tokenï¼ˆæœ‰æ•ˆæœŸç›®å‰ä¸º30å¤©ï¼‰|\n|openid\t|æˆæƒç”¨æˆ·å”¯ä¸€æ ‡è¯†|\n|scope\t|ç”¨æˆ·æˆæƒçš„ä½œç”¨åŸŸï¼Œä½¿ç”¨é€—å·ï¼ˆ,ï¼‰åˆ†éš”|\n\n\nè·å–access_tokenåï¼Œå°±å¯ä»¥è¿›è¡Œæ¥å£è°ƒç”¨ï¼Œæœ‰ä»¥ä¸‹å‰æï¼š\n\n1. access_tokenæœ‰æ•ˆä¸”æœªè¶…æ—¶ï¼›\n2. å¾®ä¿¡ç”¨æˆ·å·²æˆæƒç»™ç¬¬ä¸‰æ–¹åº”ç”¨å¸å·ç›¸åº”æ¥å£ä½œç”¨åŸŸï¼ˆscopeï¼‰ã€‚\n\nå¯¹äºæ¥å£ä½œç”¨åŸŸï¼ˆscopeï¼‰ï¼Œèƒ½è°ƒç”¨çš„æ¥å£æœ‰ä»¥ä¸‹ï¼š\n\n| æˆæƒä½œç”¨åŸŸï¼ˆscopeï¼‰|æ¥å£| æ¥å£è¯´æ˜|\n| ------------- |:------------- |:-----|\n| snsapi_base|/sns/oauth2/access_token\t|é€šè¿‡codeæ¢å–access_tokenã€refresh_tokenå’Œå·²æˆæƒscope|\n| snsapi_base| /sns/oauth2/refresh_token\t|åˆ·æ–°æˆ–ç»­æœŸaccess_tokenä½¿ç”¨|\n| snsapi_base| /sns/auth\t|æ£€æŸ¥access_tokenæœ‰æ•ˆæ€§|\n| snsapi_userinfo|/sns/userinfo\t|è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯|\n\n\n```python\napi = WeixinAPI(appid=APP_ID,\n                app_secret=APP_SECRET,\n                redirect_uri=REDIRECT_URI)\n\n# åˆ·æ–°æˆ–ç»­æœŸaccess_tokenä½¿ç”¨\nrefresh_token = api.exchange_refresh_token_for_access_token(refresh_token=auth_info['refresh_token'])\n\napi = WeixinAPI(access_token=auth_info['access_token'])\n\n# è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯\nuser = api.user(openid=auth_info['openid'])\n\n# æ£€æŸ¥access_tokenæœ‰æ•ˆæ€§\nv = api.validate_token(openid=auth_info['openid'])\n```\n\n\nç°åœ¨å°±å¾®ä¿¡ç™»å½•å°±å®Œæˆäº†\n\n-------\n\nä¸‹é¢æ˜¯ç”¨ flask å®ç°çš„å®Œæ•´çš„ä¾‹å­\n\n```python\nfrom flask import Flask\nfrom flask import Markup\nfrom flask import redirect\nfrom flask import request\nfrom flask import jsonify\n\nfrom weixin.client import WeixinAPI\nfrom weixin.oauth2 import OAuth2AuthExchangeError\n\napp = Flask(__name__)\n\nAPP_ID = 'appid'\nAPP_SECRET = 'app secret'\nREDIRECT_URI = 'http://localhost.com/authorization'\n\n\n@app.route(\"/authorization\")\ndef authorization():\n    code = request.args.get('code')\n    api = WeixinAPI(appid=APP_ID,\n                    app_secret=APP_SECRET,\n                    redirect_uri=REDIRECT_URI)\n    auth_info = api.exchange_code_for_access_token(code=code)\n    api = WeixinAPI(access_token=auth_info['access_token'])\n    resp = api.user(openid=auth_info['openid'])\n    return jsonify(resp)\n\n\n@app.route(\"/login\")\ndef login():\n    api = WeixinAPI(appid=APP_ID,\n                    app_secret=APP_SECRET,\n                    redirect_uri=REDIRECT_URI)\n    redirect_uri = api.get_authorize_login_url(scope=(\"snsapi_login\",))\n    return redirect(redirect_uri)\n\n\n@app.route(\"/\")\ndef hello():\n    return Markup('<a href=\"%s\">weixin login!</a>') % '/login'\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n\n```\n\n#### å‚è€ƒé“¾æ¥ï¼š\n\n* [å¾®ä¿¡ç½‘ç«™åº”ç”¨æ¥å…¥æ–‡æ¡£](https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&t=resource/res_list&verify=1&lang=zh_CN&token=db685a316b7e3933cae42c5ca91d4e024125d1b8&appid=wx6d8c79fb64de6c08)\n* [ç½‘ç«™åº”ç”¨åˆ›å»ºåœ°å€](https://open.weixin.qq.com/cgi-bin/frame?t=home/web_tmpl&lang=zh_CN)\n* [python-weixin]  (https://github.com/gusibi/python-weixin)\n",
      "data": {
        "title": "ç½‘ç«™å¾®ä¿¡ç™»å½•ï¼python å®ç°",
        "date": "2016-09-05 09:59:45",
        "tags": [
          "python",
          "weixin"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "python-weixin-login"
    },
    {
      "content": "\n## 1. ä»€ä¹ˆæ˜¯å¹¶å‘\n\n### å¹¶å‘å’Œå¹¶è¡Œä»€ä¹ˆå…³ç³»\n\n## çº¿ç¨‹ä¸é”æ¨¡å‹\n\n### äº’æ–¥å’Œå†…å­˜æ¨¡å‹\n\n### ä½¿ç”¨python è®²è§£å¤šçº¿ç¨‹çš„äº’æ–¥å’Œå†…å­˜æ¨¡å‹\n",
      "data": {
        "date": "2016-04-13 14:36:05",
        "title": "ä¸ƒå‘¨ä¸ƒå¹¶å‘æ¨¡å‹---çº¿ç¨‹ä¸é” 001",
        "description": "çº¿ç¨‹ä¸é”-äº’æ–¥å’Œå†…å­˜æ¨¡å‹",
        "tags": [
          "å¹¶å‘",
          "python"
        ],
        "categories": [
          "è¯»ä¹¦ç¬”è®°"
        ],
        "permalink": "/post/seven-concurrentcy-models-thread-and-lock-001",
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "seven_concurrentcy_models_thread_and_lock_001"
    },
    {
      "content": "\n##\n\n### \n\n## å‚è€ƒé“¾æ¥\n\n\n------\n\n\n**æœ€åï¼Œæ„Ÿè°¢å¥³æœ‹å‹æ”¯æŒå’ŒåŒ…å®¹ï¼Œæ¯”â¤ï¸**\n\nä¹Ÿå¯ä»¥åœ¨å…¬å·è¾“å…¥ä»¥ä¸‹å…³é”®å­—è·å–å†å²æ–‡ç« ï¼š`å…¬å·&å°ç¨‹åº` | `è®¾è®¡æ¨¡å¼` | `å¹¶å‘&åç¨‹`\n\n![](http://media.gusibi.mobi/ah0mqMXMtdJb9Yj03suu-NGEyVRxyEuOIT5bXSv7ip5aqtHkiRjTTl8SMRMv3Qp5)\n",
      "data": {
        "date": "",
        "title": "title",
        "author": "goodspeed",
        "permalink": "/post/url-path",
        "description": "description",
        "tags": [
          "xx",
          "xxxx"
        ],
        "categories": [
          "xxx",
          "xxxx"
        ],
        "published": false,
        "hideInList": false,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "solidity-sample-guide-0x002"
    }
  ],
  "tags": [
    {
      "name": "go",
      "slug": "FwuPbutTv",
      "used": true
    },
    {
      "name": "èœè°±",
      "slug": "7Fs1IgCNFG",
      "used": true
    },
    {
      "name": "å¾®æœåŠ¡",
      "slug": "EN0G2etHI",
      "used": true
    },
    {
      "name": "è¯»ä¹¦ç¬”è®°",
      "slug": "glQb6dJVjy",
      "used": true
    },
    {
      "name": "Flutter",
      "slug": "j2_8hYGfrO",
      "used": true
    },
    {
      "name": "å‰ç«¯",
      "slug": "3oZfUx_LEv",
      "used": true
    },
    {
      "name": "æ•™ç¨‹",
      "slug": "pwgh1Pk6jH",
      "used": true
    },
    {
      "name": "tutorial",
      "slug": "dZ-owfp1g-",
      "used": true
    },
    {
      "name": "å·¥å…·",
      "slug": "ydI7Nu27dS",
      "used": true
    },
    {
      "name": "golang",
      "slug": "h1jl8FQ-xq",
      "used": true
    },
    {
      "name": "python",
      "slug": "GJK-9r_mL4",
      "used": true
    },
    {
      "name": "å…¬ä¼—å·",
      "slug": "cgMbZVHK_K",
      "used": true
    },
    {
      "name": "DynamoDB",
      "slug": "vcVxmxp3l5",
      "used": true
    },
    {
      "name": "nosql",
      "slug": "rOvUKpmLj1",
      "used": true
    },
    {
      "name": "database",
      "slug": "TSXYO6WF5k",
      "used": true
    },
    {
      "name": "åç«¯",
      "slug": "eo1DNZQqSJ",
      "used": true
    },
    {
      "name": "å¹¶å‘",
      "slug": "RW0o1ban52",
      "used": true
    },
    {
      "name": "restful",
      "slug": "2Lchj1QFpJ",
      "used": true
    },
    {
      "name": "åƒåœ¾å›æ”¶",
      "slug": "0zPWGZjQPcF",
      "used": true
    },
    {
      "name": "ç®—æ³•",
      "slug": "UA8d7APQRBo",
      "used": true
    },
    {
      "name": "xx",
      "slug": "PdnSsFMsSED",
      "used": true
    },
    {
      "name": "xxxx",
      "slug": "IJO993RCN4n",
      "used": true
    },
    {
      "name": "grpc",
      "slug": "EcpvKaZaik0",
      "used": true
    },
    {
      "name": "å°ç¨‹åº",
      "slug": "b1TZUgasNVY",
      "used": true
    },
    {
      "name": "weixin",
      "slug": "Q_w_5UsfWI9",
      "used": true
    },
    {
      "name": "development",
      "slug": "T91O6w2BvZT",
      "used": true
    },
    {
      "name": "AWS",
      "slug": "AaHP7VeH3F9",
      "used": true
    },
    {
      "name": "Lambda",
      "slug": "vbjLaAY-vIF",
      "used": true
    },
    {
      "name": "serverless",
      "slug": "r6jdzj9A4Qs",
      "used": true
    },
    {
      "name": "swagger",
      "slug": "pS2KGqpGJbb",
      "used": true
    },
    {
      "name": "css",
      "slug": "lIaqiqSmd_G",
      "used": true
    },
    {
      "name": "html",
      "slug": "w8GRuTJ6yMj",
      "used": true
    },
    {
      "name": "æ¯å‘¨åˆ†äº«",
      "slug": "EIIxnocrDtu",
      "used": true
    },
    {
      "name": "redis",
      "slug": "kzWiQsKAWoe",
      "used": true
    },
    {
      "name": "JavaScript",
      "slug": "Ipm7Za2QwaV",
      "used": true
    },
    {
      "name": "è®¾è®¡æ¨¡å¼",
      "slug": "2AujKktQOcd",
      "used": true
    },
    {
      "name": "åŒºå—é“¾",
      "slug": "2ak9hnAalQN",
      "used": true
    },
    {
      "name": "ä»¥å¤ªåŠ",
      "slug": "iPhbGF1dwL9",
      "used": true
    },
    {
      "name": "è¿›ç¨‹",
      "slug": "2tIM2PZvOTG",
      "used": true
    },
    {
      "name": "sanic",
      "slug": "tHKqIhMy9GJ",
      "used": true
    }
  ],
  "menus": [
    {
      "link": "/",
      "name": "é¦–é¡µ",
      "openType": "Internal"
    },
    {
      "link": "/archives",
      "name": "å½’æ¡£",
      "openType": "Internal"
    },
    {
      "link": "/tags",
      "name": "æ ‡ç­¾",
      "openType": "Internal"
    },
    {
      "link": "/post/about",
      "name": "å…³äº",
      "openType": "Internal"
    }
  ]
}